os:
  - osx
  - linux
sudo: false
language: c
services:
  - docker
compiler:
  - gcc
  - clang 
env:
  global:
    # ATS1
    - ATSVER=0.2.12
    - ATSHOME=${HOME}/ats-lang-anairiats-${ATSVER}
    - ATSHOMERELOC=ATS-${ATSVER}
    # ATS2
    - PATSHOME=${TRAVIS_BUILD_DIR}
    - PATSHOMERELOC=${HOME}/ATS-Postiats-contrib
    - PATSHOME_contrib=${PATSHOMERELOC}
    # Path
    - PATH=${PATH}:${PATSHOME}/bin
    # Docker
    - secure: "epWjhbYtBqKXc/hPEYwf0imwdHXFWBM6WemZMUkeQcsmrkyov0wX0oRBd3a7QBRzhy+pozrzi95H3B8iXwihPlYUPNn9+gl7eVAN2KmYfO3DmX2HVgJ26AHvs36l5m/hZCwTnemkvqnS1kkChyLrklzEDEkitiNawu50XG2XCt4="
    - secure: "UKQSPT2XNq8CNJ+0vZS97Qg7hLVWXcs7eJR+JBz7XjPR7ioXoWu6t9ZNiwaaQljVGYuG/mkdTJ2IoVzf3/Ik0jHcsHBX+8hsUokXTl0P5thZwhTAZeEBTxHH//2NVji4Aulbo3XruhrGqTiMHVws48WXwcI7nivXnE6gFD218xQ="
addons:
  apt:
    packages:
    # - libgc-dev
    # - libgmp3-dev
    # - libgtk-3-dev
    # - libev-dev
    - libjson-c-dev
    # - libjansson-dev
    # - docbook-utils
before_install:
  # Install OSX Packages
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then ${TRAVIS_BUILD_DIR}/travis-ci/install_osx.sh; fi
install:
  # Build ATS1
  - date
  # - (cd ${HOME} && ${TRAVIS_BUILD_DIR}/travis-ci/install_ats1.sh)
script:
  # Building ATS2
  - ${CC} --version
  # - (cd ${PATSHOME} && ${TRAVIS_BUILD_DIR}/travis-ci/install_ats2.sh)
  # Initial Testing
  # - patscc
  # Running regress test
  # - (cd ${PATSHOME} && ${TRAVIS_BUILD_DIR}/travis-ci/test_regress.sh)
after_success:
  # Build Docker Image
  - echo $DOCKER_USER
  - echo $DOCKER_PASS
  - docker login -u $DOCKER_USER -p $DOCKER_PASS
  - if [[ "$TRAVIS_OS_NAME" == "linux" ]] && [[ "$CC" == "gcc" ]]; then (cd ${TRAVIS_BUILD_DIR}/travis-ci/ && ./build_docker.sh "$DOCKER_USER" "$DOCKER_PASS"); fi
  # Building some utilities
  # - (cd ${PATSHOME} && ${TRAVIS_BUILD_DIR}/travis-ci/install_utilities.sh)
  # Install Contrib
  # - (cd ${HOME} && ${TRAVIS_BUILD_DIR}/travis-ci/install_contrib.sh)
  # Building books
  # - if [ "$TRAVIS_OS_NAME" = "linux" ]; then (cd ${PATSHOME} && make -C doc/BOOK/ATS2TUTORIAL); fi
  # - if [ "$TRAVIS_OS_NAME" = "linux" ]; then (cd ${PATSHOME} && make -C doc/BOOK/INT2PROGINATS); fi
after_script:
  # End Time
  - date
