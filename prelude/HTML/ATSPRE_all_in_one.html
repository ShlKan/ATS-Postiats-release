<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <title></title>
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
  <style type="text/css">
    .patsyntax {color:#808080;background-color:#E0E0E0;}
    .patsyntax span.keyword {color:#000000;font-weight:bold;}
    .patsyntax span.comment {color:#787878;font-style:italic;}
    .patsyntax span.extcode {color:#A52A2A;}
    .patsyntax span.neuexp  {color:#800080;}
    .patsyntax span.staexp  {color:#0000F0;}
    .patsyntax span.prfexp  {color:#603030;}
    .patsyntax span.dynexp  {color:#F00000;}
    .patsyntax span.stalab  {color:#0000F0;font-style:italic}
    .patsyntax span.dynlab  {color:#F00000;font-style:italic}
    .patsyntax span.dynstr  {color:#008000;font-style:normal}
    .patsyntax span.stacstdec  {text-decoration:none;}
    .patsyntax span.stacstuse  {color:#0000CF;text-decoration:underline;}
    .patsyntax span.dyncstdec  {text-decoration:none;}
    .patsyntax span.dyncstuse  {color:#B80000;text-decoration:underline;}
    .patsyntax span.dyncst_implement  {color:#B80000;text-decoration:underline;}
  </style>
</head>
<body class="patsyntax">

<pre class="patsyntax">
<span class="comment">(***********************************************************************)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(*                         Applied Type System                         *)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(***********************************************************************)</span>

<span class="comment">(*
** ATS/Postiats - Unleashing the Potential of Types!
** Copyright (C) 2011-2014 Hongwei Xi, ATS Trustful Software, Inc.
** All rights reserved
**
** ATS is free software;  you can  redistribute it and/or modify it under
** the terms of  the GNU GENERAL PUBLIC LICENSE (GPL) as published by the
** Free Software Foundation; either version 3, or (at  your  option)  any
** later version.
** 
** ATS is distributed in the hope that it will be useful, but WITHOUT ANY
** WARRANTY; without  even  the  implied  warranty  of MERCHANTABILITY or
** FITNESS FOR A PARTICULAR PURPOSE.  See the  GNU General Public License
** for more details.
** 
** You  should  have  received  a  copy of the GNU General Public License
** along  with  ATS;  see the  file COPYING.  If not, please write to the
** Free Software Foundation,  51 Franklin Street, Fifth Floor, Boston, MA
** 02110-1301, USA.
*)</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">// Author: Hongwei Xi</span>
<span class="comment">// Authoremail: hwxiATcsDOTbuDOTedu</span>
<span class="comment">//</span>
<span class="comment">// This one was</span>
<span class="comment">// there at the very beginning of ATS</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">(*
HX: fixity declarations
*)</span>
<span class="neuexp"><span class="keyword">#include</span> "prelude/params.hats"</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">#if</span> <span class="neuexp">VERBOSE_FIXITY</span> <span class="keyword">#then</span>
<span class="neuexp"><span class="keyword">#print</span> "Loading [fixity.ats] starts!\n"</span>
<span class="keyword">#endif</span> <span class="comment">// end of [VERBOSE_FIXITY]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">(*
prefix 00 ! (* static *)
*)</span>
<span class="comment">//</span>
<span class="neuexp"><span class="keyword">prefix</span> 99 <span class="keyword">!</span></span> <span class="comment">(* dynamic *)</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
prefix 81 ID (* identity *)
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
postfix 80 .lab // dynamic
postfix 80 -&gt;lab // dynamic
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
prefix 79 &amp; // dynamic
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
infixl 70 app
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
postfix 69 ?
*)</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">// HX-2015-08-04:</span>
<span class="comment">// mostly following the Fortran convention</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="neuexp"><span class="keyword">infixr</span> 61 **</span> <span class="comment">(*exp*)</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">// multiplicative</span>
<span class="comment">//</span>
<span class="neuexp"><span class="keyword">infixl</span> 60 * / % mod</span>
<span class="comment">//</span>
<span class="comment">(*
infixl 60 nmul ndiv nmod
*)</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="neuexp"><span class="keyword">prefix</span> 51 <span class="keyword">~</span></span> <span class="comment">(*negative*)</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="neuexp"><span class="keyword">infixl</span> 50 + -</span> <span class="comment">(*additive*)</span>
<span class="comment">//</span>
<span class="comment">(*
infixr (+) ++ // concatenative
*)</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="neuexp"><span class="keyword">infixl</span> 41 asl asr</span>
<span class="neuexp"><span class="keyword">infixl</span> 41 lsl lsr</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="neuexp"><span class="keyword">infix</span> 40 <span class="keyword">&lt;</span> &lt;= <span class="keyword">&gt;</span> &gt;=</span>
<span class="comment">//</span>
<span class="comment">(*
//
// HX-2012-07: removed
//
infixl ( &lt; ) ilt flt plt ult
infixl ( &lt;= ) ilte flte plte ulte
infixl ( &gt; ) igt fgt pgt ugt
infixl ( &gt;= ) igte fgte pgte ugte
*)</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="neuexp"><span class="keyword">infixr</span> 40 :: <span class="keyword">@</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="neuexp"><span class="keyword">infix</span> 30 <span class="keyword">=</span> == != &lt;&gt;</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
//
// HX-2012-07: removed
//
infix ( = ) ieq feq peq ueq
infix ( &lt;&gt; ) ineq fneq pneq uneq
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="neuexp"><span class="keyword">infixl</span> 21 &amp;&amp;</span>
<span class="neuexp"><span class="keyword">infixl</span> <span class="keyword">(</span> &amp;&amp; <span class="keyword">)</span> andalso land</span>

<span class="comment">(* ****** ****** *)</span>

<span class="neuexp"><span class="keyword">infixl</span> 20 ||</span>
<span class="neuexp"><span class="keyword">infixl</span> <span class="keyword">(</span> || <span class="keyword">)</span> xor orelse lor lxor</span>

<span class="comment">(* ****** ****** *)</span>

<span class="neuexp"><span class="keyword">infixr</span> 10 <span class="keyword">-&gt;</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="neuexp"><span class="keyword">infix</span> 0 :=</span> <span class="comment">// HX: assign</span>
<span class="neuexp"><span class="keyword">infix</span> 0 :=:</span> <span class="comment">// HX: exchange</span>

<span class="comment">(* ****** ****** *)</span>

<span class="neuexp"><span class="keyword">infixl</span> 0 &lt;&lt;</span> <span class="comment">(* g0int_asl, g0uint_lsl *)</span>
<span class="neuexp"><span class="keyword">infixr</span> 0 &gt;&gt;</span> <span class="comment">(* g0int_asr, g0uint_lsr *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="neuexp"><span class="keyword">prefix</span> 0 ++ --</span> <span class="comment">// inc and dec</span>
<span class="neuexp"><span class="keyword">prefix</span> 0 !++ --!</span> <span class="comment">// getinc and decget</span>
<span class="neuexp"><span class="keyword">infixr</span> 0 =++ --=</span> <span class="comment">// setinc and decset</span>

<span class="comment">(* ****** ****** *)</span>

<span class="neuexp"><span class="keyword">infix</span> 0 :+= :-= :*= :/=</span> <span class="comment">// x:=x+a, x:=x-a, ...</span>
<span class="neuexp"><span class="keyword">infix</span> 0 :=+ :=- :=* :=/</span> <span class="comment">// x:=a+x, x:=a-x, ...</span>

<span class="comment">(* ****** ****** *)</span>

<span class="neuexp"><span class="keyword">prefix</span> 0 ignoret</span> <span class="comment">// ignoring a funcall return</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">#if</span> <span class="neuexp">VERBOSE_FIXITY</span> <span class="keyword">#then</span>
<span class="neuexp"><span class="keyword">#print</span> "Loading [fixity.ats] finishes!\n"</span>
<span class="keyword">#endif</span> <span class="comment">// end of [VERBOSE_FIXITY]</span>

<span class="comment">(* end of [fixity.ats] *)</span>
</pre>
<pre class="patsyntax">
<span class="comment">(***********************************************************************)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(*                         Applied Type System                         *)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(***********************************************************************)</span>

<span class="comment">(*
** ATS/Postiats - Unleashing the Potential of Types!
** Copyright (C) 2010-2013 Hongwei Xi, ATS Trustful Software, Inc.
** All rights reserved
**
** ATS is free software;  you can  redistribute it and/or modify it under
** the terms of  the GNU GENERAL PUBLIC LICENSE (GPL) as published by the
** Free Software Foundation; either version 3, or (at  your  option)  any
** later version.
**
** ATS is distributed in the hope that it will be useful, but WITHOUT ANY
** WARRANTY; without  even  the  implied  warranty  of MERCHANTABILITY or
** FITNESS FOR A PARTICULAR PURPOSE.  See the  GNU General Public License
** for more details.
**
** You  should  have  received  a  copy of the GNU General Public License
** along  with  ATS;  see the  file COPYING.  If not, please write to the
** Free Software Foundation,  51 Franklin Street, Fifth Floor, Boston, MA
** 02110-1301, USA.
*)</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">// Author of the file:</span>
<span class="comment">// Hongwei Xi (gmhwxiATgmailDOTcom)</span>
<span class="comment">// Start Time: September, 2011</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="neuexp"><span class="keyword">#include</span> "prelude/params.hats"</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">#if</span> <span class="neuexp">VERBOSE_PRELUDE</span> <span class="keyword">#then</span>
<span class="neuexp"><span class="keyword">#print</span> "Loading [basics_pre.sats] starts!\n"</span>
<span class="keyword">#endif</span> <span class="comment">// end of [VERBOSE_PRELUDE]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">// HX:</span>
<span class="comment">// some built-in static boolean constants</span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">stacst</span>
true_bool <span class="keyword">:</span> bool</span> <span class="keyword">=</span> "ext#"
<span class="staexp"><span class="keyword">stacst</span>
false_bool <span class="keyword">:</span> bool</span> <span class="keyword">=</span> "ext#"
<span class="comment">//</span>
<span class="keyword">stadef</span>
<span class="staexp">true <span class="keyword">=</span> <span class="staexp">true_bool</span></span> <span class="keyword">and</span> <span class="staexp">false <span class="keyword">=</span> <span class="staexp">false_bool</span></span>
<span class="comment">//</span>
<span class="comment">// HX: boolean negation</span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">stacst</span>
neg_bool
  <span class="keyword">:</span> bool <span class="keyword">-&gt;</span> bool</span> <span class="keyword">=</span> "ext#"
<span class="comment">//</span>
<span class="keyword">stadef</span> <span class="staexp"><span class="keyword">~</span> <span class="keyword">=</span> <span class="staexp">neg_bool</span></span> <span class="comment">// overloaded</span>
<span class="keyword">stadef</span> <span class="staexp">not <span class="keyword">=</span> <span class="staexp">neg_bool</span></span> <span class="comment">// overloaded</span>
<span class="comment">//</span>
<span class="comment">// HX: disjunction</span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">stacst</span>
add_bool_bool
  <span class="keyword">:</span> <span class="keyword">(</span>bool<span class="keyword">,</span> bool<span class="keyword">)</span> <span class="keyword">-&gt;</span> bool</span> <span class="keyword">=</span> "ext#"
<span class="comment">//</span>
<span class="comment">// HX: disjunction</span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">stacst</span>
mul_bool_bool
  <span class="keyword">:</span> <span class="keyword">(</span>bool<span class="keyword">,</span> bool<span class="keyword">)</span> <span class="keyword">-&gt;</span> bool</span> <span class="keyword">=</span> "ext#"
<span class="comment">//</span>
<span class="keyword">stadef</span> <span class="staexp">+ <span class="keyword">=</span> <span class="staexp">add_bool_bool</span></span> <span class="keyword">and</span> <span class="staexp">* <span class="keyword">=</span> <span class="staexp">mul_bool_bool</span></span>
<span class="keyword">stadef</span> <span class="staexp">|| <span class="keyword">=</span> <span class="staexp">add_bool_bool</span></span> <span class="keyword">and</span> <span class="staexp">&amp;&amp; <span class="keyword">=</span> <span class="staexp">mul_bool_bool</span></span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">stacst</span> lt_bool_bool
  <span class="keyword">:</span> <span class="keyword">(</span>bool<span class="keyword">,</span> bool<span class="keyword">)</span> <span class="keyword">-&gt;</span> bool</span> <span class="keyword">=</span> "ext#"
<span class="staexp"><span class="keyword">stacst</span> lte_bool_bool
  <span class="keyword">:</span> <span class="keyword">(</span>bool<span class="keyword">,</span> bool<span class="keyword">)</span> <span class="keyword">-&gt;</span> bool</span> <span class="keyword">=</span> "ext#"
<span class="comment">//</span>
<span class="staexp"><span class="keyword">stacst</span> gt_bool_bool
  <span class="keyword">:</span> <span class="keyword">(</span>bool<span class="keyword">,</span> bool<span class="keyword">)</span> <span class="keyword">-&gt;</span> bool</span> <span class="keyword">=</span> "ext#"
<span class="staexp"><span class="keyword">stacst</span> gte_bool_bool
  <span class="keyword">:</span> <span class="keyword">(</span>bool<span class="keyword">,</span> bool<span class="keyword">)</span> <span class="keyword">-&gt;</span> bool</span> <span class="keyword">=</span> "ext#"
<span class="comment">//</span>
<span class="keyword">stadef</span> <span class="staexp"><span class="keyword">&lt;</span> <span class="keyword">=</span> <span class="staexp">lt_bool_bool</span></span> <span class="keyword">and</span> <span class="staexp">&lt;= <span class="keyword">=</span> <span class="staexp">lte_bool_bool</span></span>
<span class="keyword">stadef</span> <span class="staexp"><span class="keyword">&gt;</span> <span class="keyword">=</span> <span class="staexp">gt_bool_bool</span></span> <span class="keyword">and</span> <span class="staexp">&gt;= <span class="keyword">=</span> <span class="staexp">gte_bool_bool</span></span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">stacst</span> eq_bool_bool
  <span class="keyword">:</span> <span class="keyword">(</span>bool<span class="keyword">,</span> bool<span class="keyword">)</span> <span class="keyword">-&gt;</span> bool</span> <span class="keyword">=</span> "ext#"
<span class="staexp"><span class="keyword">stacst</span> neq_bool_bool
  <span class="keyword">:</span> <span class="keyword">(</span>bool<span class="keyword">,</span> bool<span class="keyword">)</span> <span class="keyword">-&gt;</span> bool</span> <span class="keyword">=</span> "ext#"
<span class="comment">//</span>
<span class="keyword">stadef</span> <span class="staexp">== <span class="keyword">=</span> <span class="staexp">eq_bool_bool</span></span>
<span class="keyword">stadef</span> <span class="staexp">!= <span class="keyword">=</span> <span class="staexp">neq_bool_bool</span></span>
<span class="keyword">stadef</span> <span class="staexp">&lt;&gt; <span class="keyword">=</span> <span class="staexp">neq_bool_bool</span></span> <span class="comment">(* for backward compatibility *)</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
//
// HX-2012-06-12: removed
//
stacst
eq_char_char
  : (char, char) -&gt; bool = "ext#"
stacst
neq_char_char
  : (char, char) -&gt; bool = "ext#"
//
stadef == = eq_char_char
stadef != = neq_char_char
stadef &lt;&gt; = neq_char_char (* for backward compatibility *)
//
*)</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">stacst</span>
neg_int
  <span class="keyword">:</span> <span class="keyword">(</span>int<span class="keyword">)</span> <span class="keyword">-&gt;</span> int</span> <span class="keyword">=</span> "ext#"
<span class="comment">//</span>
<span class="keyword">stadef</span> <span class="staexp"><span class="keyword">~</span> <span class="keyword">=</span> <span class="staexp">neg_int</span></span> <span class="comment">// overloaded</span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">stacst</span>
add_int_int
  <span class="keyword">:</span> <span class="keyword">(</span>int<span class="keyword">,</span> int<span class="keyword">)</span> <span class="keyword">-&gt;</span> int</span> <span class="keyword">=</span> "ext#"
<span class="staexp"><span class="keyword">stacst</span>
sub_int_int
  <span class="keyword">:</span> <span class="keyword">(</span>int<span class="keyword">,</span> int<span class="keyword">)</span> <span class="keyword">-&gt;</span> int</span> <span class="keyword">=</span> "ext#"
<span class="staexp"><span class="keyword">stacst</span>
mul_int_int
  <span class="keyword">:</span> <span class="keyword">(</span>int<span class="keyword">,</span> int<span class="keyword">)</span> <span class="keyword">-&gt;</span> int</span> <span class="keyword">=</span> "ext#"
<span class="staexp"><span class="keyword">stacst</span>
div_int_int
  <span class="keyword">:</span> <span class="keyword">(</span>int<span class="keyword">,</span> int<span class="keyword">)</span> <span class="keyword">-&gt;</span> int</span> <span class="keyword">=</span> "ext#"
<span class="comment">//</span>
<span class="keyword">stadef</span> <span class="staexp">+ <span class="keyword">=</span> <span class="staexp">add_int_int</span></span> <span class="keyword">and</span> <span class="staexp">- <span class="keyword">=</span> <span class="staexp">sub_int_int</span></span>
<span class="keyword">stadef</span> <span class="staexp">* <span class="keyword">=</span> <span class="staexp">mul_int_int</span></span> <span class="keyword">and</span> <span class="staexp">/ <span class="keyword">=</span> <span class="staexp">div_int_int</span></span>
<span class="comment">//</span>
<span class="comment">// HX: ndiv: divisor is positive</span>
<span class="comment">// HX: idiv: alias for div_int_int</span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">stacst</span>
ndiv_int_int
  <span class="keyword">:</span> <span class="keyword">(</span>int<span class="keyword">,</span> int<span class="keyword">)</span> <span class="keyword">-&gt;</span> int</span> <span class="keyword">=</span> "ext#"
<span class="staexp"><span class="keyword">stacst</span>
idiv_int_int
  <span class="keyword">:</span> <span class="keyword">(</span>int<span class="keyword">,</span> int<span class="keyword">)</span> <span class="keyword">-&gt;</span> int</span> <span class="keyword">=</span> "ext#"
<span class="comment">//</span>
<span class="keyword">stadef</span> <span class="staexp">ndiv <span class="keyword">=</span> <span class="staexp">ndiv_int_int</span></span> <span class="comment">// divided by nat</span>
<span class="keyword">stadef</span> <span class="staexp">idiv <span class="keyword">=</span> <span class="staexp">idiv_int_int</span></span> <span class="comment">// divided by int</span>
<span class="comment">//</span>
<span class="keyword">stadef</span>
<span class="staexp">nmod_int_int
<span class="keyword">(</span>
  <span class="staexp">x<span class="keyword">:</span>int</span><span class="keyword">,</span> <span class="staexp">y<span class="keyword">:</span>int</span>
<span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">x</span> <span class="staexp">-</span> <span class="staexp">y</span> <span class="staexp">*</span> <span class="keyword">(</span><span class="staexp">x</span> <span class="staexp"><span class="keyword">\</span></span><span class="staexp">ndiv_int_int</span> <span class="staexp">y</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">stadef</span> <span class="staexp">mod <span class="keyword">=</span> <span class="staexp">nmod_int_int</span></span>
<span class="keyword">stadef</span> <span class="staexp">nmod <span class="keyword">=</span> <span class="staexp">nmod_int_int</span></span>
<span class="keyword">stadef</span> <span class="staexp">% <span class="comment">(*adopted from C*)</span> <span class="keyword">=</span> <span class="staexp">nmod_int_int</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">stacst</span> lt_int_int
  <span class="keyword">:</span> <span class="keyword">(</span>int<span class="keyword">,</span> int<span class="keyword">)</span> <span class="keyword">-&gt;</span> bool</span> <span class="keyword">=</span> "ext#"
<span class="staexp"><span class="keyword">stacst</span> lte_int_int
  <span class="keyword">:</span> <span class="keyword">(</span>int<span class="keyword">,</span> int<span class="keyword">)</span> <span class="keyword">-&gt;</span> bool</span> <span class="keyword">=</span> "ext#"
<span class="comment">//</span>
<span class="staexp"><span class="keyword">stacst</span> gt_int_int
  <span class="keyword">:</span> <span class="keyword">(</span>int<span class="keyword">,</span> int<span class="keyword">)</span> <span class="keyword">-&gt;</span> bool</span> <span class="keyword">=</span> "ext#"
<span class="staexp"><span class="keyword">stacst</span> gte_int_int
  <span class="keyword">:</span> <span class="keyword">(</span>int<span class="keyword">,</span> int<span class="keyword">)</span> <span class="keyword">-&gt;</span> bool</span> <span class="keyword">=</span> "ext#"
<span class="comment">//</span>
<span class="keyword">stadef</span> <span class="staexp"><span class="keyword">&lt;</span> <span class="keyword">=</span> <span class="staexp">lt_int_int</span></span> <span class="keyword">and</span> <span class="staexp">&lt;= <span class="keyword">=</span> <span class="staexp">lte_int_int</span></span>
<span class="keyword">stadef</span> <span class="staexp"><span class="keyword">&gt;</span> <span class="keyword">=</span> <span class="staexp">gt_int_int</span></span> <span class="keyword">and</span> <span class="staexp">&gt;= <span class="keyword">=</span> <span class="staexp">gte_int_int</span></span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">stacst</span> eq_int_int
  <span class="keyword">:</span> <span class="keyword">(</span>int<span class="keyword">,</span> int<span class="keyword">)</span> <span class="keyword">-&gt;</span> bool</span> <span class="keyword">=</span> "ext#"
<span class="staexp"><span class="keyword">stacst</span> neq_int_int
  <span class="keyword">:</span> <span class="keyword">(</span>int<span class="keyword">,</span> int<span class="keyword">)</span> <span class="keyword">-&gt;</span> bool</span> <span class="keyword">=</span> "ext#"
<span class="comment">//</span>
<span class="keyword">stadef</span> <span class="staexp">== <span class="keyword">=</span> <span class="staexp">eq_int_int</span></span>
<span class="keyword">stadef</span> <span class="staexp">!= <span class="keyword">=</span> <span class="staexp">neq_int_int</span></span>
<span class="keyword">stadef</span> <span class="staexp">&lt;&gt; <span class="keyword">=</span> <span class="staexp">neq_int_int</span></span> <span class="comment">(* for backward compatibility *)</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">stacst</span>
abs_int
  <span class="keyword">:</span> <span class="keyword">(</span>int<span class="keyword">)</span> <span class="keyword">-&gt;</span> int</span> <span class="keyword">=</span> "ext#"
<span class="comment">//</span>
<span class="keyword">stadef</span>
<span class="staexp">absrel_int_int
  <span class="keyword">(</span><span class="staexp">x<span class="keyword">:</span> int</span><span class="keyword">,</span> <span class="staexp">v<span class="keyword">:</span> int</span><span class="keyword">)</span><span class="keyword">:</span> bool <span class="keyword">=</span>
  <span class="keyword">(</span><span class="staexp">x</span> <span class="staexp">&gt;=</span> <span class="staexp">0</span> <span class="staexp">&amp;&amp;</span> <span class="staexp">x</span> <span class="staexp">==</span> <span class="staexp">v</span><span class="keyword">)</span> <span class="staexp">||</span> <span class="keyword">(</span><span class="staexp">x</span> <span class="staexp">&lt;=</span> <span class="staexp">0</span> <span class="staexp">&amp;&amp;</span> <span class="staexp"><span class="keyword">~</span></span><span class="staexp">x</span> <span class="staexp">==</span> <span class="staexp">v</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">stadef</span> <span class="staexp">abs <span class="keyword">=</span> <span class="staexp">abs_int</span></span>
<span class="keyword">stadef</span> <span class="staexp">absrel <span class="keyword">=</span> <span class="staexp">absrel_int_int</span></span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">stacst</span>
sgn_int
  <span class="keyword">:</span> <span class="keyword">(</span>int<span class="keyword">)</span> <span class="keyword">-&gt;</span> int</span> <span class="keyword">=</span> "ext#"
<span class="comment">//</span>
<span class="keyword">stadef</span>
<span class="staexp">sgnrel_int_int
  <span class="keyword">(</span><span class="staexp">x<span class="keyword">:</span> int</span><span class="keyword">,</span> <span class="staexp">v<span class="keyword">:</span> int</span><span class="keyword">)</span><span class="keyword">:</span> bool <span class="keyword">=</span>
  <span class="keyword">(</span><span class="staexp">x</span> <span class="staexp"><span class="keyword">&gt;</span></span> <span class="staexp">0</span> <span class="staexp">&amp;&amp;</span> <span class="staexp">v</span><span class="staexp">==</span><span class="staexp">1</span><span class="keyword">)</span> <span class="staexp">||</span> <span class="keyword">(</span><span class="staexp">x</span><span class="staexp">==</span><span class="staexp">0</span> <span class="staexp">&amp;&amp;</span> <span class="staexp">v</span><span class="staexp">==</span><span class="staexp">0</span><span class="keyword">)</span> <span class="staexp">||</span> <span class="keyword">(</span><span class="staexp">x</span> <span class="staexp"><span class="keyword">&lt;</span></span> <span class="staexp">0</span> <span class="staexp">&amp;&amp;</span> <span class="staexp">v</span><span class="staexp">==</span><span class="keyword">(</span><span class="staexp"><span class="keyword">~</span></span><span class="staexp">1</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">stadef</span> <span class="staexp">sgn <span class="keyword">=</span> <span class="staexp">sgn_int</span></span>
<span class="keyword">stadef</span> <span class="staexp">sgnrel <span class="keyword">=</span> <span class="staexp">sgnrel_int_int</span></span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">stacst</span>
max_int_int
  <span class="keyword">:</span> <span class="keyword">(</span>int<span class="keyword">,</span> int<span class="keyword">)</span> <span class="keyword">-&gt;</span> int</span> <span class="keyword">=</span> "ext#"
<span class="staexp"><span class="keyword">stacst</span>
min_int_int
  <span class="keyword">:</span> <span class="keyword">(</span>int<span class="keyword">,</span> int<span class="keyword">)</span> <span class="keyword">-&gt;</span> int</span> <span class="keyword">=</span> "ext#"
<span class="comment">//</span>
<span class="keyword">stadef</span>
<span class="staexp">maxrel_int_int_int
  <span class="keyword">(</span><span class="staexp">x<span class="keyword">:</span> int</span><span class="keyword">,</span> <span class="staexp">y<span class="keyword">:</span> int</span><span class="keyword">,</span> <span class="staexp">v<span class="keyword">:</span> int</span><span class="keyword">)</span><span class="keyword">:</span> bool <span class="keyword">=</span>
  <span class="keyword">(</span><span class="staexp">x</span> <span class="staexp">&gt;=</span> <span class="staexp">y</span> <span class="staexp">&amp;&amp;</span> <span class="staexp">x</span> <span class="staexp">==</span> <span class="staexp">v</span><span class="keyword">)</span> <span class="staexp">||</span> <span class="keyword">(</span><span class="staexp">x</span> <span class="staexp">&lt;=</span> <span class="staexp">y</span> <span class="staexp">&amp;&amp;</span> <span class="staexp">y</span> <span class="staexp">==</span> <span class="staexp">v</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">stadef</span>
<span class="staexp">minrel_int_int_int
  <span class="keyword">(</span><span class="staexp">x<span class="keyword">:</span> int</span><span class="keyword">,</span> <span class="staexp">y<span class="keyword">:</span> int</span><span class="keyword">,</span> <span class="staexp">v<span class="keyword">:</span> int</span><span class="keyword">)</span><span class="keyword">:</span> bool <span class="keyword">=</span>
  <span class="keyword">(</span><span class="staexp">x</span> <span class="staexp">&gt;=</span> <span class="staexp">y</span> <span class="staexp">&amp;&amp;</span> <span class="staexp">y</span> <span class="staexp">==</span> <span class="staexp">v</span><span class="keyword">)</span> <span class="staexp">||</span> <span class="keyword">(</span><span class="staexp">x</span> <span class="staexp">&lt;=</span> <span class="staexp">y</span> <span class="staexp">&amp;&amp;</span> <span class="staexp">x</span> <span class="staexp">==</span> <span class="staexp">v</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">stadef</span> <span class="staexp">max <span class="keyword">=</span> <span class="staexp">max_int_int</span></span>
<span class="keyword">stadef</span> <span class="staexp">min <span class="keyword">=</span> <span class="staexp">min_int_int</span></span>
<span class="keyword">stadef</span> <span class="staexp">maxrel <span class="keyword">=</span> <span class="staexp">maxrel_int_int_int</span></span>
<span class="keyword">stadef</span> <span class="staexp">minrel <span class="keyword">=</span> <span class="staexp">minrel_int_int_int</span></span>
<span class="comment">//</span>
<span class="keyword">stadef</span>
<span class="staexp">nsub <span class="keyword">(</span><span class="staexp">x<span class="keyword">:</span>int</span><span class="keyword">,</span> <span class="staexp">y<span class="keyword">:</span>int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">max</span> <span class="keyword">(</span><span class="staexp">x</span><span class="staexp">-</span><span class="staexp">y</span><span class="keyword">,</span> <span class="staexp">0</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">stadef</span>
<span class="staexp">ndivrel_int_int_int <span class="comment">// HX: y &gt; 0</span>
  <span class="keyword">(</span><span class="staexp">x<span class="keyword">:</span> int</span><span class="keyword">,</span> <span class="staexp">y<span class="keyword">:</span> int</span><span class="keyword">,</span> <span class="staexp">q<span class="keyword">:</span> int</span><span class="keyword">)</span><span class="keyword">:</span> bool <span class="keyword">=</span>
  <span class="keyword">(</span><span class="staexp">q</span> <span class="staexp">*</span> <span class="staexp">y</span> <span class="staexp">&lt;=</span> <span class="staexp">x</span><span class="keyword">)</span> <span class="staexp">&amp;&amp;</span> <span class="keyword">(</span><span class="staexp">x</span> <span class="staexp"><span class="keyword">&lt;</span></span> <span class="staexp">q</span> <span class="staexp">*</span> <span class="staexp">y</span> <span class="staexp">+</span> <span class="staexp">y</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">stadef</span> <span class="staexp">ndivrel <span class="keyword">=</span> <span class="staexp">ndivrel_int_int_int</span></span>
<span class="comment">//</span>
<span class="keyword">stadef</span>
<span class="staexp">idivrel_int_int_int
  <span class="keyword">(</span><span class="staexp">x<span class="keyword">:</span> int</span><span class="keyword">,</span> <span class="staexp">y<span class="keyword">:</span> int</span><span class="keyword">,</span> <span class="staexp">q<span class="keyword">:</span> int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span> <span class="comment">// HX: y != 0</span>
  <span class="staexp">x</span> <span class="staexp">&gt;=</span> <span class="staexp">0</span> <span class="staexp">&amp;&amp;</span> <span class="staexp">y</span> <span class="staexp"><span class="keyword">&gt;</span></span> <span class="staexp">0</span> <span class="staexp">&amp;&amp;</span> <span class="staexp">ndivrel_int_int_int</span> <span class="keyword">(</span> <span class="staexp">x</span><span class="keyword">,</span>  <span class="staexp">y</span><span class="keyword">,</span>  <span class="staexp">q</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="staexp">||</span> <span class="keyword">(</span>
  <span class="staexp">x</span> <span class="staexp">&gt;=</span> <span class="staexp">0</span> <span class="staexp">&amp;&amp;</span> <span class="staexp">y</span> <span class="staexp"><span class="keyword">&lt;</span></span> <span class="staexp">0</span> <span class="staexp">&amp;&amp;</span> <span class="staexp">ndivrel_int_int_int</span> <span class="keyword">(</span> <span class="staexp">x</span><span class="keyword">,</span> <span class="staexp"><span class="keyword">~</span></span><span class="staexp">y</span><span class="keyword">,</span> <span class="staexp"><span class="keyword">~</span></span><span class="staexp">q</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="staexp">||</span> <span class="keyword">(</span>
  <span class="staexp">x</span> <span class="staexp"><span class="keyword">&lt;</span></span>  <span class="staexp">0</span> <span class="staexp">&amp;&amp;</span> <span class="staexp">y</span> <span class="staexp"><span class="keyword">&gt;</span></span> <span class="staexp">0</span> <span class="staexp">&amp;&amp;</span> <span class="staexp">ndivrel_int_int_int</span> <span class="keyword">(</span><span class="staexp"><span class="keyword">~</span></span><span class="staexp">x</span><span class="keyword">,</span>  <span class="staexp">y</span><span class="keyword">,</span> <span class="staexp"><span class="keyword">~</span></span><span class="staexp">q</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="staexp">||</span> <span class="keyword">(</span>
  <span class="staexp">x</span> <span class="staexp"><span class="keyword">&lt;</span></span>  <span class="staexp">0</span> <span class="staexp">&amp;&amp;</span> <span class="staexp">y</span> <span class="staexp"><span class="keyword">&lt;</span></span> <span class="staexp">0</span> <span class="staexp">&amp;&amp;</span> <span class="staexp">ndivrel_int_int_int</span> <span class="keyword">(</span><span class="staexp"><span class="keyword">~</span></span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp"><span class="keyword">~</span></span><span class="staexp">y</span><span class="keyword">,</span>  <span class="staexp">q</span><span class="keyword">)</span>
<span class="keyword">)</span></span> <span class="comment">(* end of [idivrel_int_int_int] *)</span>
<span class="comment">//</span>
<span class="keyword">stadef</span> <span class="staexp">idivrel <span class="keyword">=</span> <span class="staexp">idivrel_int_int_int</span></span>
<span class="comment">//</span>
<span class="keyword">stadef</span>
<span class="staexp">divmodrel_int_int_int_int
  <span class="keyword">(</span><span class="staexp">x<span class="keyword">:</span> int</span><span class="keyword">,</span> <span class="staexp">y<span class="keyword">:</span> int</span><span class="keyword">,</span> <span class="staexp">q<span class="keyword">:</span> int</span><span class="keyword">,</span> <span class="staexp">r<span class="keyword">:</span> int</span><span class="keyword">)</span> <span class="keyword">:</span> bool <span class="keyword">=</span>
  <span class="keyword">(</span><span class="staexp">0</span> <span class="staexp">&lt;=</span> <span class="staexp">r</span> <span class="staexp">&amp;&amp;</span> <span class="staexp">r</span> <span class="staexp"><span class="keyword">&lt;</span></span> <span class="staexp">y</span> <span class="staexp">&amp;&amp;</span> <span class="staexp">x</span> <span class="staexp">==</span> <span class="staexp">q</span><span class="staexp">*</span><span class="staexp">y</span> <span class="staexp">+</span> <span class="staexp">r</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">stadef</span> <span class="staexp">divmodrel <span class="keyword">=</span> <span class="staexp">divmodrel_int_int_int_int</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">stacst</span>
ifint_bool_int_int
  <span class="keyword">:</span> <span class="keyword">(</span>bool<span class="keyword">,</span> int<span class="keyword">,</span> int<span class="keyword">)</span> <span class="keyword">-&gt;</span> int</span> <span class="keyword">=</span> "ext#"
<span class="comment">//</span>
<span class="keyword">stadef</span>
<span class="staexp">ifintrel_bool_int_int_int
<span class="keyword">(</span>
  <span class="staexp">b<span class="keyword">:</span>bool</span><span class="keyword">,</span> <span class="staexp">x<span class="keyword">:</span>int</span><span class="keyword">,</span> <span class="staexp">y<span class="keyword">:</span>int</span><span class="keyword">,</span> <span class="staexp">r<span class="keyword">:</span>int</span>
<span class="keyword">)</span> <span class="keyword">:</span> bool <span class="keyword">=</span> <span class="keyword">(</span><span class="staexp">b</span> <span class="staexp">&amp;&amp;</span> <span class="staexp">r</span><span class="staexp">==</span><span class="staexp">x</span><span class="keyword">)</span> <span class="staexp">||</span> <span class="keyword">(</span><span class="staexp"><span class="keyword">~</span></span><span class="staexp">b</span> <span class="staexp">&amp;&amp;</span> <span class="staexp">r</span><span class="staexp">==</span><span class="staexp">y</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">stadef</span> <span class="staexp">ifint <span class="keyword">=</span> <span class="staexp">ifint_bool_int_int</span></span>
<span class="keyword">stadef</span> <span class="staexp">ifintrel <span class="keyword">=</span> <span class="staexp">ifintrel_bool_int_int_int</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">stadef</span>
<span class="staexp">bool2int<span class="keyword">(</span><span class="staexp">b<span class="keyword">:</span> bool</span><span class="keyword">)</span><span class="keyword">:</span> int <span class="keyword">=</span> <span class="staexp">ifint</span> <span class="keyword">(</span><span class="staexp">b</span><span class="keyword">,</span> <span class="staexp">1</span><span class="keyword">,</span> <span class="staexp">0</span><span class="keyword">)</span></span>
<span class="keyword">stadef</span> <span class="staexp">int2bool <span class="keyword">(</span><span class="staexp">i<span class="keyword">:</span> int</span><span class="keyword">)</span><span class="keyword">:</span> bool <span class="keyword">=</span> <span class="keyword">(</span><span class="staexp">i</span> <span class="staexp">!=</span> <span class="staexp">0</span><span class="keyword">)</span></span>
<span class="keyword">stadef</span> <span class="staexp">b2i <span class="keyword">=</span> <span class="staexp">bool2int</span></span> <span class="keyword">and</span> <span class="staexp">i2b <span class="keyword">=</span> <span class="staexp">int2bool</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
** HX: [char] = [int8]
** HX-2012-06-12: removed
//
stacst
int_of_char: char -&gt; int = "ext#"
stacst
char_of_int : int -&gt; char = "ext#"
//
stadef c2i = int_of_char and i2c = char_of_int
//
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
** HX: pointer &lt;-&gt; integer
*)</span>
<span class="staexp"><span class="keyword">stacst</span> int_of_addr<span class="keyword">:</span> addr <span class="keyword">-&gt;</span> int</span> <span class="keyword">=</span> "ext#"
<span class="staexp"><span class="keyword">stacst</span> addr_of_int<span class="keyword">:</span> int <span class="keyword">-&gt;</span> addr</span> <span class="keyword">=</span> "ext#"
<span class="keyword">stadef</span> <span class="staexp">a2i <span class="keyword">=</span> <span class="staexp">int_of_addr</span></span> <span class="keyword">and</span> <span class="staexp">i2a <span class="keyword">=</span> <span class="staexp">addr_of_int</span></span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="keyword">stadef</span> <span class="staexp">pow2_7 <span class="keyword">=</span> <span class="staexp">128</span></span>
<span class="keyword">stadef</span> <span class="staexp">pow2_8 <span class="keyword">=</span> <span class="staexp">256</span></span>
<span class="keyword">stadef</span> <span class="staexp">i2u_int8 <span class="keyword">(</span><span class="staexp">i<span class="keyword">:</span>int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">ifint</span> <span class="keyword">(</span><span class="staexp">i</span> <span class="staexp">&gt;=</span> <span class="staexp">0</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">,</span> <span class="staexp">i</span><span class="staexp">+</span><span class="staexp">pow2_8</span><span class="keyword">)</span></span>
<span class="keyword">stadef</span> <span class="staexp">i2u8 <span class="keyword">=</span> <span class="staexp">i2u_int8</span></span>
<span class="keyword">stadef</span> <span class="staexp">u2i_int8 <span class="keyword">(</span><span class="staexp">u<span class="keyword">:</span>int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">ifint</span> <span class="keyword">(</span><span class="staexp">u</span> <span class="staexp"><span class="keyword">&lt;</span></span> <span class="staexp">pow2_7</span><span class="keyword">,</span> <span class="staexp">u</span><span class="keyword">,</span> <span class="staexp">u</span><span class="staexp">-</span><span class="staexp">pow2_8</span><span class="keyword">)</span></span>
<span class="keyword">stadef</span> <span class="staexp">u2i8 <span class="keyword">=</span> <span class="staexp">u2i_int8</span></span>
<span class="comment">//</span>
<span class="keyword">stadef</span> <span class="staexp">pow2_15 <span class="keyword">=</span> <span class="staexp">32768</span></span>
<span class="keyword">stadef</span> <span class="staexp">pow2_16 <span class="keyword">=</span> <span class="staexp">65536</span></span>
<span class="keyword">stadef</span> <span class="staexp">i2u_int16 <span class="keyword">(</span><span class="staexp">i<span class="keyword">:</span>int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">ifint</span> <span class="keyword">(</span><span class="staexp">i</span> <span class="staexp">&gt;=</span> <span class="staexp">0</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">,</span> <span class="staexp">i</span><span class="staexp">+</span><span class="staexp">pow2_16</span><span class="keyword">)</span></span>
<span class="keyword">stadef</span> <span class="staexp">i2u16 <span class="keyword">=</span> <span class="staexp">i2u_int16</span></span>
<span class="keyword">stadef</span> <span class="staexp">u2i_int16 <span class="keyword">(</span><span class="staexp">u<span class="keyword">:</span>int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">ifint</span> <span class="keyword">(</span><span class="staexp">u</span> <span class="staexp"><span class="keyword">&lt;</span></span> <span class="staexp">pow2_15</span><span class="keyword">,</span> <span class="staexp">u</span><span class="keyword">,</span> <span class="staexp">u</span><span class="staexp">-</span><span class="staexp">pow2_16</span><span class="keyword">)</span></span>
<span class="keyword">stadef</span> <span class="staexp">u2i16 <span class="keyword">=</span> <span class="staexp">u2i_int16</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">stadef</span> <span class="staexp">pow2_32 <span class="keyword">=</span> <span class="staexp">0x100000000</span></span>
<span class="keyword">stadef</span> <span class="staexp">pow2_64 <span class="keyword">=</span> <span class="staexp">0x10000000000000000</span></span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">stacst</span>
null_addr <span class="keyword">:</span> addr</span> <span class="keyword">=</span> "ext#"
<span class="keyword">stadef</span>
<span class="staexp">null <span class="keyword">=</span> <span class="staexp">null_addr</span></span> <span class="keyword">and</span> <span class="staexp">NULL <span class="keyword">=</span> <span class="staexp">null_addr</span></span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">stacst</span> add_addr_int
  <span class="keyword">:</span> <span class="keyword">(</span>addr<span class="keyword">,</span> int<span class="keyword">)</span> <span class="keyword">-&gt;</span> addr</span> <span class="keyword">=</span> "ext#"
<span class="staexp"><span class="keyword">stacst</span> sub_addr_int
  <span class="keyword">:</span> <span class="keyword">(</span>addr<span class="keyword">,</span> int<span class="keyword">)</span> <span class="keyword">-&gt;</span> addr</span> <span class="keyword">=</span> "ext#"
<span class="staexp"><span class="keyword">stacst</span> sub_addr_addr
  <span class="keyword">:</span> <span class="keyword">(</span>addr<span class="keyword">,</span> addr<span class="keyword">)</span> <span class="keyword">-&gt;</span> int</span> <span class="keyword">=</span> "ext#"
<span class="comment">//</span>
<span class="keyword">stadef</span> <span class="staexp">+ <span class="keyword">=</span> <span class="staexp">add_addr_int</span></span>
<span class="keyword">stadef</span> <span class="staexp">- <span class="keyword">=</span> <span class="staexp">sub_addr_int</span></span>
<span class="keyword">stadef</span> <span class="staexp">- <span class="keyword">=</span> <span class="staexp">sub_addr_addr</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">stacst</span> lt_addr_addr
  <span class="keyword">:</span> <span class="keyword">(</span>addr<span class="keyword">,</span> addr<span class="keyword">)</span> <span class="keyword">-&gt;</span> bool</span> <span class="keyword">=</span> "ext#"
<span class="staexp"><span class="keyword">stacst</span> lte_addr_addr
  <span class="keyword">:</span> <span class="keyword">(</span>addr<span class="keyword">,</span> addr<span class="keyword">)</span> <span class="keyword">-&gt;</span> bool</span> <span class="keyword">=</span> "ext#"
<span class="comment">//</span>
<span class="keyword">stadef</span> <span class="staexp"><span class="keyword">&lt;</span> <span class="keyword">=</span> <span class="staexp">lt_addr_addr</span></span>
<span class="keyword">stadef</span> <span class="staexp">&lt;= <span class="keyword">=</span> <span class="staexp">lte_addr_addr</span></span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">stacst</span> gt_addr_addr
  <span class="keyword">:</span> <span class="keyword">(</span>addr<span class="keyword">,</span> addr<span class="keyword">)</span> <span class="keyword">-&gt;</span> bool</span> <span class="keyword">=</span> "ext#"
<span class="staexp"><span class="keyword">stacst</span> gte_addr_addr
  <span class="keyword">:</span> <span class="keyword">(</span>addr<span class="keyword">,</span> addr<span class="keyword">)</span> <span class="keyword">-&gt;</span> bool</span> <span class="keyword">=</span> "ext#"
<span class="comment">//</span>
<span class="keyword">stadef</span> <span class="staexp"><span class="keyword">&gt;</span> <span class="keyword">=</span> <span class="staexp">gt_addr_addr</span></span>
<span class="keyword">stadef</span> <span class="staexp">&gt;= <span class="keyword">=</span> <span class="staexp">gte_addr_addr</span></span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">stacst</span> eq_addr_addr
  <span class="keyword">:</span> <span class="keyword">(</span>addr<span class="keyword">,</span> addr<span class="keyword">)</span> <span class="keyword">-&gt;</span> bool</span> <span class="keyword">=</span> "ext#"
<span class="staexp"><span class="keyword">stacst</span> neq_addr_addr
  <span class="keyword">:</span> <span class="keyword">(</span>addr<span class="keyword">,</span> addr<span class="keyword">)</span> <span class="keyword">-&gt;</span> bool</span> <span class="keyword">=</span> "ext#"
<span class="comment">//</span>
<span class="keyword">stadef</span> <span class="staexp">== <span class="keyword">=</span> <span class="staexp">eq_addr_addr</span></span>
<span class="keyword">stadef</span> <span class="staexp">!= <span class="keyword">=</span> <span class="staexp">neq_addr_addr</span></span>
<span class="keyword">stadef</span> <span class="staexp">&lt;&gt; <span class="keyword">=</span> <span class="staexp">neq_addr_addr</span></span> <span class="comment">(* for backward compatibility *)</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">// HX-2013-09:</span>
<span class="comment">// for supporting inheritance in OOP</span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">stacst</span>
lte_cls_cls <span class="keyword">:</span> <span class="keyword">(</span>cls<span class="keyword">,</span> cls<span class="keyword">)</span> <span class="keyword">-&gt;</span> bool</span> <span class="keyword">=</span> "ext#"
<span class="staexp"><span class="keyword">stacst</span>
gte_cls_cls <span class="keyword">:</span> <span class="keyword">(</span>cls<span class="keyword">,</span> cls<span class="keyword">)</span> <span class="keyword">-&gt;</span> bool</span> <span class="keyword">=</span> "ext#"
<span class="comment">//</span>
<span class="keyword">stadef</span> <span class="staexp">&lt;= <span class="keyword">=</span> <span class="staexp">lte_cls_cls</span></span> <span class="keyword">and</span> <span class="staexp">&gt;= <span class="keyword">=</span> <span class="staexp">gte_cls_cls</span></span>
<span class="comment">//</span>
<span class="keyword">stadef</span>
<span class="staexp">lterel_cls_cls
<span class="keyword">(</span>
  <span class="staexp">c1<span class="keyword">:</span> cls</span><span class="keyword">,</span> <span class="staexp">c2<span class="keyword">:</span> cls</span><span class="keyword">,</span> <span class="staexp">lterel_cls_cls_res<span class="keyword">:</span> bool</span>
<span class="keyword">)</span> <span class="keyword">:</span> bool <span class="keyword">=</span> <span class="staexp">lterel_cls_cls_res</span></span> <span class="comment">// end-of-stadef</span>
<span class="keyword">stadef</span>
<span class="staexp">gterel_cls_cls
<span class="keyword">(</span>
  <span class="staexp">c1<span class="keyword">:</span> cls</span><span class="keyword">,</span> <span class="staexp">c2<span class="keyword">:</span> cls</span><span class="keyword">,</span> <span class="staexp">gterel_cls_cls_res<span class="keyword">:</span> bool</span>
<span class="keyword">)</span> <span class="keyword">:</span> bool <span class="keyword">=</span> <span class="staexp">gterel_cls_cls_res</span></span> <span class="comment">// end-of-stadef</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">// HX: this is a special constant!</span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">stacst</span>
sizeof_t0ype_int <span class="keyword">:</span> <span class="keyword">t@ype</span> <span class="keyword">-&gt;</span> int</span> <span class="keyword">=</span> "ext#"
<span class="keyword">stadef</span>
<span class="staexp">sizeof<span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span><span class="keyword">viewt@ype</span></span><span class="keyword">)</span><span class="keyword">:</span> int <span class="keyword">=</span> <span class="staexp">sizeof_t0ype_int</span> <span class="keyword">(</span><span class="staexp">a</span><span class="staexp">?</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="staexp"><span class="keyword">sortdef</span> nat <span class="keyword">=</span> <span class="keyword">{</span> i<span class="keyword">:</span>int <span class="keyword">|</span> i &gt;= 0 <span class="keyword">}</span></span> <span class="comment">// natural numbers</span>
<span class="staexp"><span class="keyword">sortdef</span> pos <span class="keyword">=</span> <span class="keyword">{</span> i<span class="keyword">:</span>int <span class="keyword">|</span> i <span class="keyword">&gt;</span> 0 <span class="keyword">}</span></span>
<span class="staexp"><span class="keyword">sortdef</span> neg <span class="keyword">=</span> <span class="keyword">{</span> i<span class="keyword">:</span>int <span class="keyword">|</span> i <span class="keyword">&lt;</span> 0 <span class="keyword">}</span></span>
<span class="staexp"><span class="keyword">sortdef</span> npos <span class="keyword">=</span> <span class="keyword">{</span> i<span class="keyword">:</span>int <span class="keyword">|</span> i &lt;= 0 <span class="keyword">}</span></span> <span class="comment">// non-positive integers</span>

<span class="staexp"><span class="keyword">sortdef</span> nat1 <span class="keyword">=</span> <span class="keyword">{</span> n<span class="keyword">:</span>nat <span class="keyword">|</span> n <span class="keyword">&lt;</span> 1 <span class="keyword">}</span></span> <span class="comment">// for 0</span>
<span class="staexp"><span class="keyword">sortdef</span> nat2 <span class="keyword">=</span> <span class="keyword">{</span> n<span class="keyword">:</span>nat <span class="keyword">|</span> n <span class="keyword">&lt;</span> 2 <span class="keyword">}</span></span> <span class="comment">// for 0, 1</span>
<span class="staexp"><span class="keyword">sortdef</span> nat3 <span class="keyword">=</span> <span class="keyword">{</span> n<span class="keyword">:</span>nat <span class="keyword">|</span> n <span class="keyword">&lt;</span> 3 <span class="keyword">}</span></span> <span class="comment">// for 0, 1, 2</span>
<span class="staexp"><span class="keyword">sortdef</span> nat4 <span class="keyword">=</span> <span class="keyword">{</span> n<span class="keyword">:</span>nat <span class="keyword">|</span> n <span class="keyword">&lt;</span> 4 <span class="keyword">}</span></span> <span class="comment">// for 0, 1, 2, 3</span>

<span class="staexp"><span class="keyword">sortdef</span> sgn <span class="keyword">=</span> <span class="keyword">{</span> i<span class="keyword">:</span>int <span class="keyword">|</span> <span class="keyword">~</span>1 &lt;= i<span class="keyword">;</span> i &lt;= 1 <span class="keyword">}</span></span>

<span class="staexp"><span class="keyword">sortdef</span> agz <span class="keyword">=</span> <span class="keyword">{</span> l<span class="keyword">:</span>addr <span class="keyword">|</span> l <span class="keyword">&gt;</span> null <span class="keyword">}</span></span>
<span class="staexp"><span class="keyword">sortdef</span> agez <span class="keyword">=</span> <span class="keyword">{</span> l<span class="keyword">:</span>addr <span class="keyword">|</span> l &gt;= null <span class="keyword">}</span></span>
<span class="staexp"><span class="keyword">sortdef</span> alez <span class="keyword">=</span> <span class="keyword">{</span> l<span class="keyword">:</span>addr <span class="keyword">|</span> l &lt;= null <span class="keyword">}</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="neuexp"><span class="keyword">#define</span> CHAR_MAX 127</span>
<span class="neuexp"><span class="keyword">#define</span> CHAR_MIN <span class="keyword">~</span>128</span>
<span class="neuexp"><span class="keyword">#define</span> UCHAR_MAX 0xFF</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">stacst</span> effnil <span class="keyword">:</span> eff</span> <span class="comment">// nothing</span>
<span class="staexp"><span class="keyword">stacst</span> effall <span class="keyword">:</span> eff</span> <span class="comment">// everything</span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">stacst</span> effntm <span class="keyword">:</span> eff</span> <span class="comment">// nonterm</span>
<span class="staexp"><span class="keyword">stacst</span> effexn <span class="keyword">:</span> eff</span> <span class="comment">// exception</span>
<span class="staexp"><span class="keyword">stacst</span> effref <span class="keyword">:</span> eff</span> <span class="comment">// reference</span>
<span class="staexp"><span class="keyword">stacst</span> effwrt <span class="keyword">:</span> eff</span> <span class="comment">// writeover</span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">stacst</span> add_eff_eff <span class="keyword">:</span> <span class="keyword">(</span>eff<span class="keyword">,</span> eff<span class="keyword">)</span> <span class="keyword">-&gt;</span> eff</span>
<span class="keyword">stadef</span> <span class="staexp">+ <span class="keyword">=</span> <span class="staexp">add_eff_eff</span></span> <span class="comment">// union of effsets</span>
<span class="staexp"><span class="keyword">stacst</span> sub_eff_eff <span class="keyword">:</span> <span class="keyword">(</span>eff<span class="keyword">,</span> eff<span class="keyword">)</span> <span class="keyword">-&gt;</span> eff</span>
<span class="keyword">stadef</span> <span class="staexp">- <span class="keyword">=</span> <span class="staexp">add_eff_eff</span></span> <span class="comment">// difference of effsets</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">// HX: some overloaded symbols</span>
<span class="comment">//</span>
<span class="neuexp"><span class="keyword">symintr</span> <span class="keyword">~</span> not</span>
<span class="comment">(*
symintr &amp;&amp; || // macros
*)</span>
<span class="neuexp"><span class="keyword">symintr</span> lnot lor lxor land</span>
<span class="neuexp"><span class="keyword">symintr</span> + - * / % mod ndiv nmod</span>
<span class="neuexp"><span class="keyword">symintr</span> <span class="keyword">&lt;</span> &lt;= <span class="keyword">&gt;</span> &gt;= <span class="keyword">=</span> == != &lt;&gt; compare</span>
<span class="neuexp"><span class="keyword">symintr</span> isltz isltez isgtz isgtez iseqz isneqz</span>
<span class="neuexp"><span class="keyword">symintr</span> neg abs max min</span>
<span class="neuexp"><span class="keyword">symintr</span> succ pred half double</span>
<span class="neuexp"><span class="keyword">symintr</span> square sqrt cube cbrt pow</span>
<span class="comment">//</span>
<span class="neuexp"><span class="keyword">symintr</span> <span class="keyword">!</span> <span class="keyword">[</span><span class="keyword">]</span></span> <span class="comment">// deref subscript</span>
<span class="neuexp"><span class="keyword">symintr</span> &lt;&lt; &gt;&gt;</span> <span class="comment">// for L/R-shifting</span>
<span class="comment">//</span>
<span class="neuexp"><span class="keyword">symintr</span> inc dec</span>
<span class="neuexp"><span class="keyword">symintr</span> ++ --</span> <span class="comment">// inc and dec</span>
<span class="neuexp"><span class="keyword">symintr</span> get set exch</span>
<span class="neuexp"><span class="keyword">symintr</span> getinc setinc exchinc</span>
<span class="neuexp"><span class="keyword">symintr</span> decget decset decexch</span>
<span class="neuexp"><span class="keyword">symintr</span> !++ --!</span> <span class="comment">// getinc and decget</span>
<span class="neuexp"><span class="keyword">symintr</span> =++ --=</span> <span class="comment">// setinc and decset</span>
<span class="comment">//</span>
<span class="neuexp"><span class="keyword">symintr</span> assert</span>
<span class="comment">//</span>
<span class="neuexp"><span class="keyword">symintr</span> encode decode</span>
<span class="comment">//</span>
<span class="neuexp"><span class="keyword">symintr</span> g0ofg1 g1ofg0</span> <span class="comment">// casting: dpt &lt;-&gt; ndpt</span>
<span class="neuexp"><span class="keyword">symintr</span> ptrcast</span> <span class="comment">(* for functions taking the address of a boxed val *)</span>
<span class="comment">//</span>
<span class="neuexp"><span class="keyword">symintr</span> copy free length</span>
<span class="comment">//</span>
<span class="neuexp"><span class="keyword">symintr</span> print prerr fprint gprint</span>
<span class="neuexp"><span class="keyword">symintr</span> println prerrln fprintln gprintln</span>
<span class="comment">//</span>
<span class="comment">(*
//
symintr forall
symintr iforall
//
symintr foreach
symintr foreach2
symintr iforeach
symintr rforeach
//
*)</span>
<span class="comment">//</span>
<span class="neuexp"><span class="keyword">symintr</span> ofstring ofstrptr</span>
<span class="neuexp"><span class="keyword">symintr</span> tostring tostrptr</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">// HX-2014-02:</span>
<span class="comment">// for dot-notation overloading</span>
<span class="comment">//</span>
<span class="neuexp"><span class="keyword">symintr</span> <span class="keyword">.</span>size</span>
<span class="neuexp"><span class="keyword">symintr</span> <span class="keyword">.</span>len <span class="keyword">.</span>length</span>
<span class="neuexp"><span class="keyword">symintr</span> <span class="keyword">.</span>get <span class="keyword">.</span>set <span class="keyword">.</span>exch</span>
<span class="neuexp"><span class="keyword">symintr</span> <span class="keyword">.</span>nrow <span class="keyword">.</span>ncol</span>
<span class="neuexp"><span class="keyword">symintr</span> <span class="keyword">.</span>head <span class="keyword">.</span>tail</span>
<span class="neuexp"><span class="keyword">symintr</span> <span class="keyword">.</span>next <span class="keyword">.</span>prev</span>
<span class="neuexp"><span class="keyword">symintr</span> <span class="keyword">.</span>init <span class="keyword">.</span>last</span>
<span class="neuexp"><span class="keyword">symintr</span> <span class="keyword">.</span>eval</span> <span class="comment">// HX: convention: using "!"</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">// HX-2012-05-23: for template args</span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">abstype</span>
atstkind_type<span class="keyword">(</span>tk<span class="keyword">:</span> tkind<span class="keyword">)</span></span>
<span class="staexp"><span class="keyword">abst@ype</span>
atstkind_t0ype<span class="keyword">(</span>tk<span class="keyword">:</span> tkind<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">typedef</span>
<span class="staexp">tkind_type<span class="keyword">(</span><span class="staexp">tk<span class="keyword">:</span>tkind</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">atstkind_type</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span>
<span class="staexp">tkind_t0ype<span class="keyword">(</span><span class="staexp">tk<span class="keyword">:</span>tkind</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">atstkind_t0ype</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">absview</span> <span class="comment">// S2Eat</span>
at_vt0ype_addr_view<span class="keyword">(</span>a<span class="keyword">:</span><span class="keyword">vt@ype+</span><span class="keyword">,</span> l<span class="keyword">:</span>addr<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">viewdef</span> <span class="staexp"><span class="keyword">@</span> <span class="comment">// HX: @ is infix</span>
  <span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span><span class="keyword">vt@ype</span></span><span class="keyword">,</span> <span class="staexp">l<span class="keyword">:</span>addr</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">at_vt0ype_addr_view</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">abst@ype</span> clo_t0ype_t0ype<span class="keyword">(</span>a<span class="keyword">:</span><span class="keyword">t@ype</span><span class="keyword">)</span> <span class="keyword">=</span> a</span>
<span class="staexp"><span class="keyword">absvt@ype</span> clo_vt0ype_vt0ype<span class="keyword">(</span>a<span class="keyword">:</span><span class="keyword">vt@ype</span><span class="keyword">)</span> <span class="keyword">=</span> a</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">(*
absview
read_view_int_int_view
  (v:view, stamp:int, n:int)
stadef
READ = read_view_int_int_view
viewdef
READ (v:view) = [s,n:int] READ (v, s, n)
stadef RD = READ
//
absview
readout_view_int_view (v:view, stamp:int)
stadef
READOUT = readout_view_int_view
viewdef
READOUT (v:view) = [s:int] READOUT (v, s)
//
absvt@ype
read_vt0ype_int_int_vt0ype
  (a:vt@ype, stamp:int, n:int) = a
stadef
READ = read_vt0ype_int_int_vt0ype
vtypedef
READ (a:vt@ype) = [s,n:int] READ (a, s, n)
stadef RD = READ
//
absvt@ype
readout_vt0ype_int_vt0ype
  (a:vt@ype, stamp: int) = a
stadef
READOUT = readout_vt0ype_int_vt0ype
vtypedef
READOUT (a:vt@ype) = [s:int] READOUT (a, s)
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
absvt@ype
write_vt0ype_vt0ype(a: vt@ype) = a
vtypedef
WRITE(a:vt@ype) = write_vt0ype_vt0ype (a)
stadef WR = WRITE
*)</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="keyword">vtypedef</span> <span class="staexp">READ <span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span><span class="keyword">vt@ype</span></span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">a</span></span> <span class="comment">// HX: used as a comment</span>
<span class="keyword">vtypedef</span> <span class="staexp">WRITE <span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span><span class="keyword">vt@ype</span></span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">a</span></span> <span class="comment">// HX: used as a comment (rarely)</span>
<span class="comment">//</span>
<span class="comment">(*
vtypedef SHARED (a:vt@ype) = a // HX: used as a comment
vtypedef NSHARED (a:vt@ype) = a // HX: used as a comment (rarely)
*)</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">absprop</span> invar_prop_prop <span class="keyword">(</span>a<span class="keyword">:</span>prop<span class="keyword">)</span></span>
<span class="staexp"><span class="keyword">absview</span> invar_view_view <span class="keyword">(</span>a<span class="keyword">:</span>view<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">abst@ype</span> <span class="comment">// S2Einvar</span>
invar_t0ype_t0ype <span class="keyword">(</span>a<span class="keyword">:</span><span class="keyword">t@ype</span><span class="keyword">)</span> <span class="keyword">=</span> a</span>
<span class="staexp"><span class="keyword">absvt@ype</span> <span class="comment">// S2Einvar</span>
invar_vt0ype_vt0ype <span class="keyword">(</span>a<span class="keyword">:</span><span class="keyword">vt@ype</span><span class="keyword">)</span> <span class="keyword">=</span> a</span>
<span class="comment">//</span>
<span class="comment">// HX: this order is significant</span>
<span class="comment">// </span>
<span class="keyword">viewdef</span>
<span class="staexp">INV <span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span> view</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">invar_view_view</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="keyword">propdef</span>
<span class="staexp">INV <span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span> prop</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">invar_prop_prop</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">vtypedef</span> <span class="staexp">INV
  <span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span><span class="keyword">vt@ype</span></span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">invar_vt0ype_vt0ype</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">vtypedef</span>
<span class="staexp">INV <span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span> <span class="keyword">t@ype</span></span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">invar_t0ype_t0ype</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">(*
//
absprop optarg_prop_prop (a:prop)
absview optarg_view_view (a:view)
//
abst@ype
optarg_t0ype_t0ype (a:t@ype) = a
absvt@ype
optarg_vt0ype_vt0ype (a:vt@ype) = a
//
// HX: this order is significant
// 
viewdef
OPT (a: view) = optarg_view_view (a)
propdef
OPT (a: prop) = optarg_prop_prop (a)
//
vtypedef OPT
  (a:vt@ype) = optarg_vt0ype_vt0ype (a)
//
vtypedef
OPT (a: t@ype) = optarg_t0ype_t0ype (a)
//
*)</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">abst@ype</span>
stamped_t0ype <span class="keyword">(</span>a<span class="keyword">:</span><span class="keyword">t@ype</span><span class="keyword">,</span> int<span class="keyword">)</span> <span class="keyword">=</span> a</span>
<span class="keyword">stadef</span> <span class="staexp">stamped_t <span class="keyword">=</span> <span class="staexp">stamped_t0ype</span></span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">absvt@ype</span>
stamped_vt0ype <span class="keyword">(</span>a<span class="keyword">:</span><span class="keyword">vt@ype</span><span class="keyword">,</span> int<span class="keyword">)</span> <span class="keyword">=</span> a</span>
<span class="keyword">stadef</span> <span class="staexp">stamped_vt <span class="keyword">=</span> <span class="staexp">stamped_vt0ype</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">absview</span>
vcopyenv_view_view <span class="keyword">(</span>v<span class="keyword">:</span>view<span class="keyword">)</span></span>
<span class="keyword">stadef</span> <span class="staexp">vcopyenv_v <span class="keyword">=</span> <span class="staexp">vcopyenv_view_view</span></span>
<span class="staexp"><span class="keyword">absvt@ype</span>
vcopyenv_vt0ype_vt0ype <span class="keyword">(</span>vt<span class="keyword">:</span> <span class="keyword">vt0ype</span><span class="keyword">)</span> <span class="keyword">=</span> vt</span>
<span class="keyword">stadef</span> <span class="staexp">vcopyenv_vt <span class="keyword">=</span> <span class="staexp">vcopyenv_vt0ype_vt0ype</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">#if</span> <span class="neuexp">VERBOSE_PRELUDE</span> <span class="keyword">#then</span>
<span class="neuexp"><span class="keyword">#print</span> "Loading [basics_pre.sats] finishes!\n"</span>
<span class="keyword">#endif</span> <span class="comment">// end of [VERBOSE_PRELUDE]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* end of [basics_pre.sats] *)</span>
</pre>
<pre class="patsyntax">
<span class="comment">(***********************************************************************)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(*                         Applied Type System                         *)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(***********************************************************************)</span>

<span class="comment">(*
** ATS/Postiats - Unleashing the Potential of Types!
** Copyright (C) 2010-2013 Hongwei Xi, ATS Trustful Software, Inc.
** All rights reserved
**
** ATS is free software;  you can  redistribute it and/or modify it under
** the terms of  the GNU GENERAL PUBLIC LICENSE (GPL) as published by the
** Free Software Foundation; either version 3, or (at  your  option)  any
** later version.
**
** ATS is distributed in the hope that it will be useful, but WITHOUT ANY
** WARRANTY; without  even  the  implied  warranty  of MERCHANTABILITY or
** FITNESS FOR A PARTICULAR PURPOSE.  See the  GNU General Public License
** for more details.
**
** You  should  have  received  a  copy of the GNU General Public License
** along  with  ATS;  see the  file COPYING.  If not, please write to the
** Free Software Foundation,  51 Franklin Street, Fifth Floor, Boston, MA
** 02110-1301, USA.
*)</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">// Author of the file:</span>
<span class="comment">// Hongwei Xi (gmhwxiATgmailDOTcom)</span>
<span class="comment">// Start Time: September, 2011</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="neuexp"><span class="keyword">#include</span> "prelude/params.hats"</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">#if</span> <span class="neuexp">VERBOSE_PRELUDE</span> <span class="keyword">#then</span>
<span class="neuexp"><span class="keyword">#print</span> "Loading [basics_sta.sats] starts!\n"</span>
<span class="keyword">#endif</span> <span class="comment">// end of [VERBOSE_PRELUDE]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="neuexp"><span class="keyword">#define</span> RD<span class="keyword">(</span>x<span class="keyword">)</span> x</span> <span class="comment">// for commenting: read-only</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">(*
//
// HX-2012-05-24:
// the following two styles are equivalent:
//
stadef
bool_kind = $extkind"atstype_bool"
tkindef bool_kind = "atstype_bool"
*)</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">tkindef</span> bool_kind <span class="keyword">=</span> "atstype_bool"</span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">abst@ype</span>
bool_t0ype <span class="keyword">=</span> tkind_t0ype <span class="keyword">(</span>bool_kind<span class="keyword">)</span></span>
<span class="keyword">stadef</span> <span class="staexp">bool <span class="keyword">=</span> <span class="staexp">bool_t0ype</span></span> <span class="comment">// shorthand</span>
<span class="staexp"><span class="keyword">abst@ype</span>
bool_bool_t0ype <span class="keyword">(</span>b<span class="keyword">:</span> bool<span class="keyword">)</span> <span class="keyword">=</span> bool_t0ype</span>
<span class="keyword">stadef</span> <span class="staexp">bool <span class="keyword">=</span> <span class="staexp">bool_bool_t0ype</span></span> <span class="comment">// shorthand</span>
<span class="comment">//</span>
<span class="keyword">typedef</span> <span class="staexp">Bool <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>b<span class="keyword">:</span>bool<span class="keyword">]</span></span> <span class="staexp">bool</span> <span class="keyword">(</span><span class="staexp">b</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span> <span class="staexp">boolLte
  <span class="keyword">(</span><span class="staexp">b1<span class="keyword">:</span>bool</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>b2<span class="keyword">:</span>bool<span class="keyword">]</span></span> <span class="staexp">bool</span> <span class="keyword">(</span><span class="staexp">b2</span> <span class="staexp">&lt;=</span> <span class="staexp">b1</span><span class="keyword">)</span></span> <span class="comment">// b2 -&gt; b1</span>
<span class="keyword">typedef</span> <span class="staexp">boolGte
  <span class="keyword">(</span><span class="staexp">b1<span class="keyword">:</span>bool</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>b2<span class="keyword">:</span>bool<span class="keyword">]</span></span> <span class="staexp">bool</span> <span class="keyword">(</span><span class="staexp">b2</span> <span class="staexp">&gt;=</span> <span class="staexp">b1</span><span class="keyword">)</span></span> <span class="comment">// b1 -&gt; b2</span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">abst@ype</span> atstype_bool</span> <span class="comment">// HX-2013-09: for internal use</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="staexp"><span class="keyword">tkindef</span>
byte_kind <span class="keyword">=</span> "atstype_byte"</span>
<span class="staexp"><span class="keyword">abst@ype</span>
byte_t0ype <span class="keyword">=</span> tkind_t0ype <span class="keyword">(</span>byte_kind<span class="keyword">)</span></span>
<span class="keyword">stadef</span> <span class="staexp">byte <span class="keyword">=</span> <span class="staexp">byte_t0ype</span></span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">// char is signed</span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">sortdef</span> int8 <span class="keyword">=</span> <span class="keyword">{</span>
  i<span class="keyword">:</span>int <span class="keyword">|</span> <span class="keyword">~</span>128 &lt;= i<span class="keyword">;</span> i <span class="keyword">&lt;</span> 128
<span class="keyword">}</span></span> <span class="comment">// end of [int8]</span>
<span class="staexp"><span class="keyword">sortdef</span> uint8 <span class="keyword">=</span>
  <span class="keyword">{</span> i<span class="keyword">:</span>int <span class="keyword">|</span> 0 &lt;= i<span class="keyword">;</span> i <span class="keyword">&lt;</span> 256 <span class="keyword">}</span></span>
<span class="comment">// end of [uint8]</span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">tkindef</span> char_kind <span class="keyword">=</span> "atstype_char"</span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">abst@ype</span>
char_t0ype <span class="keyword">=</span> tkind_t0ype <span class="keyword">(</span>char_kind<span class="keyword">)</span></span>
<span class="keyword">stadef</span> <span class="staexp">char <span class="keyword">=</span> <span class="staexp">char_t0ype</span></span> <span class="comment">// shorthand</span>
<span class="staexp"><span class="keyword">abst@ype</span>
char_int_t0ype <span class="keyword">(</span>c<span class="keyword">:</span>int<span class="keyword">)</span> <span class="keyword">=</span> char_t0ype</span>
<span class="keyword">stadef</span> <span class="staexp">char <span class="keyword">=</span> <span class="staexp">char_int_t0ype</span></span> <span class="comment">// shorthand</span>
<span class="keyword">typedef</span> <span class="staexp">Char <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>c<span class="keyword">:</span>int8<span class="keyword">]</span></span> <span class="staexp">char</span> <span class="keyword">(</span><span class="staexp">c</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span> <span class="staexp">charNZ <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>c<span class="keyword">:</span>int8 <span class="keyword">|</span> c != 0<span class="keyword">]</span></span> <span class="staexp">char</span> <span class="keyword">(</span><span class="staexp">c</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">// signed characters</span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">tkindef</span> schar_kind <span class="keyword">=</span> "atstype_schar"</span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">abst@ype</span>
schar_t0ype <span class="keyword">=</span> tkind_t0ype <span class="keyword">(</span>schar_kind<span class="keyword">)</span></span>
<span class="keyword">stadef</span> <span class="staexp">schar <span class="keyword">=</span> <span class="staexp">schar_t0ype</span></span> <span class="comment">// shorthand</span>
<span class="staexp"><span class="keyword">abst@ype</span>
schar_int_t0ype <span class="keyword">(</span>c<span class="keyword">:</span>int<span class="keyword">)</span> <span class="keyword">=</span> schar_t0ype</span>
<span class="keyword">stadef</span> <span class="staexp">schar <span class="keyword">=</span> <span class="staexp">schar_int_t0ype</span></span> <span class="comment">// shorthand</span>
<span class="keyword">typedef</span> <span class="staexp">sChar <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>c<span class="keyword">:</span>int8<span class="keyword">]</span></span> <span class="staexp">schar</span> <span class="keyword">(</span><span class="staexp">c</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">// unsigned characters</span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">tkindef</span> uchar_kind <span class="keyword">=</span> "atstype_uchar"</span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">abst@ype</span>
uchar_t0ype <span class="keyword">=</span> tkind_t0ype <span class="keyword">(</span>uchar_kind<span class="keyword">)</span></span>
<span class="keyword">stadef</span> <span class="staexp">uchar <span class="keyword">=</span> <span class="staexp">uchar_t0ype</span></span> <span class="comment">// shorthand</span>
<span class="staexp"><span class="keyword">abst@ype</span>
uchar_int_t0ype <span class="keyword">(</span>c<span class="keyword">:</span>int<span class="keyword">)</span> <span class="keyword">=</span> uchar_t0ype</span>
<span class="keyword">stadef</span> <span class="staexp">uchar <span class="keyword">=</span> <span class="staexp">uchar_int_t0ype</span></span> <span class="comment">// shorthand</span>
<span class="keyword">typedef</span> <span class="staexp">uChar <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>c<span class="keyword">:</span>uint8<span class="keyword">]</span></span> <span class="staexp">uchar</span> <span class="keyword">(</span><span class="staexp">c</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="staexp"><span class="keyword">sortdef</span> tk <span class="keyword">=</span> tkind</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">abst@ype</span>
g0int_t0ype <span class="keyword">(</span>tk<span class="keyword">:</span>tk<span class="keyword">)</span> <span class="keyword">=</span> tkind_t0ype <span class="keyword">(</span>tk<span class="keyword">)</span></span>
<span class="keyword">stadef</span> <span class="staexp">g0int <span class="keyword">=</span> <span class="staexp">g0int_t0ype</span></span> <span class="comment">// shorthand</span>
<span class="staexp"><span class="keyword">abst@ype</span>
g1int_int_t0ype <span class="keyword">(</span>tk<span class="keyword">:</span>tkind<span class="keyword">,</span> int<span class="keyword">)</span> <span class="keyword">=</span> g0int <span class="keyword">(</span>tk<span class="keyword">)</span></span>
<span class="keyword">stadef</span> <span class="staexp">g1int <span class="keyword">=</span> <span class="staexp">g1int_int_t0ype</span></span> <span class="comment">// shorthand</span>
<span class="comment">//</span>
<span class="keyword">typedef</span> <span class="staexp">g1int <span class="keyword">(</span><span class="staexp">tk<span class="keyword">:</span>tkind</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>i<span class="keyword">:</span>int<span class="keyword">]</span></span> <span class="staexp">g1int</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span> <span class="staexp">g1int0 <span class="keyword">(</span><span class="staexp">tk<span class="keyword">:</span>tkind</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>i<span class="keyword">:</span>int <span class="keyword">|</span> i &gt;= 0<span class="keyword">]</span></span> <span class="staexp">g1int</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span> <span class="staexp">g1int1 <span class="keyword">(</span><span class="staexp">tk<span class="keyword">:</span>tkind</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>i<span class="keyword">:</span>int <span class="keyword">|</span> i &gt;= 1<span class="keyword">]</span></span> <span class="staexp">g1int</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="keyword">typedef</span> <span class="staexp">g1intLt
  <span class="keyword">(</span><span class="staexp">tk<span class="keyword">:</span>tk</span><span class="keyword">,</span> <span class="staexp">n<span class="keyword">:</span>int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>i<span class="keyword">:</span>int <span class="keyword">|</span> i <span class="keyword">&lt;</span> n<span class="keyword">]</span></span> <span class="staexp">g1int</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span> <span class="staexp">g1intLte
  <span class="keyword">(</span><span class="staexp">tk<span class="keyword">:</span>tk</span><span class="keyword">,</span> <span class="staexp">n<span class="keyword">:</span>int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>i<span class="keyword">:</span>int <span class="keyword">|</span> i &lt;= n<span class="keyword">]</span></span> <span class="staexp">g1int</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span> <span class="staexp">g1intGt
  <span class="keyword">(</span><span class="staexp">tk<span class="keyword">:</span>tk</span><span class="keyword">,</span> <span class="staexp">n<span class="keyword">:</span>int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>i<span class="keyword">:</span>int <span class="keyword">|</span> i <span class="keyword">&gt;</span> n<span class="keyword">]</span></span> <span class="staexp">g1int</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span> <span class="staexp">g1intGte
  <span class="keyword">(</span><span class="staexp">tk<span class="keyword">:</span>tk</span><span class="keyword">,</span> <span class="staexp">n<span class="keyword">:</span>int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>i<span class="keyword">:</span>int <span class="keyword">|</span> i &gt;= n<span class="keyword">]</span></span> <span class="staexp">g1int</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span> <span class="staexp">g1intBtw
  <span class="keyword">(</span><span class="staexp">tk<span class="keyword">:</span>tk</span><span class="keyword">,</span> <span class="staexp">lb<span class="keyword">:</span>int</span><span class="keyword">,</span> <span class="staexp">ub<span class="keyword">:</span>int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>i<span class="keyword">:</span> int <span class="keyword">|</span> lb &lt;= i<span class="keyword">;</span> i <span class="keyword">&lt;</span> ub<span class="keyword">]</span></span> <span class="staexp">g1int</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span> <span class="staexp">g1intBtwe
  <span class="keyword">(</span><span class="staexp">tk<span class="keyword">:</span>tk</span><span class="keyword">,</span> <span class="staexp">lb<span class="keyword">:</span>int</span><span class="keyword">,</span> <span class="staexp">ub<span class="keyword">:</span>int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>i<span class="keyword">:</span> int <span class="keyword">|</span> lb &lt;= i<span class="keyword">;</span> i &lt;= ub<span class="keyword">]</span></span> <span class="staexp">g1int</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">abst@ype</span>
g0uint_t0ype <span class="keyword">(</span>tk<span class="keyword">:</span>tkind<span class="keyword">)</span> <span class="keyword">=</span> tkind_t0ype <span class="keyword">(</span>tk<span class="keyword">)</span></span>
<span class="keyword">stadef</span> <span class="staexp">g0uint <span class="keyword">=</span> <span class="staexp">g0uint_t0ype</span></span> <span class="comment">// shorthand</span>
<span class="staexp"><span class="keyword">abst@ype</span>
g1uint_int_t0ype <span class="keyword">(</span>tk<span class="keyword">:</span>tkind<span class="keyword">,</span> int<span class="keyword">)</span> <span class="keyword">=</span> g0uint <span class="keyword">(</span>tk<span class="keyword">)</span></span>
<span class="keyword">stadef</span> <span class="staexp">g1uint <span class="keyword">=</span> <span class="staexp">g1uint_int_t0ype</span></span> <span class="comment">// shorthand</span>
<span class="comment">//</span>
<span class="keyword">typedef</span> <span class="staexp">g1uint <span class="keyword">(</span><span class="staexp">tk<span class="keyword">:</span>tk</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>i<span class="keyword">:</span>int<span class="keyword">]</span></span> <span class="staexp">g1uint</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span> <span class="staexp">g1uint0 <span class="keyword">(</span><span class="staexp">tk<span class="keyword">:</span>tk</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>i<span class="keyword">:</span>int <span class="keyword">|</span> i &gt;= 0<span class="keyword">]</span></span> <span class="staexp">g1uint</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span> <span class="staexp">g1uint1 <span class="keyword">(</span><span class="staexp">tk<span class="keyword">:</span>tk</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>i<span class="keyword">:</span>int <span class="keyword">|</span> i &gt;= 1<span class="keyword">]</span></span> <span class="staexp">g1uint</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="keyword">typedef</span> <span class="staexp">g1uintLt
  <span class="keyword">(</span><span class="staexp">tk<span class="keyword">:</span>tk</span><span class="keyword">,</span> <span class="staexp">n<span class="keyword">:</span>int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>i<span class="keyword">:</span>nat <span class="keyword">|</span> i <span class="keyword">&lt;</span> n<span class="keyword">]</span></span> <span class="staexp">g1uint</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span> <span class="staexp">g1uintLte
  <span class="keyword">(</span><span class="staexp">tk<span class="keyword">:</span>tk</span><span class="keyword">,</span> <span class="staexp">n<span class="keyword">:</span>int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>i<span class="keyword">:</span>nat <span class="keyword">|</span> i &lt;= n<span class="keyword">]</span></span> <span class="staexp">g1uint</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span> <span class="staexp">g1uintGt
  <span class="keyword">(</span><span class="staexp">tk<span class="keyword">:</span>tk</span><span class="keyword">,</span> <span class="staexp">n<span class="keyword">:</span>int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>i<span class="keyword">:</span>int <span class="keyword">|</span> i <span class="keyword">&gt;</span> n<span class="keyword">]</span></span> <span class="staexp">g1uint</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span> <span class="staexp">g1uintGte
  <span class="keyword">(</span><span class="staexp">tk<span class="keyword">:</span>tk</span><span class="keyword">,</span> <span class="staexp">n<span class="keyword">:</span>int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>i<span class="keyword">:</span>int <span class="keyword">|</span> i &gt;= n<span class="keyword">]</span></span> <span class="staexp">g1uint</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span> <span class="staexp">g1uintBtw
  <span class="keyword">(</span><span class="staexp">tk<span class="keyword">:</span>tk</span><span class="keyword">,</span> <span class="staexp">lb<span class="keyword">:</span>int</span><span class="keyword">,</span> <span class="staexp">ub<span class="keyword">:</span>int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>i<span class="keyword">:</span> int <span class="keyword">|</span> lb &lt;= i<span class="keyword">;</span> i <span class="keyword">&lt;</span> ub<span class="keyword">]</span></span> <span class="staexp">g1uint</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span> <span class="staexp">g1uintBtwe
  <span class="keyword">(</span><span class="staexp">tk<span class="keyword">:</span>tk</span><span class="keyword">,</span> <span class="staexp">lb<span class="keyword">:</span>int</span><span class="keyword">,</span> <span class="staexp">ub<span class="keyword">:</span>int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>i<span class="keyword">:</span> int <span class="keyword">|</span> lb &lt;= i<span class="keyword">;</span> i &lt;= ub<span class="keyword">]</span></span> <span class="staexp">g1uint</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">tkindef</span> int_kind <span class="keyword">=</span> "atstype_int"</span>
<span class="comment">//</span>
<span class="keyword">typedef</span> <span class="staexp">int0 <span class="keyword">=</span> <span class="staexp">g0int</span> <span class="keyword">(</span><span class="staexp">int_kind</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span> <span class="staexp">int1 <span class="keyword">(</span><span class="staexp">i<span class="keyword">:</span>int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">g1int</span> <span class="keyword">(</span><span class="staexp">int_kind</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">stadef</span> <span class="staexp">int <span class="keyword">=</span> <span class="staexp">int1</span></span> <span class="comment">// 2nd-select</span>
<span class="keyword">stadef</span> <span class="staexp">int <span class="keyword">=</span> <span class="staexp">int0</span></span> <span class="comment">// 1st-select</span>
<span class="comment">//</span>
<span class="keyword">typedef</span> <span class="staexp">Int <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>i<span class="keyword">:</span>int<span class="keyword">]</span></span> <span class="staexp">int1</span> <span class="keyword">(</span><span class="staexp">i</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span> <span class="staexp">Nat <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>i<span class="keyword">:</span>int <span class="keyword">|</span> i &gt;= 0<span class="keyword">]</span></span> <span class="staexp">int1</span> <span class="keyword">(</span><span class="staexp">i</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">typedef</span> <span class="staexp">intLt <span class="keyword">(</span><span class="staexp">n<span class="keyword">:</span>int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">g1intLt</span> <span class="keyword">(</span><span class="staexp">int_kind</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span> <span class="staexp">intLte <span class="keyword">(</span><span class="staexp">n<span class="keyword">:</span>int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">g1intLte</span> <span class="keyword">(</span><span class="staexp">int_kind</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span> <span class="staexp">intGt <span class="keyword">(</span><span class="staexp">n<span class="keyword">:</span>int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">g1intGt</span> <span class="keyword">(</span><span class="staexp">int_kind</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span> <span class="staexp">intGte <span class="keyword">(</span><span class="staexp">n<span class="keyword">:</span>int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">g1intGte</span> <span class="keyword">(</span><span class="staexp">int_kind</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span> <span class="staexp">intBtw <span class="keyword">(</span><span class="staexp">lb<span class="keyword">:</span>int</span><span class="keyword">,</span> <span class="staexp">ub<span class="keyword">:</span>int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">g1intBtw</span> <span class="keyword">(</span><span class="staexp">int_kind</span><span class="keyword">,</span> <span class="staexp">lb</span><span class="keyword">,</span> <span class="staexp">ub</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span> <span class="staexp">intBtwe <span class="keyword">(</span><span class="staexp">lb<span class="keyword">:</span>int</span><span class="keyword">,</span> <span class="staexp">ub<span class="keyword">:</span>int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">g1intBtwe</span> <span class="keyword">(</span><span class="staexp">int_kind</span><span class="keyword">,</span> <span class="staexp">lb</span><span class="keyword">,</span> <span class="staexp">ub</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">typedef</span> <span class="staexp">Two <span class="keyword">=</span> <span class="staexp">intBtw</span> <span class="keyword">(</span><span class="staexp">0</span><span class="keyword">,</span> <span class="staexp">2</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span> <span class="staexp">Sgn <span class="keyword">=</span> <span class="staexp">intBtwe</span> <span class="keyword">(</span><span class="staexp"><span class="keyword">~</span></span><span class="staexp">1</span><span class="keyword">,</span> <span class="staexp">1</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">typedef</span> <span class="staexp">natLt <span class="keyword">(</span><span class="staexp">n<span class="keyword">:</span>int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">intBtw</span> <span class="keyword">(</span><span class="staexp">0</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span> <span class="staexp">natLte <span class="keyword">(</span><span class="staexp">n<span class="keyword">:</span>int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">intBtwe</span> <span class="keyword">(</span><span class="staexp">0</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">tkindef</span> uint_kind <span class="keyword">=</span> "atstype_uint"</span>
<span class="comment">//</span>
<span class="keyword">typedef</span> <span class="staexp">uint0 <span class="keyword">=</span> <span class="staexp">g0uint</span> <span class="keyword">(</span><span class="staexp">uint_kind</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span> <span class="staexp">uint1 <span class="keyword">(</span><span class="staexp">n<span class="keyword">:</span>int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">g1uint</span> <span class="keyword">(</span><span class="staexp">uint_kind</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">stadef</span> <span class="staexp">uint <span class="keyword">=</span> <span class="staexp">uint1</span></span> <span class="comment">// 2nd-select</span>
<span class="keyword">stadef</span> <span class="staexp">uint <span class="keyword">=</span> <span class="staexp">uint0</span></span> <span class="comment">// 1st-select</span>
<span class="comment">//</span>
<span class="keyword">stadef</span> <span class="staexp">uInt <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>n<span class="keyword">:</span>int<span class="keyword">]</span></span> <span class="staexp">uint1</span> <span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">typedef</span> <span class="staexp">uintLt <span class="keyword">(</span><span class="staexp">n<span class="keyword">:</span>int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">g1uintLt</span> <span class="keyword">(</span><span class="staexp">uint_kind</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span> <span class="staexp">uintLte <span class="keyword">(</span><span class="staexp">n<span class="keyword">:</span>int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">g1uintLte</span> <span class="keyword">(</span><span class="staexp">uint_kind</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span> <span class="staexp">uintGt <span class="keyword">(</span><span class="staexp">n<span class="keyword">:</span>int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">g1uintGt</span> <span class="keyword">(</span><span class="staexp">uint_kind</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span> <span class="staexp">uintGte <span class="keyword">(</span><span class="staexp">n<span class="keyword">:</span>int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">g1uintGte</span> <span class="keyword">(</span><span class="staexp">uint_kind</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span> <span class="staexp">uintBtw <span class="keyword">(</span><span class="staexp">lb<span class="keyword">:</span>int</span><span class="keyword">,</span> <span class="staexp">ub<span class="keyword">:</span>int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">g1uintBtw</span> <span class="keyword">(</span><span class="staexp">uint_kind</span><span class="keyword">,</span> <span class="staexp">lb</span><span class="keyword">,</span> <span class="staexp">ub</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span> <span class="staexp">uintBtwe <span class="keyword">(</span><span class="staexp">lb<span class="keyword">:</span>int</span><span class="keyword">,</span> <span class="staexp">ub<span class="keyword">:</span>int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">g1uintBtwe</span> <span class="keyword">(</span><span class="staexp">uint_kind</span><span class="keyword">,</span> <span class="staexp">lb</span><span class="keyword">,</span> <span class="staexp">ub</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">abst@ype</span> atstype_int</span> <span class="comment">// HX-2013-09: for internal use</span>
<span class="staexp"><span class="keyword">abst@ype</span> atstype_uint</span> <span class="comment">// HX-2013-09: for internal use</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">tkindef</span>
lint_kind <span class="keyword">=</span> "atstype_lint"</span>
<span class="keyword">typedef</span>
<span class="staexp">lint0 <span class="keyword">=</span> <span class="staexp">g0int</span> <span class="keyword">(</span><span class="staexp">lint_kind</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span>
<span class="staexp">lint1 <span class="keyword">(</span><span class="staexp">i<span class="keyword">:</span>int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">g1int</span> <span class="keyword">(</span><span class="staexp">lint_kind</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span></span>
<span class="keyword">stadef</span> <span class="staexp">lint <span class="keyword">=</span> <span class="staexp">lint1</span></span> <span class="comment">// 2nd-select</span>
<span class="keyword">stadef</span> <span class="staexp">lint <span class="keyword">=</span> <span class="staexp">lint0</span></span> <span class="comment">// 1st-select</span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">tkindef</span>
ulint_kind <span class="keyword">=</span> "atstype_ulint"</span>
<span class="keyword">typedef</span>
<span class="staexp">ulint0 <span class="keyword">=</span> <span class="staexp">g0uint</span> <span class="keyword">(</span><span class="staexp">ulint_kind</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span>
<span class="staexp">ulint1 <span class="keyword">(</span><span class="staexp">i<span class="keyword">:</span>int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">g1uint</span> <span class="keyword">(</span><span class="staexp">ulint_kind</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span></span>
<span class="keyword">stadef</span> <span class="staexp">ulint <span class="keyword">=</span> <span class="staexp">ulint1</span></span> <span class="comment">// 2nd-select</span>
<span class="keyword">stadef</span> <span class="staexp">ulint <span class="keyword">=</span> <span class="staexp">ulint0</span></span> <span class="comment">// 1st-select</span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">tkindef</span>
llint_kind <span class="keyword">=</span> "atstype_llint"</span>
<span class="keyword">typedef</span> <span class="staexp">llint0 <span class="keyword">=</span> <span class="staexp">g0int</span> <span class="keyword">(</span><span class="staexp">llint_kind</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span> <span class="staexp">llint1 <span class="keyword">(</span><span class="staexp">i<span class="keyword">:</span>int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">g1int</span> <span class="keyword">(</span><span class="staexp">llint_kind</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span></span>
<span class="keyword">stadef</span> <span class="staexp">llint <span class="keyword">=</span> <span class="staexp">llint1</span></span> <span class="comment">// 2nd-select</span>
<span class="keyword">stadef</span> <span class="staexp">llint <span class="keyword">=</span> <span class="staexp">llint0</span></span> <span class="comment">// 1st-select</span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">tkindef</span>
ullint_kind <span class="keyword">=</span> "atstype_ullint"</span>
<span class="keyword">typedef</span>
<span class="staexp">ullint0 <span class="keyword">=</span> <span class="staexp">g0uint</span> <span class="keyword">(</span><span class="staexp">ullint_kind</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span>
<span class="staexp">ullint1 <span class="keyword">(</span><span class="staexp">i<span class="keyword">:</span>int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">g1uint</span> <span class="keyword">(</span><span class="staexp">ullint_kind</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span></span>
<span class="keyword">stadef</span> <span class="staexp">ullint <span class="keyword">=</span> <span class="staexp">ullint1</span></span> <span class="comment">// 2nd-select</span>
<span class="keyword">stadef</span> <span class="staexp">ullint <span class="keyword">=</span> <span class="staexp">ullint0</span></span> <span class="comment">// 1st-select</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">tkindef</span>
intptr_kind <span class="keyword">=</span> "atstype_intptr"</span>
<span class="keyword">typedef</span>
<span class="staexp">intptr0 <span class="keyword">=</span> <span class="staexp">g0int</span> <span class="keyword">(</span><span class="staexp">intptr_kind</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span>
<span class="staexp">intptr1 <span class="keyword">(</span><span class="staexp">i<span class="keyword">:</span>int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">g1int</span> <span class="keyword">(</span><span class="staexp">intptr_kind</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span></span>
<span class="keyword">stadef</span> <span class="staexp">intptr <span class="keyword">=</span> <span class="staexp">intptr1</span></span> <span class="comment">// 2nd-select</span>
<span class="keyword">stadef</span> <span class="staexp">intptr <span class="keyword">=</span> <span class="staexp">intptr0</span></span> <span class="comment">// 1st-select</span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">tkindef</span>
uintptr_kind <span class="keyword">=</span> "atstype_uintptr"</span>
<span class="keyword">typedef</span>
<span class="staexp">uintptr0 <span class="keyword">=</span> <span class="staexp">g0uint</span> <span class="keyword">(</span><span class="staexp">uintptr_kind</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span>
<span class="staexp">uintptr1 <span class="keyword">(</span><span class="staexp">i<span class="keyword">:</span>int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">g1uint</span> <span class="keyword">(</span><span class="staexp">uintptr_kind</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span></span>
<span class="keyword">stadef</span> <span class="staexp">uintptr <span class="keyword">=</span> <span class="staexp">uintptr1</span></span> <span class="comment">// 2nd-select</span>
<span class="keyword">stadef</span> <span class="staexp">uintptr <span class="keyword">=</span> <span class="staexp">uintptr0</span></span> <span class="comment">// 1st-select</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">tkindef</span>
sint_kind <span class="keyword">=</span> "atstype_sint"</span>
<span class="keyword">typedef</span>
<span class="staexp">sint0 <span class="keyword">=</span> <span class="staexp">g0int</span> <span class="keyword">(</span><span class="staexp">sint_kind</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span>
<span class="staexp">sint1 <span class="keyword">(</span><span class="staexp">i<span class="keyword">:</span>int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">g1int</span> <span class="keyword">(</span><span class="staexp">sint_kind</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span></span>
<span class="keyword">stadef</span> <span class="staexp">sint <span class="keyword">=</span> <span class="staexp">sint1</span></span> <span class="comment">// 2nd-select</span>
<span class="keyword">stadef</span> <span class="staexp">sint <span class="keyword">=</span> <span class="staexp">sint0</span></span> <span class="comment">// 1st-select</span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">tkindef</span>
usint_kind <span class="keyword">=</span> "atstype_usint"</span>
<span class="keyword">typedef</span>
<span class="staexp">usint0 <span class="keyword">=</span> <span class="staexp">g0uint</span> <span class="keyword">(</span><span class="staexp">usint_kind</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span>
<span class="staexp">usint1 <span class="keyword">(</span><span class="staexp">i<span class="keyword">:</span>int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">g1uint</span> <span class="keyword">(</span><span class="staexp">usint_kind</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span></span>
<span class="keyword">stadef</span> <span class="staexp">usint <span class="keyword">=</span> <span class="staexp">usint1</span></span> <span class="comment">// 2nd-select</span>
<span class="keyword">stadef</span> <span class="staexp">usint <span class="keyword">=</span> <span class="staexp">usint0</span></span> <span class="comment">// 1st-select</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">tkindef</span>
size_kind <span class="keyword">=</span> "atstype_size"</span>
<span class="keyword">typedef</span> <span class="staexp">size0_t <span class="keyword">=</span> <span class="staexp">g0uint</span> <span class="keyword">(</span><span class="staexp">size_kind</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span> <span class="staexp">size1_t <span class="keyword">(</span><span class="staexp">i<span class="keyword">:</span>int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">g1uint</span> <span class="keyword">(</span><span class="staexp">size_kind</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">stadef</span> <span class="staexp">size_t <span class="keyword">=</span> <span class="staexp">size1_t</span></span> <span class="comment">// 2nd-select</span>
<span class="keyword">stadef</span> <span class="staexp">size_t <span class="keyword">=</span> <span class="staexp">size0_t</span></span> <span class="comment">// 1st-select</span>
<span class="comment">//</span>
<span class="keyword">typedef</span> <span class="staexp">Size <span class="keyword">=</span>
  <span class="staexp"><span class="keyword">[</span>i<span class="keyword">:</span>int <span class="keyword">|</span> i &gt;= 0<span class="keyword">]</span></span> <span class="staexp">g1uint</span> <span class="keyword">(</span><span class="staexp">size_kind</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span> <span class="staexp">Size_t <span class="keyword">=</span> <span class="staexp">Size</span></span>
<span class="comment">//</span>
<span class="keyword">typedef</span> <span class="staexp">sizeLt <span class="keyword">(</span><span class="staexp">n<span class="keyword">:</span>int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">g1uintLt</span> <span class="keyword">(</span><span class="staexp">size_kind</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span> <span class="staexp">sizeLte <span class="keyword">(</span><span class="staexp">n<span class="keyword">:</span>int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">g1uintLte</span> <span class="keyword">(</span><span class="staexp">size_kind</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span> <span class="staexp">sizeGt <span class="keyword">(</span><span class="staexp">n<span class="keyword">:</span>int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">g1uintGt</span> <span class="keyword">(</span><span class="staexp">size_kind</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span> <span class="staexp">sizeGte <span class="keyword">(</span><span class="staexp">n<span class="keyword">:</span>int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">g1uintGte</span> <span class="keyword">(</span><span class="staexp">size_kind</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span> <span class="staexp">sizeBtw <span class="keyword">(</span><span class="staexp">lb<span class="keyword">:</span>int</span><span class="keyword">,</span> <span class="staexp">ub<span class="keyword">:</span>int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">g1uintBtw</span> <span class="keyword">(</span><span class="staexp">size_kind</span><span class="keyword">,</span> <span class="staexp">lb</span><span class="keyword">,</span> <span class="staexp">ub</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span> <span class="staexp">sizeBtwe <span class="keyword">(</span><span class="staexp">lb<span class="keyword">:</span>int</span><span class="keyword">,</span> <span class="staexp">ub<span class="keyword">:</span>int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">g1uintBtwe</span> <span class="keyword">(</span><span class="staexp">size_kind</span><span class="keyword">,</span> <span class="staexp">lb</span><span class="keyword">,</span> <span class="staexp">ub</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">tkindef</span>
ssize_kind <span class="keyword">=</span> "atstype_ssize"</span>
<span class="keyword">typedef</span> <span class="staexp">ssize0_t <span class="keyword">=</span> <span class="staexp">g0int</span> <span class="keyword">(</span><span class="staexp">ssize_kind</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span> <span class="staexp">ssize1_t <span class="keyword">(</span><span class="staexp">i<span class="keyword">:</span>int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">g1int</span> <span class="keyword">(</span><span class="staexp">ssize_kind</span> <span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span></span> 
<span class="comment">//</span>
<span class="keyword">stadef</span> <span class="staexp">ssize_t <span class="keyword">=</span> <span class="staexp">ssize1_t</span></span> <span class="comment">// 2nd-select</span>
<span class="keyword">stadef</span> <span class="staexp">ssize_t <span class="keyword">=</span> <span class="staexp">ssize0_t</span></span> <span class="comment">// 1st-select</span>
<span class="comment">//</span>
<span class="keyword">typedef</span> <span class="staexp">SSize <span class="keyword">=</span>
  <span class="staexp"><span class="keyword">[</span>i<span class="keyword">:</span>int<span class="keyword">]</span></span> <span class="staexp">g1int</span> <span class="keyword">(</span><span class="staexp">ssize_kind</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span> <span class="staexp">SSize_t <span class="keyword">=</span> <span class="staexp">SSize</span></span>
<span class="comment">//</span>
<span class="keyword">typedef</span> <span class="staexp">ssizeLt <span class="keyword">(</span><span class="staexp">n<span class="keyword">:</span>int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">g1intLt</span> <span class="keyword">(</span><span class="staexp">ssize_kind</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span> <span class="staexp">ssizeLte <span class="keyword">(</span><span class="staexp">n<span class="keyword">:</span>int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">g1intLte</span> <span class="keyword">(</span><span class="staexp">ssize_kind</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span> <span class="staexp">ssizeGt <span class="keyword">(</span><span class="staexp">n<span class="keyword">:</span>int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">g1intGt</span> <span class="keyword">(</span><span class="staexp">ssize_kind</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span> <span class="staexp">ssizeGte <span class="keyword">(</span><span class="staexp">n<span class="keyword">:</span>int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">g1intGte</span> <span class="keyword">(</span><span class="staexp">ssize_kind</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span> <span class="staexp">ssizeBtw <span class="keyword">(</span><span class="staexp">lb<span class="keyword">:</span>int</span><span class="keyword">,</span> <span class="staexp">ub<span class="keyword">:</span>int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">g1intBtw</span> <span class="keyword">(</span><span class="staexp">ssize_kind</span><span class="keyword">,</span> <span class="staexp">lb</span><span class="keyword">,</span> <span class="staexp">ub</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span> <span class="staexp">ssizeBtwe <span class="keyword">(</span><span class="staexp">lb<span class="keyword">:</span>int</span><span class="keyword">,</span> <span class="staexp">ub<span class="keyword">:</span>int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">g1intBtwe</span> <span class="keyword">(</span><span class="staexp">ssize_kind</span><span class="keyword">,</span> <span class="staexp">lb</span><span class="keyword">,</span> <span class="staexp">ub</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">abst@ype</span> atstype_size</span> <span class="comment">// HX-2013-09: for internal use</span>
<span class="staexp"><span class="keyword">abst@ype</span> atstype_ssize</span> <span class="comment">// HX-2013-09: for internal use</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">typedef</span> <span class="staexp">sizeof_t <span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span><span class="keyword">vt@ype</span></span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">size_t</span> <span class="keyword">(</span><span class="staexp">sizeof</span><span class="keyword">(</span><span class="staexp">a</span><span class="staexp">?</span><span class="keyword">)</span><span class="keyword">)</span></span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">tkindef</span>
int8_kind <span class="keyword">=</span> "atstype_int8"</span>
<span class="keyword">typedef</span>
<span class="staexp">int8_0 <span class="keyword">=</span> <span class="staexp">g0int</span> <span class="keyword">(</span><span class="staexp">int8_kind</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span>
<span class="staexp">int8_1
  <span class="keyword">(</span><span class="staexp">i<span class="keyword">:</span>int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">g1int</span> <span class="keyword">(</span><span class="staexp">int8_kind</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">stadef</span> <span class="staexp">int8 <span class="keyword">=</span> <span class="staexp">int8_1</span></span> <span class="comment">// 2nd-select</span>
<span class="keyword">stadef</span> <span class="staexp">int8 <span class="keyword">=</span> <span class="staexp">int8_0</span></span> <span class="comment">// 1st-select</span>
<span class="keyword">stadef</span> <span class="staexp">Int8 <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>i<span class="keyword">:</span>int<span class="keyword">]</span></span> <span class="staexp">int8_1</span> <span class="keyword">(</span><span class="staexp">i</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">tkindef</span>
uint8_kind <span class="keyword">=</span> "atstype_uint8"</span>
<span class="keyword">typedef</span>
<span class="staexp">uint8_0 <span class="keyword">=</span> <span class="staexp">g0uint</span> <span class="keyword">(</span><span class="staexp">uint8_kind</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span>
<span class="staexp">uint8_1
  <span class="keyword">(</span><span class="staexp">i<span class="keyword">:</span>int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">g1uint</span> <span class="keyword">(</span><span class="staexp">uint8_kind</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">stadef</span> <span class="staexp">uint8 <span class="keyword">=</span> <span class="staexp">uint8_1</span></span> <span class="comment">// 2nd-select</span>
<span class="keyword">stadef</span> <span class="staexp">uint8 <span class="keyword">=</span> <span class="staexp">uint8_0</span></span> <span class="comment">// 1st-select</span>
<span class="keyword">stadef</span> <span class="staexp">uInt8 <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>i<span class="keyword">:</span>nat<span class="keyword">]</span></span> <span class="staexp">uint8_1</span> <span class="keyword">(</span><span class="staexp">i</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">tkindef</span>
int16_kind <span class="keyword">=</span> "atstype_int16"</span>
<span class="keyword">typedef</span>
<span class="staexp">int16_0 <span class="keyword">=</span> <span class="staexp">g0int</span> <span class="keyword">(</span><span class="staexp">int16_kind</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span>
<span class="staexp">int16_1
  <span class="keyword">(</span><span class="staexp">i<span class="keyword">:</span>int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">g1int</span> <span class="keyword">(</span><span class="staexp">int16_kind</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">stadef</span> <span class="staexp">int16 <span class="keyword">=</span> <span class="staexp">int16_1</span></span> <span class="comment">// 2nd-select</span>
<span class="keyword">stadef</span> <span class="staexp">int16 <span class="keyword">=</span> <span class="staexp">int16_0</span></span> <span class="comment">// 1st-select</span>
<span class="keyword">stadef</span> <span class="staexp">Int16 <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>i<span class="keyword">:</span>int<span class="keyword">]</span></span> <span class="staexp">int16_1</span> <span class="keyword">(</span><span class="staexp">i</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">tkindef</span>
uint16_kind <span class="keyword">=</span> "atstype_uint16"</span>
<span class="keyword">typedef</span>
<span class="staexp">uint16_0 <span class="keyword">=</span> <span class="staexp">g0uint</span> <span class="keyword">(</span><span class="staexp">uint16_kind</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span>
<span class="staexp">uint16_1
  <span class="keyword">(</span><span class="staexp">i<span class="keyword">:</span>int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">g1uint</span> <span class="keyword">(</span><span class="staexp">uint16_kind</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">stadef</span> <span class="staexp">uint16 <span class="keyword">=</span> <span class="staexp">uint16_1</span></span> <span class="comment">// 2nd-select</span>
<span class="keyword">stadef</span> <span class="staexp">uint16 <span class="keyword">=</span> <span class="staexp">uint16_0</span></span> <span class="comment">// 1st-select</span>
<span class="keyword">stadef</span> <span class="staexp">uInt16 <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>i<span class="keyword">:</span>nat<span class="keyword">]</span></span> <span class="staexp">uint16_1</span> <span class="keyword">(</span><span class="staexp">i</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">tkindef</span>
int32_kind <span class="keyword">=</span> "atstype_int32"</span>
<span class="keyword">typedef</span>
<span class="staexp">int32_0 <span class="keyword">=</span> <span class="staexp">g0int</span> <span class="keyword">(</span><span class="staexp">int32_kind</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span>
<span class="staexp">int32_1
  <span class="keyword">(</span><span class="staexp">i<span class="keyword">:</span>int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">g1int</span> <span class="keyword">(</span><span class="staexp">int32_kind</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">stadef</span> <span class="staexp">int32 <span class="keyword">=</span> <span class="staexp">int32_1</span></span> <span class="comment">// 2nd-select</span>
<span class="keyword">stadef</span> <span class="staexp">int32 <span class="keyword">=</span> <span class="staexp">int32_0</span></span> <span class="comment">// 1st-select</span>
<span class="keyword">stadef</span> <span class="staexp">Int32 <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>i<span class="keyword">:</span>int<span class="keyword">]</span></span> <span class="staexp">int32_1</span> <span class="keyword">(</span><span class="staexp">i</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">tkindef</span>
uint32_kind <span class="keyword">=</span> "atstype_uint32"</span>
<span class="keyword">typedef</span>
<span class="staexp">uint32_0 <span class="keyword">=</span> <span class="staexp">g0uint</span> <span class="keyword">(</span><span class="staexp">uint32_kind</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span>
<span class="staexp">uint32_1
  <span class="keyword">(</span><span class="staexp">i<span class="keyword">:</span>int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">g1uint</span> <span class="keyword">(</span><span class="staexp">uint32_kind</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">stadef</span> <span class="staexp">uint32 <span class="keyword">=</span> <span class="staexp">uint32_1</span></span> <span class="comment">// 2nd-select</span>
<span class="keyword">stadef</span> <span class="staexp">uint32 <span class="keyword">=</span> <span class="staexp">uint32_0</span></span> <span class="comment">// 1st-select</span>
<span class="keyword">stadef</span> <span class="staexp">uInt32 <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>i<span class="keyword">:</span>nat<span class="keyword">]</span></span> <span class="staexp">uint32_1</span> <span class="keyword">(</span><span class="staexp">i</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">tkindef</span>
int64_kind <span class="keyword">=</span> "atstype_int64"</span>
<span class="keyword">typedef</span>
<span class="staexp">int64_0 <span class="keyword">=</span> <span class="staexp">g0int</span> <span class="keyword">(</span><span class="staexp">int64_kind</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span>
<span class="staexp">int64_1
  <span class="keyword">(</span><span class="staexp">i<span class="keyword">:</span>int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">g1int</span> <span class="keyword">(</span><span class="staexp">int64_kind</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">stadef</span> <span class="staexp">int64 <span class="keyword">=</span> <span class="staexp">int64_1</span></span> <span class="comment">// 2nd-select</span>
<span class="keyword">stadef</span> <span class="staexp">int64 <span class="keyword">=</span> <span class="staexp">int64_0</span></span> <span class="comment">// 1st-select</span>
<span class="keyword">stadef</span> <span class="staexp">Int64 <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>i<span class="keyword">:</span>int<span class="keyword">]</span></span> <span class="staexp">int64_1</span> <span class="keyword">(</span><span class="staexp">i</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">tkindef</span>
uint64_kind <span class="keyword">=</span> "atstype_uint64"</span>
<span class="keyword">typedef</span>
<span class="staexp">uint64_0 <span class="keyword">=</span> <span class="staexp">g0uint</span> <span class="keyword">(</span><span class="staexp">uint64_kind</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span>
<span class="staexp">uint64_1
  <span class="keyword">(</span><span class="staexp">i<span class="keyword">:</span>int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">g1uint</span> <span class="keyword">(</span><span class="staexp">uint64_kind</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">stadef</span> <span class="staexp">uint64 <span class="keyword">=</span> <span class="staexp">uint64_1</span></span> <span class="comment">// 2nd-select</span>
<span class="keyword">stadef</span> <span class="staexp">uint64 <span class="keyword">=</span> <span class="staexp">uint64_0</span></span> <span class="comment">// 1st-select</span>
<span class="keyword">stadef</span> <span class="staexp">uInt64 <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>i<span class="keyword">:</span>nat<span class="keyword">]</span></span> <span class="staexp">uint64_1</span> <span class="keyword">(</span><span class="staexp">i</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">abst@ype</span>
g0float_t0ype <span class="keyword">(</span>tk<span class="keyword">:</span>tk<span class="keyword">)</span> <span class="keyword">=</span> tkind_t0ype <span class="keyword">(</span>tk<span class="keyword">)</span></span>
<span class="keyword">stadef</span> <span class="staexp">g0float <span class="keyword">=</span> <span class="staexp">g0float_t0ype</span></span> <span class="comment">// shorthand</span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">tkindef</span> float_kind <span class="keyword">=</span> "atstype_float"</span>
<span class="keyword">typedef</span> <span class="staexp">float <span class="keyword">=</span> <span class="staexp">g0float</span> <span class="keyword">(</span><span class="staexp">float_kind</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">tkindef</span> double_kind <span class="keyword">=</span> "atstype_double"</span>
<span class="keyword">typedef</span> <span class="staexp">double <span class="keyword">=</span> <span class="staexp">g0float</span> <span class="keyword">(</span><span class="staexp">double_kind</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">tkindef</span> ldouble_kind <span class="keyword">=</span> "atstype_ldouble"</span>
<span class="keyword">typedef</span> <span class="staexp">ldouble <span class="keyword">=</span> <span class="staexp">g0float</span> <span class="keyword">(</span><span class="staexp">ldouble_kind</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">// HX: unindexed type for pointers</span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">tkindef</span> ptr_kind <span class="keyword">=</span> "atstype_ptrk"</span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">abstype</span> ptr_type <span class="keyword">=</span> tkind_type<span class="keyword">(</span>ptr_kind<span class="keyword">)</span></span>
<span class="staexp"><span class="keyword">abstype</span> ptr_addr_type<span class="keyword">(</span>l<span class="keyword">:</span>addr<span class="keyword">)</span> <span class="keyword">=</span> ptr_type</span>
<span class="comment">//</span>
<span class="keyword">typedef</span> <span class="staexp">ptr <span class="keyword">=</span> <span class="staexp">ptr_type</span></span> <span class="comment">// HX: a shorthand</span>
<span class="keyword">typedef</span> <span class="staexp">ptr<span class="keyword">(</span><span class="staexp">l<span class="keyword">:</span>addr</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">ptr_addr_type</span><span class="keyword">(</span><span class="staexp">l</span><span class="keyword">)</span></span> <span class="comment">// HX: a shorthand</span>
<span class="comment">//</span>
<span class="keyword">typedef</span> <span class="staexp">Ptr <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>l<span class="keyword">:</span>addr<span class="keyword">]</span></span> <span class="staexp">ptr</span><span class="keyword">(</span><span class="staexp">l</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span> <span class="staexp">Ptr0 <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>l<span class="keyword">:</span>agez<span class="keyword">]</span></span> <span class="staexp">ptr</span><span class="keyword">(</span><span class="staexp">l</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span> <span class="staexp">Ptr1 <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>l<span class="keyword">:</span>addr<span class="keyword">|</span>l <span class="keyword">&gt;</span> null<span class="keyword">]</span></span> <span class="staexp">ptr</span><span class="keyword">(</span><span class="staexp">l</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">typedef</span>
<span class="staexp">Ptrnull <span class="keyword">(</span><span class="staexp">l<span class="keyword">:</span>addr</span><span class="keyword">)</span> <span class="keyword">=</span>
  <span class="staexp"><span class="keyword">[</span>l1<span class="keyword">:</span>addr <span class="keyword">|</span> l1 == null || l1 == l<span class="keyword">]</span></span> <span class="staexp">ptr</span><span class="keyword">(</span><span class="staexp">l1</span><span class="keyword">)</span></span>
<span class="comment">// end of [Ptrnull]</span>
<span class="comment">//</span>
<span class="comment">// HX-2012-02-14: it is an expriment for now:</span>
<span class="comment">//</span>
<span class="keyword">typedef</span> <span class="staexp">ptr<span class="keyword">(</span><span class="staexp">n<span class="keyword">:</span>int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">ptr_addr_type</span><span class="keyword">(</span><span class="staexp">addr_of_int</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
** HX: persistent read-only strings
*)</span>
<span class="comment">(*
//
// HX-2013-04: this confuses type-erasure
//
abstype
string_type = $extype"atstype_string"
*)</span>
<span class="staexp"><span class="keyword">abstype</span>
string_type <span class="keyword">=</span> ptr</span> <span class="comment">// = char* in C</span>
<span class="staexp"><span class="keyword">abstype</span>
string_int_type<span class="keyword">(</span>n<span class="keyword">:</span> int<span class="keyword">)</span> <span class="keyword">=</span> string_type</span>
<span class="comment">//</span>
<span class="keyword">stadef</span>
<span class="staexp">string0 <span class="keyword">=</span> <span class="staexp">string_type</span></span>
<span class="keyword">stadef</span>
<span class="staexp">string1 <span class="keyword">=</span> <span class="staexp">string_int_type</span></span>
<span class="comment">//</span>
<span class="keyword">stadef</span> <span class="staexp">string <span class="keyword">=</span> <span class="staexp">string1</span></span> <span class="comment">// 2nd-select</span>
<span class="keyword">stadef</span> <span class="staexp">string <span class="keyword">=</span> <span class="staexp">string0</span></span> <span class="comment">// 1st-select</span>
<span class="comment">//</span>
<span class="keyword">typedef</span> <span class="staexp">String <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>n<span class="keyword">:</span>int<span class="keyword">]</span></span> <span class="staexp">string_int_type</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span> <span class="staexp">String0 <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>n<span class="keyword">:</span>int <span class="keyword">|</span> n &gt;= 0<span class="keyword">]</span></span> <span class="staexp">string_int_type</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span> <span class="staexp">String1 <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>n<span class="keyword">:</span>int <span class="keyword">|</span> n &gt;= 1<span class="keyword">]</span></span> <span class="staexp">string_int_type</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">abstype</span>
stropt_int_type<span class="keyword">(</span>n<span class="keyword">:</span>int<span class="keyword">)</span> <span class="keyword">=</span> ptr</span>
<span class="comment">//</span>
<span class="keyword">typedef</span>
<span class="staexp">stropt<span class="keyword">(</span><span class="staexp">n<span class="keyword">:</span>int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">stropt_int_type</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">typedef</span> <span class="staexp">stropt <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>n<span class="keyword">:</span>int<span class="keyword">]</span></span> <span class="staexp">stropt_int_type</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span> <span class="staexp">Stropt <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>n<span class="keyword">:</span>int<span class="keyword">]</span></span> <span class="staexp">stropt_int_type</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span> <span class="staexp">Stropt0 <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>n<span class="keyword">:</span>int<span class="keyword">]</span></span> <span class="staexp">stropt_int_type</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span> <span class="staexp">Stropt1 <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>n<span class="keyword">:</span>int <span class="keyword">|</span> n &gt;= 0<span class="keyword">]</span></span> <span class="staexp">stropt_int_type</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">(*
** HX: linear mutable strings
*)</span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">absvtype</span>
strptr_addr_vtype<span class="keyword">(</span>l<span class="keyword">:</span>addr<span class="keyword">)</span> <span class="keyword">=</span> ptr</span>
<span class="keyword">vtypedef</span> <span class="staexp">strptr<span class="keyword">(</span><span class="staexp">l<span class="keyword">:</span>addr</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">strptr_addr_vtype</span><span class="keyword">(</span><span class="staexp">l</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">vtypedef</span> <span class="staexp">strptr <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>l<span class="keyword">:</span>addr<span class="keyword">]</span></span> <span class="staexp">strptr</span><span class="keyword">(</span><span class="staexp">l</span><span class="keyword">)</span></span>
<span class="keyword">vtypedef</span> <span class="staexp">Strptr <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>l<span class="keyword">:</span>addr<span class="keyword">]</span></span> <span class="staexp">strptr</span><span class="keyword">(</span><span class="staexp">l</span><span class="keyword">)</span></span>
<span class="keyword">vtypedef</span> <span class="staexp">Strptr0 <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>l<span class="keyword">:</span>addr<span class="keyword">]</span></span> <span class="staexp">strptr</span><span class="keyword">(</span><span class="staexp">l</span><span class="keyword">)</span></span>
<span class="keyword">vtypedef</span> <span class="staexp">Strptr1 <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>l<span class="keyword">:</span>addr<span class="keyword">|</span>l <span class="keyword">&gt;</span> null<span class="keyword">]</span></span> <span class="staexp">strptr</span><span class="keyword">(</span><span class="staexp">l</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">absvtype</span>
strnptr_addr_int_vtype<span class="keyword">(</span>l<span class="keyword">:</span>addr<span class="keyword">,</span> n<span class="keyword">:</span>int<span class="keyword">)</span> <span class="keyword">=</span> ptr</span>
<span class="keyword">vtypedef</span>
<span class="staexp">strnptr<span class="keyword">(</span><span class="staexp">l<span class="keyword">:</span>addr</span><span class="keyword">,</span> <span class="staexp">n<span class="keyword">:</span>int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">strnptr_addr_int_vtype</span><span class="keyword">(</span><span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="keyword">vtypedef</span>
<span class="staexp">strnptr<span class="keyword">(</span><span class="staexp">n<span class="keyword">:</span>int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>l<span class="keyword">:</span>addr<span class="keyword">]</span></span> <span class="staexp">strnptr_addr_int_vtype</span><span class="keyword">(</span><span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">vtypedef</span> <span class="staexp">Strnptr <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>l<span class="keyword">:</span>addr<span class="keyword">;</span>n<span class="keyword">:</span>int<span class="keyword">]</span></span> <span class="staexp">strnptr</span><span class="keyword">(</span><span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="keyword">vtypedef</span> <span class="staexp">Strnptr0 <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>l<span class="keyword">:</span>addr<span class="keyword">;</span>n<span class="keyword">:</span>int<span class="keyword">]</span></span> <span class="staexp">strnptr</span><span class="keyword">(</span><span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="keyword">vtypedef</span> <span class="staexp">Strnptr1 <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>l<span class="keyword">:</span>addr<span class="keyword">;</span>n<span class="keyword">:</span>int <span class="keyword">|</span> n &gt;= 0<span class="keyword">]</span></span> <span class="staexp">strnptr</span><span class="keyword">(</span><span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
** HX: persistent mutable strings
*)</span>
<span class="staexp"><span class="keyword">abstype</span>
strref_addr_type <span class="keyword">(</span>l<span class="keyword">:</span>addr<span class="keyword">)</span> <span class="keyword">=</span> ptr</span>
<span class="keyword">stadef</span> <span class="staexp">strref <span class="keyword">=</span> <span class="staexp">strref_addr_type</span></span>
<span class="keyword">typedef</span> <span class="staexp">Strref0 <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>l<span class="keyword">:</span>addr<span class="keyword">]</span></span> <span class="staexp">strref</span> <span class="keyword">(</span><span class="staexp">l</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span> <span class="staexp">Strref1 <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>l<span class="keyword">:</span>addr <span class="keyword">|</span> l <span class="keyword">&gt;</span> null<span class="keyword">]</span></span> <span class="staexp">strref</span> <span class="keyword">(</span><span class="staexp">l</span><span class="keyword">)</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="staexp"><span class="keyword">abst@ype</span>
atsvoid_t0ype</span>
<span class="comment">(*
= $extype"atsvoid_t0ype"
*)</span>
<span class="keyword">typedef</span> <span class="staexp">void <span class="keyword">=</span> <span class="staexp">atsvoid_t0ype</span></span> <span class="comment">// = C-void</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">absvtype</span>
exception_vtype <span class="keyword">=</span> <span class="keyword">$extype</span>"atstype_exnconptr"</span>
<span class="comment">//</span>
<span class="keyword">vtypedef</span> <span class="staexp">exn <span class="keyword">=</span> <span class="staexp">exception_vtype</span></span> <span class="comment">// boxed vtype</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="staexp"><span class="keyword">absvt@ype</span> <span class="comment">// covariance</span>
opt_vt0ype_bool_vt0ype <span class="keyword">(</span>a<span class="keyword">:</span><span class="keyword">vt@ype+</span><span class="keyword">,</span> opt<span class="keyword">:</span>bool<span class="keyword">)</span> <span class="keyword">=</span> a</span>
<span class="keyword">stadef</span> <span class="staexp">opt <span class="keyword">=</span> <span class="staexp">opt_vt0ype_bool_vt0ype</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">typedef</span> <span class="staexp">bytes <span class="keyword">(</span><span class="staexp">n<span class="keyword">:</span>int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">@[</span><span class="staexp">byte</span><span class="keyword">]</span><span class="keyword">[</span><span class="staexp">n</span><span class="keyword">]</span></span>
<span class="keyword">viewdef</span> <span class="staexp">bytes_v <span class="keyword">(</span><span class="staexp">l<span class="keyword">:</span>addr</span><span class="keyword">,</span> <span class="staexp">n<span class="keyword">:</span>int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">bytes</span> <span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span> <span class="staexp"><span class="keyword">@</span></span> <span class="staexp">l</span></span>
<span class="keyword">typedef</span> <span class="staexp">b0ytes <span class="keyword">(</span><span class="staexp">n<span class="keyword">:</span>int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">@[</span><span class="staexp">byte</span><span class="staexp">?</span><span class="keyword">]</span><span class="keyword">[</span><span class="staexp">n</span><span class="keyword">]</span></span>
<span class="keyword">viewdef</span> <span class="staexp">b0ytes_v <span class="keyword">(</span><span class="staexp">l<span class="keyword">:</span>addr</span><span class="keyword">,</span> <span class="staexp">n<span class="keyword">:</span>int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">b0ytes</span> <span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span> <span class="staexp"><span class="keyword">@</span></span> <span class="staexp">l</span></span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">abstype</span>
cloref_t0ype_type <span class="keyword">(</span>a<span class="keyword">:</span><span class="keyword">t@ype</span><span class="keyword">)</span> <span class="keyword">=</span> ptr</span>
<span class="keyword">stadef</span> <span class="staexp">cloref <span class="keyword">=</span> <span class="staexp">cloref_t0ype_type</span></span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">absvtype</span>
cloptr_vt0ype_vtype <span class="keyword">(</span>a<span class="keyword">:</span><span class="keyword">t@ype</span><span class="keyword">)</span> <span class="keyword">=</span> ptr</span>
<span class="keyword">stadef</span> <span class="staexp">cloptr <span class="keyword">=</span> <span class="staexp">cloptr_vt0ype_vtype</span></span>
<span class="keyword">vtypedef</span>
<span class="staexp">cloptr0 <span class="keyword">=</span> <span class="staexp">cloptr_vt0ype_vtype</span> <span class="keyword">(</span><span class="staexp">void</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="keyword">typedef</span>
<span class="staexp">stamped_t
  <span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span><span class="keyword">t@ype</span></span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>x<span class="keyword">:</span>int<span class="keyword">]</span></span> <span class="staexp">stamped_t</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">x</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">vtypedef</span>
<span class="staexp">stamped_vt
  <span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span><span class="keyword">vt@ype</span></span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>x<span class="keyword">:</span>int<span class="keyword">]</span></span> <span class="staexp">stamped_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">x</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">// HX:</span>
<span class="comment">// for memory deallocation</span>
<span class="comment">// (with GC and without GC)</span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">absview</span>
mfree_gc_addr_view<span class="keyword">(</span>addr<span class="keyword">)</span></span>
<span class="keyword">stadef</span>
<span class="staexp">mfree_gc_v <span class="keyword">=</span> <span class="staexp">mfree_gc_addr_view</span></span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">absview</span>
mfree_ngc_addr_view<span class="keyword">(</span>addr<span class="keyword">)</span></span>
<span class="keyword">stadef</span>
<span class="staexp">mfree_ngc_v <span class="keyword">=</span> <span class="staexp">mfree_ngc_addr_view</span></span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">absview</span>
mfree_libc_addr_view<span class="keyword">(</span>addr<span class="keyword">)</span></span> <span class="comment">// libc-mfree</span>
<span class="keyword">stadef</span>
<span class="staexp">mfree_libc_v <span class="keyword">=</span> <span class="staexp">mfree_libc_addr_view</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">absvt@ype</span>
arrpsz_vt0ype_int_vt0ype
  <span class="keyword">(</span>a<span class="keyword">:</span><span class="keyword">vt@ype+</span><span class="keyword">,</span> n<span class="keyword">:</span>int<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">$extype</span>"atstype_arrpsz"</span>
<span class="comment">//</span>
<span class="keyword">stadef</span>
<span class="staexp">arrpsz <span class="keyword">=</span> <span class="staexp">arrpsz_vt0ype_int_vt0ype</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="staexp"><span class="keyword">absprop</span> <span class="comment">// invariance</span>
vbox_view_prop <span class="keyword">(</span>v<span class="keyword">:</span>view<span class="keyword">)</span></span>
<span class="keyword">propdef</span>
<span class="staexp">vbox<span class="keyword">(</span><span class="staexp">v<span class="keyword">:</span>view</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">vbox_view_prop</span><span class="keyword">(</span><span class="staexp">v</span><span class="keyword">)</span></span>

<span class="staexp"><span class="keyword">abstype</span> <span class="comment">// invariance</span>
ref_vt0ype_type<span class="keyword">(</span>a<span class="keyword">:</span><span class="keyword">vt@ype</span><span class="keyword">)</span> <span class="keyword">=</span> ptr</span>
<span class="keyword">typedef</span>
<span class="staexp">ref<span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span><span class="keyword">vt@ype</span></span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">ref_vt0ype_type</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="keyword">viewdef</span>
<span class="staexp">vtakeout
<span class="keyword">(</span> <span class="staexp">v1<span class="keyword">:</span> view</span>
<span class="keyword">,</span> <span class="staexp">v2<span class="keyword">:</span> view</span> <span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="staexp">v2</span><span class="keyword">,</span> <span class="staexp">v2</span> <span class="keyword">-&lt;</span><span class="staexp">lin</span><span class="keyword">,</span><span class="staexp">prf</span><span class="keyword">&gt;</span> <span class="staexp">v1</span><span class="keyword">)</span></span>
<span class="keyword">viewdef</span>
<span class="staexp">vtakeout0 <span class="keyword">(</span><span class="staexp">v<span class="keyword">:</span>view</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">vtakeout</span><span class="keyword">(</span><span class="staexp">void</span><span class="keyword">,</span> <span class="staexp">v</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">vtypedef</span>
<span class="staexp">vttakeout
<span class="keyword">(</span> <span class="staexp">vt1<span class="keyword">:</span><span class="keyword">vt@ype</span></span>
<span class="keyword">,</span> <span class="staexp">vt2<span class="keyword">:</span><span class="keyword">vt@ype</span></span> <span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="staexp">vt2</span> <span class="keyword">-&lt;</span><span class="staexp">lin</span><span class="keyword">,</span><span class="staexp">prf</span><span class="keyword">&gt;</span> <span class="staexp">vt1</span> <span class="keyword">|</span> <span class="staexp">vt2</span><span class="keyword">)</span></span>
<span class="keyword">vtypedef</span>
<span class="staexp">vttakeout0 <span class="keyword">(</span><span class="staexp">vt<span class="keyword">:</span><span class="keyword">vt@ype</span></span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">vttakeout</span><span class="keyword">(</span><span class="staexp">void</span><span class="keyword">,</span> <span class="staexp">vt</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="keyword">vtypedef</span>
<span class="staexp">vtakeoutptr
  <span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span><span class="keyword">vt@ype</span></span><span class="keyword">)</span> <span class="keyword">=</span>
  <span class="staexp"><span class="keyword">[</span>l<span class="keyword">:</span>addr<span class="keyword">]</span></span> <span class="keyword">(</span><span class="staexp">a</span><span class="staexp"><span class="keyword">@</span></span><span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">a</span><span class="staexp"><span class="keyword">@</span></span><span class="staexp">l</span> <span class="keyword">-&lt;</span><span class="staexp">lin</span><span class="keyword">,</span><span class="staexp">prf</span><span class="keyword">&gt;</span> <span class="staexp">void</span> <span class="keyword">|</span> <span class="staexp">ptr</span> <span class="staexp">l</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="keyword">vtypedef</span>
<span class="staexp">vstrptr<span class="keyword">(</span><span class="staexp">l<span class="keyword">:</span>addr</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">vttakeout0</span><span class="keyword">(</span><span class="staexp">strptr</span><span class="keyword">(</span><span class="staexp">l</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">vtypedef</span> <span class="staexp">vStrptr0 <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>l<span class="keyword">:</span>agez<span class="keyword">]</span></span> <span class="staexp">vstrptr</span><span class="keyword">(</span><span class="staexp">l</span><span class="keyword">)</span></span>
<span class="keyword">vtypedef</span> <span class="staexp">vStrptr1 <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>l<span class="keyword">:</span>addr <span class="keyword">|</span> l <span class="keyword">&gt;</span> null<span class="keyword">]</span></span> <span class="staexp">vstrptr</span><span class="keyword">(</span><span class="staexp">l</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">typedef</span>
<span class="staexp">bottom_t0ype_uni <span class="keyword">=</span> <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span><span class="keyword">t@ype</span><span class="keyword">}</span></span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span>
<span class="staexp">bottom_t0ype_exi <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>a<span class="keyword">:</span><span class="keyword">t@ype</span> <span class="keyword">|</span> false<span class="keyword">]</span></span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>

<span class="keyword">vtypedef</span>
<span class="staexp">bottom_vt0ype_uni <span class="keyword">=</span> <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span><span class="keyword">vt@ype</span><span class="keyword">}</span></span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="keyword">vtypedef</span>
<span class="staexp">bottom_vt0ype_exi <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>a<span class="keyword">:</span><span class="keyword">vt@ype</span> <span class="keyword">|</span> false<span class="keyword">]</span></span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="keyword">typedef</span>
<span class="staexp">cmpval_fun
  <span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span> <span class="keyword">t@ype</span></span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">a</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp"><span class="keyword">fun</span></span><span class="keyword">&gt;</span> <span class="staexp">int</span></span>
<span class="keyword">typedef</span>
<span class="staexp">cmpval_funenv
  <span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span> <span class="keyword">t@ype</span></span><span class="keyword">,</span> <span class="staexp">vt<span class="keyword">:</span> <span class="keyword">t@ype</span></span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">a</span><span class="keyword">,</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">vt</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp"><span class="keyword">fun</span></span><span class="keyword">&gt;</span> <span class="staexp">int</span></span>
<span class="comment">//</span>
<span class="keyword">stadef</span> <span class="staexp">cmpval <span class="keyword">=</span> <span class="staexp">cmpval_fun</span></span> <span class="keyword">and</span> <span class="staexp">cmpval <span class="keyword">=</span> <span class="staexp">cmpval_funenv</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="keyword">typedef</span>
<span class="staexp">cmpref_fun
  <span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span> <span class="keyword">vt@ype</span></span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="staexp">&amp;</span><span class="staexp">RD</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">&amp;</span><span class="staexp">RD</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp"><span class="keyword">fun</span></span><span class="keyword">&gt;</span> <span class="staexp">int</span></span>
<span class="keyword">typedef</span>
<span class="staexp">cmpref_funenv
  <span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span> <span class="keyword">vt@ype</span></span><span class="keyword">,</span> <span class="staexp">vt<span class="keyword">:</span> <span class="keyword">vt@ype</span></span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="staexp">&amp;</span><span class="staexp">RD</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">&amp;</span><span class="staexp">RD</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">vt</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp"><span class="keyword">fun</span></span><span class="keyword">&gt;</span> <span class="staexp">int</span></span>
<span class="comment">//</span>
<span class="keyword">stadef</span> <span class="staexp">cmpref <span class="keyword">=</span> <span class="staexp">cmpref_fun</span></span> <span class="keyword">and</span> <span class="staexp">cmpref <span class="keyword">=</span> <span class="staexp">cmpref_funenv</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">// HX: [lazy(T)] :</span>
<span class="comment">// suspended evaluation of type T</span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">abstype</span>
lazy_t0ype_type<span class="keyword">(</span><span class="keyword">t@ype+</span><span class="keyword">)</span> <span class="keyword">=</span> ptr</span>
<span class="keyword">typedef</span>
<span class="staexp">lazy<span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span><span class="keyword">t@ype</span></span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">lazy_t0ype_type</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">// HX: [lazy_vt(VT)] :</span>
<span class="comment">// suspended computation of viewtype VT</span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">absvtype</span>
lazy_vt0ype_vtype<span class="keyword">(</span><span class="keyword">vt@ype+</span><span class="keyword">)</span> <span class="keyword">=</span> ptr</span>
<span class="keyword">vtypedef</span>
<span class="staexp">lazy_vt<span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span><span class="keyword">vt@ype</span></span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">lazy_vt0ype_vtype</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">(*
//
// HX-2016-02-21:
// these are renamed/relocated elsewhere
//
abst0ype
literal_int(intlit) = $extype"atsliteral_int"
abst0ype
literal_float(float) = $extype"atsliteral_float"
abst1ype
literal_string(string) = $extype"atsliteral_string"
*)</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">abst@ype</span>
undefined_t0ype <span class="keyword">=</span> <span class="keyword">$extype</span>"atstype_undefined"</span>
<span class="staexp"><span class="keyword">absvt@ype</span>
undefined_vt0ype <span class="keyword">=</span> <span class="keyword">$extype</span>"atstype_undefined"</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">#if</span> <span class="neuexp">VERBOSE_PRELUDE</span> <span class="keyword">#then</span>
<span class="neuexp"><span class="keyword">#print</span> "Loading [basics_sta.sats] finishes!\n"</span>
<span class="keyword">#endif</span> <span class="comment">// end of [VERBOSE_PRELUDE]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* end of [basics_sta.sats] *)</span>
</pre>
<pre class="patsyntax">
<span class="comment">(***********************************************************************)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(*                         Applied Type System                         *)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(***********************************************************************)</span>

<span class="comment">(*
** ATS/Postiats - Unleashing the Potential of Types!
** Copyright (C) 2010-2013 Hongwei Xi, ATS Trustful Software, Inc.
** All rights reserved
**
** ATS is free software;  you can  redistribute it and/or modify it under
** the terms of  the GNU GENERAL PUBLIC LICENSE (GPL) as published by the
** Free Software Foundation; either version 3, or (at  your  option)  any
** later version.
**
** ATS is distributed in the hope that it will be useful, but WITHOUT ANY
** WARRANTY; without  even  the  implied  warranty  of MERCHANTABILITY or
** FITNESS FOR A PARTICULAR PURPOSE.  See the  GNU General Public License
** for more details.
**
** You  should  have  received  a  copy of the GNU General Public License
** along  with  ATS;  see the  file COPYING.  If not, please write to the
** Free Software Foundation,  51 Franklin Street, Fifth Floor, Boston, MA
** 02110-1301, USA.
*)</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">// Author of the file:</span>
<span class="comment">// Hongwei Xi (gmhwxiATgmailDOTcom)</span>
<span class="comment">// Start Time: September, 2011</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="neuexp"><span class="keyword">#include</span> "prelude/params.hats"</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">#if</span> <span class="neuexp">VERBOSE_PRELUDE</span> <span class="keyword">#then</span>
<span class="neuexp"><span class="keyword">#print</span> "Loading [basics_dyn.sats] starts!\n"</span>
<span class="keyword">#endif</span> <span class="comment">// end of [VERBOSE_PRELUDE]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">sortdef</span> t0p <span class="keyword">=</span> <span class="keyword">t@ype</span> <span class="keyword">and</span> vt0p <span class="keyword">=</span> <span class="keyword">vt@ype</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">datatype</span> <span class="staexp">TYPE<span class="keyword">(</span>a<span class="keyword">:</span><span class="keyword">vt@ype</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="dynexp">TYPE<span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span> <span class="keyword">of</span> <span class="keyword">(</span><span class="keyword">)</span></span></span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">// HX-2012: In $ATSHOME/ccomp/runtime:</span>
<span class="comment">// atsbool_true/atsbool_false are mapped to 1/0</span>
<span class="comment">// this mapping is fixed and should never be changed!</span>
<span class="comment">//</span>
<span class="neuexp"><span class="keyword">#define</span> true true_bool</span> <span class="comment">// shorthand</span>
<span class="neuexp"><span class="keyword">#define</span> false false_bool</span> <span class="comment">// shorthand</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> true_bool <span class="keyword">:</span> <span class="staexp">bool</span><span class="keyword">(</span><span class="staexp">true</span><span class="keyword">)</span>  <span class="keyword">=</span> "mac#atsbool_true"</span> <span class="comment">// = 1</span>
<span class="dynexp"><span class="keyword">val</span> false_bool <span class="keyword">:</span> <span class="staexp">bool</span><span class="keyword">(</span><span class="staexp">false</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#atsbool_false"</span> <span class="comment">// = 0</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">// HX: [false] implies all</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prfun</span> false_elim<span class="staexp"><span class="keyword">{</span>X<span class="keyword">:</span>prop <span class="keyword">|</span> false<span class="keyword">}</span></span> <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">X</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="keyword">typedef</span>
<span class="staexp">compopr_type<span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span> <span class="keyword">t@ype</span></span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">a</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">fun0</span><span class="keyword">&gt;</span> <span class="staexp">bool</span></span>
<span class="keyword">typedef</span>
<span class="staexp">compare_type<span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span> <span class="keyword">t@ype</span></span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">a</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">fun0</span><span class="keyword">&gt;</span> <span class="staexp">int</span></span><span class="comment">(*-/0/+*)</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">praxi</span>
lemma_subcls_reflexive
  <span class="staexp"><span class="keyword">{</span>c<span class="keyword">:</span>cls<span class="keyword">}</span></span><span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><span class="keyword">[</span>c &lt;= c<span class="keyword">]</span></span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">praxi</span>
lemma_subcls_transitive
  <span class="staexp"><span class="keyword">{</span>c1<span class="keyword">,</span>c2<span class="keyword">,</span>c3<span class="keyword">:</span>cls <span class="keyword">|</span> c1 &lt;= c2<span class="keyword">;</span> c2 &lt;= c3<span class="keyword">}</span></span><span class="keyword">(</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><span class="keyword">[</span>c1 &lt;= c3<span class="keyword">]</span></span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">praxi</span>
praxi_int<span class="staexp"><span class="keyword">{</span>i<span class="keyword">:</span>int<span class="keyword">}</span></span> <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">(</span><span class="staexp">i</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">dataprop</span>
<span class="staexp">MUL_prop
<span class="keyword">(</span>
  int<span class="keyword">,</span> int<span class="keyword">,</span> int
<span class="keyword">)</span> <span class="keyword">=</span> <span class="comment">// MUL_prop</span>
  <span class="keyword">|</span> <span class="prfexp"><span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
    MULbas <span class="keyword">(</span><span class="staexp">0</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">,</span> <span class="staexp">0</span><span class="keyword">)</span></span>
  <span class="keyword">|</span> <span class="prfexp"><span class="staexp"><span class="keyword">{</span>m<span class="keyword">:</span>nat<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>p<span class="keyword">:</span>int<span class="keyword">}</span></span>
    MULind <span class="keyword">(</span><span class="staexp">m</span><span class="staexp">+</span><span class="staexp">1</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">,</span> <span class="staexp">p</span><span class="staexp">+</span><span class="staexp">n</span><span class="keyword">)</span> <span class="keyword">of</span> <span class="staexp">MUL_prop</span> <span class="keyword">(</span><span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">,</span> <span class="staexp">p</span><span class="keyword">)</span></span>
  <span class="keyword">|</span> <span class="prfexp"><span class="staexp"><span class="keyword">{</span>m<span class="keyword">:</span>pos<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>p<span class="keyword">:</span>int<span class="keyword">}</span></span>
    MULneg <span class="keyword">(</span><span class="staexp"><span class="keyword">~</span></span><span class="keyword">(</span><span class="staexp">m</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">,</span> <span class="staexp"><span class="keyword">~</span></span><span class="keyword">(</span><span class="staexp">p</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">of</span> <span class="staexp">MUL_prop</span> <span class="keyword">(</span><span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">,</span> <span class="staexp">p</span><span class="keyword">)</span></span></span>
<span class="comment">//</span>
<span class="keyword">propdef</span> <span class="staexp">MUL<span class="keyword">(</span><span class="staexp">m<span class="keyword">:</span>int</span><span class="keyword">,</span> <span class="staexp">n<span class="keyword">:</span>int</span><span class="keyword">,</span> <span class="staexp">mn<span class="keyword">:</span>int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">MUL_prop</span><span class="keyword">(</span><span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">,</span> <span class="staexp">mn</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">// HX-2010-12-30: </span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">absprop</span>
DIVMOD <span class="keyword">(</span>
  x<span class="keyword">:</span>int<span class="keyword">,</span> y<span class="keyword">:</span> int<span class="keyword">,</span> q<span class="keyword">:</span> int<span class="keyword">,</span> r<span class="keyword">:</span> int <span class="comment">// x = q * y + r</span>
<span class="keyword">)</span></span> <span class="comment">// end of [DIVMOD]</span>
<span class="comment">//</span>
<span class="keyword">propdef</span> <span class="staexp">DIV <span class="keyword">(</span><span class="staexp">x<span class="keyword">:</span>int</span><span class="keyword">,</span> <span class="staexp">y<span class="keyword">:</span>int</span><span class="keyword">,</span> <span class="staexp">q<span class="keyword">:</span>int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>r<span class="keyword">:</span>int<span class="keyword">]</span></span> <span class="staexp">DIVMOD</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">y</span><span class="keyword">,</span> <span class="staexp">q</span><span class="keyword">,</span> <span class="staexp">r</span><span class="keyword">)</span></span>
<span class="keyword">propdef</span> <span class="staexp">MOD <span class="keyword">(</span><span class="staexp">x<span class="keyword">:</span>int</span><span class="keyword">,</span> <span class="staexp">y<span class="keyword">:</span>int</span><span class="keyword">,</span> <span class="staexp">r<span class="keyword">:</span>int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>q<span class="keyword">:</span>int<span class="keyword">]</span></span> <span class="staexp">DIVMOD</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">y</span><span class="keyword">,</span> <span class="staexp">q</span><span class="keyword">,</span> <span class="staexp">r</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">dataprop</span>
<span class="staexp">EQINT<span class="keyword">(</span>int<span class="keyword">,</span> int<span class="keyword">)</span> <span class="keyword">=</span> <span class="prfexp"><span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>int<span class="keyword">}</span></span> EQINT<span class="keyword">(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">x</span><span class="keyword">)</span></span></span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prfun</span>
eqint_make<span class="staexp"><span class="keyword">{</span>x<span class="keyword">,</span>y<span class="keyword">:</span>int <span class="keyword">|</span> x == y<span class="keyword">}</span></span><span class="keyword">(</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">EQINT</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">y</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prfun</span>
eqint_make_gint
  <span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>int<span class="keyword">}</span></span><span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">g1int</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">x</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><span class="keyword">[</span>y<span class="keyword">:</span>int<span class="keyword">]</span></span> <span class="staexp">EQINT</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">y</span><span class="keyword">)</span></span>
<span class="prfexp"><span class="keyword">prfun</span>
eqint_make_guint
  <span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>int<span class="keyword">}</span></span><span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">g1uint</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">x</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><span class="keyword">[</span>y<span class="keyword">:</span>int<span class="keyword">]</span></span> <span class="staexp">EQINT</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">y</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="prfexp"><span class="keyword">praxi</span> praxi_ptr<span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span> <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">ptr</span><span class="keyword">(</span><span class="staexp">l</span><span class="keyword">)</span></span>
<span class="prfexp"><span class="keyword">praxi</span> praxi_bool<span class="staexp"><span class="keyword">{</span>b<span class="keyword">:</span>bool<span class="keyword">}</span></span> <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">bool</span><span class="keyword">(</span><span class="staexp">b</span><span class="keyword">)</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">dataprop</span>
<span class="staexp">EQADDR<span class="keyword">(</span>addr<span class="keyword">,</span> addr<span class="keyword">)</span> <span class="keyword">=</span> <span class="prfexp"><span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>addr<span class="keyword">}</span></span> EQADDR<span class="keyword">(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">x</span><span class="keyword">)</span></span></span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prfun</span>
eqaddr_make<span class="staexp"><span class="keyword">{</span>x<span class="keyword">,</span>y<span class="keyword">:</span>addr <span class="keyword">|</span> x == y<span class="keyword">}</span></span><span class="keyword">(</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">EQADDR</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">y</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prfun</span>
eqaddr_make_ptr<span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>addr<span class="keyword">}</span></span><span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">ptr</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><span class="keyword">[</span>y<span class="keyword">:</span>addr<span class="keyword">]</span></span> <span class="staexp">EQADDR</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">y</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">dataprop</span>
<span class="staexp">EQBOOL<span class="keyword">(</span>bool<span class="keyword">,</span> bool<span class="keyword">)</span> <span class="keyword">=</span> <span class="prfexp"><span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>bool<span class="keyword">}</span></span> EQBOOL<span class="keyword">(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">x</span><span class="keyword">)</span></span></span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prfun</span>
eqbool_make<span class="staexp"><span class="keyword">{</span>x<span class="keyword">,</span>y<span class="keyword">:</span>bool <span class="keyword">|</span> x == y<span class="keyword">}</span></span><span class="keyword">(</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">EQBOOL</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">y</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prfun</span>
eqbool_make_bool<span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>bool<span class="keyword">}</span></span><span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">bool</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><span class="keyword">[</span>y<span class="keyword">:</span>bool<span class="keyword">]</span></span> <span class="staexp">EQBOOL</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">y</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="keyword">dataprop</span>
<span class="staexp">EQTYPE<span class="keyword">(</span><span class="keyword">vt@ype</span><span class="keyword">,</span> <span class="keyword">vt@ype</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="prfexp"><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span><span class="keyword">vt@ype</span><span class="keyword">}</span></span> EQTYPE <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">a</span><span class="keyword">)</span></span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="prfexp"><span class="keyword">prfun</span>
prop_verify<span class="staexp"><span class="keyword">{</span>b<span class="keyword">:</span>bool <span class="keyword">|</span> b<span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="staexp">prf</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span>
<span class="prfexp"><span class="keyword">prfun</span>
prop_verify_and_add<span class="staexp"><span class="keyword">{</span>b<span class="keyword">:</span>bool <span class="keyword">|</span> b<span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="staexp">prf</span><span class="keyword">&gt;</span> <span class="staexp"><span class="keyword">[</span>b<span class="keyword">]</span></span> <span class="staexp">void</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="prfexp"><span class="keyword">prfun</span> pridentity_v<span class="staexp"><span class="keyword">{</span>v<span class="keyword">:</span>view<span class="keyword">}</span></span> <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">v</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="prfexp"><span class="keyword">prfun</span> pridentity_vt<span class="staexp"><span class="keyword">{</span>vt<span class="keyword">:</span><span class="keyword">viewt@ype</span><span class="keyword">}</span></span> <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">vt</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">castfn</span>
viewptr_match
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span><span class="keyword">vt0ype</span><span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>l1<span class="keyword">,</span>l2<span class="keyword">:</span>addr<span class="keyword">|</span>l1==l2<span class="keyword">}</span></span>
<span class="keyword">(</span>
  <span class="prfexp">pf<span class="keyword">:</span> <span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span> <span class="staexp"><span class="keyword">@</span></span> <span class="staexp">l1</span></span> <span class="keyword">|</span> p<span class="keyword">:</span> <span class="staexp">ptr</span><span class="keyword">(</span><span class="staexp">l2</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp"><span class="keyword">[</span>l<span class="keyword">:</span>addr <span class="keyword">|</span> l==l1<span class="keyword">]</span></span> <span class="keyword">(</span><span class="staexp">a</span> <span class="staexp"><span class="keyword">@</span></span> <span class="staexp">l</span> <span class="keyword">|</span> <span class="staexp">ptr</span><span class="keyword">(</span><span class="staexp">l</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">// end of [viewptr_match]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span><span class="keyword">vt0ype</span>
<span class="keyword">}</span></span> sizeof <span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">(</span><span class="staexp">sizeof</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">praxi</span>
lemma_sizeof
  <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span><span class="keyword">vt0ype</span><span class="keyword">}</span></span><span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><span class="keyword">[</span>sizeof<span class="keyword">(</span>a<span class="keyword">)</span> &gt;= 0<span class="keyword">]</span></span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="prfexp"><span class="keyword">praxi</span> topize<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span><span class="keyword">t0ype</span><span class="keyword">}</span></span> <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">a</span><span class="staexp">?</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">castfn</span> dataget<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span><span class="keyword">vt0ype</span><span class="keyword">}</span></span> <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">a</span><span class="staexp">?!</span></span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">// HX: returning the pf to GC</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">praxi</span>
mfree_gc_v_elim
  <span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span> <span class="keyword">(</span>pf<span class="keyword">:</span> <span class="staexp">mfree_gc_v</span> <span class="staexp">l</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="staexp">prf</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span>
<span class="comment">// end of [mfree_gc_v_elim]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="prfexp"><span class="keyword">praxi</span>
mfree_gcngc_v_nullify
  <span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span> <span class="keyword">(</span>
  pf1<span class="keyword">:</span> <span class="staexp">mfree_gc_v</span><span class="keyword">(</span><span class="staexp">l</span><span class="keyword">)</span><span class="keyword">,</span> pf1<span class="keyword">:</span> <span class="staexp">mfree_ngc_v</span><span class="keyword">(</span><span class="staexp">l</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span></span> <span class="comment">// end of [mfree_gcngc_nullify_v]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
cloptr_free
  <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
  <span class="keyword">(</span>pclo<span class="keyword">:</span> <span class="staexp">cloptr</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
lazy_force<span class="keyword">(</span>lazyval<span class="keyword">:</span> <span class="staexp">lazy</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">laz</span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
lazy_vt_force<span class="keyword">(</span>lazyval<span class="keyword">:</span> <span class="staexp">lazy_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">all</span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(*
//
// HX-2016-08:
// this is assumed internally!
//
overload ! with lazy_force of 0
overload ! with lazy_vt_force of 0
*)</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">// HX-2013:</span>
<span class="comment">// macro implemented in [pats_ccomp_instrset]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
lazy_vt_free
  <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
  <span class="keyword">(</span>lazyval<span class="keyword">:</span> <span class="staexp">lazy_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">~</span> <span class="keyword">with</span> lazy_vt_free <span class="keyword">of</span> 0</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">// HX-2014:</span>
<span class="comment">// macro implemented in [pats_ccomp_instrset]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
lazy2cloref
  <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span><span class="keyword">(</span><span class="staexp">lazy</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloref1</span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
// HX-2012-05-23: this seems TOO complicated!
(*
** HX-2012-03: handling read-only views and vtypes
*)
castfn
read_getval // copy out a non-linear value
  {a:t@ype}{s:int}{n:int} (x: !READ (a, s, n)):&lt;&gt; a
// end of [read_getval]

praxi
read_takeout{v:view}
  (pf: !v &gt;&gt; READOUT (v, s)): #[s:int] READ (v, s, 0)
// end of [read_takeout]
praxi
read_addback // HX: there is no need to check
  {v1:view}{v2:view}{s:int} // if v1 and v2 match
  (pf1: !READOUT (v1, s) &gt;&gt; v1, pf2: READ (v2, s, 0)): void
// end of [read0_addback]

praxi
read_split
  {v:view}{s:int}{n:int}
  (pf: !READ (v, s, n) &gt;&gt; READ (v, s, n+1)): READ (v, s, 0)
// end of [read_split]
praxi
read_unsplit // HX: there is no need to check
  {v1:view}{v2:view}{s:int}{n1,n2:int} // if v1 and v2 match
  (pf1: READ (v1, s, n1), pf2: READ (v2, s, n2)): READ (v1, s, n1+n2-1)
// end of [read_unsplit]
*)</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">castfn</span>
stamp_t<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span><span class="keyword">t@ype</span><span class="keyword">}</span></span><span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">stamped_t</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">castfn</span>
stamp_vt<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span><span class="keyword">vt@ype</span><span class="keyword">}</span></span><span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">stamped_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">castfn</span>
unstamp_t
  <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span><span class="keyword">t@ype</span><span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>int<span class="keyword">}</span></span><span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">stamped_t</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">x</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">a</span></span>
<span class="comment">// end of [unstamp_t]</span>
<span class="dynexp"><span class="keyword">castfn</span>
unstamp_vt
  <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span><span class="keyword">vt@ype</span><span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>int<span class="keyword">}</span></span><span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">stamped_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">x</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">a</span></span>
<span class="comment">// end of [unstamp_vt]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">castfn</span>
stamped_t2vt
  <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span><span class="keyword">t@ype</span><span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">stamped_t</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">x</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">stamped_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">x</span><span class="keyword">)</span></span>
<span class="comment">// end of [stamped_t2vt]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">castfn</span>
stamped_vt2t
  <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span><span class="keyword">t@ype</span><span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">stamped_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">x</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">stamped_t</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">x</span><span class="keyword">)</span></span>
<span class="comment">// end of [stamped_vt2t]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span><span class="keyword">t@ype</span><span class="keyword">}</span></span>
stamped_vt2t_ref<span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">stamped_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">x</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">stamped_t</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">x</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">praxi</span>
vcopyenv_v_decode
  <span class="staexp"><span class="keyword">{</span>v<span class="keyword">:</span>view<span class="keyword">}</span></span><span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">vcopyenv_v</span><span class="keyword">(</span><span class="staexp">v</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">vtakeout0</span><span class="keyword">(</span><span class="staexp">v</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">castfn</span>
vcopyenv_vt_decode
  <span class="staexp"><span class="keyword">{</span>vt<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">vcopyenv_vt</span><span class="keyword">(</span><span class="staexp">vt</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">vttakeout0</span><span class="keyword">(</span><span class="staexp">vt</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> decode <span class="keyword">with</span> vcopyenv_v_decode</span>
<span class="dynexp"><span class="keyword">overload</span> decode <span class="keyword">with</span> vcopyenv_vt_decode</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">// HX: the_null_ptr = (void*)0</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span>
the_null_ptr
  <span class="keyword">:</span> <span class="staexp">ptr</span><span class="keyword">(</span><span class="staexp">null</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#atsptr_null"</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">praxi</span>
lemma_addr_param
  <span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span><span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><span class="keyword">[</span>l &gt;= null<span class="keyword">]</span></span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="prfexp"><span class="keyword">praxi</span>
lemma_string_param
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span> <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">string</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><span class="keyword">[</span>n &gt;= 0<span class="keyword">]</span></span> <span class="staexp">void</span></span>
<span class="comment">// end of [lemma_string_param]</span>
<span class="prfexp"><span class="keyword">praxi</span>
lemma_stropt_param
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span> <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">stropt</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><span class="keyword">[</span>n &gt;= <span class="keyword">~</span>1<span class="keyword">]</span></span> <span class="staexp">void</span></span>
<span class="comment">// end of [lemma_stropt_param]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="keyword">dataprop</span>
<span class="staexp">SGN <span class="keyword">(</span>int<span class="keyword">,</span> int<span class="keyword">)</span> <span class="keyword">=</span>
  <span class="keyword">|</span> <span class="prfexp">SGNzero <span class="keyword">(</span><span class="staexp">0</span><span class="keyword">,</span> <span class="staexp">0</span><span class="keyword">)</span></span>
  <span class="keyword">|</span> <span class="prfexp"><span class="staexp"><span class="keyword">{</span>i<span class="keyword">:</span>neg<span class="keyword">}</span></span> SGNneg <span class="keyword">(</span><span class="staexp">i</span><span class="keyword">,</span> <span class="staexp"><span class="keyword">~</span></span><span class="staexp">1</span><span class="keyword">)</span></span> <span class="keyword">|</span> <span class="prfexp"><span class="staexp"><span class="keyword">{</span>i<span class="keyword">:</span>pos<span class="keyword">}</span></span> SGNpos <span class="keyword">(</span><span class="staexp">i</span><span class="keyword">,</span>  <span class="staexp">1</span><span class="keyword">)</span></span></span>
<span class="comment">// end of [SGN] // end of [dataprop]</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">// HX-2012-06:</span>
<span class="comment">// indication of the failure of</span>
<span class="keyword">exception</span> <span class="dynexp">AssertExn <span class="keyword">of</span> <span class="keyword">(</span><span class="keyword">)</span></span> <span class="comment">// an assertion</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">// HX-2012-06:</span>
<span class="comment">// indication of something expected</span>
<span class="keyword">exception</span> <span class="dynexp">NotFoundExn <span class="keyword">of</span> <span class="keyword">(</span><span class="keyword">)</span></span> <span class="comment">// to be found but not</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="keyword">exception</span> <span class="dynexp">GenerallyExn <span class="keyword">of</span> <span class="keyword">(</span><span class="staexp">string</span><span class="keyword">)</span></span> <span class="comment">// for unspecified causes</span>
<span class="comment">(*
exception GenerallyExn2 of (string, ptr(*data*)) // for unspecified causes
*)</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">// HX-2012-07:</span>
<span class="comment">// indication of a function argument being</span>
<span class="keyword">exception</span> <span class="dynexp">IllegalArgExn <span class="keyword">of</span> <span class="keyword">(</span><span class="staexp">string</span><span class="keyword">)</span></span> <span class="comment">// out of its domain</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="prfexp"><span class="keyword">praxi</span> __vfree_exn <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">exn</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span> <span class="comment">// for freeing nullary exception-con</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="keyword">datatype</span> <span class="staexp">unit <span class="keyword">=</span> <span class="dynexp">unit <span class="keyword">of</span> <span class="keyword">(</span><span class="keyword">)</span></span></span>
<span class="keyword">dataprop</span> <span class="staexp">unit_p <span class="keyword">=</span> <span class="prfexp">unit_p <span class="keyword">of</span> <span class="keyword">(</span><span class="keyword">)</span></span></span>
<span class="keyword">dataview</span> <span class="staexp">unit_v <span class="keyword">=</span> <span class="prfexp">unit_v <span class="keyword">of</span> <span class="keyword">(</span><span class="keyword">)</span></span></span>
<span class="keyword">datavtype</span> <span class="staexp">unit_vt <span class="keyword">=</span> <span class="dynexp">unit_vt <span class="keyword">of</span> <span class="keyword">(</span><span class="keyword">)</span></span></span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prfun</span> unit_v_elim <span class="keyword">(</span>pf<span class="keyword">:</span> <span class="staexp">unit_v</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">abstype</span>
boxed_t0ype_type<span class="keyword">(</span>a<span class="keyword">:</span><span class="keyword">t@ype+</span><span class="keyword">)</span> <span class="keyword">=</span> unit</span>
<span class="staexp"><span class="keyword">absvtype</span>
boxed_vt0ype_vtype<span class="keyword">(</span>a<span class="keyword">:</span><span class="keyword">vt@ype+</span><span class="keyword">)</span> <span class="keyword">=</span> unit</span>
<span class="comment">//</span>
<span class="keyword">vtypedef</span>
<span class="staexp">boxed<span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span><span class="keyword">vt@ype</span></span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">boxed_vt0ype_vtype</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="keyword">vtypedef</span>
<span class="staexp">boxed_vt<span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span><span class="keyword">vt@ype</span></span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">boxed_vt0ype_vtype</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">typedef</span> <span class="staexp">boxed<span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span><span class="keyword">t@ype</span></span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">boxed_t0ype_type</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span> <span class="staexp">boxed_t<span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span><span class="keyword">t@ype</span></span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">boxed_t0ype_type</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>type<span class="keyword">}</span></span> box<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span> <span class="staexp"><span class="keyword">-&gt;</span></span> <span class="staexp">boxed_t</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>type<span class="keyword">}</span></span> unbox<span class="keyword">:</span> <span class="staexp">boxed_t</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span> <span class="staexp"><span class="keyword">-&gt;</span></span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vtype<span class="keyword">}</span></span> box_vt<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span> <span class="staexp"><span class="keyword">-&gt;</span></span> <span class="staexp">boxed_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vtype<span class="keyword">}</span></span> unbox_vt<span class="keyword">:</span> <span class="staexp">boxed_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span> <span class="staexp"><span class="keyword">-&gt;</span></span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="keyword">typedef</span>
<span class="staexp">array <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">@[</span><span class="staexp">a</span><span class="keyword">]</span><span class="keyword">[</span><span class="staexp">n</span><span class="keyword">]</span></span>
<span class="keyword">viewdef</span>
<span class="staexp">array_v
  <span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span><span class="keyword">vt@ype</span></span><span class="keyword">,</span> <span class="staexp">l<span class="keyword">:</span>addr</span><span class="keyword">,</span> <span class="staexp">n<span class="keyword">:</span>int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">@[</span><span class="staexp">a</span><span class="keyword">]</span><span class="keyword">[</span><span class="staexp">n</span><span class="keyword">]</span> <span class="staexp"><span class="keyword">@</span></span> <span class="staexp">l</span></span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">absvtype</span>
arrayptr_vt0ype_addr_int_vtype
  <span class="keyword">(</span>a<span class="keyword">:</span><span class="keyword">vt0ype+</span><span class="keyword">,</span> l<span class="keyword">:</span>addr<span class="keyword">,</span> n<span class="keyword">:</span>int<span class="comment">(*size*)</span><span class="keyword">)</span> <span class="keyword">=</span> ptr <span class="keyword">(</span>l<span class="keyword">)</span></span>
<span class="keyword">stadef</span>
<span class="staexp">arrayptr <span class="keyword">=</span> <span class="staexp">arrayptr_vt0ype_addr_int_vtype</span></span>
<span class="keyword">vtypedef</span>
<span class="staexp">arrayptr
  <span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span>vt0p</span><span class="keyword">,</span> <span class="staexp">n<span class="keyword">:</span>int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>l<span class="keyword">:</span>addr<span class="keyword">]</span></span> <span class="staexp">arrayptr</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">abstype</span>
arrayref_vt0ype_int_type
  <span class="keyword">(</span>a<span class="keyword">:</span><span class="keyword">vt@ype</span><span class="comment">(*elt*)</span><span class="keyword">,</span> n<span class="keyword">:</span>int<span class="comment">(*size*)</span><span class="keyword">)</span> <span class="keyword">=</span> ptr</span>
<span class="keyword">stadef</span> <span class="staexp">arrayref <span class="keyword">=</span> <span class="staexp">arrayref_vt0ype_int_type</span></span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">abstype</span>
arrszref_vt0ype_type <span class="keyword">(</span>a<span class="keyword">:</span> <span class="keyword">vt@ype</span><span class="keyword">)</span> <span class="keyword">=</span> ptr</span>
<span class="keyword">stadef</span> <span class="staexp">arrszref <span class="keyword">=</span> <span class="staexp">arrszref_vt0ype_type</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="keyword">datatype</span>
<span class="comment">// t@ype+: covariant</span>
<span class="staexp">list_t0ype_int_type
  <span class="keyword">(</span>a<span class="keyword">:</span><span class="keyword">t@ype+</span><span class="keyword">,</span> int<span class="keyword">)</span> <span class="keyword">=</span>
  <span class="keyword">|</span> <span class="dynexp">list_nil<span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">0</span><span class="keyword">)</span> <span class="keyword">of</span> <span class="keyword">(</span><span class="keyword">)</span></span>
  <span class="keyword">|</span> <span class="dynexp"><span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int <span class="keyword">|</span> n &gt;= 0<span class="keyword">}</span></span>
    list_cons<span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="staexp">+</span><span class="staexp">1</span><span class="keyword">)</span> <span class="keyword">of</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">list_t0ype_int_type</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span></span></span>
<span class="comment">// end of [datatype]</span>
<span class="keyword">stadef</span> <span class="staexp">list <span class="keyword">=</span> <span class="staexp">list_t0ype_int_type</span></span>
<span class="keyword">typedef</span>
<span class="staexp">List <span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span>t0p</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>n<span class="keyword">:</span>int<span class="keyword">]</span></span> <span class="staexp">list</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span>
<span class="staexp">List0 <span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span>t0p</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>n<span class="keyword">:</span>int <span class="keyword">|</span> n &gt;= 0<span class="keyword">]</span></span> <span class="staexp">list</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span>
<span class="staexp">List1 <span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span>t0p</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>n<span class="keyword">:</span>int <span class="keyword">|</span> n &gt;= 1<span class="keyword">]</span></span> <span class="staexp">list</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span> <span class="staexp">listLt
  <span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span>t0p</span><span class="keyword">,</span> <span class="staexp">n<span class="keyword">:</span>int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>k<span class="keyword">:</span>nat <span class="keyword">|</span> k <span class="keyword">&lt;</span> n<span class="keyword">]</span></span> <span class="staexp">list</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">k</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span> <span class="staexp">listLte
  <span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span>t0p</span><span class="keyword">,</span> <span class="staexp">n<span class="keyword">:</span>int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>k<span class="keyword">:</span>nat <span class="keyword">|</span> k &lt;= n<span class="keyword">]</span></span> <span class="staexp">list</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">k</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span> <span class="staexp">listGt
  <span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span>t0p</span><span class="keyword">,</span> <span class="staexp">n<span class="keyword">:</span>int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>k<span class="keyword">:</span>int <span class="keyword">|</span> k <span class="keyword">&gt;</span> n<span class="keyword">]</span></span> <span class="staexp">list</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">k</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span> <span class="staexp">listGte
  <span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span>t0p</span><span class="keyword">,</span> <span class="staexp">n<span class="keyword">:</span>int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>k<span class="keyword">:</span>int <span class="keyword">|</span> k &gt;= n<span class="keyword">]</span></span> <span class="staexp">list</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">k</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span> <span class="staexp">listBtw
  <span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span>t0p</span><span class="keyword">,</span> <span class="staexp">m<span class="keyword">:</span>int</span><span class="keyword">,</span> <span class="staexp">n<span class="keyword">:</span>int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>k<span class="keyword">:</span>int <span class="keyword">|</span> m &lt;= k<span class="keyword">;</span> k <span class="keyword">&lt;</span> n<span class="keyword">]</span></span> <span class="staexp">list</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">k</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span> <span class="staexp">listBtwe
  <span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span>t0p</span><span class="keyword">,</span> <span class="staexp">m<span class="keyword">:</span>int</span><span class="keyword">,</span> <span class="staexp">n<span class="keyword">:</span>int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>k<span class="keyword">:</span>int <span class="keyword">|</span> m &lt;= k<span class="keyword">;</span> k &lt;= n<span class="keyword">]</span></span> <span class="staexp">list</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">k</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="keyword">datavtype</span>
<span class="comment">// vt@ype+: covariant</span>
<span class="staexp">list_vt0ype_int_vtype
  <span class="keyword">(</span>a<span class="keyword">:</span><span class="keyword">vt@ype+</span><span class="keyword">,</span> int<span class="keyword">)</span> <span class="keyword">=</span>
  <span class="keyword">|</span> <span class="dynexp">list_vt_nil <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">0</span><span class="keyword">)</span> <span class="keyword">of</span> <span class="keyword">(</span><span class="keyword">)</span></span>
  <span class="keyword">|</span> <span class="dynexp"><span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int <span class="keyword">|</span> n &gt;= 0<span class="keyword">}</span></span>
    list_vt_cons <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="staexp">+</span><span class="staexp">1</span><span class="keyword">)</span> <span class="keyword">of</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">list_vt0ype_int_vtype</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span></span></span>
<span class="comment">// end of [list_vt0ype_int_vtype]</span>
<span class="keyword">stadef</span> <span class="staexp">list_vt <span class="keyword">=</span> <span class="staexp">list_vt0ype_int_vtype</span></span>
<span class="keyword">vtypedef</span>
<span class="staexp">List_vt <span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span>vt0p</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>n<span class="keyword">:</span>int<span class="keyword">]</span></span> <span class="staexp">list_vt</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="keyword">vtypedef</span>
<span class="staexp">List0_vt <span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span>vt0p</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>n<span class="keyword">:</span>int <span class="keyword">|</span> n &gt;= 0<span class="keyword">]</span></span> <span class="staexp">list_vt</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="keyword">vtypedef</span>
<span class="staexp">List1_vt <span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span>vt0p</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>n<span class="keyword">:</span>int <span class="keyword">|</span> n &gt;= 1<span class="keyword">]</span></span> <span class="staexp">list_vt</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="keyword">vtypedef</span> <span class="staexp">listLt_vt
  <span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span>vt0p</span><span class="keyword">,</span> <span class="staexp">n<span class="keyword">:</span>int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>k<span class="keyword">:</span>nat <span class="keyword">|</span> k <span class="keyword">&lt;</span> n<span class="keyword">]</span></span> <span class="staexp">list_vt</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">k</span><span class="keyword">)</span></span>
<span class="keyword">vtypedef</span> <span class="staexp">listLte_vt
  <span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span>vt0p</span><span class="keyword">,</span> <span class="staexp">n<span class="keyword">:</span>int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>k<span class="keyword">:</span>nat <span class="keyword">|</span> k &lt;= n<span class="keyword">]</span></span> <span class="staexp">list_vt</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">k</span><span class="keyword">)</span></span>
<span class="keyword">vtypedef</span> <span class="staexp">listGt_vt
  <span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span>vt0p</span><span class="keyword">,</span> <span class="staexp">n<span class="keyword">:</span>int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>k<span class="keyword">:</span>int <span class="keyword">|</span> k <span class="keyword">&gt;</span> n<span class="keyword">]</span></span> <span class="staexp">list_vt</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">k</span><span class="keyword">)</span></span>
<span class="keyword">vtypedef</span> <span class="staexp">listGte_vt
  <span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span>vt0p</span><span class="keyword">,</span> <span class="staexp">n<span class="keyword">:</span>int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>k<span class="keyword">:</span>int <span class="keyword">|</span> k &gt;= n<span class="keyword">]</span></span> <span class="staexp">list_vt</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">k</span><span class="keyword">)</span></span>
<span class="keyword">vtypedef</span> <span class="staexp">listBtw_vt
  <span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span>vt0p</span><span class="keyword">,</span> <span class="staexp">m<span class="keyword">:</span>int</span><span class="keyword">,</span> <span class="staexp">n<span class="keyword">:</span>int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>k<span class="keyword">:</span>int <span class="keyword">|</span> m &lt;= k<span class="keyword">;</span> k <span class="keyword">&lt;</span> n<span class="keyword">]</span></span> <span class="staexp">list_vt</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">k</span><span class="keyword">)</span></span>
<span class="keyword">vtypedef</span> <span class="staexp">listBtwe_vt
  <span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span>vt0p</span><span class="keyword">,</span> <span class="staexp">m<span class="keyword">:</span>int</span><span class="keyword">,</span> <span class="staexp">n<span class="keyword">:</span>int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>k<span class="keyword">:</span>int <span class="keyword">|</span> m &lt;= k<span class="keyword">;</span> k &lt;= n<span class="keyword">]</span></span> <span class="staexp">list_vt</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">k</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="keyword">datatype</span>
<span class="staexp">stream_con<span class="keyword">(</span>a<span class="keyword">:</span><span class="keyword">t@ype+</span><span class="keyword">)</span> <span class="keyword">=</span>
  <span class="keyword">|</span> <span class="dynexp">stream_nil <span class="keyword">of</span> <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span></span>
  <span class="keyword">|</span> <span class="dynexp">stream_cons <span class="keyword">of</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span></span></span>
<span class="comment">//</span>
<span class="keyword">where</span> <span class="staexp">stream <span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span><span class="keyword">t@ype</span></span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">lazy</span> <span class="keyword">(</span><span class="staexp">stream_con</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">datavtype</span>
<span class="staexp">stream_vt_con
  <span class="keyword">(</span>a<span class="keyword">:</span><span class="keyword">vt@ype+</span><span class="keyword">)</span> <span class="keyword">=</span>
  <span class="keyword">|</span> <span class="dynexp">stream_vt_nil <span class="keyword">of</span> <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span></span>
  <span class="keyword">|</span> <span class="dynexp">stream_vt_cons <span class="keyword">of</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span></span></span>
<span class="comment">//</span>
<span class="keyword">where</span>
<span class="staexp">stream_vt<span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span><span class="keyword">vt@ype</span></span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">lazy_vt</span><span class="keyword">(</span><span class="staexp">stream_vt_con</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="keyword">datatype</span>
<span class="comment">// t@ype+: covariant</span>
<span class="staexp">option_t0ype_bool_type
<span class="keyword">(</span>
  a<span class="keyword">:</span><span class="keyword">t@ype+</span><span class="keyword">,</span> bool
<span class="keyword">)</span> <span class="keyword">=</span> <span class="comment">// option_t0ype_bool_type</span>
  <span class="keyword">|</span> <span class="dynexp">Some<span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">true</span><span class="keyword">)</span> <span class="keyword">of</span> <span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span></span> <span class="keyword">|</span> <span class="dynexp">None<span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">false</span><span class="keyword">)</span></span></span>
<span class="comment">// end of [datatype]</span>
<span class="keyword">stadef</span> <span class="staexp">option <span class="keyword">=</span> <span class="staexp">option_t0ype_bool_type</span></span>
<span class="keyword">typedef</span> <span class="staexp">Option <span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span>t0p</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>b<span class="keyword">:</span>bool<span class="keyword">]</span></span> <span class="staexp">option</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">b</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">datavtype</span>
<span class="comment">// vt@ype+: covariant</span>
<span class="staexp">option_vt0ype_bool_vtype
<span class="keyword">(</span>
  a<span class="keyword">:</span><span class="keyword">vt@ype+</span><span class="keyword">,</span> bool
<span class="keyword">)</span> <span class="keyword">=</span> <span class="comment">// option_vt0ype_bool_vtype</span>
  <span class="keyword">|</span> <span class="dynexp">Some_vt<span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">true</span><span class="keyword">)</span> <span class="keyword">of</span> <span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span></span> <span class="keyword">|</span> <span class="dynexp">None_vt<span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">false</span><span class="keyword">)</span></span></span>
<span class="comment">// end of [option_vt0ype_bool_vtype]</span>
<span class="keyword">stadef</span> <span class="staexp">option_vt <span class="keyword">=</span> <span class="staexp">option_vt0ype_bool_vtype</span></span>
<span class="keyword">vtypedef</span> <span class="staexp">Option_vt <span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span>vt0p</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>b<span class="keyword">:</span>bool<span class="keyword">]</span></span> <span class="staexp">option_vt</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">b</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">praxi</span>
opt_some<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
  <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">opt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">true</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="staexp">prf</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span>
<span class="prfexp"><span class="keyword">praxi</span>
opt_unsome<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
  <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">opt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">true</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="staexp">prf</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
opt_unsome_get<span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">opt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">true</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">a</span><span class="staexp">?</span><span class="keyword">)</span><span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">praxi</span>
opt_none<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
  <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="keyword">(</span><span class="staexp">a</span><span class="staexp">?</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">opt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">false</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="staexp">prf</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span>
<span class="prfexp"><span class="keyword">praxi</span>
opt_unnone<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
  <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">opt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">false</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">a</span><span class="staexp">?</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="staexp">prf</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">praxi</span>
opt_clear<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
  <span class="staexp"><span class="keyword">{</span>b<span class="keyword">:</span>bool<span class="keyword">}</span></span><span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">opt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">b</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">a</span><span class="staexp">?</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="staexp">prf</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="keyword">dataprop</span>
<span class="staexp">or_prop_prop_int_prop
<span class="keyword">(</span>
  a0<span class="keyword">:</span> <span class="keyword">prop+</span><span class="keyword">,</span> a1<span class="keyword">:</span> <span class="keyword">prop+</span><span class="keyword">,</span> int
<span class="keyword">)</span> <span class="keyword">=</span> <span class="comment">// or_prop_prop_int_prop</span>
  <span class="keyword">|</span> <span class="prfexp">POR_l<span class="keyword">(</span><span class="staexp">a0</span><span class="keyword">,</span> <span class="staexp">a1</span><span class="keyword">,</span> <span class="staexp">0</span><span class="keyword">)</span> <span class="keyword">of</span> <span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a0</span><span class="keyword">)</span><span class="keyword">)</span></span>
  <span class="keyword">|</span> <span class="prfexp">POR_r<span class="keyword">(</span><span class="staexp">a0</span><span class="keyword">,</span> <span class="staexp">a1</span><span class="keyword">,</span> <span class="staexp">1</span><span class="keyword">)</span> <span class="keyword">of</span> <span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a1</span><span class="keyword">)</span><span class="keyword">)</span></span></span>
<span class="keyword">dataview</span>
<span class="staexp">or_view_view_int_view
<span class="keyword">(</span>
  a0<span class="keyword">:</span> <span class="keyword">view+</span><span class="keyword">,</span> a1<span class="keyword">:</span> <span class="keyword">view+</span><span class="keyword">,</span> int
<span class="keyword">)</span> <span class="keyword">=</span> <span class="comment">// or_view_view_int_view</span>
  <span class="keyword">|</span> <span class="prfexp">VOR_l<span class="keyword">(</span><span class="staexp">a0</span><span class="keyword">,</span> <span class="staexp">a1</span><span class="keyword">,</span> <span class="staexp">0</span><span class="keyword">)</span> <span class="keyword">of</span> <span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a0</span><span class="keyword">)</span><span class="keyword">)</span></span>
  <span class="keyword">|</span> <span class="prfexp">VOR_r<span class="keyword">(</span><span class="staexp">a0</span><span class="keyword">,</span> <span class="staexp">a1</span><span class="keyword">,</span> <span class="staexp">1</span><span class="keyword">)</span> <span class="keyword">of</span> <span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a1</span><span class="keyword">)</span><span class="keyword">)</span></span></span>
<span class="comment">//</span>
<span class="keyword">stadef</span> <span class="staexp">por <span class="keyword">=</span> <span class="staexp">or_prop_prop_int_prop</span></span>
<span class="keyword">stadef</span> <span class="staexp">vor <span class="keyword">=</span> <span class="staexp">or_view_view_int_view</span></span>
<span class="comment">//</span>
<span class="keyword">dataprop</span>
<span class="staexp">option_prop_bool_prop
<span class="keyword">(</span>
  a<span class="keyword">:</span><span class="keyword">prop+</span><span class="keyword">,</span> bool
<span class="keyword">)</span> <span class="keyword">=</span> <span class="comment">// option_prop_bool_prop</span>
  <span class="keyword">|</span> <span class="prfexp">Some_p <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">true</span><span class="keyword">)</span> <span class="keyword">of</span> <span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span></span> <span class="keyword">|</span> <span class="prfexp">None_p <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">false</span><span class="keyword">)</span></span></span>
<span class="comment">// end of [option_prop_bool_prop]</span>
<span class="keyword">stadef</span> <span class="staexp">option_p <span class="keyword">=</span> <span class="staexp">option_prop_bool_prop</span></span>
<span class="comment">//</span>
<span class="keyword">dataview</span>
<span class="staexp">option_view_bool_view
  <span class="keyword">(</span>a<span class="keyword">:</span><span class="keyword">view+</span><span class="keyword">,</span> bool<span class="keyword">)</span> <span class="keyword">=</span>
  <span class="keyword">|</span> <span class="prfexp">Some_v <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">true</span><span class="keyword">)</span> <span class="keyword">of</span> <span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span></span> <span class="keyword">|</span> <span class="prfexp">None_v <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">false</span><span class="keyword">)</span></span></span>
<span class="comment">// end of [option_view_bool_view]</span>
<span class="keyword">stadef</span> <span class="staexp">option_v <span class="keyword">=</span> <span class="staexp">option_view_bool_view</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">absvt@ype</span>
arrayopt <span class="keyword">(</span>a<span class="keyword">:</span>vt0p<span class="keyword">,</span> n<span class="keyword">:</span>int<span class="keyword">,</span> b<span class="keyword">:</span>bool<span class="keyword">)</span> <span class="keyword">=</span> array <span class="keyword">(</span>a<span class="keyword">,</span> n<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">praxi</span>
arrayopt_some
  <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>A<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">array</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">arrayopt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">,</span> <span class="staexp">true</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="prfexp"><span class="keyword">praxi</span>
arrayopt_none
  <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>A<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">array</span><span class="keyword">(</span><span class="staexp">a</span><span class="staexp">?</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">arrayopt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">,</span> <span class="staexp">false</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="prfexp"><span class="keyword">praxi</span>
arrayopt_unsome
  <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>A<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">arrayopt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">,</span> <span class="staexp">true</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">array</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="prfexp"><span class="keyword">praxi</span>
arrayopt_unnone
  <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>A<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">arrayopt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">,</span> <span class="staexp">false</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">array</span><span class="keyword">(</span><span class="staexp">a</span><span class="staexp">?</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="staexp"><span class="keyword">absvtype</span>
argv_int_vtype <span class="keyword">(</span>n<span class="keyword">:</span>int<span class="keyword">)</span> <span class="keyword">=</span> ptr</span>
<span class="keyword">stadef</span> <span class="staexp">argv <span class="keyword">=</span> <span class="staexp">argv_int_vtype</span></span>

<span class="comment">(*
[argv_takeout_strarr] is declared in prelude/SATS/extern.sats
[argv_takeout_parrnull] is declared in prelude/SATS/extern.sats
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="prfexp"><span class="keyword">praxi</span>
lemma_argv_param <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span> <span class="keyword">(</span>argv<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">argv</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><span class="keyword">[</span>n &gt;= 0<span class="keyword">]</span></span> <span class="staexp">void</span></span>
<span class="comment">// end of [praxi]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
argv_get_at<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>argv<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">argv</span> <span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">natLt</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">string</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span>
argv_set_at<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>argv<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">argv</span> <span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">natLt</span> <span class="staexp">n</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="staexp">string</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">[</span><span class="keyword">]</span> <span class="keyword">with</span> argv_get_at</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">[</span><span class="keyword">]</span> <span class="keyword">with</span> argv_set_at</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="neuexp"><span class="keyword">symintr</span> main0</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
main_void_0
  <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> "ext#mainats_void_0"</span>
<span class="dynexp"><span class="keyword">fun</span>
main_argc_argv_0
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int <span class="keyword">|</span> n &gt;= 1<span class="keyword">}</span></span>
  <span class="keyword">(</span>argc<span class="keyword">:</span> <span class="staexp">int</span> <span class="staexp">n</span><span class="keyword">,</span> argv<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">argv</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> "ext#mainats_argc_argv_0"</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> main0 <span class="keyword">with</span> main_void_0</span>
<span class="dynexp"><span class="keyword">overload</span> main0 <span class="keyword">with</span> main_argc_argv_0</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="neuexp"><span class="keyword">symintr</span> main</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
main_void_int
  <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">int</span> <span class="keyword">=</span> "ext#mainats_void_int"</span>
<span class="dynexp"><span class="keyword">fun</span>
main_argc_argv_int
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int <span class="keyword">|</span> n &gt;= 1<span class="keyword">}</span></span>
  <span class="keyword">(</span>argc<span class="keyword">:</span> <span class="staexp">int</span> <span class="staexp">n</span><span class="keyword">,</span> argv<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">argv</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">int</span> <span class="keyword">=</span> "ext#mainats_argc_argv_int"</span>
<span class="dynexp"><span class="keyword">fun</span>
main_argc_argv_envp_int
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int <span class="keyword">|</span> n &gt;= 1<span class="keyword">}</span></span>
  <span class="keyword">(</span>argc<span class="keyword">:</span> <span class="staexp">int</span> <span class="staexp">n</span><span class="keyword">,</span> argv<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">argv</span> <span class="staexp">n</span><span class="keyword">,</span> envp<span class="keyword">:</span> <span class="staexp">ptr</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">int</span> <span class="keyword">=</span> "ext#mainats_argc_argv_envp_int"</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> main <span class="keyword">with</span> main_void_int</span>
<span class="dynexp"><span class="keyword">overload</span> main <span class="keyword">with</span> main_argc_argv_int</span>
<span class="dynexp"><span class="keyword">overload</span> main <span class="keyword">with</span> main_argc_argv_envp_int</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
exit<span class="keyword">(</span>ecode<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">exn</span><span class="keyword">&gt;</span> <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span>
exit_errmsg
  <span class="keyword">(</span>ecode<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> msg<span class="keyword">:</span> <span class="staexp">string</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">exn</span><span class="keyword">&gt;</span> <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">//</span>
<span class="comment">(*
fun exit_fprintf{ts:types}
(
  ecode: int, out: FILEref, fmt: printf_c ts, args: ts
) :&lt;!exn&gt; {a:vt0p}(a) = "mac#%" // end of [exit_fprintf]
*)</span>
<span class="comment">//</span>
<span class="comment">(* *****p* ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
exit_void
  <span class="keyword">(</span>ecode<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">exn</span><span class="keyword">&gt;</span> <span class="staexp">void</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span>
exit_errmsg_void
  <span class="keyword">(</span>ecode<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> msg<span class="keyword">:</span> <span class="staexp">string</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">exn</span><span class="keyword">&gt;</span> <span class="staexp">void</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
assert_bool0
  <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">bool</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">exn</span><span class="keyword">&gt;</span> <span class="staexp">void</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span>
assert_bool1
  <span class="staexp"><span class="keyword">{</span>b<span class="keyword">:</span>bool<span class="keyword">}</span></span> <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">bool</span> <span class="keyword">(</span><span class="staexp">b</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">exn</span><span class="keyword">&gt;</span> <span class="staexp"><span class="keyword">[</span>b<span class="keyword">]</span></span> <span class="staexp">void</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> assert <span class="keyword">with</span> assert_bool0 <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> assert <span class="keyword">with</span> assert_bool1 <span class="keyword">of</span> 10</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
assertexn_bool0 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">bool</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">exn</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
assertexn_bool1 <span class="staexp"><span class="keyword">{</span>b<span class="keyword">:</span>bool<span class="keyword">}</span></span> <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">bool</span> <span class="keyword">(</span><span class="staexp">b</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">exn</span><span class="keyword">&gt;</span> <span class="staexp"><span class="keyword">[</span>b<span class="keyword">]</span></span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="neuexp"><span class="keyword">symintr</span> assertexn</span>
<span class="dynexp"><span class="keyword">overload</span> assertexn <span class="keyword">with</span> assertexn_bool0 <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> assertexn <span class="keyword">with</span> assertexn_bool1 <span class="keyword">of</span> 10</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
assert_errmsg_bool0
  <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">bool</span><span class="keyword">,</span> msg<span class="keyword">:</span> <span class="staexp">string</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">exn</span><span class="keyword">&gt;</span> <span class="staexp">void</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span>
assert_errmsg_bool1
  <span class="staexp"><span class="keyword">{</span>b<span class="keyword">:</span>bool<span class="keyword">}</span></span> <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">bool</span> <span class="staexp">b</span><span class="keyword">,</span> msg<span class="keyword">:</span> <span class="staexp">string</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">exn</span><span class="keyword">&gt;</span> <span class="staexp"><span class="keyword">[</span>b<span class="keyword">]</span></span> <span class="staexp">void</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">//</span>
<span class="neuexp"><span class="keyword">symintr</span> assert_errmsg</span>
<span class="dynexp"><span class="keyword">overload</span> assert_errmsg <span class="keyword">with</span> assert_errmsg_bool0 <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> assert_errmsg <span class="keyword">with</span> assert_errmsg_bool1 <span class="keyword">of</span> 10</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
assert_errmsg2_bool0
  <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">bool</span><span class="keyword">,</span> msg1<span class="keyword">:</span> <span class="staexp">string</span><span class="keyword">,</span> msg2<span class="keyword">:</span> <span class="staexp">string</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">exn</span><span class="keyword">&gt;</span> <span class="staexp">void</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span>
assert_errmsg2_bool1<span class="staexp"><span class="keyword">{</span>b<span class="keyword">:</span>bool<span class="keyword">}</span></span>
  <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">bool</span> <span class="staexp">b</span><span class="keyword">,</span> msg1<span class="keyword">:</span> <span class="staexp">string</span><span class="keyword">,</span> msg2<span class="keyword">:</span> <span class="staexp">string</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">exn</span><span class="keyword">&gt;</span> <span class="staexp"><span class="keyword">[</span>b<span class="keyword">]</span></span> <span class="staexp">void</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">//</span>
<span class="neuexp"><span class="keyword">symintr</span> assert_errmsg2</span>
<span class="dynexp"><span class="keyword">overload</span> assert_errmsg2 <span class="keyword">with</span> assert_errmsg2_bool0 <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> assert_errmsg2 <span class="keyword">with</span> assert_errmsg2_bool1 <span class="keyword">of</span> 10</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">datasort</span>
file_mode <span class="keyword">=</span>
  <span class="keyword">|</span> file_mode_r <span class="comment">(* read *)</span>
  <span class="keyword">|</span> file_mode_w <span class="comment">(* write *)</span>
  <span class="keyword">|</span> file_mode_rw</span> <span class="comment">(* read and write *)</span>
<span class="comment">// end of [file_mode]</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">local</span>
<span class="comment">//</span>
<span class="keyword">stadef</span> <span class="staexp">r<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">file_mode_r</span><span class="keyword">(</span><span class="keyword">)</span></span>
<span class="keyword">stadef</span> <span class="staexp">w<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">file_mode_w</span><span class="keyword">(</span><span class="keyword">)</span></span>
<span class="keyword">stadef</span> <span class="staexp">rw<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">file_mode_rw</span><span class="keyword">(</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span> <span class="comment">(* in-of-local *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="staexp"><span class="keyword">abstype</span>
file_mode <span class="keyword">(</span>file_mode<span class="keyword">)</span> <span class="keyword">=</span> string</span>
<span class="keyword">typedef</span>
<span class="staexp">file_mode <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>fm<span class="keyword">:</span>file_mode<span class="keyword">]</span></span> <span class="staexp">file_mode</span> <span class="keyword">(</span><span class="staexp">fm</span><span class="keyword">)</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="staexp"><span class="keyword">sortdef</span> fmode <span class="keyword">=</span> file_mode</span>
<span class="keyword">typedef</span> <span class="staexp">fmode <span class="keyword">(</span><span class="staexp">fm<span class="keyword">:</span>fmode</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">file_mode</span> <span class="keyword">(</span><span class="staexp">fm</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span> <span class="staexp">fmode <span class="keyword">=</span> <span class="staexp">file_mode</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">dataprop</span>
<span class="staexp">file_mode_lte
  <span class="keyword">(</span>fmode<span class="keyword">,</span> fmode<span class="keyword">)</span> <span class="keyword">=</span>
  <span class="keyword">|</span> <span class="prfexp"><span class="staexp"><span class="keyword">{</span>m<span class="keyword">:</span>fmode<span class="keyword">}</span></span> file_mode_lte_refl <span class="keyword">(</span><span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">)</span></span>
  <span class="keyword">|</span> <span class="prfexp"><span class="staexp"><span class="keyword">{</span>m1<span class="keyword">,</span>m2<span class="keyword">,</span>m3<span class="keyword">:</span>fmode<span class="keyword">}</span></span>
    file_mode_lte_tran <span class="keyword">(</span><span class="staexp">m1</span><span class="keyword">,</span> <span class="staexp">m3</span><span class="keyword">)</span> <span class="keyword">of</span>
      <span class="keyword">(</span><span class="staexp">file_mode_lte</span> <span class="keyword">(</span><span class="staexp">m1</span><span class="keyword">,</span> <span class="staexp">m2</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">file_mode_lte</span> <span class="keyword">(</span><span class="staexp">m2</span><span class="keyword">,</span> <span class="staexp">m3</span><span class="keyword">)</span><span class="keyword">)</span></span>
  <span class="keyword">|</span> <span class="prfexp"><span class="staexp"><span class="keyword">{</span>m<span class="keyword">:</span>fmode<span class="keyword">}</span></span> file_mode_lte_rw_r <span class="keyword">(</span><span class="staexp">rw</span><span class="keyword">(</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">r</span><span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">of</span> <span class="keyword">(</span><span class="keyword">)</span></span>
  <span class="keyword">|</span> <span class="prfexp"><span class="staexp"><span class="keyword">{</span>m<span class="keyword">:</span>fmode<span class="keyword">}</span></span> file_mode_lte_rw_w <span class="keyword">(</span><span class="staexp">rw</span><span class="keyword">(</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">w</span><span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">of</span> <span class="keyword">(</span><span class="keyword">)</span></span></span>
<span class="comment">// end of [file_mode_lte]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span>
file_mode_lte_r_r
  <span class="keyword">:</span> <span class="staexp">file_mode_lte</span> <span class="keyword">(</span><span class="staexp">r</span><span class="keyword">(</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">r</span><span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span></span> <span class="comment">// impled in [filebas_prf.dats]</span>
<span class="prfexp"><span class="keyword">prval</span>
file_mode_lte_w_w
  <span class="keyword">:</span> <span class="staexp">file_mode_lte</span> <span class="keyword">(</span><span class="staexp">w</span><span class="keyword">(</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">w</span><span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span></span> <span class="comment">// impled in [filebas_prf.dats]</span>
<span class="prfexp"><span class="keyword">prval</span>
file_mode_lte_rw_rw
  <span class="keyword">:</span> <span class="staexp">file_mode_lte</span> <span class="keyword">(</span><span class="staexp">rw</span><span class="keyword">(</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">rw</span><span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span></span> <span class="comment">// impled in [filebas_prf.dats]</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">end</span> <span class="comment">// end of [local]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="staexp"><span class="keyword">abstype</span> FILEref_type <span class="keyword">=</span> ptr</span>
<span class="keyword">typedef</span> <span class="staexp">FILEref <span class="keyword">=</span> <span class="staexp">FILEref_type</span></span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="keyword">typedef</span>
<span class="staexp">print_type<span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span> t0p</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span> <span class="staexp"><span class="keyword">-&gt;</span></span> <span class="staexp">void</span></span>
<span class="keyword">typedef</span>
<span class="staexp">prerr_type<span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span> t0p</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span> <span class="staexp"><span class="keyword">-&gt;</span></span> <span class="staexp">void</span></span>
<span class="keyword">typedef</span>
<span class="staexp">fprint_type<span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span> t0p</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="staexp">FILEref</span><span class="keyword">,</span> <span class="staexp">a</span><span class="keyword">)</span> <span class="staexp"><span class="keyword">-&gt;</span></span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="keyword">typedef</span>
<span class="staexp">print_vtype<span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span> vt0p</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="staexp"><span class="keyword">!</span></span><span class="staexp">a</span><span class="keyword">)</span> <span class="staexp"><span class="keyword">-&gt;</span></span> <span class="staexp">void</span></span>
<span class="keyword">typedef</span>
<span class="staexp">prerr_vtype<span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span> vt0p</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="staexp"><span class="keyword">!</span></span><span class="staexp">a</span><span class="keyword">)</span> <span class="staexp"><span class="keyword">-&gt;</span></span> <span class="staexp">void</span></span>
<span class="keyword">typedef</span>
<span class="staexp">fprint_vtype<span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span> vt0p</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="staexp">FILEref</span><span class="keyword">,</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">a</span><span class="keyword">)</span> <span class="staexp"><span class="keyword">-&gt;</span></span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span> print_newline<span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> prerr_newline<span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> fprint_newline<span class="keyword">(</span>out<span class="keyword">:</span> <span class="staexp">FILEref</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> "mac#%"</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">#if</span> <span class="neuexp">VERBOSE_PRELUDE</span> <span class="keyword">#then</span>
<span class="neuexp"><span class="keyword">#print</span> "Loading [basics_dyn.sats] finishes!\n"</span>
<span class="keyword">#endif</span> <span class="comment">// end of [VERBOSE_PRELUDE]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* end of [basics_dyn.sats] *)</span>
</pre>
<pre class="patsyntax">
<span class="comment">(***********************************************************************)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(*                         Applied Type System                         *)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(***********************************************************************)</span>

<span class="comment">(*
** ATS/Postiats - Unleashing the Potential of Types!
** Copyright (C) 2010-2013 Hongwei Xi, ATS Trustful Software, Inc.
** All rights reserved
**
** ATS is free software;  you can  redistribute it and/or modify it under
** the terms of  the GNU GENERAL PUBLIC LICENSE (GPL) as published by the
** Free Software Foundation; either version 3, or (at  your  option)  any
** later version.
**
** ATS is distributed in the hope that it will be useful, but WITHOUT ANY
** WARRANTY; without  even  the  implied  warranty  of MERCHANTABILITY or
** FITNESS FOR A PARTICULAR PURPOSE.  See the  GNU General Public License
** for more details.
**
** You  should  have  received  a  copy of the GNU General Public License
** along  with  ATS;  see the  file COPYING.  If not, please write to the
** Free Software Foundation,  51 Franklin Street, Fifth Floor, Boston, MA
** 02110-1301, USA.
*)</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">// Author of the file:</span>
<span class="comment">// Hongwei Xi (gmhwxiATgmailDOTcom)</span>
<span class="comment">// Start Time: July, 2012</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="neuexp"><span class="keyword">#include</span> "prelude/params.hats"</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">#if</span> <span class="neuexp">VERBOSE_PRELUDE</span> <span class="keyword">#then</span>
<span class="neuexp"><span class="keyword">#print</span> "Loading [basics_gen.sats] starts!\n"</span>
<span class="keyword">#endif</span> <span class="comment">// end of [VERBOSE_PRELUDE]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
gidentity <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">a</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
gidentity_vt <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">a</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
gcopy_val <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">a</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
gcopy_ref <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">a</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
gfree_val <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
ginit_ref <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">a</span><span class="staexp">?</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
gclear_ref <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">a</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">a</span><span class="staexp">?</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
gequal_val_val <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
gequal_ref_ref <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
tostring_val <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">string</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
tostring_ref <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">string</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
tostrptr_val <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">Strptr1</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
tostrptr_ref <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">Strptr1</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
//
fun{a:t0p}
print_val (x: a): void // = fprint_val (stdout_ref, x)
fun{a:t0p}
prerr_val (x: a): void // = fprint_val (stderr_ref, x)
//
fun{a:vt0p}
print_ref (x: &amp;INV(a)): void // = fprint_ref (stdout_ref, x)
fun{a:vt0p}
prerr_ref (x: &amp;INV(a)): void // = fprint_ref (stderr_ref, x)
//
*)</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
fprint_val <span class="keyword">(</span>out<span class="keyword">:</span> <span class="staexp">FILEref</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
fprint_ref <span class="keyword">(</span>out<span class="keyword">:</span> <span class="staexp">FILEref</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>src<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
<span class="staexp"><span class="keyword">{</span>elt<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
streamize_val <span class="keyword">(</span>source<span class="keyword">:</span> <span class="staexp">src</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">elt</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">#if</span> <span class="neuexp">VERBOSE_PRELUDE</span> <span class="keyword">#then</span>
<span class="neuexp"><span class="keyword">#print</span> "Loading [basics_gen.sats] finishes!\n"</span>
<span class="keyword">#endif</span> <span class="comment">// end of [VERBOSE_PRELUDE]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* end of [basics_gen.sats] *)</span>
</pre>
<pre class="patsyntax">
<span class="comment">(***********************************************************************)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(*                         Applied Type System                         *)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(***********************************************************************)</span>

<span class="comment">(*
** ATS/Postiats - Unleashing the Potential of Types!
** Copyright (C) 2010-2013 Hongwei Xi, ATS Trustful Software, Inc.
** All rights reserved
**
** ATS is free software;  you can  redistribute it and/or modify it under
** the terms of  the GNU GENERAL PUBLIC LICENSE (GPL) as published by the
** Free Software Foundation; either version 3, or (at  your  option)  any
** later version.
**
** ATS is distributed in the hope that it will be useful, but WITHOUT ANY
** WARRANTY; without  even  the  implied  warranty  of MERCHANTABILITY or
** FITNESS FOR A PARTICULAR PURPOSE.  See the  GNU General Public License
** for more details.
**
** You  should  have  received  a  copy of the GNU General Public License
** along  with  ATS;  see the  file COPYING.  If not, please write to the
** Free Software Foundation,  51 Franklin Street, Fifth Floor, Boston, MA
** 02110-1301, USA.
*)</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">// Author of the file:</span>
<span class="comment">// Hongwei Xi (gmhwxiATgmailDOTcom)</span>
<span class="comment">// Start Time: May, 2012</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="neuexp"><span class="keyword">#include</span> "prelude/params.hats"</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">(*
** HX: short form
*)</span>
<span class="comment">//</span>
<span class="comment">// [orelse] and [andalso] are declared as infix ops</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">macdef</span>
orelse<span class="dynexp"><span class="keyword">(</span>x<span class="keyword">,</span> y<span class="keyword">)</span></span> <span class="keyword">=</span>
  <span class="keyword">(</span><span class="keyword">if</span> <span class="dynexp"><span class="keyword">,(</span>x<span class="keyword">)</span></span> <span class="keyword">then</span> true <span class="keyword">else</span> <span class="dynexp"><span class="keyword">,(</span>y<span class="keyword">)</span></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">bool</span></span>
<span class="dynexp"><span class="keyword">macdef</span>
andalso<span class="dynexp"><span class="keyword">(</span>x<span class="keyword">,</span> y<span class="keyword">)</span></span> <span class="keyword">=</span>
  <span class="keyword">(</span><span class="keyword">if</span> <span class="dynexp"><span class="keyword">,(</span>x<span class="keyword">)</span></span> <span class="keyword">then</span> <span class="dynexp"><span class="keyword">,(</span>y<span class="keyword">)</span></span> <span class="keyword">else</span> false<span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">bool</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">macdef</span>
ifval<span class="dynexp"><span class="keyword">(</span>test<span class="keyword">,</span> v_then<span class="keyword">,</span> v_else<span class="keyword">)</span></span> <span class="keyword">=</span>
  <span class="keyword">(</span><span class="keyword">if</span> <span class="dynexp"><span class="keyword">,(</span>test<span class="keyword">)</span></span> <span class="keyword">then</span> <span class="dynexp"><span class="keyword">,(</span>v_then<span class="keyword">)</span></span> <span class="keyword">else</span> <span class="dynexp"><span class="keyword">,(</span>v_else<span class="keyword">)</span></span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">macdef</span> delay<span class="dynexp"><span class="keyword">(</span>exp<span class="keyword">)</span></span> <span class="keyword">=</span> <span class="dynexp"><span class="keyword">$delay</span><span class="keyword">(</span><span class="keyword">,(</span>exp<span class="keyword">)</span><span class="keyword">)</span></span></span>
<span class="dynexp"><span class="keyword">macdef</span> raise<span class="dynexp"><span class="keyword">(</span>exn<span class="keyword">)</span></span> <span class="keyword">=</span> <span class="dynexp"><span class="keyword">$raise</span><span class="keyword">(</span><span class="keyword">,(</span>exn<span class="keyword">)</span><span class="keyword">)</span></span></span>
<span class="comment">//</span>
<span class="comment">(*
macdef effless(exp) = $effmask_all(,(exp))
*)</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">macdef</span> assign<span class="dynexp"><span class="keyword">(</span>lv<span class="keyword">,</span> rv<span class="keyword">)</span></span> <span class="keyword">=</span> <span class="dynexp"><span class="keyword">,(</span>lv<span class="keyword">)</span></span> := <span class="dynexp"><span class="keyword">,(</span>rv<span class="keyword">)</span></span></span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">macdef</span>
exitloc<span class="dynexp"><span class="keyword">(</span>ecode<span class="keyword">)</span></span> <span class="keyword">=</span>
  exit_errmsg <span class="keyword">(</span><span class="dynexp"><span class="keyword">,(</span>ecode<span class="keyword">)</span></span><span class="keyword">,</span> <span class="dynexp"><span class="keyword">$mylocation</span></span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">macdef</span>
assertloc<span class="dynexp"><span class="keyword">(</span>tf<span class="keyword">)</span></span> <span class="keyword">=</span>
  assert_errmsg <span class="keyword">(</span><span class="dynexp"><span class="keyword">,(</span>tf<span class="keyword">)</span></span><span class="keyword">,</span> <span class="dynexp"><span class="keyword">$mylocation</span></span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">macdef</span>
assertlocmsg
  <span class="dynexp"><span class="keyword">(</span>tf<span class="keyword">,</span> msg<span class="keyword">)</span></span> <span class="keyword">=</span>
  assert_errmsg2 <span class="keyword">(</span><span class="dynexp"><span class="keyword">,(</span>tf<span class="keyword">)</span></span><span class="keyword">,</span> <span class="dynexp"><span class="keyword">$mylocation</span></span><span class="keyword">,</span> <span class="dynexp"><span class="keyword">,(</span>msg<span class="keyword">)</span></span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">macdef</span>
assertmsgloc
  <span class="dynexp"><span class="keyword">(</span>tf<span class="keyword">,</span> msg<span class="keyword">)</span></span> <span class="keyword">=</span>
  assert_errmsg2 <span class="keyword">(</span><span class="dynexp"><span class="keyword">,(</span>tf<span class="keyword">)</span></span><span class="keyword">,</span> <span class="dynexp"><span class="keyword">,(</span>msg<span class="keyword">)</span></span><span class="keyword">,</span> <span class="dynexp"><span class="keyword">$mylocation</span></span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">macdef</span>
undefined<span class="dynexp"><span class="keyword">(</span><span class="keyword">)</span></span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span>
assertlocmsg
  <span class="keyword">(</span>false<span class="keyword">,</span> <span class="dynstr">": undefined!!!"</span><span class="keyword">)</span></span> <span class="keyword">in</span> <span class="dynexp"><span class="keyword">$raise</span><span class="keyword">(</span>AssertExn<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [undefined]</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">macdef</span> ignoret<span class="dynexp"><span class="keyword">(</span>x<span class="keyword">)</span></span> <span class="keyword">=</span> <span class="keyword">let</span> <span class="dynexp"><span class="keyword">val</span> _ <span class="keyword">=</span> <span class="dynexp"><span class="keyword">,(</span>x<span class="keyword">)</span></span></span> <span class="dynexp"><span class="keyword">in</span> <span class="comment">(*nothing*)</span> <span class="keyword">end</span></span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">macdef</span> foldret<span class="dynexp"><span class="keyword">(</span>x<span class="keyword">)</span></span> <span class="keyword">=</span> <span class="keyword">let</span> <span class="dynexp"><span class="keyword">val</span> x <span class="keyword">=</span> <span class="dynexp"><span class="keyword">,(</span>x<span class="keyword">)</span></span></span> <span class="keyword">in</span> <span class="keyword">fold@</span> <span class="keyword">(</span>x<span class="keyword">)</span><span class="keyword">;</span> x <span class="keyword">end</span></span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">macdef</span> showtype<span class="dynexp"><span class="keyword">(</span>x<span class="keyword">)</span></span> <span class="keyword">=</span> <span class="dynexp"><span class="keyword">$showtype</span> <span class="keyword">,(</span>x<span class="keyword">)</span></span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">macdef</span> showview<span class="dynexp"><span class="keyword">(</span>x<span class="keyword">)</span></span> <span class="keyword">=</span> pridentity_v <span class="keyword">(</span><span class="dynexp"><span class="keyword">$showtype</span> <span class="keyword">,(</span>x<span class="keyword">)</span></span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">macdef</span> showvtype<span class="dynexp"><span class="keyword">(</span>x<span class="keyword">)</span></span> <span class="keyword">=</span> pridentity_vt <span class="keyword">(</span><span class="dynexp"><span class="keyword">$showtype</span> <span class="keyword">,(</span>x<span class="keyword">)</span></span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">macdef</span> showviewtype<span class="dynexp"><span class="keyword">(</span>x<span class="keyword">)</span></span> <span class="keyword">=</span> pridentity_vt <span class="keyword">(</span><span class="dynexp"><span class="keyword">$showtype</span> <span class="keyword">,(</span>x<span class="keyword">)</span></span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* end of [macrodef.sats] *)</span>
</pre>
<pre class="patsyntax">
<span class="comment">(***********************************************************************)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(*                         Applied Type System                         *)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(***********************************************************************)</span>

<span class="comment">(*
** ATS/Postiats - Unleashing the Potential of Types!
** Copyright (C) 2010-2013 Hongwei Xi, ATS Trustful Software, Inc.
** All rights reserved
**
** ATS is free software;  you can  redistribute it and/or modify it under
** the terms of  the GNU GENERAL PUBLIC LICENSE (GPL) as published by the
** Free Software Foundation; either version 3, or (at  your  option)  any
** later version.
**
** ATS is distributed in the hope that it will be useful, but WITHOUT ANY
** WARRANTY; without  even  the  implied  warranty  of MERCHANTABILITY or
** FITNESS FOR A PARTICULAR PURPOSE.  See the  GNU General Public License
** for more details.
**
** You  should  have  received  a  copy of the GNU General Public License
** along  with  ATS;  see the  file COPYING.  If not, please write to the
** Free Software Foundation,  51 Franklin Street, Fifth Floor, Boston, MA
** 02110-1301, USA.
*)</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">// Author of the file:</span>
<span class="comment">// Hongwei Xi (gmhwxiATgmailDOTcom)</span>
<span class="comment">// Start Time: March, 2013</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">// HX-2013-03:</span>
<span class="comment">// lmacrodef: local macro definitions</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">macdef</span> :+= <span class="dynexp"><span class="keyword">(</span>x<span class="keyword">,</span> a<span class="keyword">)</span></span> <span class="keyword">=</span> <span class="keyword">let</span> <span class="dynexp"><span class="keyword">val</span> v <span class="keyword">=</span> <span class="dynexp"><span class="keyword">,(</span>x<span class="keyword">)</span></span></span> <span class="keyword">in</span> <span class="dynexp"><span class="keyword">,(</span>x<span class="keyword">)</span></span> := <span class="dynexp"><span class="keyword">,(</span>a<span class="keyword">)</span></span> + v <span class="keyword">end</span></span>
<span class="dynexp"><span class="keyword">macdef</span> :-= <span class="dynexp"><span class="keyword">(</span>x<span class="keyword">,</span> a<span class="keyword">)</span></span> <span class="keyword">=</span> <span class="keyword">let</span> <span class="dynexp"><span class="keyword">val</span> v <span class="keyword">=</span> <span class="dynexp"><span class="keyword">,(</span>x<span class="keyword">)</span></span></span> <span class="keyword">in</span> <span class="dynexp"><span class="keyword">,(</span>x<span class="keyword">)</span></span> := <span class="dynexp"><span class="keyword">,(</span>a<span class="keyword">)</span></span> - v <span class="keyword">end</span></span>
<span class="dynexp"><span class="keyword">macdef</span> :*= <span class="dynexp"><span class="keyword">(</span>x<span class="keyword">,</span> a<span class="keyword">)</span></span> <span class="keyword">=</span> <span class="keyword">let</span> <span class="dynexp"><span class="keyword">val</span> v <span class="keyword">=</span> <span class="dynexp"><span class="keyword">,(</span>x<span class="keyword">)</span></span></span> <span class="keyword">in</span> <span class="dynexp"><span class="keyword">,(</span>x<span class="keyword">)</span></span> := <span class="dynexp"><span class="keyword">,(</span>a<span class="keyword">)</span></span> * v <span class="keyword">end</span></span>
<span class="dynexp"><span class="keyword">macdef</span> :/= <span class="dynexp"><span class="keyword">(</span>x<span class="keyword">,</span> a<span class="keyword">)</span></span> <span class="keyword">=</span> <span class="keyword">let</span> <span class="dynexp"><span class="keyword">val</span> v <span class="keyword">=</span> <span class="dynexp"><span class="keyword">,(</span>x<span class="keyword">)</span></span></span> <span class="keyword">in</span> <span class="dynexp"><span class="keyword">,(</span>x<span class="keyword">)</span></span> := <span class="dynexp"><span class="keyword">,(</span>a<span class="keyword">)</span></span> / v <span class="keyword">end</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">macdef</span> :=+ <span class="dynexp"><span class="keyword">(</span>x<span class="keyword">,</span> a<span class="keyword">)</span></span> <span class="keyword">=</span> <span class="keyword">let</span> <span class="dynexp"><span class="keyword">val</span> v <span class="keyword">=</span> <span class="dynexp"><span class="keyword">,(</span>x<span class="keyword">)</span></span></span> <span class="keyword">in</span> <span class="dynexp"><span class="keyword">,(</span>x<span class="keyword">)</span></span> := v + <span class="dynexp"><span class="keyword">,(</span>a<span class="keyword">)</span></span> <span class="keyword">end</span></span>
<span class="dynexp"><span class="keyword">macdef</span> :=- <span class="dynexp"><span class="keyword">(</span>x<span class="keyword">,</span> a<span class="keyword">)</span></span> <span class="keyword">=</span> <span class="keyword">let</span> <span class="dynexp"><span class="keyword">val</span> v <span class="keyword">=</span> <span class="dynexp"><span class="keyword">,(</span>x<span class="keyword">)</span></span></span> <span class="keyword">in</span> <span class="dynexp"><span class="keyword">,(</span>x<span class="keyword">)</span></span> := v - <span class="dynexp"><span class="keyword">,(</span>a<span class="keyword">)</span></span> <span class="keyword">end</span></span>
<span class="dynexp"><span class="keyword">macdef</span> :=* <span class="dynexp"><span class="keyword">(</span>x<span class="keyword">,</span> a<span class="keyword">)</span></span> <span class="keyword">=</span> <span class="keyword">let</span> <span class="dynexp"><span class="keyword">val</span> v <span class="keyword">=</span> <span class="dynexp"><span class="keyword">,(</span>x<span class="keyword">)</span></span></span> <span class="keyword">in</span> <span class="dynexp"><span class="keyword">,(</span>x<span class="keyword">)</span></span> := v * <span class="dynexp"><span class="keyword">,(</span>a<span class="keyword">)</span></span> <span class="keyword">end</span></span>
<span class="dynexp"><span class="keyword">macdef</span> :=/ <span class="dynexp"><span class="keyword">(</span>x<span class="keyword">,</span> a<span class="keyword">)</span></span> <span class="keyword">=</span> <span class="keyword">let</span> <span class="dynexp"><span class="keyword">val</span> v <span class="keyword">=</span> <span class="dynexp"><span class="keyword">,(</span>x<span class="keyword">)</span></span></span> <span class="keyword">in</span> <span class="dynexp"><span class="keyword">,(</span>x<span class="keyword">)</span></span> := v / <span class="dynexp"><span class="keyword">,(</span>a<span class="keyword">)</span></span> <span class="keyword">end</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">macdef</span>
println<span class="dynexp"><span class="keyword">(</span>x<span class="keyword">)</span></span> <span class="keyword">=</span> <span class="keyword">(</span>print<span class="keyword">(</span><span class="dynexp"><span class="keyword">,(</span>x<span class="keyword">)</span></span><span class="keyword">)</span><span class="keyword">;</span> print_newline<span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">macdef</span>
prerrln<span class="dynexp"><span class="keyword">(</span>x<span class="keyword">)</span></span> <span class="keyword">=</span> <span class="keyword">(</span>prerr<span class="keyword">(</span><span class="dynexp"><span class="keyword">,(</span>x<span class="keyword">)</span></span><span class="keyword">)</span><span class="keyword">;</span> prerr_newline<span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">macdef</span>
fprintln<span class="dynexp"><span class="keyword">(</span>out<span class="keyword">,</span> x<span class="keyword">)</span></span> <span class="keyword">=</span> <span class="keyword">(</span>fprint<span class="keyword">(</span><span class="dynexp"><span class="keyword">,(</span>out<span class="keyword">)</span></span><span class="keyword">,</span> <span class="dynexp"><span class="keyword">,(</span>x<span class="keyword">)</span></span><span class="keyword">)</span><span class="keyword">;</span> fprint_newline<span class="keyword">(</span><span class="dynexp"><span class="keyword">,(</span>out<span class="keyword">)</span></span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">(*
//
// HX-2012-08:
//
// this example makes use of recursive macrodef
//
*)</span>
<span class="comment">(*
//
local
//
macrodef
rec
auxlist
  (xs, y) =
(
//
if
iscons! (xs)
then `(print ,(car! xs); ,(auxlist (cdr! xs, y))) else y
// end of [if]
//
) (* end of [auxlist] *)
//
in (* in of [local] *)

macdef
print_mac (x) =
,(
  if islist! (x) then auxlist (x, `()) else `(print ,(x))
) (* end of [print_mac] *)

macdef
println_mac (x) =
,(
  if islist! (x)
    then auxlist (x, `(print_newline())) else `(print ,(x); print_newline())
  // end of [if]
) (* end of [println_mac] *)

end // end of [local]
//
*)</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">macdef</span>
eqfn<span class="dynexp"><span class="keyword">(</span>x0<span class="keyword">)</span></span> <span class="keyword">=</span> <span class="keyword">lam</span><span class="keyword">(</span>x<span class="keyword">)</span> <span class="keyword">=&lt;</span><span class="staexp">cloref1</span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="dynexp"><span class="keyword">,(</span>x0<span class="keyword">)</span></span> <span class="keyword">=</span> x<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">macdef</span>
cmpfn<span class="dynexp"><span class="keyword">(</span>x0<span class="keyword">)</span></span> <span class="keyword">=</span> <span class="keyword">lam</span><span class="keyword">(</span>x<span class="keyword">)</span> <span class="keyword">=&lt;</span><span class="staexp">cloref1</span><span class="keyword">&gt;</span> compare<span class="keyword">(</span><span class="dynexp"><span class="keyword">,(</span>x0<span class="keyword">)</span></span><span class="keyword">,</span> x<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* end of [lmacrodef.hats] *)</span>
</pre>
<pre class="patsyntax">
<span class="comment">(***********************************************************************)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(*                         Applied Type System                         *)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(***********************************************************************)</span>

<span class="comment">(*
** ATS/Postiats - Unleashing the Potential of Types!
** Copyright (C) 2010-2015 Hongwei Xi, ATS Trustful Software, Inc.
** All rights reserved
**
** ATS is free software;  you can  redistribute it and/or modify it under
** the terms of  the GNU GENERAL PUBLIC LICENSE (GPL) as published by the
** Free Software Foundation; either version 3, or (at  your  option)  any
** later version.
**
** ATS is distributed in the hope that it will be useful, but WITHOUT ANY
** WARRANTY; without  even  the  implied  warranty  of MERCHANTABILITY or
** FITNESS FOR A PARTICULAR PURPOSE.  See the  GNU General Public License
** for more details.
**
** You  should  have  received  a  copy of the GNU General Public License
** along  with  ATS;  see the  file COPYING.  If not, please write to the
** Free Software Foundation,  51 Franklin Street, Fifth Floor, Boston, MA
** 02110-1301, USA.
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* Author: Hongwei Xi *)</span>
<span class="comment">(* Authoremail: gmhwxiATgmailDOTcom *)</span>
<span class="comment">(* Start time: September, 2011 *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
** Source:
** $PATSHOME/prelude/SATS/CODEGEN/integer.atxt
** Time of generation: Sat Oct 22 17:13:48 2016
*)</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">// HX: for unindexed integer types</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="staexp"><span class="keyword">sortdef</span> tk <span class="keyword">=</span> tkind</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">typedef</span> <span class="staexp">SHR<span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span><span class="keyword">t@ype</span></span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">a</span></span> <span class="comment">// for commenting purpose</span>
<span class="keyword">typedef</span> <span class="staexp">NSH<span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span><span class="keyword">t@ype</span></span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">a</span></span> <span class="comment">// for commenting purpose</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="keyword">stadef</span> <span class="staexp">intknd <span class="keyword">=</span> <span class="staexp">int_kind</span></span>
<span class="keyword">stadef</span> <span class="staexp">uintknd <span class="keyword">=</span> <span class="staexp">uint_kind</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
k1<span class="keyword">,</span>k2<span class="keyword">:</span>tk
<span class="keyword">}</span></span> g0int2int<span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">g0int</span><span class="keyword">(</span><span class="staexp">k1</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">g0int</span><span class="keyword">(</span><span class="staexp">k2</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
g0int2int_int_int<span class="keyword">(</span>i0<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">// HX-2015-09-20:</span>
<span class="comment">// These are implemented in prelude/string.cats:</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g0int2string<span class="keyword">(</span><span class="staexp">g0int</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">Strptr1</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
g0int2string_int<span class="keyword">(</span>i0<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">Strptr1</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g0string2int<span class="keyword">(</span>rep<span class="keyword">:</span> <span class="staexp">NSH</span><span class="keyword">(</span><span class="staexp">string</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">g0int</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
g0string2int_int<span class="keyword">(</span>rep<span class="keyword">:</span> <span class="staexp">NSH</span><span class="keyword">(</span><span class="staexp">string</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="keyword">typedef</span>
<span class="staexp">g0int_uop_type
  <span class="keyword">(</span><span class="staexp">tk<span class="keyword">:</span> tk</span><span class="keyword">)</span> <span class="keyword">=</span>
  <span class="keyword">(</span><span class="staexp">g0int</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">fun0</span><span class="keyword">&gt;</span> <span class="staexp">g0int</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g0int_neg <span class="keyword">:</span> <span class="staexp">g0int_uop_type</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">~</span> <span class="keyword">with</span> g0int_neg <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> neg <span class="keyword">with</span> g0int_neg <span class="keyword">of</span> 0</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g0int_abs <span class="keyword">:</span> <span class="staexp">g0int_uop_type</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">overload</span> abs <span class="keyword">with</span> g0int_abs <span class="keyword">of</span> 0</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g0int_succ <span class="keyword">:</span> <span class="staexp">g0int_uop_type</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g0int_pred <span class="keyword">:</span> <span class="staexp">g0int_uop_type</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> succ <span class="keyword">with</span> g0int_succ <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> pred <span class="keyword">with</span> g0int_pred <span class="keyword">of</span> 0</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g0int_half <span class="keyword">:</span> <span class="staexp">g0int_uop_type</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">overload</span> half <span class="keyword">with</span> g0int_half <span class="keyword">of</span> 0</span>
<span class="comment">//</span>
<span class="comment">(*
fun
{tk:tk}
g0int_double : g0int_uop_type(tk)
overload double with g0int_double of 0
*)</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">typedef</span>
<span class="staexp">g0int_aop_type
  <span class="keyword">(</span><span class="staexp">tk<span class="keyword">:</span> tk</span><span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
  <span class="staexp">g0int</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span>
<span class="keyword">,</span> <span class="staexp">g0int</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">fun0</span><span class="keyword">&gt;</span> <span class="staexp">g0int</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="comment">// end of [g0int_aop_type]</span>

<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g0int_add <span class="keyword">:</span> <span class="staexp">g0int_aop_type</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">overload</span> + <span class="keyword">with</span> g0int_add <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g0int_sub <span class="keyword">:</span> <span class="staexp">g0int_aop_type</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">overload</span> - <span class="keyword">with</span> g0int_sub <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g0int_mul <span class="keyword">:</span> <span class="staexp">g0int_aop_type</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">overload</span> * <span class="keyword">with</span> g0int_mul <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g0int_div <span class="keyword">:</span> <span class="staexp">g0int_aop_type</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">overload</span> / <span class="keyword">with</span> g0int_div <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g0int_mod <span class="keyword">:</span> <span class="staexp">g0int_aop_type</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">overload</span> % <span class="keyword">with</span> g0int_mod <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> mod <span class="keyword">with</span> g0int_mod <span class="keyword">of</span> 0</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
mul_int1_size0<span class="staexp"><span class="keyword">{</span>i<span class="keyword">:</span>nat<span class="keyword">}</span></span><span class="keyword">(</span><span class="staexp">int</span><span class="keyword">(</span><span class="staexp">i</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">size_t</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">size_t</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
mul_size0_int1<span class="staexp"><span class="keyword">{</span>j<span class="keyword">:</span>nat<span class="keyword">}</span></span><span class="keyword">(</span><span class="staexp">size_t</span><span class="keyword">,</span> <span class="staexp">int</span><span class="keyword">(</span><span class="staexp">j</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">size_t</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">overload</span> * <span class="keyword">with</span> mul_int1_size0 <span class="keyword">of</span> 11</span>
<span class="dynexp"><span class="keyword">overload</span> * <span class="keyword">with</span> mul_size0_int1 <span class="keyword">of</span> 11</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g0int_asl
  <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">g0int</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">intGte</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">g0int</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g0int_asr
  <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">g0int</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">intGte</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">g0int</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> &lt;&lt; <span class="keyword">with</span> g0int_asl <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> &gt;&gt; <span class="keyword">with</span> g0int_asr <span class="keyword">of</span> 0</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g0int_npow
  <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">g0int</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">intGte</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">g0int</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> ** <span class="keyword">with</span> g0int_npow <span class="keyword">of</span> 0</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g0int_isltz <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">g0int</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g0int_isltez <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">g0int</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g0int_isgtz <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">g0int</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g0int_isgtez <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">g0int</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g0int_iseqz <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">g0int</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g0int_isneqz <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">g0int</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> isltz <span class="keyword">with</span> g0int_isltz <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> isltez <span class="keyword">with</span> g0int_isltez <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> isgtz <span class="keyword">with</span> g0int_isgtz <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> isgtez <span class="keyword">with</span> g0int_isgtez <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> iseqz <span class="keyword">with</span> g0int_iseqz <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> isneqz <span class="keyword">with</span> g0int_isneqz <span class="keyword">of</span> 0</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">typedef</span>
<span class="staexp">g0int_cmp_type <span class="keyword">(</span><span class="staexp">tk<span class="keyword">:</span>tk</span><span class="keyword">)</span> <span class="keyword">=</span>
  <span class="keyword">(</span><span class="staexp">g0int</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">g0int</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">fun0</span><span class="keyword">&gt;</span> <span class="staexp">bool</span></span>
<span class="comment">// end of [g0int_cmp_type]</span>

<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g0int_lt <span class="keyword">:</span> <span class="staexp">g0int_cmp_type</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">&lt;</span> <span class="keyword">with</span> g0int_lt <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g0int_lte <span class="keyword">:</span> <span class="staexp">g0int_cmp_type</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">overload</span> &lt;= <span class="keyword">with</span> g0int_lte <span class="keyword">of</span> 0</span>

<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g0int_gt <span class="keyword">:</span> <span class="staexp">g0int_cmp_type</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">&gt;</span> <span class="keyword">with</span> g0int_gt <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g0int_gte <span class="keyword">:</span> <span class="staexp">g0int_cmp_type</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">overload</span> &gt;= <span class="keyword">with</span> g0int_gte <span class="keyword">of</span> 0</span>

<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g0int_eq <span class="keyword">:</span> <span class="staexp">g0int_cmp_type</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">=</span> <span class="keyword">with</span> g0int_eq <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g0int_neq <span class="keyword">:</span> <span class="staexp">g0int_cmp_type</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">overload</span> != <span class="keyword">with</span> g0int_neq <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> &lt;&gt; <span class="keyword">with</span> g0int_neq <span class="keyword">of</span> 0</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g0int_compare
  <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">g0int</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">g0int</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int</span></span>
<span class="dynexp"><span class="keyword">overload</span> compare <span class="keyword">with</span> g0int_compare <span class="keyword">of</span> 0</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g0int_max <span class="keyword">:</span> <span class="staexp">g0int_aop_type</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">overload</span> max <span class="keyword">with</span> g0int_max <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g0int_min <span class="keyword">:</span> <span class="staexp">g0int_aop_type</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">overload</span> min <span class="keyword">with</span> g0int_min <span class="keyword">of</span> 0</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
lt_g0int_int <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">g0int</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span></span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">&lt;</span> <span class="keyword">with</span> lt_g0int_int <span class="keyword">of</span> 11</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
lte_g0int_int <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">g0int</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span></span>
<span class="dynexp"><span class="keyword">overload</span> &lt;= <span class="keyword">with</span> lte_g0int_int <span class="keyword">of</span> 11</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
gt_g0int_int <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">g0int</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span></span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">&gt;</span> <span class="keyword">with</span> gt_g0int_int <span class="keyword">of</span> 11</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
gte_g0int_int <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">g0int</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span></span>
<span class="dynexp"><span class="keyword">overload</span> &gt;= <span class="keyword">with</span> gte_g0int_int <span class="keyword">of</span> 11</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
eq_g0int_int <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">g0int</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span></span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">=</span> <span class="keyword">with</span> eq_g0int_int <span class="keyword">of</span> 11</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
neq_g0int_int <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">g0int</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span></span>
<span class="dynexp"><span class="keyword">overload</span> != <span class="keyword">with</span> neq_g0int_int <span class="keyword">of</span> 11</span>
<span class="dynexp"><span class="keyword">overload</span> &lt;&gt; <span class="keyword">with</span> neq_g0int_int <span class="keyword">of</span> 11</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
compare_g0int_int <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">g0int</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int</span></span>
<span class="dynexp"><span class="keyword">overload</span> compare <span class="keyword">with</span> compare_g0int_int <span class="keyword">of</span> 11</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">// HX: for indexed integer types</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">castfn</span>
g0ofg1_int<span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span><span class="keyword">(</span><span class="staexp">g1int</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">g0int</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">castfn</span>
g1ofg0_int<span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span><span class="keyword">(</span><span class="staexp">g0int</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">g1int</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">overload</span> g0ofg1 <span class="keyword">with</span> g0ofg1_int</span> <span class="comment">// index-erasing</span>
<span class="dynexp"><span class="keyword">overload</span> g1ofg0 <span class="keyword">with</span> g1ofg0_int</span> <span class="comment">// index-inducing</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
k1<span class="keyword">,</span>k2<span class="keyword">:</span>tk
<span class="keyword">}</span></span> g1int2int <span class="comment">// i2i</span>
  <span class="staexp"><span class="keyword">{</span>i<span class="keyword">:</span>int<span class="keyword">}</span></span> <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">g1int</span> <span class="keyword">(</span><span class="staexp">k1</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">g1int</span> <span class="keyword">(</span><span class="staexp">k2</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
g1int2int_int_int<span class="staexp"><span class="keyword">{</span>i<span class="keyword">:</span>int<span class="keyword">}</span></span><span class="keyword">(</span><span class="staexp">int</span><span class="keyword">(</span><span class="staexp">i</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int</span><span class="keyword">(</span><span class="staexp">i</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g1string2int <span class="keyword">(</span>str<span class="keyword">:</span> <span class="staexp">NSH</span><span class="keyword">(</span><span class="staexp">string</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">g1int</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="prfexp"><span class="keyword">prfun</span>
g1int_get_index
  <span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>i1<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">g1int</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i1</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><span class="keyword">[</span>i2<span class="keyword">:</span>int<span class="keyword">]</span></span> <span class="staexp">EQINT</span><span class="keyword">(</span><span class="staexp">i1</span><span class="keyword">,</span> <span class="staexp">i2</span><span class="keyword">)</span></span>
<span class="comment">// end of [g1int_get_index]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="keyword">typedef</span>
<span class="staexp">g1int_neg_type <span class="keyword">(</span><span class="staexp">tk<span class="keyword">:</span>tk</span><span class="keyword">)</span> <span class="keyword">=</span>
  <span class="staexp"><span class="keyword">{</span>i<span class="keyword">:</span>int<span class="keyword">}</span></span> <span class="staexp">g1int</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">fun0</span><span class="keyword">&gt;</span> <span class="staexp">g1int</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp"><span class="keyword">~</span></span><span class="staexp">i</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g1int_neg <span class="keyword">:</span> <span class="staexp">g1int_neg_type</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">~</span> <span class="keyword">with</span> g1int_neg <span class="keyword">of</span> 10</span> <span class="comment">// ~ for uminus</span>
<span class="dynexp"><span class="keyword">overload</span> neg <span class="keyword">with</span> g1int_neg <span class="keyword">of</span> 10</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="keyword">typedef</span>
<span class="staexp">g1int_abs_type <span class="keyword">(</span><span class="staexp">tk<span class="keyword">:</span>tk</span><span class="keyword">)</span> <span class="keyword">=</span>
  <span class="staexp"><span class="keyword">{</span>i<span class="keyword">:</span>int<span class="keyword">}</span></span> <span class="staexp">g1int</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">fun0</span><span class="keyword">&gt;</span> <span class="staexp">g1int</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">abs</span><span class="keyword">(</span><span class="staexp">i</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g1int_abs <span class="keyword">:</span> <span class="staexp">g1int_abs_type</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">overload</span> abs <span class="keyword">with</span> g1int_abs <span class="keyword">of</span> 10</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="keyword">typedef</span>
<span class="staexp">g1int_succ_type <span class="keyword">(</span><span class="staexp">tk<span class="keyword">:</span>tk</span><span class="keyword">)</span> <span class="keyword">=</span>
  <span class="staexp"><span class="keyword">{</span>i<span class="keyword">:</span>int<span class="keyword">}</span></span> <span class="staexp">g1int</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">fun0</span><span class="keyword">&gt;</span> <span class="staexp">g1int</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="staexp">+</span><span class="staexp">1</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g1int_succ <span class="keyword">:</span> <span class="staexp">g1int_succ_type</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">overload</span> succ <span class="keyword">with</span> g1int_succ <span class="keyword">of</span> 10</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="keyword">typedef</span>
<span class="staexp">g1int_pred_type <span class="keyword">(</span><span class="staexp">tk<span class="keyword">:</span>tk</span><span class="keyword">)</span> <span class="keyword">=</span>
  <span class="staexp"><span class="keyword">{</span>i<span class="keyword">:</span>int<span class="keyword">}</span></span> <span class="staexp">g1int</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">fun0</span><span class="keyword">&gt;</span> <span class="staexp">g1int</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="staexp">-</span><span class="staexp">1</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g1int_pred <span class="keyword">:</span> <span class="staexp">g1int_pred_type</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">overload</span> pred <span class="keyword">with</span> g1int_pred <span class="keyword">of</span> 10</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="keyword">typedef</span>
<span class="staexp">g1int_half_type <span class="keyword">(</span><span class="staexp">tk<span class="keyword">:</span>tk</span><span class="keyword">)</span> <span class="keyword">=</span>
  <span class="staexp"><span class="keyword">{</span>i<span class="keyword">:</span>int<span class="keyword">}</span></span> <span class="staexp">g1int</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">fun0</span><span class="keyword">&gt;</span> <span class="staexp">g1int</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="staexp">/</span><span class="staexp">2</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g1int_half <span class="keyword">:</span> <span class="staexp">g1int_half_type</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">overload</span> half <span class="keyword">with</span> g1int_half <span class="keyword">of</span> 10</span>
<span class="comment">//</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
//
typedef
g1int_double_type
  (tk:tk) =
  {i:int}
  g1int (tk, i) -&lt;fun0&gt; g1int (tk, 2*i)
//
fun{tk:tk}
g1int_double : g1int_double_type(tk)
overload double with g1int_double of 10
//
*)</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="keyword">typedef</span>
<span class="staexp">g1int_add_type
  <span class="keyword">(</span><span class="staexp">tk<span class="keyword">:</span>tk</span><span class="keyword">)</span> <span class="keyword">=</span>
  <span class="staexp"><span class="keyword">{</span>i<span class="keyword">,</span>j<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  <span class="staexp">g1int</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span>
<span class="keyword">,</span> <span class="staexp">g1int</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">j</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">fun0</span><span class="keyword">&gt;</span> <span class="staexp">g1int</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="staexp">+</span><span class="staexp">j</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g1int_add <span class="keyword">:</span> <span class="staexp">g1int_add_type</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
add_size1_int1
  <span class="staexp"><span class="keyword">{</span>i<span class="keyword">,</span>j<span class="keyword">:</span>int <span class="keyword">|</span> i+j &gt;= 0<span class="keyword">}</span></span>
  <span class="keyword">(</span>i<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">(</span><span class="staexp">i</span><span class="keyword">)</span><span class="keyword">,</span> j<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">(</span><span class="staexp">j</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">size_t</span><span class="keyword">(</span><span class="staexp">i</span><span class="staexp">+</span><span class="staexp">j</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
add_int1_size1
  <span class="staexp"><span class="keyword">{</span>i<span class="keyword">,</span>j<span class="keyword">:</span>int <span class="keyword">|</span> i+j &gt;= 0<span class="keyword">}</span></span>
  <span class="keyword">(</span>i<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">(</span><span class="staexp">i</span><span class="keyword">)</span><span class="keyword">,</span> j<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">(</span><span class="staexp">j</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">size_t</span><span class="keyword">(</span><span class="staexp">i</span><span class="staexp">+</span><span class="staexp">j</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">overload</span> + <span class="keyword">with</span> g1int_add <span class="keyword">of</span> 20</span>
<span class="dynexp"><span class="keyword">overload</span> + <span class="keyword">with</span> add_size1_int1 <span class="keyword">of</span> 22</span>
<span class="dynexp"><span class="keyword">overload</span> + <span class="keyword">with</span> add_int1_size1 <span class="keyword">of</span> 22</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="keyword">typedef</span>
<span class="staexp">g1int_sub_type
  <span class="keyword">(</span><span class="staexp">tk<span class="keyword">:</span>tk</span><span class="keyword">)</span> <span class="keyword">=</span>
  <span class="staexp"><span class="keyword">{</span>i<span class="keyword">,</span>j<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  <span class="staexp">g1int</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span>
<span class="keyword">,</span> <span class="staexp">g1int</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">j</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">fun0</span><span class="keyword">&gt;</span> <span class="staexp">g1int</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="staexp">-</span><span class="staexp">j</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g1int_sub <span class="keyword">:</span> <span class="staexp">g1int_sub_type</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
sub_size1_int1
  <span class="staexp"><span class="keyword">{</span>i<span class="keyword">,</span>j<span class="keyword">:</span>int <span class="keyword">|</span> i-j &gt;= 0<span class="keyword">}</span></span>
  <span class="keyword">(</span>i<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">(</span><span class="staexp">i</span><span class="keyword">)</span><span class="keyword">,</span> j<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">(</span><span class="staexp">j</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">size_t</span><span class="keyword">(</span><span class="staexp">i</span><span class="staexp">-</span><span class="staexp">j</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">overload</span> - <span class="keyword">with</span> g1int_sub <span class="keyword">of</span> 20</span>
<span class="dynexp"><span class="keyword">overload</span> - <span class="keyword">with</span> sub_size1_int1 <span class="keyword">of</span> 22</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="keyword">typedef</span>
<span class="staexp">g1int_mul_type
  <span class="keyword">(</span><span class="staexp">tk<span class="keyword">:</span>tk</span><span class="keyword">)</span> <span class="keyword">=</span>
  <span class="staexp"><span class="keyword">{</span>i<span class="keyword">,</span>j<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  <span class="staexp">g1int</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span>
<span class="keyword">,</span> <span class="staexp">g1int</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">j</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">fun0</span><span class="keyword">&gt;</span> <span class="staexp">g1int</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="staexp">*</span><span class="staexp">j</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g1int_mul <span class="keyword">:</span> <span class="staexp">g1int_mul_type</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g1int_mul2
  <span class="staexp"><span class="keyword">{</span>i<span class="keyword">,</span>j<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  x<span class="keyword">:</span> <span class="staexp">g1int</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span>
<span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">g1int</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">j</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp"><span class="keyword">[</span>ij<span class="keyword">:</span>int<span class="keyword">]</span></span>
  <span class="keyword">(</span><span class="staexp">MUL</span> <span class="keyword">(</span><span class="staexp">i</span><span class="keyword">,</span> <span class="staexp">j</span><span class="keyword">,</span> <span class="staexp">ij</span><span class="keyword">)</span> <span class="keyword">|</span> <span class="staexp">g1int</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">ij</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">// end of [g1int_mul2]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
mul_int1_size1
  <span class="staexp"><span class="keyword">{</span>i<span class="keyword">,</span>j<span class="keyword">:</span>int <span class="keyword">|</span> i &gt;= 0<span class="keyword">}</span></span>
  <span class="keyword">(</span>i<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">(</span><span class="staexp">i</span><span class="keyword">)</span><span class="keyword">,</span> j<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">(</span><span class="staexp">j</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">size_t</span><span class="keyword">(</span><span class="staexp">i</span><span class="staexp">*</span><span class="staexp">j</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
mul_size1_int1
  <span class="staexp"><span class="keyword">{</span>i<span class="keyword">,</span>j<span class="keyword">:</span>int <span class="keyword">|</span> j &gt;= 0<span class="keyword">}</span></span>
  <span class="keyword">(</span>i<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">(</span><span class="staexp">i</span><span class="keyword">)</span><span class="keyword">,</span> j<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">(</span><span class="staexp">j</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">size_t</span><span class="keyword">(</span><span class="staexp">i</span><span class="staexp">*</span><span class="staexp">j</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">overload</span> * <span class="keyword">with</span> g1int_mul <span class="keyword">of</span> 20</span>
<span class="dynexp"><span class="keyword">overload</span> * <span class="keyword">with</span> mul_int1_size1 <span class="keyword">of</span> 22</span>
<span class="dynexp"><span class="keyword">overload</span> * <span class="keyword">with</span> mul_size1_int1 <span class="keyword">of</span> 22</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="keyword">typedef</span>
<span class="staexp">g1int_div_type
  <span class="keyword">(</span><span class="staexp">tk<span class="keyword">:</span>tk</span><span class="keyword">)</span> <span class="keyword">=</span>
  <span class="staexp"><span class="keyword">{</span>i<span class="keyword">,</span>j<span class="keyword">:</span>int <span class="keyword">|</span> j != 0<span class="keyword">}</span></span>
<span class="keyword">(</span>
  <span class="staexp">g1int</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span>
<span class="keyword">,</span> <span class="staexp">g1int</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">j</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">fun0</span><span class="keyword">&gt;</span> <span class="staexp"><span class="keyword">[</span>r<span class="keyword">:</span>int<span class="keyword">]</span></span> <span class="staexp">g1int</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">r</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g1int_div <span class="keyword">:</span> <span class="staexp">g1int_div_type</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="keyword">typedef</span>
<span class="staexp">g1int_ndiv_type
  <span class="keyword">(</span><span class="staexp">tk<span class="keyword">:</span>tk</span><span class="keyword">)</span> <span class="keyword">=</span>
  <span class="staexp"><span class="keyword">{</span>i<span class="keyword">,</span>j<span class="keyword">:</span>int <span class="keyword">|</span> i &gt;= 0<span class="keyword">;</span> j <span class="keyword">&gt;</span> 0<span class="keyword">}</span></span>
<span class="keyword">(</span>
  <span class="staexp">g1int</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">g1int</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">j</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">fun0</span><span class="keyword">&gt;</span> <span class="staexp">g1int</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">ndiv_int_int</span><span class="keyword">(</span><span class="staexp">i</span><span class="keyword">,</span><span class="staexp">j</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g1int_ndiv <span class="keyword">:</span> <span class="staexp">g1int_ndiv_type</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g1int_ndiv2
  <span class="staexp"><span class="keyword">{</span>i<span class="keyword">,</span>j<span class="keyword">:</span>int <span class="keyword">|</span> i &gt;= 0<span class="keyword">;</span> j <span class="keyword">&gt;</span> 0<span class="keyword">}</span></span>
<span class="keyword">(</span>
  x<span class="keyword">:</span> <span class="staexp">g1int</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">g1int</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">j</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">&gt;</span>
<span class="staexp"><span class="keyword">[</span>
  q<span class="keyword">,</span>r<span class="keyword">:</span>int <span class="keyword">|</span> 0 &lt;= r<span class="keyword">;</span> r <span class="keyword">&lt;</span> j
<span class="keyword">]</span></span> <span class="keyword">(</span>
  <span class="staexp">DIVMOD</span> <span class="keyword">(</span><span class="staexp">i</span><span class="keyword">,</span> <span class="staexp">j</span><span class="keyword">,</span> <span class="staexp">q</span><span class="keyword">,</span> <span class="staexp">r</span><span class="keyword">)</span> <span class="keyword">|</span> <span class="staexp">g1int</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">q</span><span class="keyword">)</span>
<span class="keyword">)</span></span> <span class="comment">(* end of [g1int_ndiv2] *)</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
ndiv_g1int_int1
  <span class="staexp"><span class="keyword">{</span>i<span class="keyword">,</span>j<span class="keyword">:</span>int <span class="keyword">|</span> i &gt;= 0<span class="keyword">;</span> j <span class="keyword">&gt;</span> 0<span class="keyword">}</span></span>
<span class="keyword">(</span>
  <span class="staexp">g1int</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">int</span><span class="keyword">(</span><span class="staexp">j</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">g1int</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">ndiv_int_int</span><span class="keyword">(</span><span class="staexp">i</span><span class="keyword">,</span><span class="staexp">j</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> / <span class="keyword">with</span> g1int_div <span class="keyword">of</span> 20</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> ndiv <span class="keyword">with</span> g1int_ndiv <span class="keyword">of</span> 20</span>
<span class="dynexp"><span class="keyword">overload</span> ndiv <span class="keyword">with</span> ndiv_g1int_int1 <span class="keyword">of</span> 21</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
** HX: [g1int_mod] is intentionally skipped
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">typedef</span>
<span class="staexp">g1int_nmod_type
  <span class="keyword">(</span><span class="staexp">tk<span class="keyword">:</span>tk</span><span class="keyword">)</span> <span class="keyword">=</span>
  <span class="staexp"><span class="keyword">{</span>i<span class="keyword">,</span>j<span class="keyword">:</span>int <span class="keyword">|</span> i &gt;= 0<span class="keyword">;</span> j <span class="keyword">&gt;</span> 0<span class="keyword">}</span></span>
<span class="keyword">(</span>
  <span class="staexp">g1int</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">g1int</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">j</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">fun0</span><span class="keyword">&gt;</span> <span class="staexp">g1int</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">nmod_int_int</span><span class="keyword">(</span><span class="staexp">i</span><span class="keyword">,</span> <span class="staexp">j</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">// end of [g1int_nmod_type]</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g1int_nmod <span class="keyword">:</span> <span class="staexp">g1int_nmod_type</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g1int_nmod2
  <span class="staexp"><span class="keyword">{</span>i<span class="keyword">,</span>j<span class="keyword">:</span>int <span class="keyword">|</span> i &gt;= 0<span class="keyword">;</span> j <span class="keyword">&gt;</span> 0<span class="keyword">}</span></span>
<span class="keyword">(</span>
  x<span class="keyword">:</span> <span class="staexp">g1int</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">g1int</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">j</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp"><span class="keyword">[</span>q<span class="keyword">,</span>r<span class="keyword">:</span>nat <span class="keyword">|</span> r <span class="keyword">&lt;</span> j<span class="keyword">]</span></span>
<span class="keyword">(</span>
  <span class="staexp">DIVMOD</span><span class="keyword">(</span><span class="staexp">i</span><span class="keyword">,</span> <span class="staexp">j</span><span class="keyword">,</span> <span class="staexp">q</span><span class="keyword">,</span> <span class="staexp">r</span><span class="keyword">)</span> <span class="keyword">|</span> <span class="staexp">g1int</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">r</span><span class="keyword">)</span>
<span class="keyword">)</span></span> <span class="comment">(* end of [g1int_nmod2] *)</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
nmod_g1int_int1
  <span class="staexp"><span class="keyword">{</span>i<span class="keyword">,</span>j<span class="keyword">:</span>int <span class="keyword">|</span> i &gt;= 0<span class="keyword">;</span> j <span class="keyword">&gt;</span> 0<span class="keyword">}</span></span>
  <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">g1int</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">(</span><span class="staexp">j</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int</span><span class="keyword">(</span><span class="staexp">i</span><span class="staexp">%</span><span class="staexp">j</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
nmod2_g1int_int1
  <span class="staexp"><span class="keyword">{</span>i<span class="keyword">,</span>j<span class="keyword">:</span>int <span class="keyword">|</span> i &gt;= 0<span class="keyword">;</span> j <span class="keyword">&gt;</span> 0<span class="keyword">}</span></span>
<span class="keyword">(</span>
  x<span class="keyword">:</span> <span class="staexp">g1int</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">(</span><span class="staexp">j</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp"><span class="keyword">[</span>q<span class="keyword">,</span>r<span class="keyword">:</span>nat <span class="keyword">|</span> r <span class="keyword">&lt;</span> j<span class="keyword">]</span></span> <span class="keyword">(</span><span class="staexp">DIVMOD</span><span class="keyword">(</span><span class="staexp">i</span><span class="keyword">,</span> <span class="staexp">j</span><span class="keyword">,</span> <span class="staexp">q</span><span class="keyword">,</span> <span class="staexp">r</span><span class="keyword">)</span> <span class="keyword">|</span> <span class="staexp">int</span><span class="keyword">(</span><span class="staexp">r</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">overload</span> nmod <span class="keyword">with</span> g1int_nmod <span class="keyword">of</span> 20</span>
<span class="dynexp"><span class="keyword">overload</span> nmod <span class="keyword">with</span> nmod_g1int_int1 <span class="keyword">of</span> 21</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">typedef</span>
<span class="staexp">g1int_ngcd_type
  <span class="keyword">(</span><span class="staexp">tk<span class="keyword">:</span>tk</span><span class="keyword">)</span> <span class="keyword">=</span>
  <span class="staexp"><span class="keyword">{</span>i<span class="keyword">,</span>j<span class="keyword">:</span>int <span class="keyword">|</span> i &gt;= 0<span class="keyword">;</span> j &gt;= 0<span class="keyword">}</span></span>
<span class="keyword">(</span>
  <span class="staexp">g1int</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">g1int</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">j</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">fun0</span><span class="keyword">&gt;</span> <span class="staexp"><span class="keyword">[</span>r<span class="keyword">:</span>nat<span class="keyword">]</span></span> <span class="staexp">g1int</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">r</span><span class="keyword">)</span></span>
<span class="comment">// end of [g1int_ngcd_type]</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g1int_ngcd <span class="keyword">:</span> <span class="staexp">g1int_ngcd_type</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="comment">(*
//
// HX:
// [ngcd] is no longer pre-declared
//
overload ngcd with g1int_ngcd of 20
//
*)</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="keyword">typedef</span>
<span class="staexp">g1int_isltz_type
  <span class="keyword">(</span><span class="staexp">tk<span class="keyword">:</span>tk</span><span class="keyword">)</span> <span class="keyword">=</span>
  <span class="staexp"><span class="keyword">{</span>i<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span><span class="staexp">g1int</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">fun0</span><span class="keyword">&gt;</span> <span class="staexp">bool</span><span class="keyword">(</span><span class="staexp">i</span> <span class="staexp"><span class="keyword">&lt;</span></span> <span class="staexp">0</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span>
<span class="staexp">g1int_isltez_type
  <span class="keyword">(</span><span class="staexp">tk<span class="keyword">:</span>tk</span><span class="keyword">)</span> <span class="keyword">=</span>
  <span class="staexp"><span class="keyword">{</span>i<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span><span class="staexp">g1int</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">fun0</span><span class="keyword">&gt;</span> <span class="staexp">bool</span><span class="keyword">(</span><span class="staexp">i</span> <span class="staexp">&lt;=</span> <span class="staexp">0</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g1int_isltz <span class="keyword">:</span> <span class="staexp">g1int_isltz_type</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g1int_isltez <span class="keyword">:</span> <span class="staexp">g1int_isltez_type</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> isltz <span class="keyword">with</span> g1int_isltz <span class="keyword">of</span> 10</span>
<span class="dynexp"><span class="keyword">overload</span> isltez <span class="keyword">with</span> g1int_isltez <span class="keyword">of</span> 10</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="keyword">typedef</span>
<span class="staexp">g1int_isgtz_type
  <span class="keyword">(</span><span class="staexp">tk<span class="keyword">:</span>tk</span><span class="keyword">)</span> <span class="keyword">=</span>
  <span class="staexp"><span class="keyword">{</span>i<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span><span class="staexp">g1int</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">fun0</span><span class="keyword">&gt;</span> <span class="staexp">bool</span><span class="keyword">(</span><span class="staexp">i</span> <span class="staexp"><span class="keyword">&gt;</span></span> <span class="staexp">0</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span>
<span class="staexp">g1int_isgtez_type
  <span class="keyword">(</span><span class="staexp">tk<span class="keyword">:</span>tk</span><span class="keyword">)</span> <span class="keyword">=</span>
  <span class="staexp"><span class="keyword">{</span>i<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span><span class="staexp">g1int</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">fun0</span><span class="keyword">&gt;</span> <span class="staexp">bool</span><span class="keyword">(</span><span class="staexp">i</span> <span class="staexp">&gt;=</span> <span class="staexp">0</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g1int_isgtz <span class="keyword">:</span> <span class="staexp">g1int_isgtz_type</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g1int_isgtez <span class="keyword">:</span> <span class="staexp">g1int_isgtez_type</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> isgtz <span class="keyword">with</span> g1int_isgtz <span class="keyword">of</span> 10</span>
<span class="dynexp"><span class="keyword">overload</span> isgtez <span class="keyword">with</span> g1int_isgtez <span class="keyword">of</span> 10</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="keyword">typedef</span>
<span class="staexp">g1int_iseqz_type
  <span class="keyword">(</span><span class="staexp">tk<span class="keyword">:</span>tk</span><span class="keyword">)</span> <span class="keyword">=</span>
  <span class="staexp"><span class="keyword">{</span>i<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span><span class="staexp">g1int</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">fun0</span><span class="keyword">&gt;</span> <span class="staexp">bool</span><span class="keyword">(</span><span class="staexp">i</span> <span class="staexp"><span class="keyword">&gt;</span></span> <span class="staexp">0</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span>
<span class="staexp">g1int_isneqz_type
  <span class="keyword">(</span><span class="staexp">tk<span class="keyword">:</span>tk</span><span class="keyword">)</span> <span class="keyword">=</span>
  <span class="staexp"><span class="keyword">{</span>i<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span><span class="staexp">g1int</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">fun0</span><span class="keyword">&gt;</span> <span class="staexp">bool</span><span class="keyword">(</span><span class="staexp">i</span> <span class="staexp">&gt;=</span> <span class="staexp">0</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g1int_iseqz <span class="keyword">:</span> <span class="staexp">g1int_iseqz_type</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g1int_isneqz <span class="keyword">:</span> <span class="staexp">g1int_isneqz_type</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> iseqz <span class="keyword">with</span> g1int_iseqz <span class="keyword">of</span> 10</span>
<span class="dynexp"><span class="keyword">overload</span> isneqz <span class="keyword">with</span> g1int_isneqz <span class="keyword">of</span> 10</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="keyword">typedef</span>
<span class="staexp">g1int_lt_type
  <span class="keyword">(</span><span class="staexp">tk<span class="keyword">:</span>tk</span><span class="keyword">)</span> <span class="keyword">=</span>
  <span class="staexp"><span class="keyword">{</span>i<span class="keyword">,</span>j<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  <span class="staexp">g1int</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span>
<span class="keyword">,</span> <span class="staexp">g1int</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">j</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">fun0</span><span class="keyword">&gt;</span> <span class="staexp">bool</span><span class="keyword">(</span><span class="staexp">i</span> <span class="staexp"><span class="keyword">&lt;</span></span> <span class="staexp">j</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">typedef</span>
<span class="staexp">g1int_lte_type
  <span class="keyword">(</span><span class="staexp">tk<span class="keyword">:</span>tk</span><span class="keyword">)</span> <span class="keyword">=</span>
  <span class="staexp"><span class="keyword">{</span>i<span class="keyword">,</span>j<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  <span class="staexp">g1int</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span>
<span class="keyword">,</span> <span class="staexp">g1int</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">j</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">fun0</span><span class="keyword">&gt;</span> <span class="staexp">bool</span><span class="keyword">(</span><span class="staexp">i</span> <span class="staexp">&lt;=</span> <span class="staexp">j</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g1int_lt <span class="keyword">:</span> <span class="staexp">g1int_lt_type</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">&lt;</span> <span class="keyword">with</span> g1int_lt <span class="keyword">of</span> 20</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g1int_lte <span class="keyword">:</span> <span class="staexp">g1int_lte_type</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">overload</span> &lt;= <span class="keyword">with</span> g1int_lte <span class="keyword">of</span> 20</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="keyword">typedef</span>
<span class="staexp">g1int_gt_type
  <span class="keyword">(</span><span class="staexp">tk<span class="keyword">:</span>tk</span><span class="keyword">)</span> <span class="keyword">=</span>
  <span class="staexp"><span class="keyword">{</span>i<span class="keyword">,</span>j<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  <span class="staexp">g1int</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span>
<span class="keyword">,</span> <span class="staexp">g1int</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">j</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">fun0</span><span class="keyword">&gt;</span> <span class="staexp">bool</span><span class="keyword">(</span><span class="staexp">i</span> <span class="staexp"><span class="keyword">&gt;</span></span> <span class="staexp">j</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">typedef</span>
<span class="staexp">g1int_gte_type
  <span class="keyword">(</span><span class="staexp">tk<span class="keyword">:</span>tk</span><span class="keyword">)</span> <span class="keyword">=</span>
  <span class="staexp"><span class="keyword">{</span>i<span class="keyword">,</span>j<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  <span class="staexp">g1int</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span>
<span class="keyword">,</span> <span class="staexp">g1int</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">j</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">fun0</span><span class="keyword">&gt;</span> <span class="staexp">bool</span><span class="keyword">(</span><span class="staexp">i</span> <span class="staexp">&gt;=</span> <span class="staexp">j</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g1int_gt <span class="keyword">:</span> <span class="staexp">g1int_gt_type</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">&gt;</span> <span class="keyword">with</span> g1int_gt <span class="keyword">of</span> 20</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g1int_gte <span class="keyword">:</span> <span class="staexp">g1int_gte_type</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">overload</span> &gt;= <span class="keyword">with</span> g1int_gte <span class="keyword">of</span> 20</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="keyword">typedef</span>
<span class="staexp">g1int_eq_type
  <span class="keyword">(</span><span class="staexp">tk<span class="keyword">:</span>tk</span><span class="keyword">)</span> <span class="keyword">=</span>
  <span class="staexp"><span class="keyword">{</span>i<span class="keyword">,</span>j<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  <span class="staexp">g1int</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span>
<span class="keyword">,</span> <span class="staexp">g1int</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">j</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">fun0</span><span class="keyword">&gt;</span> <span class="staexp">bool</span><span class="keyword">(</span><span class="staexp">i</span> <span class="staexp">==</span> <span class="staexp">j</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span>
<span class="staexp">g1int_neq_type
  <span class="keyword">(</span><span class="staexp">tk<span class="keyword">:</span>tk</span><span class="keyword">)</span> <span class="keyword">=</span>
  <span class="staexp"><span class="keyword">{</span>i<span class="keyword">,</span>j<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  <span class="staexp">g1int</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span>
<span class="keyword">,</span> <span class="staexp">g1int</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">j</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">fun0</span><span class="keyword">&gt;</span> <span class="staexp">bool</span><span class="keyword">(</span><span class="staexp">i</span> <span class="staexp">!=</span> <span class="staexp">j</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g1int_eq <span class="keyword">:</span> <span class="staexp">g1int_eq_type</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">=</span> <span class="keyword">with</span> g1int_eq <span class="keyword">of</span> 20</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g1int_neq <span class="keyword">:</span> <span class="staexp">g1int_neq_type</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">overload</span> != <span class="keyword">with</span> g1int_neq <span class="keyword">of</span> 20</span>
<span class="dynexp"><span class="keyword">overload</span> &lt;&gt; <span class="keyword">with</span> g1int_neq <span class="keyword">of</span> 20</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="keyword">typedef</span>
<span class="staexp">g1int_compare_type
  <span class="keyword">(</span><span class="staexp">tk<span class="keyword">:</span>tk</span><span class="keyword">)</span> <span class="keyword">=</span>
  <span class="staexp"><span class="keyword">{</span>i<span class="keyword">,</span>j<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  <span class="staexp">g1int</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span>
<span class="keyword">,</span> <span class="staexp">g1int</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">j</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">fun0</span><span class="keyword">&gt;</span> <span class="staexp">int</span><span class="keyword">(</span><span class="staexp">sgn</span><span class="keyword">(</span><span class="staexp">i</span><span class="staexp">-</span><span class="staexp">j</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g1int_compare <span class="keyword">:</span> <span class="staexp">g1int_compare_type</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">overload</span> compare <span class="keyword">with</span> g1int_compare <span class="keyword">of</span> 20</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="keyword">typedef</span>
<span class="staexp">g1int_max_type
  <span class="keyword">(</span><span class="staexp">tk<span class="keyword">:</span>tk</span><span class="keyword">)</span> <span class="keyword">=</span>
  <span class="staexp"><span class="keyword">{</span>i<span class="keyword">,</span>j<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  <span class="staexp">g1int</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span>
<span class="keyword">,</span> <span class="staexp">g1int</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">j</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">fun0</span><span class="keyword">&gt;</span> <span class="staexp">g1int</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">max</span><span class="keyword">(</span><span class="staexp">i</span><span class="keyword">,</span> <span class="staexp">j</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g1int_max <span class="keyword">:</span> <span class="staexp">g1int_max_type</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">overload</span> max <span class="keyword">with</span> g1int_max <span class="keyword">of</span> 20</span>
<span class="comment">//</span>
<span class="keyword">typedef</span>
<span class="staexp">g1int_min_type
  <span class="keyword">(</span><span class="staexp">tk<span class="keyword">:</span>tk</span><span class="keyword">)</span> <span class="keyword">=</span>
  <span class="staexp"><span class="keyword">{</span>i<span class="keyword">,</span>j<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  <span class="staexp">g1int</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span>
<span class="keyword">,</span> <span class="staexp">g1int</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">j</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">fun0</span><span class="keyword">&gt;</span> <span class="staexp">g1int</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">min</span><span class="keyword">(</span><span class="staexp">i</span><span class="keyword">,</span> <span class="staexp">j</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g1int_min <span class="keyword">:</span> <span class="staexp">g1int_min_type</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">overload</span> min <span class="keyword">with</span> g1int_min <span class="keyword">of</span> 20</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
lt_g1int_int<span class="staexp"><span class="keyword">{</span>i<span class="keyword">,</span>j<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span><span class="staexp">g1int</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">int</span><span class="keyword">(</span><span class="staexp">j</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span><span class="keyword">(</span><span class="staexp">i</span> <span class="staexp"><span class="keyword">&lt;</span></span> <span class="staexp">j</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
lte_g1int_int<span class="staexp"><span class="keyword">{</span>i<span class="keyword">,</span>j<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span><span class="staexp">g1int</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">int</span><span class="keyword">(</span><span class="staexp">j</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span><span class="keyword">(</span><span class="staexp">i</span> <span class="staexp">&lt;=</span> <span class="staexp">j</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">&lt;</span> <span class="keyword">with</span> lt_g1int_int <span class="keyword">of</span> 21</span>
<span class="dynexp"><span class="keyword">overload</span> &lt;= <span class="keyword">with</span> lte_g1int_int <span class="keyword">of</span> 21</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
gt_g1int_int<span class="staexp"><span class="keyword">{</span>i<span class="keyword">,</span>j<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span><span class="staexp">g1int</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">int</span><span class="keyword">(</span><span class="staexp">j</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span><span class="keyword">(</span><span class="staexp">i</span> <span class="staexp"><span class="keyword">&gt;</span></span> <span class="staexp">j</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
gte_g1int_int<span class="staexp"><span class="keyword">{</span>i<span class="keyword">,</span>j<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span><span class="staexp">g1int</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">int</span><span class="keyword">(</span><span class="staexp">j</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span><span class="keyword">(</span><span class="staexp">i</span> <span class="staexp">&gt;=</span> <span class="staexp">j</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">&gt;</span> <span class="keyword">with</span> gt_g1int_int <span class="keyword">of</span> 21</span>
<span class="dynexp"><span class="keyword">overload</span> &gt;= <span class="keyword">with</span> gte_g1int_int <span class="keyword">of</span> 21</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
eq_g1int_int<span class="staexp"><span class="keyword">{</span>i<span class="keyword">,</span>j<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span><span class="staexp">g1int</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">int</span><span class="keyword">(</span><span class="staexp">j</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span><span class="keyword">(</span><span class="staexp">i</span> <span class="staexp">==</span> <span class="staexp">j</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">=</span> <span class="keyword">with</span> eq_g1int_int <span class="keyword">of</span> 21</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
neq_g1int_int<span class="staexp"><span class="keyword">{</span>i<span class="keyword">,</span>j<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span><span class="staexp">g1int</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">int</span><span class="keyword">(</span><span class="staexp">j</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span><span class="keyword">(</span><span class="staexp">i</span> <span class="staexp">!=</span> <span class="staexp">j</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> != <span class="keyword">with</span> neq_g1int_int <span class="keyword">of</span> 21</span>
<span class="dynexp"><span class="keyword">overload</span> &lt;&gt; <span class="keyword">with</span> neq_g1int_int <span class="keyword">of</span> 21</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
compare_g1int_int<span class="staexp"><span class="keyword">{</span>i<span class="keyword">,</span>j<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span><span class="staexp">g1int</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">int</span><span class="keyword">(</span><span class="staexp">j</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int</span><span class="keyword">(</span><span class="staexp">sgn</span><span class="keyword">(</span><span class="staexp">i</span><span class="staexp">-</span><span class="staexp">j</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> compare <span class="keyword">with</span> compare_g1int_int <span class="keyword">of</span> 21</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g1int_sgn<span class="staexp"><span class="keyword">{</span>i<span class="keyword">:</span>int<span class="keyword">}</span></span><span class="keyword">(</span><span class="staexp">g1int</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int</span><span class="keyword">(</span><span class="staexp">sgn</span><span class="keyword">(</span><span class="staexp">i</span><span class="keyword">)</span><span class="keyword">)</span></span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">// HX: for unsigned unindexed integer types</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
k1<span class="keyword">,</span>k2<span class="keyword">:</span>tk
<span class="keyword">}</span></span> g0int2uint<span class="keyword">(</span><span class="staexp">g0int</span><span class="keyword">(</span><span class="staexp">k1</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">g0uint</span><span class="keyword">(</span><span class="staexp">k2</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
g0int2uint_int_uint<span class="keyword">(</span><span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uint</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
k1<span class="keyword">,</span>k2<span class="keyword">:</span>tk
<span class="keyword">}</span></span> g0uint2int<span class="keyword">(</span><span class="staexp">g0uint</span><span class="keyword">(</span><span class="staexp">k1</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">g0int</span><span class="keyword">(</span><span class="staexp">k2</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
g0uint2int_uint_int<span class="keyword">(</span><span class="staexp">uint</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
k1<span class="keyword">,</span>k2<span class="keyword">:</span>tk
<span class="keyword">}</span></span> g0uint2uint<span class="keyword">(</span><span class="staexp">g0uint</span><span class="keyword">(</span><span class="staexp">k1</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">g0uint</span><span class="keyword">(</span><span class="staexp">k2</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
g0uint2uint_uint_uint<span class="keyword">(</span><span class="staexp">uint</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uint</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g0string2uint<span class="keyword">(</span>rep<span class="keyword">:</span> <span class="staexp">NSH</span><span class="keyword">(</span><span class="staexp">string</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">g0uint</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
g0string2uint_uint<span class="keyword">(</span>rep<span class="keyword">:</span> <span class="staexp">NSH</span><span class="keyword">(</span><span class="staexp">string</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uint</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g0uint_succ
  <span class="keyword">(</span><span class="staexp">g0uint</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">g0uint</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g0uint_pred
  <span class="keyword">(</span><span class="staexp">g0uint</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">g0uint</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> succ <span class="keyword">with</span> g0uint_succ <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> pred <span class="keyword">with</span> g0uint_pred <span class="keyword">of</span> 0</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g0uint_half
  <span class="keyword">(</span><span class="staexp">g0uint</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">g0uint</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> half <span class="keyword">with</span> g0uint_half <span class="keyword">of</span> 0</span>
<span class="comment">//</span>
<span class="comment">(*
fun{tk:tk}
g0uint_double
  (g0uint(tk)):&lt;&gt; g0uint(tk)
overload double with g0uint_double of 0
*)</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
tk<span class="keyword">:</span>tk
<span class="keyword">}</span></span> g0uint_add
  <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">g0uint</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">g0uint</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">g0uint</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">overload</span> + <span class="keyword">with</span> g0uint_add <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
tk<span class="keyword">:</span>tk
<span class="keyword">}</span></span> g0uint_sub
  <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">g0uint</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">g0uint</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">g0uint</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">overload</span> - <span class="keyword">with</span> g0uint_sub <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
tk<span class="keyword">:</span>tk
<span class="keyword">}</span></span> g0uint_mul
  <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">g0uint</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">g0uint</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">g0uint</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">overload</span> * <span class="keyword">with</span> g0uint_mul <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
tk<span class="keyword">:</span>tk
<span class="keyword">}</span></span> g0uint_div
  <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">g0uint</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">g0uint</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">g0uint</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">overload</span> / <span class="keyword">with</span> g0uint_div <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
tk<span class="keyword">:</span>tk
<span class="keyword">}</span></span> g0uint_mod
  <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">g0uint</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">g0uint</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">g0uint</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">overload</span> % <span class="keyword">with</span> g0uint_mod <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> mod <span class="keyword">with</span> g0uint_mod <span class="keyword">of</span> 0</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g0uint_lsl
<span class="keyword">(</span>
  x<span class="keyword">:</span> <span class="staexp">g0uint</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">intGte</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">g0uint</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g0uint_lsr
<span class="keyword">(</span>
  x<span class="keyword">:</span> <span class="staexp">g0uint</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">intGte</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">g0uint</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> &lt;&lt; <span class="keyword">with</span> g0uint_lsl <span class="keyword">of</span> 10</span>
<span class="dynexp"><span class="keyword">overload</span> &gt;&gt; <span class="keyword">with</span> g0uint_lsr <span class="keyword">of</span> 10</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g0uint_lnot
  <span class="keyword">(</span><span class="staexp">g0uint</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">g0uint</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">~</span> <span class="keyword">with</span> g0uint_lnot</span>
<span class="dynexp"><span class="keyword">overload</span> lnot <span class="keyword">with</span> g0uint_lnot</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g0uint_lor
  <span class="keyword">(</span><span class="staexp">g0uint</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">g0uint</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">g0uint</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g0uint_lxor
  <span class="keyword">(</span><span class="staexp">g0uint</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">g0uint</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">g0uint</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g0uint_land
  <span class="keyword">(</span><span class="staexp">g0uint</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">g0uint</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">g0uint</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> lor <span class="keyword">with</span> g0uint_lor</span>
<span class="dynexp"><span class="keyword">overload</span> lxor <span class="keyword">with</span> g0uint_lxor</span>
<span class="dynexp"><span class="keyword">overload</span> land <span class="keyword">with</span> g0uint_land</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g0uint_isgtz<span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">g0uint</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g0uint_iseqz<span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">g0uint</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g0uint_isneqz<span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">g0uint</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> isgtz <span class="keyword">with</span> g0uint_isgtz <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> iseqz <span class="keyword">with</span> g0uint_iseqz <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> isneqz <span class="keyword">with</span> g0uint_isneqz <span class="keyword">of</span> 0</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
tk<span class="keyword">:</span>tk
<span class="keyword">}</span></span> g0uint_lt
  <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">g0uint</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">g0uint</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span></span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">&lt;</span> <span class="keyword">with</span> g0uint_lt <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
tk<span class="keyword">:</span>tk
<span class="keyword">}</span></span> g0uint_lte
  <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">g0uint</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">g0uint</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span></span>
<span class="dynexp"><span class="keyword">overload</span> &lt;= <span class="keyword">with</span> g0uint_lte <span class="keyword">of</span> 0</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
tk<span class="keyword">:</span>tk
<span class="keyword">}</span></span> g0uint_gt
  <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">g0uint</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">g0uint</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span></span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">&gt;</span> <span class="keyword">with</span> g0uint_gt <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
tk<span class="keyword">:</span>tk
<span class="keyword">}</span></span> g0uint_gte
  <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">g0uint</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">g0uint</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span></span>
<span class="dynexp"><span class="keyword">overload</span> &gt;= <span class="keyword">with</span> g0uint_gte <span class="keyword">of</span> 0</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
tk<span class="keyword">:</span>tk
<span class="keyword">}</span></span> g0uint_eq
  <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">g0uint</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">g0uint</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span></span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">=</span> <span class="keyword">with</span> g0uint_eq <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
tk<span class="keyword">:</span>tk
<span class="keyword">}</span></span> g0uint_neq
  <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">g0uint</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">g0uint</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span></span>
<span class="dynexp"><span class="keyword">overload</span> != <span class="keyword">with</span> g0uint_neq <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> &lt;&gt; <span class="keyword">with</span> g0uint_neq <span class="keyword">of</span> 0</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g0uint_compare
  <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">g0uint</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">g0uint</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> compare <span class="keyword">with</span> g0uint_compare <span class="keyword">of</span> 0</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g0uint_max
  <span class="keyword">(</span><span class="staexp">g0uint</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">g0uint</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">g0uint</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>

<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g0uint_min
  <span class="keyword">(</span><span class="staexp">g0uint</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">g0uint</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">g0uint</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> max <span class="keyword">with</span> g0uint_max <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> min <span class="keyword">with</span> g0uint_min <span class="keyword">of</span> 0</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
lt_g0uint_int
  <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">g0uint</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
lte_g0uint_int
  <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">g0uint</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">&lt;</span> <span class="keyword">with</span> lt_g0uint_int <span class="keyword">of</span> 11</span>
<span class="dynexp"><span class="keyword">overload</span> &lt;= <span class="keyword">with</span> lte_g0uint_int <span class="keyword">of</span> 11</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
gt_g0uint_int
  <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">g0uint</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
gte_g0uint_int
  <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">g0uint</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">&gt;</span> <span class="keyword">with</span> gt_g0uint_int <span class="keyword">of</span> 11</span>
<span class="dynexp"><span class="keyword">overload</span> &gt;= <span class="keyword">with</span> gte_g0uint_int <span class="keyword">of</span> 11</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
eq_g0uint_int
  <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">g0uint</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
neq_g0uint_int
  <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">g0uint</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">=</span> <span class="keyword">with</span> eq_g0uint_int <span class="keyword">of</span> 11</span>
<span class="dynexp"><span class="keyword">overload</span> != <span class="keyword">with</span> neq_g0uint_int <span class="keyword">of</span> 11</span>
<span class="dynexp"><span class="keyword">overload</span> &lt;&gt; <span class="keyword">with</span> neq_g0uint_int <span class="keyword">of</span> 11</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">// HX: for unsigned indexed integer types</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">praxi</span>
lemma_g1uint_param
  <span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>i<span class="keyword">:</span>int<span class="keyword">}</span></span><span class="keyword">(</span><span class="staexp">g1uint</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp"><span class="keyword">[</span>i &gt;= 0<span class="keyword">]</span></span> <span class="staexp">void</span></span>
<span class="comment">// end of [lemma_g1uint_param]</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">castfn</span>
size_of_int<span class="staexp"><span class="keyword">{</span>i<span class="keyword">:</span>nat<span class="keyword">}</span></span><span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">(</span><span class="staexp">i</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">size_t</span><span class="keyword">(</span><span class="staexp">i</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">castfn</span>
ssize_of_int<span class="staexp"><span class="keyword">{</span>i<span class="keyword">:</span>int<span class="keyword">}</span></span><span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">(</span><span class="staexp">i</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">ssize_t</span><span class="keyword">(</span><span class="staexp">i</span><span class="keyword">)</span></span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">castfn</span>
g0ofg1_uint<span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span><span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">g1uint</span> <span class="staexp">tk</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">g0uint</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">castfn</span>
g1ofg0_uint<span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span><span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">g0uint</span> <span class="staexp">tk</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">g1uint0</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> g0ofg1 <span class="keyword">with</span> g0ofg1_uint</span> <span class="comment">// index-erasing</span>
<span class="dynexp"><span class="keyword">overload</span> g1ofg0 <span class="keyword">with</span> g1ofg0_uint</span> <span class="comment">// index-inducing</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="keyword">typedef</span>
<span class="staexp">g1int2int_type
  <span class="keyword">(</span><span class="staexp">k1<span class="keyword">:</span>tk</span><span class="keyword">,</span> <span class="staexp">k2<span class="keyword">:</span>tk</span><span class="keyword">)</span> <span class="keyword">=</span> 
  <span class="staexp"><span class="keyword">{</span>i<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span><span class="staexp">g1int</span><span class="keyword">(</span><span class="staexp">k1</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">fun0</span><span class="keyword">&gt;</span> <span class="staexp">g1int</span><span class="keyword">(</span><span class="staexp">k2</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span>
<span class="staexp">g1int2uint_type
  <span class="keyword">(</span><span class="staexp">k1<span class="keyword">:</span>tk</span><span class="keyword">,</span> <span class="staexp">k2<span class="keyword">:</span>tk</span><span class="keyword">)</span> <span class="keyword">=</span>
  <span class="staexp"><span class="keyword">{</span>i<span class="keyword">:</span>nat<span class="keyword">}</span></span>
  <span class="keyword">(</span><span class="staexp">g1int</span><span class="keyword">(</span><span class="staexp">k1</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">fun0</span><span class="keyword">&gt;</span> <span class="staexp">g1uint</span><span class="keyword">(</span><span class="staexp">k2</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
k1<span class="keyword">,</span>k2<span class="keyword">:</span>tk
<span class="keyword">}</span></span> g1int2int <span class="keyword">:</span> <span class="staexp">g1int2int_type</span><span class="keyword">(</span><span class="staexp">k1</span><span class="keyword">,</span> <span class="staexp">k2</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
k1<span class="keyword">,</span>k2<span class="keyword">:</span>tk
<span class="keyword">}</span></span> g1int2uint <span class="keyword">:</span> <span class="staexp">g1int2uint_type</span><span class="keyword">(</span><span class="staexp">k1</span><span class="keyword">,</span> <span class="staexp">k2</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
g1int2int_int_int<span class="keyword">:</span>
<span class="staexp">g1int2int_type</span><span class="keyword">(</span><span class="staexp">intknd</span><span class="keyword">,</span> <span class="staexp">intknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span>
g1int2uint_int_uint<span class="keyword">:</span>
<span class="staexp">g1int2uint_type</span><span class="keyword">(</span><span class="staexp">intknd</span><span class="keyword">,</span> <span class="staexp">uintknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="keyword">typedef</span>
<span class="staexp">g1uint2int_type
  <span class="keyword">(</span><span class="staexp">k1<span class="keyword">:</span>tk</span><span class="keyword">,</span> <span class="staexp">k2<span class="keyword">:</span>tk</span><span class="keyword">)</span> <span class="keyword">=</span> 
  <span class="staexp"><span class="keyword">{</span>u<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  <span class="staexp">g1uint</span><span class="keyword">(</span><span class="staexp">k1</span><span class="keyword">,</span> <span class="staexp">u</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">fun0</span><span class="keyword">&gt;</span> <span class="staexp"><span class="keyword">[</span>u&gt;=0<span class="keyword">]</span></span> <span class="staexp">g1int</span><span class="keyword">(</span><span class="staexp">k2</span><span class="keyword">,</span> <span class="staexp">u</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span>
<span class="staexp">g1uint2uint_type
  <span class="keyword">(</span><span class="staexp">k1<span class="keyword">:</span>tk</span><span class="keyword">,</span> <span class="staexp">k2<span class="keyword">:</span>tk</span><span class="keyword">)</span> <span class="keyword">=</span>
  <span class="staexp"><span class="keyword">{</span>u<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span><span class="staexp">g1uint</span><span class="keyword">(</span><span class="staexp">k1</span><span class="keyword">,</span> <span class="staexp">u</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">fun0</span><span class="keyword">&gt;</span> <span class="staexp">g1uint</span><span class="keyword">(</span><span class="staexp">k2</span><span class="keyword">,</span> <span class="staexp">u</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
k1<span class="keyword">,</span>k2<span class="keyword">:</span>tk
<span class="keyword">}</span></span> g1uint2int <span class="keyword">:</span> <span class="staexp">g1uint2int_type</span><span class="keyword">(</span><span class="staexp">k1</span><span class="keyword">,</span> <span class="staexp">k2</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
k1<span class="keyword">,</span>k2<span class="keyword">:</span>tk
<span class="keyword">}</span></span> g1uint2uint <span class="keyword">:</span> <span class="staexp">g1uint2uint_type</span><span class="keyword">(</span><span class="staexp">k1</span><span class="keyword">,</span> <span class="staexp">k2</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
g1uint2int_uint_int<span class="keyword">:</span>
<span class="staexp">g1uint2int_type</span><span class="keyword">(</span><span class="staexp">uintknd</span><span class="keyword">,</span> <span class="staexp">intknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span>
g1uint2uint_uint_uint<span class="keyword">:</span>
<span class="staexp">g1uint2uint_type</span><span class="keyword">(</span><span class="staexp">uintknd</span><span class="keyword">,</span> <span class="staexp">uintknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g1string2uint<span class="keyword">(</span>rep<span class="keyword">:</span> <span class="staexp">NSH</span><span class="keyword">(</span><span class="staexp">string</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">g1uint</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prfun</span>
g1uint_get_index
  <span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>i1<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">g1uint</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i1</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><span class="keyword">[</span>i2<span class="keyword">:</span>int<span class="keyword">]</span></span> <span class="staexp">EQINT</span><span class="keyword">(</span><span class="staexp">i1</span><span class="keyword">,</span> <span class="staexp">i2</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="keyword">typedef</span>
<span class="staexp">g1uint_succ_type
  <span class="keyword">(</span><span class="staexp">tk<span class="keyword">:</span>tk</span><span class="keyword">)</span> <span class="keyword">=</span>
  <span class="staexp"><span class="keyword">{</span>i<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span><span class="staexp">g1uint</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">fun0</span><span class="keyword">&gt;</span> <span class="staexp">g1uint</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="staexp">+</span><span class="staexp">1</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span>
<span class="staexp">g1uint_pred_type
  <span class="keyword">(</span><span class="staexp">tk<span class="keyword">:</span>tk</span><span class="keyword">)</span> <span class="keyword">=</span>
  <span class="staexp"><span class="keyword">{</span>i<span class="keyword">:</span>int <span class="keyword">|</span> i <span class="keyword">&gt;</span> 0<span class="keyword">}</span></span>
  <span class="keyword">(</span><span class="staexp">g1uint</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">fun0</span><span class="keyword">&gt;</span> <span class="staexp">g1uint</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="staexp">-</span><span class="staexp">1</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g1uint_succ <span class="keyword">:</span> <span class="staexp">g1uint_succ_type</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">overload</span> succ <span class="keyword">with</span> g1uint_succ <span class="keyword">of</span> 10</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g1uint_pred <span class="keyword">:</span> <span class="staexp">g1uint_pred_type</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">overload</span> pred <span class="keyword">with</span> g1uint_pred <span class="keyword">of</span> 10</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="keyword">typedef</span>
<span class="staexp">g1uint_half_type
  <span class="keyword">(</span><span class="staexp">tk<span class="keyword">:</span>tk</span><span class="keyword">)</span> <span class="keyword">=</span>
  <span class="staexp"><span class="keyword">{</span>i<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  <span class="staexp">g1uint</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">fun0</span><span class="keyword">&gt;</span> <span class="staexp">g1uint</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="staexp">/</span><span class="staexp">2</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g1uint_half <span class="keyword">:</span> <span class="staexp">g1uint_half_type</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">overload</span> half <span class="keyword">with</span> g1uint_half <span class="keyword">of</span> 10</span>
<span class="comment">//</span>
<span class="keyword">typedef</span>
<span class="staexp">g1uint_double_type
  <span class="keyword">(</span><span class="staexp">tk<span class="keyword">:</span>tk</span><span class="keyword">)</span> <span class="keyword">=</span>
  <span class="staexp"><span class="keyword">{</span>i<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  <span class="staexp">g1uint</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">fun0</span><span class="keyword">&gt;</span> <span class="staexp">g1uint</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">2</span><span class="staexp">*</span><span class="staexp">i</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g1uint_double <span class="keyword">:</span> <span class="staexp">g1uint_double_type</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">overload</span> double <span class="keyword">with</span> g1uint_double <span class="keyword">of</span> 10</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="keyword">typedef</span>
<span class="staexp">g1uint_add_type
  <span class="keyword">(</span><span class="staexp">tk<span class="keyword">:</span>tk</span><span class="keyword">)</span> <span class="keyword">=</span>
  <span class="staexp"><span class="keyword">{</span>i<span class="keyword">,</span>j<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  <span class="staexp">g1uint</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span>
<span class="keyword">,</span> <span class="staexp">g1uint</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">j</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">fun0</span><span class="keyword">&gt;</span> <span class="staexp">g1uint</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="staexp">+</span><span class="staexp">j</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span>
<span class="staexp">g1uint_sub_type
  <span class="keyword">(</span><span class="staexp">tk<span class="keyword">:</span>tk</span><span class="keyword">)</span> <span class="keyword">=</span>
  <span class="staexp"><span class="keyword">{</span>i<span class="keyword">,</span>j<span class="keyword">:</span>int <span class="keyword">|</span> i &gt;= j<span class="keyword">}</span></span>
<span class="keyword">(</span>
  <span class="staexp">g1uint</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span>
<span class="keyword">,</span> <span class="staexp">g1uint</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">j</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">fun0</span><span class="keyword">&gt;</span> <span class="staexp">g1uint</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="staexp">-</span><span class="staexp">j</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g1uint_add <span class="keyword">:</span> <span class="staexp">g1uint_add_type</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g1uint_sub <span class="keyword">:</span> <span class="staexp">g1uint_sub_type</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> + <span class="keyword">with</span> g1uint_add <span class="keyword">of</span> 20</span>
<span class="dynexp"><span class="keyword">overload</span> - <span class="keyword">with</span> g1uint_sub <span class="keyword">of</span> 20</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="keyword">typedef</span>
<span class="staexp">g1uint_mul_type
  <span class="keyword">(</span><span class="staexp">tk<span class="keyword">:</span>tk</span><span class="keyword">)</span> <span class="keyword">=</span>
  <span class="staexp"><span class="keyword">{</span>i<span class="keyword">,</span>j<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  <span class="staexp">g1uint</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span>
<span class="keyword">,</span> <span class="staexp">g1uint</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">j</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">fun0</span><span class="keyword">&gt;</span> <span class="staexp">g1uint</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="staexp">*</span><span class="staexp">j</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g1uint_mul <span class="keyword">:</span> <span class="staexp">g1uint_mul_type</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g1uint_mul2
  <span class="staexp"><span class="keyword">{</span>i<span class="keyword">,</span>j<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  x<span class="keyword">:</span> <span class="staexp">g1uint</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">g1uint</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">j</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp"><span class="keyword">[</span>ij<span class="keyword">:</span>int<span class="keyword">]</span></span> <span class="keyword">(</span><span class="staexp">MUL</span><span class="keyword">(</span><span class="staexp">i</span><span class="keyword">,</span> <span class="staexp">j</span><span class="keyword">,</span> <span class="staexp">ij</span><span class="keyword">)</span> <span class="keyword">|</span> <span class="staexp">g1uint</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">ij</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> * <span class="keyword">with</span> g1uint_mul <span class="keyword">of</span> 20</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="keyword">typedef</span>
<span class="staexp">g1uint_div_type
  <span class="keyword">(</span><span class="staexp">tk<span class="keyword">:</span>tk</span><span class="keyword">)</span> <span class="keyword">=</span>
  <span class="staexp"><span class="keyword">{</span>i<span class="keyword">,</span>j<span class="keyword">:</span>int <span class="keyword">|</span> j <span class="keyword">&gt;</span> 0<span class="keyword">}</span></span>
<span class="keyword">(</span>
  <span class="staexp">g1uint</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span>
<span class="keyword">,</span> <span class="staexp">g1uint</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">j</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">fun0</span><span class="keyword">&gt;</span> <span class="staexp">g1uint</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="comment">// end of [g1uint_div_type]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g1uint_div <span class="keyword">:</span> <span class="staexp">g1uint_div_type</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g1uint_div2 <span class="staexp"><span class="keyword">{</span>i<span class="keyword">,</span>j<span class="keyword">:</span>int <span class="keyword">|</span> j <span class="keyword">&gt;</span> 0<span class="keyword">}</span></span>
<span class="keyword">(</span>
  x<span class="keyword">:</span> <span class="staexp">g1uint</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">g1uint</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">j</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp"><span class="keyword">[</span>q<span class="keyword">,</span>r<span class="keyword">:</span>int <span class="keyword">|</span> 0 &lt;= r<span class="keyword">;</span> r <span class="keyword">&lt;</span> j<span class="keyword">]</span></span> <span class="keyword">(</span><span class="staexp">DIVMOD</span> <span class="keyword">(</span><span class="staexp">i</span><span class="keyword">,</span> <span class="staexp">j</span><span class="keyword">,</span> <span class="staexp">q</span><span class="keyword">,</span> <span class="staexp">r</span><span class="keyword">)</span> <span class="keyword">|</span> <span class="staexp">g1uint</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">q</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> / <span class="keyword">with</span> g1uint_div <span class="keyword">of</span> 20</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="keyword">typedef</span>
<span class="staexp">g1uint_mod_type
  <span class="keyword">(</span><span class="staexp">tk<span class="keyword">:</span>tk</span><span class="keyword">)</span> <span class="keyword">=</span>
  <span class="staexp"><span class="keyword">{</span>i<span class="keyword">,</span>j<span class="keyword">:</span>int <span class="keyword">|</span> j <span class="keyword">&gt;</span> 0<span class="keyword">}</span></span>
<span class="keyword">(</span>
  <span class="staexp">g1uint</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span>
<span class="keyword">,</span> <span class="staexp">g1uint</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">j</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">fun0</span><span class="keyword">&gt;</span> <span class="staexp"><span class="keyword">[</span>r<span class="keyword">:</span>nat <span class="keyword">|</span> r <span class="keyword">&lt;</span> j<span class="keyword">]</span></span> <span class="staexp">g1uint</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">r</span><span class="keyword">)</span></span>
<span class="comment">// end of [g1uint_mod_type]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g1uint_mod <span class="keyword">:</span> <span class="staexp">g1uint_mod_type</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g1uint_mod2
  <span class="staexp"><span class="keyword">{</span>i<span class="keyword">,</span>j<span class="keyword">:</span>int <span class="keyword">|</span> j <span class="keyword">&gt;</span> 0<span class="keyword">}</span></span>
<span class="keyword">(</span>
  x<span class="keyword">:</span> <span class="staexp">g1uint</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">g1uint</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">j</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">&gt;</span>
<span class="staexp"><span class="keyword">[</span>
  q<span class="keyword">,</span>r<span class="keyword">:</span>int <span class="keyword">|</span> 0 &lt;= r<span class="keyword">;</span> r <span class="keyword">&lt;</span> j
<span class="keyword">]</span></span> <span class="keyword">(</span>
  <span class="staexp">DIVMOD</span> <span class="keyword">(</span><span class="staexp">i</span><span class="keyword">,</span> <span class="staexp">j</span><span class="keyword">,</span> <span class="staexp">q</span><span class="keyword">,</span> <span class="staexp">r</span><span class="keyword">)</span> <span class="keyword">|</span> <span class="staexp">g1uint</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">r</span><span class="keyword">)</span>
<span class="keyword">)</span></span> <span class="comment">(* end of [g1uint_mod2] *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> mod <span class="keyword">with</span> g1uint_mod <span class="keyword">of</span> 20</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="keyword">typedef</span>
<span class="staexp">g1uint_isgtz_type
  <span class="keyword">(</span><span class="staexp">tk<span class="keyword">:</span>tk</span><span class="keyword">)</span> <span class="keyword">=</span>
  <span class="staexp"><span class="keyword">{</span>i<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span><span class="staexp">g1uint</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">fun0</span><span class="keyword">&gt;</span> <span class="staexp">bool</span><span class="keyword">(</span><span class="staexp">i</span> <span class="staexp"><span class="keyword">&gt;</span></span> <span class="staexp">0</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g1uint_isgtz <span class="keyword">:</span> <span class="staexp">g1uint_isgtz_type</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">overload</span> isgtz <span class="keyword">with</span> g1uint_isgtz <span class="keyword">of</span> 10</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="keyword">typedef</span>
<span class="staexp">g1uint_iseqz_type
  <span class="keyword">(</span><span class="staexp">tk<span class="keyword">:</span>tk</span><span class="keyword">)</span> <span class="keyword">=</span>
  <span class="staexp"><span class="keyword">{</span>i<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span><span class="staexp">g1uint</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">fun0</span><span class="keyword">&gt;</span> <span class="staexp">bool</span><span class="keyword">(</span><span class="staexp">i</span> <span class="staexp"><span class="keyword">&gt;</span></span> <span class="staexp">0</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span>
<span class="staexp">g1uint_isneqz_type
  <span class="keyword">(</span><span class="staexp">tk<span class="keyword">:</span>tk</span><span class="keyword">)</span> <span class="keyword">=</span>
  <span class="staexp"><span class="keyword">{</span>i<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span><span class="staexp">g1uint</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">fun0</span><span class="keyword">&gt;</span> <span class="staexp">bool</span><span class="keyword">(</span><span class="staexp">i</span> <span class="staexp">&gt;=</span> <span class="staexp">0</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g1uint_iseqz <span class="keyword">:</span> <span class="staexp">g1uint_iseqz_type</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g1uint_isneqz <span class="keyword">:</span> <span class="staexp">g1uint_isneqz_type</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> iseqz <span class="keyword">with</span> g1uint_iseqz <span class="keyword">of</span> 10</span>
<span class="dynexp"><span class="keyword">overload</span> isneqz <span class="keyword">with</span> g1uint_isneqz <span class="keyword">of</span> 10</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="keyword">typedef</span>
<span class="staexp">g1uint_lt_type
  <span class="keyword">(</span><span class="staexp">tk<span class="keyword">:</span>tk</span><span class="keyword">)</span> <span class="keyword">=</span>
  <span class="staexp"><span class="keyword">{</span>i<span class="keyword">,</span>j<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  <span class="staexp">g1uint</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">g1uint</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">j</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">fun0</span><span class="keyword">&gt;</span> <span class="staexp">bool</span><span class="keyword">(</span><span class="staexp">i</span> <span class="staexp"><span class="keyword">&lt;</span></span> <span class="staexp">j</span><span class="keyword">)</span></span> <span class="comment">// endfun</span>
<span class="keyword">typedef</span>
<span class="staexp">g1uint_lte_type
  <span class="keyword">(</span><span class="staexp">tk<span class="keyword">:</span>tk</span><span class="keyword">)</span> <span class="keyword">=</span>
  <span class="staexp"><span class="keyword">{</span>i<span class="keyword">,</span>j<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  <span class="staexp">g1uint</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">g1uint</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">j</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">fun0</span><span class="keyword">&gt;</span> <span class="staexp">bool</span><span class="keyword">(</span><span class="staexp">i</span> <span class="staexp">&lt;=</span> <span class="staexp">j</span><span class="keyword">)</span></span> <span class="comment">// endfun</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g1uint_lt <span class="keyword">:</span> <span class="staexp">g1uint_lt_type</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g1uint_lte <span class="keyword">:</span> <span class="staexp">g1uint_lte_type</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">&lt;</span> <span class="keyword">with</span> g1uint_lt <span class="keyword">of</span> 20</span>
<span class="dynexp"><span class="keyword">overload</span> &lt;= <span class="keyword">with</span> g1uint_lte <span class="keyword">of</span> 20</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">typedef</span>
<span class="staexp">g1uint_gt_type
  <span class="keyword">(</span><span class="staexp">tk<span class="keyword">:</span>tk</span><span class="keyword">)</span> <span class="keyword">=</span>
  <span class="staexp"><span class="keyword">{</span>i<span class="keyword">,</span>j<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  <span class="staexp">g1uint</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">g1uint</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">j</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">fun0</span><span class="keyword">&gt;</span> <span class="staexp">bool</span><span class="keyword">(</span><span class="staexp">i</span> <span class="staexp"><span class="keyword">&gt;</span></span> <span class="staexp">j</span><span class="keyword">)</span></span> <span class="comment">// endfun</span>
<span class="keyword">typedef</span>
<span class="staexp">g1uint_gte_type
  <span class="keyword">(</span><span class="staexp">tk<span class="keyword">:</span>tk</span><span class="keyword">)</span> <span class="keyword">=</span>
  <span class="staexp"><span class="keyword">{</span>i<span class="keyword">,</span>j<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  <span class="staexp">g1uint</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">g1uint</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">j</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">fun0</span><span class="keyword">&gt;</span> <span class="staexp">bool</span><span class="keyword">(</span><span class="staexp">i</span> <span class="staexp">&gt;=</span> <span class="staexp">j</span><span class="keyword">)</span></span> <span class="comment">// endfun</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g1uint_gt <span class="keyword">:</span> <span class="staexp">g1uint_gt_type</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g1uint_gte <span class="keyword">:</span> <span class="staexp">g1uint_gte_type</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">&gt;</span> <span class="keyword">with</span> g1uint_gt <span class="keyword">of</span> 20</span>
<span class="dynexp"><span class="keyword">overload</span> &gt;= <span class="keyword">with</span> g1uint_gte <span class="keyword">of</span> 20</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="keyword">typedef</span>
<span class="staexp">g1uint_eq_type
  <span class="keyword">(</span><span class="staexp">tk<span class="keyword">:</span>tk</span><span class="keyword">)</span> <span class="keyword">=</span>
  <span class="staexp"><span class="keyword">{</span>i<span class="keyword">,</span>j<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  <span class="staexp">g1uint</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span>
<span class="keyword">,</span> <span class="staexp">g1uint</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">j</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">fun0</span><span class="keyword">&gt;</span> <span class="staexp">bool</span><span class="keyword">(</span><span class="staexp">i</span> <span class="staexp">==</span> <span class="staexp">j</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span>
<span class="staexp">g1uint_neq_type
  <span class="keyword">(</span><span class="staexp">tk<span class="keyword">:</span>tk</span><span class="keyword">)</span> <span class="keyword">=</span>
  <span class="staexp"><span class="keyword">{</span>i<span class="keyword">,</span>j<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  <span class="staexp">g1uint</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span>
<span class="keyword">,</span> <span class="staexp">g1uint</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">j</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">fun0</span><span class="keyword">&gt;</span> <span class="staexp">bool</span><span class="keyword">(</span><span class="staexp">i</span> <span class="staexp">!=</span> <span class="staexp">j</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g1uint_eq <span class="keyword">:</span> <span class="staexp">g1uint_eq_type</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g1uint_neq <span class="keyword">:</span> <span class="staexp">g1uint_neq_type</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">=</span> <span class="keyword">with</span> g1uint_eq <span class="keyword">of</span> 20</span>
<span class="dynexp"><span class="keyword">overload</span> != <span class="keyword">with</span> g1uint_neq <span class="keyword">of</span> 20</span>
<span class="dynexp"><span class="keyword">overload</span> &lt;&gt; <span class="keyword">with</span> g1uint_neq <span class="keyword">of</span> 20</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="keyword">typedef</span>
<span class="staexp">g1uint_compare_type
  <span class="keyword">(</span><span class="staexp">tk<span class="keyword">:</span>tk</span><span class="keyword">)</span> <span class="keyword">=</span>
  <span class="staexp"><span class="keyword">{</span>i<span class="keyword">,</span>j<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  <span class="staexp">g1uint</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span>
<span class="keyword">,</span> <span class="staexp">g1uint</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">j</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">fun0</span><span class="keyword">&gt;</span> <span class="staexp">int</span><span class="keyword">(</span><span class="staexp">sgn</span><span class="keyword">(</span><span class="staexp">i</span><span class="staexp">-</span><span class="staexp">j</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g1uint_compare <span class="keyword">:</span> <span class="staexp">g1uint_compare_type</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> compare <span class="keyword">with</span> g1uint_compare <span class="keyword">of</span> 20</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="keyword">typedef</span>
<span class="staexp">g1uint_max_type
  <span class="keyword">(</span><span class="staexp">tk<span class="keyword">:</span>tk</span><span class="keyword">)</span> <span class="keyword">=</span>
  <span class="staexp"><span class="keyword">{</span>i<span class="keyword">,</span>j<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  <span class="staexp">g1uint</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span>
<span class="keyword">,</span> <span class="staexp">g1uint</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">j</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">fun0</span><span class="keyword">&gt;</span> <span class="staexp">g1uint</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">max</span><span class="keyword">(</span><span class="staexp">i</span><span class="keyword">,</span> <span class="staexp">j</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span>
<span class="staexp">g1uint_min_type
  <span class="keyword">(</span><span class="staexp">tk<span class="keyword">:</span>tk</span><span class="keyword">)</span> <span class="keyword">=</span>
  <span class="staexp"><span class="keyword">{</span>i<span class="keyword">,</span>j<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  <span class="staexp">g1uint</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span>
<span class="keyword">,</span> <span class="staexp">g1uint</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">j</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">fun0</span><span class="keyword">&gt;</span> <span class="staexp">g1uint</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">min</span><span class="keyword">(</span><span class="staexp">i</span><span class="keyword">,</span> <span class="staexp">j</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g1uint_max <span class="keyword">:</span> <span class="staexp">g1uint_max_type</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g1uint_min <span class="keyword">:</span> <span class="staexp">g1uint_min_type</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> max <span class="keyword">with</span> g1uint_max <span class="keyword">of</span> 20</span>
<span class="dynexp"><span class="keyword">overload</span> min <span class="keyword">with</span> g1uint_min <span class="keyword">of</span> 20</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
lt_g1uint_int<span class="staexp"><span class="keyword">{</span>i<span class="keyword">:</span>int<span class="keyword">;</span>j<span class="keyword">:</span>nat<span class="keyword">}</span></span>
  <span class="keyword">(</span><span class="staexp">g1uint</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">int</span><span class="keyword">(</span><span class="staexp">j</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span><span class="keyword">(</span><span class="staexp">i</span> <span class="staexp"><span class="keyword">&lt;</span></span> <span class="staexp">j</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
lte_g1uint_int<span class="staexp"><span class="keyword">{</span>i<span class="keyword">:</span>int<span class="keyword">;</span>j<span class="keyword">:</span>nat<span class="keyword">}</span></span>
  <span class="keyword">(</span><span class="staexp">g1uint</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">int</span><span class="keyword">(</span><span class="staexp">j</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span><span class="keyword">(</span><span class="staexp">i</span> <span class="staexp">&lt;=</span> <span class="staexp">j</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">&lt;</span> <span class="keyword">with</span> lt_g1uint_int <span class="keyword">of</span> 21</span>
<span class="dynexp"><span class="keyword">overload</span> &lt;= <span class="keyword">with</span> lte_g1uint_int <span class="keyword">of</span> 21</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
gt_g1uint_int<span class="staexp"><span class="keyword">{</span>i<span class="keyword">:</span>int<span class="keyword">;</span>j<span class="keyword">:</span>nat<span class="keyword">}</span></span>
  <span class="keyword">(</span><span class="staexp">g1uint</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">int</span><span class="keyword">(</span><span class="staexp">j</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span><span class="keyword">(</span><span class="staexp">i</span> <span class="staexp"><span class="keyword">&gt;</span></span> <span class="staexp">j</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
gte_g1uint_int<span class="staexp"><span class="keyword">{</span>i<span class="keyword">:</span>int<span class="keyword">;</span>j<span class="keyword">:</span>nat<span class="keyword">}</span></span>
  <span class="keyword">(</span><span class="staexp">g1uint</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">int</span><span class="keyword">(</span><span class="staexp">j</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span><span class="keyword">(</span><span class="staexp">i</span> <span class="staexp">&gt;=</span> <span class="staexp">j</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">&gt;</span> <span class="keyword">with</span> gt_g1uint_int <span class="keyword">of</span> 21</span>
<span class="dynexp"><span class="keyword">overload</span> &gt;= <span class="keyword">with</span> gte_g1uint_int <span class="keyword">of</span> 21</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
eq_g1uint_int<span class="staexp"><span class="keyword">{</span>i<span class="keyword">:</span>int<span class="keyword">;</span>j<span class="keyword">:</span>nat<span class="keyword">}</span></span>
  <span class="keyword">(</span><span class="staexp">g1uint</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">int</span><span class="keyword">(</span><span class="staexp">j</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span><span class="keyword">(</span><span class="staexp">i</span> <span class="staexp">==</span> <span class="staexp">j</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
neq_g1uint_int<span class="staexp"><span class="keyword">{</span>i<span class="keyword">:</span>int<span class="keyword">;</span>j<span class="keyword">:</span>nat<span class="keyword">}</span></span>
  <span class="keyword">(</span><span class="staexp">g1uint</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">int</span><span class="keyword">(</span><span class="staexp">j</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span><span class="keyword">(</span><span class="staexp">i</span> <span class="staexp">!=</span> <span class="staexp">j</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">=</span> <span class="keyword">with</span> eq_g1uint_int <span class="keyword">of</span> 21</span>
<span class="dynexp"><span class="keyword">overload</span> != <span class="keyword">with</span> neq_g1uint_int <span class="keyword">of</span> 21</span>
<span class="dynexp"><span class="keyword">overload</span> &lt;&gt; <span class="keyword">with</span> neq_g1uint_int <span class="keyword">of</span> 21</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> print_int <span class="keyword">(</span><span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> prerr_int <span class="keyword">(</span><span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> fprint_int <span class="keyword">:</span> <span class="staexp">fprint_type</span> <span class="keyword">(</span><span class="staexp">int</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> print <span class="keyword">with</span> print_int</span>
<span class="dynexp"><span class="keyword">overload</span> prerr <span class="keyword">with</span> prerr_int</span>
<span class="dynexp"><span class="keyword">overload</span> fprint <span class="keyword">with</span> fprint_int</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> print_uint <span class="keyword">(</span><span class="staexp">uint</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> prerr_uint <span class="keyword">(</span><span class="staexp">uint</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> fprint_uint <span class="keyword">:</span> <span class="staexp">fprint_type</span> <span class="keyword">(</span><span class="staexp">uint</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> print <span class="keyword">with</span> print_uint</span>
<span class="dynexp"><span class="keyword">overload</span> prerr <span class="keyword">with</span> prerr_uint</span>
<span class="dynexp"><span class="keyword">overload</span> fprint <span class="keyword">with</span> fprint_uint</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_neg_int <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_abs_int <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_succ_int <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_pred_int <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_half_int <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_asl_int <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">intGte</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_asr_int <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">intGte</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_add_int <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_sub_int <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_mul_int <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_div_int <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_mod_int <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_lt_int <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_lte_int <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_gt_int <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_gte_int <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_eq_int <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_neq_int <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_compare_int <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_max_int <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_min_int <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_isltz_int <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_isltez_int <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_isgtz_int <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_isgtez_int <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_iseqz_int <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_isneqz_int <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_succ_uint <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uint</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_pred_uint <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uint</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_half_uint <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uint</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_add_uint <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">uint</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uint</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_sub_uint <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">uint</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uint</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_mul_uint <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">uint</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uint</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_div_uint <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">uint</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uint</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_mod_uint <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">uint</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uint</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_lsl_uint <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">intGte</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uint</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_lsr_uint <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">intGte</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uint</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_lnot_uint <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uint</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_lor_uint <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">uint</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uint</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_lxor_uint <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">uint</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uint</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_land_uint <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">uint</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uint</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_lt_uint <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">uint</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_lte_uint <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">uint</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_gt_uint <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">uint</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_gte_uint <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">uint</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_eq_uint <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">uint</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_neq_uint <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">uint</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_compare_uint <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">uint</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_max_uint <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">uint</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uint</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_min_uint <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">uint</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uint</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_isgtz_uint <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_iseqz_uint <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_isneqz_uint <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_neg_int <span class="keyword">:</span> <span class="staexp">g1int_neg_type</span> <span class="keyword">(</span><span class="staexp">intknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_abs_int <span class="keyword">:</span> <span class="staexp">g1int_abs_type</span> <span class="keyword">(</span><span class="staexp">intknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_succ_int <span class="keyword">:</span> <span class="staexp">g1int_succ_type</span> <span class="keyword">(</span><span class="staexp">intknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_pred_int <span class="keyword">:</span> <span class="staexp">g1int_pred_type</span> <span class="keyword">(</span><span class="staexp">intknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_half_int <span class="keyword">:</span> <span class="staexp">g1int_half_type</span> <span class="keyword">(</span><span class="staexp">intknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_add_int <span class="keyword">:</span> <span class="staexp">g1int_add_type</span> <span class="keyword">(</span><span class="staexp">intknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_sub_int <span class="keyword">:</span> <span class="staexp">g1int_sub_type</span> <span class="keyword">(</span><span class="staexp">intknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_mul_int <span class="keyword">:</span> <span class="staexp">g1int_mul_type</span> <span class="keyword">(</span><span class="staexp">intknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_div_int <span class="keyword">:</span> <span class="staexp">g1int_div_type</span> <span class="keyword">(</span><span class="staexp">intknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_nmod_int <span class="keyword">:</span> <span class="staexp">g1int_nmod_type</span> <span class="keyword">(</span><span class="staexp">intknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_lt_int <span class="keyword">:</span> <span class="staexp">g1int_lt_type</span> <span class="keyword">(</span><span class="staexp">intknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_lte_int <span class="keyword">:</span> <span class="staexp">g1int_lte_type</span> <span class="keyword">(</span><span class="staexp">intknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_gt_int <span class="keyword">:</span> <span class="staexp">g1int_gt_type</span> <span class="keyword">(</span><span class="staexp">intknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_gte_int <span class="keyword">:</span> <span class="staexp">g1int_gte_type</span> <span class="keyword">(</span><span class="staexp">intknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_eq_int <span class="keyword">:</span> <span class="staexp">g1int_eq_type</span> <span class="keyword">(</span><span class="staexp">intknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_neq_int <span class="keyword">:</span> <span class="staexp">g1int_neq_type</span> <span class="keyword">(</span><span class="staexp">intknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_compare_int <span class="keyword">:</span> <span class="staexp">g1int_compare_type</span> <span class="keyword">(</span><span class="staexp">intknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_max_int <span class="keyword">:</span> <span class="staexp">g1int_max_type</span> <span class="keyword">(</span><span class="staexp">intknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_min_int <span class="keyword">:</span> <span class="staexp">g1int_min_type</span> <span class="keyword">(</span><span class="staexp">intknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_isltz_int <span class="keyword">:</span> <span class="staexp">g1int_isltz_type</span> <span class="keyword">(</span><span class="staexp">intknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_isltez_int <span class="keyword">:</span> <span class="staexp">g1int_isltez_type</span> <span class="keyword">(</span><span class="staexp">intknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_isgtz_int <span class="keyword">:</span> <span class="staexp">g1int_isgtz_type</span> <span class="keyword">(</span><span class="staexp">intknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_isgtez_int <span class="keyword">:</span> <span class="staexp">g1int_isgtez_type</span> <span class="keyword">(</span><span class="staexp">intknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_iseqz_int <span class="keyword">:</span> <span class="staexp">g1int_iseqz_type</span> <span class="keyword">(</span><span class="staexp">intknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_isneqz_int <span class="keyword">:</span> <span class="staexp">g1int_isneqz_type</span> <span class="keyword">(</span><span class="staexp">intknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_succ_uint <span class="keyword">:</span> <span class="staexp">g1uint_succ_type</span> <span class="keyword">(</span><span class="staexp">uintknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_pred_uint <span class="keyword">:</span> <span class="staexp">g1uint_pred_type</span> <span class="keyword">(</span><span class="staexp">uintknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_half_uint <span class="keyword">:</span> <span class="staexp">g1uint_half_type</span> <span class="keyword">(</span><span class="staexp">uintknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_add_uint <span class="keyword">:</span> <span class="staexp">g1uint_add_type</span> <span class="keyword">(</span><span class="staexp">uintknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_sub_uint <span class="keyword">:</span> <span class="staexp">g1uint_sub_type</span> <span class="keyword">(</span><span class="staexp">uintknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_mul_uint <span class="keyword">:</span> <span class="staexp">g1uint_mul_type</span> <span class="keyword">(</span><span class="staexp">uintknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_div_uint <span class="keyword">:</span> <span class="staexp">g1uint_div_type</span> <span class="keyword">(</span><span class="staexp">uintknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_mod_uint <span class="keyword">:</span> <span class="staexp">g1uint_mod_type</span> <span class="keyword">(</span><span class="staexp">uintknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_lt_uint <span class="keyword">:</span> <span class="staexp">g1uint_lt_type</span> <span class="keyword">(</span><span class="staexp">uintknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_lte_uint <span class="keyword">:</span> <span class="staexp">g1uint_lte_type</span> <span class="keyword">(</span><span class="staexp">uintknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_gt_uint <span class="keyword">:</span> <span class="staexp">g1uint_gt_type</span> <span class="keyword">(</span><span class="staexp">uintknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_gte_uint <span class="keyword">:</span> <span class="staexp">g1uint_gte_type</span> <span class="keyword">(</span><span class="staexp">uintknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_eq_uint <span class="keyword">:</span> <span class="staexp">g1uint_eq_type</span> <span class="keyword">(</span><span class="staexp">uintknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_neq_uint <span class="keyword">:</span> <span class="staexp">g1uint_neq_type</span> <span class="keyword">(</span><span class="staexp">uintknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_compare_uint <span class="keyword">:</span> <span class="staexp">g1uint_compare_type</span> <span class="keyword">(</span><span class="staexp">uintknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_max_uint <span class="keyword">:</span> <span class="staexp">g1uint_max_type</span> <span class="keyword">(</span><span class="staexp">uintknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_min_uint <span class="keyword">:</span> <span class="staexp">g1uint_min_type</span> <span class="keyword">(</span><span class="staexp">uintknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_isgtz_uint <span class="keyword">:</span> <span class="staexp">g1uint_isgtz_type</span> <span class="keyword">(</span><span class="staexp">uintknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_iseqz_uint <span class="keyword">:</span> <span class="staexp">g1uint_iseqz_type</span> <span class="keyword">(</span><span class="staexp">uintknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_isneqz_uint <span class="keyword">:</span> <span class="staexp">g1uint_isneqz_type</span> <span class="keyword">(</span><span class="staexp">uintknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">macdef</span>
i2u<span class="dynexp"><span class="keyword">(</span>x<span class="keyword">)</span></span> <span class="keyword">=</span> g1int2uint_int_uint<span class="keyword">(</span><span class="dynexp"><span class="keyword">,(</span>x<span class="keyword">)</span></span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">macdef</span>
u2i<span class="dynexp"><span class="keyword">(</span>x<span class="keyword">)</span></span> <span class="keyword">=</span> g1uint2int_uint_int<span class="keyword">(</span><span class="dynexp"><span class="keyword">,(</span>x<span class="keyword">)</span></span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">macdef</span> g0i2i<span class="dynexp"><span class="keyword">(</span>x<span class="keyword">)</span></span> <span class="keyword">=</span> g0int2int<span class="keyword">(</span><span class="dynexp"><span class="keyword">,(</span>x<span class="keyword">)</span></span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">macdef</span> g1i2i<span class="dynexp"><span class="keyword">(</span>x<span class="keyword">)</span></span> <span class="keyword">=</span> g1int2int<span class="keyword">(</span><span class="dynexp"><span class="keyword">,(</span>x<span class="keyword">)</span></span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">macdef</span> g0i2u<span class="dynexp"><span class="keyword">(</span>x<span class="keyword">)</span></span> <span class="keyword">=</span> g0int2uint<span class="keyword">(</span><span class="dynexp"><span class="keyword">,(</span>x<span class="keyword">)</span></span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">macdef</span> g1i2u<span class="dynexp"><span class="keyword">(</span>x<span class="keyword">)</span></span> <span class="keyword">=</span> g1int2uint<span class="keyword">(</span><span class="dynexp"><span class="keyword">,(</span>x<span class="keyword">)</span></span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">macdef</span> g0u2i<span class="dynexp"><span class="keyword">(</span>x<span class="keyword">)</span></span> <span class="keyword">=</span> g0uint2int<span class="keyword">(</span><span class="dynexp"><span class="keyword">,(</span>x<span class="keyword">)</span></span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">macdef</span> g1u2i<span class="dynexp"><span class="keyword">(</span>x<span class="keyword">)</span></span> <span class="keyword">=</span> g1uint2int<span class="keyword">(</span><span class="dynexp"><span class="keyword">,(</span>x<span class="keyword">)</span></span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">macdef</span> g0u2u<span class="dynexp"><span class="keyword">(</span>x<span class="keyword">)</span></span> <span class="keyword">=</span> g0uint2uint<span class="keyword">(</span><span class="dynexp"><span class="keyword">,(</span>x<span class="keyword">)</span></span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">macdef</span> g1u2u<span class="dynexp"><span class="keyword">(</span>x<span class="keyword">)</span></span> <span class="keyword">=</span> g1uint2uint<span class="keyword">(</span><span class="dynexp"><span class="keyword">,(</span>x<span class="keyword">)</span></span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">// HX: implemented in [list_vt.dats]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
listize_g0int_rep
  <span class="staexp"><span class="keyword">{</span>b<span class="keyword">:</span>int <span class="keyword">|</span> b &gt;= 2<span class="keyword">}</span></span>
  <span class="keyword">(</span><span class="staexp">g0int</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">int</span><span class="keyword">(</span><span class="staexp">b</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">List0_vt</span><span class="keyword">(</span><span class="staexp">intBtw</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">,</span> <span class="staexp">b</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
listize_g0uint_rep
  <span class="staexp"><span class="keyword">{</span>b<span class="keyword">:</span>int <span class="keyword">|</span> b &gt;= 2<span class="keyword">}</span></span>
  <span class="keyword">(</span><span class="staexp">g0uint</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">int</span><span class="keyword">(</span><span class="staexp">b</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">List0_vt</span><span class="keyword">(</span><span class="staexp">intBtw</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">,</span> <span class="staexp">b</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* end of [integer.sats] *)</span>
</pre>
<pre class="patsyntax">
<span class="comment">(***********************************************************************)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(*                         Applied Type System                         *)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(***********************************************************************)</span>

<span class="comment">(*
** ATS/Postiats - Unleashing the Potential of Types!
** Copyright (C) 2010-2015 Hongwei Xi, ATS Trustful Software, Inc.
** All rights reserved
**
** ATS is free software;  you can  redistribute it and/or modify it under
** the terms of  the GNU GENERAL PUBLIC LICENSE (GPL) as published by the
** Free Software Foundation; either version 3, or (at  your  option)  any
** later version.
**
** ATS is distributed in the hope that it will be useful, but WITHOUT ANY
** WARRANTY; without  even  the  implied  warranty  of MERCHANTABILITY or
** FITNESS FOR A PARTICULAR PURPOSE.  See the  GNU General Public License
** for more details.
**
** You  should  have  received  a  copy of the GNU General Public License
** along  with  ATS;  see the  file COPYING.  If not, please write to the
** Free Software Foundation,  51 Franklin Street, Fifth Floor, Boston, MA
** 02110-1301, USA.
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
** Source:
** $PATSHOME/prelude/SATS/CODEGEN/pointer.atxt
** Time of generation: Mon Sep  5 21:48:30 2016
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* Author: Hongwei Xi *)</span>
<span class="comment">(* Authoremail: hwxi AT cs DOT bu DOT edu *)</span>
<span class="comment">(* Start time: March, 2012 *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="staexp"><span class="keyword">sortdef</span> tk <span class="keyword">=</span> tkind</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">sortdef</span>
t0p <span class="keyword">=</span> <span class="keyword">t@ype</span> <span class="keyword">and</span> vt0p <span class="keyword">=</span> <span class="keyword">viewt@ype</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">stadef</span> <span class="staexp">ptrknd <span class="keyword">=</span> <span class="staexp">ptr_kind</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="staexp"><span class="keyword">absprop</span> is_word_aligned_p <span class="keyword">(</span>l<span class="keyword">:</span>addr<span class="keyword">)</span></span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">castfn</span>
g0ofg1_ptr <span class="keyword">(</span>p<span class="keyword">:</span> <span class="staexp">Ptr</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">ptr</span></span>
<span class="dynexp"><span class="keyword">castfn</span>
g1ofg0_ptr <span class="keyword">(</span>p<span class="keyword">:</span> <span class="staexp">ptr</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">Ptr0</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> g0ofg1 <span class="keyword">with</span> g0ofg1_ptr</span>
<span class="dynexp"><span class="keyword">overload</span> g1ofg0 <span class="keyword">with</span> g1ofg0_ptr</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prfun</span>
lemma_ptr_param
  <span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span> <span class="keyword">(</span>p<span class="keyword">:</span> <span class="staexp">ptr</span> <span class="staexp">l</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><span class="keyword">[</span>l &gt;= null<span class="keyword">]</span></span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="prfexp"><span class="keyword">prfun</span>
ptr_get_index
  <span class="staexp"><span class="keyword">{</span>l1<span class="keyword">:</span>addr<span class="keyword">}</span></span> <span class="keyword">(</span>p<span class="keyword">:</span> <span class="staexp">ptr</span> <span class="staexp">l1</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><span class="keyword">[</span>l2<span class="keyword">:</span>addr<span class="keyword">]</span></span> <span class="staexp">EQADDR</span><span class="keyword">(</span><span class="staexp">l1</span><span class="keyword">,</span> <span class="staexp">l2</span><span class="keyword">)</span></span>
<span class="comment">// end of [ptr_get_index]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="neuexp"><span class="keyword">symintr</span> ptr_is_null</span>
<span class="neuexp"><span class="keyword">symintr</span> ptr_isnot_null</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="neuexp"><span class="keyword">symintr</span> add_ptr_bsz</span>
<span class="neuexp"><span class="keyword">symintr</span> sub_ptr_bsz</span>
<span class="comment">//</span>
<span class="comment">// add_ptr_bsz (p, ofs) = p + ofs</span>
<span class="comment">// sub_ptr_bsz (p, ofs) = p - ofs</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="neuexp"><span class="keyword">symintr</span> ptr_succ</span>
<span class="neuexp"><span class="keyword">symintr</span> ptr_pred</span>
<span class="comment">//</span>
<span class="comment">// ptr_succ&lt;a&gt;(p) = p + sizeof&lt;a&gt;</span>
<span class="comment">// ptr_pred&lt;a&gt;(p) = p - sizeof&lt;a&gt;</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="neuexp"><span class="keyword">symintr</span> ptr_add ptr_sub</span>
<span class="comment">//</span>
<span class="comment">// ptr_add&lt;a&gt; (p, ofs) = p + ofs*sizeof&lt;a&gt;</span>
<span class="comment">// ptr_sub&lt;a&gt; (p, ofs) = p - ofs*sizeof&lt;a&gt;</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span> ptr0_is_null <span class="keyword">(</span>p<span class="keyword">:</span> <span class="staexp">ptr</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> ptr_is_null <span class="keyword">with</span> ptr0_is_null <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">fun</span> ptr0_isnot_null <span class="keyword">(</span>p<span class="keyword">:</span> <span class="staexp">ptr</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> ptr_isnot_null <span class="keyword">with</span> ptr0_isnot_null <span class="keyword">of</span> 0</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> add_ptr0_bsz
  <span class="keyword">(</span>p<span class="keyword">:</span> <span class="staexp">ptr</span><span class="keyword">,</span> ofs<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">ptr</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> sub_ptr0_bsz
  <span class="keyword">(</span>p<span class="keyword">:</span> <span class="staexp">ptr</span><span class="keyword">,</span> ofs<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">ptr</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> add_ptr_bsz <span class="keyword">with</span> add_ptr0_bsz <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> sub_ptr_bsz <span class="keyword">with</span> sub_ptr0_bsz <span class="keyword">of</span> 0</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span> sub_ptr0_ptr0
  <span class="keyword">(</span>p1<span class="keyword">:</span> <span class="staexp">ptr</span><span class="keyword">,</span> p2<span class="keyword">:</span> <span class="staexp">ptr</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">ssize_t</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> - <span class="keyword">with</span> sub_ptr0_ptr0 <span class="keyword">of</span> 0</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span> ptr0_succ <span class="keyword">(</span>p<span class="keyword">:</span> <span class="staexp">ptr</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">ptr</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span> ptr0_pred <span class="keyword">(</span>p<span class="keyword">:</span> <span class="staexp">ptr</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">ptr</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> ptr_succ <span class="keyword">with</span> ptr0_succ <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> ptr_pred <span class="keyword">with</span> ptr0_pred <span class="keyword">of</span> 0</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk
<span class="keyword">}</span></span> ptr0_add_gint <span class="keyword">(</span>p<span class="keyword">:</span> <span class="staexp">ptr</span><span class="keyword">,</span> ofs<span class="keyword">:</span> <span class="staexp">g0int</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">ptr</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk
<span class="keyword">}</span></span> ptr0_add_guint <span class="keyword">(</span>p<span class="keyword">:</span> <span class="staexp">ptr</span><span class="keyword">,</span> ofs<span class="keyword">:</span> <span class="staexp">g0uint</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">ptr</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> ptr_add <span class="keyword">with</span> ptr0_add_gint <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> ptr_add <span class="keyword">with</span> ptr0_add_guint <span class="keyword">of</span> 0</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk
<span class="keyword">}</span></span> ptr0_sub_gint <span class="keyword">(</span>p<span class="keyword">:</span> <span class="staexp">ptr</span><span class="keyword">,</span> ofs<span class="keyword">:</span> <span class="staexp">g0int</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">ptr</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk
<span class="keyword">}</span></span> ptr0_sub_guint <span class="keyword">(</span>p<span class="keyword">:</span> <span class="staexp">ptr</span><span class="keyword">,</span> ofs<span class="keyword">:</span> <span class="staexp">g0uint</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">ptr</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> ptr_sub <span class="keyword">with</span> ptr0_sub_gint <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> ptr_sub <span class="keyword">with</span> ptr0_sub_guint <span class="keyword">of</span> 0</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span> lt_ptr0_ptr0
  <span class="keyword">(</span>p1<span class="keyword">:</span> <span class="staexp">ptr</span><span class="keyword">,</span> p2<span class="keyword">:</span> <span class="staexp">ptr</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">&lt;</span> <span class="keyword">with</span> lt_ptr0_ptr0 <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">fun</span> lte_ptr0_ptr0
  <span class="keyword">(</span>p1<span class="keyword">:</span> <span class="staexp">ptr</span><span class="keyword">,</span> p2<span class="keyword">:</span> <span class="staexp">ptr</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> &lt;= <span class="keyword">with</span> lte_ptr0_ptr0 <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">fun</span> gt_ptr0_ptr0
  <span class="keyword">(</span>p1<span class="keyword">:</span> <span class="staexp">ptr</span><span class="keyword">,</span> p2<span class="keyword">:</span> <span class="staexp">ptr</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">&gt;</span> <span class="keyword">with</span> gt_ptr0_ptr0 <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">fun</span> gte_ptr0_ptr0
  <span class="keyword">(</span>p1<span class="keyword">:</span> <span class="staexp">ptr</span><span class="keyword">,</span> p2<span class="keyword">:</span> <span class="staexp">ptr</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> &gt;= <span class="keyword">with</span> gte_ptr0_ptr0 <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">fun</span> eq_ptr0_ptr0
  <span class="keyword">(</span>p1<span class="keyword">:</span> <span class="staexp">ptr</span><span class="keyword">,</span> p2<span class="keyword">:</span> <span class="staexp">ptr</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">=</span> <span class="keyword">with</span> eq_ptr0_ptr0 <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">fun</span> neq_ptr0_ptr0
  <span class="keyword">(</span>p1<span class="keyword">:</span> <span class="staexp">ptr</span><span class="keyword">,</span> p2<span class="keyword">:</span> <span class="staexp">ptr</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> != <span class="keyword">with</span> neq_ptr0_ptr0 <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> &lt;&gt; <span class="keyword">with</span> neq_ptr0_ptr0 <span class="keyword">of</span> 0</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
compare_ptr0_ptr0
  <span class="keyword">(</span>p1<span class="keyword">:</span> <span class="staexp">ptr</span><span class="keyword">,</span> p2<span class="keyword">:</span> <span class="staexp">ptr</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> compare <span class="keyword">with</span> compare_ptr0_ptr0 <span class="keyword">of</span> 0</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
gt_ptr0_intz
  <span class="keyword">(</span>p<span class="keyword">:</span> <span class="staexp">ptr</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
eq_ptr0_intz
  <span class="keyword">(</span>p<span class="keyword">:</span> <span class="staexp">ptr</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span>
neq_ptr0_intz
  <span class="keyword">(</span>p<span class="keyword">:</span> <span class="staexp">ptr</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">&gt;</span> <span class="keyword">with</span> gt_ptr0_intz <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">=</span> <span class="keyword">with</span> eq_ptr0_intz <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> != <span class="keyword">with</span> neq_ptr0_intz <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> &lt;&gt; <span class="keyword">with</span> neq_ptr0_intz <span class="keyword">of</span> 0</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
fun{a:vt0p}
ptr0_add_int (p: ptr, i: int): ptr
fun{a:vt0p}
ptr0_add_lint (p: ptr, i: lint): ptr
fun{a:vt0p}
ptr0_add_ssize (p: ptr, i: ssize): ptr
fun{a:vt0p}
ptr0_add_uint (p: ptr, u: uint): ptr
fun{a:vt0p}
ptr0_add_ulint (p: ptr, u: ulint): ptr
fun{a:vt0p}
ptr0_add_size (p: ptr, u: size): ptr
*)</span>

<span class="comment">(*
fun{a:vt0p}
ptr0_sub_int (p: ptr, i: int): ptr
fun{a:vt0p}
ptr0_sub_lint (p: ptr, i: lint): ptr
fun{a:vt0p}
ptr0_sub_ssize (p: ptr, i: ssize): ptr
fun{a:vt0p}
ptr0_sub_uint (p: ptr, u: uint): ptr
fun{a:vt0p}
ptr0_sub_ulint (p: ptr, u: ulint): ptr
fun{a:vt0p}
ptr0_sub_size (p: ptr, u: size): ptr
*)</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
print_ptr <span class="keyword">(</span>p<span class="keyword">:</span> <span class="staexp">ptr</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span>
prerr_ptr <span class="keyword">(</span>p<span class="keyword">:</span> <span class="staexp">ptr</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span>
fprint_ptr <span class="keyword">:</span> <span class="staexp">fprint_type</span> <span class="keyword">(</span><span class="staexp">ptr</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> print <span class="keyword">with</span> print_ptr</span>
<span class="dynexp"><span class="keyword">overload</span> prerr <span class="keyword">with</span> prerr_ptr</span>
<span class="dynexp"><span class="keyword">overload</span> fprint <span class="keyword">with</span> fprint_ptr</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">praxi</span>
ptr1_is_gtez
  <span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span><span class="keyword">(</span>p<span class="keyword">:</span> <span class="staexp">ptr</span> <span class="staexp">l</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><span class="keyword">[</span>l &gt;= null<span class="keyword">]</span></span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
ptr1_is_null
  <span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span><span class="keyword">(</span>p<span class="keyword">:</span> <span class="staexp">ptr</span> <span class="staexp">l</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">(</span><span class="staexp">l</span><span class="staexp">==</span><span class="staexp">null</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span>
ptr1_isnot_null
  <span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span><span class="keyword">(</span>p<span class="keyword">:</span> <span class="staexp">ptr</span> <span class="staexp">l</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">(</span><span class="staexp">l</span> <span class="staexp"><span class="keyword">&gt;</span></span> <span class="staexp">null</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> ptr_is_null <span class="keyword">with</span> ptr1_is_null <span class="keyword">of</span> 10</span>
<span class="dynexp"><span class="keyword">overload</span> ptr_isnot_null <span class="keyword">with</span> ptr1_isnot_null <span class="keyword">of</span> 10</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
add_ptr1_bsz<span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>i<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>p<span class="keyword">:</span> <span class="staexp">ptr</span> <span class="staexp">l</span><span class="keyword">,</span> ofs<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="keyword">(</span><span class="staexp">i</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">ptr</span> <span class="keyword">(</span><span class="staexp">l</span><span class="staexp">+</span><span class="staexp">i</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span>
sub_ptr1_bsz<span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>i<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>p<span class="keyword">:</span> <span class="staexp">ptr</span> <span class="staexp">l</span><span class="keyword">,</span> ofs<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="keyword">(</span><span class="staexp">i</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">ptr</span> <span class="keyword">(</span><span class="staexp">l</span><span class="staexp">-</span><span class="staexp">i</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> add_ptr_bsz <span class="keyword">with</span> add_ptr1_bsz <span class="keyword">of</span> 20</span>
<span class="dynexp"><span class="keyword">overload</span> sub_ptr_bsz <span class="keyword">with</span> sub_ptr1_bsz <span class="keyword">of</span> 20</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
sub_ptr1_ptr1<span class="staexp"><span class="keyword">{</span>l1<span class="keyword">,</span>l2<span class="keyword">:</span>addr<span class="keyword">}</span></span>
  <span class="keyword">(</span>p1<span class="keyword">:</span> <span class="staexp">ptr</span> <span class="staexp">l1</span><span class="keyword">,</span> p2<span class="keyword">:</span> <span class="staexp">ptr</span> <span class="staexp">l2</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">ssize_t</span> <span class="keyword">(</span><span class="staexp">l1</span><span class="staexp">-</span><span class="staexp">l2</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> - <span class="keyword">with</span> sub_ptr1_ptr1 <span class="keyword">of</span> 20</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> ptr1_succ<span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span> <span class="keyword">(</span>p<span class="keyword">:</span> <span class="staexp">ptr</span> <span class="staexp">l</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">ptr</span> <span class="keyword">(</span><span class="staexp">l</span><span class="staexp">+</span><span class="staexp">sizeof</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> ptr1_pred<span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span> <span class="keyword">(</span>p<span class="keyword">:</span> <span class="staexp">ptr</span> <span class="staexp">l</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">ptr</span> <span class="keyword">(</span><span class="staexp">l</span><span class="staexp">-</span><span class="staexp">sizeof</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> ptr_succ <span class="keyword">with</span> ptr1_succ <span class="keyword">of</span> 10</span>
<span class="dynexp"><span class="keyword">overload</span> ptr_pred <span class="keyword">with</span> ptr1_pred <span class="keyword">of</span> 10</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk
<span class="keyword">}</span></span> ptr1_add_gint
  <span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>i<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>p<span class="keyword">:</span> <span class="staexp">ptr</span> <span class="staexp">l</span><span class="keyword">,</span> ofs<span class="keyword">:</span> <span class="staexp">g1int</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">ptr</span><span class="keyword">(</span><span class="staexp">l</span><span class="staexp">+</span><span class="staexp">i</span><span class="staexp">*</span><span class="staexp">sizeof</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk
<span class="keyword">}</span></span> ptr1_add_guint
  <span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>i<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>p<span class="keyword">:</span> <span class="staexp">ptr</span> <span class="staexp">l</span><span class="keyword">,</span> ofs<span class="keyword">:</span> <span class="staexp">g1uint</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">ptr</span><span class="keyword">(</span><span class="staexp">l</span><span class="staexp">+</span><span class="staexp">i</span><span class="staexp">*</span><span class="staexp">sizeof</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> ptr_add <span class="keyword">with</span> ptr1_add_gint <span class="keyword">of</span> 20</span>
<span class="dynexp"><span class="keyword">overload</span> ptr_add <span class="keyword">with</span> ptr1_add_guint <span class="keyword">of</span> 20</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk
<span class="keyword">}</span></span> ptr1_sub_gint
  <span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>i<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>p<span class="keyword">:</span> <span class="staexp">ptr</span> <span class="staexp">l</span><span class="keyword">,</span> ofs<span class="keyword">:</span> <span class="staexp">g1int</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">ptr</span><span class="keyword">(</span><span class="staexp">l</span><span class="staexp">-</span><span class="staexp">i</span><span class="staexp">*</span><span class="staexp">sizeof</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk
<span class="keyword">}</span></span> ptr1_sub_guint
  <span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>i<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>p<span class="keyword">:</span> <span class="staexp">ptr</span> <span class="staexp">l</span><span class="keyword">,</span> ofs<span class="keyword">:</span> <span class="staexp">g1uint</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">ptr</span><span class="keyword">(</span><span class="staexp">l</span><span class="staexp">-</span><span class="staexp">i</span><span class="staexp">*</span><span class="staexp">sizeof</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> ptr_sub <span class="keyword">with</span> ptr1_sub_gint <span class="keyword">of</span> 20</span>
<span class="dynexp"><span class="keyword">overload</span> ptr_sub <span class="keyword">with</span> ptr1_sub_guint <span class="keyword">of</span> 20</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span> lt_ptr1_ptr1
  <span class="staexp"><span class="keyword">{</span>l1<span class="keyword">,</span>l2<span class="keyword">:</span>addr<span class="keyword">}</span></span> <span class="keyword">(</span>
  p1<span class="keyword">:</span> <span class="staexp">ptr</span> <span class="keyword">(</span><span class="staexp">l1</span><span class="keyword">)</span><span class="keyword">,</span> p2<span class="keyword">:</span> <span class="staexp">ptr</span> <span class="keyword">(</span><span class="staexp">l2</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">(</span><span class="staexp">l1</span> <span class="staexp"><span class="keyword">&lt;</span></span> <span class="staexp">l2</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">&lt;</span> <span class="keyword">with</span> lt_ptr1_ptr1 <span class="keyword">of</span> 20</span>
<span class="dynexp"><span class="keyword">fun</span> lte_ptr1_ptr1
  <span class="staexp"><span class="keyword">{</span>l1<span class="keyword">,</span>l2<span class="keyword">:</span>addr<span class="keyword">}</span></span> <span class="keyword">(</span>
  p1<span class="keyword">:</span> <span class="staexp">ptr</span> <span class="keyword">(</span><span class="staexp">l1</span><span class="keyword">)</span><span class="keyword">,</span> p2<span class="keyword">:</span> <span class="staexp">ptr</span> <span class="keyword">(</span><span class="staexp">l2</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">(</span><span class="staexp">l1</span> <span class="staexp">&lt;=</span> <span class="staexp">l2</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> &lt;= <span class="keyword">with</span> lte_ptr1_ptr1 <span class="keyword">of</span> 20</span>
<span class="dynexp"><span class="keyword">fun</span> gt_ptr1_ptr1
  <span class="staexp"><span class="keyword">{</span>l1<span class="keyword">,</span>l2<span class="keyword">:</span>addr<span class="keyword">}</span></span> <span class="keyword">(</span>
  p1<span class="keyword">:</span> <span class="staexp">ptr</span> <span class="keyword">(</span><span class="staexp">l1</span><span class="keyword">)</span><span class="keyword">,</span> p2<span class="keyword">:</span> <span class="staexp">ptr</span> <span class="keyword">(</span><span class="staexp">l2</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">(</span><span class="staexp">l1</span> <span class="staexp"><span class="keyword">&gt;</span></span> <span class="staexp">l2</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">&gt;</span> <span class="keyword">with</span> gt_ptr1_ptr1 <span class="keyword">of</span> 20</span>
<span class="dynexp"><span class="keyword">fun</span> gte_ptr1_ptr1
  <span class="staexp"><span class="keyword">{</span>l1<span class="keyword">,</span>l2<span class="keyword">:</span>addr<span class="keyword">}</span></span> <span class="keyword">(</span>
  p1<span class="keyword">:</span> <span class="staexp">ptr</span> <span class="keyword">(</span><span class="staexp">l1</span><span class="keyword">)</span><span class="keyword">,</span> p2<span class="keyword">:</span> <span class="staexp">ptr</span> <span class="keyword">(</span><span class="staexp">l2</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">(</span><span class="staexp">l1</span> <span class="staexp">&gt;=</span> <span class="staexp">l2</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> &gt;= <span class="keyword">with</span> gte_ptr1_ptr1 <span class="keyword">of</span> 20</span>
<span class="dynexp"><span class="keyword">fun</span> eq_ptr1_ptr1
  <span class="staexp"><span class="keyword">{</span>l1<span class="keyword">,</span>l2<span class="keyword">:</span>addr<span class="keyword">}</span></span> <span class="keyword">(</span>
  p1<span class="keyword">:</span> <span class="staexp">ptr</span> <span class="keyword">(</span><span class="staexp">l1</span><span class="keyword">)</span><span class="keyword">,</span> p2<span class="keyword">:</span> <span class="staexp">ptr</span> <span class="keyword">(</span><span class="staexp">l2</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">(</span><span class="staexp">l1</span> <span class="staexp">==</span> <span class="staexp">l2</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">=</span> <span class="keyword">with</span> eq_ptr1_ptr1 <span class="keyword">of</span> 20</span>
<span class="dynexp"><span class="keyword">fun</span> neq_ptr1_ptr1
  <span class="staexp"><span class="keyword">{</span>l1<span class="keyword">,</span>l2<span class="keyword">:</span>addr<span class="keyword">}</span></span> <span class="keyword">(</span>
  p1<span class="keyword">:</span> <span class="staexp">ptr</span> <span class="keyword">(</span><span class="staexp">l1</span><span class="keyword">)</span><span class="keyword">,</span> p2<span class="keyword">:</span> <span class="staexp">ptr</span> <span class="keyword">(</span><span class="staexp">l2</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">(</span><span class="staexp">l1</span> <span class="staexp">!=</span> <span class="staexp">l2</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> != <span class="keyword">with</span> neq_ptr1_ptr1 <span class="keyword">of</span> 20</span>
<span class="dynexp"><span class="keyword">overload</span> &lt;&gt; <span class="keyword">with</span> neq_ptr1_ptr1 <span class="keyword">of</span> 20</span>

<span class="dynexp"><span class="keyword">fun</span> compare_ptr1_ptr1
  <span class="staexp"><span class="keyword">{</span>l1<span class="keyword">,</span>l2<span class="keyword">:</span>addr<span class="keyword">}</span></span> <span class="keyword">(</span>p1<span class="keyword">:</span> <span class="staexp">ptr</span> <span class="staexp">l1</span><span class="keyword">,</span> p2<span class="keyword">:</span> <span class="staexp">ptr</span> <span class="staexp">l2</span><span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> compare <span class="keyword">with</span> compare_ptr1_ptr1 <span class="keyword">of</span> 20</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
gt_ptr1_intz<span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span>
  <span class="keyword">(</span>p<span class="keyword">:</span> <span class="staexp">ptr</span><span class="keyword">(</span><span class="staexp">l</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span><span class="keyword">(</span><span class="staexp">l</span> <span class="staexp"><span class="keyword">&gt;</span></span> <span class="staexp">null</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span>
eq_ptr1_intz<span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span>
  <span class="keyword">(</span>p<span class="keyword">:</span> <span class="staexp">ptr</span><span class="keyword">(</span><span class="staexp">l</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span><span class="keyword">(</span><span class="staexp">l</span><span class="staexp">==</span> <span class="staexp">null</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span>
neq_ptr1_intz<span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span>
  <span class="keyword">(</span>p<span class="keyword">:</span> <span class="staexp">ptr</span><span class="keyword">(</span><span class="staexp">l</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span><span class="keyword">(</span><span class="staexp">l</span> <span class="staexp"><span class="keyword">&gt;</span></span> <span class="staexp">null</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">&gt;</span> <span class="keyword">with</span> gt_ptr1_intz <span class="keyword">of</span> 10</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">=</span> <span class="keyword">with</span> eq_ptr1_intz <span class="keyword">of</span> 10</span>
<span class="dynexp"><span class="keyword">overload</span> != <span class="keyword">with</span> neq_ptr1_intz <span class="keyword">of</span> 10</span>
<span class="dynexp"><span class="keyword">overload</span> &lt;&gt; <span class="keyword">with</span> neq_ptr1_intz <span class="keyword">of</span> 10</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">// HX: implemented in [prelude/DATS/pointer.dats]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
ptr_get<span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span>
  <span class="keyword">(</span><span class="prfexp">pf<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span> <span class="staexp"><span class="keyword">@</span></span> <span class="staexp">l</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">a</span><span class="staexp">?!</span> <span class="staexp"><span class="keyword">@</span></span> <span class="staexp">l</span></span> <span class="keyword">|</span> p<span class="keyword">:</span> <span class="staexp">ptr</span> <span class="staexp">l</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">a</span></span>
<span class="comment">// end of [ptr_get]</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
ptr_set<span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span>
  <span class="keyword">(</span><span class="prfexp">pf<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">a</span><span class="staexp">?</span> <span class="staexp"><span class="keyword">@</span></span> <span class="staexp">l</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">a</span> <span class="staexp"><span class="keyword">@</span></span> <span class="staexp">l</span></span> <span class="keyword">|</span> p<span class="keyword">:</span> <span class="staexp">ptr</span> <span class="staexp">l</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span>
<span class="comment">// end of [ptr_set]</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
ptr_exch<span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span>
  <span class="keyword">(</span><span class="prfexp">pf<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span> <span class="staexp"><span class="keyword">@</span></span> <span class="staexp">l</span></span> <span class="keyword">|</span> p<span class="keyword">:</span> <span class="staexp">ptr</span> <span class="staexp">l</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">a</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span>
<span class="comment">// end of [ptr_exch]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">abstype</span>
cptr_vt0ype_addr_type
  <span class="keyword">(</span>a<span class="keyword">:</span><span class="keyword">vt@ype+</span><span class="keyword">,</span> addr<span class="keyword">)</span> <span class="keyword">=</span> ptr</span> <span class="comment">// HX: for simulating C pointers</span>
<span class="comment">//</span>
<span class="keyword">stadef</span> <span class="staexp">cptr <span class="keyword">=</span> <span class="staexp">cptr_vt0ype_addr_type</span></span>
<span class="keyword">stadef</span> <span class="staexp">cPtr0 <span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span>vt0p</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>l<span class="keyword">:</span>addr<span class="keyword">]</span></span> <span class="staexp">cptr</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">)</span></span>
<span class="keyword">stadef</span> <span class="staexp">cPtr1 <span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span>vt0p</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>l<span class="keyword">:</span>addr <span class="keyword">|</span> l <span class="keyword">&gt;</span> null<span class="keyword">]</span></span> <span class="staexp">cptr</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">castfn</span>
cptr2ptr<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span> <span class="keyword">(</span>cp<span class="keyword">:</span> <span class="staexp">cptr</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">ptr</span><span class="keyword">(</span><span class="staexp">l</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> cptr_null<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">cptr</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">null</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">castfn</span> cptr_rvar<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span> <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">cPtr1</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span> <span class="comment">// read</span>
<span class="dynexp"><span class="keyword">castfn</span> cptr_wvar<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span> <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">a</span><span class="staexp">?</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">cPtr1</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span> <span class="comment">// write</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
cptr_succ<span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span><span class="keyword">(</span>cp<span class="keyword">:</span> <span class="staexp">cptr</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">cptr</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">l</span><span class="staexp">+</span><span class="staexp">sizeof</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
cptr_pred<span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span><span class="keyword">(</span>cp<span class="keyword">:</span> <span class="staexp">cptr</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">cptr</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">l</span><span class="staexp">-</span><span class="staexp">sizeof</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
cptr_is_null
  <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span><span class="keyword">(</span>cp<span class="keyword">:</span> <span class="staexp">cptr</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span><span class="keyword">(</span><span class="staexp">l</span><span class="staexp">==</span><span class="staexp">null</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span>
cptr_isnot_null
  <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span><span class="keyword">(</span>cp<span class="keyword">:</span> <span class="staexp">cptr</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span><span class="keyword">(</span><span class="staexp">l</span> <span class="staexp"><span class="keyword">&gt;</span></span> <span class="staexp">null</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
gt_cptr_intz
  <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span>
  <span class="keyword">(</span>cp<span class="keyword">:</span> <span class="staexp">cptr</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span><span class="keyword">(</span><span class="staexp">l</span> <span class="staexp"><span class="keyword">&gt;</span></span> <span class="staexp">null</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
eq_cptr_intz
  <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span>
  <span class="keyword">(</span>cp<span class="keyword">:</span> <span class="staexp">cptr</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span><span class="keyword">(</span><span class="staexp">l</span><span class="staexp">==</span> <span class="staexp">null</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span>
neq_cptr_intz
  <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span>
  <span class="keyword">(</span>cp<span class="keyword">:</span> <span class="staexp">cptr</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span><span class="keyword">(</span><span class="staexp">l</span> <span class="staexp"><span class="keyword">&gt;</span></span> <span class="staexp">null</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">&gt;</span> <span class="keyword">with</span> gt_cptr_intz <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">=</span> <span class="keyword">with</span> eq_cptr_intz <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> != <span class="keyword">with</span> neq_cptr_intz <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> &lt;&gt; <span class="keyword">with</span> neq_cptr_intz <span class="keyword">of</span> 0</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">typedef</span> <span class="staexp">voidptr <span class="keyword">(</span><span class="staexp">l<span class="keyword">:</span>addr</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">cptr</span> <span class="keyword">(</span><span class="staexp">void</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span> <span class="staexp">voidptr0 <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>l<span class="keyword">:</span>addr<span class="keyword">]</span></span> <span class="staexp">voidptr</span> <span class="keyword">(</span><span class="staexp">l</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span> <span class="staexp">voidptr1 <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>l<span class="keyword">:</span>addr <span class="keyword">|</span> l <span class="keyword">&gt;</span> null<span class="keyword">]</span></span> <span class="staexp">voidptr</span> <span class="keyword">(</span><span class="staexp">l</span><span class="keyword">)</span></span>

<span class="keyword">typedef</span> <span class="staexp">charptr <span class="keyword">(</span><span class="staexp">l<span class="keyword">:</span>addr</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">cptr</span> <span class="keyword">(</span><span class="staexp">char</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span> <span class="staexp">charptr0 <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>l<span class="keyword">:</span>addr<span class="keyword">]</span></span> <span class="staexp">charptr</span> <span class="keyword">(</span><span class="staexp">l</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span> <span class="staexp">charptr1 <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>l<span class="keyword">:</span>addr <span class="keyword">|</span> l <span class="keyword">&gt;</span> null<span class="keyword">]</span></span> <span class="staexp">charptr</span> <span class="keyword">(</span><span class="staexp">l</span><span class="keyword">)</span></span>

<span class="keyword">typedef</span> <span class="staexp">constcharptr <span class="keyword">(</span><span class="staexp">l<span class="keyword">:</span>addr</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">charptr</span> <span class="keyword">(</span><span class="staexp">l</span><span class="keyword">)</span></span> <span class="comment">// HX: commenting</span>
<span class="keyword">typedef</span> <span class="staexp">constcharptr0 <span class="keyword">=</span> <span class="staexp">charptr0</span></span> <span class="comment">// HX: for commenting purpose</span>
<span class="keyword">typedef</span> <span class="staexp">constcharptr1 <span class="keyword">=</span> <span class="staexp">charptr1</span></span> <span class="comment">// HX: for commenting purpose</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">absprop</span>
is_nullable <span class="keyword">(</span>a<span class="keyword">:</span> <span class="keyword">vt@ype+</span><span class="keyword">)</span></span> <span class="comment">// covariant</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
ptr_nullize
  <span class="keyword">(</span><span class="prfexp">pf<span class="keyword">:</span> <span class="staexp">is_nullable</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span> <span class="keyword">|</span> x<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">a</span><span class="staexp">?</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span>
<span class="dynexp"><span class="keyword">fun</span>
ptr_nullize_tsz
  <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span> <span class="keyword">(</span>
  <span class="prfexp">pf<span class="keyword">:</span> <span class="staexp">is_nullable</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span> <span class="keyword">|</span> x<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">a</span><span class="staexp">?</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">a</span><span class="keyword">,</span> tsz<span class="keyword">:</span> <span class="staexp">sizeof_t</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span> <span class="keyword">=</span> "mac#%"</span> <span class="comment">// end of [ptr_nullize_tsz]</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> ptr_alloc <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp"><span class="keyword">[</span>l<span class="keyword">:</span>agz<span class="keyword">]</span></span> <span class="keyword">(</span><span class="staexp">a</span><span class="staexp">?</span> <span class="staexp"><span class="keyword">@</span></span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">mfree_gc_v</span> <span class="keyword">(</span><span class="staexp">l</span><span class="keyword">)</span> <span class="keyword">|</span> <span class="staexp">ptr</span> <span class="staexp">l</span><span class="keyword">)</span></span>
<span class="comment">// end of [ptr_alloc]</span>

<span class="dynexp"><span class="keyword">fun</span> ptr_alloc_tsz
  <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span> <span class="keyword">(</span>tsz<span class="keyword">:</span> <span class="staexp">sizeof_t</span> <span class="staexp">a</span><span class="keyword">)</span>
  <span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp"><span class="keyword">[</span>l<span class="keyword">:</span>agz<span class="keyword">]</span></span> <span class="keyword">(</span><span class="staexp">a</span><span class="staexp">?</span> <span class="staexp"><span class="keyword">@</span></span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">mfree_gc_v</span> <span class="keyword">(</span><span class="staexp">l</span><span class="keyword">)</span> <span class="keyword">|</span> <span class="staexp">ptr</span> <span class="staexp">l</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">// end of [ptr_alloc_tsz]</span>

<span class="dynexp"><span class="keyword">fun</span> ptr_free
  <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span><span class="keyword">t@ype</span><span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span>
  <span class="keyword">(</span><span class="prfexp">pfgc<span class="keyword">:</span> <span class="staexp">mfree_gc_v</span> <span class="keyword">(</span><span class="staexp">l</span><span class="keyword">)</span></span><span class="keyword">,</span> <span class="prfexp">pfat<span class="keyword">:</span> <span class="staexp">a</span> <span class="staexp"><span class="keyword">@</span></span> <span class="staexp">l</span></span> <span class="keyword">|</span> p<span class="keyword">:</span> <span class="staexp">ptr</span> <span class="staexp">l</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">void</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">// end of [ptr_free]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">absvtype</span> ptrlin <span class="keyword">(</span>l<span class="keyword">:</span>addr<span class="keyword">)</span> <span class="keyword">=</span> ptr</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">praxi</span> ptrlin_free<span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span> <span class="keyword">(</span>p<span class="keyword">:</span> <span class="staexp">ptrlin</span> <span class="keyword">(</span><span class="staexp">l</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">castfn</span> ptr2ptrlin<span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span> <span class="keyword">(</span>p<span class="keyword">:</span> <span class="staexp">ptr</span> <span class="staexp">l</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">ptrlin</span> <span class="keyword">(</span><span class="staexp">l</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">castfn</span> ptrlin2ptr<span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span> <span class="keyword">(</span>p<span class="keyword">:</span> <span class="staexp">ptrlin</span> <span class="staexp">l</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">ptr</span> <span class="keyword">(</span><span class="staexp">l</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">// HX-2015-03-24:</span>
<span class="comment">// singleton linear arrayptr</span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">absvtype</span>
aptr_vt0ype_addr_type
  <span class="keyword">(</span>a<span class="keyword">:</span><span class="keyword">vt@ype+</span><span class="keyword">,</span> addr<span class="keyword">)</span> <span class="keyword">=</span> ptr</span> <span class="comment">// HX: for safe ATS pointers</span>
<span class="comment">//</span>
<span class="keyword">stadef</span> <span class="staexp">aptr <span class="keyword">=</span> <span class="staexp">aptr_vt0ype_addr_type</span></span>
<span class="keyword">stadef</span> <span class="staexp">aPtr0 <span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span>vt0p</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>l<span class="keyword">:</span>addr<span class="keyword">]</span></span> <span class="staexp">aptr</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">)</span></span>
<span class="keyword">stadef</span> <span class="staexp">aPtr1 <span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span>vt0p</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>l<span class="keyword">:</span>addr <span class="keyword">|</span> l <span class="keyword">&gt;</span> null<span class="keyword">]</span></span> <span class="staexp">aptr</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">castfn</span>
aptr2ptr<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span><span class="keyword">(</span>ap<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">aptr</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">ptr</span><span class="keyword">(</span><span class="staexp">l</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
aptr_make_elt<span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">aPtr1</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
aptr_getfree_elt<span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>agz<span class="keyword">}</span></span><span class="keyword">(</span><span class="staexp">aptr</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
aptr_get_elt<span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>agz<span class="keyword">}</span></span><span class="keyword">(</span>ap<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">aptr</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
aptr_set_elt
  <span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>agz<span class="keyword">}</span></span><span class="keyword">(</span>ap<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">aptr</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
aptr_exch_elt
  <span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>agz<span class="keyword">}</span></span><span class="keyword">(</span>ap<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">aptr</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="staexp">&gt;&gt;</span><span class="staexp">_</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">[</span><span class="keyword">]</span> <span class="keyword">with</span> aptr_get_elt</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">[</span><span class="keyword">]</span> <span class="keyword">with</span> aptr_set_elt</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> aptr_null<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="keyword">(</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">aptr</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">null</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> aptr_is_null
  <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span><span class="keyword">(</span>ap<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">aptr</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span><span class="keyword">(</span><span class="staexp">l</span><span class="staexp">==</span><span class="staexp">null</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> aptr_isnot_null
  <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span><span class="keyword">(</span>ap<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">aptr</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span><span class="keyword">(</span><span class="staexp">l</span> <span class="staexp"><span class="keyword">&gt;</span></span> <span class="staexp">null</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> iseqz <span class="keyword">with</span> aptr_is_null</span>
<span class="dynexp"><span class="keyword">overload</span> isneqz <span class="keyword">with</span> aptr_isnot_null</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">// HX-2014-05-16:</span>
<span class="comment">// A hack to stop buggy compilation</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> ptr_as_volatile <span class="keyword">(</span>p<span class="keyword">:</span> <span class="staexp">ptr</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">// overloading for certain symbols</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> succ <span class="keyword">with</span> ptr0_succ</span>
<span class="dynexp"><span class="keyword">overload</span> succ <span class="keyword">with</span> ptr1_succ</span>
<span class="dynexp"><span class="keyword">overload</span> succ <span class="keyword">with</span> cptr_succ</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> pred <span class="keyword">with</span> ptr0_pred</span>
<span class="dynexp"><span class="keyword">overload</span> pred <span class="keyword">with</span> ptr1_pred</span>
<span class="dynexp"><span class="keyword">overload</span> pred <span class="keyword">with</span> cptr_pred</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> iseqz <span class="keyword">with</span> ptr0_is_null <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> isneqz <span class="keyword">with</span> ptr0_isnot_null <span class="keyword">of</span> 0</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> iseqz <span class="keyword">with</span> ptr1_is_null <span class="keyword">of</span> 10</span>
<span class="dynexp"><span class="keyword">overload</span> isneqz <span class="keyword">with</span> ptr1_isnot_null <span class="keyword">of</span> 10</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> iseqz <span class="keyword">with</span> cptr_is_null <span class="keyword">of</span> 10</span>
<span class="dynexp"><span class="keyword">overload</span> isneqz <span class="keyword">with</span> cptr_isnot_null <span class="keyword">of</span> 10</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* end of [pointer.sats] *)</span>
</pre>
<pre class="patsyntax">
<span class="comment">(***********************************************************************)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(*                         Applied Type System                         *)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(***********************************************************************)</span>

<span class="comment">(*
** ATS/Postiats - Unleashing the Potential of Types!
** Copyright (C) 2010-2015 Hongwei Xi, ATS Trustful Software, Inc.
** All rights reserved
**
** ATS is free software;  you can  redistribute it and/or modify it under
** the terms of  the GNU GENERAL PUBLIC LICENSE (GPL) as published by the
** Free Software Foundation; either version 3, or (at  your  option)  any
** later version.
**
** ATS is distributed in the hope that it will be useful, but WITHOUT ANY
** WARRANTY; without  even  the  implied  warranty  of MERCHANTABILITY or
** FITNESS FOR A PARTICULAR PURPOSE.  See the  GNU General Public License
** for more details.
**
** You  should  have  received  a  copy of the GNU General Public License
** along  with  ATS;  see the  file COPYING.  If not, please write to the
** Free Software Foundation,  51 Franklin Street, Fifth Floor, Boston, MA
** 02110-1301, USA.
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
** Source:
** $PATSHOME/prelude/SATS/CODEGEN/memory.atxt
** Time of generation: Mon Sep  5 21:48:33 2016
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">typedef</span> <span class="staexp">bytes <span class="keyword">(</span><span class="staexp">n<span class="keyword">:</span>int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">@[</span><span class="staexp">byte</span><span class="keyword">]</span><span class="keyword">[</span><span class="staexp">n</span><span class="keyword">]</span></span>
<span class="keyword">typedef</span> <span class="staexp">b0ytes <span class="keyword">(</span><span class="staexp">n<span class="keyword">:</span>int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">@[</span><span class="staexp">byte</span><span class="staexp">?</span><span class="keyword">]</span><span class="keyword">[</span><span class="staexp">n</span><span class="keyword">]</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">viewdef</span> <span class="staexp">bytes_v <span class="keyword">(</span><span class="staexp">l<span class="keyword">:</span>addr</span><span class="keyword">,</span> <span class="staexp">n<span class="keyword">:</span>int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">bytes</span> <span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span> <span class="staexp"><span class="keyword">@</span></span> <span class="staexp">l</span></span>
<span class="keyword">viewdef</span> <span class="staexp">b0ytes_v <span class="keyword">(</span><span class="staexp">l<span class="keyword">:</span>addr</span><span class="keyword">,</span> <span class="staexp">n<span class="keyword">:</span>int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">b0ytes</span> <span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span> <span class="staexp"><span class="keyword">@</span></span> <span class="staexp">l</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="prfexp"><span class="keyword">praxi</span>
b0ytes2bytes
  <span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span> <span class="keyword">(</span><span class="staexp">&amp;</span><span class="staexp">b0ytes</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">bytes</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="comment">// end of [b0ytes2bytes]</span>
<span class="prfexp"><span class="keyword">praxi</span>
b0ytes2bytes_v
  <span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span> <span class="keyword">(</span>pf<span class="keyword">:</span> <span class="staexp">b0ytes_v</span> <span class="keyword">(</span><span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">bytes_v</span> <span class="keyword">(</span><span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="comment">// end of [b0ytes2bytes_v]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="prfexp"><span class="keyword">prfun</span>
bytes_v_split
  <span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span>
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>i<span class="keyword">:</span>nat <span class="keyword">|</span> i &lt;= n<span class="keyword">}</span></span>
  <span class="keyword">(</span>pf<span class="keyword">:</span> <span class="staexp">bytes_v</span> <span class="keyword">(</span><span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">bytes_v</span> <span class="keyword">(</span><span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">bytes_v</span> <span class="keyword">(</span><span class="staexp">l</span><span class="staexp">+</span><span class="staexp">i</span><span class="keyword">,</span> <span class="staexp">n</span><span class="staexp">-</span><span class="staexp">i</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">// end of [bytes_v_split]</span>

<span class="prfexp"><span class="keyword">prfun</span>
bytes_v_split_at
  <span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span>
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>i<span class="keyword">:</span>nat <span class="keyword">|</span> i &lt;= n<span class="keyword">}</span></span>
  <span class="keyword">(</span><span class="prfexp">pf<span class="keyword">:</span> <span class="staexp">bytes_v</span> <span class="keyword">(</span><span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span> <span class="keyword">|</span> i<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="keyword">(</span><span class="staexp">i</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">bytes_v</span> <span class="keyword">(</span><span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">bytes_v</span> <span class="keyword">(</span><span class="staexp">l</span><span class="staexp">+</span><span class="staexp">i</span><span class="keyword">,</span> <span class="staexp">n</span><span class="staexp">-</span><span class="staexp">i</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">// end of [bytes_v_split_at]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="prfexp"><span class="keyword">prfun</span>
bytes_v_unsplit
  <span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>n1<span class="keyword">,</span>n2<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>pf1<span class="keyword">:</span> <span class="staexp">bytes_v</span> <span class="keyword">(</span><span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">n1</span><span class="keyword">)</span><span class="keyword">,</span> pf2<span class="keyword">:</span> <span class="staexp">bytes_v</span> <span class="keyword">(</span><span class="staexp">l</span><span class="staexp">+</span><span class="staexp">n1</span><span class="keyword">,</span> <span class="staexp">n2</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">bytes_v</span> <span class="keyword">(</span><span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">n1</span><span class="staexp">+</span><span class="staexp">n2</span><span class="keyword">)</span></span>
<span class="comment">// end of [bytes_v_unsplit]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">// HX-2013-08:</span>
<span class="comment">// for memory initialization</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> minit_gc <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span>
mfree_gc
  <span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  <span class="prfexp">pfat<span class="keyword">:</span> <span class="staexp">b0ytes</span> <span class="staexp">n</span> <span class="staexp"><span class="keyword">@</span></span> <span class="staexp">l</span></span>
<span class="keyword">,</span> <span class="prfexp">pfgc<span class="keyword">:</span> <span class="staexp">mfree_gc_v</span> <span class="keyword">(</span><span class="staexp">l</span><span class="keyword">)</span></span> <span class="keyword">|</span> <span class="staexp">ptr</span> <span class="staexp">l</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span> <span class="keyword">=</span> "mac#%"</span>

<span class="dynexp"><span class="keyword">fun</span>
malloc_gc
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  bsz<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span>
  <span class="staexp"><span class="keyword">[</span>l<span class="keyword">:</span>agz<span class="keyword">]</span></span>
<span class="keyword">(</span>
  <span class="staexp">b0ytes</span> <span class="staexp">n</span> <span class="staexp"><span class="keyword">@</span></span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">mfree_gc_v</span> <span class="keyword">(</span><span class="staexp">l</span><span class="keyword">)</span> <span class="keyword">|</span> <span class="staexp">ptr</span> <span class="staexp">l</span>
<span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span> <span class="comment">// endfun</span>

<span class="comment">(* ****** ****** *)</span>

<span class="staexp"><span class="keyword">absview</span> memory$free_v <span class="keyword">(</span>l<span class="keyword">:</span>addr<span class="keyword">)</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
<span class="keyword">}</span></span> memory$free
  <span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  <span class="prfexp">pfat<span class="keyword">:</span> <span class="staexp">b0ytes</span> <span class="staexp">n</span> <span class="staexp"><span class="keyword">@</span></span> <span class="staexp">l</span></span>
<span class="keyword">,</span> <span class="prfexp">pfmf<span class="keyword">:</span> <span class="staexp">memory$free_v</span> <span class="keyword">(</span><span class="staexp">l</span><span class="keyword">)</span></span> <span class="keyword">|</span> <span class="staexp">ptr</span> <span class="staexp">l</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span> <span class="comment">// end-of-fun</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
<span class="keyword">}</span></span> memory$alloc
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  bsz<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span>
  <span class="staexp"><span class="keyword">[</span>l<span class="keyword">:</span>agz<span class="keyword">]</span></span>
<span class="keyword">(</span>
  <span class="staexp">b0ytes</span> <span class="staexp">n</span> <span class="staexp"><span class="keyword">@</span></span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">memory$free_v</span> <span class="keyword">(</span><span class="staexp">l</span><span class="keyword">)</span> <span class="keyword">|</span> <span class="staexp">ptr</span> <span class="staexp">l</span>
<span class="keyword">)</span></span> <span class="comment">(* end of [memory$alloc] *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* end of [memory.sats] *)</span>
</pre>
<pre class="patsyntax">
<span class="comment">(***********************************************************************)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(*                         Applied Type System                         *)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(***********************************************************************)</span>

<span class="comment">(*
** ATS/Postiats - Unleashing the Potential of Types!
** Copyright (C) 2010-2015 Hongwei Xi, ATS Trustful Software, Inc.
** All rights reserved
**
** ATS is free software;  you can  redistribute it and/or modify it under
** the terms of  the GNU GENERAL PUBLIC LICENSE (GPL) as published by the
** Free Software Foundation; either version 3, or (at  your  option)  any
** later version.
**
** ATS is distributed in the hope that it will be useful, but WITHOUT ANY
** WARRANTY; without  even  the  implied  warranty  of MERCHANTABILITY or
** FITNESS FOR A PARTICULAR PURPOSE.  See the  GNU General Public License
** for more details.
**
** You  should  have  received  a  copy of the GNU General Public License
** along  with  ATS;  see the  file COPYING.  If not, please write to the
** Free Software Foundation,  51 Franklin Street, Fifth Floor, Boston, MA
** 02110-1301, USA.
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
** Source:
** $PATSHOME/prelude/SATS/CODEGEN/bool.atxt
** Time of generation: Mon Sep  5 21:48:31 2016
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* Author: Hongwei Xi *)</span>
<span class="comment">(* Authoremail: hwxi AT cs DOT bu DOT edu *)</span>
<span class="comment">(* Start time: September, 2011 *)</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">castfn</span> g0ofg1_bool <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">Bool</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span></span>
<span class="dynexp"><span class="keyword">castfn</span> g1ofg0_bool <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">bool</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">Bool</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> g0ofg1 <span class="keyword">with</span> g0ofg1_bool</span> <span class="comment">// index-erasing</span>
<span class="dynexp"><span class="keyword">overload</span> g1ofg0 <span class="keyword">with</span> g1ofg0_bool</span> <span class="comment">// index-inducing</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="neuexp"><span class="keyword">symintr</span> int2bool</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> int2bool0 <span class="keyword">(</span>i<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> int2bool1
  <span class="staexp"><span class="keyword">{</span>i<span class="keyword">:</span>int<span class="keyword">}</span></span> <span class="keyword">(</span>i<span class="keyword">:</span> <span class="staexp">int</span> <span class="staexp">i</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">(</span><span class="staexp">i</span> <span class="staexp">!=</span> <span class="staexp">0</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> int2bool <span class="keyword">with</span> int2bool0 <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> int2bool <span class="keyword">with</span> int2bool1 <span class="keyword">of</span> 10</span>
<span class="comment">//</span>
<span class="neuexp"><span class="keyword">symintr</span> bool2int</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> bool2int0 <span class="keyword">(</span>b<span class="keyword">:</span> <span class="staexp">bool</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">natLt</span><span class="keyword">(</span><span class="staexp">2</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> bool2int1
  <span class="staexp"><span class="keyword">{</span>b<span class="keyword">:</span>bool<span class="keyword">}</span></span> <span class="keyword">(</span>b<span class="keyword">:</span> <span class="staexp">bool</span> <span class="staexp">b</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int</span> <span class="keyword">(</span><span class="staexp">bool2int</span><span class="keyword">(</span><span class="staexp">b</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> bool2int <span class="keyword">with</span> bool2int0 <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> bool2int <span class="keyword">with</span> bool2int1 <span class="keyword">of</span> 10</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
//
// HX: declared in [prelude/basics_dyn.sats]
//
val true : bool (true) and false : bool (false)
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
** HX-2012-06:
** shortcut version of disjuction and conjuction
** note that these two cannot be declared as functions
*)</span>
<span class="dynexp"><span class="keyword">macdef</span> || <span class="dynexp"><span class="keyword">(</span>b1<span class="keyword">,</span> b2<span class="keyword">)</span></span> <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">if</span> <span class="dynexp"><span class="keyword">,(</span>b1<span class="keyword">)</span></span> <span class="keyword">then</span> true <span class="keyword">else</span> <span class="dynexp"><span class="keyword">,(</span>b2<span class="keyword">)</span></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">bool</span></span>
<span class="dynexp"><span class="keyword">macdef</span> &amp;&amp; <span class="dynexp"><span class="keyword">(</span>b1<span class="keyword">,</span> b2<span class="keyword">)</span></span> <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">if</span> <span class="dynexp"><span class="keyword">,(</span>b1<span class="keyword">)</span></span> <span class="keyword">then</span> <span class="dynexp"><span class="keyword">,(</span>b2<span class="keyword">)</span></span> <span class="keyword">else</span> false<span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">bool</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">typedef</span> <span class="staexp">boolLte <span class="keyword">(</span><span class="staexp">b<span class="keyword">:</span> bool</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>a<span class="keyword">:</span> bool <span class="keyword">|</span> a &lt;= b<span class="keyword">]</span></span> <span class="staexp">bool</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span> <span class="staexp">boolGte <span class="keyword">(</span><span class="staexp">b<span class="keyword">:</span> bool</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>a<span class="keyword">:</span> bool <span class="keyword">|</span> a &gt;= b<span class="keyword">]</span></span> <span class="staexp">bool</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
neg_bool0
  <span class="keyword">(</span>b<span class="keyword">:</span> <span class="staexp">bool</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">~</span> <span class="keyword">with</span> neg_bool0 <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> not <span class="keyword">with</span> neg_bool0 <span class="keyword">of</span> 0</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
add_bool0_bool0
  <span class="keyword">(</span>b1<span class="keyword">:</span> <span class="staexp">bool</span><span class="keyword">,</span> b2<span class="keyword">:</span> <span class="staexp">bool</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span>
mul_bool0_bool0
  <span class="keyword">(</span>b1<span class="keyword">:</span> <span class="staexp">bool</span><span class="keyword">,</span> b2<span class="keyword">:</span> <span class="staexp">bool</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> + <span class="keyword">with</span> add_bool0_bool0 <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> * <span class="keyword">with</span> mul_bool0_bool0 <span class="keyword">of</span> 0</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
xor_bool0_bool0
  <span class="keyword">(</span>b1<span class="keyword">:</span> <span class="staexp">bool</span><span class="keyword">,</span> b2<span class="keyword">:</span> <span class="staexp">bool</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> xor <span class="keyword">with</span> xor_bool0_bool0 <span class="keyword">of</span> 0</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span>
lt_bool0_bool0
  <span class="keyword">(</span>b1<span class="keyword">:</span> <span class="staexp">bool</span><span class="keyword">,</span> b2<span class="keyword">:</span> <span class="staexp">bool</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">&lt;</span> <span class="keyword">with</span> lt_bool0_bool0 <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">fun</span>
lte_bool0_bool0
  <span class="keyword">(</span>b1<span class="keyword">:</span> <span class="staexp">bool</span><span class="keyword">,</span> b2<span class="keyword">:</span> <span class="staexp">bool</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> &lt;= <span class="keyword">with</span> lte_bool0_bool0 <span class="keyword">of</span> 0</span>

<span class="dynexp"><span class="keyword">fun</span>
gt_bool0_bool0
  <span class="keyword">(</span>b1<span class="keyword">:</span> <span class="staexp">bool</span><span class="keyword">,</span> b2<span class="keyword">:</span> <span class="staexp">bool</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">&gt;</span> <span class="keyword">with</span> gt_bool0_bool0 <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">fun</span>
gte_bool0_bool0
  <span class="keyword">(</span>b1<span class="keyword">:</span> <span class="staexp">bool</span><span class="keyword">,</span> b2<span class="keyword">:</span> <span class="staexp">bool</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> &gt;= <span class="keyword">with</span> gte_bool0_bool0 <span class="keyword">of</span> 0</span>

<span class="dynexp"><span class="keyword">fun</span>
eq_bool0_bool0
  <span class="keyword">(</span>b1<span class="keyword">:</span> <span class="staexp">bool</span><span class="keyword">,</span> b2<span class="keyword">:</span> <span class="staexp">bool</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">=</span> <span class="keyword">with</span> eq_bool0_bool0 <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">fun</span>
neq_bool0_bool0
  <span class="keyword">(</span>b1<span class="keyword">:</span> <span class="staexp">bool</span><span class="keyword">,</span> b2<span class="keyword">:</span> <span class="staexp">bool</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> != <span class="keyword">with</span> neq_bool0_bool0 <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> &lt;&gt; <span class="keyword">with</span> neq_bool0_bool0 <span class="keyword">of</span> 0</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span> compare_bool0_bool0
  <span class="keyword">(</span>b1<span class="keyword">:</span> <span class="staexp">bool</span><span class="keyword">,</span> b2<span class="keyword">:</span> <span class="staexp">bool</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">Sgn</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> compare <span class="keyword">with</span> compare_bool0_bool0</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">// HX:</span>
<span class="comment">// return is statically allocated</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
bool2string<span class="keyword">(</span>b<span class="keyword">:</span> <span class="staexp">bool</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">string</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> print_bool <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">bool</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> prerr_bool <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">bool</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> fprint_bool <span class="keyword">:</span> <span class="staexp">fprint_type</span> <span class="keyword">(</span><span class="staexp">bool</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> print <span class="keyword">with</span> print_bool</span>
<span class="dynexp"><span class="keyword">overload</span> prerr <span class="keyword">with</span> prerr_bool</span>
<span class="dynexp"><span class="keyword">overload</span> fprint <span class="keyword">with</span> fprint_bool</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
neg_bool1
  <span class="staexp"><span class="keyword">{</span>b<span class="keyword">:</span>bool<span class="keyword">}</span></span>
  <span class="keyword">(</span>b<span class="keyword">:</span> <span class="staexp">bool</span> <span class="staexp">b</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">(</span><span class="staexp"><span class="keyword">~</span></span><span class="staexp">b</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">~</span> <span class="keyword">with</span> neg_bool1 <span class="keyword">of</span> 10</span>
<span class="dynexp"><span class="keyword">overload</span> not <span class="keyword">with</span> neg_bool1 <span class="keyword">of</span> 10</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span>
add_bool0_bool1
  <span class="staexp"><span class="keyword">{</span>b2<span class="keyword">:</span>bool<span class="keyword">}</span></span>
<span class="keyword">(</span>
  b1<span class="keyword">:</span> <span class="staexp">bool</span><span class="keyword">,</span> b2<span class="keyword">:</span> <span class="staexp">bool</span> <span class="staexp">b2</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp"><span class="keyword">[</span>b1<span class="keyword">:</span>bool<span class="keyword">]</span></span> <span class="staexp">bool</span><span class="keyword">(</span><span class="staexp">b1</span> <span class="staexp">||</span> <span class="staexp">b2</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> + <span class="keyword">with</span> add_bool0_bool1 <span class="keyword">of</span> 10</span>

<span class="dynexp"><span class="keyword">fun</span>
add_bool1_bool0
  <span class="staexp"><span class="keyword">{</span>b1<span class="keyword">:</span>bool<span class="keyword">}</span></span>
<span class="keyword">(</span>
  b1<span class="keyword">:</span> <span class="staexp">bool</span> <span class="staexp">b1</span><span class="keyword">,</span> b2<span class="keyword">:</span> <span class="staexp">bool</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp"><span class="keyword">[</span>b2<span class="keyword">:</span>bool<span class="keyword">]</span></span> <span class="staexp">bool</span><span class="keyword">(</span><span class="staexp">b1</span> <span class="staexp">||</span> <span class="staexp">b2</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> + <span class="keyword">with</span> add_bool1_bool0 <span class="keyword">of</span> 10</span>

<span class="dynexp"><span class="keyword">fun</span>
add_bool1_bool1
  <span class="staexp"><span class="keyword">{</span>b1<span class="keyword">,</span>b2<span class="keyword">:</span>bool<span class="keyword">}</span></span>
  <span class="keyword">(</span>b1<span class="keyword">:</span> <span class="staexp">bool</span> <span class="staexp">b1</span><span class="keyword">,</span> b2<span class="keyword">:</span> <span class="staexp">bool</span> <span class="staexp">b2</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span><span class="keyword">(</span><span class="staexp">b1</span> <span class="staexp">||</span> <span class="staexp">b2</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> + <span class="keyword">with</span> add_bool1_bool1 <span class="keyword">of</span> 20</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span>
mul_bool0_bool1
  <span class="staexp"><span class="keyword">{</span>b2<span class="keyword">:</span>bool<span class="keyword">}</span></span>
<span class="keyword">(</span>
  b1<span class="keyword">:</span> <span class="staexp">bool</span><span class="keyword">,</span> b2<span class="keyword">:</span> <span class="staexp">bool</span> <span class="staexp">b2</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp"><span class="keyword">[</span>b1<span class="keyword">:</span>bool<span class="keyword">]</span></span> <span class="staexp">bool</span><span class="keyword">(</span><span class="staexp">b1</span> <span class="staexp">&amp;&amp;</span> <span class="staexp">b2</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> * <span class="keyword">with</span> mul_bool0_bool1 <span class="keyword">of</span> 10</span>

<span class="dynexp"><span class="keyword">fun</span>
mul_bool1_bool0
  <span class="staexp"><span class="keyword">{</span>b1<span class="keyword">:</span>bool<span class="keyword">}</span></span>
<span class="keyword">(</span>
  b1<span class="keyword">:</span> <span class="staexp">bool</span> <span class="staexp">b1</span><span class="keyword">,</span> b2<span class="keyword">:</span> <span class="staexp">bool</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp"><span class="keyword">[</span>b2<span class="keyword">:</span>bool<span class="keyword">]</span></span> <span class="staexp">bool</span><span class="keyword">(</span><span class="staexp">b1</span> <span class="staexp">&amp;&amp;</span> <span class="staexp">b2</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> * <span class="keyword">with</span> mul_bool1_bool0 <span class="keyword">of</span> 10</span>

<span class="dynexp"><span class="keyword">fun</span>
mul_bool1_bool1
  <span class="staexp"><span class="keyword">{</span>b1<span class="keyword">,</span>b2<span class="keyword">:</span>bool<span class="keyword">}</span></span>
  <span class="keyword">(</span>b1<span class="keyword">:</span> <span class="staexp">bool</span> <span class="staexp">b1</span><span class="keyword">,</span> b2<span class="keyword">:</span> <span class="staexp">bool</span> <span class="staexp">b2</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span><span class="keyword">(</span><span class="staexp">b1</span> <span class="staexp">&amp;&amp;</span> <span class="staexp">b2</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> * <span class="keyword">with</span> mul_bool1_bool1 <span class="keyword">of</span> 20</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
xor_bool1_bool1
  <span class="staexp"><span class="keyword">{</span>b1<span class="keyword">,</span>b2<span class="keyword">:</span>bool<span class="keyword">}</span></span>
  <span class="keyword">(</span>b1<span class="keyword">:</span> <span class="staexp">bool</span> <span class="staexp">b1</span><span class="keyword">,</span> b2<span class="keyword">:</span> <span class="staexp">bool</span> <span class="staexp">b2</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span><span class="keyword">(</span><span class="keyword">(</span><span class="staexp">b1</span><span class="keyword">)</span><span class="staexp">==</span><span class="keyword">(</span><span class="staexp"><span class="keyword">~</span></span><span class="staexp">b2</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> xor <span class="keyword">with</span> xor_bool1_bool1 <span class="keyword">of</span> 20</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="comment">//</span>
<span class="comment">// (b1 &lt; b2) == (~b1 &amp;&amp; b2)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
lt_bool1_bool1 <span class="staexp"><span class="keyword">{</span>b1<span class="keyword">,</span>b2<span class="keyword">:</span>bool<span class="keyword">}</span></span>
  <span class="keyword">(</span>b1<span class="keyword">:</span> <span class="staexp">bool</span> <span class="keyword">(</span><span class="staexp">b1</span><span class="keyword">)</span><span class="keyword">,</span> b2<span class="keyword">:</span> <span class="staexp">bool</span> <span class="keyword">(</span><span class="staexp">b2</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">(</span><span class="staexp">b1</span> <span class="staexp"><span class="keyword">&lt;</span></span> <span class="staexp">b2</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">&lt;</span> <span class="keyword">with</span> lt_bool1_bool1 <span class="keyword">of</span> 20</span>
<span class="comment">//</span>
<span class="comment">// (b1 &lt;= b2) == (~b1 || b2)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
lte_bool1_bool1 <span class="staexp"><span class="keyword">{</span>b1<span class="keyword">,</span>b2<span class="keyword">:</span>bool<span class="keyword">}</span></span>
  <span class="keyword">(</span>b1<span class="keyword">:</span> <span class="staexp">bool</span> <span class="keyword">(</span><span class="staexp">b1</span><span class="keyword">)</span><span class="keyword">,</span> b2<span class="keyword">:</span> <span class="staexp">bool</span> <span class="keyword">(</span><span class="staexp">b2</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">(</span><span class="staexp">b1</span> <span class="staexp">&lt;=</span> <span class="staexp">b2</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> &lt;= <span class="keyword">with</span> lte_bool1_bool1 <span class="keyword">of</span> 20</span>
<span class="comment">//</span>
<span class="comment">// (b1 &gt; b2) == (b1 &amp;&amp; ~b2)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
gt_bool1_bool1 <span class="staexp"><span class="keyword">{</span>b1<span class="keyword">,</span>b2<span class="keyword">:</span>bool<span class="keyword">}</span></span>
  <span class="keyword">(</span>b1<span class="keyword">:</span> <span class="staexp">bool</span> <span class="keyword">(</span><span class="staexp">b1</span><span class="keyword">)</span><span class="keyword">,</span> b2<span class="keyword">:</span> <span class="staexp">bool</span> <span class="keyword">(</span><span class="staexp">b2</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">(</span><span class="staexp">b1</span> <span class="staexp"><span class="keyword">&gt;</span></span> <span class="staexp">b2</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">&gt;</span> <span class="keyword">with</span> gt_bool1_bool1 <span class="keyword">of</span> 20</span>
<span class="comment">//</span>
<span class="comment">// (b1 &gt;= b2) == (b1 || ~b2)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
gte_bool1_bool1 <span class="staexp"><span class="keyword">{</span>b1<span class="keyword">,</span>b2<span class="keyword">:</span>bool<span class="keyword">}</span></span>
  <span class="keyword">(</span>b1<span class="keyword">:</span> <span class="staexp">bool</span> <span class="keyword">(</span><span class="staexp">b1</span><span class="keyword">)</span><span class="keyword">,</span> b2<span class="keyword">:</span> <span class="staexp">bool</span> <span class="keyword">(</span><span class="staexp">b2</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">(</span><span class="staexp">b1</span> <span class="staexp">&gt;=</span> <span class="staexp">b2</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> &gt;= <span class="keyword">with</span> gte_bool1_bool1 <span class="keyword">of</span> 20</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span>
eq_bool1_bool1 <span class="staexp"><span class="keyword">{</span>b1<span class="keyword">,</span>b2<span class="keyword">:</span>bool<span class="keyword">}</span></span>
  <span class="keyword">(</span>b1<span class="keyword">:</span> <span class="staexp">bool</span> <span class="keyword">(</span><span class="staexp">b1</span><span class="keyword">)</span><span class="keyword">,</span> b2<span class="keyword">:</span> <span class="staexp">bool</span> <span class="keyword">(</span><span class="staexp">b2</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">(</span><span class="staexp">b1</span> <span class="staexp">==</span> <span class="staexp">b2</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">=</span> <span class="keyword">with</span> eq_bool1_bool1 <span class="keyword">of</span> 20</span>
<span class="dynexp"><span class="keyword">fun</span>
neq_bool1_bool1 <span class="staexp"><span class="keyword">{</span>b1<span class="keyword">,</span>b2<span class="keyword">:</span>bool<span class="keyword">}</span></span>
  <span class="keyword">(</span>b1<span class="keyword">:</span> <span class="staexp">bool</span> <span class="keyword">(</span><span class="staexp">b1</span><span class="keyword">)</span><span class="keyword">,</span> b2<span class="keyword">:</span> <span class="staexp">bool</span> <span class="keyword">(</span><span class="staexp">b2</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">(</span><span class="staexp">b1</span> <span class="staexp">!=</span> <span class="staexp">b2</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> != <span class="keyword">with</span> neq_bool1_bool1 <span class="keyword">of</span> 20</span>
<span class="dynexp"><span class="keyword">overload</span> &lt;&gt; <span class="keyword">with</span> neq_bool1_bool1 <span class="keyword">of</span> 20</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span>
compare_bool1_bool1
  <span class="staexp"><span class="keyword">{</span>b1<span class="keyword">,</span>b2<span class="keyword">:</span>bool<span class="keyword">}</span></span> <span class="comment">// HX: this one is a function</span>
<span class="keyword">(</span>
 b1<span class="keyword">:</span> <span class="staexp">bool</span> <span class="staexp">b1</span><span class="keyword">,</span> b2<span class="keyword">:</span> <span class="staexp">bool</span> <span class="staexp">b2</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int</span> <span class="keyword">(</span><span class="staexp">bool2int</span><span class="keyword">(</span><span class="staexp">b1</span><span class="keyword">)</span> <span class="staexp">-</span> <span class="staexp">bool2int</span><span class="keyword">(</span><span class="staexp">b2</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> compare <span class="keyword">with</span> compare_bool1_bool1 <span class="keyword">of</span> 20</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* end of [bool.sats] *)</span>
</pre>
<pre class="patsyntax">
<span class="comment">(***********************************************************************)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(*                         Applied Type System                         *)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(***********************************************************************)</span>

<span class="comment">(*
** ATS/Postiats - Unleashing the Potential of Types!
** Copyright (C) 2010-2015 Hongwei Xi, ATS Trustful Software, Inc.
** All rights reserved
**
** ATS is free software;  you can  redistribute it and/or modify it under
** the terms of  the GNU GENERAL PUBLIC LICENSE (GPL) as published by the
** Free Software Foundation; either version 3, or (at  your  option)  any
** later version.
**
** ATS is distributed in the hope that it will be useful, but WITHOUT ANY
** WARRANTY; without  even  the  implied  warranty  of MERCHANTABILITY or
** FITNESS FOR A PARTICULAR PURPOSE.  See the  GNU General Public License
** for more details.
**
** You  should  have  received  a  copy of the GNU General Public License
** along  with  ATS;  see the  file COPYING.  If not, please write to the
** Free Software Foundation,  51 Franklin Street, Fifth Floor, Boston, MA
** 02110-1301, USA.
*)</span>
<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
** Source:
** $PATSHOME/prelude/SATS/CODEGEN/char.atxt
** Time of generation: Mon Sep  5 21:48:31 2016
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* Author: Hongwei Xi *)</span>
<span class="comment">(* Authoremail: hwxi AT cs DOT bu DOT edu *)</span>
<span class="comment">(* Start time: September, 2011 *)</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">praxi</span>
lemma_char_size
<span class="keyword">(</span>
<span class="comment">// argumentless</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp"><span class="keyword">[</span>sizeof<span class="keyword">(</span>char<span class="keyword">)</span>==sizeof<span class="keyword">(</span>byte<span class="keyword">)</span><span class="keyword">]</span></span> <span class="staexp">void</span></span>
<span class="prfexp"><span class="keyword">praxi</span>
lemma_schar_size
<span class="keyword">(</span>
<span class="comment">// argumentless</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp"><span class="keyword">[</span>sizeof<span class="keyword">(</span>schar<span class="keyword">)</span>==sizeof<span class="keyword">(</span>byte<span class="keyword">)</span><span class="keyword">]</span></span> <span class="staexp">void</span></span>
<span class="prfexp"><span class="keyword">praxi</span>
lemma_uchar_size
<span class="keyword">(</span>
<span class="comment">// argumentless</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp"><span class="keyword">[</span>sizeof<span class="keyword">(</span>uchar<span class="keyword">)</span>==sizeof<span class="keyword">(</span>byte<span class="keyword">)</span><span class="keyword">]</span></span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">castfn</span> char2schar0 <span class="keyword">(</span>c<span class="keyword">:</span> <span class="staexp">char</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">schar</span></span>
<span class="dynexp"><span class="keyword">castfn</span> schar2char0 <span class="keyword">(</span>c<span class="keyword">:</span> <span class="staexp">schar</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">char</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">castfn</span> char2uchar0 <span class="keyword">(</span>c<span class="keyword">:</span> <span class="staexp">char</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uchar</span></span>
<span class="dynexp"><span class="keyword">castfn</span> uchar2char0 <span class="keyword">(</span>c<span class="keyword">:</span> <span class="staexp">uchar</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">char</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> int2char0 <span class="keyword">(</span>i<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">char</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> int2schar0 <span class="keyword">(</span>i<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">schar</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> int2uchar0 <span class="keyword">(</span>i<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uchar</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> uint2uchar0 <span class="keyword">(</span>u<span class="keyword">:</span> <span class="staexp">uint</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uchar</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span> char2int0 <span class="keyword">(</span>c<span class="keyword">:</span> <span class="staexp">char</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> schar2int0 <span class="keyword">(</span>c<span class="keyword">:</span> <span class="staexp">schar</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> uchar2int0 <span class="keyword">(</span>c<span class="keyword">:</span> <span class="staexp">uchar</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int</span> <span class="keyword">=</span> "mac#%"</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span> char2uint0 <span class="keyword">(</span>c<span class="keyword">:</span> <span class="staexp">char</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uint</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> schar2uint0 <span class="keyword">(</span>c<span class="keyword">:</span> <span class="staexp">schar</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uint</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> uchar2uint0 <span class="keyword">(</span>c<span class="keyword">:</span> <span class="staexp">uchar</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uint</span> <span class="keyword">=</span> "mac#%"</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span> char2u2int0 <span class="keyword">(</span>c<span class="keyword">:</span> <span class="staexp">char</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> char2u2uint0 <span class="keyword">(</span>c<span class="keyword">:</span> <span class="staexp">char</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uint</span> <span class="keyword">=</span> "mac#%"</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> char0_iseqz <span class="keyword">(</span>c<span class="keyword">:</span> <span class="staexp">char</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> char0_isneqz <span class="keyword">(</span>c<span class="keyword">:</span> <span class="staexp">char</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> iseqz <span class="keyword">with</span> char0_iseqz <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> isneqz <span class="keyword">with</span> char0_isneqz <span class="keyword">of</span> 0</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> add_char0_int0
  <span class="keyword">(</span>c<span class="keyword">:</span> <span class="staexp">char</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">char</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> sub_char0_int0
  <span class="keyword">(</span>c<span class="keyword">:</span> <span class="staexp">char</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">char</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> sub_char0_char0
  <span class="keyword">(</span>c1<span class="keyword">:</span> <span class="staexp">char</span><span class="keyword">,</span> c2<span class="keyword">:</span> <span class="staexp">char</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> + <span class="keyword">with</span> add_char0_int0 <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> - <span class="keyword">with</span> sub_char0_int0 <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> - <span class="keyword">with</span> sub_char0_char0 <span class="keyword">of</span> 0</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span> lt_char0_char0
  <span class="keyword">(</span>c1<span class="keyword">:</span> <span class="staexp">char</span><span class="keyword">,</span> c2<span class="keyword">:</span> <span class="staexp">char</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">&lt;</span> <span class="keyword">with</span> lt_char0_char0 <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">fun</span> lte_char0_char0
  <span class="keyword">(</span>c1<span class="keyword">:</span> <span class="staexp">char</span><span class="keyword">,</span> c2<span class="keyword">:</span> <span class="staexp">char</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> &lt;= <span class="keyword">with</span> lte_char0_char0 <span class="keyword">of</span> 0</span>

<span class="dynexp"><span class="keyword">fun</span> gt_char0_char0
  <span class="keyword">(</span>c1<span class="keyword">:</span> <span class="staexp">char</span><span class="keyword">,</span> c2<span class="keyword">:</span> <span class="staexp">char</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">&gt;</span> <span class="keyword">with</span> gt_char0_char0 <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">fun</span> gte_char0_char0
  <span class="keyword">(</span>c1<span class="keyword">:</span> <span class="staexp">char</span><span class="keyword">,</span> c2<span class="keyword">:</span> <span class="staexp">char</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> &gt;= <span class="keyword">with</span> gte_char0_char0 <span class="keyword">of</span> 0</span>

<span class="dynexp"><span class="keyword">fun</span> eq_char0_char0
  <span class="keyword">(</span>c1<span class="keyword">:</span> <span class="staexp">char</span><span class="keyword">,</span> c2<span class="keyword">:</span> <span class="staexp">char</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">=</span> <span class="keyword">with</span> eq_char0_char0 <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">fun</span> neq_char0_char0
  <span class="keyword">(</span>c1<span class="keyword">:</span> <span class="staexp">char</span><span class="keyword">,</span> c2<span class="keyword">:</span> <span class="staexp">char</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> != <span class="keyword">with</span> neq_char0_char0 <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> &lt;&gt; <span class="keyword">with</span> neq_char0_char0 <span class="keyword">of</span> 0</span>

<span class="dynexp"><span class="keyword">fun</span> compare_char0_char0
  <span class="keyword">(</span>c1<span class="keyword">:</span> <span class="staexp">char</span><span class="keyword">,</span> c2<span class="keyword">:</span> <span class="staexp">char</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> compare <span class="keyword">with</span> compare_char0_char0 <span class="keyword">of</span> 0</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">castfn</span> g0ofg1_char <span class="keyword">(</span>c<span class="keyword">:</span> <span class="staexp">Char</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">char</span></span>
<span class="dynexp"><span class="keyword">castfn</span> g1ofg0_char <span class="keyword">(</span>c<span class="keyword">:</span> <span class="staexp">char</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">Char</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> g0ofg1 <span class="keyword">with</span> g0ofg1_char</span> <span class="comment">// index-erasing</span>
<span class="dynexp"><span class="keyword">overload</span> g1ofg0 <span class="keyword">with</span> g1ofg0_char</span> <span class="comment">// index-inducing</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">castfn</span>
char2schar1
  <span class="staexp"><span class="keyword">{</span>c<span class="keyword">:</span>int<span class="keyword">}</span></span><span class="keyword">(</span>c<span class="keyword">:</span> <span class="staexp">char</span> <span class="keyword">(</span><span class="staexp">c</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">schar</span> <span class="keyword">(</span><span class="staexp">c</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">castfn</span>
schar2char1
  <span class="staexp"><span class="keyword">{</span>c<span class="keyword">:</span>int<span class="keyword">}</span></span><span class="keyword">(</span>c<span class="keyword">:</span> <span class="staexp">schar</span> <span class="keyword">(</span><span class="staexp">c</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">char</span> <span class="keyword">(</span><span class="staexp">c</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">castfn</span>
char2uchar1
  <span class="staexp"><span class="keyword">{</span>c<span class="keyword">:</span>int<span class="keyword">}</span></span><span class="keyword">(</span>c<span class="keyword">:</span> <span class="staexp">char</span> <span class="keyword">(</span><span class="staexp">c</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uchar</span> <span class="keyword">(</span><span class="staexp">i2u8</span><span class="keyword">(</span><span class="staexp">c</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">castfn</span>
uchar2char1
  <span class="staexp"><span class="keyword">{</span>c<span class="keyword">:</span>int<span class="keyword">}</span></span><span class="keyword">(</span>c<span class="keyword">:</span> <span class="staexp">uchar</span> <span class="keyword">(</span><span class="staexp">c</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">char</span> <span class="keyword">(</span><span class="staexp">u2i8</span><span class="keyword">(</span><span class="staexp">c</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
char2int1
  <span class="staexp"><span class="keyword">{</span>c<span class="keyword">:</span>int<span class="keyword">}</span></span><span class="keyword">(</span>c<span class="keyword">:</span> <span class="staexp">char</span> <span class="keyword">(</span><span class="staexp">c</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int</span> <span class="keyword">(</span><span class="staexp">c</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span>
schar2int1
  <span class="staexp"><span class="keyword">{</span>c<span class="keyword">:</span>int<span class="keyword">}</span></span><span class="keyword">(</span>c<span class="keyword">:</span> <span class="staexp">schar</span> <span class="keyword">(</span><span class="staexp">c</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int</span> <span class="keyword">(</span><span class="staexp">c</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span>
uchar2int1
  <span class="staexp"><span class="keyword">{</span>c<span class="keyword">:</span>int<span class="keyword">}</span></span><span class="keyword">(</span>c<span class="keyword">:</span> <span class="staexp">uchar</span> <span class="keyword">(</span><span class="staexp">c</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int</span> <span class="keyword">(</span><span class="staexp">c</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
char1_iseqz
  <span class="staexp"><span class="keyword">{</span>c<span class="keyword">:</span>int<span class="keyword">}</span></span><span class="keyword">(</span>c<span class="keyword">:</span> <span class="staexp">char</span><span class="keyword">(</span><span class="staexp">c</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span><span class="keyword">(</span><span class="staexp">c</span> <span class="staexp">==</span> <span class="staexp">0</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span>
char1_isneqz
  <span class="staexp"><span class="keyword">{</span>c<span class="keyword">:</span>int<span class="keyword">}</span></span><span class="keyword">(</span>c<span class="keyword">:</span> <span class="staexp">char</span><span class="keyword">(</span><span class="staexp">c</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span><span class="keyword">(</span><span class="staexp">c</span> <span class="staexp">!=</span> <span class="staexp">0</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> iseqz <span class="keyword">with</span> char1_iseqz <span class="keyword">of</span> 10</span>
<span class="dynexp"><span class="keyword">overload</span> isneqz <span class="keyword">with</span> char1_isneqz <span class="keyword">of</span> 10</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span>
lt_char1_char1 <span class="staexp"><span class="keyword">{</span>c1<span class="keyword">,</span>c2<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>c1<span class="keyword">:</span> <span class="staexp">char</span> <span class="keyword">(</span><span class="staexp">c1</span><span class="keyword">)</span><span class="keyword">,</span> c2<span class="keyword">:</span> <span class="staexp">char</span> <span class="keyword">(</span><span class="staexp">c2</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">(</span><span class="staexp">c1</span> <span class="staexp"><span class="keyword">&lt;</span></span> <span class="staexp">c2</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">&lt;</span> <span class="keyword">with</span> lt_char1_char1 <span class="keyword">of</span> 20</span>
<span class="dynexp"><span class="keyword">fun</span>
lte_char1_char1 <span class="staexp"><span class="keyword">{</span>c1<span class="keyword">,</span>c2<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>c1<span class="keyword">:</span> <span class="staexp">char</span> <span class="keyword">(</span><span class="staexp">c1</span><span class="keyword">)</span><span class="keyword">,</span> c2<span class="keyword">:</span> <span class="staexp">char</span> <span class="keyword">(</span><span class="staexp">c2</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">(</span><span class="staexp">c1</span> <span class="staexp">&lt;=</span> <span class="staexp">c2</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> &lt;= <span class="keyword">with</span> lte_char1_char1 <span class="keyword">of</span> 20</span>

<span class="dynexp"><span class="keyword">fun</span>
gt_char1_char1 <span class="staexp"><span class="keyword">{</span>c1<span class="keyword">,</span>c2<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>c1<span class="keyword">:</span> <span class="staexp">char</span> <span class="keyword">(</span><span class="staexp">c1</span><span class="keyword">)</span><span class="keyword">,</span> c2<span class="keyword">:</span> <span class="staexp">char</span> <span class="keyword">(</span><span class="staexp">c2</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">(</span><span class="staexp">c1</span> <span class="staexp"><span class="keyword">&gt;</span></span> <span class="staexp">c2</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">&gt;</span> <span class="keyword">with</span> gt_char1_char1 <span class="keyword">of</span> 20</span>
<span class="dynexp"><span class="keyword">fun</span>
gte_char1_char1 <span class="staexp"><span class="keyword">{</span>c1<span class="keyword">,</span>c2<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>c1<span class="keyword">:</span> <span class="staexp">char</span> <span class="keyword">(</span><span class="staexp">c1</span><span class="keyword">)</span><span class="keyword">,</span> c2<span class="keyword">:</span> <span class="staexp">char</span> <span class="keyword">(</span><span class="staexp">c2</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">(</span><span class="staexp">c1</span> <span class="staexp">&gt;=</span> <span class="staexp">c2</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> &gt;= <span class="keyword">with</span> gte_char1_char1 <span class="keyword">of</span> 20</span>

<span class="dynexp"><span class="keyword">fun</span>
eq_char1_char1 <span class="staexp"><span class="keyword">{</span>c1<span class="keyword">,</span>c2<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>c1<span class="keyword">:</span> <span class="staexp">char</span> <span class="keyword">(</span><span class="staexp">c1</span><span class="keyword">)</span><span class="keyword">,</span> c2<span class="keyword">:</span> <span class="staexp">char</span> <span class="keyword">(</span><span class="staexp">c2</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">(</span><span class="staexp">c1</span> <span class="staexp">==</span> <span class="staexp">c2</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">=</span> <span class="keyword">with</span> eq_char1_char1 <span class="keyword">of</span> 20</span>
<span class="dynexp"><span class="keyword">fun</span>
neq_char1_char1 <span class="staexp"><span class="keyword">{</span>c1<span class="keyword">,</span>c2<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>c1<span class="keyword">:</span> <span class="staexp">char</span> <span class="keyword">(</span><span class="staexp">c1</span><span class="keyword">)</span><span class="keyword">,</span> c2<span class="keyword">:</span> <span class="staexp">char</span> <span class="keyword">(</span><span class="staexp">c2</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">(</span><span class="staexp">c1</span> <span class="staexp">!=</span> <span class="staexp">c2</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> != <span class="keyword">with</span> neq_char1_char1 <span class="keyword">of</span> 20</span>
<span class="dynexp"><span class="keyword">overload</span> &lt;&gt; <span class="keyword">with</span> neq_char1_char1 <span class="keyword">of</span> 20</span>

<span class="dynexp"><span class="keyword">fun</span> compare_char1_char1
  <span class="staexp"><span class="keyword">{</span>c1<span class="keyword">,</span>c2<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>c1<span class="keyword">:</span> <span class="staexp">char</span> <span class="staexp">c1</span><span class="keyword">,</span> c2<span class="keyword">:</span> <span class="staexp">char</span> <span class="staexp">c2</span><span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int</span> <span class="keyword">(</span><span class="staexp">c1</span><span class="staexp">-</span><span class="staexp">c2</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> compare <span class="keyword">with</span> compare_char1_char1 <span class="keyword">of</span> 20</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> eq_char0_int0 <span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">char</span><span class="keyword">,</span> <span class="staexp">int</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">fun0</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> eq_int0_char0 <span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">int</span><span class="keyword">,</span> <span class="staexp">char</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">fun0</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">=</span> <span class="keyword">with</span> eq_char0_int0 <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">=</span> <span class="keyword">with</span> eq_int0_char0 <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">fun</span> neq_char0_int0 <span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">char</span><span class="keyword">,</span> <span class="staexp">int</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">fun0</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> neq_int0_char0 <span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">int</span><span class="keyword">,</span> <span class="staexp">char</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">fun0</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> != <span class="keyword">with</span> neq_char0_int0 <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> &lt;&gt; <span class="keyword">with</span> neq_char0_int0 <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> != <span class="keyword">with</span> neq_int0_char0 <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> &lt;&gt; <span class="keyword">with</span> neq_int0_char0 <span class="keyword">of</span> 0</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> compare_char0_int0 <span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">char</span><span class="keyword">,</span> <span class="staexp">int</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">fun0</span><span class="keyword">&gt;</span> <span class="staexp">int</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> compare_int0_char0 <span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">int</span><span class="keyword">,</span> <span class="staexp">char</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">fun0</span><span class="keyword">&gt;</span> <span class="staexp">int</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> compare <span class="keyword">with</span> compare_char0_int0</span>
<span class="dynexp"><span class="keyword">overload</span> compare <span class="keyword">with</span> compare_int0_char0</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">// unsigned characters</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span> lt_uchar0_uchar0
  <span class="keyword">(</span>c1<span class="keyword">:</span> <span class="staexp">uchar</span><span class="keyword">,</span> c2<span class="keyword">:</span> <span class="staexp">uchar</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">&lt;</span> <span class="keyword">with</span> lt_uchar0_uchar0 <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">fun</span> lte_uchar0_uchar0
  <span class="keyword">(</span>c1<span class="keyword">:</span> <span class="staexp">uchar</span><span class="keyword">,</span> c2<span class="keyword">:</span> <span class="staexp">uchar</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> &lt;= <span class="keyword">with</span> lte_uchar0_uchar0 <span class="keyword">of</span> 0</span>

<span class="dynexp"><span class="keyword">fun</span> gt_uchar0_uchar0
  <span class="keyword">(</span>c1<span class="keyword">:</span> <span class="staexp">uchar</span><span class="keyword">,</span> c2<span class="keyword">:</span> <span class="staexp">uchar</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">&gt;</span> <span class="keyword">with</span> gt_uchar0_uchar0 <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">fun</span> gte_uchar0_uchar0
  <span class="keyword">(</span>c1<span class="keyword">:</span> <span class="staexp">uchar</span><span class="keyword">,</span> c2<span class="keyword">:</span> <span class="staexp">uchar</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> &gt;= <span class="keyword">with</span> gte_uchar0_uchar0 <span class="keyword">of</span> 0</span>

<span class="dynexp"><span class="keyword">fun</span> eq_uchar0_uchar0
  <span class="keyword">(</span>c1<span class="keyword">:</span> <span class="staexp">uchar</span><span class="keyword">,</span> c2<span class="keyword">:</span> <span class="staexp">uchar</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">=</span> <span class="keyword">with</span> eq_uchar0_uchar0 <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">fun</span> neq_uchar0_uchar0
  <span class="keyword">(</span>c1<span class="keyword">:</span> <span class="staexp">uchar</span><span class="keyword">,</span> c2<span class="keyword">:</span> <span class="staexp">uchar</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> != <span class="keyword">with</span> neq_uchar0_uchar0 <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> &lt;&gt; <span class="keyword">with</span> neq_uchar0_uchar0 <span class="keyword">of</span> 0</span>

<span class="dynexp"><span class="keyword">fun</span> compare_uchar0_uchar0
  <span class="keyword">(</span>c1<span class="keyword">:</span> <span class="staexp">uchar</span><span class="keyword">,</span> c2<span class="keyword">:</span> <span class="staexp">uchar</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> compare <span class="keyword">with</span> compare_uchar0_uchar0 <span class="keyword">of</span> 0</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span>
lt_uchar1_uchar1 <span class="staexp"><span class="keyword">{</span>c1<span class="keyword">,</span>c2<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>c1<span class="keyword">:</span> <span class="staexp">uchar</span> <span class="keyword">(</span><span class="staexp">c1</span><span class="keyword">)</span><span class="keyword">,</span> c2<span class="keyword">:</span> <span class="staexp">uchar</span> <span class="keyword">(</span><span class="staexp">c2</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">(</span><span class="staexp">c1</span> <span class="staexp"><span class="keyword">&lt;</span></span> <span class="staexp">c2</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">&lt;</span> <span class="keyword">with</span> lt_uchar1_uchar1 <span class="keyword">of</span> 20</span>
<span class="dynexp"><span class="keyword">fun</span>
lte_uchar1_uchar1 <span class="staexp"><span class="keyword">{</span>c1<span class="keyword">,</span>c2<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>c1<span class="keyword">:</span> <span class="staexp">uchar</span> <span class="keyword">(</span><span class="staexp">c1</span><span class="keyword">)</span><span class="keyword">,</span> c2<span class="keyword">:</span> <span class="staexp">uchar</span> <span class="keyword">(</span><span class="staexp">c2</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">(</span><span class="staexp">c1</span> <span class="staexp">&lt;=</span> <span class="staexp">c2</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> &lt;= <span class="keyword">with</span> lte_uchar1_uchar1 <span class="keyword">of</span> 20</span>

<span class="dynexp"><span class="keyword">fun</span>
gt_uchar1_uchar1 <span class="staexp"><span class="keyword">{</span>c1<span class="keyword">,</span>c2<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>c1<span class="keyword">:</span> <span class="staexp">uchar</span> <span class="keyword">(</span><span class="staexp">c1</span><span class="keyword">)</span><span class="keyword">,</span> c2<span class="keyword">:</span> <span class="staexp">uchar</span> <span class="keyword">(</span><span class="staexp">c2</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">(</span><span class="staexp">c1</span> <span class="staexp"><span class="keyword">&gt;</span></span> <span class="staexp">c2</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">&gt;</span> <span class="keyword">with</span> gt_uchar1_uchar1 <span class="keyword">of</span> 20</span>
<span class="dynexp"><span class="keyword">fun</span>
gte_uchar1_uchar1 <span class="staexp"><span class="keyword">{</span>c1<span class="keyword">,</span>c2<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>c1<span class="keyword">:</span> <span class="staexp">uchar</span> <span class="keyword">(</span><span class="staexp">c1</span><span class="keyword">)</span><span class="keyword">,</span> c2<span class="keyword">:</span> <span class="staexp">uchar</span> <span class="keyword">(</span><span class="staexp">c2</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">(</span><span class="staexp">c1</span> <span class="staexp">&gt;=</span> <span class="staexp">c2</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> &gt;= <span class="keyword">with</span> gte_uchar1_uchar1 <span class="keyword">of</span> 20</span>

<span class="dynexp"><span class="keyword">fun</span>
eq_uchar1_uchar1 <span class="staexp"><span class="keyword">{</span>c1<span class="keyword">,</span>c2<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>c1<span class="keyword">:</span> <span class="staexp">uchar</span> <span class="keyword">(</span><span class="staexp">c1</span><span class="keyword">)</span><span class="keyword">,</span> c2<span class="keyword">:</span> <span class="staexp">uchar</span> <span class="keyword">(</span><span class="staexp">c2</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">(</span><span class="staexp">c1</span> <span class="staexp">==</span> <span class="staexp">c2</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">=</span> <span class="keyword">with</span> eq_uchar1_uchar1 <span class="keyword">of</span> 20</span>
<span class="dynexp"><span class="keyword">fun</span>
neq_uchar1_uchar1 <span class="staexp"><span class="keyword">{</span>c1<span class="keyword">,</span>c2<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>c1<span class="keyword">:</span> <span class="staexp">uchar</span> <span class="keyword">(</span><span class="staexp">c1</span><span class="keyword">)</span><span class="keyword">,</span> c2<span class="keyword">:</span> <span class="staexp">uchar</span> <span class="keyword">(</span><span class="staexp">c2</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">(</span><span class="staexp">c1</span> <span class="staexp">!=</span> <span class="staexp">c2</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> != <span class="keyword">with</span> neq_uchar1_uchar1 <span class="keyword">of</span> 20</span>
<span class="dynexp"><span class="keyword">overload</span> &lt;&gt; <span class="keyword">with</span> neq_uchar1_uchar1 <span class="keyword">of</span> 20</span>

<span class="dynexp"><span class="keyword">fun</span> compare_uchar1_uchar1
  <span class="staexp"><span class="keyword">{</span>c1<span class="keyword">,</span>c2<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>c1<span class="keyword">:</span> <span class="staexp">uchar</span> <span class="staexp">c1</span><span class="keyword">,</span> c2<span class="keyword">:</span> <span class="staexp">uchar</span> <span class="staexp">c2</span><span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int</span> <span class="keyword">(</span><span class="staexp">c1</span><span class="staexp">-</span><span class="staexp">c2</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> compare <span class="keyword">with</span> compare_uchar1_uchar1 <span class="keyword">of</span> 20</span>

<span class="comment">(* ****** ****** *)</span>

<span class="staexp"><span class="keyword">sortdef</span> tk <span class="keyword">=</span> tkind</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g0int_of_char <span class="keyword">(</span>c<span class="keyword">:</span> <span class="staexp">char</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">g0int</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g0int_of_schar <span class="keyword">(</span>c<span class="keyword">:</span> <span class="staexp">schar</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">g0int</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g0int_of_uchar <span class="keyword">(</span>c<span class="keyword">:</span> <span class="staexp">uchar</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">g0int</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g0uint_of_uchar <span class="keyword">(</span>c<span class="keyword">:</span> <span class="staexp">uchar</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">g0uint</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g1int_of_char1 <span class="comment">// c:int8</span>
  <span class="staexp"><span class="keyword">{</span>c<span class="keyword">:</span>int<span class="keyword">}</span></span> <span class="keyword">(</span>c<span class="keyword">:</span> <span class="staexp">char</span> <span class="keyword">(</span><span class="staexp">c</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">g1int</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">c</span><span class="keyword">)</span></span>
<span class="comment">// end of [g1int_of_char1]</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g1int_of_schar1 <span class="comment">// c:int8</span>
  <span class="staexp"><span class="keyword">{</span>c<span class="keyword">:</span>int<span class="keyword">}</span></span> <span class="keyword">(</span>c<span class="keyword">:</span> <span class="staexp">schar</span> <span class="keyword">(</span><span class="staexp">c</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">g1int</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">c</span><span class="keyword">)</span></span>
<span class="comment">// end of [g1int_of_schar1]</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g1int_of_uchar1 <span class="comment">// c:uint8</span>
  <span class="staexp"><span class="keyword">{</span>c<span class="keyword">:</span>int<span class="keyword">}</span></span> <span class="keyword">(</span>c<span class="keyword">:</span> <span class="staexp">uchar</span> <span class="keyword">(</span><span class="staexp">c</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">g1int</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">c</span><span class="keyword">)</span></span>
<span class="comment">// end of [g1int_of_uchar1]</span>

<span class="comment">(*
** HX: g1uint_of_schar1: schar -&gt; int -&gt; uint
*)</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g1uint_of_uchar1
  <span class="staexp"><span class="keyword">{</span>c<span class="keyword">:</span>int<span class="keyword">}</span></span> <span class="keyword">(</span>c<span class="keyword">:</span> <span class="staexp">uchar</span> <span class="keyword">(</span><span class="staexp">c</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">g1uint</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">c</span><span class="keyword">)</span></span>
<span class="comment">// end of [g1uint_of_uchar1]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">// HX:</span>
<span class="comment">// return is dynamically allocated</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
char2string<span class="keyword">(</span>c<span class="keyword">:</span> <span class="staexp">char</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">string</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
char2strptr<span class="keyword">(</span>c<span class="keyword">:</span> <span class="staexp">char</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">Strptr1</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span> print_char <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">char</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> prerr_char <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">char</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> print <span class="keyword">with</span> print_char</span>
<span class="dynexp"><span class="keyword">overload</span> prerr <span class="keyword">with</span> prerr_char</span>
<span class="dynexp"><span class="keyword">fun</span> fprint_char <span class="keyword">:</span> <span class="staexp">fprint_type</span> <span class="keyword">(</span><span class="staexp">char</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> fprint <span class="keyword">with</span> fprint_char</span>
<span class="dynexp"><span class="keyword">fun</span> print_schar <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">schar</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> prerr_schar <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">schar</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> print <span class="keyword">with</span> print_schar</span>
<span class="dynexp"><span class="keyword">overload</span> prerr <span class="keyword">with</span> prerr_schar</span>
<span class="dynexp"><span class="keyword">fun</span> fprint_schar <span class="keyword">:</span> <span class="staexp">fprint_type</span> <span class="keyword">(</span><span class="staexp">schar</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> fprint <span class="keyword">with</span> fprint_schar</span>
<span class="dynexp"><span class="keyword">fun</span> print_uchar <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uchar</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> prerr_uchar <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uchar</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> print <span class="keyword">with</span> print_uchar</span>
<span class="dynexp"><span class="keyword">overload</span> prerr <span class="keyword">with</span> prerr_uchar</span>
<span class="dynexp"><span class="keyword">fun</span> fprint_uchar <span class="keyword">:</span> <span class="staexp">fprint_type</span> <span class="keyword">(</span><span class="staexp">uchar</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> fprint <span class="keyword">with</span> fprint_uchar</span>

<span class="comment">(* ****** ****** *)</span>

<span class="neuexp"><span class="keyword">symintr</span> isalpha</span>
<span class="dynexp"><span class="keyword">fun</span> isalpha_int <span class="keyword">(</span>c<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> isalpha <span class="keyword">with</span> isalpha_int <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">fun</span> isalpha_char <span class="keyword">(</span>c<span class="keyword">:</span> <span class="staexp">char</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> isalpha <span class="keyword">with</span> isalpha_char <span class="keyword">of</span> 0</span>
<span class="neuexp"><span class="keyword">symintr</span> isalnum</span>
<span class="dynexp"><span class="keyword">fun</span> isalnum_int <span class="keyword">(</span>c<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> isalnum <span class="keyword">with</span> isalnum_int <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">fun</span> isalnum_char <span class="keyword">(</span>c<span class="keyword">:</span> <span class="staexp">char</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> isalnum <span class="keyword">with</span> isalnum_char <span class="keyword">of</span> 0</span>

<span class="neuexp"><span class="keyword">symintr</span> isascii</span>
<span class="dynexp"><span class="keyword">fun</span> isascii_int <span class="keyword">(</span>c<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> isascii <span class="keyword">with</span> isascii_int <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">fun</span> isascii_char <span class="keyword">(</span>c<span class="keyword">:</span> <span class="staexp">char</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> isascii <span class="keyword">with</span> isascii_char <span class="keyword">of</span> 0</span>

<span class="neuexp"><span class="keyword">symintr</span> isblank</span>
<span class="dynexp"><span class="keyword">fun</span> isblank_int <span class="keyword">(</span>c<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> isblank <span class="keyword">with</span> isblank_int <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">fun</span> isblank_char <span class="keyword">(</span>c<span class="keyword">:</span> <span class="staexp">char</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> isblank <span class="keyword">with</span> isblank_char <span class="keyword">of</span> 0</span>
<span class="neuexp"><span class="keyword">symintr</span> isspace</span>
<span class="dynexp"><span class="keyword">fun</span> isspace_int <span class="keyword">(</span>c<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> isspace <span class="keyword">with</span> isspace_int <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">fun</span> isspace_char <span class="keyword">(</span>c<span class="keyword">:</span> <span class="staexp">char</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> isspace <span class="keyword">with</span> isspace_char <span class="keyword">of</span> 0</span>

<span class="neuexp"><span class="keyword">symintr</span> iscntrl</span>
<span class="dynexp"><span class="keyword">fun</span> iscntrl_int <span class="keyword">(</span>c<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> iscntrl <span class="keyword">with</span> iscntrl_int <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">fun</span> iscntrl_char <span class="keyword">(</span>c<span class="keyword">:</span> <span class="staexp">char</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> iscntrl <span class="keyword">with</span> iscntrl_char <span class="keyword">of</span> 0</span>

<span class="neuexp"><span class="keyword">symintr</span> isdigit</span>
<span class="dynexp"><span class="keyword">fun</span> isdigit_int <span class="keyword">(</span>c<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> isdigit <span class="keyword">with</span> isdigit_int <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">fun</span> isdigit_char <span class="keyword">(</span>c<span class="keyword">:</span> <span class="staexp">char</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> isdigit <span class="keyword">with</span> isdigit_char <span class="keyword">of</span> 0</span>
<span class="neuexp"><span class="keyword">symintr</span> isxdigit</span>
<span class="dynexp"><span class="keyword">fun</span> isxdigit_int <span class="keyword">(</span>c<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> isxdigit <span class="keyword">with</span> isxdigit_int <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">fun</span> isxdigit_char <span class="keyword">(</span>c<span class="keyword">:</span> <span class="staexp">char</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> isxdigit <span class="keyword">with</span> isxdigit_char <span class="keyword">of</span> 0</span>

<span class="neuexp"><span class="keyword">symintr</span> isgraph</span>
<span class="dynexp"><span class="keyword">fun</span> isgraph_int <span class="keyword">(</span>c<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> isgraph <span class="keyword">with</span> isgraph_int <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">fun</span> isgraph_char <span class="keyword">(</span>c<span class="keyword">:</span> <span class="staexp">char</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> isgraph <span class="keyword">with</span> isgraph_char <span class="keyword">of</span> 0</span>
<span class="neuexp"><span class="keyword">symintr</span> isprint</span>
<span class="dynexp"><span class="keyword">fun</span> isprint_int <span class="keyword">(</span>c<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> isprint <span class="keyword">with</span> isprint_int <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">fun</span> isprint_char <span class="keyword">(</span>c<span class="keyword">:</span> <span class="staexp">char</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> isprint <span class="keyword">with</span> isprint_char <span class="keyword">of</span> 0</span>
<span class="neuexp"><span class="keyword">symintr</span> ispunct</span>
<span class="dynexp"><span class="keyword">fun</span> ispunct_int <span class="keyword">(</span>c<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> ispunct <span class="keyword">with</span> ispunct_int <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">fun</span> ispunct_char <span class="keyword">(</span>c<span class="keyword">:</span> <span class="staexp">char</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> ispunct <span class="keyword">with</span> ispunct_char <span class="keyword">of</span> 0</span>

<span class="neuexp"><span class="keyword">symintr</span> islower</span>
<span class="dynexp"><span class="keyword">fun</span> islower_int <span class="keyword">(</span>c<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> islower <span class="keyword">with</span> islower_int <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">fun</span> islower_char <span class="keyword">(</span>c<span class="keyword">:</span> <span class="staexp">char</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> islower <span class="keyword">with</span> islower_char <span class="keyword">of</span> 0</span>
<span class="neuexp"><span class="keyword">symintr</span> isupper</span>
<span class="dynexp"><span class="keyword">fun</span> isupper_int <span class="keyword">(</span>c<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> isupper <span class="keyword">with</span> isupper_int <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">fun</span> isupper_char <span class="keyword">(</span>c<span class="keyword">:</span> <span class="staexp">char</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> isupper <span class="keyword">with</span> isupper_char <span class="keyword">of</span> 0</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span> toascii <span class="keyword">(</span>c<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int</span> <span class="keyword">=</span> "mac#%"</span>

<span class="comment">(* ****** ****** *)</span>

<span class="neuexp"><span class="keyword">symintr</span> tolower</span>
<span class="dynexp"><span class="keyword">fun</span> tolower_int <span class="keyword">(</span>c<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> tolower_char <span class="keyword">(</span>c<span class="keyword">:</span> <span class="staexp">char</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">char</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> tolower <span class="keyword">with</span> tolower_int</span>
<span class="dynexp"><span class="keyword">overload</span> tolower <span class="keyword">with</span> tolower_char</span>

<span class="neuexp"><span class="keyword">symintr</span> toupper</span>
<span class="dynexp"><span class="keyword">fun</span> toupper_int <span class="keyword">(</span>c<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> toupper_char <span class="keyword">(</span>c<span class="keyword">:</span> <span class="staexp">char</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">char</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> toupper <span class="keyword">with</span> toupper_int</span>
<span class="dynexp"><span class="keyword">overload</span> toupper <span class="keyword">with</span> toupper_char</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span> int2digit <span class="keyword">(</span>i<span class="keyword">:</span> <span class="staexp">intBtw</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">,</span> <span class="staexp">10</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">char</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> int2xdigit <span class="keyword">(</span>i<span class="keyword">:</span> <span class="staexp">intBtw</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">,</span> <span class="staexp">16</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">char</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> int2xxdigit <span class="keyword">(</span>i<span class="keyword">:</span> <span class="staexp">intBtw</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">,</span> <span class="staexp">16</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">char</span> <span class="keyword">=</span> "mac#%"</span>

<span class="comment">(* ****** ****** *)</span>

<span class="neuexp"><span class="keyword">symintr</span> c2uc</span>
<span class="dynexp"><span class="keyword">overload</span> c2uc <span class="keyword">with</span> char2uchar0 <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> c2uc <span class="keyword">with</span> char2uchar1 <span class="keyword">of</span> 10</span>
<span class="neuexp"><span class="keyword">symintr</span> uc2c</span>
<span class="dynexp"><span class="keyword">overload</span> uc2c <span class="keyword">with</span> uchar2char0 <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> uc2c <span class="keyword">with</span> uchar2char1 <span class="keyword">of</span> 10</span>

<span class="comment">(* ****** ****** *)</span>

<span class="neuexp"><span class="keyword">symintr</span> char2i</span>
<span class="dynexp"><span class="keyword">overload</span> char2i <span class="keyword">with</span> char2int0 <span class="keyword">of</span> 0</span>
<span class="neuexp"><span class="keyword">symintr</span> char2ui</span>
<span class="dynexp"><span class="keyword">overload</span> char2ui <span class="keyword">with</span> char2uint0 <span class="keyword">of</span> 0</span>
<span class="neuexp"><span class="keyword">symintr</span> uchar2i</span>
<span class="dynexp"><span class="keyword">overload</span> uchar2i <span class="keyword">with</span> uchar2int0 <span class="keyword">of</span> 0</span>
<span class="neuexp"><span class="keyword">symintr</span> uchar2ui</span>
<span class="dynexp"><span class="keyword">overload</span> uchar2ui <span class="keyword">with</span> uchar2uint0 <span class="keyword">of</span> 0</span>

<span class="comment">(* ****** ****** *)</span>

<span class="neuexp"><span class="keyword">symintr</span> char2u2i</span>
<span class="dynexp"><span class="keyword">overload</span> char2u2i <span class="keyword">with</span> char2u2int0 <span class="keyword">of</span> 0</span>
<span class="neuexp"><span class="keyword">symintr</span> char2u2ui</span>
<span class="dynexp"><span class="keyword">overload</span> char2u2ui <span class="keyword">with</span> char2u2uint0 <span class="keyword">of</span> 0</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> int2byte0 <span class="keyword">(</span>i<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">byte</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> byte2int0 <span class="keyword">(</span>b<span class="keyword">:</span> <span class="staexp">byte</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> uint2byte0 <span class="keyword">(</span>u<span class="keyword">:</span> <span class="staexp">uint</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">byte</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> byte2uint0 <span class="keyword">(</span>b<span class="keyword">:</span> <span class="staexp">byte</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uint</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">//</span>
<span class="neuexp"><span class="keyword">symintr</span> byte2i</span>
<span class="dynexp"><span class="keyword">overload</span> byte2i <span class="keyword">with</span> byte2int0 <span class="keyword">of</span> 0</span>
<span class="neuexp"><span class="keyword">symintr</span> i2byte</span>
<span class="dynexp"><span class="keyword">overload</span> i2byte <span class="keyword">with</span> int2byte0 <span class="keyword">of</span> 0</span>
<span class="comment">//</span>
<span class="neuexp"><span class="keyword">symintr</span> byte2ui</span>
<span class="dynexp"><span class="keyword">overload</span> byte2i <span class="keyword">with</span> byte2uint0 <span class="keyword">of</span> 0</span>
<span class="neuexp"><span class="keyword">symintr</span> ui2byte</span>
<span class="dynexp"><span class="keyword">overload</span> i2byte <span class="keyword">with</span> uint2byte0 <span class="keyword">of</span> 0</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* end of [char.sats] *)</span>
</pre>
<pre class="patsyntax">
<span class="comment">(***********************************************************************)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(*                         Applied Type System                         *)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(***********************************************************************)</span>

<span class="comment">(*
** ATS/Postiats - Unleashing the Potential of Types!
** Copyright (C) 2010-2015 Hongwei Xi, ATS Trustful Software, Inc.
** All rights reserved
**
** ATS is free software;  you can  redistribute it and/or modify it under
** the terms of  the GNU GENERAL PUBLIC LICENSE (GPL) as published by the
** Free Software Foundation; either version 3, or (at  your  option)  any
** later version.
**
** ATS is distributed in the hope that it will be useful, but WITHOUT ANY
** WARRANTY; without  even  the  implied  warranty  of MERCHANTABILITY or
** FITNESS FOR A PARTICULAR PURPOSE.  See the  GNU General Public License
** for more details.
**
** You  should  have  received  a  copy of the GNU General Public License
** along  with  ATS;  see the  file COPYING.  If not, please write to the
** Free Software Foundation,  51 Franklin Street, Fifth Floor, Boston, MA
** 02110-1301, USA.
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* Author: Hongwei Xi *)</span>
<span class="comment">(* Authoremail: hwxi AT cs DOT bu DOT edu *)</span>
<span class="comment">(* Start time: September, 2011 *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
** Source:
** $PATSHOME/prelude/SATS/CODEGEN/float.atxt
** Time of generation: Mon Oct 17 23:04:07 2016
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">stadef</span> <span class="staexp">fltknd <span class="keyword">=</span> <span class="staexp">float_kind</span></span>
<span class="keyword">stadef</span> <span class="staexp">dblknd <span class="keyword">=</span> <span class="staexp">double_kind</span></span>
<span class="keyword">stadef</span> <span class="staexp">ldblknd <span class="keyword">=</span> <span class="staexp">ldouble_kind</span></span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>tk1<span class="keyword">,</span>tk2<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g0int2float<span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">g0int</span><span class="keyword">(</span><span class="staexp">tk1</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">g0float</span><span class="keyword">(</span><span class="staexp">tk2</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
g0int2float_int_float<span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">float</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span>
g0int2float_int_double<span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">double</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span>
g0int2float_lint_double<span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">lint</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">double</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>tk1<span class="keyword">,</span>tk2<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g0float2int<span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">g0float</span><span class="keyword">(</span><span class="staexp">tk1</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">g0int</span><span class="keyword">(</span><span class="staexp">tk2</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
g0float2int_float_int<span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">float</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span>
g0float2int_float_lint<span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">float</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">lint</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span>
g0float2int_double_int<span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">double</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span>
g0float2int_double_lint<span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">double</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">lint</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span>
g0float2int_double_llint<span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">double</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">llint</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>tk1<span class="keyword">,</span>tk2<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g0float2float<span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">g0float</span><span class="keyword">(</span><span class="staexp">tk1</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">g0float</span><span class="keyword">(</span><span class="staexp">tk2</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
g0float2float_float_float<span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">float</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">float</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span>
g0float2float_float_double<span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">float</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">double</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span>
g0float2float_double_float<span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">double</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">float</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span>
g0float2float_double_double<span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">double</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">double</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g0string2float<span class="keyword">(</span>rep<span class="keyword">:</span> <span class="staexp">NSH</span><span class="keyword">(</span><span class="staexp">string</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">g0float</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
g0string2float_double<span class="keyword">(</span>rep<span class="keyword">:</span> <span class="staexp">NSH</span><span class="keyword">(</span><span class="staexp">string</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">double</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="keyword">typedef</span>
<span class="staexp">g0float_uop_type
  <span class="keyword">(</span><span class="staexp">tk<span class="keyword">:</span>tk</span><span class="keyword">)</span> <span class="keyword">=</span>
  <span class="staexp">g0float</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">fun0</span><span class="keyword">&gt;</span> <span class="staexp">g0float</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g0float_abs <span class="keyword">:</span> <span class="staexp">g0float_uop_type</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g0float_neg <span class="keyword">:</span> <span class="staexp">g0float_uop_type</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> abs <span class="keyword">with</span> g0float_abs <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">~</span> <span class="keyword">with</span> g0float_neg <span class="keyword">of</span> 0</span> <span class="comment">// ~ for uminus</span>
<span class="dynexp"><span class="keyword">overload</span> neg <span class="keyword">with</span> g0float_neg <span class="keyword">of</span> 0</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g0float_succ <span class="keyword">:</span> <span class="staexp">g0float_uop_type</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g0float_pred <span class="keyword">:</span> <span class="staexp">g0float_uop_type</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> succ <span class="keyword">with</span> g0float_succ <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> pred <span class="keyword">with</span> g0float_pred <span class="keyword">of</span> 0</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="keyword">typedef</span>
<span class="staexp">g0float_aop_type
  <span class="keyword">(</span><span class="staexp">tk<span class="keyword">:</span>tk</span><span class="keyword">)</span> <span class="keyword">=</span>
  <span class="keyword">(</span><span class="staexp">g0float</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">g0float</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">fun0</span><span class="keyword">&gt;</span> <span class="staexp">g0float</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="comment">// end of [g0float_aop_type]</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g0float_add <span class="keyword">:</span> <span class="staexp">g0float_aop_type</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">overload</span> + <span class="keyword">with</span> g0float_add <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g0float_sub <span class="keyword">:</span> <span class="staexp">g0float_aop_type</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">overload</span> - <span class="keyword">with</span> g0float_sub <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g0float_mul <span class="keyword">:</span> <span class="staexp">g0float_aop_type</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">overload</span> * <span class="keyword">with</span> g0float_mul <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g0float_div <span class="keyword">:</span> <span class="staexp">g0float_aop_type</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">overload</span> / <span class="keyword">with</span> g0float_div <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g0float_mod <span class="keyword">:</span> <span class="staexp">g0float_aop_type</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">overload</span> % <span class="keyword">with</span> g0float_mod <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> mod <span class="keyword">with</span> g0float_mod <span class="keyword">of</span> 0</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g0float_isltz<span class="keyword">(</span><span class="staexp">g0float</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span></span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g0float_isltez<span class="keyword">(</span><span class="staexp">g0float</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> isltz <span class="keyword">with</span> g0float_isltz <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> isltez <span class="keyword">with</span> g0float_isltez <span class="keyword">of</span> 0</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g0float_isgtz<span class="keyword">(</span><span class="staexp">g0float</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span></span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g0float_isgtez<span class="keyword">(</span><span class="staexp">g0float</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> isgtz <span class="keyword">with</span> g0float_isgtz <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> isgtez <span class="keyword">with</span> g0float_isgtez <span class="keyword">of</span> 0</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g0float_iseqz<span class="keyword">(</span><span class="staexp">g0float</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span></span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g0float_isneqz<span class="keyword">(</span><span class="staexp">g0float</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> iseqz <span class="keyword">with</span> g0float_iseqz <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> isneqz <span class="keyword">with</span> g0float_isneqz <span class="keyword">of</span> 0</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="keyword">typedef</span>
<span class="staexp">g0float_cmp_type
  <span class="keyword">(</span><span class="staexp">tk<span class="keyword">:</span>tk</span><span class="keyword">)</span> <span class="keyword">=</span>
  <span class="keyword">(</span><span class="staexp">g0float</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">g0float</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">fun0</span><span class="keyword">&gt;</span> <span class="staexp">bool</span></span>
<span class="comment">// end of [g0float_cmp_type]</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g0float_lt <span class="keyword">:</span> <span class="staexp">g0float_cmp_type</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g0float_lte <span class="keyword">:</span> <span class="staexp">g0float_cmp_type</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g0float_gt <span class="keyword">:</span> <span class="staexp">g0float_cmp_type</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g0float_gte <span class="keyword">:</span> <span class="staexp">g0float_cmp_type</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g0float_eq <span class="keyword">:</span> <span class="staexp">g0float_cmp_type</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g0float_neq <span class="keyword">:</span> <span class="staexp">g0float_cmp_type</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">&lt;</span> <span class="keyword">with</span> g0float_lt <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> &lt;= <span class="keyword">with</span> g0float_lte <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">&gt;</span> <span class="keyword">with</span> g0float_gt <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> &gt;= <span class="keyword">with</span> g0float_gte <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">=</span> <span class="keyword">with</span> g0float_eq <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> != <span class="keyword">with</span> g0float_neq <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> &lt;&gt; <span class="keyword">with</span> g0float_neq <span class="keyword">of</span> 0</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="keyword">typedef</span>
<span class="staexp">g0float_compare_type
  <span class="keyword">(</span><span class="staexp">tk<span class="keyword">:</span>tk</span><span class="keyword">)</span> <span class="keyword">=</span>
  <span class="keyword">(</span><span class="staexp">g0float</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">g0float</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">fun0</span><span class="keyword">&gt;</span> <span class="staexp">int</span></span>
<span class="comment">// end of [g0float_compare_type]</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g0float_compare
  <span class="keyword">:</span> <span class="staexp">g0float_compare_type</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> compare <span class="keyword">with</span> g0float_compare <span class="keyword">of</span> 0</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g0float_max <span class="keyword">:</span> <span class="staexp">g0float_aop_type</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g0float_min <span class="keyword">:</span> <span class="staexp">g0float_aop_type</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> max <span class="keyword">with</span> g0float_max <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> min <span class="keyword">with</span> g0float_min <span class="keyword">of</span> 0</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span> g0float_neg_float
  <span class="keyword">:</span> <span class="staexp">g0float_uop_type</span><span class="keyword">(</span><span class="staexp">fltknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0float_abs_float
  <span class="keyword">:</span> <span class="staexp">g0float_uop_type</span><span class="keyword">(</span><span class="staexp">fltknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>

<span class="dynexp"><span class="keyword">fun</span> g0float_succ_float
  <span class="keyword">:</span> <span class="staexp">g0float_uop_type</span><span class="keyword">(</span><span class="staexp">fltknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0float_pred_float
  <span class="keyword">:</span> <span class="staexp">g0float_uop_type</span><span class="keyword">(</span><span class="staexp">fltknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>

<span class="dynexp"><span class="keyword">fun</span> g0float_add_float
  <span class="keyword">:</span> <span class="staexp">g0float_aop_type</span><span class="keyword">(</span><span class="staexp">fltknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0float_sub_float
  <span class="keyword">:</span> <span class="staexp">g0float_aop_type</span><span class="keyword">(</span><span class="staexp">fltknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0float_mul_float
  <span class="keyword">:</span> <span class="staexp">g0float_aop_type</span><span class="keyword">(</span><span class="staexp">fltknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0float_div_float
  <span class="keyword">:</span> <span class="staexp">g0float_aop_type</span><span class="keyword">(</span><span class="staexp">fltknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0float_mod_float
  <span class="keyword">:</span> <span class="staexp">g0float_aop_type</span><span class="keyword">(</span><span class="staexp">fltknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>

<span class="dynexp"><span class="keyword">fun</span> g0float_lt_float
  <span class="keyword">:</span> <span class="staexp">g0float_cmp_type</span><span class="keyword">(</span><span class="staexp">fltknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0float_lte_float
  <span class="keyword">:</span> <span class="staexp">g0float_cmp_type</span><span class="keyword">(</span><span class="staexp">fltknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0float_gt_float
  <span class="keyword">:</span> <span class="staexp">g0float_cmp_type</span><span class="keyword">(</span><span class="staexp">fltknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0float_gte_float
  <span class="keyword">:</span> <span class="staexp">g0float_cmp_type</span><span class="keyword">(</span><span class="staexp">fltknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0float_eq_float
  <span class="keyword">:</span> <span class="staexp">g0float_cmp_type</span><span class="keyword">(</span><span class="staexp">fltknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0float_neq_float
  <span class="keyword">:</span> <span class="staexp">g0float_cmp_type</span><span class="keyword">(</span><span class="staexp">fltknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>

<span class="dynexp"><span class="keyword">fun</span> g0float_compare_float
  <span class="keyword">:</span> <span class="staexp">g0float_compare_type</span><span class="keyword">(</span><span class="staexp">fltknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>

<span class="dynexp"><span class="keyword">fun</span> g0float_max_float
  <span class="keyword">:</span> <span class="staexp">g0float_aop_type</span><span class="keyword">(</span><span class="staexp">fltknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0float_min_float
  <span class="keyword">:</span> <span class="staexp">g0float_aop_type</span><span class="keyword">(</span><span class="staexp">fltknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span> g0float_neg_double
  <span class="keyword">:</span> <span class="staexp">g0float_uop_type</span><span class="keyword">(</span><span class="staexp">dblknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0float_abs_double
  <span class="keyword">:</span> <span class="staexp">g0float_uop_type</span><span class="keyword">(</span><span class="staexp">dblknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>

<span class="dynexp"><span class="keyword">fun</span> g0float_succ_double
  <span class="keyword">:</span> <span class="staexp">g0float_uop_type</span><span class="keyword">(</span><span class="staexp">dblknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0float_pred_double
  <span class="keyword">:</span> <span class="staexp">g0float_uop_type</span><span class="keyword">(</span><span class="staexp">dblknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>

<span class="dynexp"><span class="keyword">fun</span> g0float_add_double
  <span class="keyword">:</span> <span class="staexp">g0float_aop_type</span><span class="keyword">(</span><span class="staexp">dblknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0float_sub_double
  <span class="keyword">:</span> <span class="staexp">g0float_aop_type</span><span class="keyword">(</span><span class="staexp">dblknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0float_mul_double
  <span class="keyword">:</span> <span class="staexp">g0float_aop_type</span><span class="keyword">(</span><span class="staexp">dblknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0float_div_double
  <span class="keyword">:</span> <span class="staexp">g0float_aop_type</span><span class="keyword">(</span><span class="staexp">dblknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0float_mod_double
  <span class="keyword">:</span> <span class="staexp">g0float_aop_type</span><span class="keyword">(</span><span class="staexp">dblknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>

<span class="dynexp"><span class="keyword">fun</span> g0float_lt_double
  <span class="keyword">:</span> <span class="staexp">g0float_cmp_type</span><span class="keyword">(</span><span class="staexp">dblknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0float_lte_double
  <span class="keyword">:</span> <span class="staexp">g0float_cmp_type</span><span class="keyword">(</span><span class="staexp">dblknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0float_gt_double
  <span class="keyword">:</span> <span class="staexp">g0float_cmp_type</span><span class="keyword">(</span><span class="staexp">dblknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0float_gte_double
  <span class="keyword">:</span> <span class="staexp">g0float_cmp_type</span><span class="keyword">(</span><span class="staexp">dblknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0float_eq_double
  <span class="keyword">:</span> <span class="staexp">g0float_cmp_type</span><span class="keyword">(</span><span class="staexp">dblknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0float_neq_double
  <span class="keyword">:</span> <span class="staexp">g0float_cmp_type</span><span class="keyword">(</span><span class="staexp">dblknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>

<span class="dynexp"><span class="keyword">fun</span> g0float_compare_double
  <span class="keyword">:</span> <span class="staexp">g0float_compare_type</span><span class="keyword">(</span><span class="staexp">dblknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>

<span class="dynexp"><span class="keyword">fun</span> g0float_max_double
  <span class="keyword">:</span> <span class="staexp">g0float_aop_type</span><span class="keyword">(</span><span class="staexp">dblknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0float_min_double
  <span class="keyword">:</span> <span class="staexp">g0float_aop_type</span><span class="keyword">(</span><span class="staexp">dblknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span> g0float_neg_ldouble
  <span class="keyword">:</span> <span class="staexp">g0float_uop_type</span><span class="keyword">(</span><span class="staexp">ldblknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0float_abs_ldouble
  <span class="keyword">:</span> <span class="staexp">g0float_uop_type</span><span class="keyword">(</span><span class="staexp">ldblknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>

<span class="dynexp"><span class="keyword">fun</span> g0float_succ_ldouble
  <span class="keyword">:</span> <span class="staexp">g0float_uop_type</span><span class="keyword">(</span><span class="staexp">ldblknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0float_pred_ldouble
  <span class="keyword">:</span> <span class="staexp">g0float_uop_type</span><span class="keyword">(</span><span class="staexp">ldblknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>

<span class="dynexp"><span class="keyword">fun</span> g0float_add_ldouble
  <span class="keyword">:</span> <span class="staexp">g0float_aop_type</span><span class="keyword">(</span><span class="staexp">ldblknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0float_sub_ldouble
  <span class="keyword">:</span> <span class="staexp">g0float_aop_type</span><span class="keyword">(</span><span class="staexp">ldblknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0float_mul_ldouble
  <span class="keyword">:</span> <span class="staexp">g0float_aop_type</span><span class="keyword">(</span><span class="staexp">ldblknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0float_div_ldouble
  <span class="keyword">:</span> <span class="staexp">g0float_aop_type</span><span class="keyword">(</span><span class="staexp">ldblknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0float_mod_ldouble
  <span class="keyword">:</span> <span class="staexp">g0float_aop_type</span><span class="keyword">(</span><span class="staexp">ldblknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>

<span class="dynexp"><span class="keyword">fun</span> g0float_lt_ldouble
  <span class="keyword">:</span> <span class="staexp">g0float_cmp_type</span><span class="keyword">(</span><span class="staexp">ldblknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0float_lte_ldouble
  <span class="keyword">:</span> <span class="staexp">g0float_cmp_type</span><span class="keyword">(</span><span class="staexp">ldblknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0float_gt_ldouble
  <span class="keyword">:</span> <span class="staexp">g0float_cmp_type</span><span class="keyword">(</span><span class="staexp">ldblknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0float_gte_ldouble
  <span class="keyword">:</span> <span class="staexp">g0float_cmp_type</span><span class="keyword">(</span><span class="staexp">ldblknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0float_eq_ldouble
  <span class="keyword">:</span> <span class="staexp">g0float_cmp_type</span><span class="keyword">(</span><span class="staexp">ldblknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0float_neq_ldouble
  <span class="keyword">:</span> <span class="staexp">g0float_cmp_type</span><span class="keyword">(</span><span class="staexp">ldblknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>

<span class="dynexp"><span class="keyword">fun</span> g0float_compare_ldouble
  <span class="keyword">:</span> <span class="staexp">g0float_compare_type</span><span class="keyword">(</span><span class="staexp">ldblknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>

<span class="dynexp"><span class="keyword">fun</span> g0float_max_ldouble
  <span class="keyword">:</span> <span class="staexp">g0float_aop_type</span><span class="keyword">(</span><span class="staexp">ldblknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0float_min_ldouble
  <span class="keyword">:</span> <span class="staexp">g0float_aop_type</span><span class="keyword">(</span><span class="staexp">ldblknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> print_float <span class="keyword">(</span><span class="staexp">float</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> prerr_float <span class="keyword">(</span><span class="staexp">float</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> fprint_float <span class="keyword">:</span> <span class="staexp">fprint_type</span> <span class="keyword">(</span><span class="staexp">float</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> print <span class="keyword">with</span> print_float</span>
<span class="dynexp"><span class="keyword">overload</span> prerr <span class="keyword">with</span> prerr_float</span>
<span class="dynexp"><span class="keyword">overload</span> fprint <span class="keyword">with</span> fprint_float</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> print_double <span class="keyword">(</span><span class="staexp">double</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> prerr_double <span class="keyword">(</span><span class="staexp">double</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> fprint_double <span class="keyword">:</span> <span class="staexp">fprint_type</span> <span class="keyword">(</span><span class="staexp">double</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> print <span class="keyword">with</span> print_double</span>
<span class="dynexp"><span class="keyword">overload</span> prerr <span class="keyword">with</span> prerr_double</span>
<span class="dynexp"><span class="keyword">overload</span> fprint <span class="keyword">with</span> fprint_double</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> print_ldouble <span class="keyword">(</span><span class="staexp">ldouble</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> prerr_ldouble <span class="keyword">(</span><span class="staexp">ldouble</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> fprint_ldouble <span class="keyword">:</span> <span class="staexp">fprint_type</span> <span class="keyword">(</span><span class="staexp">ldouble</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> print <span class="keyword">with</span> print_ldouble</span>
<span class="dynexp"><span class="keyword">overload</span> prerr <span class="keyword">with</span> prerr_ldouble</span>
<span class="dynexp"><span class="keyword">overload</span> fprint <span class="keyword">with</span> fprint_ldouble</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
add_int_float
  <span class="keyword">(</span><span class="staexp">int</span><span class="keyword">,</span> <span class="staexp">float</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">float</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span>
add_float_int
  <span class="keyword">(</span><span class="staexp">float</span><span class="keyword">,</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">float</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> + <span class="keyword">with</span> add_int_float <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> + <span class="keyword">with</span> add_float_int <span class="keyword">of</span> 0</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
add_int_double
  <span class="keyword">(</span><span class="staexp">int</span><span class="keyword">,</span> <span class="staexp">double</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">double</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span>
add_double_int
  <span class="keyword">(</span><span class="staexp">double</span><span class="keyword">,</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">double</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> + <span class="keyword">with</span> add_int_double <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> + <span class="keyword">with</span> add_double_int <span class="keyword">of</span> 0</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
sub_int_float
  <span class="keyword">(</span><span class="staexp">int</span><span class="keyword">,</span> <span class="staexp">float</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">float</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span>
sub_float_int
  <span class="keyword">(</span><span class="staexp">float</span><span class="keyword">,</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">float</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> - <span class="keyword">with</span> sub_int_float <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> - <span class="keyword">with</span> sub_float_int <span class="keyword">of</span> 0</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
sub_int_double
  <span class="keyword">(</span><span class="staexp">int</span><span class="keyword">,</span> <span class="staexp">double</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">double</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span>
sub_double_int
  <span class="keyword">(</span><span class="staexp">double</span><span class="keyword">,</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">double</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> - <span class="keyword">with</span> sub_int_double <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> - <span class="keyword">with</span> sub_double_int <span class="keyword">of</span> 0</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
mul_int_float
  <span class="keyword">(</span><span class="staexp">int</span><span class="keyword">,</span> <span class="staexp">float</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">float</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span>
mul_float_int
  <span class="keyword">(</span><span class="staexp">float</span><span class="keyword">,</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">float</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> * <span class="keyword">with</span> mul_int_float <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> * <span class="keyword">with</span> mul_float_int <span class="keyword">of</span> 0</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
mul_int_double
  <span class="keyword">(</span><span class="staexp">int</span><span class="keyword">,</span> <span class="staexp">double</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">double</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span>
mul_double_int
  <span class="keyword">(</span><span class="staexp">double</span><span class="keyword">,</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">double</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> * <span class="keyword">with</span> mul_int_double <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> * <span class="keyword">with</span> mul_double_int <span class="keyword">of</span> 0</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
div_int_float
  <span class="keyword">(</span><span class="staexp">int</span><span class="keyword">,</span> <span class="staexp">float</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">float</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span>
div_float_int
  <span class="keyword">(</span><span class="staexp">float</span><span class="keyword">,</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">float</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> / <span class="keyword">with</span> div_int_float <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> / <span class="keyword">with</span> div_float_int <span class="keyword">of</span> 0</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
div_int_double
  <span class="keyword">(</span><span class="staexp">int</span><span class="keyword">,</span> <span class="staexp">double</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">double</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span>
div_double_int
  <span class="keyword">(</span><span class="staexp">double</span><span class="keyword">,</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">double</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> / <span class="keyword">with</span> div_int_double <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> / <span class="keyword">with</span> div_double_int <span class="keyword">of</span> 0</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
g0float_npow
  <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">g0float</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">intGte</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">g0float</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> ** <span class="keyword">with</span> g0float_npow <span class="keyword">of</span> 0</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">macdef</span> g0i2f <span class="dynexp"><span class="keyword">(</span>x<span class="keyword">)</span></span> <span class="keyword">=</span> g0int2float <span class="keyword">(</span><span class="dynexp"><span class="keyword">,(</span>x<span class="keyword">)</span></span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">macdef</span> g0f2i <span class="dynexp"><span class="keyword">(</span>x<span class="keyword">)</span></span> <span class="keyword">=</span> g0float2int <span class="keyword">(</span><span class="dynexp"><span class="keyword">,(</span>x<span class="keyword">)</span></span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">macdef</span> g0f2f <span class="dynexp"><span class="keyword">(</span>x<span class="keyword">)</span></span> <span class="keyword">=</span> g0float2float <span class="keyword">(</span><span class="dynexp"><span class="keyword">,(</span>x<span class="keyword">)</span></span><span class="keyword">)</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* end of [float.sats] *)</span>
</pre>
<pre class="patsyntax">
<span class="comment">(***********************************************************************)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(*                         Applied Type System                         *)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(***********************************************************************)</span>

<span class="comment">(*
** ATS/Postiats - Unleashing the Potential of Types!
** Copyright (C) 2010-2015 Hongwei Xi, ATS Trustful Software, Inc.
** All rights reserved
**
** ATS is free software;  you can  redistribute it and/or modify it under
** the terms of  the GNU GENERAL PUBLIC LICENSE (GPL) as published by the
** Free Software Foundation; either version 3, or (at  your  option)  any
** later version.
**
** ATS is distributed in the hope that it will be useful, but WITHOUT ANY
** WARRANTY; without  even  the  implied  warranty  of MERCHANTABILITY or
** FITNESS FOR A PARTICULAR PURPOSE.  See the  GNU General Public License
** for more details.
**
** You  should  have  received  a  copy of the GNU General Public License
** along  with  ATS;  see the  file COPYING.  If not, please write to the
** Free Software Foundation,  51 Franklin Street, Fifth Floor, Boston, MA
** 02110-1301, USA.
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
** Source:
** $PATSHOME/prelude/SATS/CODEGEN/string.atxt
** Time of generation: Sat Oct 22 23:15:20 2016
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* Author: Hongwei Xi *)</span>
<span class="comment">(* Authoremail: hwxi AT cs DOT bu DOT edu *)</span>
<span class="comment">(* Start time: September, 2011 *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
** HX: a string is a null-terminated arrayref of characters
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="staexp"><span class="keyword">sortdef</span> tk <span class="keyword">=</span> tkind</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">typedef</span> <span class="staexp">SHR<span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span>type</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">a</span></span> <span class="comment">// for commenting purpose</span>
<span class="keyword">typedef</span> <span class="staexp">NSH<span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span>type</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">a</span></span> <span class="comment">// for commenting purpose</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="keyword">typedef</span>
<span class="staexp">stringLt <span class="keyword">(</span><span class="staexp">n<span class="keyword">:</span>int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>k<span class="keyword">:</span>nat <span class="keyword">|</span> k <span class="keyword">&lt;</span> n<span class="keyword">]</span></span> <span class="staexp">string</span> <span class="keyword">(</span><span class="staexp">k</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span>
<span class="staexp">stringLte <span class="keyword">(</span><span class="staexp">n<span class="keyword">:</span>int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>k<span class="keyword">:</span>nat <span class="keyword">|</span> k &lt;= n<span class="keyword">]</span></span> <span class="staexp">string</span> <span class="keyword">(</span><span class="staexp">k</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">typedef</span>
<span class="staexp">stringGt <span class="keyword">(</span><span class="staexp">n<span class="keyword">:</span>int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>k<span class="keyword">:</span>int <span class="keyword">|</span> k <span class="keyword">&gt;</span> n<span class="keyword">]</span></span> <span class="staexp">string</span> <span class="keyword">(</span><span class="staexp">k</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span>
<span class="staexp">stringGte <span class="keyword">(</span><span class="staexp">n<span class="keyword">:</span>int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>k<span class="keyword">:</span>int <span class="keyword">|</span> k &gt;= n<span class="keyword">]</span></span> <span class="staexp">string</span> <span class="keyword">(</span><span class="staexp">k</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">typedef</span>
<span class="staexp">stringBtw
  <span class="keyword">(</span><span class="staexp">m<span class="keyword">:</span>int</span><span class="keyword">,</span> <span class="staexp">n<span class="keyword">:</span>int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>k<span class="keyword">:</span>int <span class="keyword">|</span> m &lt;= k<span class="keyword">;</span> k <span class="keyword">&lt;</span> n<span class="keyword">]</span></span> <span class="staexp">string</span> <span class="keyword">(</span><span class="staexp">k</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span>
<span class="staexp">stringBtwe
  <span class="keyword">(</span><span class="staexp">m<span class="keyword">:</span>int</span><span class="keyword">,</span> <span class="staexp">n<span class="keyword">:</span>int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>k<span class="keyword">:</span>int <span class="keyword">|</span> m &lt;= k<span class="keyword">;</span> k &lt;= n<span class="keyword">]</span></span> <span class="staexp">string</span> <span class="keyword">(</span><span class="staexp">k</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="keyword">typedef</span> <span class="staexp">stringlst <span class="keyword">=</span> <span class="staexp">List0</span><span class="keyword">(</span><span class="staexp">string</span><span class="keyword">)</span></span>
<span class="keyword">vtypedef</span> <span class="staexp">stringlst_vt <span class="keyword">=</span> <span class="staexp">List0_vt</span><span class="keyword">(</span><span class="staexp">string</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="keyword">typedef</span> <span class="staexp">stringopt <span class="keyword">=</span> <span class="staexp">Option</span><span class="keyword">(</span><span class="staexp">string</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">dataprop</span>
<span class="staexp">string_index_p
<span class="keyword">(</span>
  n<span class="keyword">:</span> int<span class="keyword">,</span> int<span class="comment">(*i*)</span><span class="keyword">,</span> int<span class="comment">(*c*)</span>
<span class="keyword">)</span> <span class="keyword">=</span>
  <span class="keyword">|</span> <span class="prfexp">string_index_p_eqz <span class="keyword">(</span><span class="staexp">n</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">,</span> <span class="staexp">0</span><span class="keyword">)</span></span>
  <span class="keyword">|</span> <span class="prfexp"><span class="staexp"><span class="keyword">{</span>i<span class="keyword">:</span>int <span class="keyword">|</span> n <span class="keyword">&gt;</span> i<span class="keyword">}</span></span>
    <span class="staexp"><span class="keyword">{</span>c<span class="keyword">:</span>int8 <span class="keyword">|</span> c != 0<span class="keyword">}</span></span>
    string_index_p_neqz <span class="keyword">(</span><span class="staexp">n</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">,</span> <span class="staexp">c</span><span class="keyword">)</span></span></span>
<span class="comment">// end of [string_index_p]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">exception</span> <span class="dynexp">StringSubscriptExn <span class="keyword">of</span> <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span></span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">praxi</span>
lemma_string_param<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span><span class="keyword">(</span><span class="staexp">string</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><span class="keyword">[</span>n &gt;= 0<span class="keyword">]</span></span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">castfn</span>
string2ptr <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">string</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">Ptr1</span></span>
<span class="dynexp"><span class="keyword">overload</span> ptrcast <span class="keyword">with</span> string2ptr</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">// HX: [string2string] = [string1_of_string0]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">castfn</span> g0ofg1_string <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">String</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">string</span></span>
<span class="dynexp"><span class="keyword">castfn</span> g1ofg0_string <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">string</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">String0</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> g0ofg1 <span class="keyword">with</span> g0ofg1_string</span> <span class="comment">// index-erasing</span>
<span class="dynexp"><span class="keyword">overload</span> g1ofg0 <span class="keyword">with</span> g1ofg0_string</span> <span class="comment">// index-inducing</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
string_char <span class="keyword">(</span>str<span class="keyword">:</span> <span class="staexp">string</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">char</span></span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
string_nil <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">strnptr</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
string_sing <span class="keyword">(</span>chr<span class="keyword">:</span> <span class="staexp">charNZ</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">strnptr</span><span class="keyword">(</span><span class="staexp">1</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
<span class="keyword">}</span></span> string_is_empty<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span> <span class="keyword">(</span>str<span class="keyword">:</span> <span class="staexp">string</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span><span class="keyword">(</span><span class="staexp">n</span><span class="staexp">==</span><span class="staexp">0</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
<span class="keyword">}</span></span> string_isnot_empty<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span> <span class="keyword">(</span>str<span class="keyword">:</span> <span class="staexp">string</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span><span class="keyword">(</span><span class="staexp">n</span> <span class="staexp"><span class="keyword">&gt;</span></span> <span class="staexp">0</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
string_is_atend_size
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>i<span class="keyword">:</span>nat <span class="keyword">|</span> i &lt;= n<span class="keyword">}</span></span>
  <span class="keyword">(</span>s<span class="keyword">:</span> <span class="staexp">string</span> <span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="keyword">(</span><span class="staexp">i</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">(</span><span class="staexp">i</span><span class="staexp">==</span><span class="staexp">n</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
string_is_atend_gint
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>i<span class="keyword">:</span>nat <span class="keyword">|</span> i &lt;= n<span class="keyword">}</span></span>
  <span class="keyword">(</span>s<span class="keyword">:</span> <span class="staexp">string</span> <span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">g1int</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">(</span><span class="staexp">i</span><span class="staexp">==</span><span class="staexp">n</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
string_is_atend_guint
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>i<span class="keyword">:</span>nat <span class="keyword">|</span> i &lt;= n<span class="keyword">}</span></span>
  <span class="keyword">(</span>s<span class="keyword">:</span> <span class="staexp">string</span> <span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">g1uint</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">(</span><span class="staexp">i</span><span class="staexp">==</span><span class="staexp">n</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="neuexp"><span class="keyword">symintr</span> string_is_atend</span>
<span class="dynexp"><span class="keyword">overload</span> string_is_atend <span class="keyword">with</span> string_is_atend_gint</span>
<span class="dynexp"><span class="keyword">overload</span> string_is_atend <span class="keyword">with</span> string_is_atend_guint</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">macdef</span>
string_isnot_atend
  <span class="dynexp"><span class="keyword">(</span>string<span class="keyword">,</span> index<span class="keyword">)</span></span> <span class="keyword">=</span> <span class="keyword">~</span>string_is_atend <span class="keyword">(</span><span class="dynexp"><span class="keyword">,(</span>string<span class="keyword">)</span></span><span class="keyword">,</span> <span class="dynexp"><span class="keyword">,(</span>index<span class="keyword">)</span></span><span class="keyword">)</span></span>
<span class="comment">// end of [string_isnot_atend]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
string_head<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>pos<span class="keyword">}</span></span> <span class="keyword">(</span>str<span class="keyword">:</span> <span class="staexp">string</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">charNZ</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
string_tail<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>pos<span class="keyword">}</span></span> <span class="keyword">(</span>str<span class="keyword">:</span> <span class="staexp">string</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">string</span><span class="keyword">(</span><span class="staexp">n</span><span class="staexp">-</span><span class="staexp">1</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
string_get_at_size
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>i<span class="keyword">:</span>nat <span class="keyword">|</span> i <span class="keyword">&lt;</span> n<span class="keyword">}</span></span>
  <span class="keyword">(</span>s<span class="keyword">:</span> <span class="staexp">string</span> <span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="keyword">(</span><span class="staexp">i</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">charNZ</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
string_get_at_gint
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>i<span class="keyword">:</span>nat <span class="keyword">|</span> i <span class="keyword">&lt;</span> n<span class="keyword">}</span></span>
  <span class="keyword">(</span>s<span class="keyword">:</span> <span class="staexp">string</span> <span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">g1int</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">charNZ</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
string_get_at_guint
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>i<span class="keyword">:</span>nat <span class="keyword">|</span> i <span class="keyword">&lt;</span> n<span class="keyword">}</span></span>
  <span class="keyword">(</span>s<span class="keyword">:</span> <span class="staexp">string</span> <span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">g1uint</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">charNZ</span></span>
<span class="comment">//</span>
<span class="neuexp"><span class="keyword">symintr</span> string_get_at</span>
<span class="dynexp"><span class="keyword">overload</span> string_get_at <span class="keyword">with</span> string_get_at_size <span class="keyword">of</span> 1</span>
<span class="dynexp"><span class="keyword">overload</span> string_get_at <span class="keyword">with</span> string_get_at_gint <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> string_get_at <span class="keyword">with</span> string_get_at_guint <span class="keyword">of</span> 0</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
string_test_at_size
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>i<span class="keyword">:</span>nat <span class="keyword">|</span> i &lt;= n<span class="keyword">}</span></span>
  <span class="keyword">(</span>s<span class="keyword">:</span> <span class="staexp">string</span> <span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="keyword">(</span><span class="staexp">i</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp"><span class="keyword">[</span>c<span class="keyword">:</span>int<span class="keyword">]</span></span> <span class="keyword">(</span><span class="staexp">string_index_p</span> <span class="keyword">(</span><span class="staexp">n</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">,</span> <span class="staexp">c</span><span class="keyword">)</span> <span class="keyword">|</span> <span class="staexp">char</span> <span class="keyword">(</span><span class="staexp">c</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
string_test_at_gint
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>i<span class="keyword">:</span>nat <span class="keyword">|</span> i &lt;= n<span class="keyword">}</span></span>
  <span class="keyword">(</span>s<span class="keyword">:</span> <span class="staexp">string</span> <span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">g1int</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp"><span class="keyword">[</span>c<span class="keyword">:</span>int<span class="keyword">]</span></span> <span class="keyword">(</span><span class="staexp">string_index_p</span> <span class="keyword">(</span><span class="staexp">n</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">,</span> <span class="staexp">c</span><span class="keyword">)</span> <span class="keyword">|</span> <span class="staexp">char</span> <span class="keyword">(</span><span class="staexp">c</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
string_test_at_guint
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>i<span class="keyword">:</span>nat <span class="keyword">|</span> i &lt;= n<span class="keyword">}</span></span>
  <span class="keyword">(</span>s<span class="keyword">:</span> <span class="staexp">string</span> <span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">g1uint</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp"><span class="keyword">[</span>c<span class="keyword">:</span>int<span class="keyword">]</span></span> <span class="keyword">(</span><span class="staexp">string_index_p</span> <span class="keyword">(</span><span class="staexp">n</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">,</span> <span class="staexp">c</span><span class="keyword">)</span> <span class="keyword">|</span> <span class="staexp">char</span> <span class="keyword">(</span><span class="staexp">c</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="neuexp"><span class="keyword">symintr</span> string_test_at</span>
<span class="dynexp"><span class="keyword">overload</span> string_test_at <span class="keyword">with</span> string_test_at_size <span class="keyword">of</span> 1</span>
<span class="dynexp"><span class="keyword">overload</span> string_test_at <span class="keyword">with</span> string_test_at_gint <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> string_test_at <span class="keyword">with</span> string_test_at_guint <span class="keyword">of</span> 0</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span> lt_string_string
  <span class="keyword">(</span>x1<span class="keyword">:</span> <span class="staexp">string</span><span class="keyword">,</span> x2<span class="keyword">:</span> <span class="staexp">string</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">&lt;</span> <span class="keyword">with</span> lt_string_string</span>
<span class="dynexp"><span class="keyword">fun</span> lte_string_string
  <span class="keyword">(</span>x1<span class="keyword">:</span> <span class="staexp">string</span><span class="keyword">,</span> x2<span class="keyword">:</span> <span class="staexp">string</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> &lt;= <span class="keyword">with</span> lte_string_string</span>

<span class="dynexp"><span class="keyword">fun</span> gt_string_string
  <span class="keyword">(</span>x1<span class="keyword">:</span> <span class="staexp">string</span><span class="keyword">,</span> x2<span class="keyword">:</span> <span class="staexp">string</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">&gt;</span> <span class="keyword">with</span> gt_string_string</span>
<span class="dynexp"><span class="keyword">fun</span> gte_string_string
  <span class="keyword">(</span>x1<span class="keyword">:</span> <span class="staexp">string</span><span class="keyword">,</span> x2<span class="keyword">:</span> <span class="staexp">string</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> &gt;= <span class="keyword">with</span> gte_string_string</span>

<span class="dynexp"><span class="keyword">fun</span> eq_string_string
  <span class="keyword">(</span>x1<span class="keyword">:</span> <span class="staexp">string</span><span class="keyword">,</span> x2<span class="keyword">:</span> <span class="staexp">string</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">=</span> <span class="keyword">with</span> eq_string_string</span>
<span class="dynexp"><span class="keyword">fun</span> neq_string_string
  <span class="keyword">(</span>x1<span class="keyword">:</span> <span class="staexp">string</span><span class="keyword">,</span> x2<span class="keyword">:</span> <span class="staexp">string</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> != <span class="keyword">with</span> neq_string_string</span>
<span class="dynexp"><span class="keyword">overload</span> &lt;&gt; <span class="keyword">with</span> neq_string_string</span>

<span class="dynexp"><span class="keyword">fun</span> compare_string_string
  <span class="keyword">(</span>x1<span class="keyword">:</span> <span class="staexp">string</span><span class="keyword">,</span> x2<span class="keyword">:</span> <span class="staexp">string</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">Sgn</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> compare <span class="keyword">with</span> compare_string_string</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
<span class="keyword">}</span></span> strcmp <span class="keyword">(</span>x1<span class="keyword">:</span> <span class="staexp">string</span><span class="keyword">,</span> x2<span class="keyword">:</span> <span class="staexp">string</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int</span></span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
<span class="keyword">}</span></span> strintcmp
  <span class="staexp"><span class="keyword">{</span>n1<span class="keyword">,</span>n2<span class="keyword">:</span>int <span class="keyword">|</span> n2 &gt;=0<span class="keyword">}</span></span>
  <span class="keyword">(</span>x1<span class="keyword">:</span> <span class="staexp">string</span> <span class="staexp">n1</span><span class="keyword">,</span> n2<span class="keyword">:</span> <span class="staexp">int</span> <span class="staexp">n2</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int</span><span class="keyword">(</span><span class="staexp">sgn</span><span class="keyword">(</span><span class="staexp">n1</span><span class="staexp">-</span><span class="staexp">n2</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">// end of [strintcmp]</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
<span class="keyword">}</span></span> strlencmp
  <span class="staexp"><span class="keyword">{</span>n1<span class="keyword">,</span>n2<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>x1<span class="keyword">:</span> <span class="staexp">string</span> <span class="staexp">n1</span><span class="keyword">,</span> x2<span class="keyword">:</span> <span class="staexp">string</span> <span class="staexp">n2</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int</span><span class="keyword">(</span><span class="staexp">sgn</span><span class="keyword">(</span><span class="staexp">n1</span><span class="staexp">-</span><span class="staexp">n2</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">// end of [strlencmp]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
string_make_list
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span> <span class="keyword">(</span>cs<span class="keyword">:</span> <span class="staexp">list</span><span class="keyword">(</span><span class="staexp">charNZ</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">strnptr</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
string_make_listlen
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>cs<span class="keyword">:</span> <span class="staexp">list</span><span class="keyword">(</span><span class="staexp">charNZ</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">strnptr</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
string_make_rlist
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span> <span class="keyword">(</span>cs<span class="keyword">:</span> <span class="staexp">list</span><span class="keyword">(</span><span class="staexp">charNZ</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">strnptr</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span></span>
<span class="comment">// end of [string_make_rlist]</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
string_make_rlistlen
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>cs<span class="keyword">:</span> <span class="staexp">list</span><span class="keyword">(</span><span class="staexp">charNZ</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">strnptr</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span></span>
<span class="comment">// end of [string_make_rlistlen]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
string_make_list_vt
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span> <span class="keyword">(</span>cs<span class="keyword">:</span> <span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">charNZ</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">strnptr</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
string_make_substring
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>st<span class="keyword">,</span>ln<span class="keyword">:</span>nat <span class="keyword">|</span> st+ln &lt;= n<span class="keyword">}</span></span>
  <span class="keyword">(</span>str<span class="keyword">:</span> <span class="staexp">string</span> <span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> st<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="staexp">st</span><span class="keyword">,</span> ln<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="staexp">ln</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">strnptr</span> <span class="keyword">(</span><span class="staexp">ln</span><span class="keyword">)</span></span>
<span class="comment">// end of [string_make_substring]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span> print_string <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">string</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> prerr_string <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">string</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> fprint_string <span class="keyword">(</span>out<span class="keyword">:</span> <span class="staexp">FILEref</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="staexp">string</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> "mac#%"</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> fprint_substring
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>st<span class="keyword">,</span>ln<span class="keyword">:</span>nat <span class="keyword">|</span> st+ln &lt;= n<span class="keyword">}</span></span>
<span class="keyword">(</span>
  out<span class="keyword">:</span> <span class="staexp">FILEref</span><span class="keyword">,</span> str<span class="keyword">:</span> <span class="staexp">string</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> st<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">(</span><span class="staexp">st</span><span class="keyword">)</span><span class="keyword">,</span> ln<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">(</span><span class="staexp">ln</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> "mac#%"</span> <span class="comment">// end of [fprint_substring]</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
strchr<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>str<span class="keyword">:</span> <span class="staexp">string</span> <span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> c0<span class="keyword">:</span> <span class="staexp">char</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">ssizeBtwe</span> <span class="keyword">(</span><span class="staexp"><span class="keyword">~</span></span><span class="staexp">1</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="comment">// end of [strchr]</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
strrchr<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>str<span class="keyword">:</span> <span class="staexp">string</span> <span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> c0<span class="keyword">:</span> <span class="staexp">char</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">ssizeBtwe</span> <span class="keyword">(</span><span class="staexp"><span class="keyword">~</span></span><span class="staexp">1</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="comment">// end of [strrchr]</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
strstr<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>haystack<span class="keyword">:</span> <span class="staexp">string</span> <span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> needle<span class="keyword">:</span> <span class="staexp">string</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">ssizeBtw</span> <span class="keyword">(</span><span class="staexp"><span class="keyword">~</span></span><span class="staexp">1</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="comment">// end of [strstr]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
strspn<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span> <span class="comment">// spanning</span>
  <span class="keyword">(</span>str<span class="keyword">:</span> <span class="staexp">string</span> <span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> accept<span class="keyword">:</span> <span class="staexp">string</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">sizeLte</span> <span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span></span>
<span class="comment">// end of [strspn]</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
strcspn<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span> <span class="comment">// complement spanning</span>
  <span class="keyword">(</span>str<span class="keyword">:</span> <span class="staexp">string</span> <span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> accept<span class="keyword">:</span> <span class="staexp">string</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">sizeLte</span> <span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span></span>
<span class="comment">// end of [strcspn]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
<span class="keyword">}</span></span> string_index<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>str<span class="keyword">:</span> <span class="staexp">string</span> <span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> c0<span class="keyword">:</span> <span class="staexp">charNZ</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">ssizeBtw</span> <span class="keyword">(</span><span class="staexp"><span class="keyword">~</span></span><span class="staexp">1</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="comment">// end of [string_index]</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
<span class="keyword">}</span></span> string_rindex<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>str<span class="keyword">:</span> <span class="staexp">string</span> <span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> c0<span class="keyword">:</span> <span class="staexp">charNZ</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">ssizeBtw</span> <span class="keyword">(</span><span class="staexp"><span class="keyword">~</span></span><span class="staexp">1</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="comment">// end of [string_rindex]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
string0_length
  <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">NSH</span><span class="keyword">(</span><span class="staexp">string</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">size_t</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
string1_length
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span> <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">NSH</span><span class="keyword">(</span><span class="staexp">string</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">size_t</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="neuexp"><span class="keyword">symintr</span> strlen</span>
<span class="neuexp"><span class="keyword">symintr</span> string_length</span>
<span class="dynexp"><span class="keyword">overload</span> strlen <span class="keyword">with</span> string0_length <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> strlen <span class="keyword">with</span> string1_length <span class="keyword">of</span> 10</span>
<span class="dynexp"><span class="keyword">overload</span> string_length <span class="keyword">with</span> string0_length <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> string_length <span class="keyword">with</span> string1_length <span class="keyword">of</span> 10</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
string0_nlength
  <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">NSH</span><span class="keyword">(</span><span class="staexp">string</span><span class="keyword">)</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">size_t</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
string1_nlength
  <span class="staexp"><span class="keyword">{</span>n1<span class="keyword">,</span>n2<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span><span class="staexp">NSH</span><span class="keyword">(</span><span class="staexp">string</span><span class="keyword">(</span><span class="staexp">n1</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">size_t</span><span class="keyword">(</span><span class="staexp">n2</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">size_t</span><span class="keyword">(</span><span class="staexp">min</span><span class="keyword">(</span><span class="staexp">n1</span><span class="keyword">,</span><span class="staexp">n2</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="neuexp"><span class="keyword">symintr</span> string_nlength</span>
<span class="dynexp"><span class="keyword">overload</span> string_nlength <span class="keyword">with</span> string0_nlength <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> string_nlength <span class="keyword">with</span> string1_nlength <span class="keyword">of</span> 10</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
string0_copy
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">NSH</span><span class="keyword">(</span><span class="staexp">string</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">Strptr1</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
string1_copy
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span> <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">NSH</span><span class="keyword">(</span><span class="staexp">string</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">strnptr</span> <span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
string0_append
<span class="keyword">(</span>
  x1<span class="keyword">:</span> <span class="staexp">NSH</span><span class="keyword">(</span><span class="staexp">string</span><span class="keyword">)</span><span class="keyword">,</span> x2<span class="keyword">:</span> <span class="staexp">NSH</span><span class="keyword">(</span><span class="staexp">string</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">Strptr1</span></span> <span class="comment">// end-of-fun</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
string1_append
  <span class="staexp"><span class="keyword">{</span>n1<span class="keyword">,</span>n2<span class="keyword">:</span>int<span class="keyword">}</span></span> <span class="keyword">(</span>
  x1<span class="keyword">:</span> <span class="staexp">NSH</span><span class="keyword">(</span><span class="staexp">string</span><span class="keyword">(</span><span class="staexp">n1</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> x2<span class="keyword">:</span> <span class="staexp">NSH</span><span class="keyword">(</span><span class="staexp">string</span><span class="keyword">(</span><span class="staexp">n2</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">strnptr</span> <span class="keyword">(</span><span class="staexp">n1</span><span class="staexp">+</span><span class="staexp">n2</span><span class="keyword">)</span></span> <span class="comment">// end of [string1_append]</span>
<span class="comment">//</span>
<span class="neuexp"><span class="keyword">symintr</span> string_append</span>
<span class="dynexp"><span class="keyword">overload</span> string_append <span class="keyword">with</span> string0_append <span class="keyword">of</span> 0</span>
<span class="comment">(*
overload string_append with string1_append of 20
*)</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
string0_append3
<span class="keyword">(</span>
  x1<span class="keyword">:</span> <span class="staexp">NSH</span><span class="keyword">(</span><span class="staexp">string</span><span class="keyword">)</span><span class="keyword">,</span> x2<span class="keyword">:</span> <span class="staexp">NSH</span><span class="keyword">(</span><span class="staexp">string</span><span class="keyword">)</span><span class="keyword">,</span> x3<span class="keyword">:</span> <span class="staexp">NSH</span><span class="keyword">(</span><span class="staexp">string</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">Strptr1</span></span> <span class="comment">// end-of-fun</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
string0_append4
<span class="keyword">(</span>
  x1<span class="keyword">:</span> <span class="staexp">NSH</span><span class="keyword">(</span><span class="staexp">string</span><span class="keyword">)</span><span class="keyword">,</span> x2<span class="keyword">:</span> <span class="staexp">NSH</span><span class="keyword">(</span><span class="staexp">string</span><span class="keyword">)</span><span class="keyword">,</span> x3<span class="keyword">:</span> <span class="staexp">NSH</span><span class="keyword">(</span><span class="staexp">string</span><span class="keyword">)</span><span class="keyword">,</span> x4<span class="keyword">:</span> <span class="staexp">NSH</span><span class="keyword">(</span><span class="staexp">string</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">Strptr1</span></span> <span class="comment">// end-of-fun</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
string0_append5
<span class="keyword">(</span>
  x1<span class="keyword">:</span> <span class="staexp">NSH</span><span class="keyword">(</span><span class="staexp">string</span><span class="keyword">)</span><span class="keyword">,</span> x2<span class="keyword">:</span> <span class="staexp">NSH</span><span class="keyword">(</span><span class="staexp">string</span><span class="keyword">)</span><span class="keyword">,</span> x3<span class="keyword">:</span> <span class="staexp">NSH</span><span class="keyword">(</span><span class="staexp">string</span><span class="keyword">)</span><span class="keyword">,</span> x4<span class="keyword">:</span> <span class="staexp">NSH</span><span class="keyword">(</span><span class="staexp">string</span><span class="keyword">)</span><span class="keyword">,</span> x5<span class="keyword">:</span> <span class="staexp">NSH</span><span class="keyword">(</span><span class="staexp">string</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">Strptr1</span></span> <span class="comment">// end-of-fun</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
string0_append6
<span class="keyword">(</span>
  x1<span class="keyword">:</span> <span class="staexp">NSH</span><span class="keyword">(</span><span class="staexp">string</span><span class="keyword">)</span><span class="keyword">,</span> x2<span class="keyword">:</span> <span class="staexp">NSH</span><span class="keyword">(</span><span class="staexp">string</span><span class="keyword">)</span><span class="keyword">,</span> x3<span class="keyword">:</span> <span class="staexp">NSH</span><span class="keyword">(</span><span class="staexp">string</span><span class="keyword">)</span><span class="keyword">,</span> x4<span class="keyword">:</span> <span class="staexp">NSH</span><span class="keyword">(</span><span class="staexp">string</span><span class="keyword">)</span><span class="keyword">,</span> x5<span class="keyword">:</span> <span class="staexp">NSH</span><span class="keyword">(</span><span class="staexp">string</span><span class="keyword">)</span><span class="keyword">,</span> x6<span class="keyword">:</span> <span class="staexp">NSH</span><span class="keyword">(</span><span class="staexp">string</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">Strptr1</span></span> <span class="comment">// end-of-fun</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> string_append <span class="keyword">with</span> string0_append3 <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> string_append <span class="keyword">with</span> string0_append4 <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> string_append <span class="keyword">with</span> string0_append5 <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> string_append <span class="keyword">with</span> string0_append6 <span class="keyword">of</span> 0</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
stringarr_concat<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span><span class="staexp">arrayref</span><span class="keyword">(</span><span class="staexp">string</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">size_t</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">Strptr1</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
stringlst_concat <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">List</span><span class="keyword">(</span><span class="staexp">string</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">Strptr1</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
string_explode
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span> <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">string</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">charNZ</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="comment">// end of [string_explode]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
string_tabulate$fopr <span class="keyword">(</span><span class="staexp">size_t</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">charNZ</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
string_tabulate<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span> <span class="keyword">(</span>n<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">strnptr</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
string_tabulate_cloref<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>n<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> f<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">sizeLt</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloref1</span><span class="keyword">&gt;</span> <span class="staexp">charNZ</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">strnptr</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
string_forall <span class="keyword">(</span>str<span class="keyword">:</span> <span class="staexp">string</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">bool</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
string_forall$pred <span class="keyword">(</span>c<span class="keyword">:</span> <span class="staexp">char</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">bool</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
string_iforall <span class="keyword">(</span>str<span class="keyword">:</span> <span class="staexp">string</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">bool</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
string_iforall$pred <span class="keyword">(</span>i<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> c<span class="keyword">:</span> <span class="staexp">char</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">bool</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>env<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
string_foreach$cont <span class="keyword">(</span>c<span class="keyword">:</span> <span class="staexp">char</span><span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">env</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">bool</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>env<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
string_foreach$fwork <span class="keyword">(</span>c<span class="keyword">:</span> <span class="staexp">char</span><span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="staexp">env</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
<span class="keyword">}</span></span> string_foreach <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span> <span class="keyword">(</span>str<span class="keyword">:</span> <span class="staexp">string</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">sizeLte</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
env<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> string_foreach_env
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span> <span class="keyword">(</span>str<span class="keyword">:</span> <span class="staexp">string</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="staexp">env</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">sizeLte</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span></span>
<span class="comment">// end of [string_foreach_env]</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>env<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
string_rforeach$cont<span class="keyword">(</span>c<span class="keyword">:</span> <span class="staexp">char</span><span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">env</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">bool</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>env<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
string_rforeach$fwork<span class="keyword">(</span>c<span class="keyword">:</span> <span class="staexp">char</span><span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="staexp">env</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
string_rforeach<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span><span class="keyword">(</span>str<span class="keyword">:</span> <span class="staexp">string</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">sizeLte</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
env<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> string_rforeach_env
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span><span class="keyword">(</span>str<span class="keyword">:</span> <span class="staexp">string</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="staexp">env</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">sizeLte</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span></span>
<span class="comment">// end of [string_rforeach_env]</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
streamize_string_char<span class="keyword">(</span><span class="staexp">string</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">charNZ</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
** HX: [stropt_none] is just the null pointer
*)</span>
<span class="dynexp"><span class="keyword">fun</span> stropt_none <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">stropt</span> <span class="keyword">(</span><span class="staexp"><span class="keyword">~</span></span><span class="staexp">1</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">castfn</span> stropt0_some <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">SHR</span><span class="keyword">(</span><span class="staexp">string</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">Stropt1</span></span>
<span class="dynexp"><span class="keyword">castfn</span> stropt1_some <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span> <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">SHR</span><span class="keyword">(</span><span class="staexp">string</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">stropt</span> <span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="neuexp"><span class="keyword">symintr</span> stropt_some</span>
<span class="dynexp"><span class="keyword">overload</span> stropt_some <span class="keyword">with</span> stropt0_some <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> stropt_some <span class="keyword">with</span> stropt1_some <span class="keyword">of</span> 10</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
<span class="keyword">}</span></span> stropt_is_none<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span> <span class="keyword">(</span><span class="staexp">stropt</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">(</span><span class="staexp">n</span> <span class="staexp"><span class="keyword">&lt;</span></span> <span class="staexp">0</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
<span class="keyword">}</span></span> stropt_is_some<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span> <span class="keyword">(</span><span class="staexp">stropt</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">(</span><span class="staexp">n</span> <span class="staexp">&gt;=</span> <span class="staexp">0</span><span class="keyword">)</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">castfn</span>
stropt_unsome<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>nat<span class="keyword">}</span></span><span class="keyword">(</span>opt<span class="keyword">:</span> <span class="staexp">stropt</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">string</span> <span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span></span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
stropt_length<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span><span class="keyword">(</span>opt<span class="keyword">:</span> <span class="staexp">stropt</span> <span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">ssize_t</span> <span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span> print_stropt <span class="keyword">(</span>opt<span class="keyword">:</span> <span class="staexp">Stropt0</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> prerr_stropt <span class="keyword">(</span>opt<span class="keyword">:</span> <span class="staexp">Stropt0</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> fprint_stropt <span class="keyword">(</span>out<span class="keyword">:</span> <span class="staexp">FILEref</span><span class="keyword">,</span> opt<span class="keyword">:</span> <span class="staexp">Stropt0</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> "mac#%"</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">// overloading for certain symbols</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span>
<span class="keyword">[</span><span class="keyword">]</span> <span class="keyword">with</span> string_get_at_size <span class="keyword">of</span> 1</span>
<span class="dynexp"><span class="keyword">overload</span>
<span class="keyword">[</span><span class="keyword">]</span> <span class="keyword">with</span> string_get_at_gint <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span>
<span class="keyword">[</span><span class="keyword">]</span> <span class="keyword">with</span> string_get_at_guint <span class="keyword">of</span> 0</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> iseqz <span class="keyword">with</span> string_is_empty</span>
<span class="dynexp"><span class="keyword">overload</span> isneqz <span class="keyword">with</span> string_isnot_empty</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">.</span>head <span class="keyword">with</span> string_head</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">.</span>tail <span class="keyword">with</span> string_tail</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> length <span class="keyword">with</span> string_length</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> copy <span class="keyword">with</span> string0_copy <span class="keyword">of</span> 0</span>
<span class="comment">(*
//
// HX: too much of a surprise!
//
overload copy with string1_copy of 10
*)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> print <span class="keyword">with</span> print_string <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> prerr <span class="keyword">with</span> prerr_string <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> fprint <span class="keyword">with</span> fprint_string <span class="keyword">of</span> 0</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> iseqz <span class="keyword">with</span> stropt_is_none</span>
<span class="dynexp"><span class="keyword">overload</span> isneqz <span class="keyword">with</span> stropt_is_some</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> length <span class="keyword">with</span> stropt_length</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> print <span class="keyword">with</span> print_stropt <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> prerr <span class="keyword">with</span> prerr_stropt <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> fprint <span class="keyword">with</span> fprint_stropt <span class="keyword">of</span> 0</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* end of [string.sats] *)</span>
</pre>
<pre class="patsyntax">
<span class="comment">(***********************************************************************)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(*                         Applied Type System                         *)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(***********************************************************************)</span>

<span class="comment">(*
** ATS/Postiats - Unleashing the Potential of Types!
** Copyright (C) 2010-2015 Hongwei Xi, ATS Trustful Software, Inc.
** All rights reserved
**
** ATS is free software;  you can  redistribute it and/or modify it under
** the terms of  the GNU GENERAL PUBLIC LICENSE (GPL) as published by the
** Free Software Foundation; either version 3, or (at  your  option)  any
** later version.
**
** ATS is distributed in the hope that it will be useful, but WITHOUT ANY
** WARRANTY; without  even  the  implied  warranty  of MERCHANTABILITY or
** FITNESS FOR A PARTICULAR PURPOSE.  See the  GNU General Public License
** for more details.
**
** You  should  have  received  a  copy of the GNU General Public License
** along  with  ATS;  see the  file COPYING.  If not, please write to the
** Free Software Foundation,  51 Franklin Street, Fifth Floor, Boston, MA
** 02110-1301, USA.
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
** Source:
** $PATSHOME/prelude/SATS/CODEGEN/strptr.atxt
** Time of generation: Sun Oct 23 09:48:51 2016
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* Author: Hongwei Xi *)</span>
<span class="comment">(* Authoremail: hwxi AT cs DOT bu DOT edu *)</span>
<span class="comment">(* Start time: February, 2012 *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
** HX-2012:
** a Strptr0 is either the null-pointer or Strptr1
** a Strptr1 is a null-terminated arrayptr of characters
*)</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">abst@ype</span>
strbuf_t0ype
  <span class="keyword">(</span>m<span class="keyword">:</span>int<span class="keyword">,</span> n<span class="keyword">:</span>int<span class="keyword">)</span></span> <span class="comment">// HX: [m] byte size</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="keyword">stadef</span>
<span class="staexp">strbuf <span class="keyword">=</span> <span class="staexp">strbuf_t0ype</span></span>
<span class="keyword">viewdef</span>
<span class="staexp">strbuf_v
  <span class="keyword">(</span><span class="staexp">l<span class="keyword">:</span>addr</span><span class="keyword">,</span> <span class="staexp">m<span class="keyword">:</span>int</span><span class="keyword">,</span> <span class="staexp">n<span class="keyword">:</span>int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">strbuf</span> <span class="keyword">(</span><span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span> <span class="staexp"><span class="keyword">@</span></span> <span class="staexp">l</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">praxi</span>
strbuf2bytes
  <span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>buf<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">strbuf</span> <span class="keyword">(</span><span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">b0ytes</span> <span class="keyword">(</span><span class="staexp">m</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">praxi</span>
strbuf2bytes_v
  <span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>pf<span class="keyword">:</span> <span class="staexp">strbuf_v</span> <span class="keyword">(</span><span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">b0ytes_v</span> <span class="keyword">(</span><span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="prfexp"><span class="keyword">praxi</span>
lemma_strptr_param
  <span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span> <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">strptr</span> <span class="staexp">l</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><span class="keyword">[</span>l&gt;=null<span class="keyword">]</span></span> <span class="staexp">void</span></span>
<span class="comment">// end of [lemma_strptr_param]</span>

<span class="prfexp"><span class="keyword">praxi</span>
lemma_strnptr_param
  <span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  x<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">strnptr</span> <span class="keyword">(</span><span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp"><span class="keyword">[</span><span class="keyword">(</span>l<span class="keyword">&gt;</span>null&amp;&amp;n&gt;=0<span class="keyword">)</span> || <span class="keyword">(</span>l==null&amp;&amp;n==<span class="keyword">(</span><span class="keyword">~</span>1<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">]</span></span> <span class="staexp">void</span></span>
<span class="comment">// end of [lemma_strnptr_param]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="prfexp"><span class="keyword">praxi</span>
lemma_strbuf_param
  <span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">strbuf</span> <span class="keyword">(</span><span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><span class="keyword">[</span>m<span class="keyword">&gt;</span>n<span class="keyword">]</span></span> <span class="staexp">void</span></span>
<span class="comment">// end of [lemma_strbuf_param]</span>

<span class="prfexp"><span class="keyword">praxi</span>
lemma_strbuf_v_param
  <span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>pf<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">strbuf_v</span> <span class="keyword">(</span><span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><span class="keyword">[</span>l<span class="keyword">&gt;</span>null<span class="keyword">;</span>m<span class="keyword">&gt;</span>n<span class="keyword">]</span></span> <span class="staexp">void</span></span>
<span class="comment">// end of [lemma_strbuf_v_param]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">castfn</span>
strptr2ptr
  <span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span> <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">strptr</span> <span class="staexp">l</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">ptr</span> <span class="keyword">(</span><span class="staexp">l</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">castfn</span>
strnptr2ptr
  <span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span> <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">strnptr</span><span class="keyword">(</span><span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">ptr</span><span class="keyword">(</span><span class="staexp">l</span><span class="keyword">)</span></span>
<span class="comment">// end of [strnptr2ptr]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">castfn</span>
strnptr2strptr
  <span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span> <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">strnptr</span><span class="keyword">(</span><span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">strptr</span><span class="keyword">(</span><span class="staexp">l</span><span class="keyword">)</span></span>
<span class="comment">// end of [strnptr2strptr]</span>

<span class="dynexp"><span class="keyword">castfn</span>
strptr2strnptr
  <span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span> <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">strptr</span><span class="keyword">(</span><span class="staexp">l</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp"><span class="keyword">[</span>n<span class="keyword">:</span>int<span class="keyword">]</span></span> <span class="staexp">strnptr</span><span class="keyword">(</span><span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="comment">// end of [strptr2strnptr]</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">castfn</span>
strptr2stropt
  <span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span>
<span class="keyword">(</span>
  x<span class="keyword">:</span> <span class="staexp">strptr</span> <span class="keyword">(</span><span class="staexp">l</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">&gt;</span>
<span class="staexp"><span class="keyword">[</span>n<span class="keyword">:</span>int
<span class="keyword">|</span><span class="keyword">(</span>l==null&amp;&amp;n <span class="keyword">&lt;</span> 0<span class="keyword">)</span>||<span class="keyword">(</span>l<span class="keyword">&gt;</span>null&amp;&amp;n&gt;=0<span class="keyword">)</span>
<span class="keyword">]</span></span> <span class="staexp">stropt</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">castfn</span>
strptr2stropt0<span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">Strptr0</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">Stropt0</span></span>
<span class="dynexp"><span class="keyword">castfn</span>
stropt2stropt1<span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">Strptr1</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">Stropt1</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">castfn</span>
strnptr2stropt
  <span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">strnptr</span><span class="keyword">(</span><span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">stropt</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">castfn</span>
strptr2string<span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">Strptr1</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">String</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">castfn</span>
strnptr2string
  <span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>nat<span class="keyword">}</span></span><span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">strnptr</span><span class="keyword">(</span><span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">string</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span> strptr_null<span class="keyword">(</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">strptr</span><span class="keyword">(</span><span class="staexp">null</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>

<span class="comment">(* ****** ****** *)</span>

<span class="prfexp"><span class="keyword">praxi</span>
strptr_free_null
  <span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr <span class="keyword">|</span> l &lt;= null<span class="keyword">}</span></span> <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">strptr</span><span class="keyword">(</span><span class="staexp">l</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span>
<span class="comment">// end of [strptr_free_null]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
strptr_is_null
  <span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span> <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">strptr</span> <span class="staexp">l</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">(</span><span class="staexp">l</span><span class="staexp">==</span><span class="staexp">null</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
strptr_isnot_null
  <span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span> <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">strptr</span> <span class="staexp">l</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">(</span><span class="staexp">l</span> <span class="staexp"><span class="keyword">&gt;</span></span> <span class="staexp">null</span><span class="keyword">)</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
strptr_is_empty<span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">Strptr1</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
strptr_isnot_empty<span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">Strptr1</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span></span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
strnptr_is_null
  <span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">strnptr</span><span class="keyword">(</span><span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span><span class="keyword">(</span><span class="staexp">l</span><span class="staexp">==</span><span class="staexp">null</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
strnptr_isnot_null
  <span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">strnptr</span><span class="keyword">(</span><span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span><span class="keyword">(</span><span class="staexp">l</span> <span class="staexp"><span class="keyword">&gt;</span></span> <span class="staexp">null</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span> lt_strptr_strptr
  <span class="keyword">(</span>x1<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">Strptr0</span><span class="keyword">,</span> x2<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">Strptr0</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">&lt;</span> <span class="keyword">with</span> lt_strptr_strptr</span>
<span class="dynexp"><span class="keyword">fun</span> lte_strptr_strptr
  <span class="keyword">(</span>x1<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">Strptr0</span><span class="keyword">,</span> x2<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">Strptr0</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> &lt;= <span class="keyword">with</span> lte_strptr_strptr</span>

<span class="dynexp"><span class="keyword">fun</span> gt_strptr_strptr
  <span class="keyword">(</span>x1<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">Strptr0</span><span class="keyword">,</span> x2<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">Strptr0</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">&gt;</span> <span class="keyword">with</span> gt_strptr_strptr</span>
<span class="dynexp"><span class="keyword">fun</span> gte_strptr_strptr
  <span class="keyword">(</span>x1<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">Strptr0</span><span class="keyword">,</span> x2<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">Strptr0</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> &gt;= <span class="keyword">with</span> gte_strptr_strptr</span>

<span class="dynexp"><span class="keyword">fun</span> eq_strptr_strptr
  <span class="keyword">(</span>x1<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">Strptr0</span><span class="keyword">,</span> x2<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">Strptr0</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">=</span> <span class="keyword">with</span> eq_strptr_strptr</span>
<span class="dynexp"><span class="keyword">fun</span> neq_strptr_strptr
  <span class="keyword">(</span>x1<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">Strptr0</span><span class="keyword">,</span> x2<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">Strptr0</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> != <span class="keyword">with</span> neq_strptr_strptr</span>
<span class="dynexp"><span class="keyword">overload</span> &lt;&gt; <span class="keyword">with</span> neq_strptr_strptr</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> compare_strptr_strptr
  <span class="keyword">(</span>x1<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">Strptr0</span><span class="keyword">,</span> x2<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">Strptr0</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">Sgn</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span> eq_strptr_string
  <span class="keyword">(</span>x1<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">Strptr1</span><span class="keyword">,</span> x2<span class="keyword">:</span> <span class="staexp">string</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">=</span> <span class="keyword">with</span> eq_strptr_string</span>

<span class="dynexp"><span class="keyword">fun</span> neq_strptr_string
  <span class="keyword">(</span>x1<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">Strptr1</span><span class="keyword">,</span> x2<span class="keyword">:</span> <span class="staexp">string</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> != <span class="keyword">with</span> neq_strptr_string</span>
<span class="dynexp"><span class="keyword">overload</span> &lt;&gt; <span class="keyword">with</span> neq_strptr_string</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> compare_strptr_string
  <span class="keyword">(</span>x1<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">Strptr1</span><span class="keyword">,</span> x2<span class="keyword">:</span> <span class="staexp">string</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">Sgn</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span> strptr_free <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">Strptr0</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> strnptr_free <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">Strnptr0</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span> <span class="keyword">=</span> "mac#%"</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
fprint_strptr
<span class="keyword">(</span>
  out<span class="keyword">:</span> <span class="staexp">FILEref</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">Strptr0</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> print_strptr <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">Strptr0</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> prerr_strptr <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">Strptr0</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> print_strbuf
  <span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span> <span class="keyword">(</span>buf<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">strbuf</span><span class="keyword">(</span><span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> prerr_strbuf
  <span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span> <span class="keyword">(</span>buf<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">strbuf</span><span class="keyword">(</span><span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
fprint_strbuf<span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>out<span class="keyword">:</span> <span class="staexp">FILEref</span><span class="keyword">,</span> buf<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">strbuf</span> <span class="keyword">(</span><span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
strnptr_get_at_size <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>str<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">strnptr</span> <span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">sizeLt</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">charNZ</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
strnptr_get_at_gint
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>i<span class="keyword">:</span>nat <span class="keyword">|</span> i <span class="keyword">&lt;</span> n<span class="keyword">}</span></span>
  <span class="keyword">(</span>s<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">strnptr</span> <span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">g1int</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">charNZ</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
strnptr_get_at_guint
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>i<span class="keyword">:</span>nat <span class="keyword">|</span> i <span class="keyword">&lt;</span> n<span class="keyword">}</span></span>
  <span class="keyword">(</span>s<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">strnptr</span> <span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">g1uint</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">charNZ</span></span>
<span class="comment">//</span>
<span class="neuexp"><span class="keyword">symintr</span> strnptr_get_at</span>
<span class="dynexp"><span class="keyword">overload</span> strnptr_get_at <span class="keyword">with</span> strnptr_get_at_size <span class="keyword">of</span> 1</span>
<span class="dynexp"><span class="keyword">overload</span> strnptr_get_at <span class="keyword">with</span> strnptr_get_at_gint <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> strnptr_get_at <span class="keyword">with</span> strnptr_get_at_guint <span class="keyword">of</span> 0</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
strnptr_set_at_size <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>str<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">strnptr</span> <span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">sizeLt</span> <span class="staexp">n</span><span class="keyword">,</span> c<span class="keyword">:</span> <span class="staexp">charNZ</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
strnptr_set_at_gint
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>i<span class="keyword">:</span>nat <span class="keyword">|</span> i <span class="keyword">&lt;</span> n<span class="keyword">}</span></span>
  <span class="keyword">(</span>s<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">strnptr</span> <span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">g1int</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span><span class="keyword">,</span> c<span class="keyword">:</span> <span class="staexp">charNZ</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
strnptr_set_at_guint
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>i<span class="keyword">:</span>nat <span class="keyword">|</span> i <span class="keyword">&lt;</span> n<span class="keyword">}</span></span>
  <span class="keyword">(</span>s<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">strnptr</span> <span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">g1uint</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span><span class="keyword">,</span> c<span class="keyword">:</span> <span class="staexp">charNZ</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="neuexp"><span class="keyword">symintr</span> strnptr_set_at</span>
<span class="dynexp"><span class="keyword">overload</span> strnptr_set_at <span class="keyword">with</span> strnptr_set_at_size <span class="keyword">of</span> 1</span>
<span class="dynexp"><span class="keyword">overload</span> strnptr_set_at <span class="keyword">with</span> strnptr_set_at_gint <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> strnptr_set_at <span class="keyword">with</span> strnptr_set_at_guint <span class="keyword">of</span> 0</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
strptr_length <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">Strptr0</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">ssize_t</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
strnptr_length <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span> <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">strnptr</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">ssize_t</span> <span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span></span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
strptr0_copy <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">Strptr0</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">Strptr0</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
strptr1_copy <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">Strptr1</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">Strptr1</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
strnptr_copy
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span> <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">strnptr</span> <span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">strnptr</span> <span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
strptr_append
  <span class="keyword">(</span>x1<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">Strptr0</span><span class="keyword">,</span> x2<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">Strptr0</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">Strptr0</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
strnptr_append<span class="staexp"><span class="keyword">{</span>n1<span class="keyword">,</span>n2<span class="keyword">:</span>nat<span class="keyword">}</span></span>
  <span class="keyword">(</span>x1<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">strnptr</span> <span class="staexp">n1</span><span class="keyword">,</span> x2<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">strnptr</span> <span class="staexp">n2</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">strnptr</span><span class="keyword">(</span><span class="staexp">n1</span><span class="staexp">+</span><span class="staexp">n2</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
strptrlst_free <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">List_vt</span><span class="keyword">(</span><span class="staexp">Strptr0</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
strptrlst_concat <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">List_vt</span><span class="keyword">(</span><span class="staexp">Strptr0</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">Strptr0</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
env<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> strnptr_foreach$cont <span class="keyword">(</span>c<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">charNZ</span><span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">env</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">bool</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
env<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> strnptr_foreach$fwork <span class="keyword">(</span>c<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">charNZ</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span><span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">env</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
strnptr_foreach <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>nat<span class="keyword">}</span></span> <span class="keyword">(</span>str<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">strnptr</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">sizeLte</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
env<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> strnptr_foreach_env
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>nat<span class="keyword">}</span></span> <span class="keyword">(</span>str<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">strnptr</span> <span class="staexp">n</span><span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="staexp">env</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">sizeLte</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span></span>
<span class="comment">// end of [strnptr_foreach_env]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
env<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> strnptr_rforeach$cont <span class="keyword">(</span>c<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">charNZ</span><span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">env</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">bool</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
env<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> strnptr_rforeach$fwork <span class="keyword">(</span>c<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">charNZ</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span><span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">env</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
strnptr_rforeach <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>nat<span class="keyword">}</span></span> <span class="keyword">(</span>str<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">strnptr</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">sizeLte</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
env<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> strnptr_rforeach_env
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>nat<span class="keyword">}</span></span> <span class="keyword">(</span>str<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">strnptr</span> <span class="staexp">n</span><span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="staexp">env</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">sizeLte</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span></span>
<span class="comment">// end of [strnptr_rforeach_env]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">// overloading for certain symbols</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span>
<span class="keyword">[</span><span class="keyword">]</span> <span class="keyword">with</span> strnptr_get_at_size <span class="keyword">of</span> 1</span>
<span class="dynexp"><span class="keyword">overload</span>
<span class="keyword">[</span><span class="keyword">]</span> <span class="keyword">with</span> strnptr_get_at_gint <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span>
<span class="keyword">[</span><span class="keyword">]</span> <span class="keyword">with</span> strnptr_get_at_guint <span class="keyword">of</span> 0</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span>
<span class="keyword">[</span><span class="keyword">]</span> <span class="keyword">with</span> strnptr_set_at_size <span class="keyword">of</span> 1</span>
<span class="dynexp"><span class="keyword">overload</span>
<span class="keyword">[</span><span class="keyword">]</span> <span class="keyword">with</span> strnptr_set_at_gint <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span>
<span class="keyword">[</span><span class="keyword">]</span> <span class="keyword">with</span> strnptr_set_at_guint <span class="keyword">of</span> 0</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> iseqz <span class="keyword">with</span> strptr_is_null</span>
<span class="dynexp"><span class="keyword">overload</span> iseqz <span class="keyword">with</span> strnptr_is_null</span>
<span class="dynexp"><span class="keyword">overload</span> isneqz <span class="keyword">with</span> strptr_isnot_null</span>
<span class="dynexp"><span class="keyword">overload</span> isneqz <span class="keyword">with</span> strnptr_isnot_null</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span>
compare <span class="keyword">with</span> compare_strptr_strptr</span>
<span class="dynexp"><span class="keyword">overload</span>
compare <span class="keyword">with</span> compare_strptr_string</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> length <span class="keyword">with</span> strptr_length</span>
<span class="dynexp"><span class="keyword">overload</span> length <span class="keyword">with</span> strnptr_length</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> copy <span class="keyword">with</span> strptr0_copy <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> copy <span class="keyword">with</span> strptr1_copy <span class="keyword">of</span> 10</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> free <span class="keyword">with</span> strptr_free</span>
<span class="dynexp"><span class="keyword">overload</span> free <span class="keyword">with</span> strnptr_free</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> print <span class="keyword">with</span> print_strptr</span>
<span class="dynexp"><span class="keyword">overload</span> prerr <span class="keyword">with</span> prerr_strptr</span>
<span class="dynexp"><span class="keyword">overload</span> fprint <span class="keyword">with</span> fprint_strptr</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> print <span class="keyword">with</span> print_strbuf</span>
<span class="dynexp"><span class="keyword">overload</span> prerr <span class="keyword">with</span> prerr_strbuf</span>
<span class="dynexp"><span class="keyword">overload</span> fprint <span class="keyword">with</span> fprint_strbuf</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> ptrcast <span class="keyword">with</span> strptr2ptr</span>
<span class="dynexp"><span class="keyword">overload</span> ptrcast <span class="keyword">with</span> strnptr2ptr</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* end of [strptr.sats] *)</span>
</pre>
<pre class="patsyntax">
<span class="comment">(***********************************************************************)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(*                         Applied Type System                         *)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(***********************************************************************)</span>

<span class="comment">(*
** ATS/Postiats - Unleashing the Potential of Types!
** Copyright (C) 2010-2015 Hongwei Xi, ATS Trustful Software, Inc.
** All rights reserved
**
** ATS is free software;  you can  redistribute it and/or modify it under
** the terms of  the GNU GENERAL PUBLIC LICENSE (GPL) as published by the
** Free Software Foundation; either version 3, or (at  your  option)  any
** later version.
**
** ATS is distributed in the hope that it will be useful, but WITHOUT ANY
** WARRANTY; without  even  the  implied  warranty  of MERCHANTABILITY or
** FITNESS FOR A PARTICULAR PURPOSE.  See the  GNU General Public License
** for more details.
**
** You  should  have  received  a  copy of the GNU General Public License
** along  with  ATS;  see the  file COPYING.  If not, please write to the
** Free Software Foundation,  51 Franklin Street, Fifth Floor, Boston, MA
** 02110-1301, USA.
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* Author: Hongwei Xi *)</span>
<span class="comment">(* Authoremail: gmhwxiATgmailDOTcom *)</span>
<span class="comment">(* Start time: January, 2013 *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
** Source:
** $PATSHOME/prelude/SATS/CODEGEN/integer_ptr.atxt
** Time of generation: Mon Sep  5 21:48:32 2016
*)</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">// HX: for unindexed integer types</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="staexp"><span class="keyword">sortdef</span> tk <span class="keyword">=</span> tkind</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">typedef</span> <span class="staexp">SHR<span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span><span class="keyword">t@ype</span></span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">a</span></span> <span class="comment">// for commenting purpose</span>
<span class="keyword">typedef</span> <span class="staexp">NSH<span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span><span class="keyword">t@ype</span></span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">a</span></span> <span class="comment">// for commenting purpose</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="keyword">stadef</span> <span class="staexp">intptrknd <span class="keyword">=</span> <span class="staexp">intptr_kind</span></span>
<span class="keyword">stadef</span> <span class="staexp">uintptrknd <span class="keyword">=</span> <span class="staexp">uintptr_kind</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> g0int2int_int_intptr<span class="keyword">(</span><span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">intptr</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int2int_int_intptr<span class="staexp"><span class="keyword">{</span>i<span class="keyword">:</span>int<span class="keyword">}</span></span><span class="keyword">(</span><span class="staexp">int</span><span class="keyword">(</span><span class="staexp">i</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">intptr</span><span class="keyword">(</span><span class="staexp">i</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int2int_lint_intptr<span class="keyword">(</span><span class="staexp">lint</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">intptr</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int2int_lint_intptr<span class="staexp"><span class="keyword">{</span>i<span class="keyword">:</span>int<span class="keyword">}</span></span><span class="keyword">(</span><span class="staexp">lint</span><span class="keyword">(</span><span class="staexp">i</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">intptr</span><span class="keyword">(</span><span class="staexp">i</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> g0int2uint_int_uintptr<span class="keyword">(</span><span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uintptr</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int2uint_int_uintptr<span class="staexp"><span class="keyword">{</span>i<span class="keyword">:</span>nat<span class="keyword">}</span></span><span class="keyword">(</span><span class="staexp">int</span><span class="keyword">(</span><span class="staexp">i</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uintptr</span><span class="keyword">(</span><span class="staexp">i</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint2uint_uint_uintptr<span class="keyword">(</span><span class="staexp">uint</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uintptr</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint2uint_uint_uintptr<span class="staexp"><span class="keyword">{</span>u<span class="keyword">:</span>int<span class="keyword">}</span></span><span class="keyword">(</span><span class="staexp">uint</span><span class="keyword">(</span><span class="staexp">u</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uintptr</span><span class="keyword">(</span><span class="staexp">u</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint2uint_ulint_uintptr<span class="keyword">(</span><span class="staexp">ulint</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uintptr</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint2uint_ulint_uintptr<span class="staexp"><span class="keyword">{</span>u<span class="keyword">:</span>int<span class="keyword">}</span></span><span class="keyword">(</span><span class="staexp">ulint</span><span class="keyword">(</span><span class="staexp">u</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uintptr</span><span class="keyword">(</span><span class="staexp">u</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_neg_intptr <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">intptr</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">intptr</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_abs_intptr <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">intptr</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">intptr</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_succ_intptr <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">intptr</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">intptr</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_pred_intptr <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">intptr</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">intptr</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_half_intptr <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">intptr</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">intptr</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_asl_intptr <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">intptr</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">intGte</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">intptr</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_asr_intptr <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">intptr</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">intGte</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">intptr</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_add_intptr <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">intptr</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">intptr</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">intptr</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_sub_intptr <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">intptr</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">intptr</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">intptr</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_mul_intptr <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">intptr</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">intptr</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">intptr</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_div_intptr <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">intptr</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">intptr</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">intptr</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_mod_intptr <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">intptr</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">intptr</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">intptr</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_lt_intptr <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">intptr</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">intptr</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_lte_intptr <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">intptr</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">intptr</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_gt_intptr <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">intptr</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">intptr</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_gte_intptr <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">intptr</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">intptr</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_eq_intptr <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">intptr</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">intptr</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_neq_intptr <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">intptr</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">intptr</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_compare_intptr <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">intptr</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">intptr</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_max_intptr <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">intptr</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">intptr</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">intptr</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_min_intptr <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">intptr</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">intptr</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">intptr</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_isltz_intptr <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">intptr</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_isltez_intptr <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">intptr</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_isgtz_intptr <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">intptr</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_isgtez_intptr <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">intptr</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_iseqz_intptr <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">intptr</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_isneqz_intptr <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">intptr</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> print_intptr <span class="keyword">(</span><span class="staexp">intptr</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> prerr_intptr <span class="keyword">(</span><span class="staexp">intptr</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> fprint_intptr <span class="keyword">:</span> <span class="staexp">fprint_type</span> <span class="keyword">(</span><span class="staexp">intptr</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> print <span class="keyword">with</span> print_intptr</span>
<span class="dynexp"><span class="keyword">overload</span> prerr <span class="keyword">with</span> prerr_intptr</span>
<span class="dynexp"><span class="keyword">overload</span> fprint <span class="keyword">with</span> fprint_intptr</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_succ_uintptr <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uintptr</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uintptr</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_pred_uintptr <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uintptr</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uintptr</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_half_uintptr <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uintptr</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uintptr</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_add_uintptr <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uintptr</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">uintptr</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uintptr</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_sub_uintptr <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uintptr</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">uintptr</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uintptr</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_mul_uintptr <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uintptr</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">uintptr</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uintptr</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_div_uintptr <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uintptr</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">uintptr</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uintptr</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_mod_uintptr <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uintptr</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">uintptr</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uintptr</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_lsl_uintptr <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uintptr</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">intGte</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uintptr</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_lsr_uintptr <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uintptr</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">intGte</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uintptr</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_lnot_uintptr <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uintptr</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uintptr</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_lor_uintptr <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uintptr</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">uintptr</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uintptr</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_lxor_uintptr <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uintptr</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">uintptr</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uintptr</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_land_uintptr <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uintptr</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">uintptr</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uintptr</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_lt_uintptr <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uintptr</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">uintptr</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_lte_uintptr <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uintptr</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">uintptr</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_gt_uintptr <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uintptr</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">uintptr</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_gte_uintptr <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uintptr</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">uintptr</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_eq_uintptr <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uintptr</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">uintptr</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_neq_uintptr <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uintptr</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">uintptr</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_compare_uintptr <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uintptr</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">uintptr</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_max_uintptr <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uintptr</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">uintptr</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uintptr</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_min_uintptr <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uintptr</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">uintptr</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uintptr</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_isgtz_uintptr <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uintptr</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_iseqz_uintptr <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uintptr</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_isneqz_uintptr <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uintptr</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> print_uintptr <span class="keyword">(</span><span class="staexp">uintptr</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> prerr_uintptr <span class="keyword">(</span><span class="staexp">uintptr</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> fprint_uintptr <span class="keyword">:</span> <span class="staexp">fprint_type</span> <span class="keyword">(</span><span class="staexp">uintptr</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> print <span class="keyword">with</span> print_uintptr</span>
<span class="dynexp"><span class="keyword">overload</span> prerr <span class="keyword">with</span> prerr_uintptr</span>
<span class="dynexp"><span class="keyword">overload</span> fprint <span class="keyword">with</span> fprint_uintptr</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_neg_intptr <span class="keyword">:</span> <span class="staexp">g1int_neg_type</span> <span class="keyword">(</span><span class="staexp">intptrknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_abs_intptr <span class="keyword">:</span> <span class="staexp">g1int_abs_type</span> <span class="keyword">(</span><span class="staexp">intptrknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_succ_intptr <span class="keyword">:</span> <span class="staexp">g1int_succ_type</span> <span class="keyword">(</span><span class="staexp">intptrknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_pred_intptr <span class="keyword">:</span> <span class="staexp">g1int_pred_type</span> <span class="keyword">(</span><span class="staexp">intptrknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_half_intptr <span class="keyword">:</span> <span class="staexp">g1int_half_type</span> <span class="keyword">(</span><span class="staexp">intptrknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_add_intptr <span class="keyword">:</span> <span class="staexp">g1int_add_type</span> <span class="keyword">(</span><span class="staexp">intptrknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_sub_intptr <span class="keyword">:</span> <span class="staexp">g1int_sub_type</span> <span class="keyword">(</span><span class="staexp">intptrknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_mul_intptr <span class="keyword">:</span> <span class="staexp">g1int_mul_type</span> <span class="keyword">(</span><span class="staexp">intptrknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_div_intptr <span class="keyword">:</span> <span class="staexp">g1int_div_type</span> <span class="keyword">(</span><span class="staexp">intptrknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_nmod_intptr <span class="keyword">:</span> <span class="staexp">g1int_nmod_type</span> <span class="keyword">(</span><span class="staexp">intptrknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_lt_intptr <span class="keyword">:</span> <span class="staexp">g1int_lt_type</span> <span class="keyword">(</span><span class="staexp">intptrknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_lte_intptr <span class="keyword">:</span> <span class="staexp">g1int_lte_type</span> <span class="keyword">(</span><span class="staexp">intptrknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_gt_intptr <span class="keyword">:</span> <span class="staexp">g1int_gt_type</span> <span class="keyword">(</span><span class="staexp">intptrknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_gte_intptr <span class="keyword">:</span> <span class="staexp">g1int_gte_type</span> <span class="keyword">(</span><span class="staexp">intptrknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_eq_intptr <span class="keyword">:</span> <span class="staexp">g1int_eq_type</span> <span class="keyword">(</span><span class="staexp">intptrknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_neq_intptr <span class="keyword">:</span> <span class="staexp">g1int_neq_type</span> <span class="keyword">(</span><span class="staexp">intptrknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_compare_intptr <span class="keyword">:</span> <span class="staexp">g1int_compare_type</span> <span class="keyword">(</span><span class="staexp">intptrknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_max_intptr <span class="keyword">:</span> <span class="staexp">g1int_max_type</span> <span class="keyword">(</span><span class="staexp">intptrknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_min_intptr <span class="keyword">:</span> <span class="staexp">g1int_min_type</span> <span class="keyword">(</span><span class="staexp">intptrknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_isltz_intptr <span class="keyword">:</span> <span class="staexp">g1int_isltz_type</span> <span class="keyword">(</span><span class="staexp">intptrknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_isltez_intptr <span class="keyword">:</span> <span class="staexp">g1int_isltez_type</span> <span class="keyword">(</span><span class="staexp">intptrknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_isgtz_intptr <span class="keyword">:</span> <span class="staexp">g1int_isgtz_type</span> <span class="keyword">(</span><span class="staexp">intptrknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_isgtez_intptr <span class="keyword">:</span> <span class="staexp">g1int_isgtez_type</span> <span class="keyword">(</span><span class="staexp">intptrknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_iseqz_intptr <span class="keyword">:</span> <span class="staexp">g1int_iseqz_type</span> <span class="keyword">(</span><span class="staexp">intptrknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_isneqz_intptr <span class="keyword">:</span> <span class="staexp">g1int_isneqz_type</span> <span class="keyword">(</span><span class="staexp">intptrknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_succ_uintptr <span class="keyword">:</span> <span class="staexp">g1uint_succ_type</span> <span class="keyword">(</span><span class="staexp">uintptrknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_pred_uintptr <span class="keyword">:</span> <span class="staexp">g1uint_pred_type</span> <span class="keyword">(</span><span class="staexp">uintptrknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_half_uintptr <span class="keyword">:</span> <span class="staexp">g1uint_half_type</span> <span class="keyword">(</span><span class="staexp">uintptrknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_add_uintptr <span class="keyword">:</span> <span class="staexp">g1uint_add_type</span> <span class="keyword">(</span><span class="staexp">uintptrknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_sub_uintptr <span class="keyword">:</span> <span class="staexp">g1uint_sub_type</span> <span class="keyword">(</span><span class="staexp">uintptrknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_mul_uintptr <span class="keyword">:</span> <span class="staexp">g1uint_mul_type</span> <span class="keyword">(</span><span class="staexp">uintptrknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_div_uintptr <span class="keyword">:</span> <span class="staexp">g1uint_div_type</span> <span class="keyword">(</span><span class="staexp">uintptrknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_mod_uintptr <span class="keyword">:</span> <span class="staexp">g1uint_mod_type</span> <span class="keyword">(</span><span class="staexp">uintptrknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_lt_uintptr <span class="keyword">:</span> <span class="staexp">g1uint_lt_type</span> <span class="keyword">(</span><span class="staexp">uintptrknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_lte_uintptr <span class="keyword">:</span> <span class="staexp">g1uint_lte_type</span> <span class="keyword">(</span><span class="staexp">uintptrknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_gt_uintptr <span class="keyword">:</span> <span class="staexp">g1uint_gt_type</span> <span class="keyword">(</span><span class="staexp">uintptrknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_gte_uintptr <span class="keyword">:</span> <span class="staexp">g1uint_gte_type</span> <span class="keyword">(</span><span class="staexp">uintptrknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_eq_uintptr <span class="keyword">:</span> <span class="staexp">g1uint_eq_type</span> <span class="keyword">(</span><span class="staexp">uintptrknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_neq_uintptr <span class="keyword">:</span> <span class="staexp">g1uint_neq_type</span> <span class="keyword">(</span><span class="staexp">uintptrknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_compare_uintptr <span class="keyword">:</span> <span class="staexp">g1uint_compare_type</span> <span class="keyword">(</span><span class="staexp">uintptrknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_max_uintptr <span class="keyword">:</span> <span class="staexp">g1uint_max_type</span> <span class="keyword">(</span><span class="staexp">uintptrknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_min_uintptr <span class="keyword">:</span> <span class="staexp">g1uint_min_type</span> <span class="keyword">(</span><span class="staexp">uintptrknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_isgtz_uintptr <span class="keyword">:</span> <span class="staexp">g1uint_isgtz_type</span> <span class="keyword">(</span><span class="staexp">uintptrknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_iseqz_uintptr <span class="keyword">:</span> <span class="staexp">g1uint_iseqz_type</span> <span class="keyword">(</span><span class="staexp">uintptrknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_isneqz_uintptr <span class="keyword">:</span> <span class="staexp">g1uint_isneqz_type</span> <span class="keyword">(</span><span class="staexp">uintptrknd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">macdef</span> i2ptr <span class="dynexp"><span class="keyword">(</span>x<span class="keyword">)</span></span> <span class="keyword">=</span> g1int2int_int_intptr <span class="keyword">(</span><span class="dynexp"><span class="keyword">,(</span>x<span class="keyword">)</span></span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">macdef</span> u2ptr <span class="dynexp"><span class="keyword">(</span>x<span class="keyword">)</span></span> <span class="keyword">=</span> g1uint2uint_uint_uintptr <span class="keyword">(</span><span class="dynexp"><span class="keyword">,(</span>x<span class="keyword">)</span></span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* end of [integer_ptr.sats] *)</span>
</pre>
<pre class="patsyntax">
<span class="comment">(***********************************************************************)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(*                         Applied Type System                         *)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(***********************************************************************)</span>

<span class="comment">(*
** ATS/Postiats - Unleashing the Potential of Types!
** Copyright (C) 2010-2015 Hongwei Xi, ATS Trustful Software, Inc.
** All rights reserved
**
** ATS is free software;  you can  redistribute it and/or modify it under
** the terms of  the GNU GENERAL PUBLIC LICENSE (GPL) as published by the
** Free Software Foundation; either version 3, or (at  your  option)  any
** later version.
**
** ATS is distributed in the hope that it will be useful, but WITHOUT ANY
** WARRANTY; without  even  the  implied  warranty  of MERCHANTABILITY or
** FITNESS FOR A PARTICULAR PURPOSE.  See the  GNU General Public License
** for more details.
**
** You  should  have  received  a  copy of the GNU General Public License
** along  with  ATS;  see the  file COPYING.  If not, please write to the
** Free Software Foundation,  51 Franklin Street, Fifth Floor, Boston, MA
** 02110-1301, USA.
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* Author: Hongwei Xi *)</span>
<span class="comment">(* Authoremail: gmhwxiATgmailDOTcom *)</span>
<span class="comment">(* Start time: January, 2013 *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
** Source:
** $PATSHOME/prelude/SATS/CODEGEN/integer_fixed.atxt
** Time of generation: Mon Sep  5 21:48:33 2016
*)</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">// HX: for unindexed integer types</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="staexp"><span class="keyword">sortdef</span> tk <span class="keyword">=</span> tkind</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="keyword">stadef</span> <span class="staexp">int8knd <span class="keyword">=</span> <span class="staexp">int8_kind</span></span>
<span class="keyword">stadef</span> <span class="staexp">int16knd <span class="keyword">=</span> <span class="staexp">int16_kind</span></span>
<span class="keyword">stadef</span> <span class="staexp">int32knd <span class="keyword">=</span> <span class="staexp">int32_kind</span></span>
<span class="keyword">stadef</span> <span class="staexp">int64knd <span class="keyword">=</span> <span class="staexp">int64_kind</span></span>
<span class="comment">//</span>
<span class="keyword">stadef</span> <span class="staexp">uint8knd <span class="keyword">=</span> <span class="staexp">uint8_kind</span></span>
<span class="keyword">stadef</span> <span class="staexp">uint16knd <span class="keyword">=</span> <span class="staexp">uint16_kind</span></span>
<span class="keyword">stadef</span> <span class="staexp">uint32knd <span class="keyword">=</span> <span class="staexp">uint32_kind</span></span>
<span class="keyword">stadef</span> <span class="staexp">uint64knd <span class="keyword">=</span> <span class="staexp">uint64_kind</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> g0int2int_int8_int <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int8</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int2int_int16_int <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int16</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int2int_int32_int <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int32</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int2int_int64_int <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int64</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_neg_int8 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int8</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int8</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_abs_int8 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int8</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int8</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_succ_int8 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int8</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int8</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_pred_int8 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int8</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int8</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_half_int8 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int8</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int8</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_asl_int8 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int8</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">intGte</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int8</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_asr_int8 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int8</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">intGte</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int8</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_add_int8 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int8</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">int8</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int8</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_sub_int8 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int8</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">int8</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int8</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_mul_int8 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int8</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">int8</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int8</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_div_int8 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int8</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">int8</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int8</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_mod_int8 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int8</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">int8</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int8</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_lt_int8 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int8</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">int8</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_lte_int8 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int8</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">int8</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_gt_int8 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int8</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">int8</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_gte_int8 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int8</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">int8</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_eq_int8 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int8</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">int8</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_neq_int8 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int8</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">int8</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_compare_int8 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int8</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">int8</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_max_int8 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int8</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">int8</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int8</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_min_int8 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int8</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">int8</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int8</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_isltz_int8 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int8</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_isltez_int8 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int8</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_isgtz_int8 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int8</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_isgtez_int8 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int8</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_iseqz_int8 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int8</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_isneqz_int8 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int8</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_neg_int16 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int16</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int16</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_abs_int16 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int16</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int16</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_succ_int16 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int16</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int16</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_pred_int16 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int16</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int16</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_half_int16 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int16</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int16</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_asl_int16 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int16</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">intGte</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int16</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_asr_int16 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int16</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">intGte</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int16</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_add_int16 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int16</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">int16</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int16</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_sub_int16 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int16</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">int16</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int16</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_mul_int16 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int16</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">int16</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int16</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_div_int16 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int16</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">int16</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int16</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_mod_int16 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int16</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">int16</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int16</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_lt_int16 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int16</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">int16</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_lte_int16 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int16</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">int16</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_gt_int16 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int16</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">int16</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_gte_int16 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int16</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">int16</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_eq_int16 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int16</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">int16</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_neq_int16 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int16</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">int16</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_compare_int16 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int16</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">int16</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_max_int16 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int16</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">int16</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int16</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_min_int16 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int16</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">int16</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int16</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_isltz_int16 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int16</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_isltez_int16 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int16</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_isgtz_int16 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int16</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_isgtez_int16 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int16</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_iseqz_int16 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int16</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_isneqz_int16 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int16</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_neg_int32 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int32</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int32</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_abs_int32 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int32</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int32</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_succ_int32 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int32</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int32</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_pred_int32 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int32</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int32</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_half_int32 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int32</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int32</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_asl_int32 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int32</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">intGte</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int32</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_asr_int32 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int32</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">intGte</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int32</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_add_int32 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int32</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">int32</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int32</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_sub_int32 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int32</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">int32</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int32</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_mul_int32 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int32</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">int32</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int32</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_div_int32 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int32</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">int32</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int32</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_mod_int32 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int32</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">int32</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int32</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_lt_int32 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int32</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">int32</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_lte_int32 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int32</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">int32</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_gt_int32 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int32</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">int32</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_gte_int32 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int32</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">int32</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_eq_int32 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int32</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">int32</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_neq_int32 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int32</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">int32</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_compare_int32 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int32</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">int32</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_max_int32 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int32</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">int32</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int32</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_min_int32 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int32</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">int32</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int32</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_isltz_int32 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int32</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_isltez_int32 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int32</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_isgtz_int32 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int32</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_isgtez_int32 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int32</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_iseqz_int32 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int32</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_isneqz_int32 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int32</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_neg_int64 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int64</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int64</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_abs_int64 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int64</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int64</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_succ_int64 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int64</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int64</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_pred_int64 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int64</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int64</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_half_int64 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int64</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int64</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_asl_int64 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int64</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">intGte</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int64</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_asr_int64 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int64</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">intGte</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int64</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_add_int64 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int64</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">int64</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int64</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_sub_int64 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int64</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">int64</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int64</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_mul_int64 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int64</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">int64</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int64</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_div_int64 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int64</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">int64</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int64</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_mod_int64 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int64</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">int64</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int64</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_lt_int64 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int64</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">int64</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_lte_int64 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int64</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">int64</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_gt_int64 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int64</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">int64</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_gte_int64 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int64</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">int64</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_eq_int64 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int64</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">int64</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_neq_int64 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int64</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">int64</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_compare_int64 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int64</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">int64</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_max_int64 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int64</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">int64</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int64</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_min_int64 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int64</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">int64</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int64</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_isltz_int64 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int64</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_isltez_int64 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int64</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_isgtz_int64 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int64</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_isgtez_int64 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int64</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_iseqz_int64 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int64</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int_isneqz_int64 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int64</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span> print_int8 <span class="keyword">(</span><span class="staexp">int8</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> prerr_int8 <span class="keyword">(</span><span class="staexp">int8</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> fprint_int8 <span class="keyword">:</span> <span class="staexp">fprint_type</span> <span class="keyword">(</span><span class="staexp">int8</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> print <span class="keyword">with</span> print_int8</span>
<span class="dynexp"><span class="keyword">overload</span> prerr <span class="keyword">with</span> prerr_int8</span>
<span class="dynexp"><span class="keyword">overload</span> fprint <span class="keyword">with</span> fprint_int8</span>

<span class="dynexp"><span class="keyword">fun</span> print_int16 <span class="keyword">(</span><span class="staexp">int16</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> prerr_int16 <span class="keyword">(</span><span class="staexp">int16</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> fprint_int16 <span class="keyword">:</span> <span class="staexp">fprint_type</span> <span class="keyword">(</span><span class="staexp">int16</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> print <span class="keyword">with</span> print_int16</span>
<span class="dynexp"><span class="keyword">overload</span> prerr <span class="keyword">with</span> prerr_int16</span>
<span class="dynexp"><span class="keyword">overload</span> fprint <span class="keyword">with</span> fprint_int16</span>

<span class="dynexp"><span class="keyword">fun</span> print_int32 <span class="keyword">(</span><span class="staexp">int32</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> prerr_int32 <span class="keyword">(</span><span class="staexp">int32</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> fprint_int32 <span class="keyword">:</span> <span class="staexp">fprint_type</span> <span class="keyword">(</span><span class="staexp">int32</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> print <span class="keyword">with</span> print_int32</span>
<span class="dynexp"><span class="keyword">overload</span> prerr <span class="keyword">with</span> prerr_int32</span>
<span class="dynexp"><span class="keyword">overload</span> fprint <span class="keyword">with</span> fprint_int32</span>

<span class="dynexp"><span class="keyword">fun</span> print_int64 <span class="keyword">(</span><span class="staexp">int64</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> prerr_int64 <span class="keyword">(</span><span class="staexp">int64</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> fprint_int64 <span class="keyword">:</span> <span class="staexp">fprint_type</span> <span class="keyword">(</span><span class="staexp">int64</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> print <span class="keyword">with</span> print_int64</span>
<span class="dynexp"><span class="keyword">overload</span> prerr <span class="keyword">with</span> prerr_int64</span>
<span class="dynexp"><span class="keyword">overload</span> fprint <span class="keyword">with</span> fprint_int64</span>


<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> g0int2uint_int8_uint <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int8</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uint</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int2uint_int16_uint <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int16</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uint</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int2uint_int32_uint <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int32</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uint</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0int2uint_int64_uint <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int64</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uint</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint2int_uint8_int <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint8</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint2int_uint16_int <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint16</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint2int_uint32_int <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint32</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint2int_uint64_int <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint64</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint2uint_uint8_uint <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint8</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uint</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint2uint_uint16_uint <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint16</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uint</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint2uint_uint32_uint <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint32</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uint</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint2uint_uint64_uint <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint64</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uint</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_succ_uint8 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint8</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uint8</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_pred_uint8 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint8</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uint8</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_half_uint8 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint8</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uint8</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_add_uint8 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint8</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">uint8</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uint8</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_sub_uint8 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint8</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">uint8</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uint8</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_mul_uint8 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint8</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">uint8</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uint8</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_div_uint8 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint8</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">uint8</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uint8</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_mod_uint8 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint8</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">uint8</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uint8</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_lsl_uint8 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint8</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">intGte</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uint8</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_lsr_uint8 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint8</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">intGte</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uint8</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_lnot_uint8 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint8</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uint8</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_lor_uint8 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint8</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">uint8</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uint8</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_lxor_uint8 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint8</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">uint8</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uint8</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_land_uint8 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint8</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">uint8</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uint8</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_lt_uint8 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint8</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">uint8</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_lte_uint8 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint8</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">uint8</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_gt_uint8 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint8</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">uint8</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_gte_uint8 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint8</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">uint8</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_eq_uint8 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint8</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">uint8</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_neq_uint8 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint8</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">uint8</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_compare_uint8 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint8</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">uint8</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_max_uint8 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint8</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">uint8</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uint8</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_min_uint8 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint8</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">uint8</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uint8</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_isgtz_uint8 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint8</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_iseqz_uint8 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint8</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_isneqz_uint8 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint8</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_succ_uint16 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint16</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uint16</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_pred_uint16 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint16</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uint16</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_half_uint16 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint16</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uint16</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_add_uint16 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint16</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">uint16</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uint16</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_sub_uint16 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint16</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">uint16</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uint16</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_mul_uint16 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint16</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">uint16</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uint16</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_div_uint16 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint16</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">uint16</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uint16</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_mod_uint16 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint16</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">uint16</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uint16</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_lsl_uint16 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint16</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">intGte</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uint16</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_lsr_uint16 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint16</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">intGte</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uint16</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_lnot_uint16 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint16</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uint16</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_lor_uint16 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint16</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">uint16</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uint16</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_lxor_uint16 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint16</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">uint16</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uint16</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_land_uint16 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint16</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">uint16</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uint16</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_lt_uint16 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint16</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">uint16</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_lte_uint16 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint16</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">uint16</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_gt_uint16 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint16</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">uint16</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_gte_uint16 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint16</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">uint16</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_eq_uint16 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint16</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">uint16</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_neq_uint16 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint16</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">uint16</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_compare_uint16 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint16</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">uint16</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_max_uint16 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint16</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">uint16</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uint16</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_min_uint16 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint16</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">uint16</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uint16</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_isgtz_uint16 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint16</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_iseqz_uint16 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint16</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_isneqz_uint16 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint16</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_succ_uint32 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint32</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uint32</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_pred_uint32 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint32</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uint32</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_half_uint32 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint32</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uint32</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_add_uint32 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint32</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">uint32</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uint32</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_sub_uint32 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint32</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">uint32</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uint32</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_mul_uint32 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint32</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">uint32</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uint32</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_div_uint32 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint32</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">uint32</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uint32</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_mod_uint32 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint32</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">uint32</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uint32</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_lsl_uint32 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint32</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">intGte</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uint32</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_lsr_uint32 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint32</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">intGte</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uint32</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_lnot_uint32 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint32</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uint32</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_lor_uint32 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint32</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">uint32</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uint32</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_lxor_uint32 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint32</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">uint32</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uint32</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_land_uint32 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint32</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">uint32</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uint32</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_lt_uint32 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint32</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">uint32</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_lte_uint32 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint32</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">uint32</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_gt_uint32 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint32</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">uint32</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_gte_uint32 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint32</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">uint32</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_eq_uint32 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint32</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">uint32</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_neq_uint32 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint32</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">uint32</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_compare_uint32 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint32</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">uint32</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_max_uint32 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint32</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">uint32</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uint32</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_min_uint32 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint32</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">uint32</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uint32</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_isgtz_uint32 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint32</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_iseqz_uint32 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint32</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_isneqz_uint32 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint32</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_succ_uint64 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint64</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uint64</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_pred_uint64 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint64</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uint64</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_half_uint64 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint64</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uint64</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_add_uint64 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint64</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">uint64</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uint64</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_sub_uint64 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint64</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">uint64</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uint64</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_mul_uint64 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint64</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">uint64</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uint64</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_div_uint64 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint64</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">uint64</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uint64</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_mod_uint64 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint64</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">uint64</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uint64</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_lsl_uint64 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint64</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">intGte</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uint64</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_lsr_uint64 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint64</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">intGte</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uint64</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_lnot_uint64 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint64</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uint64</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_lor_uint64 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint64</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">uint64</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uint64</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_lxor_uint64 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint64</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">uint64</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uint64</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_land_uint64 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint64</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">uint64</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uint64</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_lt_uint64 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint64</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">uint64</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_lte_uint64 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint64</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">uint64</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_gt_uint64 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint64</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">uint64</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_gte_uint64 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint64</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">uint64</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_eq_uint64 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint64</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">uint64</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_neq_uint64 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint64</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">uint64</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_compare_uint64 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint64</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">uint64</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_max_uint64 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint64</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">uint64</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uint64</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_min_uint64 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint64</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">uint64</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uint64</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_isgtz_uint64 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint64</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_iseqz_uint64 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint64</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g0uint_isneqz_uint64 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">uint64</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span> print_uint8 <span class="keyword">(</span><span class="staexp">uint8</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> prerr_uint8 <span class="keyword">(</span><span class="staexp">uint8</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> fprint_uint8 <span class="keyword">:</span> <span class="staexp">fprint_type</span> <span class="keyword">(</span><span class="staexp">uint8</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> print <span class="keyword">with</span> print_uint8</span>
<span class="dynexp"><span class="keyword">overload</span> prerr <span class="keyword">with</span> prerr_uint8</span>
<span class="dynexp"><span class="keyword">overload</span> fprint <span class="keyword">with</span> fprint_uint8</span>

<span class="dynexp"><span class="keyword">fun</span> print_uint16 <span class="keyword">(</span><span class="staexp">uint16</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> prerr_uint16 <span class="keyword">(</span><span class="staexp">uint16</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> fprint_uint16 <span class="keyword">:</span> <span class="staexp">fprint_type</span> <span class="keyword">(</span><span class="staexp">uint16</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> print <span class="keyword">with</span> print_uint16</span>
<span class="dynexp"><span class="keyword">overload</span> prerr <span class="keyword">with</span> prerr_uint16</span>
<span class="dynexp"><span class="keyword">overload</span> fprint <span class="keyword">with</span> fprint_uint16</span>

<span class="dynexp"><span class="keyword">fun</span> print_uint32 <span class="keyword">(</span><span class="staexp">uint32</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> prerr_uint32 <span class="keyword">(</span><span class="staexp">uint32</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> fprint_uint32 <span class="keyword">:</span> <span class="staexp">fprint_type</span> <span class="keyword">(</span><span class="staexp">uint32</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> print <span class="keyword">with</span> print_uint32</span>
<span class="dynexp"><span class="keyword">overload</span> prerr <span class="keyword">with</span> prerr_uint32</span>
<span class="dynexp"><span class="keyword">overload</span> fprint <span class="keyword">with</span> fprint_uint32</span>

<span class="dynexp"><span class="keyword">fun</span> print_uint64 <span class="keyword">(</span><span class="staexp">uint64</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> prerr_uint64 <span class="keyword">(</span><span class="staexp">uint64</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> fprint_uint64 <span class="keyword">:</span> <span class="staexp">fprint_type</span> <span class="keyword">(</span><span class="staexp">uint64</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> print <span class="keyword">with</span> print_uint64</span>
<span class="dynexp"><span class="keyword">overload</span> prerr <span class="keyword">with</span> prerr_uint64</span>
<span class="dynexp"><span class="keyword">overload</span> fprint <span class="keyword">with</span> fprint_uint64</span>


<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_neg_int8 <span class="keyword">:</span> <span class="staexp">g1int_neg_type</span> <span class="keyword">(</span><span class="staexp">int8knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_abs_int8 <span class="keyword">:</span> <span class="staexp">g1int_abs_type</span> <span class="keyword">(</span><span class="staexp">int8knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_succ_int8 <span class="keyword">:</span> <span class="staexp">g1int_succ_type</span> <span class="keyword">(</span><span class="staexp">int8knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_pred_int8 <span class="keyword">:</span> <span class="staexp">g1int_pred_type</span> <span class="keyword">(</span><span class="staexp">int8knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_half_int8 <span class="keyword">:</span> <span class="staexp">g1int_half_type</span> <span class="keyword">(</span><span class="staexp">int8knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_add_int8 <span class="keyword">:</span> <span class="staexp">g1int_add_type</span> <span class="keyword">(</span><span class="staexp">int8knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_sub_int8 <span class="keyword">:</span> <span class="staexp">g1int_sub_type</span> <span class="keyword">(</span><span class="staexp">int8knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_mul_int8 <span class="keyword">:</span> <span class="staexp">g1int_mul_type</span> <span class="keyword">(</span><span class="staexp">int8knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_div_int8 <span class="keyword">:</span> <span class="staexp">g1int_div_type</span> <span class="keyword">(</span><span class="staexp">int8knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_nmod_int8 <span class="keyword">:</span> <span class="staexp">g1int_nmod_type</span> <span class="keyword">(</span><span class="staexp">int8knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_lt_int8 <span class="keyword">:</span> <span class="staexp">g1int_lt_type</span> <span class="keyword">(</span><span class="staexp">int8knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_lte_int8 <span class="keyword">:</span> <span class="staexp">g1int_lte_type</span> <span class="keyword">(</span><span class="staexp">int8knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_gt_int8 <span class="keyword">:</span> <span class="staexp">g1int_gt_type</span> <span class="keyword">(</span><span class="staexp">int8knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_gte_int8 <span class="keyword">:</span> <span class="staexp">g1int_gte_type</span> <span class="keyword">(</span><span class="staexp">int8knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_eq_int8 <span class="keyword">:</span> <span class="staexp">g1int_eq_type</span> <span class="keyword">(</span><span class="staexp">int8knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_neq_int8 <span class="keyword">:</span> <span class="staexp">g1int_neq_type</span> <span class="keyword">(</span><span class="staexp">int8knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_compare_int8 <span class="keyword">:</span> <span class="staexp">g1int_compare_type</span> <span class="keyword">(</span><span class="staexp">int8knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_max_int8 <span class="keyword">:</span> <span class="staexp">g1int_max_type</span> <span class="keyword">(</span><span class="staexp">int8knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_min_int8 <span class="keyword">:</span> <span class="staexp">g1int_min_type</span> <span class="keyword">(</span><span class="staexp">int8knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_isltz_int8 <span class="keyword">:</span> <span class="staexp">g1int_isltz_type</span> <span class="keyword">(</span><span class="staexp">int8knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_isltez_int8 <span class="keyword">:</span> <span class="staexp">g1int_isltez_type</span> <span class="keyword">(</span><span class="staexp">int8knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_isgtz_int8 <span class="keyword">:</span> <span class="staexp">g1int_isgtz_type</span> <span class="keyword">(</span><span class="staexp">int8knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_isgtez_int8 <span class="keyword">:</span> <span class="staexp">g1int_isgtez_type</span> <span class="keyword">(</span><span class="staexp">int8knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_iseqz_int8 <span class="keyword">:</span> <span class="staexp">g1int_iseqz_type</span> <span class="keyword">(</span><span class="staexp">int8knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_isneqz_int8 <span class="keyword">:</span> <span class="staexp">g1int_isneqz_type</span> <span class="keyword">(</span><span class="staexp">int8knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_neg_int16 <span class="keyword">:</span> <span class="staexp">g1int_neg_type</span> <span class="keyword">(</span><span class="staexp">int16knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_abs_int16 <span class="keyword">:</span> <span class="staexp">g1int_abs_type</span> <span class="keyword">(</span><span class="staexp">int16knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_succ_int16 <span class="keyword">:</span> <span class="staexp">g1int_succ_type</span> <span class="keyword">(</span><span class="staexp">int16knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_pred_int16 <span class="keyword">:</span> <span class="staexp">g1int_pred_type</span> <span class="keyword">(</span><span class="staexp">int16knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_half_int16 <span class="keyword">:</span> <span class="staexp">g1int_half_type</span> <span class="keyword">(</span><span class="staexp">int16knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_add_int16 <span class="keyword">:</span> <span class="staexp">g1int_add_type</span> <span class="keyword">(</span><span class="staexp">int16knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_sub_int16 <span class="keyword">:</span> <span class="staexp">g1int_sub_type</span> <span class="keyword">(</span><span class="staexp">int16knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_mul_int16 <span class="keyword">:</span> <span class="staexp">g1int_mul_type</span> <span class="keyword">(</span><span class="staexp">int16knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_div_int16 <span class="keyword">:</span> <span class="staexp">g1int_div_type</span> <span class="keyword">(</span><span class="staexp">int16knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_nmod_int16 <span class="keyword">:</span> <span class="staexp">g1int_nmod_type</span> <span class="keyword">(</span><span class="staexp">int16knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_lt_int16 <span class="keyword">:</span> <span class="staexp">g1int_lt_type</span> <span class="keyword">(</span><span class="staexp">int16knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_lte_int16 <span class="keyword">:</span> <span class="staexp">g1int_lte_type</span> <span class="keyword">(</span><span class="staexp">int16knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_gt_int16 <span class="keyword">:</span> <span class="staexp">g1int_gt_type</span> <span class="keyword">(</span><span class="staexp">int16knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_gte_int16 <span class="keyword">:</span> <span class="staexp">g1int_gte_type</span> <span class="keyword">(</span><span class="staexp">int16knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_eq_int16 <span class="keyword">:</span> <span class="staexp">g1int_eq_type</span> <span class="keyword">(</span><span class="staexp">int16knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_neq_int16 <span class="keyword">:</span> <span class="staexp">g1int_neq_type</span> <span class="keyword">(</span><span class="staexp">int16knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_compare_int16 <span class="keyword">:</span> <span class="staexp">g1int_compare_type</span> <span class="keyword">(</span><span class="staexp">int16knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_max_int16 <span class="keyword">:</span> <span class="staexp">g1int_max_type</span> <span class="keyword">(</span><span class="staexp">int16knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_min_int16 <span class="keyword">:</span> <span class="staexp">g1int_min_type</span> <span class="keyword">(</span><span class="staexp">int16knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_isltz_int16 <span class="keyword">:</span> <span class="staexp">g1int_isltz_type</span> <span class="keyword">(</span><span class="staexp">int16knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_isltez_int16 <span class="keyword">:</span> <span class="staexp">g1int_isltez_type</span> <span class="keyword">(</span><span class="staexp">int16knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_isgtz_int16 <span class="keyword">:</span> <span class="staexp">g1int_isgtz_type</span> <span class="keyword">(</span><span class="staexp">int16knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_isgtez_int16 <span class="keyword">:</span> <span class="staexp">g1int_isgtez_type</span> <span class="keyword">(</span><span class="staexp">int16knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_iseqz_int16 <span class="keyword">:</span> <span class="staexp">g1int_iseqz_type</span> <span class="keyword">(</span><span class="staexp">int16knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_isneqz_int16 <span class="keyword">:</span> <span class="staexp">g1int_isneqz_type</span> <span class="keyword">(</span><span class="staexp">int16knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_neg_int32 <span class="keyword">:</span> <span class="staexp">g1int_neg_type</span> <span class="keyword">(</span><span class="staexp">int32knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_abs_int32 <span class="keyword">:</span> <span class="staexp">g1int_abs_type</span> <span class="keyword">(</span><span class="staexp">int32knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_succ_int32 <span class="keyword">:</span> <span class="staexp">g1int_succ_type</span> <span class="keyword">(</span><span class="staexp">int32knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_pred_int32 <span class="keyword">:</span> <span class="staexp">g1int_pred_type</span> <span class="keyword">(</span><span class="staexp">int32knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_half_int32 <span class="keyword">:</span> <span class="staexp">g1int_half_type</span> <span class="keyword">(</span><span class="staexp">int32knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_add_int32 <span class="keyword">:</span> <span class="staexp">g1int_add_type</span> <span class="keyword">(</span><span class="staexp">int32knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_sub_int32 <span class="keyword">:</span> <span class="staexp">g1int_sub_type</span> <span class="keyword">(</span><span class="staexp">int32knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_mul_int32 <span class="keyword">:</span> <span class="staexp">g1int_mul_type</span> <span class="keyword">(</span><span class="staexp">int32knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_div_int32 <span class="keyword">:</span> <span class="staexp">g1int_div_type</span> <span class="keyword">(</span><span class="staexp">int32knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_nmod_int32 <span class="keyword">:</span> <span class="staexp">g1int_nmod_type</span> <span class="keyword">(</span><span class="staexp">int32knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_lt_int32 <span class="keyword">:</span> <span class="staexp">g1int_lt_type</span> <span class="keyword">(</span><span class="staexp">int32knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_lte_int32 <span class="keyword">:</span> <span class="staexp">g1int_lte_type</span> <span class="keyword">(</span><span class="staexp">int32knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_gt_int32 <span class="keyword">:</span> <span class="staexp">g1int_gt_type</span> <span class="keyword">(</span><span class="staexp">int32knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_gte_int32 <span class="keyword">:</span> <span class="staexp">g1int_gte_type</span> <span class="keyword">(</span><span class="staexp">int32knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_eq_int32 <span class="keyword">:</span> <span class="staexp">g1int_eq_type</span> <span class="keyword">(</span><span class="staexp">int32knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_neq_int32 <span class="keyword">:</span> <span class="staexp">g1int_neq_type</span> <span class="keyword">(</span><span class="staexp">int32knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_compare_int32 <span class="keyword">:</span> <span class="staexp">g1int_compare_type</span> <span class="keyword">(</span><span class="staexp">int32knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_max_int32 <span class="keyword">:</span> <span class="staexp">g1int_max_type</span> <span class="keyword">(</span><span class="staexp">int32knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_min_int32 <span class="keyword">:</span> <span class="staexp">g1int_min_type</span> <span class="keyword">(</span><span class="staexp">int32knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_isltz_int32 <span class="keyword">:</span> <span class="staexp">g1int_isltz_type</span> <span class="keyword">(</span><span class="staexp">int32knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_isltez_int32 <span class="keyword">:</span> <span class="staexp">g1int_isltez_type</span> <span class="keyword">(</span><span class="staexp">int32knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_isgtz_int32 <span class="keyword">:</span> <span class="staexp">g1int_isgtz_type</span> <span class="keyword">(</span><span class="staexp">int32knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_isgtez_int32 <span class="keyword">:</span> <span class="staexp">g1int_isgtez_type</span> <span class="keyword">(</span><span class="staexp">int32knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_iseqz_int32 <span class="keyword">:</span> <span class="staexp">g1int_iseqz_type</span> <span class="keyword">(</span><span class="staexp">int32knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_isneqz_int32 <span class="keyword">:</span> <span class="staexp">g1int_isneqz_type</span> <span class="keyword">(</span><span class="staexp">int32knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_neg_int64 <span class="keyword">:</span> <span class="staexp">g1int_neg_type</span> <span class="keyword">(</span><span class="staexp">int64knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_abs_int64 <span class="keyword">:</span> <span class="staexp">g1int_abs_type</span> <span class="keyword">(</span><span class="staexp">int64knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_succ_int64 <span class="keyword">:</span> <span class="staexp">g1int_succ_type</span> <span class="keyword">(</span><span class="staexp">int64knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_pred_int64 <span class="keyword">:</span> <span class="staexp">g1int_pred_type</span> <span class="keyword">(</span><span class="staexp">int64knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_half_int64 <span class="keyword">:</span> <span class="staexp">g1int_half_type</span> <span class="keyword">(</span><span class="staexp">int64knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_add_int64 <span class="keyword">:</span> <span class="staexp">g1int_add_type</span> <span class="keyword">(</span><span class="staexp">int64knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_sub_int64 <span class="keyword">:</span> <span class="staexp">g1int_sub_type</span> <span class="keyword">(</span><span class="staexp">int64knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_mul_int64 <span class="keyword">:</span> <span class="staexp">g1int_mul_type</span> <span class="keyword">(</span><span class="staexp">int64knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_div_int64 <span class="keyword">:</span> <span class="staexp">g1int_div_type</span> <span class="keyword">(</span><span class="staexp">int64knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_nmod_int64 <span class="keyword">:</span> <span class="staexp">g1int_nmod_type</span> <span class="keyword">(</span><span class="staexp">int64knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_lt_int64 <span class="keyword">:</span> <span class="staexp">g1int_lt_type</span> <span class="keyword">(</span><span class="staexp">int64knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_lte_int64 <span class="keyword">:</span> <span class="staexp">g1int_lte_type</span> <span class="keyword">(</span><span class="staexp">int64knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_gt_int64 <span class="keyword">:</span> <span class="staexp">g1int_gt_type</span> <span class="keyword">(</span><span class="staexp">int64knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_gte_int64 <span class="keyword">:</span> <span class="staexp">g1int_gte_type</span> <span class="keyword">(</span><span class="staexp">int64knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_eq_int64 <span class="keyword">:</span> <span class="staexp">g1int_eq_type</span> <span class="keyword">(</span><span class="staexp">int64knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_neq_int64 <span class="keyword">:</span> <span class="staexp">g1int_neq_type</span> <span class="keyword">(</span><span class="staexp">int64knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_compare_int64 <span class="keyword">:</span> <span class="staexp">g1int_compare_type</span> <span class="keyword">(</span><span class="staexp">int64knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_max_int64 <span class="keyword">:</span> <span class="staexp">g1int_max_type</span> <span class="keyword">(</span><span class="staexp">int64knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_min_int64 <span class="keyword">:</span> <span class="staexp">g1int_min_type</span> <span class="keyword">(</span><span class="staexp">int64knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_isltz_int64 <span class="keyword">:</span> <span class="staexp">g1int_isltz_type</span> <span class="keyword">(</span><span class="staexp">int64knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_isltez_int64 <span class="keyword">:</span> <span class="staexp">g1int_isltez_type</span> <span class="keyword">(</span><span class="staexp">int64knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_isgtz_int64 <span class="keyword">:</span> <span class="staexp">g1int_isgtz_type</span> <span class="keyword">(</span><span class="staexp">int64knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_isgtez_int64 <span class="keyword">:</span> <span class="staexp">g1int_isgtez_type</span> <span class="keyword">(</span><span class="staexp">int64knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_iseqz_int64 <span class="keyword">:</span> <span class="staexp">g1int_iseqz_type</span> <span class="keyword">(</span><span class="staexp">int64knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1int_isneqz_int64 <span class="keyword">:</span> <span class="staexp">g1int_isneqz_type</span> <span class="keyword">(</span><span class="staexp">int64knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_succ_uint8 <span class="keyword">:</span> <span class="staexp">g1uint_succ_type</span> <span class="keyword">(</span><span class="staexp">uint8knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_pred_uint8 <span class="keyword">:</span> <span class="staexp">g1uint_pred_type</span> <span class="keyword">(</span><span class="staexp">uint8knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_half_uint8 <span class="keyword">:</span> <span class="staexp">g1uint_half_type</span> <span class="keyword">(</span><span class="staexp">uint8knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_add_uint8 <span class="keyword">:</span> <span class="staexp">g1uint_add_type</span> <span class="keyword">(</span><span class="staexp">uint8knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_sub_uint8 <span class="keyword">:</span> <span class="staexp">g1uint_sub_type</span> <span class="keyword">(</span><span class="staexp">uint8knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_mul_uint8 <span class="keyword">:</span> <span class="staexp">g1uint_mul_type</span> <span class="keyword">(</span><span class="staexp">uint8knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_div_uint8 <span class="keyword">:</span> <span class="staexp">g1uint_div_type</span> <span class="keyword">(</span><span class="staexp">uint8knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_mod_uint8 <span class="keyword">:</span> <span class="staexp">g1uint_mod_type</span> <span class="keyword">(</span><span class="staexp">uint8knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_lt_uint8 <span class="keyword">:</span> <span class="staexp">g1uint_lt_type</span> <span class="keyword">(</span><span class="staexp">uint8knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_lte_uint8 <span class="keyword">:</span> <span class="staexp">g1uint_lte_type</span> <span class="keyword">(</span><span class="staexp">uint8knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_gt_uint8 <span class="keyword">:</span> <span class="staexp">g1uint_gt_type</span> <span class="keyword">(</span><span class="staexp">uint8knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_gte_uint8 <span class="keyword">:</span> <span class="staexp">g1uint_gte_type</span> <span class="keyword">(</span><span class="staexp">uint8knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_eq_uint8 <span class="keyword">:</span> <span class="staexp">g1uint_eq_type</span> <span class="keyword">(</span><span class="staexp">uint8knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_neq_uint8 <span class="keyword">:</span> <span class="staexp">g1uint_neq_type</span> <span class="keyword">(</span><span class="staexp">uint8knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_compare_uint8 <span class="keyword">:</span> <span class="staexp">g1uint_compare_type</span> <span class="keyword">(</span><span class="staexp">uint8knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_max_uint8 <span class="keyword">:</span> <span class="staexp">g1uint_max_type</span> <span class="keyword">(</span><span class="staexp">uint8knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_min_uint8 <span class="keyword">:</span> <span class="staexp">g1uint_min_type</span> <span class="keyword">(</span><span class="staexp">uint8knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_isgtz_uint8 <span class="keyword">:</span> <span class="staexp">g1uint_isgtz_type</span> <span class="keyword">(</span><span class="staexp">uint8knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_iseqz_uint8 <span class="keyword">:</span> <span class="staexp">g1uint_iseqz_type</span> <span class="keyword">(</span><span class="staexp">uint8knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_isneqz_uint8 <span class="keyword">:</span> <span class="staexp">g1uint_isneqz_type</span> <span class="keyword">(</span><span class="staexp">uint8knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_succ_uint16 <span class="keyword">:</span> <span class="staexp">g1uint_succ_type</span> <span class="keyword">(</span><span class="staexp">uint16knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_pred_uint16 <span class="keyword">:</span> <span class="staexp">g1uint_pred_type</span> <span class="keyword">(</span><span class="staexp">uint16knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_half_uint16 <span class="keyword">:</span> <span class="staexp">g1uint_half_type</span> <span class="keyword">(</span><span class="staexp">uint16knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_add_uint16 <span class="keyword">:</span> <span class="staexp">g1uint_add_type</span> <span class="keyword">(</span><span class="staexp">uint16knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_sub_uint16 <span class="keyword">:</span> <span class="staexp">g1uint_sub_type</span> <span class="keyword">(</span><span class="staexp">uint16knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_mul_uint16 <span class="keyword">:</span> <span class="staexp">g1uint_mul_type</span> <span class="keyword">(</span><span class="staexp">uint16knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_div_uint16 <span class="keyword">:</span> <span class="staexp">g1uint_div_type</span> <span class="keyword">(</span><span class="staexp">uint16knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_mod_uint16 <span class="keyword">:</span> <span class="staexp">g1uint_mod_type</span> <span class="keyword">(</span><span class="staexp">uint16knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_lt_uint16 <span class="keyword">:</span> <span class="staexp">g1uint_lt_type</span> <span class="keyword">(</span><span class="staexp">uint16knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_lte_uint16 <span class="keyword">:</span> <span class="staexp">g1uint_lte_type</span> <span class="keyword">(</span><span class="staexp">uint16knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_gt_uint16 <span class="keyword">:</span> <span class="staexp">g1uint_gt_type</span> <span class="keyword">(</span><span class="staexp">uint16knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_gte_uint16 <span class="keyword">:</span> <span class="staexp">g1uint_gte_type</span> <span class="keyword">(</span><span class="staexp">uint16knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_eq_uint16 <span class="keyword">:</span> <span class="staexp">g1uint_eq_type</span> <span class="keyword">(</span><span class="staexp">uint16knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_neq_uint16 <span class="keyword">:</span> <span class="staexp">g1uint_neq_type</span> <span class="keyword">(</span><span class="staexp">uint16knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_compare_uint16 <span class="keyword">:</span> <span class="staexp">g1uint_compare_type</span> <span class="keyword">(</span><span class="staexp">uint16knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_max_uint16 <span class="keyword">:</span> <span class="staexp">g1uint_max_type</span> <span class="keyword">(</span><span class="staexp">uint16knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_min_uint16 <span class="keyword">:</span> <span class="staexp">g1uint_min_type</span> <span class="keyword">(</span><span class="staexp">uint16knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_isgtz_uint16 <span class="keyword">:</span> <span class="staexp">g1uint_isgtz_type</span> <span class="keyword">(</span><span class="staexp">uint16knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_iseqz_uint16 <span class="keyword">:</span> <span class="staexp">g1uint_iseqz_type</span> <span class="keyword">(</span><span class="staexp">uint16knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_isneqz_uint16 <span class="keyword">:</span> <span class="staexp">g1uint_isneqz_type</span> <span class="keyword">(</span><span class="staexp">uint16knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_succ_uint32 <span class="keyword">:</span> <span class="staexp">g1uint_succ_type</span> <span class="keyword">(</span><span class="staexp">uint32knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_pred_uint32 <span class="keyword">:</span> <span class="staexp">g1uint_pred_type</span> <span class="keyword">(</span><span class="staexp">uint32knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_half_uint32 <span class="keyword">:</span> <span class="staexp">g1uint_half_type</span> <span class="keyword">(</span><span class="staexp">uint32knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_add_uint32 <span class="keyword">:</span> <span class="staexp">g1uint_add_type</span> <span class="keyword">(</span><span class="staexp">uint32knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_sub_uint32 <span class="keyword">:</span> <span class="staexp">g1uint_sub_type</span> <span class="keyword">(</span><span class="staexp">uint32knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_mul_uint32 <span class="keyword">:</span> <span class="staexp">g1uint_mul_type</span> <span class="keyword">(</span><span class="staexp">uint32knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_div_uint32 <span class="keyword">:</span> <span class="staexp">g1uint_div_type</span> <span class="keyword">(</span><span class="staexp">uint32knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_mod_uint32 <span class="keyword">:</span> <span class="staexp">g1uint_mod_type</span> <span class="keyword">(</span><span class="staexp">uint32knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_lt_uint32 <span class="keyword">:</span> <span class="staexp">g1uint_lt_type</span> <span class="keyword">(</span><span class="staexp">uint32knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_lte_uint32 <span class="keyword">:</span> <span class="staexp">g1uint_lte_type</span> <span class="keyword">(</span><span class="staexp">uint32knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_gt_uint32 <span class="keyword">:</span> <span class="staexp">g1uint_gt_type</span> <span class="keyword">(</span><span class="staexp">uint32knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_gte_uint32 <span class="keyword">:</span> <span class="staexp">g1uint_gte_type</span> <span class="keyword">(</span><span class="staexp">uint32knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_eq_uint32 <span class="keyword">:</span> <span class="staexp">g1uint_eq_type</span> <span class="keyword">(</span><span class="staexp">uint32knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_neq_uint32 <span class="keyword">:</span> <span class="staexp">g1uint_neq_type</span> <span class="keyword">(</span><span class="staexp">uint32knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_compare_uint32 <span class="keyword">:</span> <span class="staexp">g1uint_compare_type</span> <span class="keyword">(</span><span class="staexp">uint32knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_max_uint32 <span class="keyword">:</span> <span class="staexp">g1uint_max_type</span> <span class="keyword">(</span><span class="staexp">uint32knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_min_uint32 <span class="keyword">:</span> <span class="staexp">g1uint_min_type</span> <span class="keyword">(</span><span class="staexp">uint32knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_isgtz_uint32 <span class="keyword">:</span> <span class="staexp">g1uint_isgtz_type</span> <span class="keyword">(</span><span class="staexp">uint32knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_iseqz_uint32 <span class="keyword">:</span> <span class="staexp">g1uint_iseqz_type</span> <span class="keyword">(</span><span class="staexp">uint32knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_isneqz_uint32 <span class="keyword">:</span> <span class="staexp">g1uint_isneqz_type</span> <span class="keyword">(</span><span class="staexp">uint32knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_succ_uint64 <span class="keyword">:</span> <span class="staexp">g1uint_succ_type</span> <span class="keyword">(</span><span class="staexp">uint64knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_pred_uint64 <span class="keyword">:</span> <span class="staexp">g1uint_pred_type</span> <span class="keyword">(</span><span class="staexp">uint64knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_half_uint64 <span class="keyword">:</span> <span class="staexp">g1uint_half_type</span> <span class="keyword">(</span><span class="staexp">uint64knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_add_uint64 <span class="keyword">:</span> <span class="staexp">g1uint_add_type</span> <span class="keyword">(</span><span class="staexp">uint64knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_sub_uint64 <span class="keyword">:</span> <span class="staexp">g1uint_sub_type</span> <span class="keyword">(</span><span class="staexp">uint64knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_mul_uint64 <span class="keyword">:</span> <span class="staexp">g1uint_mul_type</span> <span class="keyword">(</span><span class="staexp">uint64knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_div_uint64 <span class="keyword">:</span> <span class="staexp">g1uint_div_type</span> <span class="keyword">(</span><span class="staexp">uint64knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_mod_uint64 <span class="keyword">:</span> <span class="staexp">g1uint_mod_type</span> <span class="keyword">(</span><span class="staexp">uint64knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_lt_uint64 <span class="keyword">:</span> <span class="staexp">g1uint_lt_type</span> <span class="keyword">(</span><span class="staexp">uint64knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_lte_uint64 <span class="keyword">:</span> <span class="staexp">g1uint_lte_type</span> <span class="keyword">(</span><span class="staexp">uint64knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_gt_uint64 <span class="keyword">:</span> <span class="staexp">g1uint_gt_type</span> <span class="keyword">(</span><span class="staexp">uint64knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_gte_uint64 <span class="keyword">:</span> <span class="staexp">g1uint_gte_type</span> <span class="keyword">(</span><span class="staexp">uint64knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_eq_uint64 <span class="keyword">:</span> <span class="staexp">g1uint_eq_type</span> <span class="keyword">(</span><span class="staexp">uint64knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_neq_uint64 <span class="keyword">:</span> <span class="staexp">g1uint_neq_type</span> <span class="keyword">(</span><span class="staexp">uint64knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_compare_uint64 <span class="keyword">:</span> <span class="staexp">g1uint_compare_type</span> <span class="keyword">(</span><span class="staexp">uint64knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_max_uint64 <span class="keyword">:</span> <span class="staexp">g1uint_max_type</span> <span class="keyword">(</span><span class="staexp">uint64knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_min_uint64 <span class="keyword">:</span> <span class="staexp">g1uint_min_type</span> <span class="keyword">(</span><span class="staexp">uint64knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_isgtz_uint64 <span class="keyword">:</span> <span class="staexp">g1uint_isgtz_type</span> <span class="keyword">(</span><span class="staexp">uint64knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_iseqz_uint64 <span class="keyword">:</span> <span class="staexp">g1uint_iseqz_type</span> <span class="keyword">(</span><span class="staexp">uint64knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span> g1uint_isneqz_uint64 <span class="keyword">:</span> <span class="staexp">g1uint_isneqz_type</span> <span class="keyword">(</span><span class="staexp">uint64knd</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* end of [integer_fixed.sats] *)</span>
</pre>
<pre class="patsyntax">
<span class="comment">(***********************************************************************)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(*                         Applied Type System                         *)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(***********************************************************************)</span>

<span class="comment">(*
** ATS/Postiats - Unleashing the Potential of Types!
** Copyright (C) 2010-2015 Hongwei Xi, ATS Trustful Software, Inc.
** All rights reserved
**
** ATS is free software;  you can  redistribute it and/or modify it under
** the terms of  the GNU GENERAL PUBLIC LICENSE (GPL) as published by the
** Free Software Foundation; either version 3, or (at  your  option)  any
** later version.
**
** ATS is distributed in the hope that it will be useful, but WITHOUT ANY
** WARRANTY; without  even  the  implied  warranty  of MERCHANTABILITY or
** FITNESS FOR A PARTICULAR PURPOSE.  See the  GNU General Public License
** for more details.
**
** You  should  have  received  a  copy of the GNU General Public License
** along  with  ATS;  see the  file COPYING.  If not, please write to the
** Free Software Foundation,  51 Franklin Street, Fifth Floor, Boston, MA
** 02110-1301, USA.
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
** Source:
** $PATSHOME/prelude/SATS/CODEGEN/unsafe.atxt
** Time of generation: Sun Sep 11 18:59:47 2016
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* Author: Hongwei Xi *)</span>
<span class="comment">(* Authoremail: hwxi AT cs DOT bu DOT edu *)</span>
<span class="comment">(* Start time: April, 2012 *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="neuexp"><span class="keyword">#define</span>
ATS_PACKNAME "ATSLIB.prelude.unsafe"</span>

<span class="comment">(* ****** ****** *)</span>

<span class="staexp"><span class="keyword">sortdef</span> t0p <span class="keyword">=</span> <span class="keyword">t@ype</span> <span class="keyword">and</span> vt0p <span class="keyword">=</span> <span class="keyword">viewt@ype</span></span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">praxi</span>
prop_assert<span class="staexp"><span class="keyword">{</span>b<span class="keyword">:</span>bool<span class="keyword">}</span></span><span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><span class="keyword">[</span>b<span class="keyword">]</span></span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">praxi</span>
proof_assert<span class="staexp"><span class="keyword">{</span>proof<span class="keyword">:</span>prop<span class="keyword">}</span></span><span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">proof</span></span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">praxi</span>
eqint_assert<span class="staexp"><span class="keyword">{</span>i1<span class="keyword">,</span>i2<span class="keyword">:</span>int<span class="keyword">}</span></span><span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">EQINT</span><span class="keyword">(</span><span class="staexp">i1</span><span class="keyword">,</span><span class="staexp">i2</span><span class="keyword">)</span></span>
<span class="prfexp"><span class="keyword">praxi</span>
eqaddr_assert<span class="staexp"><span class="keyword">{</span>l1<span class="keyword">,</span>l2<span class="keyword">:</span>addr<span class="keyword">}</span></span><span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">EQADDR</span><span class="keyword">(</span><span class="staexp">l1</span><span class="keyword">,</span><span class="staexp">l2</span><span class="keyword">)</span></span>
<span class="prfexp"><span class="keyword">praxi</span>
eqbool_assert<span class="staexp"><span class="keyword">{</span>b1<span class="keyword">,</span>b2<span class="keyword">:</span>bool<span class="keyword">}</span></span><span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">EQBOOL</span><span class="keyword">(</span><span class="staexp">b1</span><span class="keyword">,</span><span class="staexp">b2</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">castfn</span>
cast<span class="staexp"><span class="keyword">{</span>to<span class="keyword">:</span>t0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>from<span class="keyword">:</span>t0p<span class="keyword">}</span></span> <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">from</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">to</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">castfn</span>
castvwtp0
  <span class="staexp"><span class="keyword">{</span>to<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>from<span class="keyword">:</span>vt0p<span class="keyword">}</span></span> <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">from</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">to</span></span>
<span class="comment">//</span>
<span class="comment">// HX:</span>
<span class="comment">// [castvwtp1] is mostly used in a situation</span>
<span class="comment">// where a linear value is passed as a read-only value;</span>
<span class="comment">// for instance, casting [strptr] to [string] is often</span>
<span class="comment">// done for treating a linear string as a nonlinear one</span>
<span class="comment">// temporarily.</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">castfn</span>
castvwtp1
  <span class="staexp"><span class="keyword">{</span>to<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>from<span class="keyword">:</span>vt0p<span class="keyword">}</span></span> <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">from</span><span class="keyword">)</span><span class="staexp">&gt;&gt;</span><span class="staexp">from</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">to</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">castfn</span> cast2ptr <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>type<span class="keyword">}</span></span> <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">ptr</span></span>
<span class="dynexp"><span class="keyword">castfn</span> cast2Ptr0 <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>type<span class="keyword">}</span></span> <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">Ptr0</span></span>
<span class="dynexp"><span class="keyword">castfn</span> cast2Ptr1 <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>type<span class="keyword">}</span></span> <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">Ptr1</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">castfn</span> cast2int <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span> <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int</span></span>
<span class="dynexp"><span class="keyword">castfn</span> cast2uint <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span> <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uint</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">castfn</span> cast2lint <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span> <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">lint</span></span>
<span class="dynexp"><span class="keyword">castfn</span> cast2ulint <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span> <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">ulint</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">castfn</span> cast2llint <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span> <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">llint</span></span>
<span class="dynexp"><span class="keyword">castfn</span> cast2ullint <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span> <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">ullint</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">castfn</span> cast2size <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span> <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">size_t</span></span>
<span class="dynexp"><span class="keyword">castfn</span> cast2ssize <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span> <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">ssize_t</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">castfn</span> cast2sint <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span> <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">sint</span></span>
<span class="dynexp"><span class="keyword">castfn</span> cast2usint <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span> <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">usint</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">castfn</span> cast2intptr <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span> <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">intptr</span></span>
<span class="dynexp"><span class="keyword">castfn</span> cast2uintptr <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span> <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">uintptr</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="prfexp"><span class="keyword">praxi</span> cast2void<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="staexp">prf</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">praxi</span> castview0 <span class="staexp"><span class="keyword">{</span>to<span class="keyword">:</span>view<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>from<span class="keyword">:</span>view<span class="keyword">}</span></span> <span class="keyword">(</span>pf<span class="keyword">:</span> <span class="staexp">from</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="staexp">prf</span><span class="keyword">&gt;</span> <span class="staexp">to</span></span>
<span class="prfexp"><span class="keyword">praxi</span> castview1 <span class="staexp"><span class="keyword">{</span>to<span class="keyword">:</span>view<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>from<span class="keyword">:</span>view<span class="keyword">}</span></span> <span class="keyword">(</span>pf<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">from</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="staexp">prf</span><span class="keyword">&gt;</span> <span class="staexp">to</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">praxi</span>
castview2void
  <span class="staexp"><span class="keyword">{</span>to<span class="keyword">:</span>view<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>from<span class="keyword">:</span>view<span class="keyword">}</span></span><span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">from</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">to</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="staexp">prf</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span>
<span class="prfexp"><span class="keyword">praxi</span>
castvwtp2void
  <span class="staexp"><span class="keyword">{</span>to<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>from<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">from</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">to</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="staexp">prf</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">praxi</span>
castview2void_at
  <span class="staexp"><span class="keyword">{</span>to<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>from<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span><span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">from</span><span class="staexp"><span class="keyword">@</span></span><span class="staexp">l</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">to</span><span class="staexp"><span class="keyword">@</span></span><span class="staexp">l</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="staexp">prf</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span> int2ptr <span class="keyword">(</span>i<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">ptr</span> <span class="keyword">and</span> ptr2int <span class="keyword">(</span>p<span class="keyword">:</span> <span class="staexp">ptr</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">int</span></span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">// HX: these are popular ones:</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">castfn</span> list_vt2t
  <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span> <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">list_vt</span> <span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">list</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="comment">// end of [list_vt2t]</span>

<span class="dynexp"><span class="keyword">castfn</span> arrayptr2ref
  <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span> <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">arrayptr</span> <span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">arrayref</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="comment">// end of [arrayptr2ref]</span>

<span class="dynexp"><span class="keyword">castfn</span> strptr2string <span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>agz<span class="keyword">}</span></span> <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">strptr</span> <span class="staexp">l</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">String0</span></span>
<span class="dynexp"><span class="keyword">castfn</span> strptr2stropt <span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span> <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">strptr</span> <span class="staexp">l</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">Stropt0</span></span>
<span class="dynexp"><span class="keyword">castfn</span> strnptr2string <span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>nat<span class="keyword">}</span></span> <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">strnptr</span> <span class="keyword">(</span><span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">string</span> <span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span></span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">// HX: only if you know what you are doing ...</span>
<span class="comment">//</span>
<span class="neuexp"><span class="keyword">symintr</span> ptr_vtake</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">castfn</span>
ptr0_vtake
  <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
<span class="keyword">(</span>
  p0<span class="keyword">:</span> <span class="staexp">ptr</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp"><span class="keyword">[</span>l<span class="keyword">:</span>addr<span class="keyword">]</span></span> <span class="keyword">(</span><span class="staexp">a</span><span class="staexp"><span class="keyword">@</span></span><span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">a</span><span class="staexp"><span class="keyword">@</span></span><span class="staexp">l</span> <span class="keyword">-&lt;</span><span class="staexp">lin</span><span class="keyword">,</span><span class="staexp">prf</span><span class="keyword">&gt;</span> <span class="staexp">void</span> <span class="keyword">|</span> <span class="staexp">ptr</span> <span class="staexp">l</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">castfn</span>
ptr1_vtake
  <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span>
  <span class="keyword">(</span>p0<span class="keyword">:</span> <span class="staexp">ptr</span><span class="keyword">(</span><span class="staexp">l</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="staexp">a</span><span class="staexp"><span class="keyword">@</span></span><span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">a</span><span class="staexp"><span class="keyword">@</span></span><span class="staexp">l</span> <span class="keyword">-&lt;</span><span class="staexp">lin</span><span class="keyword">,</span><span class="staexp">prf</span><span class="keyword">&gt;</span> <span class="staexp">void</span> <span class="keyword">|</span> <span class="staexp">ptr</span> <span class="staexp">l</span><span class="keyword">)</span></span> 
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> ptr_vtake <span class="keyword">with</span> ptr0_vtake <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> ptr_vtake <span class="keyword">with</span> ptr1_vtake <span class="keyword">of</span> 10</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">castfn</span>
ref_vtake<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
  <span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span> <span class="keyword">(</span>r<span class="keyword">:</span> <span class="staexp">ref</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp"><span class="keyword">[</span>l<span class="keyword">:</span>addr<span class="keyword">]</span></span> <span class="keyword">(</span><span class="staexp">a</span><span class="staexp"><span class="keyword">@</span></span><span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">a</span><span class="staexp"><span class="keyword">@</span></span><span class="staexp">l</span> <span class="keyword">-&lt;</span><span class="staexp">lin</span><span class="keyword">,</span><span class="staexp">prf</span><span class="keyword">&gt;</span> <span class="staexp">void</span> <span class="keyword">|</span> <span class="staexp">ptr</span> <span class="staexp">l</span><span class="keyword">)</span></span>
<span class="comment">// end of [ref_vtake]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="prfexp"><span class="keyword">praxi</span>
vtakeout_void <span class="staexp"><span class="keyword">{</span>v<span class="keyword">:</span>view<span class="keyword">}</span></span> <span class="keyword">(</span>pf<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">v</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">vtakeout0</span> <span class="keyword">(</span><span class="staexp">v</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">castfn</span>
vttakeout_void <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span> <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">vttakeout0</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">// HX: only if you know what you are doing ...</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span> ptr0_get <span class="keyword">(</span>p<span class="keyword">:</span> <span class="staexp">ptr</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">a</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span> ptr1_get <span class="keyword">(</span>p<span class="keyword">:</span> <span class="staexp">Ptr1</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">a</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span> ptr0_set <span class="keyword">(</span>p<span class="keyword">:</span> <span class="staexp">ptr</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span> ptr1_set <span class="keyword">(</span>p<span class="keyword">:</span> <span class="staexp">Ptr1</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span> ptr0_exch <span class="keyword">(</span>p<span class="keyword">:</span> <span class="staexp">ptr</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span> ptr1_exch <span class="keyword">(</span>p<span class="keyword">:</span> <span class="staexp">Ptr1</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span> ptr0_intch <span class="keyword">(</span>p1<span class="keyword">:</span> <span class="staexp">ptr</span><span class="keyword">,</span> p2<span class="keyword">:</span> <span class="staexp">ptr</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span> ptr1_intch <span class="keyword">(</span>p1<span class="keyword">:</span> <span class="staexp">Ptr1</span><span class="keyword">,</span> p2<span class="keyword">:</span> <span class="staexp">Ptr1</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
ptr0_getinc<span class="keyword">(</span>p<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">ptr</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">a</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
ptr1_getinc<span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span><span class="keyword">(</span>p<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">ptr</span><span class="keyword">(</span><span class="staexp">l</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">ptr</span><span class="keyword">(</span><span class="staexp">l</span><span class="staexp">+</span><span class="staexp">sizeof</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">a</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
ptr0_setinc<span class="keyword">(</span>p<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">ptr</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
ptr1_setinc<span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span><span class="keyword">(</span>p<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">ptr</span><span class="keyword">(</span><span class="staexp">l</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">ptr</span><span class="keyword">(</span><span class="staexp">l</span><span class="staexp">+</span><span class="staexp">sizeof</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
ptr0_get_at_int <span class="keyword">(</span>p<span class="keyword">:</span> <span class="staexp">ptr</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">a</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
ptr0_set_at_int <span class="keyword">(</span>p<span class="keyword">:</span> <span class="staexp">ptr</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
ptr0_get_at_size <span class="keyword">(</span>p<span class="keyword">:</span> <span class="staexp">ptr</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">a</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
ptr0_set_at_size <span class="keyword">(</span>p<span class="keyword">:</span> <span class="staexp">ptr</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="neuexp"><span class="keyword">symintr</span> ptr0_get_at</span>
<span class="neuexp"><span class="keyword">symintr</span> ptr0_set_at</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> ptr0_get_at <span class="keyword">with</span> ptr0_get_at_int</span>
<span class="dynexp"><span class="keyword">overload</span> ptr0_get_at <span class="keyword">with</span> ptr0_get_at_size</span>
<span class="dynexp"><span class="keyword">overload</span> ptr0_set_at <span class="keyword">with</span> ptr0_set_at_int</span>
<span class="dynexp"><span class="keyword">overload</span> ptr0_set_at <span class="keyword">with</span> ptr0_set_at_size</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">// HX-2012-06:</span>
<span class="comment">// generic ops on numbers: +=, -=, *=, /=, %=</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
ptr0_addby <span class="keyword">(</span>p<span class="keyword">:</span> <span class="staexp">ptr</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span> <span class="comment">// !p += x</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
ptr1_addby <span class="keyword">(</span>p<span class="keyword">:</span> <span class="staexp">Ptr1</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span> <span class="comment">// !p += x</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
ptr0_subby <span class="keyword">(</span>p<span class="keyword">:</span> <span class="staexp">ptr</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span> <span class="comment">// !p -= x</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
ptr1_subby <span class="keyword">(</span>p<span class="keyword">:</span> <span class="staexp">Ptr1</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span> <span class="comment">// !p -= x</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
ptr0_mulby <span class="keyword">(</span>p<span class="keyword">:</span> <span class="staexp">ptr</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span> <span class="comment">// !p *= x</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
ptr1_mulby <span class="keyword">(</span>p<span class="keyword">:</span> <span class="staexp">Ptr1</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span> <span class="comment">// !p *= x</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
ptr0_divby <span class="keyword">(</span>p<span class="keyword">:</span> <span class="staexp">ptr</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">exnwrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span> <span class="comment">// !p /= x</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
ptr1_divby <span class="keyword">(</span>p<span class="keyword">:</span> <span class="staexp">Ptr1</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">exnwrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span> <span class="comment">// !p /= x</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
ptr0_modby <span class="keyword">(</span>p<span class="keyword">:</span> <span class="staexp">ptr</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">exnwrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span> <span class="comment">// !p %= x</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
ptr1_modby <span class="keyword">(</span>p<span class="keyword">:</span> <span class="staexp">Ptr1</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">exnwrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span> <span class="comment">// !p %= x</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
ptr1_list_next<span class="keyword">(</span>p<span class="keyword">:</span> <span class="staexp">Ptr1</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">Ptr0</span></span> <span class="comment">// HX: &amp;(p-&gt;next)</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">// HX: only if you know what you are doing ...</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">castfn</span>
ptr2cptr<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span><span class="keyword">(</span>p<span class="keyword">:</span> <span class="staexp">ptr</span><span class="keyword">(</span><span class="staexp">l</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">cptr</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">castfn</span>
cptr_vtake
  <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>agz<span class="keyword">}</span></span>
<span class="keyword">(</span>
  cp<span class="keyword">:</span> <span class="staexp">cptr</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="staexp">a</span><span class="staexp"><span class="keyword">@</span></span><span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">a</span><span class="staexp"><span class="keyword">@</span></span><span class="staexp">l</span> <span class="keyword">-&lt;</span><span class="staexp">lin</span><span class="keyword">,</span><span class="staexp">prf</span><span class="keyword">&gt;</span> <span class="staexp">void</span> <span class="keyword">|</span> <span class="staexp">ptr</span> <span class="staexp">l</span><span class="keyword">)</span></span>
<span class="comment">// end of [cptr_vtake]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
cptr_get<span class="keyword">(</span>cp<span class="keyword">:</span> <span class="staexp">cPtr1</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">a</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
cptr_set<span class="keyword">(</span>cp<span class="keyword">:</span> <span class="staexp">cPtr1</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
cptr_exch<span class="keyword">(</span>cp<span class="keyword">:</span> <span class="staexp">cPtr1</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> xr<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">a</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="comment">(*
overload .get with cptr_get
overload .set with cptr_set
overload .exch with cptr_exch
*)</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* end of [unsafe.sats] *)</span>
</pre>
<pre class="patsyntax">
<span class="comment">(***********************************************************************)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(*                         Applied Type System                         *)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(***********************************************************************)</span>

<span class="comment">(*
** ATS/Postiats - Unleashing the Potential of Types!
** Copyright (C) 2010-2015 Hongwei Xi, ATS Trustful Software, Inc.
** All rights reserved
**
** ATS is free software;  you can  redistribute it and/or modify it under
** the terms of  the GNU GENERAL PUBLIC LICENSE (GPL) as published by the
** Free Software Foundation; either version 3, or (at  your  option)  any
** later version.
**
** ATS is distributed in the hope that it will be useful, but WITHOUT ANY
** WARRANTY; without  even  the  implied  warranty  of MERCHANTABILITY or
** FITNESS FOR A PARTICULAR PURPOSE.  See the  GNU General Public License
** for more details.
**
** You  should  have  received  a  copy of the GNU General Public License
** along  with  ATS;  see the  file COPYING.  If not, please write to the
** Free Software Foundation,  51 Franklin Street, Fifth Floor, Boston, MA
** 02110-1301, USA.
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
** Source:
** $PATSHOME/prelude/SATS/CODEGEN/checkast.atxt
** Time of generation: Mon Sep  5 21:48:34 2016
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* Author: Hongwei Xi *)</span>
<span class="comment">(* Authoremail: gmhwxiATgmailDOTcom *)</span>
<span class="comment">(* Start time: December, 2013 *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="neuexp"><span class="keyword">#define</span>
ATS_PACKNAME "ATSLIB.prelude.checkast"</span>

<span class="comment">(* ****** ****** *)</span>

<span class="staexp"><span class="keyword">sortdef</span> t0p <span class="keyword">=</span> <span class="keyword">t@ype</span> <span class="keyword">and</span> vt0p <span class="keyword">=</span> <span class="keyword">viewt@ype</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
checkast_gintLt<span class="staexp"><span class="keyword">{</span>i<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">g0int</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">int</span> <span class="staexp">i</span><span class="keyword">,</span> msg<span class="keyword">:</span> <span class="staexp">RD</span><span class="keyword">(</span><span class="staexp">string</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">g1intLt</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
checkast_gintLte<span class="staexp"><span class="keyword">{</span>i<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">g0int</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">int</span> <span class="staexp">i</span><span class="keyword">,</span> msg<span class="keyword">:</span> <span class="staexp">RD</span><span class="keyword">(</span><span class="staexp">string</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">g1intLte</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
checkast_gintGt<span class="staexp"><span class="keyword">{</span>i<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">g0int</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">int</span> <span class="staexp">i</span><span class="keyword">,</span> msg<span class="keyword">:</span> <span class="staexp">RD</span><span class="keyword">(</span><span class="staexp">string</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">g1intGt</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
checkast_gintGte<span class="staexp"><span class="keyword">{</span>i<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">g0int</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">int</span> <span class="staexp">i</span><span class="keyword">,</span> msg<span class="keyword">:</span> <span class="staexp">RD</span><span class="keyword">(</span><span class="staexp">string</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">g1intGte</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
checkast_gintBtw<span class="staexp"><span class="keyword">{</span>i<span class="keyword">,</span>j<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">g0int</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">int</span> <span class="staexp">i</span><span class="keyword">,</span> j<span class="keyword">:</span> <span class="staexp">int</span> <span class="staexp">j</span><span class="keyword">,</span> msg<span class="keyword">:</span> <span class="staexp">RD</span><span class="keyword">(</span><span class="staexp">string</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">g1intBtw</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">,</span> <span class="staexp">j</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk<span class="keyword">}</span></span>
checkast_gintBtwe<span class="staexp"><span class="keyword">{</span>i<span class="keyword">,</span>j<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">g0int</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">int</span> <span class="staexp">i</span><span class="keyword">,</span> j<span class="keyword">:</span> <span class="staexp">int</span> <span class="staexp">j</span><span class="keyword">,</span> msg<span class="keyword">:</span> <span class="staexp">RD</span><span class="keyword">(</span><span class="staexp">string</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">g1intBtwe</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">,</span> <span class="staexp">j</span><span class="keyword">)</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">macdef</span>
ckastloc_gintLt <span class="dynexp"><span class="keyword">(</span>x<span class="keyword">,</span> i<span class="keyword">)</span></span> <span class="keyword">=</span> checkast_gintLt <span class="keyword">(</span><span class="dynexp"><span class="keyword">,(</span>x<span class="keyword">)</span></span><span class="keyword">,</span> <span class="dynexp"><span class="keyword">,(</span>i<span class="keyword">)</span></span><span class="keyword">,</span> <span class="dynexp"><span class="keyword">$mylocation</span></span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">macdef</span>
ckastloc_gintLte <span class="dynexp"><span class="keyword">(</span>x<span class="keyword">,</span> i<span class="keyword">)</span></span> <span class="keyword">=</span> checkast_gintLte <span class="keyword">(</span><span class="dynexp"><span class="keyword">,(</span>x<span class="keyword">)</span></span><span class="keyword">,</span> <span class="dynexp"><span class="keyword">,(</span>i<span class="keyword">)</span></span><span class="keyword">,</span> <span class="dynexp"><span class="keyword">$mylocation</span></span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">macdef</span>
ckastloc_gintGt <span class="dynexp"><span class="keyword">(</span>x<span class="keyword">,</span> i<span class="keyword">)</span></span> <span class="keyword">=</span> checkast_gintGt <span class="keyword">(</span><span class="dynexp"><span class="keyword">,(</span>x<span class="keyword">)</span></span><span class="keyword">,</span> <span class="dynexp"><span class="keyword">,(</span>i<span class="keyword">)</span></span><span class="keyword">,</span> <span class="dynexp"><span class="keyword">$mylocation</span></span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">macdef</span>
ckastloc_gintGte <span class="dynexp"><span class="keyword">(</span>x<span class="keyword">,</span> i<span class="keyword">)</span></span> <span class="keyword">=</span> checkast_gintGte <span class="keyword">(</span><span class="dynexp"><span class="keyword">,(</span>x<span class="keyword">)</span></span><span class="keyword">,</span> <span class="dynexp"><span class="keyword">,(</span>i<span class="keyword">)</span></span><span class="keyword">,</span> <span class="dynexp"><span class="keyword">$mylocation</span></span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">macdef</span>
ckastloc_gintBtw <span class="dynexp"><span class="keyword">(</span>x<span class="keyword">,</span> i<span class="keyword">,</span> j<span class="keyword">)</span></span> <span class="keyword">=</span> checkast_gintBtw <span class="keyword">(</span><span class="dynexp"><span class="keyword">,(</span>x<span class="keyword">)</span></span><span class="keyword">,</span> <span class="dynexp"><span class="keyword">,(</span>i<span class="keyword">)</span></span><span class="keyword">,</span> <span class="dynexp"><span class="keyword">,(</span>j<span class="keyword">)</span></span><span class="keyword">,</span> <span class="dynexp"><span class="keyword">$mylocation</span></span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">macdef</span>
ckastloc_gintBtwe <span class="dynexp"><span class="keyword">(</span>x<span class="keyword">,</span> i<span class="keyword">,</span> j<span class="keyword">)</span></span> <span class="keyword">=</span> checkast_gintBtwe <span class="keyword">(</span><span class="dynexp"><span class="keyword">,(</span>x<span class="keyword">)</span></span><span class="keyword">,</span> <span class="dynexp"><span class="keyword">,(</span>i<span class="keyword">)</span></span><span class="keyword">,</span> <span class="dynexp"><span class="keyword">,(</span>j<span class="keyword">)</span></span><span class="keyword">,</span> <span class="dynexp"><span class="keyword">$mylocation</span></span><span class="keyword">)</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
checkast_Ptr1 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">ptr</span><span class="keyword">,</span> msg<span class="keyword">:</span> <span class="staexp">RD</span><span class="keyword">(</span><span class="staexp">string</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">Ptr1</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">macdef</span>
ckastloc_Ptr1 <span class="dynexp"><span class="keyword">(</span>x<span class="keyword">)</span></span> <span class="keyword">=</span> checkast_Ptr1 <span class="keyword">(</span><span class="dynexp"><span class="keyword">,(</span>x<span class="keyword">)</span></span><span class="keyword">,</span> <span class="dynexp"><span class="keyword">$mylocation</span></span><span class="keyword">)</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
checkast_Strptr1 <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">Strptr0</span><span class="keyword">,</span> msg<span class="keyword">:</span> <span class="staexp">RD</span><span class="keyword">(</span><span class="staexp">string</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">Strptr1</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">macdef</span>
ckastloc_Strptr1 <span class="dynexp"><span class="keyword">(</span>x<span class="keyword">)</span></span> <span class="keyword">=</span> checkast_Strptr1 <span class="keyword">(</span><span class="dynexp"><span class="keyword">,(</span>x<span class="keyword">)</span></span><span class="keyword">,</span> <span class="dynexp"><span class="keyword">$mylocation</span></span><span class="keyword">)</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* end of [checkast.sats] *)</span>
</pre>
<pre class="patsyntax">
<span class="comment">(***********************************************************************)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(*                         Applied Type System                         *)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(***********************************************************************)</span>

<span class="comment">(*
** ATS/Postiats - Unleashing the Potential of Types!
** Copyright (C) 2010-2015 Hongwei Xi, ATS Trustful Software, Inc.
** All rights reserved
**
** ATS is free software;  you can  redistribute it and/or modify it under
** the terms of  the GNU GENERAL PUBLIC LICENSE (GPL) as published by the
** Free Software Foundation; either version 3, or (at  your  option)  any
** later version.
**
** ATS is distributed in the hope that it will be useful, but WITHOUT ANY
** WARRANTY; without  even  the  implied  warranty  of MERCHANTABILITY or
** FITNESS FOR A PARTICULAR PURPOSE.  See the  GNU General Public License
** for more details.
**
** You  should  have  received  a  copy of the GNU General Public License
** along  with  ATS;  see the  file COPYING.  If not, please write to the
** Free Software Foundation,  51 Franklin Street, Fifth Floor, Boston, MA
** 02110-1301, USA.
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
** Source:
** $PATSHOME/prelude/SATS/CODEGEN/tuple.atxt
** Time of generation: Mon Sep  5 21:48:33 2016
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* Author: Hongwei Xi *)</span>
<span class="comment">(* Authoremail: hwxi AT cs DOT bu DOT edu *)</span>
<span class="comment">(* Start time: December, 2012 *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="staexp"><span class="keyword">sortdef</span> t0p <span class="keyword">=</span> <span class="keyword">t@ype</span> <span class="keyword">and</span> vt0p <span class="keyword">=</span> <span class="keyword">viewt@ype</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">typedef</span> <span class="staexp">SHR<span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span>type</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">a</span></span> <span class="comment">// for commenting purpose</span>
<span class="keyword">typedef</span> <span class="staexp">NSH<span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span>type</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">a</span></span> <span class="comment">// for commenting purpose</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="keyword">typedef</span> <span class="staexp">tup2
  <span class="keyword">(</span><span class="staexp">a0<span class="keyword">:</span>t0p</span><span class="keyword">,</span> <span class="staexp">a1<span class="keyword">:</span>t0p</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">@(</span><span class="staexp">a0</span><span class="keyword">,</span> <span class="staexp">a1</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span> <span class="staexp">tup3
  <span class="keyword">(</span><span class="staexp">a0<span class="keyword">:</span>t0p</span><span class="keyword">,</span> <span class="staexp">a1<span class="keyword">:</span>t0p</span><span class="keyword">,</span> <span class="staexp">a2<span class="keyword">:</span>t0p</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">@(</span><span class="staexp">a0</span><span class="keyword">,</span> <span class="staexp">a1</span><span class="keyword">,</span> <span class="staexp">a2</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span> <span class="staexp">tup4
  <span class="keyword">(</span><span class="staexp">a0<span class="keyword">:</span>t0p</span><span class="keyword">,</span> <span class="staexp">a1<span class="keyword">:</span>t0p</span><span class="keyword">,</span> <span class="staexp">a2<span class="keyword">:</span>t0p</span><span class="keyword">,</span> <span class="staexp">a3<span class="keyword">:</span>t0p</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">@(</span><span class="staexp">a0</span><span class="keyword">,</span> <span class="staexp">a1</span><span class="keyword">,</span> <span class="staexp">a2</span><span class="keyword">,</span> <span class="staexp">a3</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">stadef</span> <span class="staexp">tup <span class="keyword">=</span> <span class="staexp">tup2</span></span>
<span class="keyword">stadef</span> <span class="staexp">tup <span class="keyword">=</span> <span class="staexp">tup3</span></span>
<span class="keyword">stadef</span> <span class="staexp">tup <span class="keyword">=</span> <span class="staexp">tup4</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="keyword">typedef</span> <span class="staexp">tupbox1
  <span class="keyword">(</span><span class="staexp">a0<span class="keyword">:</span>t0p</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">$tup</span><span class="keyword">(</span><span class="staexp">a0</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span> <span class="staexp">tupbox2
  <span class="keyword">(</span><span class="staexp">a0<span class="keyword">:</span>t0p</span><span class="keyword">,</span> <span class="staexp">a1<span class="keyword">:</span>t0p</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">$tup</span><span class="keyword">(</span><span class="staexp">a0</span><span class="keyword">,</span> <span class="staexp">a1</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span> <span class="staexp">tupbox3
  <span class="keyword">(</span><span class="staexp">a0<span class="keyword">:</span>t0p</span><span class="keyword">,</span> <span class="staexp">a1<span class="keyword">:</span>t0p</span><span class="keyword">,</span> <span class="staexp">a2<span class="keyword">:</span>t0p</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">$tup</span><span class="keyword">(</span><span class="staexp">a0</span><span class="keyword">,</span> <span class="staexp">a1</span><span class="keyword">,</span> <span class="staexp">a2</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span> <span class="staexp">tupbox4
  <span class="keyword">(</span><span class="staexp">a0<span class="keyword">:</span>t0p</span><span class="keyword">,</span> <span class="staexp">a1<span class="keyword">:</span>t0p</span><span class="keyword">,</span> <span class="staexp">a2<span class="keyword">:</span>t0p</span><span class="keyword">,</span> <span class="staexp">a3<span class="keyword">:</span>t0p</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">$tup</span><span class="keyword">(</span><span class="staexp">a0</span><span class="keyword">,</span> <span class="staexp">a1</span><span class="keyword">,</span> <span class="staexp">a2</span><span class="keyword">,</span> <span class="staexp">a3</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">stadef</span> <span class="staexp">tupbox <span class="keyword">=</span> <span class="staexp">tupbox1</span></span>
<span class="keyword">stadef</span> <span class="staexp">tupbox <span class="keyword">=</span> <span class="staexp">tupbox2</span></span>
<span class="keyword">stadef</span> <span class="staexp">tupbox <span class="keyword">=</span> <span class="staexp">tupbox3</span></span>
<span class="keyword">stadef</span> <span class="staexp">tupbox <span class="keyword">=</span> <span class="staexp">tupbox4</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span> fprint_tup$beg <span class="keyword">(</span>out<span class="keyword">:</span> <span class="staexp">FILEref</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span> fprint_tup$end <span class="keyword">(</span>out<span class="keyword">:</span> <span class="staexp">FILEref</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span> fprint_tup$sep <span class="keyword">(</span>out<span class="keyword">:</span> <span class="staexp">FILEref</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a0<span class="keyword">,</span>a1<span class="keyword">:</span>t0p
<span class="keyword">}</span></span> fprint_tupval2 <span class="keyword">(</span>out<span class="keyword">:</span> <span class="staexp">FILEref</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="keyword">@(</span><span class="staexp">a0</span><span class="keyword">,</span> <span class="staexp">a1</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a0<span class="keyword">,</span>a1<span class="keyword">,</span>a2<span class="keyword">:</span>t0p
<span class="keyword">}</span></span> fprint_tupval3 <span class="keyword">(</span>out<span class="keyword">:</span> <span class="staexp">FILEref</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="keyword">@(</span><span class="staexp">a0</span><span class="keyword">,</span> <span class="staexp">a1</span><span class="keyword">,</span> <span class="staexp">a2</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a0<span class="keyword">,</span>a1<span class="keyword">,</span>a2<span class="keyword">,</span>a3<span class="keyword">:</span>t0p
<span class="keyword">}</span></span> fprint_tupval4 <span class="keyword">(</span>out<span class="keyword">:</span> <span class="staexp">FILEref</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="keyword">@(</span><span class="staexp">a0</span><span class="keyword">,</span> <span class="staexp">a1</span><span class="keyword">,</span> <span class="staexp">a2</span><span class="keyword">,</span> <span class="staexp">a3</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a0<span class="keyword">,</span>a1<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> fprint_tupref2 <span class="keyword">(</span>out<span class="keyword">:</span> <span class="staexp">FILEref</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="staexp">a0</span><span class="keyword">,</span> <span class="staexp">a1</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a0<span class="keyword">,</span>a1<span class="keyword">,</span>a2<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> fprint_tupref3 <span class="keyword">(</span>out<span class="keyword">:</span> <span class="staexp">FILEref</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="staexp">a0</span><span class="keyword">,</span> <span class="staexp">a1</span><span class="keyword">,</span> <span class="staexp">a2</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a0<span class="keyword">,</span>a1<span class="keyword">,</span>a2<span class="keyword">,</span>a3<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> fprint_tupref4 <span class="keyword">(</span>out<span class="keyword">:</span> <span class="staexp">FILEref</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="staexp">a0</span><span class="keyword">,</span> <span class="staexp">a1</span><span class="keyword">,</span> <span class="staexp">a2</span><span class="keyword">,</span> <span class="staexp">a3</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span> fprint_tupbox$beg <span class="keyword">(</span>out<span class="keyword">:</span> <span class="staexp">FILEref</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span> fprint_tupbox$end <span class="keyword">(</span>out<span class="keyword">:</span> <span class="staexp">FILEref</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span> fprint_tupbox$sep <span class="keyword">(</span>out<span class="keyword">:</span> <span class="staexp">FILEref</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a0<span class="keyword">:</span>t0p
<span class="keyword">}</span></span> fprint_tupbox1 <span class="keyword">(</span>out<span class="keyword">:</span> <span class="staexp">FILEref</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="keyword">$tup</span><span class="keyword">(</span><span class="staexp">a0</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a0<span class="keyword">,</span>a1<span class="keyword">:</span>t0p
<span class="keyword">}</span></span> fprint_tupbox2 <span class="keyword">(</span>out<span class="keyword">:</span> <span class="staexp">FILEref</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="keyword">$tup</span><span class="keyword">(</span><span class="staexp">a0</span><span class="keyword">,</span> <span class="staexp">a1</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a0<span class="keyword">,</span>a1<span class="keyword">,</span>a2<span class="keyword">:</span>t0p
<span class="keyword">}</span></span> fprint_tupbox3 <span class="keyword">(</span>out<span class="keyword">:</span> <span class="staexp">FILEref</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="keyword">$tup</span><span class="keyword">(</span><span class="staexp">a0</span><span class="keyword">,</span> <span class="staexp">a1</span><span class="keyword">,</span> <span class="staexp">a2</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a0<span class="keyword">,</span>a1<span class="keyword">,</span>a2<span class="keyword">,</span>a3<span class="keyword">:</span>t0p
<span class="keyword">}</span></span> fprint_tupbox4 <span class="keyword">(</span>out<span class="keyword">:</span> <span class="staexp">FILEref</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="keyword">$tup</span><span class="keyword">(</span><span class="staexp">a0</span><span class="keyword">,</span> <span class="staexp">a1</span><span class="keyword">,</span> <span class="staexp">a2</span><span class="keyword">,</span> <span class="staexp">a3</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a0<span class="keyword">,</span>a1<span class="keyword">:</span>t0p
<span class="keyword">}</span></span> tupval2_equal
  <span class="keyword">(</span>x<span class="keyword">:</span> <span class="keyword">@(</span><span class="staexp">a0</span><span class="keyword">,</span> <span class="staexp">a1</span><span class="keyword">)</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="keyword">@(</span><span class="staexp">a0</span><span class="keyword">,</span> <span class="staexp">a1</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span></span>
<span class="comment">// end of [tupval2_equal]</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a0<span class="keyword">,</span>a1<span class="keyword">,</span>a2<span class="keyword">:</span>t0p
<span class="keyword">}</span></span> tupval3_equal
  <span class="keyword">(</span>x<span class="keyword">:</span> <span class="keyword">@(</span><span class="staexp">a0</span><span class="keyword">,</span> <span class="staexp">a1</span><span class="keyword">,</span> <span class="staexp">a2</span><span class="keyword">)</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="keyword">@(</span><span class="staexp">a0</span><span class="keyword">,</span> <span class="staexp">a1</span><span class="keyword">,</span> <span class="staexp">a2</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span></span>
<span class="comment">// end of [tupval3_equal]</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a0<span class="keyword">,</span>a1<span class="keyword">,</span>a2<span class="keyword">,</span>a3<span class="keyword">:</span>t0p
<span class="keyword">}</span></span> tupval4_equal
  <span class="keyword">(</span>x<span class="keyword">:</span> <span class="keyword">@(</span><span class="staexp">a0</span><span class="keyword">,</span> <span class="staexp">a1</span><span class="keyword">,</span> <span class="staexp">a2</span><span class="keyword">,</span> <span class="staexp">a3</span><span class="keyword">)</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="keyword">@(</span><span class="staexp">a0</span><span class="keyword">,</span> <span class="staexp">a1</span><span class="keyword">,</span> <span class="staexp">a2</span><span class="keyword">,</span> <span class="staexp">a3</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span></span>
<span class="comment">// end of [tupval4_equal]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a0<span class="keyword">,</span>a1<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> tupref2_equal
  <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="staexp">a0</span><span class="keyword">,</span> <span class="staexp">a1</span><span class="keyword">)</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="staexp">a0</span><span class="keyword">,</span> <span class="staexp">a1</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span></span>
<span class="comment">// end of [tupref2_equal]</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a0<span class="keyword">,</span>a1<span class="keyword">,</span>a2<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> tupref3_equal
  <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="staexp">a0</span><span class="keyword">,</span> <span class="staexp">a1</span><span class="keyword">,</span> <span class="staexp">a2</span><span class="keyword">)</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="staexp">a0</span><span class="keyword">,</span> <span class="staexp">a1</span><span class="keyword">,</span> <span class="staexp">a2</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span></span>
<span class="comment">// end of [tupref3_equal]</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a0<span class="keyword">,</span>a1<span class="keyword">,</span>a2<span class="keyword">,</span>a3<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> tupref4_equal
  <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="staexp">a0</span><span class="keyword">,</span> <span class="staexp">a1</span><span class="keyword">,</span> <span class="staexp">a2</span><span class="keyword">,</span> <span class="staexp">a3</span><span class="keyword">)</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="staexp">a0</span><span class="keyword">,</span> <span class="staexp">a1</span><span class="keyword">,</span> <span class="staexp">a2</span><span class="keyword">,</span> <span class="staexp">a3</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span></span>
<span class="comment">// end of [tupref4_equal]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a0<span class="keyword">,</span>a1<span class="keyword">:</span>t0p
<span class="keyword">}</span></span> tupval2_compare
  <span class="keyword">(</span>x<span class="keyword">:</span> <span class="keyword">@(</span><span class="staexp">a0</span><span class="keyword">,</span> <span class="staexp">a1</span><span class="keyword">)</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="keyword">@(</span><span class="staexp">a0</span><span class="keyword">,</span> <span class="staexp">a1</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int</span></span>
<span class="comment">// end of [tupval2_compare]</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a0<span class="keyword">,</span>a1<span class="keyword">,</span>a2<span class="keyword">:</span>t0p
<span class="keyword">}</span></span> tupval3_compare
  <span class="keyword">(</span>x<span class="keyword">:</span> <span class="keyword">@(</span><span class="staexp">a0</span><span class="keyword">,</span> <span class="staexp">a1</span><span class="keyword">,</span> <span class="staexp">a2</span><span class="keyword">)</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="keyword">@(</span><span class="staexp">a0</span><span class="keyword">,</span> <span class="staexp">a1</span><span class="keyword">,</span> <span class="staexp">a2</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int</span></span>
<span class="comment">// end of [tupval3_compare]</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a0<span class="keyword">,</span>a1<span class="keyword">,</span>a2<span class="keyword">,</span>a3<span class="keyword">:</span>t0p
<span class="keyword">}</span></span> tupval4_compare
  <span class="keyword">(</span>x<span class="keyword">:</span> <span class="keyword">@(</span><span class="staexp">a0</span><span class="keyword">,</span> <span class="staexp">a1</span><span class="keyword">,</span> <span class="staexp">a2</span><span class="keyword">,</span> <span class="staexp">a3</span><span class="keyword">)</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="keyword">@(</span><span class="staexp">a0</span><span class="keyword">,</span> <span class="staexp">a1</span><span class="keyword">,</span> <span class="staexp">a2</span><span class="keyword">,</span> <span class="staexp">a3</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int</span></span>
<span class="comment">// end of [tupval4_compare]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a0<span class="keyword">,</span>a1<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> tupref2_compare
  <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="staexp">a0</span><span class="keyword">,</span> <span class="staexp">a1</span><span class="keyword">)</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="staexp">a0</span><span class="keyword">,</span> <span class="staexp">a1</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int</span></span>
<span class="comment">// end of [tupref2_compare]</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a0<span class="keyword">,</span>a1<span class="keyword">,</span>a2<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> tupref3_compare
  <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="staexp">a0</span><span class="keyword">,</span> <span class="staexp">a1</span><span class="keyword">,</span> <span class="staexp">a2</span><span class="keyword">)</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="staexp">a0</span><span class="keyword">,</span> <span class="staexp">a1</span><span class="keyword">,</span> <span class="staexp">a2</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int</span></span>
<span class="comment">// end of [tupref3_compare]</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a0<span class="keyword">,</span>a1<span class="keyword">,</span>a2<span class="keyword">,</span>a3<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> tupref4_compare
  <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="staexp">a0</span><span class="keyword">,</span> <span class="staexp">a1</span><span class="keyword">,</span> <span class="staexp">a2</span><span class="keyword">,</span> <span class="staexp">a3</span><span class="keyword">)</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="staexp">a0</span><span class="keyword">,</span> <span class="staexp">a1</span><span class="keyword">,</span> <span class="staexp">a2</span><span class="keyword">,</span> <span class="staexp">a3</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int</span></span>
<span class="comment">// end of [tupref4_compare]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* end of [tuple.sats] *)</span>
</pre>
<pre class="patsyntax">
<span class="comment">(***********************************************************************)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(*                         Applied Type System                         *)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(***********************************************************************)</span>

<span class="comment">(*
** ATS/Postiats - Unleashing the Potential of Types!
** Copyright (C) 2010-2015 Hongwei Xi, ATS Trustful Software, Inc.
** All rights reserved
**
** ATS is free software;  you can  redistribute it and/or modify it under
** the terms of  the GNU GENERAL PUBLIC LICENSE (GPL) as published by the
** Free Software Foundation; either version 3, or (at  your  option)  any
** later version.
**
** ATS is distributed in the hope that it will be useful, but WITHOUT ANY
** WARRANTY; without  even  the  implied  warranty  of MERCHANTABILITY or
** FITNESS FOR A PARTICULAR PURPOSE.  See the  GNU General Public License
** for more details.
**
** You  should  have  received  a  copy of the GNU General Public License
** along  with  ATS;  see the  file COPYING.  If not, please write to the
** Free Software Foundation,  51 Franklin Street, Fifth Floor, Boston, MA
** 02110-1301, USA.
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
** Source:
** $PATSHOME/prelude/SATS/CODEGEN/reference.atxt
** Time of generation: Mon Sep  5 21:48:33 2016
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* Author: Hongwei Xi *)</span>
<span class="comment">(* Authoremail: hwxi AT cs DOT bu DOT edu *)</span>
<span class="comment">(* Start time: March, 2012 *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="staexp"><span class="keyword">sortdef</span> t0p <span class="keyword">=</span> <span class="keyword">t@ype</span> <span class="keyword">and</span> vt0p <span class="keyword">=</span> <span class="keyword">viewt@ype</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">castfn</span> ref_get_ptr
  <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span> <span class="keyword">(</span>r<span class="keyword">:</span> <span class="staexp">ref</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp"><span class="keyword">[</span>l<span class="keyword">:</span>agz<span class="keyword">]</span></span> <span class="staexp">ptr</span> <span class="keyword">(</span><span class="staexp">l</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">castfn</span> ref_get_viewptr
  <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span> <span class="keyword">(</span>r<span class="keyword">:</span> <span class="staexp">ref</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp"><span class="keyword">[</span>l<span class="keyword">:</span>agz<span class="keyword">]</span></span> <span class="keyword">(</span><span class="staexp">vbox</span> <span class="keyword">(</span><span class="staexp">a</span> <span class="staexp"><span class="keyword">@</span></span> <span class="staexp">l</span><span class="keyword">)</span> <span class="keyword">|</span> <span class="staexp">ptr</span> <span class="staexp">l</span><span class="keyword">)</span></span>
<span class="comment">// end of [ref_get_viewptr]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
macdef ptr_of_ref = ref_get_ptr
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span> ref <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">ref</span> <span class="staexp">a</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span> ref_make_elt <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">ref</span> <span class="staexp">a</span></span>

<span class="dynexp"><span class="keyword">castfn</span> ref_make_viewptr
  <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span> <span class="keyword">(</span><span class="prfexp">pf<span class="keyword">:</span> <span class="staexp">a</span> <span class="staexp"><span class="keyword">@</span></span> <span class="staexp">l</span></span> <span class="keyword">|</span> p<span class="keyword">:</span> <span class="staexp">ptr</span> <span class="staexp">l</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">ref</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">// end of [ref_make_viewptr]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span> ref_get_elt <span class="keyword">(</span>r<span class="keyword">:</span> <span class="staexp">ref</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">ref</span><span class="keyword">&gt;</span> <span class="staexp">a</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span> ref_set_elt <span class="keyword">(</span>r<span class="keyword">:</span> <span class="staexp">ref</span> <span class="staexp">a</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">refwrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span> ref_exch_elt <span class="keyword">(</span>r<span class="keyword">:</span> <span class="staexp">ref</span> <span class="staexp">a</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">a</span><span class="staexp">&gt;&gt;</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">refwrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
** HX-2012-05:
** this is not particularly useful except for the purpose
** of avoiding using the [vbox] pattern
*)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
ref_app_fun<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
<span class="keyword">(</span>
  r<span class="keyword">:</span> <span class="staexp">ref</span> <span class="staexp">a</span><span class="keyword">,</span> f<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">&amp;</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="staexp">&gt;&gt;</span><span class="staexp">_</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">0</span><span class="keyword">,</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">refwrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span> <span class="comment">// end of [ref_app_fun]</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
ref_app_funenv<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
  <span class="staexp"><span class="keyword">{</span>v<span class="keyword">:</span>view<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>vt<span class="keyword">:</span>viewtype<span class="keyword">}</span></span>
<span class="keyword">(</span>
  <span class="prfexp">pfv<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">v</span></span>
<span class="keyword">|</span> r<span class="keyword">:</span> <span class="staexp">ref</span> <span class="staexp">a</span><span class="keyword">,</span> f<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp"><span class="keyword">!</span></span><span class="staexp">v</span> <span class="keyword">|</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="staexp">&gt;&gt;</span><span class="staexp">_</span><span class="keyword">,</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">vt</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">0</span><span class="keyword">,</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span><span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">vt</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">refwrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span> <span class="comment">// end of [ref_app_funenv]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">// HX-2013-10: unsafe but convenient</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
ref_vtakeout
  <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
<span class="keyword">(</span>
  ref<span class="keyword">:</span> <span class="staexp">ref</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">ref</span><span class="keyword">&gt;</span> <span class="staexp"><span class="keyword">[</span>l<span class="keyword">:</span>addr<span class="keyword">]</span></span> <span class="keyword">(</span><span class="staexp">a</span> <span class="staexp"><span class="keyword">@</span></span> <span class="staexp">l</span><span class="keyword">,</span> <span class="keyword">(</span><span class="staexp">a</span> <span class="staexp"><span class="keyword">@</span></span> <span class="staexp">l</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">lin</span><span class="keyword">,</span><span class="staexp">prf</span><span class="keyword">&gt;</span> <span class="staexp">void</span> <span class="keyword">|</span> <span class="staexp">ptr</span><span class="keyword">(</span><span class="staexp">l</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">// overloading for certain symbols</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">[</span><span class="keyword">]</span> <span class="keyword">with</span> ref_get_elt</span> <span class="comment">// ref[]</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">[</span><span class="keyword">]</span> <span class="keyword">with</span> ref_set_elt</span> <span class="comment">// ref[] := (val)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* end of [reference.sats] *)</span>
</pre>
<pre class="patsyntax">
<span class="comment">(***********************************************************************)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(*                         Applied Type System                         *)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(***********************************************************************)</span>

<span class="comment">(*
** ATS/Postiats - Unleashing the Potential of Types!
** Copyright (C) 2010-2015 Hongwei Xi, ATS Trustful Software, Inc.
** All rights reserved
**
** ATS is free software;  you can  redistribute it and/or modify it under
** the terms of  the GNU GENERAL PUBLIC LICENSE (GPL) as published by the
** Free Software Foundation; either version 3, or (at  your  option)  any
** later version.
**
** ATS is distributed in the hope that it will be useful, but WITHOUT ANY
** WARRANTY; without  even  the  implied  warranty  of MERCHANTABILITY or
** FITNESS FOR A PARTICULAR PURPOSE.  See the  GNU General Public License
** for more details.
**
** You  should  have  received  a  copy of the GNU General Public License
** along  with  ATS;  see the  file COPYING.  If not, please write to the
** Free Software Foundation,  51 Franklin Street, Fifth Floor, Boston, MA
** 02110-1301, USA.
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
** Source:
** $PATSHOME/prelude/SATS/CODEGEN/filebas.atxt
** Time of generation: Mon Sep  5 21:48:34 2016
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* Author: Hongwei Xi *)</span>
<span class="comment">(* Authoremail: hwxi AT cs DOT bu DOT edu *)</span>
<span class="comment">(* Start time: February, 2012 *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="staexp"><span class="keyword">sortdef</span> t0p <span class="keyword">=</span> <span class="keyword">t@ype</span> <span class="keyword">and</span> vt0p <span class="keyword">=</span> <span class="keyword">viewt@ype</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="neuexp"><span class="keyword">#define</span> NSH <span class="keyword">(</span>x<span class="keyword">)</span> x</span> <span class="comment">// for commenting: no sharing</span>
<span class="neuexp"><span class="keyword">#define</span> SHR <span class="keyword">(</span>x<span class="keyword">)</span> x</span> <span class="comment">// for commenting: it is shared</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">val</span> stdin_ref <span class="keyword">:</span> <span class="staexp">FILEref</span> <span class="keyword">=</span> "mac#%FILE_stdin"</span>
<span class="dynexp"><span class="keyword">val</span> stdout_ref <span class="keyword">:</span> <span class="staexp">FILEref</span> <span class="keyword">=</span> "mac#%FILE_stdout"</span>
<span class="dynexp"><span class="keyword">val</span> stderr_ref <span class="keyword">:</span> <span class="staexp">FILEref</span> <span class="keyword">=</span> "mac#%FILE_stderr"</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span> dirsep_get <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">charNZ</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span> dirname_self <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">string</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span> dirname_parent <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">string</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
filename_get_ext <span class="keyword">(</span>name<span class="keyword">:</span> <span class="staexp">string</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">vStrptr0</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
filename_test_ext <span class="keyword">(</span>name<span class="keyword">:</span> <span class="staexp">string</span><span class="keyword">,</span> ext<span class="keyword">:</span> <span class="staexp">string</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
filename_get_base <span class="keyword">(</span>name<span class="keyword">:</span> <span class="staexp">string</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">vStrptr1</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
filename_test_base <span class="keyword">(</span>name<span class="keyword">:</span> <span class="staexp">string</span><span class="keyword">,</span> base<span class="keyword">:</span> <span class="staexp">string</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span></span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> file_mode_r
  <span class="keyword">:</span> <span class="staexp">file_mode</span> <span class="keyword">(</span><span class="staexp">file_mode_r</span><span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span> <span class="comment">// = "r"</span>
<span class="dynexp"><span class="keyword">val</span> file_mode_rr
  <span class="keyword">:</span> <span class="staexp">file_mode</span> <span class="keyword">(</span><span class="staexp">file_mode_rw</span><span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span> <span class="comment">// = "r+"</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> file_mode_w
  <span class="keyword">:</span> <span class="staexp">file_mode</span> <span class="keyword">(</span><span class="staexp">file_mode_w</span><span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span> <span class="comment">// = "w"</span>
<span class="dynexp"><span class="keyword">val</span> file_mode_ww
  <span class="keyword">:</span> <span class="staexp">file_mode</span> <span class="keyword">(</span><span class="staexp">file_mode_rw</span><span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span> <span class="comment">// = "w+"</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> file_mode_a
  <span class="keyword">:</span> <span class="staexp">file_mode</span> <span class="keyword">(</span><span class="staexp">file_mode_rw</span><span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span> <span class="comment">// = "a"</span>
<span class="dynexp"><span class="keyword">val</span> file_mode_aa
  <span class="keyword">:</span> <span class="staexp">file_mode</span> <span class="keyword">(</span><span class="staexp">file_mode_rw</span><span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span> <span class="comment">// = "a+"</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">(*
** HX: [stat] is called
*)</span>
<span class="dynexp"><span class="keyword">fun</span>
test_file_exists
  <span class="keyword">(</span>path<span class="keyword">:</span> <span class="staexp">NSH</span><span class="keyword">(</span><span class="staexp">string</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">// HX-2011-02-16:</span>
<span class="comment">// [stat] is called to obtain the mode of a given file</span>
<span class="comment">// for [f] to be applied to it.</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
test_file_mode
  <span class="keyword">(</span>path<span class="keyword">:</span> <span class="staexp">NSH</span><span class="keyword">(</span><span class="staexp">string</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">int</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
test_file_mode$pred <span class="keyword">(</span>mode<span class="keyword">:</span> <span class="staexp">uint</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">bool</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
test_file_mode_fun
  <span class="keyword">(</span>path<span class="keyword">:</span> <span class="staexp">NSH</span><span class="keyword">(</span><span class="staexp">string</span><span class="keyword">)</span><span class="keyword">,</span> f<span class="keyword">:</span> <span class="staexp">uint</span> <span class="staexp"><span class="keyword">-&gt;</span></span> <span class="staexp">bool</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">int</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">//</span>
<span class="comment">// HX: [stat] is called // ~1/0/1: error/false/true</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
test_file_isblk<span class="keyword">(</span>path<span class="keyword">:</span> <span class="staexp">NSH</span><span class="keyword">(</span><span class="staexp">string</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">int</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span>
test_file_ischr<span class="keyword">(</span>path<span class="keyword">:</span> <span class="staexp">NSH</span><span class="keyword">(</span><span class="staexp">string</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">int</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span>
test_file_isdir<span class="keyword">(</span>path<span class="keyword">:</span> <span class="staexp">NSH</span><span class="keyword">(</span><span class="staexp">string</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">int</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span>
test_file_isfifo<span class="keyword">(</span>path<span class="keyword">:</span> <span class="staexp">NSH</span><span class="keyword">(</span><span class="staexp">string</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">int</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span>
test_file_isreg<span class="keyword">(</span>path<span class="keyword">:</span> <span class="staexp">NSH</span><span class="keyword">(</span><span class="staexp">string</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">int</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">//</span>
<span class="comment">// HX: [lstat] is called // ~1/0/1: error/false/true</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
test_file_islnk<span class="keyword">(</span>path<span class="keyword">:</span> <span class="staexp">NSH</span><span class="keyword">(</span><span class="staexp">string</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">int</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
fileref_open_exn
  <span class="keyword">(</span>path<span class="keyword">:</span> <span class="staexp">NSH</span><span class="keyword">(</span><span class="staexp">string</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">file_mode</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">FILEref</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">// end of [fileref_open_exn]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
fileref_open_opt
  <span class="keyword">(</span>path<span class="keyword">:</span> <span class="staexp">NSH</span><span class="keyword">(</span><span class="staexp">string</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">file_mode</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">Option_vt</span><span class="keyword">(</span><span class="staexp">FILEref</span><span class="keyword">)</span></span>
<span class="comment">// end of [fileref_open_opt]</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
fileref_close<span class="keyword">(</span>fil<span class="keyword">:</span> <span class="staexp">FILEref</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
fileref_flush<span class="keyword">(</span>fil<span class="keyword">:</span> <span class="staexp">FILEref</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">// HX: error indication: EOF</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
fileref_getc<span class="keyword">(</span>input<span class="keyword">:</span> <span class="staexp">FILEref</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">int</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">// HX: no error reporting</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
fileref_putc_int
  <span class="keyword">(</span>out<span class="keyword">:</span> <span class="staexp">FILEref</span><span class="keyword">,</span> c<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
fileref_putc_char
  <span class="keyword">(</span>out<span class="keyword">:</span> <span class="staexp">FILEref</span><span class="keyword">,</span> c<span class="keyword">:</span> <span class="staexp">char</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">//</span>
<span class="neuexp"><span class="keyword">symintr</span> fileref_putc</span>
<span class="dynexp"><span class="keyword">overload</span> fileref_putc <span class="keyword">with</span> fileref_putc_int</span>
<span class="dynexp"><span class="keyword">overload</span> fileref_putc <span class="keyword">with</span> fileref_putc_char</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">// HX: no error reporting</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
fileref_puts
  <span class="keyword">(</span>out<span class="keyword">:</span> <span class="staexp">FILEref</span><span class="keyword">,</span> <span class="staexp">NSH</span><span class="keyword">(</span><span class="staexp">string</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
fileref_is_eof <span class="keyword">(</span>inp<span class="keyword">:</span> <span class="staexp">FILEref</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">bool</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">macdef</span>
fileref_isnot_eof<span class="dynexp"><span class="keyword">(</span>inp<span class="keyword">)</span></span> <span class="keyword">=</span> <span class="keyword">~</span>fileref_is_eof <span class="keyword">(</span><span class="dynexp"><span class="keyword">,(</span>inp<span class="keyword">)</span></span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">typedef</span>
<span class="staexp">fileref_load_type<span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span><span class="keyword">t@ype</span></span><span class="keyword">)</span> <span class="keyword">=</span>
  <span class="keyword">(</span><span class="staexp">FILEref</span><span class="keyword">,</span> <span class="staexp">&amp;</span><span class="staexp">a</span><span class="staexp">?</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">opt</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">b</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">fun1</span><span class="keyword">&gt;</span> <span class="staexp"><span class="keyword">#[</span>b<span class="keyword">:</span>bool<span class="keyword">]</span></span> <span class="staexp">bool</span> <span class="keyword">(</span><span class="staexp">b</span><span class="keyword">)</span></span>
<span class="comment">// end of [fileref_load_type]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
fileref_load <span class="keyword">:</span> <span class="staexp">fileref_load_type</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
fileref_load_int <span class="keyword">:</span> <span class="staexp">fileref_load_type</span> <span class="keyword">(</span><span class="staexp">int</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span>
fileref_load_lint <span class="keyword">:</span> <span class="staexp">fileref_load_type</span> <span class="keyword">(</span><span class="staexp">lint</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span>
fileref_load_uint <span class="keyword">:</span> <span class="staexp">fileref_load_type</span> <span class="keyword">(</span><span class="staexp">uint</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span>
fileref_load_ulint <span class="keyword">:</span> <span class="staexp">fileref_load_type</span> <span class="keyword">(</span><span class="staexp">ulint</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
fileref_load_float <span class="keyword">:</span> <span class="staexp">fileref_load_type</span> <span class="keyword">(</span><span class="staexp">float</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">fun</span>
fileref_load_double <span class="keyword">:</span> <span class="staexp">fileref_load_type</span> <span class="keyword">(</span><span class="staexp">double</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
fileref_get_optval
  <span class="keyword">(</span>inp<span class="keyword">:</span> <span class="staexp">FILEref</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">Option_vt</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">// end of [fileref_get_optval]</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>t0p
<span class="keyword">}</span></span> fileref_get_exnmsg
  <span class="keyword">(</span>inp<span class="keyword">:</span> <span class="staexp">FILEref</span><span class="keyword">,</span> msg<span class="keyword">:</span> <span class="staexp">NSH</span><span class="keyword">(</span><span class="staexp">string</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">a</span></span>
<span class="comment">// end of [fileref_get_exnmsg]</span>

<span class="dynexp"><span class="keyword">macdef</span>
fileref_get_exnloc
  <span class="dynexp"><span class="keyword">(</span>inp<span class="keyword">)</span></span> <span class="keyword">=</span> fileref_get_exnmsg <span class="keyword">(</span><span class="dynexp"><span class="keyword">,(</span>inp<span class="keyword">)</span></span><span class="keyword">,</span> <span class="dynexp"><span class="keyword">$mylocation</span></span><span class="keyword">)</span></span>
<span class="comment">// end of [fileref_get_exnloc]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">typedef</span> <span class="staexp">charlst <span class="keyword">=</span> <span class="staexp">List0</span> <span class="keyword">(</span><span class="staexp">char</span><span class="keyword">)</span></span>
<span class="keyword">vtypedef</span> <span class="staexp">charlst_vt <span class="keyword">=</span> <span class="staexp">List0_vt</span> <span class="keyword">(</span><span class="staexp">char</span><span class="keyword">)</span></span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
fileref_get_line_charlst<span class="keyword">(</span>inp<span class="keyword">:</span> <span class="staexp">FILEref</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">charlst_vt</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">(*
** HX: only for files of "tiny" size
*)</span>
<span class="dynexp"><span class="keyword">fun</span>
fileref_get_lines_charlstlst<span class="keyword">(</span>inp<span class="keyword">:</span> <span class="staexp">FILEref</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">List0_vt</span> <span class="keyword">(</span><span class="staexp">charlst_vt</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">(*
** HX: for handling files of "tiny" size
*)</span>
<span class="dynexp"><span class="keyword">fun</span>
fileref_get_file_charlst<span class="keyword">(</span>inp<span class="keyword">:</span> <span class="staexp">FILEref</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">List0_vt</span> <span class="keyword">(</span><span class="staexp">char</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span>
fileref_get2_file_charlst<span class="keyword">(</span>inp<span class="keyword">:</span> <span class="staexp">FILEref</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">List0_vt</span> <span class="keyword">(</span><span class="staexp">char</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
fileref_put_charlst<span class="keyword">(</span>inp<span class="keyword">:</span> <span class="staexp">FILEref</span><span class="keyword">,</span> cs<span class="keyword">:</span> <span class="staexp">NSH</span><span class="keyword">(</span><span class="staexp">List</span><span class="keyword">(</span><span class="staexp">char</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">//</span>
<span class="comment">// HX-2013-05:</span>
<span class="comment">// these functions are based on [fgets];</span>
<span class="comment">// they should only be applied to files containing</span>
<span class="comment">// no occurrences of the NUL character ('\000').</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
fileref_get_line_string<span class="keyword">(</span>inp<span class="keyword">:</span> <span class="staexp">FILEref</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">Strptr1</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
fileref_get_line_string_main
<span class="keyword">(</span>
  inp<span class="keyword">:</span> <span class="staexp">FILEref</span><span class="keyword">,</span> nchar<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">int</span><span class="staexp">?</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">int</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp"><span class="keyword">#[</span>n<span class="keyword">:</span>nat<span class="keyword">]</span></span> <span class="staexp">strnptr</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span></span> <span class="comment">// end-of-function</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
fileref_get_line_string$bufsize<span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">intGte</span><span class="keyword">(</span><span class="staexp">1</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
fileref_get_lines_stringlst<span class="keyword">(</span>inp<span class="keyword">:</span> <span class="staexp">FILEref</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">List0_vt</span><span class="keyword">(</span><span class="staexp">Strptr1</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
fileref_get_file_string<span class="keyword">(</span>inp<span class="keyword">:</span> <span class="staexp">FILEref</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">Strptr1</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
fileref_get_file_string$bufsize<span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">intGte</span><span class="keyword">(</span><span class="staexp">1</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
fileref_get_word<span class="keyword">(</span>inp<span class="keyword">:</span> <span class="staexp">FILEref</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">Strptr0</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
fileref_get_word$isalpha<span class="keyword">(</span>c0<span class="keyword">:</span> <span class="staexp">charNZ</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">bool</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
fileref_foreach<span class="keyword">(</span>inp<span class="keyword">:</span> <span class="staexp">FILEref</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
env<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> fileref_foreach_env<span class="keyword">(</span>inp<span class="keyword">:</span> <span class="staexp">FILEref</span><span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="staexp">env</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
fileref_foreach$bufsize<span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">sizeGte</span><span class="keyword">(</span><span class="staexp">1</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
env<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> fileref_foreach$fwork<span class="keyword">(</span>c<span class="keyword">:</span> <span class="staexp">char</span><span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="staexp">env</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
env<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> fileref_foreach$fworkv
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span> <span class="keyword">(</span><span class="staexp">arrayref</span><span class="keyword">(</span><span class="staexp">char</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">size_t</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="staexp">env</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
streamize_fileref_char<span class="keyword">(</span>inp<span class="keyword">:</span> <span class="staexp">FILEref</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">char</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
streamize_fileref_line<span class="keyword">(</span>inp<span class="keyword">:</span> <span class="staexp">FILEref</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">Strptr1</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* end of [filebas.sats] *)</span>
</pre>
<pre class="patsyntax">
<span class="comment">(***********************************************************************)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(*                         Applied Type System                         *)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(***********************************************************************)</span>

<span class="comment">(*
** ATS/Postiats - Unleashing the Potential of Types!
** Copyright (C) 2010-2015 Hongwei Xi, ATS Trustful Software, Inc.
** All rights reserved
**
** ATS is free software;  you can  redistribute it and/or modify it under
** the terms of  the GNU GENERAL PUBLIC LICENSE (GPL) as published by the
** Free Software Foundation; either version 3, or (at  your  option)  any
** later version.
**
** ATS is distributed in the hope that it will be useful, but WITHOUT ANY
** WARRANTY; without  even  the  implied  warranty  of MERCHANTABILITY or
** FITNESS FOR A PARTICULAR PURPOSE.  See the  GNU General Public License
** for more details.
**
** You  should  have  received  a  copy of the GNU General Public License
** along  with  ATS;  see the  file COPYING.  If not, please write to the
** Free Software Foundation,  51 Franklin Street, Fifth Floor, Boston, MA
** 02110-1301, USA.
*)</span>
<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* Author: Hongwei Xi *)</span>
<span class="comment">(* Authoremail: hwxi AT cs DOT bu DOT edu *)</span>
<span class="comment">(* Start time: June, 2012 *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
** Source:
** $PATSHOME/prelude/SATS/CODEGEN/intrange.atxt
** Time of generation: Mon Oct 17 23:07:19 2016
*)</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">// HX-2013-04:</span>
<span class="comment">// intrange (l, r) is for integers i satisfying l &lt;= i &lt; r</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
intrange_foreach <span class="keyword">(</span>l<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> r<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">int</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>env<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
intrange_foreach_env <span class="keyword">(</span>l<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> r<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="staexp">env</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">int</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>env<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
intrange_foreach$cont <span class="keyword">(</span>i<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">env</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">bool</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>env<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
intrange_foreach$fwork <span class="keyword">(</span>i<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="staexp">env</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
int_foreach_cloref
<span class="keyword">(</span>
  n<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> fwork<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">int</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloref1</span><span class="keyword">&gt;</span> <span class="staexp">void</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">int</span></span> <span class="comment">// end of [int_foreach_cloref]</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
intrange_foreach_cloref
<span class="keyword">(</span>
  l<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> r<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> fwork<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">int</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloref1</span><span class="keyword">&gt;</span> <span class="staexp">void</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">int</span></span> <span class="comment">// end of [intrange_foreach_cloref]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
intrange_rforeach <span class="keyword">(</span>l<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> r<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">int</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>env<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
intrange_rforeach_env <span class="keyword">(</span>l<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> r<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="staexp">env</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">int</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>env<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
intrange_rforeach$cont <span class="keyword">(</span>i<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">env</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">bool</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>env<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
intrange_rforeach$fwork <span class="keyword">(</span>i<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="staexp">env</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
int_rforeach_cloref
<span class="keyword">(</span>
  n<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> fwork<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">int</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloref1</span><span class="keyword">&gt;</span> <span class="staexp">void</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">int</span></span> <span class="comment">// end of [int_rforeach_cloref]</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
intrange_rforeach_cloref
<span class="keyword">(</span>
  l<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> r<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> fwork<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">int</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloref1</span><span class="keyword">&gt;</span> <span class="staexp">void</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">int</span></span> <span class="comment">// end of [intrange_rforeach_cloref]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
intrange2_foreach
  <span class="keyword">(</span>l1<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> r1<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> l2<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> r2<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>env<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
intrange2_foreach_env
  <span class="keyword">(</span>l1<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> r1<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> l2<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> r2<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="staexp">env</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>env<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
intrange2_foreach$fwork <span class="keyword">(</span>i<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> j<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">env</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
streamize_intrange_l<span class="keyword">(</span>m<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">int</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
streamize_intrange_lr<span class="keyword">(</span>m<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">int</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* end of [intrange.sats] *)</span>
</pre>
<pre class="patsyntax">
<span class="comment">(***********************************************************************)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(*                         Applied Type System                         *)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(***********************************************************************)</span>

<span class="comment">(*
** ATS/Postiats - Unleashing the Potential of Types!
** Copyright (C) 2010-2015 Hongwei Xi, ATS Trustful Software, Inc.
** All rights reserved
**
** ATS is free software;  you can  redistribute it and/or modify it under
** the terms of  the GNU GENERAL PUBLIC LICENSE (GPL) as published by the
** Free Software Foundation; either version 3, or (at  your  option)  any
** later version.
**
** ATS is distributed in the hope that it will be useful, but WITHOUT ANY
** WARRANTY; without  even  the  implied  warranty  of MERCHANTABILITY or
** FITNESS FOR A PARTICULAR PURPOSE.  See the  GNU General Public License
** for more details.
**
** You  should  have  received  a  copy of the GNU General Public License
** along  with  ATS;  see the  file COPYING.  If not, please write to the
** Free Software Foundation,  51 Franklin Street, Fifth Floor, Boston, MA
** 02110-1301, USA.
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* Author: Hongwei Xi *)</span>
<span class="comment">(* Authoremail: gmhwxiATgmailDOTcom *)</span>
<span class="comment">(* Start time: February, 2012 *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
** Source:
** $PATSHOME/prelude/SATS/CODEGEN/list.atxt
** Time of generation: Mon Oct 17 22:01:13 2016
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="neuexp"><span class="keyword">#define</span> NSH <span class="keyword">(</span>x<span class="keyword">)</span> x</span> <span class="comment">// for commenting: no sharing</span>
<span class="neuexp"><span class="keyword">#define</span> SHR <span class="keyword">(</span>x<span class="keyword">)</span> x</span> <span class="comment">// for commenting: it is shared</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">#if</span><span class="neuexp"><span class="keyword">(</span>0<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">// HX:</span>
<span class="comment">// these declarations</span>
<span class="comment">// are available in [basic_dyn.sats]</span>
<span class="comment">//</span>
<span class="keyword">datatype</span>
<span class="staexp">list_t0ype_int_type
  <span class="keyword">(</span>a<span class="keyword">:</span><span class="keyword">t@ype+</span><span class="keyword">,</span> int<span class="keyword">)</span> <span class="keyword">=</span>
<span class="comment">//</span>
<span class="comment">// t@ype+: covariant</span>
<span class="comment">//</span>
  <span class="keyword">|</span> <span class="dynexp">list_nil <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">0</span><span class="keyword">)</span> <span class="keyword">of</span> <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span></span>
  <span class="keyword">|</span> <span class="dynexp"><span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int <span class="keyword">|</span> n &gt;= 0<span class="keyword">}</span></span>
    list_cons <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="staexp">+</span><span class="staexp">1</span><span class="keyword">)</span> <span class="keyword">of</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">list_t0ype_int_type</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span></span></span>
<span class="comment">// end of [list_t0ype_int_type]</span>
<span class="comment">//</span>
<span class="keyword">stadef</span> <span class="staexp">list <span class="keyword">=</span> <span class="staexp">list_t0ype_int_type</span></span>
<span class="keyword">typedef</span>
<span class="staexp">List<span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span>t0p</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>n<span class="keyword">:</span>int<span class="keyword">]</span></span> <span class="staexp">list</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span>
<span class="staexp">List0<span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span>t0p</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>n<span class="keyword">:</span>int <span class="keyword">|</span> n &gt;= 0<span class="keyword">]</span></span> <span class="staexp">list</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span>
<span class="staexp">List1<span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span>t0p</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>n<span class="keyword">:</span>int <span class="keyword">|</span> n &gt;= 1<span class="keyword">]</span></span> <span class="staexp">list</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span> <span class="staexp">listLt
  <span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span>t0p</span><span class="keyword">,</span> <span class="staexp">n<span class="keyword">:</span>int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>k<span class="keyword">:</span>nat <span class="keyword">|</span> k <span class="keyword">&lt;</span> n<span class="keyword">]</span></span> <span class="staexp">list</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">k</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span> <span class="staexp">listLte
  <span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span>t0p</span><span class="keyword">,</span> <span class="staexp">n<span class="keyword">:</span>int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>k<span class="keyword">:</span>nat <span class="keyword">|</span> k &lt;= n<span class="keyword">]</span></span> <span class="staexp">list</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">k</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span> <span class="staexp">listGt
  <span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span>t0p</span><span class="keyword">,</span> <span class="staexp">n<span class="keyword">:</span>int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>k<span class="keyword">:</span>int <span class="keyword">|</span> k <span class="keyword">&gt;</span> n<span class="keyword">]</span></span> <span class="staexp">list</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">k</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span> <span class="staexp">listGte
  <span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span>t0p</span><span class="keyword">,</span> <span class="staexp">n<span class="keyword">:</span>int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>k<span class="keyword">:</span>int <span class="keyword">|</span> k &gt;= n<span class="keyword">]</span></span> <span class="staexp">list</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">k</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span> <span class="staexp">listBtw
  <span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span>t0p</span><span class="keyword">,</span> <span class="staexp">m<span class="keyword">:</span>int</span><span class="keyword">,</span> <span class="staexp">n<span class="keyword">:</span>int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>k<span class="keyword">:</span>int <span class="keyword">|</span> m &lt;= k<span class="keyword">;</span> k <span class="keyword">&lt;</span> n<span class="keyword">]</span></span> <span class="staexp">list</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">k</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span> <span class="staexp">listBtwe
  <span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span>t0p</span><span class="keyword">,</span> <span class="staexp">m<span class="keyword">:</span>int</span><span class="keyword">,</span> <span class="staexp">n<span class="keyword">:</span>int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>k<span class="keyword">:</span>int <span class="keyword">|</span> m &lt;= k<span class="keyword">;</span> k &lt;= n<span class="keyword">]</span></span> <span class="staexp">list</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">k</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">#endif</span>

<span class="comment">(* ****** ****** *)</span>

<span class="neuexp"><span class="keyword">#define</span> nil list_nil</span>
<span class="neuexp"><span class="keyword">#define</span> cons list_cons</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">exception</span>
<span class="dynexp">ListSubscriptExn <span class="keyword">of</span> <span class="keyword">(</span><span class="keyword">)</span></span>
<span class="comment">(*
fun ListSubscriptExn ():&lt;&gt; exn = "mac#%ListSubscriptExn_make"
fun isListSubscriptExn (x: !exn):&lt;&gt; bool = "mac#%isListSubscriptExn"
macdef
ifListSubscriptExn
  {tres}(exn, body) =
(
let val x = ,(exn) in
(
if isListSubscriptExn(x)
  then
    let prval () = __vfree_exn (x) in ,(body) end
  else $raise (x)
) : tres // end of [if]
end (* end of [let] *)
) // end of [ifListSubscriptExn]
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="prfexp"><span class="keyword">prfun</span>
lemma_list_param
  <span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>t0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">list</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><span class="keyword">[</span>n &gt;= 0<span class="keyword">]</span></span> <span class="staexp">void</span></span>
<span class="comment">// end of [lemma_list_param]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">castfn</span>
list_cast
  <span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>t0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">list</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">list</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="comment">// end of [list_cast]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">castfn</span>
list_vt2t
  <span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>t0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">list</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">castfn</span>
list_of_list_vt
  <span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>t0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">list</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="neuexp"><span class="keyword">#define</span> list_sing<span class="keyword">(</span>x<span class="keyword">)</span>
  list_cons<span class="keyword">(</span>x<span class="keyword">,</span> list_nil<span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="neuexp"><span class="keyword">#define</span> list_pair<span class="keyword">(</span>x1<span class="keyword">,</span> x2<span class="keyword">)</span>
  list_cons<span class="keyword">(</span>x1<span class="keyword">,</span> list_cons <span class="keyword">(</span>x2<span class="keyword">,</span> list_nil<span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list_make_sing <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">x</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">1</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list_make_pair <span class="keyword">(</span>x1<span class="keyword">:</span> <span class="staexp">x</span><span class="keyword">,</span> x2<span class="keyword">:</span> <span class="staexp">x</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">2</span><span class="keyword">)</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list_make_elt
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>nat<span class="keyword">}</span></span> <span class="keyword">(</span>n<span class="keyword">:</span> <span class="staexp">int</span> <span class="staexp">n</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="staexp">x</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="comment">// end of [list_make_elt]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
<span class="keyword">}</span></span> list_make_intrange
  <span class="staexp"><span class="keyword">{</span>l<span class="keyword">,</span>r<span class="keyword">:</span>int <span class="keyword">|</span> l &lt;= r<span class="keyword">}</span></span>
  <span class="keyword">(</span>l<span class="keyword">:</span> <span class="staexp">int</span> <span class="staexp">l</span><span class="keyword">,</span> r<span class="keyword">:</span> <span class="staexp">int</span> <span class="staexp">r</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">intBtw</span> <span class="keyword">(</span><span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">r</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">r</span><span class="staexp">-</span><span class="staexp">l</span><span class="keyword">)</span></span>
<span class="comment">// end of [list_make_intrange]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
list_make_array
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span> <span class="keyword">(</span>
  A<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="keyword">@[</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">]</span><span class="keyword">[</span><span class="staexp">n</span><span class="keyword">]</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="keyword">@[</span><span class="staexp">a</span><span class="staexp">?!</span><span class="keyword">]</span><span class="keyword">[</span><span class="staexp">n</span><span class="keyword">]</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="staexp">n</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span> <span class="comment">// endfun</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="neuexp"><span class="keyword">symintr</span> list</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
list_make_arrpsz
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span> <span class="keyword">(</span>psz<span class="keyword">:</span> <span class="staexp">arrpsz</span> <span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">overload</span> list <span class="keyword">with</span> list_make_arrpsz</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
print_list<span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">List</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
prerr_list<span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">List</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
fprint_list<span class="keyword">(</span>out<span class="keyword">:</span> <span class="staexp">FILEref</span><span class="keyword">,</span> xs<span class="keyword">:</span> <span class="staexp">List</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
fprint_list_sep
  <span class="keyword">(</span>out<span class="keyword">:</span> <span class="staexp">FILEref</span><span class="keyword">,</span> xs<span class="keyword">:</span> <span class="staexp">List</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> sep<span class="keyword">:</span> <span class="staexp">NSH</span><span class="keyword">(</span><span class="staexp">string</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="comment">// end of [fprint_list_sep]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
fprint_list$sep <span class="keyword">(</span>out<span class="keyword">:</span> <span class="staexp">FILEref</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
fprint_listlist_sep
<span class="keyword">(</span> out<span class="keyword">:</span> <span class="staexp">FILEref</span>
<span class="keyword">,</span> xss<span class="keyword">:</span> <span class="staexp">List</span><span class="keyword">(</span><span class="staexp">List</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> sep1<span class="keyword">:</span> <span class="staexp">NSH</span><span class="keyword">(</span><span class="staexp">string</span><span class="keyword">)</span><span class="keyword">,</span> sep2<span class="keyword">:</span> <span class="staexp">NSH</span><span class="keyword">(</span><span class="staexp">string</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span></span> <span class="comment">// end of [fprint_listlist_sep]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
//
// HX: for testing macdef
//
macdef
fprintlst_mac
  {T:t@ype}(f, out, xs, sep) = let
//
val out = ,(out)
val xs  = ,(xs)
val sep = ,(sep)
//
fun loop (
  xs: List(T), i: int
) : void =
  case+ xs of
  | list_cons
      (x, xs) =&gt; let
      val () = if i &gt; 0 then fprint_string (out, sep)
      val () = ,(f) (out, x)
    in
      loop (xs, i+1)
    end
  | list_nil () =&gt; ()
//
in
  loop (xs, 0)
end // end of [fprintlst_mac]
*)</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
<span class="keyword">}</span></span> list_is_nil
  <span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>t0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span> <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">list</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span><span class="keyword">(</span><span class="staexp">n</span><span class="staexp">==</span><span class="staexp">0</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
<span class="keyword">}</span></span> list_is_cons
  <span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>t0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span> <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">list</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span><span class="keyword">(</span><span class="staexp">n</span> <span class="staexp"><span class="keyword">&gt;</span></span> <span class="staexp">0</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list_is_sing<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span> <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">list</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span><span class="keyword">(</span><span class="staexp">n</span><span class="staexp">==</span><span class="staexp">1</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list_is_pair<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span> <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">list</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span><span class="keyword">(</span><span class="staexp">n</span><span class="staexp">==</span><span class="staexp">2</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list_head<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>pos<span class="keyword">}</span></span> <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">list</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list_head_exn<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span> <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">list</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">exn</span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list_tail<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>pos<span class="keyword">}</span></span>
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">SHR</span><span class="keyword">(</span><span class="staexp">list</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">list</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">n</span><span class="staexp">-</span><span class="staexp">1</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list_tail_exn<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">SHR</span><span class="keyword">(</span><span class="staexp">list</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">exn</span><span class="keyword">&gt;</span> <span class="staexp">list</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">n</span><span class="staexp">-</span><span class="staexp">1</span><span class="keyword">)</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list_last<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>pos<span class="keyword">}</span></span> <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">list</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list_last_exn<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span> <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">list</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">exn</span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span></span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
x<span class="keyword">:</span>t0p
<span class="keyword">}</span></span> list_nth<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">list</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">natLt</span> <span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list_nth_opt
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">List</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">intGte</span> <span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">Option_vt</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list_get_at<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">list</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">natLt</span> <span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list_get_at_opt
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">List</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">intGte</span> <span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">Option_vt</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list_set_at<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>nat<span class="keyword">}</span></span>
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">list</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">natLt</span> <span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="staexp">x</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">list</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list_exch_at<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>nat<span class="keyword">}</span></span>
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">list</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">natLt</span> <span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="staexp">x</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="staexp">list</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">x</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list_insert_at
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span> <span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp">SHR</span><span class="keyword">(</span><span class="staexp">list</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">natLte</span> <span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="staexp">x</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">list</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">n</span><span class="staexp">+</span><span class="staexp">1</span><span class="keyword">)</span></span> <span class="comment">// end of [list_insert_at]</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list_remove_at
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span> <span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp">SHR</span><span class="keyword">(</span><span class="staexp">list</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">natLt</span> <span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">list</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">n</span><span class="staexp">-</span><span class="staexp">1</span><span class="keyword">)</span></span> <span class="comment">// end of [list_remove_at]</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list_takeout_at
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span> <span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp">SHR</span><span class="keyword">(</span><span class="staexp">list</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">natLt</span> <span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="staexp">?</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">x</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">list</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">n</span><span class="staexp">-</span><span class="staexp">1</span><span class="keyword">)</span></span> <span class="comment">// end of [list_takeout_at]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list_length
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span> <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">list</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int</span> <span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span></span>
<span class="comment">// end of [list_length]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
x<span class="keyword">:</span>t0p
<span class="keyword">}</span></span> list_copy
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">list</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="comment">// end of [list_copy]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list_append
  <span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp">NSH</span><span class="keyword">(</span><span class="staexp">list</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> ys<span class="keyword">:</span> <span class="staexp">SHR</span><span class="keyword">(</span><span class="staexp">list</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">list</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">m</span><span class="staexp">+</span><span class="staexp">n</span><span class="keyword">)</span></span> <span class="comment">// end of [list_append]</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>t0p
<span class="keyword">}</span></span> list_append1_vt
  <span class="staexp"><span class="keyword">{</span>i<span class="keyword">,</span>j<span class="keyword">:</span>int<span class="keyword">}</span></span> <span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span><span class="keyword">,</span> ys<span class="keyword">:</span> <span class="staexp">SHR</span><span class="keyword">(</span><span class="staexp">list</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">j</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">list</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">i</span><span class="staexp">+</span><span class="staexp">j</span><span class="keyword">)</span></span> <span class="comment">// endfun</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>t0p
<span class="keyword">}</span></span> list_append2_vt
  <span class="staexp"><span class="keyword">{</span>i<span class="keyword">,</span>j<span class="keyword">:</span>int<span class="keyword">}</span></span> <span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp">NSH</span><span class="keyword">(</span><span class="staexp">list</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> ys<span class="keyword">:</span> <span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">j</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">i</span><span class="staexp">+</span><span class="staexp">j</span><span class="keyword">)</span></span> <span class="comment">// endfun</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
x<span class="keyword">:</span>t0p
<span class="keyword">}</span></span> list_extend<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">list</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="staexp">x</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">n</span><span class="staexp">+</span><span class="staexp">1</span><span class="keyword">)</span></span>
<span class="comment">// end of [list_extend]</span>

<span class="dynexp"><span class="keyword">macdef</span> list_snoc <span class="dynexp"><span class="keyword">(</span>xs<span class="keyword">,</span> x<span class="keyword">)</span></span> <span class="keyword">=</span> list_extend <span class="keyword">(</span><span class="dynexp"><span class="keyword">,(</span>xs<span class="keyword">)</span></span><span class="keyword">,</span> <span class="dynexp"><span class="keyword">,(</span>x<span class="keyword">)</span></span><span class="keyword">)</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list_reverse
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span> <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">list</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="comment">// end of [list_reverse]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list_reverse_append<span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">NSH</span><span class="keyword">(</span><span class="staexp">list</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> ys<span class="keyword">:</span> <span class="staexp">SHR</span><span class="keyword">(</span><span class="staexp">list</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">list</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">m</span><span class="staexp">+</span><span class="staexp">n</span><span class="keyword">)</span></span>
<span class="comment">// end of [list_reverse_append]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list_reverse_append1_vt<span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">)</span><span class="keyword">,</span> ys<span class="keyword">:</span> <span class="staexp">SHR</span><span class="keyword">(</span><span class="staexp">list</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">list</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">m</span><span class="staexp">+</span><span class="staexp">n</span><span class="keyword">)</span></span>
<span class="comment">// end of [list_reverse_append1_vt]</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list_reverse_append2_vt<span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">NSH</span><span class="keyword">(</span><span class="staexp">list</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> ys<span class="keyword">:</span> <span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">m</span><span class="staexp">+</span><span class="staexp">n</span><span class="keyword">)</span></span>
<span class="comment">// end of [list_reverse_append2_vt]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">macdef</span> list_revapp <span class="keyword">=</span> list_reverse_append</span>
<span class="dynexp"><span class="keyword">macdef</span> list_revapp1_vt <span class="keyword">=</span> list_reverse_append1_vt</span>
<span class="dynexp"><span class="keyword">macdef</span> list_revapp2_vt <span class="keyword">=</span> list_reverse_append2_vt</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list_concat <span class="keyword">(</span>xss<span class="keyword">:</span> <span class="staexp">List</span><span class="keyword">(</span><span class="staexp">List</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">List0_vt</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span></span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
x<span class="keyword">:</span>t0p
<span class="keyword">}</span></span> list_take
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>i<span class="keyword">:</span>nat <span class="keyword">|</span> i &lt;= n<span class="keyword">}</span></span>
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">list</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">int</span> <span class="staexp">i</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
x<span class="keyword">:</span>t0p
<span class="keyword">}</span></span> list_take_exn
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>i<span class="keyword">:</span>nat<span class="keyword">}</span></span> <span class="comment">// it may raise [ListSubscriptException]</span>
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">list</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">int</span> <span class="staexp">i</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">exnwrt</span><span class="keyword">&gt;</span> <span class="staexp"><span class="keyword">[</span>i &lt;= n<span class="keyword">]</span></span> <span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
x<span class="keyword">:</span>t0p
<span class="keyword">}</span></span> list_drop
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>i<span class="keyword">:</span>nat <span class="keyword">|</span> i &lt;= n<span class="keyword">}</span></span>
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">SHR</span><span class="keyword">(</span><span class="staexp">list</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">int</span> <span class="staexp">i</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">list</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">n</span><span class="staexp">-</span><span class="staexp">i</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
x<span class="keyword">:</span>t0p
<span class="keyword">}</span></span> list_drop_exn
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>i<span class="keyword">:</span>nat<span class="keyword">}</span></span> <span class="comment">// it may raise [ListSubscriptException]</span>
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">SHR</span><span class="keyword">(</span><span class="staexp">list</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">int</span> <span class="staexp">i</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">exn</span><span class="keyword">&gt;</span> <span class="staexp"><span class="keyword">[</span>i &lt;= n<span class="keyword">]</span></span> <span class="staexp">list</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">n</span><span class="staexp">-</span><span class="staexp">i</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
x<span class="keyword">:</span>t0p
<span class="keyword">}</span></span> list_split_at
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>i<span class="keyword">:</span>nat <span class="keyword">|</span> i &lt;= n<span class="keyword">}</span></span>
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">SHR</span><span class="keyword">(</span><span class="staexp">list</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">int</span> <span class="staexp">i</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">list</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">n</span><span class="staexp">-</span><span class="staexp">i</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">// end of [list_split_at]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list_exists$pred<span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">x</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list_exists<span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">List</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list_exists_cloref
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">List</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> pred<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloref</span><span class="keyword">&gt;</span> <span class="staexp">bool</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list_iexists_cloref
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp">list</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> pred<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">natLt</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">x</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloref</span><span class="keyword">&gt;</span> <span class="staexp">bool</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span></span> <span class="comment">// end of [list_iexists_cloref]</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list_forall$pred<span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">x</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list_forall<span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">List</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list_forall_cloref
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">List</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> pred<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloref</span><span class="keyword">&gt;</span> <span class="staexp">bool</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list_iforall_cloref
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp">list</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> pred<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">natLt</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">x</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloref</span><span class="keyword">&gt;</span> <span class="staexp">bool</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span></span> <span class="comment">// end of [list_iforall_cloref]</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list_equal$eqfn<span class="keyword">(</span>x1<span class="keyword">:</span> <span class="staexp">x</span><span class="keyword">,</span> x2<span class="keyword">:</span> <span class="staexp">x</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list_equal<span class="keyword">(</span>xs1<span class="keyword">:</span> <span class="staexp">List</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> xs2<span class="keyword">:</span> <span class="staexp">List</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list_equal_cloref
  <span class="keyword">(</span><span class="staexp">List</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">List</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">,</span> eqfn<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">x</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloref</span><span class="keyword">&gt;</span> <span class="staexp">bool</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
x<span class="keyword">:</span>t0p
<span class="keyword">}</span></span> list_find<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp">list</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> x0<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="staexp">?</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">opt</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">i</span> <span class="staexp">&gt;=</span> <span class="staexp">0</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp"><span class="keyword">#[</span>i<span class="keyword">:</span>int <span class="keyword">|</span> i <span class="keyword">&lt;</span> n<span class="keyword">]</span></span> <span class="staexp">int</span><span class="keyword">(</span><span class="staexp">i</span><span class="keyword">)</span></span> <span class="comment">// end-of-function</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>t0p<span class="keyword">}</span></span> list_find$pred <span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>t0p<span class="keyword">}</span></span> list_find_exn <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">List</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">exn</span><span class="keyword">&gt;</span> <span class="staexp">x</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>t0p<span class="keyword">}</span></span> list_find_opt <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">List</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">Option_vt</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
key<span class="keyword">,</span>itm<span class="keyword">:</span>t0p
<span class="keyword">}</span></span> list_assoc
<span class="keyword">(</span>
  <span class="staexp">List</span> <span class="keyword">@(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">key</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">itm</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">key</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">itm</span><span class="staexp">?</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">opt</span><span class="keyword">(</span><span class="staexp">itm</span><span class="keyword">,</span> <span class="staexp">b</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp"><span class="keyword">#[</span>b<span class="keyword">:</span>bool<span class="keyword">]</span></span> <span class="staexp">bool</span><span class="keyword">(</span><span class="staexp">b</span><span class="keyword">)</span></span> <span class="comment">// end of [list_assoc]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>key<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list_assoc$eqfn <span class="keyword">(</span>k1<span class="keyword">:</span> <span class="staexp">key</span><span class="keyword">,</span> k2<span class="keyword">:</span> <span class="staexp">key</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
key<span class="keyword">,</span>itm<span class="keyword">:</span>t0p
<span class="keyword">}</span></span> list_assoc_exn
  <span class="keyword">(</span>kxs<span class="keyword">:</span> <span class="staexp">List</span> <span class="keyword">@(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">key</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">itm</span><span class="keyword">)</span><span class="keyword">,</span> k<span class="keyword">:</span> <span class="staexp">key</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">exn</span><span class="keyword">&gt;</span> <span class="staexp">itm</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
key<span class="keyword">,</span>itm<span class="keyword">:</span>t0p
<span class="keyword">}</span></span> list_assoc_opt
  <span class="keyword">(</span>kxs<span class="keyword">:</span> <span class="staexp">List</span> <span class="keyword">@(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">key</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">itm</span><span class="keyword">)</span><span class="keyword">,</span> k<span class="keyword">:</span> <span class="staexp">key</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">Option_vt</span><span class="keyword">(</span><span class="staexp">itm</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
x<span class="keyword">:</span>t0p
<span class="keyword">}</span></span> list_filter<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">list</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">listLte_vt</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>t0p<span class="keyword">}</span></span> list_filter$pred <span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">bool</span></span>
<span class="comment">//</span>
<span class="comment">(*
fun{
x:t0p
} list_filter_funenv
  {v:view}{vt:viewtype}{n:int}{fe:eff}
(
  pfv: !v |
  xs: list(INV(x), n)
, f: (!v | x, !vt) -&lt;fun,fe&gt; bool, env: !vt
) :&lt;fe,!wrt&gt; listLte_vt(x, n) // end-of-function
*)</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
x<span class="keyword">:</span>t0p
<span class="keyword">}</span></span> list_labelize<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">list</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">list_vt</span><span class="keyword">(</span><span class="keyword">@(</span><span class="staexp">int</span><span class="keyword">,</span> <span class="staexp">x</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="comment">// end of [list_labelize]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list_app <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">List</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>t0p<span class="keyword">}</span></span> list_app$fwork <span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list_app_fun
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">List</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> fwork<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">fun1</span><span class="keyword">&gt;</span> <span class="staexp">void</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list_app_clo
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">List</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> fwork<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">clo1</span><span class="keyword">&gt;</span> <span class="staexp">void</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list_app_cloref
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">List</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> fwork<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloref1</span><span class="keyword">&gt;</span> <span class="staexp">void</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">(*
fun{
x:t0p
} list_app_funenv
  {v:view}{vt:viewtype}{n:int}{fe:eff} (
  pfv: !v |
  xs: list(INV(x), n)
, f: (!v | x, !vt) -&lt;fun,fe&gt; void, env: !vt
) :&lt;fe&gt; void // end of [list_app_funenv]
*)</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
x<span class="keyword">:</span>t0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>y<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> list_map<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">list</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">y</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="comment">// end of [list_map]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>t0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>y<span class="keyword">:</span>vt0p<span class="keyword">}</span></span> list_map$fopr <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">x</span><span class="keyword">)</span><span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">y</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
x<span class="keyword">:</span>t0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>y<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> list_map_fun<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">list</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> f<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">fun1</span><span class="keyword">&gt;</span> <span class="staexp">y</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">y</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
x<span class="keyword">:</span>t0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>y<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> list_map_clo<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">list</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> f<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">clo1</span><span class="keyword">&gt;</span> <span class="staexp">y</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">y</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
x<span class="keyword">:</span>t0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>y<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> list_map_cloref<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">list</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> f<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloref1</span><span class="keyword">&gt;</span> <span class="staexp">y</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">y</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
fun{
x:t0p}{y:vt0p
} list_map_funenv
  {v:view}{vt:viewtype}{n:int}{fe:eff} (
  pfv: !v |
  xs: list(INV(x), n)
, f: (!v | x, !vt) -&lt;fun,fe&gt; y, env: !vt
) :&lt;fe,!wrt&gt; list_vt(y, n) // end of [list_map_funenv]
*)</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
x<span class="keyword">:</span>t0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>y<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> list_imap<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">list</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">y</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
x<span class="keyword">:</span>t0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>y<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> list_imap$fopr <span class="keyword">(</span>i<span class="keyword">:</span> <span class="staexp">intGte</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="staexp">x</span><span class="keyword">)</span><span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">y</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
x<span class="keyword">:</span>t0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>y<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> list_mapopt<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">list</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">listLte_vt</span><span class="keyword">(</span><span class="staexp">y</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
x<span class="keyword">:</span>t0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>y<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> list_mapopt$fopr <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">x</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">Option_vt</span><span class="keyword">(</span><span class="staexp">y</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(*
fun{
x:t0p}{y:t0p
} list_mapopt_funenv
  {v:view}{vt:viewtype}{n:int}{fe:eff} (
  pfv: !v |
  xs: list(INV(x), n)
, f: (!v | x, !vt) -&lt;fun,fe&gt; Option_vt(y), env: !vt
) :&lt;fe&gt; listLte_vt(y, n) // end of [list_mapopt_funenv]
*)</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
x1<span class="keyword">,</span>x2<span class="keyword">:</span>t0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>y<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> list_map2<span class="staexp"><span class="keyword">{</span>n1<span class="keyword">,</span>n2<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  xs1<span class="keyword">:</span> <span class="staexp">list</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x1</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n1</span><span class="keyword">)</span>
<span class="keyword">,</span> xs2<span class="keyword">:</span> <span class="staexp">list</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x2</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n2</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">y</span><span class="keyword">,</span> <span class="staexp">min</span><span class="keyword">(</span><span class="staexp">n1</span><span class="keyword">,</span><span class="staexp">n2</span><span class="keyword">)</span><span class="keyword">)</span></span> <span class="comment">// end of [list_map2]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
x1<span class="keyword">,</span>x2<span class="keyword">:</span>t0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>y<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> list_map2$fopr <span class="keyword">(</span>x1<span class="keyword">:</span> <span class="staexp">x1</span><span class="keyword">,</span> x2<span class="keyword">:</span> <span class="staexp">x2</span><span class="keyword">)</span><span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">y</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(*
fun{
x1,x2:t0p}{y:t0p
} list_map2_funenv
  {v:view}{vt:viewtype}{n1,n2:int}{fe:eff}
(
  pfv: !v |
  xs1: list(INV(x1), n1)
, xs2: list(INV(x2), n2)
, f: (!v | x1, x2, !vt) -&lt;fun,fe&gt; y, env: !vt
) :&lt;fe&gt; list_vt(y, min(n1,n2)) // end of [list_map2_funenv]
*)</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> list_tabulate<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>nat<span class="keyword">}</span></span> <span class="keyword">(</span><span class="staexp">int</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span> list_tabulate$fopr <span class="keyword">(</span>index<span class="keyword">:</span> <span class="staexp">intGte</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> list_tabulate_fun<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>nat<span class="keyword">}</span></span>
  <span class="keyword">(</span>n<span class="keyword">:</span> <span class="staexp">int</span> <span class="staexp">n</span><span class="keyword">,</span> f<span class="keyword">:</span> <span class="staexp">natLt</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">fun1</span><span class="keyword">&gt;</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> list_tabulate_clo<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>nat<span class="keyword">}</span></span>
  <span class="keyword">(</span>n<span class="keyword">:</span> <span class="staexp">int</span> <span class="staexp">n</span><span class="keyword">,</span> f<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="staexp">natLt</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">clo1</span><span class="keyword">&gt;</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> list_tabulate_cloref<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>nat<span class="keyword">}</span></span>
  <span class="keyword">(</span>n<span class="keyword">:</span> <span class="staexp">int</span> <span class="staexp">n</span><span class="keyword">,</span> f<span class="keyword">:</span> <span class="staexp">natLt</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloref1</span><span class="keyword">&gt;</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
x<span class="keyword">,</span>y<span class="keyword">:</span>t0p
<span class="keyword">}</span></span> list_zip<span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp">list</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">)</span><span class="keyword">,</span> ys<span class="keyword">:</span> <span class="staexp">list</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">y</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">list_vt</span><span class="keyword">(</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">y</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">min</span><span class="keyword">(</span><span class="staexp">m</span><span class="keyword">,</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span></span> <span class="comment">// endfun</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
x<span class="keyword">,</span>y<span class="keyword">:</span>t0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>xy<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> list_zipwith<span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp">list</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">)</span><span class="keyword">,</span> ys<span class="keyword">:</span> <span class="staexp">list</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">y</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">xy</span><span class="keyword">,</span> <span class="staexp">min</span><span class="keyword">(</span><span class="staexp">m</span><span class="keyword">,</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span></span> <span class="comment">// endfun</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
x<span class="keyword">,</span>y<span class="keyword">:</span>t0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>xy<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> list_zipwith$fopr <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">x</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">y</span><span class="keyword">)</span><span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">xy</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
x<span class="keyword">,</span>y<span class="keyword">:</span>t0p
<span class="keyword">}</span></span> list_cross<span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp">list</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">)</span><span class="keyword">,</span> ys<span class="keyword">:</span> <span class="staexp">list</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">y</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">list_vt</span><span class="keyword">(</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">y</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">m</span><span class="staexp">*</span><span class="staexp">n</span><span class="keyword">)</span></span> <span class="comment">// endfun</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
x<span class="keyword">,</span>y<span class="keyword">:</span>t0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>xy<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> list_crosswith<span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp">list</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">)</span><span class="keyword">,</span> ys<span class="keyword">:</span> <span class="staexp">list</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">y</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">xy</span><span class="keyword">,</span> <span class="staexp">m</span><span class="staexp">*</span><span class="staexp">n</span><span class="keyword">)</span></span> <span class="comment">// end of [list_crosswith]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
x<span class="keyword">,</span>y<span class="keyword">:</span>t0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>xy<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> list_crosswith$fopr <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">x</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">y</span><span class="keyword">)</span><span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">xy</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
x<span class="keyword">:</span>t0p
<span class="keyword">}</span></span> list_foreach <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">List</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
x<span class="keyword">:</span>t0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>env<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> list_foreach_env
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">List</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="staexp">env</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
x<span class="keyword">:</span>t0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>env<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> list_foreach$cont <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">x</span><span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">env</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">bool</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
x<span class="keyword">:</span>t0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>env<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> list_foreach$fwork <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">x</span><span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="staexp">env</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list_foreach_fun
  <span class="staexp"><span class="keyword">{</span>fe<span class="keyword">:</span>eff<span class="keyword">}</span></span> <span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp">List</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> f<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp"><span class="keyword">fun</span></span><span class="keyword">,</span><span class="staexp">fe</span><span class="keyword">&gt;</span> <span class="staexp">void</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="staexp">fe</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span> <span class="comment">// end of [list_foreach_fun]</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list_foreach_clo
  <span class="staexp"><span class="keyword">{</span>fe<span class="keyword">:</span>eff<span class="keyword">}</span></span> <span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp">List</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> f<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">clo</span><span class="keyword">,</span><span class="staexp">fe</span><span class="keyword">&gt;</span> <span class="staexp">void</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="staexp">fe</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span> <span class="comment">// end of [list_foreach_clo]</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list_foreach_vclo
  <span class="staexp"><span class="keyword">{</span>v<span class="keyword">:</span>view<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>fe<span class="keyword">:</span>eff<span class="keyword">}</span></span> <span class="keyword">(</span>
  <span class="prfexp">pf<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">v</span></span> <span class="keyword">|</span> xs<span class="keyword">:</span> <span class="staexp">List</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> f<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="staexp"><span class="keyword">!</span></span><span class="staexp">v</span> <span class="keyword">|</span> <span class="staexp">x</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">clo</span><span class="keyword">,</span><span class="staexp">fe</span><span class="keyword">&gt;</span> <span class="staexp">void</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="staexp">fe</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span> <span class="comment">// end of [list_foreach_vclo]</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list_foreach_cloptr
  <span class="staexp"><span class="keyword">{</span>fe<span class="keyword">:</span>eff<span class="keyword">}</span></span> <span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp">List</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> f<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloptr</span><span class="keyword">,</span><span class="staexp">fe</span><span class="keyword">&gt;</span> <span class="staexp">void</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="staexp">fe</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span> <span class="comment">// end of [list_foreach_cloptr]</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list_foreach_vcloptr
  <span class="staexp"><span class="keyword">{</span>v<span class="keyword">:</span>view<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>fe<span class="keyword">:</span>eff<span class="keyword">}</span></span> <span class="keyword">(</span>
  <span class="prfexp">pf<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">v</span></span> <span class="keyword">|</span> xs<span class="keyword">:</span> <span class="staexp">List</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> f<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="keyword">(</span><span class="staexp"><span class="keyword">!</span></span><span class="staexp">v</span> <span class="keyword">|</span> <span class="staexp">x</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloptr</span><span class="keyword">,</span><span class="staexp">fe</span><span class="keyword">&gt;</span> <span class="staexp">void</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="staexp">fe</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span> <span class="comment">// end of [list_foreach_vcloptr]</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list_foreach_cloref
  <span class="staexp"><span class="keyword">{</span>fe<span class="keyword">:</span>eff<span class="keyword">}</span></span> <span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp">List</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> f<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloref</span><span class="keyword">,</span><span class="staexp">fe</span><span class="keyword">&gt;</span> <span class="staexp">void</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="staexp">fe</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span> <span class="comment">// end of [list_foreach_cloref]</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list_foreach_funenv
  <span class="staexp"><span class="keyword">{</span>v<span class="keyword">:</span>view<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>env<span class="keyword">:</span>viewtype<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>fe<span class="keyword">:</span>eff<span class="keyword">}</span></span>
<span class="keyword">(</span>
  <span class="prfexp">pfv<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">v</span></span>
<span class="keyword">|</span> xs<span class="keyword">:</span> <span class="staexp">List</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">,</span> f<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp"><span class="keyword">!</span></span><span class="staexp">v</span> <span class="keyword">|</span> <span class="staexp">x</span><span class="keyword">,</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">env</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp"><span class="keyword">fun</span></span><span class="keyword">,</span><span class="staexp">fe</span><span class="keyword">&gt;</span> <span class="staexp">void</span>
<span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">env</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="staexp">fe</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span> <span class="comment">// end of [list_foreach_funenv]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
x<span class="keyword">,</span>y<span class="keyword">:</span>t0p
<span class="keyword">}</span></span> list_foreach2
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">List</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> ys<span class="keyword">:</span> <span class="staexp">List</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">y</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
x<span class="keyword">,</span>y<span class="keyword">:</span>t0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>env<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> list_foreach2_env
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">List</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> ys<span class="keyword">:</span> <span class="staexp">List</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">y</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="staexp">env</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
x<span class="keyword">,</span>y<span class="keyword">:</span>t0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>env<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> list_foreach2$cont<span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">x</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">y</span><span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">env</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">bool</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
x<span class="keyword">,</span>y<span class="keyword">:</span>t0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>env<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> list_foreach2$fwork<span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">x</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">y</span><span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="staexp">env</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
x<span class="keyword">:</span>t0p
<span class="keyword">}</span></span> list_iforeach<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">list</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">natLte</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span></span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
x<span class="keyword">:</span>t0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>env<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> list_iforeach_env<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">list</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="staexp">env</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">natLte</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
x<span class="keyword">:</span>t0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>env<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> list_iforeach$cont<span class="keyword">(</span>i<span class="keyword">:</span> <span class="staexp">intGte</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="staexp">x</span><span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">env</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">bool</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
x<span class="keyword">:</span>t0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>env<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> list_iforeach$fwork<span class="keyword">(</span>i<span class="keyword">:</span> <span class="staexp">intGte</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="staexp">x</span><span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="staexp">env</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
x<span class="keyword">:</span>t0p
<span class="keyword">}</span></span> list_iforeach_cloref
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp">list</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">,</span> fwork<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">natLt</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">x</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloref1</span><span class="keyword">&gt;</span> <span class="staexp">void</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span></span> <span class="comment">// end of [list_iforeach_cloref]</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
x<span class="keyword">:</span>t0p <span class="comment">// type for elements</span>
<span class="keyword">}</span></span> list_iforeach_funenv
  <span class="staexp"><span class="keyword">{</span>v<span class="keyword">:</span>view<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>vt<span class="keyword">:</span>viewtype<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>fe<span class="keyword">:</span>eff<span class="keyword">}</span></span> <span class="keyword">(</span>
  <span class="prfexp">pfv<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">v</span></span> <span class="keyword">|</span>
  xs<span class="keyword">:</span> <span class="staexp">list</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">,</span> fwork<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp"><span class="keyword">!</span></span><span class="staexp">v</span> <span class="keyword">|</span> <span class="staexp">natLt</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">x</span><span class="keyword">,</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">vt</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp"><span class="keyword">fun</span></span><span class="keyword">,</span><span class="staexp">fe</span><span class="keyword">&gt;</span> <span class="staexp">void</span><span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">vt</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="staexp">fe</span><span class="keyword">&gt;</span> <span class="staexp">int</span> <span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span></span> <span class="comment">// end of [list_iforeach_funenv]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
x<span class="keyword">,</span>y<span class="keyword">:</span>t0p
<span class="keyword">}</span></span> list_iforeach2<span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp">list</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">)</span><span class="keyword">,</span> ys<span class="keyword">:</span> <span class="staexp">list</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">y</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">natLte</span><span class="keyword">(</span><span class="staexp">min</span><span class="keyword">(</span><span class="staexp">m</span><span class="keyword">,</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span></span> <span class="comment">// end-of-function</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
x<span class="keyword">,</span>y<span class="keyword">:</span>t0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>env<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> list_iforeach2_env<span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp">list</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">)</span><span class="keyword">,</span> ys<span class="keyword">:</span> <span class="staexp">list</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">y</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="staexp">env</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">natLte</span><span class="keyword">(</span><span class="staexp">min</span><span class="keyword">(</span><span class="staexp">m</span><span class="keyword">,</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span></span> <span class="comment">// end-of-function</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
x<span class="keyword">,</span>y<span class="keyword">:</span>t0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>env<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> list_iforeach2$cont
  <span class="keyword">(</span>i<span class="keyword">:</span> <span class="staexp">intGte</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="staexp">x</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">y</span><span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">env</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">bool</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
x<span class="keyword">,</span>y<span class="keyword">:</span>t0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>env<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> list_iforeach2$fwork
  <span class="keyword">(</span>i<span class="keyword">:</span> <span class="staexp">intGte</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="staexp">x</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">y</span><span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="staexp">env</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
res<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>t0p
<span class="keyword">}</span></span> list_foldleft
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">List</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> ini<span class="keyword">:</span> <span class="staexp">res</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">res</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
res<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>t0p
<span class="keyword">}</span></span> list_foldleft$fopr <span class="keyword">(</span>acc<span class="keyword">:</span> <span class="staexp">res</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="staexp">x</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">res</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
x<span class="keyword">:</span>t0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>res<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> list_foldright
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">List</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> snk<span class="keyword">:</span> <span class="staexp">res</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">res</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
x<span class="keyword">:</span>t0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>res<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> list_foldright$fopr <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">x</span><span class="keyword">,</span> acc<span class="keyword">:</span> <span class="staexp">res</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">res</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>t0p
<span class="keyword">}</span></span> list_mergesort<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">list</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list_mergesort$cmp <span class="keyword">(</span>x1<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">,</span> x2<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int</span></span> <span class="comment">(* sign *)</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>t0p
<span class="keyword">}</span></span> list_mergesort_fun
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span> <span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp">list</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> cmp<span class="keyword">:</span> <span class="staexp">cmpval</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span> <span class="comment">// end of [list_mergesort_fun]</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>t0p
<span class="keyword">}</span></span> list_mergesort_cloref
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span> <span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp">list</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> cmp<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">a</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloref</span><span class="keyword">&gt;</span> <span class="staexp">int</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span> <span class="comment">// end of [list_mergesort_cloref]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>t0p
<span class="keyword">}</span></span> list_quicksort<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">list</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list_quicksort$cmp <span class="keyword">(</span>x1<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">,</span> x2<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int</span></span> <span class="comment">(* sign *)</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>t0p
<span class="keyword">}</span></span> list_quicksort_fun
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span> <span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp">list</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> cmp<span class="keyword">:</span> <span class="staexp">cmpval</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span> <span class="comment">// end-of-function</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
streamize_list_elt
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">List</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
streamize_list_choose2
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">List</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="keyword">@(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">,</span>b<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
streamize_list_zip
  <span class="keyword">(</span><span class="staexp">List</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">List</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">b</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="keyword">@(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">b</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">,</span>b<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
streamize_list_cross
  <span class="keyword">(</span><span class="staexp">List</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">List</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">b</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="keyword">@(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">b</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">// overloading for certain symbols</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">=</span> <span class="keyword">with</span> list_equal</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> + <span class="keyword">with</span> list_append</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">[</span><span class="keyword">]</span> <span class="keyword">with</span> list_get_at</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> iseqz <span class="keyword">with</span> list_is_nil</span>
<span class="dynexp"><span class="keyword">overload</span> isneqz <span class="keyword">with</span> list_is_cons</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">.</span>head <span class="keyword">with</span> list_head</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">.</span>tail <span class="keyword">with</span> list_tail</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> length <span class="keyword">with</span> list_length</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> copy <span class="keyword">with</span> list_copy</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> print <span class="keyword">with</span> print_list</span>
<span class="dynexp"><span class="keyword">overload</span> prerr <span class="keyword">with</span> prerr_list</span>
<span class="dynexp"><span class="keyword">overload</span> fprint <span class="keyword">with</span> fprint_list</span>
<span class="dynexp"><span class="keyword">overload</span> fprint <span class="keyword">with</span> fprint_list_sep</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* end of [list.sats] *)</span>
</pre>
<pre class="patsyntax">
<span class="comment">(***********************************************************************)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(*                         Applied Type System                         *)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(***********************************************************************)</span>

<span class="comment">(*
** ATS/Postiats - Unleashing the Potential of Types!
** Copyright (C) 2010-2015 Hongwei Xi, ATS Trustful Software, Inc.
** All rights reserved
**
** ATS is free software;  you can  redistribute it and/or modify it under
** the terms of  the GNU GENERAL PUBLIC LICENSE (GPL) as published by the
** Free Software Foundation; either version 3, or (at  your  option)  any
** later version.
**
** ATS is distributed in the hope that it will be useful, but WITHOUT ANY
** WARRANTY; without  even  the  implied  warranty  of MERCHANTABILITY or
** FITNESS FOR A PARTICULAR PURPOSE.  See the  GNU General Public License
** for more details.
**
** You  should  have  received  a  copy of the GNU General Public License
** along  with  ATS;  see the  file COPYING.  If not, please write to the
** Free Software Foundation,  51 Franklin Street, Fifth Floor, Boston, MA
** 02110-1301, USA.
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
** Source:
** $PATSHOME/prelude/SATS/CODEGEN/list_vt.atxt
** Time of generation: Mon Sep  5 21:48:35 2016
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* Author: Hongwei Xi *)</span>
<span class="comment">(* Authoremail: hwxi AT cs DOT bu DOT edu *)</span>
<span class="comment">(* Start time: February, 2012 *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">vtypedef</span>
<span class="staexp">RD<span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span>vt0p</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">a</span></span> <span class="comment">// for commenting: read-only</span>
<span class="neuexp"><span class="keyword">#define</span> NSH <span class="keyword">(</span>x<span class="keyword">)</span> x</span> <span class="comment">// for commenting: no sharing</span>
<span class="neuexp"><span class="keyword">#define</span> SHR <span class="keyword">(</span>x<span class="keyword">)</span> x</span> <span class="comment">// for commenting: it is shared</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">#if</span><span class="neuexp"><span class="keyword">(</span>0<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">// HX: these decls are available in [basic_dyn.sats]</span>
<span class="comment">//</span>
<span class="keyword">datavtype</span>
<span class="staexp">list_vt0ype_int_vtype
  <span class="keyword">(</span>a<span class="keyword">:</span><span class="keyword">vt@ype+</span><span class="keyword">,</span> int<span class="keyword">)</span> <span class="keyword">=</span>
<span class="comment">//</span>
<span class="comment">// vt@ype+: covariant</span>
<span class="comment">//</span>
  <span class="keyword">|</span> <span class="dynexp">list_vt_nil<span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">0</span><span class="keyword">)</span> <span class="keyword">of</span> <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span></span>
  <span class="keyword">|</span> <span class="dynexp"><span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int <span class="keyword">|</span> n &gt;= 0<span class="keyword">}</span></span>
    list_vt_cons<span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="staexp">+</span><span class="staexp">1</span><span class="keyword">)</span> <span class="keyword">of</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">list_vt0ype_int_vtype</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span></span></span>
<span class="comment">// end of [list_vt0ype_int_vtype]</span>
<span class="comment">//</span>
<span class="keyword">stadef</span> <span class="staexp">list_vt <span class="keyword">=</span> <span class="staexp">list_vt0ype_int_vtype</span></span>
<span class="keyword">vtypedef</span>
<span class="staexp">List_vt<span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span>vt0p</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>n<span class="keyword">:</span>int<span class="keyword">]</span></span> <span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="keyword">vtypedef</span>
<span class="staexp">List0_vt<span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span>vt0p</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>n<span class="keyword">:</span>int <span class="keyword">|</span> n &gt;= 0<span class="keyword">]</span></span> <span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="keyword">vtypedef</span>
<span class="staexp">List1_vt<span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span>vt0p</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>n<span class="keyword">:</span>int <span class="keyword">|</span> n &gt;= 1<span class="keyword">]</span></span> <span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="keyword">vtypedef</span> <span class="staexp">listLt_vt
  <span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span>vt0p</span><span class="keyword">,</span> <span class="staexp">n<span class="keyword">:</span>int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>k<span class="keyword">:</span>nat <span class="keyword">|</span> k <span class="keyword">&lt;</span> n<span class="keyword">]</span></span> <span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">k</span><span class="keyword">)</span></span>
<span class="keyword">vtypedef</span> <span class="staexp">listLte_vt
  <span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span>vt0p</span><span class="keyword">,</span> <span class="staexp">n<span class="keyword">:</span>int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>k<span class="keyword">:</span>nat <span class="keyword">|</span> k &lt;= n<span class="keyword">]</span></span> <span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">k</span><span class="keyword">)</span></span>
<span class="keyword">vtypedef</span> <span class="staexp">listGt_vt
  <span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span>vt0p</span><span class="keyword">,</span> <span class="staexp">n<span class="keyword">:</span>int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>k<span class="keyword">:</span>int <span class="keyword">|</span> k <span class="keyword">&gt;</span> n<span class="keyword">]</span></span> <span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">k</span><span class="keyword">)</span></span>
<span class="keyword">vtypedef</span> <span class="staexp">listGte_vt
  <span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span>vt0p</span><span class="keyword">,</span> <span class="staexp">n<span class="keyword">:</span>int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>k<span class="keyword">:</span>int <span class="keyword">|</span> k &gt;= n<span class="keyword">]</span></span> <span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">k</span><span class="keyword">)</span></span>
<span class="keyword">vtypedef</span> <span class="staexp">listBtw_vt
  <span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span>vt0p</span><span class="keyword">,</span> <span class="staexp">m<span class="keyword">:</span>int</span><span class="keyword">,</span> <span class="staexp">n<span class="keyword">:</span>int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>k<span class="keyword">:</span>int <span class="keyword">|</span> m &lt;= k<span class="keyword">;</span> k <span class="keyword">&lt;</span> n<span class="keyword">]</span></span> <span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">k</span><span class="keyword">)</span></span>
<span class="keyword">vtypedef</span> <span class="staexp">listBtwe_vt
  <span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span>vt0p</span><span class="keyword">,</span> <span class="staexp">m<span class="keyword">:</span>int</span><span class="keyword">,</span> <span class="staexp">n<span class="keyword">:</span>int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>k<span class="keyword">:</span>int <span class="keyword">|</span> m &lt;= k<span class="keyword">;</span> k &lt;= n<span class="keyword">]</span></span> <span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">k</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">#endif</span>

<span class="comment">(* ****** ****** *)</span>

<span class="neuexp"><span class="keyword">#define</span> nil_vt list_vt_nil</span>
<span class="neuexp"><span class="keyword">#define</span> cons_vt list_vt_cons</span>

<span class="comment">(* ****** ****** *)</span>

<span class="prfexp"><span class="keyword">prfun</span>
lemma_list_vt_param
  <span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><span class="keyword">[</span>n &gt;= 0<span class="keyword">]</span></span> <span class="staexp">void</span></span>
<span class="comment">// end of [lemma_list_vt_param]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">castfn</span>
list_vt_cast
  <span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="comment">// end of [list_vt_cast]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="neuexp"><span class="keyword">#define</span> list_vt_sing<span class="keyword">(</span>x<span class="keyword">)</span>
  list_vt_cons<span class="keyword">(</span>x<span class="keyword">,</span> list_vt_nil<span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="neuexp"><span class="keyword">#define</span> list_vt_pair<span class="keyword">(</span>x1<span class="keyword">,</span> x2<span class="keyword">)</span>
  list_vt_cons<span class="keyword">(</span>x1<span class="keyword">,</span> list_vt_cons <span class="keyword">(</span>x2<span class="keyword">,</span> list_vt_nil<span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
list_vt_make_sing <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">x</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">1</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
list_vt_make_pair <span class="keyword">(</span>x1<span class="keyword">:</span> <span class="staexp">x</span><span class="keyword">,</span> x2<span class="keyword">:</span> <span class="staexp">x</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">2</span><span class="keyword">)</span></span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
print_list_vt<span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">List_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
prerr_list_vt<span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">List_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
fprint_list_vt
  <span class="keyword">(</span>out<span class="keyword">:</span> <span class="staexp">FILEref</span><span class="keyword">,</span> xs<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">List_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span> fprint_list_vt$sep <span class="keyword">(</span>out<span class="keyword">:</span> <span class="staexp">FILEref</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
fprint_list_vt_sep
<span class="keyword">(</span>
  out<span class="keyword">:</span> <span class="staexp">FILEref</span><span class="keyword">,</span> xs<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">List_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> sep<span class="keyword">:</span> <span class="staexp">NSH</span><span class="keyword">(</span><span class="staexp">string</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span></span> <span class="comment">// end of [fprint_list_vt_sep]</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
list_vt_is_nil
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span> <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">(</span><span class="staexp">n</span><span class="staexp">==</span><span class="staexp">0</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
list_vt_is_cons
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span> <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">(</span><span class="staexp">n</span> <span class="staexp"><span class="keyword">&gt;</span></span> <span class="staexp">0</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
list_vt_is_sing
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span> <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">(</span><span class="staexp">n</span><span class="staexp">==</span><span class="staexp">1</span><span class="keyword">)</span></span>
<span class="comment">// end of [list_vt_is_sing]</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
list_vt_is_pair
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span> <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">(</span><span class="staexp">n</span><span class="staexp">==</span><span class="staexp">2</span><span class="keyword">)</span></span>
<span class="comment">// end of [list_vt_is_pair]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
list_vt_unnil<span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>vt0p<span class="keyword">}</span></span> <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">0</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
list_vt_uncons<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>pos<span class="keyword">}</span></span>
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">n</span><span class="staexp">-</span><span class="staexp">1</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">x</span></span>
<span class="comment">// end of [list_vt_uncons]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
list_vt_length<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span> <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int</span> <span class="staexp">n</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
list_vt_getref_at
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>i<span class="keyword">:</span>nat <span class="keyword">|</span> i &lt;= n<span class="keyword">}</span></span>
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">int</span> <span class="staexp">i</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">cPtr1</span> <span class="keyword">(</span><span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">n</span><span class="staexp">-</span><span class="staexp">i</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">// end of [list_vt_getref_at]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list_vt_get_at<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">natLt</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">x</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list_vt_set_at<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">natLt</span> <span class="staexp">n</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="staexp">x</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
list_vt_exch_at<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">natLt</span> <span class="staexp">n</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">x</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span>
<span class="comment">// end of [list_vt_exch_at]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
list_vt_insert_at<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">n</span><span class="staexp">+</span><span class="staexp">1</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">natLte</span> <span class="staexp">n</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="staexp">x</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span> <span class="comment">// end of [list_vt_insert_at]</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
list_vt_takeout_at<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">n</span><span class="staexp">-</span><span class="staexp">1</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">natLt</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">x</span></span>
<span class="comment">// end of [list_vt_takeout_at]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list_vt_copy<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="comment">// end of [list_vt_copy]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
list_vt_copylin<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
list_vt_copylin$copy <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">RD</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
list_vt_copylin_fun<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>fe<span class="keyword">:</span>eff<span class="keyword">}</span></span>
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> f<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">&amp;</span><span class="staexp">RD</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">fe</span><span class="keyword">&gt;</span> <span class="staexp">x</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">,</span><span class="staexp">fe</span><span class="keyword">&gt;</span> <span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list_vt_free <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">List_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
list_vt_freelin
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">List_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
list_vt_freelin$clear <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">x</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">x</span><span class="staexp">?</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
list_vt_freelin_fun<span class="staexp"><span class="keyword">{</span>fe<span class="keyword">:</span>eff<span class="keyword">}</span></span>
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">List_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> f<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">&amp;</span><span class="staexp">x</span><span class="staexp">&gt;&gt;</span><span class="staexp">x</span><span class="staexp">?</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">fe</span><span class="keyword">&gt;</span> <span class="staexp">void</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">,</span><span class="staexp">fe</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
x<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> list_vt_uninitize
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span> <span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">x</span><span class="staexp">?</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span> <span class="comment">// end of [list_vt_uninitize]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
list_vt_uninitize$clear <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">x</span><span class="staexp">?</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
x<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> list_vt_uninitize_fun
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>fe<span class="keyword">:</span>eff<span class="keyword">}</span></span>
<span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">x</span><span class="staexp">?</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> f<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">&amp;</span><span class="staexp">x</span><span class="staexp">&gt;&gt;</span><span class="staexp">x</span><span class="staexp">?</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">fe</span><span class="keyword">&gt;</span> <span class="staexp">void</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">,</span><span class="staexp">fe</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span> <span class="comment">// end of [list_vt_uninitize_fun]</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> list_vt_append
  <span class="staexp"><span class="keyword">{</span>n1<span class="keyword">,</span>n2<span class="keyword">:</span>int<span class="keyword">}</span></span> <span class="keyword">(</span>
  xs1<span class="keyword">:</span> <span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n1</span><span class="keyword">)</span><span class="keyword">,</span> xs2<span class="keyword">:</span> <span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n2</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n1</span><span class="staexp">+</span><span class="staexp">n2</span><span class="keyword">)</span></span> <span class="comment">// endfun</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
x<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> list_vt_extend<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>xs1<span class="keyword">:</span> <span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> x2<span class="keyword">:</span> <span class="staexp">x</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">n</span><span class="staexp">+</span><span class="staexp">1</span><span class="keyword">)</span></span>
<span class="comment">// end of [list_vt_extend]</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
list_vt_unextend<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>pos<span class="keyword">}</span></span>
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">n</span><span class="staexp">-</span><span class="staexp">1</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span></span>
<span class="comment">// end of [list_vt_unextend]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">macdef</span> list_vt_snoc <span class="keyword">=</span> list_vt_extend</span>
<span class="dynexp"><span class="keyword">macdef</span> list_vt_unsnoc <span class="keyword">=</span> list_vt_unextend</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
list_vt_reverse<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="comment">// end of [list_vt_reverse]</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
list_vt_reverse_append<span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span><span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">m</span><span class="staexp">+</span><span class="staexp">n</span><span class="keyword">)</span></span>
<span class="comment">// end of [list_vt_reverse_append]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
list_vt_split_at
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>i<span class="keyword">:</span>nat <span class="keyword">|</span> i &lt;= n<span class="keyword">}</span></span>
  <span class="keyword">(</span><span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">int</span> <span class="staexp">i</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">n</span><span class="staexp">-</span><span class="staexp">i</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">// end of [list_vt_split_at]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
list_vt_concat
  <span class="keyword">(</span>xss<span class="keyword">:</span> <span class="staexp">List_vt</span><span class="keyword">(</span><span class="staexp">List_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">List0_vt</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span></span>
<span class="comment">// end of [list_vt_concat]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
list_vt_separate<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">n1</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp"><span class="keyword">#[</span>n1<span class="keyword">:</span>nat<span class="keyword">|</span>n1 &lt;= n<span class="keyword">]</span></span> <span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">n</span><span class="staexp">-</span><span class="staexp">n1</span><span class="keyword">)</span></span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
list_vt_separate$pred <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">RD</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">bool</span></span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list_vt_filter<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span><span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">listLte_vt</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="comment">// end of [list_vt_filter]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
list_vt_filter$pred <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">RD</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
list_vt_filterlin<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span><span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">listLte_vt</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
list_vt_filterlin$pred <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">RD</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
list_vt_filterlin$clear <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">x</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">x</span><span class="staexp">?</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
list_vt_app <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">List_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
list_vt_app$fwork <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">x</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
list_vt_appfree
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">List_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
list_vt_appfree$fwork <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">x</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">x</span><span class="staexp">?</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
x<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>y<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> list_vt_map$fopr<span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">x</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span><span class="keyword">)</span><span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">y</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
x<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>y<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> list_vt_map<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">y</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
x<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>y<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> list_vt_map_fun<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> f<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">&amp;</span><span class="staexp">x</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">fun1</span><span class="keyword">&gt;</span> <span class="staexp">y</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">y</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
x<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>y<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> list_vt_map_clo<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> f<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="staexp">&amp;</span><span class="staexp">x</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">clo1</span><span class="keyword">&gt;</span> <span class="staexp">y</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">y</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
x<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>y<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> list_vt_map_cloref<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> f<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">&amp;</span><span class="staexp">x</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloref1</span><span class="keyword">&gt;</span> <span class="staexp">y</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">y</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
x<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>y<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> list_vt_mapfree$fopr<span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">x</span><span class="staexp">?</span><span class="keyword">)</span><span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">y</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
x<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>y<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> list_vt_mapfree<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">y</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
x<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>y<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> list_vt_mapfree_fun<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> f<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">&amp;</span><span class="staexp">x</span><span class="staexp">&gt;&gt;</span><span class="staexp">_</span><span class="staexp">?</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">fun1</span><span class="keyword">&gt;</span> <span class="staexp">y</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">y</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
x<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>y<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> list_vt_mapfree_clo<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> f<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="staexp">&amp;</span><span class="staexp">x</span><span class="staexp">&gt;&gt;</span><span class="staexp">_</span><span class="staexp">?</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">clo1</span><span class="keyword">&gt;</span> <span class="staexp">y</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">y</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
x<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>y<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> list_vt_mapfree_cloref<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> f<span class="keyword">:</span> <span class="keyword">(</span> <span class="staexp">&amp;</span><span class="staexp">x</span><span class="staexp">&gt;&gt;</span><span class="staexp">_</span><span class="staexp">?</span> <span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloref1</span><span class="keyword">&gt;</span> <span class="staexp">y</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">y</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
x<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> list_vt_foreach <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">List_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
x<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>env<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> list_vt_foreach_env <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">List_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="staexp">env</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
x<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>env<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> list_vt_foreach$cont <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">x</span><span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">env</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">bool</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
x<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>env<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> list_vt_foreach$fwork <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">x</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span><span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="staexp">env</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
x<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> list_vt_foreach_fun
  <span class="staexp"><span class="keyword">{</span>fe<span class="keyword">:</span>eff<span class="keyword">}</span></span> <span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">List_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> f<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">&amp;</span><span class="staexp">x</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">fe</span><span class="keyword">&gt;</span> <span class="staexp">void</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="staexp">fe</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span> <span class="comment">// end of [list_vt_foreach_fun]</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
x<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> list_vt_foreach_funenv
  <span class="staexp"><span class="keyword">{</span>v<span class="keyword">:</span>view<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>vt<span class="keyword">:</span>viewtype<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>fe<span class="keyword">:</span>eff<span class="keyword">}</span></span> <span class="keyword">(</span>
  <span class="prfexp">pfv<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">v</span></span>
<span class="keyword">|</span> xs<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">List_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> f<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp"><span class="keyword">!</span></span><span class="staexp">v</span> <span class="keyword">|</span> <span class="staexp">&amp;</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">vt</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">fe</span><span class="keyword">&gt;</span> <span class="staexp">void</span><span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">vt</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="staexp">fe</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span> <span class="comment">// end of [list_vt_foreach_funenv]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
x<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> list_vt_iforeach
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span> <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">natLte</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
x<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>env<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> list_vt_iforeach_env
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span> <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="staexp">env</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">natLte</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
x<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>env<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> list_vt_iforeach$cont
  <span class="keyword">(</span>i<span class="keyword">:</span> <span class="staexp">intGte</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">x</span><span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">env</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">bool</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
x<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>env<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> list_vt_iforeach$fwork
  <span class="keyword">(</span>i<span class="keyword">:</span> <span class="staexp">intGte</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">x</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span><span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="staexp">env</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> list_vt_mergesort
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span> <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> list_vt_mergesort$cmp <span class="keyword">(</span>x1<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">RD</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> x2<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">RD</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int</span></span><span class="comment">(*sgn*)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> list_vt_mergesort_fun
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span> <span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> cmp<span class="keyword">:</span> <span class="staexp">cmpref</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span> <span class="comment">// end of [list_vt_mergesort_fun]</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> list_vt_quicksort
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span> <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> list_vt_quicksort$cmp <span class="keyword">(</span>x1<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">RD</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> x2<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">RD</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int</span></span><span class="comment">(*sgn*)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> list_vt_quicksort_fun
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span> <span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> cmp<span class="keyword">:</span> <span class="staexp">cmpref</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span> <span class="comment">// end of [list_vt_quicksort_fun]</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
streamize_list_vt_elt<span class="keyword">(</span><span class="staexp">List_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">// overloading for certain symbols</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">[</span><span class="keyword">]</span> <span class="keyword">with</span> list_vt_get_at</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">[</span><span class="keyword">]</span> <span class="keyword">with</span> list_vt_set_at</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> iseqz <span class="keyword">with</span> list_vt_is_nil</span>
<span class="dynexp"><span class="keyword">overload</span> isneqz <span class="keyword">with</span> list_vt_is_cons</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> length <span class="keyword">with</span> list_vt_length</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> copy <span class="keyword">with</span> list_vt_copy</span>
<span class="dynexp"><span class="keyword">overload</span> free <span class="keyword">with</span> list_vt_free</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> print <span class="keyword">with</span> print_list_vt</span>
<span class="dynexp"><span class="keyword">overload</span> prerr <span class="keyword">with</span> prerr_list_vt</span>
<span class="dynexp"><span class="keyword">overload</span> fprint <span class="keyword">with</span> fprint_list_vt</span>
<span class="dynexp"><span class="keyword">overload</span> fprint <span class="keyword">with</span> fprint_list_vt_sep</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* end of [list_vt.sats] *)</span>
</pre>
<pre class="patsyntax">
<span class="comment">(***********************************************************************)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(*                         Applied Type System                         *)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(***********************************************************************)</span>

<span class="comment">(*
** ATS/Postiats - Unleashing the Potential of Types!
** Copyright (C) 2010-2015 Hongwei Xi, ATS Trustful Software, Inc.
** All rights reserved
**
** ATS is free software;  you can  redistribute it and/or modify it under
** the terms of  the GNU GENERAL PUBLIC LICENSE (GPL) as published by the
** Free Software Foundation; either version 3, or (at  your  option)  any
** later version.
**
** ATS is distributed in the hope that it will be useful, but WITHOUT ANY
** WARRANTY; without  even  the  implied  warranty  of MERCHANTABILITY or
** FITNESS FOR A PARTICULAR PURPOSE.  See the  GNU General Public License
** for more details.
**
** You  should  have  received  a  copy of the GNU General Public License
** along  with  ATS;  see the  file COPYING.  If not, please write to the
** Free Software Foundation,  51 Franklin Street, Fifth Floor, Boston, MA
** 02110-1301, USA.
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
** Source:
** $PATSHOME/prelude/SATS/CODEGEN/option.atxt
** Time of generation: Mon Sep  5 21:48:35 2016
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* Author: Hongwei Xi *)</span>
<span class="comment">(* Authoremail: hwxi AT cs DOT bu DOT edu *)</span>
<span class="comment">(* Start time: February, 2012 *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="staexp"><span class="keyword">sortdef</span> t0p <span class="keyword">=</span> <span class="keyword">t@ype</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">#if</span><span class="neuexp"><span class="keyword">(</span>0<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">// HX: these decls are available in [basic_dyn.sats]</span>
<span class="comment">//</span>
<span class="keyword">stadef</span> <span class="staexp">option <span class="keyword">=</span> <span class="staexp">option_t0ype_bool_type</span></span>
<span class="keyword">typedef</span> <span class="staexp">Option <span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span>t0p</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>b<span class="keyword">:</span>bool<span class="keyword">]</span></span> <span class="staexp">option</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">b</span><span class="keyword">)</span></span>
<span class="keyword">#endif</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">exception</span> <span class="dynexp">NotSomeExn <span class="keyword">of</span> <span class="keyword">(</span><span class="keyword">)</span></span>
<span class="comment">(*
fun NotSomeExn ():&lt;&gt; exn = "mac#%NotSomeExn_make"
fun isNotSomeExn (x: !exn):&lt;&gt; bool = "mac#%isNotSomeExn"
macdef
ifNotSomeExn
  {tres}(exn, body) =
(
let val x = ,(exn) in
(
if isNotSomeExn(x)
  then
    let prval () = __vfree_exn (x) in ,(body) end
  else $raise (x)
) : tres // end of [if]
end (* end of [let] *)
) // end of [ifNotSomeExn]
*)</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">castfn</span>
option_cast
  <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>b<span class="keyword">:</span>bool<span class="keyword">}</span></span>
  <span class="keyword">(</span>opt<span class="keyword">:</span> <span class="staexp">option</span> <span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">b</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">option</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">b</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">castfn</span>
option_vt2t
  <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>b<span class="keyword">:</span>bool<span class="keyword">}</span></span>
  <span class="keyword">(</span>opt<span class="keyword">:</span> <span class="staexp">option_vt</span> <span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">b</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">option</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">b</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">castfn</span>
option_of_option_vt
  <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>b<span class="keyword">:</span>bool<span class="keyword">}</span></span>
  <span class="keyword">(</span>opt<span class="keyword">:</span> <span class="staexp">option_vt</span> <span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">b</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">option</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">b</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
option_some <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">option</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">true</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
option_none <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">option</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">false</span><span class="keyword">)</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
option_is_some<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
  <span class="staexp"><span class="keyword">{</span>b<span class="keyword">:</span>bool<span class="keyword">}</span></span> <span class="keyword">(</span>opt<span class="keyword">:</span> <span class="staexp">option</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">b</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">(</span><span class="staexp">b</span><span class="keyword">)</span></span>
<span class="comment">// end of [option_is_some]</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
option_is_none<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
  <span class="staexp"><span class="keyword">{</span>b<span class="keyword">:</span>bool<span class="keyword">}</span></span> <span class="keyword">(</span>opt<span class="keyword">:</span> <span class="staexp">option</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">b</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">(</span><span class="staexp"><span class="keyword">~</span></span><span class="staexp">b</span><span class="keyword">)</span></span>
<span class="comment">// end of [option_is_none]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
option_unsome <span class="keyword">(</span>opt<span class="keyword">:</span> <span class="staexp">option</span> <span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">true</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">a</span></span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
option_unsome_exn <span class="keyword">(</span>opt<span class="keyword">:</span> <span class="staexp">Option</span> <span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">exn</span><span class="keyword">&gt;</span> <span class="staexp">a</span></span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
option_equal$eqfn <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
option_equal
  <span class="keyword">(</span>opt1<span class="keyword">:</span> <span class="staexp">Option</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> opt2<span class="keyword">:</span> <span class="staexp">Option</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
fprint_option
  <span class="keyword">(</span>out<span class="keyword">:</span> <span class="staexp">FILEref</span><span class="keyword">,</span> opt<span class="keyword">:</span> <span class="staexp">Option</span> <span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> fprint <span class="keyword">with</span> fprint_option</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">// overloading for certain symbols</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">=</span> <span class="keyword">with</span> option_equal</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">overload</span> iseqz <span class="keyword">with</span> option_is_none</span>
<span class="dynexp"><span class="keyword">overload</span> isneqz <span class="keyword">with</span> option_is_some</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* end of [option.sats] *)</span>
</pre>
<pre class="patsyntax">
<span class="comment">(***********************************************************************)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(*                         Applied Type System                         *)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(***********************************************************************)</span>

<span class="comment">(*
** ATS/Postiats - Unleashing the Potential of Types!
** Copyright (C) 2010-2015 Hongwei Xi, ATS Trustful Software, Inc.
** All rights reserved
**
** ATS is free software;  you can  redistribute it and/or modify it under
** the terms of  the GNU GENERAL PUBLIC LICENSE (GPL) as published by the
** Free Software Foundation; either version 3, or (at  your  option)  any
** later version.
**
** ATS is distributed in the hope that it will be useful, but WITHOUT ANY
** WARRANTY; without  even  the  implied  warranty  of MERCHANTABILITY or
** FITNESS FOR A PARTICULAR PURPOSE.  See the  GNU General Public License
** for more details.
**
** You  should  have  received  a  copy of the GNU General Public License
** along  with  ATS;  see the  file COPYING.  If not, please write to the
** Free Software Foundation,  51 Franklin Street, Fifth Floor, Boston, MA
** 02110-1301, USA.
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
** Source:
** $PATSHOME/prelude/SATS/CODEGEN/option_vt.atxt
** Time of generation: Mon Sep  5 21:48:35 2016
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* Author: Hongwei Xi *)</span>
<span class="comment">(* Authoremail: hwxi AT cs DOT bu DOT edu *)</span>
<span class="comment">(* Start time: February, 2012 *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="staexp"><span class="keyword">sortdef</span> vt0p <span class="keyword">=</span> <span class="keyword">viewt@ype</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">#if</span><span class="neuexp"><span class="keyword">(</span>0<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">// HX: these decls are available in [basic_dyn.sats]</span>
<span class="comment">//</span>
<span class="keyword">stadef</span> <span class="staexp">option_vt <span class="keyword">=</span> <span class="staexp">option_vt0ype_bool_vtype</span></span>
<span class="keyword">vtypedef</span> <span class="staexp">Option_vt <span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span>vt0p</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>b<span class="keyword">:</span>bool<span class="keyword">]</span></span> <span class="staexp">option_vt</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">b</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">#endif</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
option_vt_some <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">option_vt</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">true</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
option_vt_none <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">option_vt</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">false</span><span class="keyword">)</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> option_vt_make_opt
  <span class="staexp"><span class="keyword">{</span>b<span class="keyword">:</span>bool<span class="keyword">}</span></span> <span class="keyword">(</span>
  b<span class="keyword">:</span> <span class="staexp">bool</span> <span class="staexp">b</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">opt</span> <span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">b</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">a</span><span class="staexp">?</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">option_vt</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">b</span><span class="keyword">)</span></span> <span class="comment">// endfun</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
option_vt_is_some<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
  <span class="staexp"><span class="keyword">{</span>b<span class="keyword">:</span>bool<span class="keyword">}</span></span> <span class="keyword">(</span>opt<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">option_vt</span> <span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">b</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">(</span><span class="staexp">b</span><span class="keyword">)</span></span>
<span class="comment">// end of [option_vt_is_some]</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
option_vt_is_none<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
  <span class="staexp"><span class="keyword">{</span>b<span class="keyword">:</span>bool<span class="keyword">}</span></span> <span class="keyword">(</span>opt<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">option_vt</span> <span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">b</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">(</span><span class="staexp"><span class="keyword">~</span></span><span class="staexp">b</span><span class="keyword">)</span></span>
<span class="comment">// end of [option_vt_is_none]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
option_vt_unsome <span class="keyword">(</span>opt<span class="keyword">:</span> <span class="staexp">option_vt</span> <span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">true</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">a</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
option_vt_unnone <span class="keyword">(</span>opt<span class="keyword">:</span> <span class="staexp">option_vt</span> <span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">false</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
option_vt_free <span class="keyword">(</span>opt<span class="keyword">:</span> <span class="staexp">Option_vt</span> <span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
fprint_option_vt<span class="staexp"><span class="keyword">{</span>b<span class="keyword">:</span>bool<span class="keyword">}</span></span>
   <span class="keyword">(</span>out<span class="keyword">:</span> <span class="staexp">FILEref</span><span class="keyword">,</span> opt<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">option_vt</span> <span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">b</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="dynexp"><span class="keyword">overload</span> fprint <span class="keyword">with</span> fprint_option_vt</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">// overloading for certain symbols</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">overload</span> iseqz <span class="keyword">with</span> option_vt_is_none</span>
<span class="dynexp"><span class="keyword">overload</span> isneqz <span class="keyword">with</span> option_vt_is_some</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* end of [option_vt.sats] *)</span>
</pre>
<pre class="patsyntax">
<span class="comment">(***********************************************************************)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(*                         Applied Type System                         *)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(***********************************************************************)</span>

<span class="comment">(*
** ATS/Postiats - Unleashing the Potential of Types!
** Copyright (C) 2010-2015 Hongwei Xi, ATS Trustful Software, Inc.
** All rights reserved
**
** ATS is free software;  you can  redistribute it and/or modify it under
** the terms of  the GNU GENERAL PUBLIC LICENSE (GPL) as published by the
** Free Software Foundation; either version 3, or (at  your  option)  any
** later version.
**
** ATS is distributed in the hope that it will be useful, but WITHOUT ANY
** WARRANTY; without  even  the  implied  warranty  of MERCHANTABILITY or
** FITNESS FOR A PARTICULAR PURPOSE.  See the  GNU General Public License
** for more details.
**
** You  should  have  received  a  copy of the GNU General Public License
** along  with  ATS;  see the  file COPYING.  If not, please write to the
** Free Software Foundation,  51 Franklin Street, Fifth Floor, Boston, MA
** 02110-1301, USA.
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
** Source:
** $PATSHOME/prelude/SATS/CODEGEN/stream.atxt
** Time of generation: Sun Oct 23 12:30:19 2016
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="staexp"><span class="keyword">sortdef</span> t0p <span class="keyword">=</span> <span class="keyword">t@ype</span></span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="keyword">#if</span><span class="neuexp"><span class="keyword">(</span>0<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">// HX: lazy streams</span>
<span class="comment">// It is declared in [basics_dyn]</span>
<span class="comment">//</span>
<span class="keyword">datatype</span>
<span class="staexp">stream_con
  <span class="keyword">(</span>a<span class="keyword">:</span><span class="keyword">t@ype+</span><span class="keyword">)</span> <span class="keyword">=</span>
<span class="comment">//</span>
<span class="comment">// t@ype+: covariant</span>
<span class="comment">//</span>
  <span class="keyword">|</span> <span class="dynexp">stream_nil <span class="keyword">of</span> <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span></span>
  <span class="keyword">|</span> <span class="dynexp">stream_cons <span class="keyword">of</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span></span></span>
<span class="comment">//</span>
<span class="keyword">where</span> <span class="staexp">stream <span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span><span class="keyword">t@ype</span></span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">lazy</span> <span class="keyword">(</span><span class="staexp">stream_con</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">#endif</span> <span class="comment">// [#if(0)]</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="keyword">exception</span> <span class="dynexp">StreamSubscriptExn <span class="keyword">of</span> <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(*
fun StreamSubscriptExn ():&lt;&gt; exn = "mac#StreamSubscriptExn_make"
fun isStreamSubscriptExn (x: !exn):&lt;&gt; bool = "mac#isStreamSubscriptExn"
*)</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
stream_sing<span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">stream_con</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
stream_is_nil<span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">bool</span></span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
stream_is_cons<span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">bool</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
stream_make_nil<span class="keyword">(</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
stream_make_sing<span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
stream2list
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">laz</span><span class="keyword">&gt;</span> <span class="staexp">List0_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">// end of [stream2list]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
stream_length<span class="keyword">(</span><span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">laz</span><span class="keyword">&gt;</span> <span class="staexp">intGte</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
stream_head_exn<span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">laz</span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
stream_tail_exn<span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">laz</span><span class="keyword">&gt;</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
stream_nth_exn
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">intGte</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">laz</span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">// end of [stream_nth_exn]</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
stream_nth_opt
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">intGte</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">laz</span><span class="keyword">&gt;</span> <span class="staexp">Option_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">// end of [stream_nth_opt]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
stream_get_at_exn
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">intGte</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">laz</span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">// end of [stream_get_at_exn]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
stream_takeLte
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">intGte</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">// end of [stream_takeLte]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
stream_take_exn<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>nat<span class="keyword">}</span></span>
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">int</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">laz</span><span class="keyword">&gt;</span> <span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="comment">// end of [stream_take_exn]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
stream_drop_exn
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">intGte</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">laz</span><span class="keyword">&gt;</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">// end of [stream_drop_exn]</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
stream_drop_opt
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">intGte</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">laz</span><span class="keyword">&gt;</span> <span class="staexp">Option_vt</span><span class="keyword">(</span><span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">// end of [stream_drop_opt]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
stream_append
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> ys<span class="keyword">:</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">laz</span><span class="keyword">&gt;</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
stream_concat<span class="keyword">(</span>xss<span class="keyword">:</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">laz</span><span class="keyword">&gt;</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
stream_filter
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">laz</span><span class="keyword">&gt;</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span> stream_filter$pred <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
stream_filter_fun
<span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> pred<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp"><span class="keyword">fun</span></span><span class="keyword">&gt;</span> <span class="staexp">bool</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">laz</span><span class="keyword">&gt;</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span> <span class="comment">// end-of-function</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
stream_filter_cloref
<span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> pred<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloref</span><span class="keyword">&gt;</span> <span class="staexp">bool</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">laz</span><span class="keyword">&gt;</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span> <span class="comment">// end-of-function</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>t0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>b<span class="keyword">:</span>t0p
<span class="keyword">}</span></span> stream_map
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">laz</span><span class="keyword">&gt;</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">b</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>t0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>b<span class="keyword">:</span>t0p
<span class="keyword">}</span></span> stream_map$fopr <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="comment">(*none*)</span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="staexp">b</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>t0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>b<span class="keyword">:</span>t0p
<span class="keyword">}</span></span> stream_map_fun
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> f<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp"><span class="keyword">fun</span></span><span class="keyword">&gt;</span> <span class="staexp">b</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">laz</span><span class="keyword">&gt;</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">b</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>t0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>b<span class="keyword">:</span>t0p
<span class="keyword">}</span></span> stream_map_cloref
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> f<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloref</span><span class="keyword">&gt;</span> <span class="staexp">b</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">laz</span><span class="keyword">&gt;</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">b</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>t0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>b<span class="keyword">:</span>t0p
<span class="keyword">}</span></span> stream_imap<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">laz</span><span class="keyword">&gt;</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">b</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>t0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>b<span class="keyword">:</span>t0p
<span class="keyword">}</span></span> stream_imap$fopr <span class="keyword">(</span>i<span class="keyword">:</span> <span class="staexp">intGte</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="staexp">b</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>t0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>b<span class="keyword">:</span>t0p
<span class="keyword">}</span></span> stream_imap_fun
<span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> f<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">intGte</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">a</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp"><span class="keyword">fun</span></span><span class="keyword">&gt;</span> <span class="staexp">b</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">laz</span><span class="keyword">&gt;</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">b</span><span class="keyword">)</span></span> <span class="comment">// end-of-fun</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>t0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>b<span class="keyword">:</span>t0p
<span class="keyword">}</span></span> stream_imap_cloref
<span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> f<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">intGte</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">a</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloref</span><span class="keyword">&gt;</span> <span class="staexp">b</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">laz</span><span class="keyword">&gt;</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">b</span><span class="keyword">)</span></span> <span class="comment">// end-of-fun</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a1<span class="keyword">,</span>a2<span class="keyword">:</span>t0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>b<span class="keyword">:</span>t0p
<span class="keyword">}</span></span> stream_map2
<span class="keyword">(</span>
  xs1<span class="keyword">:</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a1</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">,</span> xs2<span class="keyword">:</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a2</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">laz</span><span class="keyword">&gt;</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">b</span><span class="keyword">)</span></span> <span class="comment">// end-of-fun</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a1<span class="keyword">,</span>a2<span class="keyword">:</span>t0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>b<span class="keyword">:</span>t0p
<span class="keyword">}</span></span> stream_map2$fopr <span class="keyword">(</span>x1<span class="keyword">:</span> <span class="staexp">a1</span><span class="keyword">,</span> x2<span class="keyword">:</span> <span class="staexp">a2</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">b</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a1<span class="keyword">,</span>a2<span class="keyword">:</span>t0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>b<span class="keyword">:</span>t0p
<span class="keyword">}</span></span> stream_map2_fun
<span class="keyword">(</span>
  xs1<span class="keyword">:</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a1</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">,</span> xs2<span class="keyword">:</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a2</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> f<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">a1</span><span class="keyword">,</span> <span class="staexp">a2</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp"><span class="keyword">fun</span></span><span class="keyword">&gt;</span> <span class="staexp">b</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">laz</span><span class="keyword">&gt;</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">b</span><span class="keyword">)</span></span> <span class="comment">// end-of-fun</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a1<span class="keyword">,</span>a2<span class="keyword">:</span>t0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>b<span class="keyword">:</span>t0p
<span class="keyword">}</span></span> stream_map2_cloref
<span class="keyword">(</span>
  xs1<span class="keyword">:</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a1</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">,</span> xs2<span class="keyword">:</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a2</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> f<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">a1</span><span class="keyword">,</span> <span class="staexp">a2</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloref</span><span class="keyword">&gt;</span> <span class="staexp">b</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">laz</span><span class="keyword">&gt;</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">b</span><span class="keyword">)</span></span> <span class="comment">// end-of-fun</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
res<span class="keyword">:</span>t0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>t0p
<span class="keyword">}</span></span> stream_scan
  <span class="keyword">(</span><span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> ini<span class="keyword">:</span> <span class="staexp">res</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">laz</span><span class="keyword">&gt;</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">res</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
res<span class="keyword">:</span>t0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>t0p
<span class="keyword">}</span></span> stream_scan$fopr<span class="keyword">(</span>res<span class="keyword">:</span> <span class="staexp">res</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="staexp">x</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="comment">(*none*)</span><span class="keyword">&gt;</span> <span class="staexp">res</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
res<span class="keyword">:</span>t0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>t0p
<span class="keyword">}</span></span> stream_scan_fun
<span class="keyword">(</span>
  <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> ini<span class="keyword">:</span> <span class="staexp">res</span><span class="keyword">,</span> <span class="keyword">(</span><span class="staexp">res</span><span class="keyword">,</span> <span class="staexp">x</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp"><span class="keyword">fun</span></span><span class="keyword">&gt;</span> <span class="staexp">res</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">laz</span><span class="keyword">&gt;</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">res</span><span class="keyword">)</span></span> <span class="comment">// end-of-function</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
res<span class="keyword">:</span>t0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>x<span class="keyword">:</span>t0p
<span class="keyword">}</span></span> stream_scan_cloref
<span class="keyword">(</span>
  <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> ini<span class="keyword">:</span> <span class="staexp">res</span><span class="keyword">,</span> <span class="keyword">(</span><span class="staexp">res</span><span class="keyword">,</span> <span class="staexp">x</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloref</span><span class="keyword">&gt;</span> <span class="staexp">res</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">laz</span><span class="keyword">&gt;</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">res</span><span class="keyword">)</span></span> <span class="comment">// end-of-function</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
stream_merge
  <span class="keyword">(</span><span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">laz</span><span class="keyword">&gt;</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span> stream_merge$cmp <span class="keyword">(</span>x1<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">,</span> x2<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
stream_merge_fun
<span class="keyword">(</span>
  xs1<span class="keyword">:</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> xs2<span class="keyword">:</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">a</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp"><span class="keyword">fun</span></span><span class="keyword">&gt;</span> <span class="staexp">int</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">laz</span><span class="keyword">&gt;</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span> <span class="comment">// end of [stream_merge_fun]</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
stream_merge_cloref
<span class="keyword">(</span>
  xs1<span class="keyword">:</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> xs2<span class="keyword">:</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">a</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloref</span><span class="keyword">&gt;</span> <span class="staexp">int</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">laz</span><span class="keyword">&gt;</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span> <span class="comment">// end of [stream_merge_cloref]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
stream_mergeq
  <span class="keyword">(</span><span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">laz</span><span class="keyword">&gt;</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span> stream_mergeq$cmp <span class="keyword">(</span>x1<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">,</span> x2<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
stream_mergeq_fun
<span class="keyword">(</span>
  xs1<span class="keyword">:</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> xs2<span class="keyword">:</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">a</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp"><span class="keyword">fun</span></span><span class="keyword">&gt;</span> <span class="staexp">int</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">laz</span><span class="keyword">&gt;</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span> <span class="comment">// end of [stream_mergeq_fun]</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
stream_mergeq_cloref
<span class="keyword">(</span>
  xs1<span class="keyword">:</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> xs2<span class="keyword">:</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">a</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloref</span><span class="keyword">&gt;</span> <span class="staexp">int</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">laz</span><span class="keyword">&gt;</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span> <span class="comment">// end of [stream_mergeq_cloref]</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
stream_tabulate<span class="keyword">(</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
stream_tabulate$fopr<span class="keyword">(</span>i<span class="keyword">:</span> <span class="staexp">intGte</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
stream_tabulate_fun
  <span class="keyword">(</span>fopr<span class="keyword">:</span> <span class="staexp">intGte</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span> <span class="staexp"><span class="keyword">-&gt;</span></span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
stream_tabulate_cloref
  <span class="keyword">(</span>fopr<span class="keyword">:</span> <span class="staexp">intGte</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloref1</span><span class="keyword">&gt;</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
stream_foreach <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
<span class="staexp"><span class="keyword">{</span>env<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
stream_foreach_env<span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">&amp;</span><span class="staexp">env</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
<span class="staexp"><span class="keyword">{</span>env<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
stream_foreach$cont<span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">env</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">bool</span></span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
<span class="staexp"><span class="keyword">{</span>env<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
stream_foreach$fwork<span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">env</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
stream_foreach_fun
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> fwork<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">fun1</span><span class="keyword">&gt;</span> <span class="staexp">void</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
stream_foreach_cloref
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> fwork<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloref1</span><span class="keyword">&gt;</span> <span class="staexp">void</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
fprint_stream$sep <span class="keyword">(</span>out<span class="keyword">:</span> <span class="staexp">FILEref</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
fprint_stream
  <span class="keyword">(</span>out<span class="keyword">:</span> <span class="staexp">FILEref</span><span class="keyword">,</span> xs<span class="keyword">:</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">// overloading for certain symbols</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">[</span><span class="keyword">]</span> <span class="keyword">with</span> stream_nth_exn</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> iseqz <span class="keyword">with</span> stream_is_nil</span>
<span class="dynexp"><span class="keyword">overload</span> isneqz <span class="keyword">with</span> stream_is_cons</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> length <span class="keyword">with</span> stream_length</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">.</span>head <span class="keyword">with</span> stream_head_exn</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">.</span>tail <span class="keyword">with</span> stream_tail_exn</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* end of [stream.sats] *)</span>
</pre>
<pre class="patsyntax">
<span class="comment">(***********************************************************************)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(*                         Applied Type System                         *)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(***********************************************************************)</span>

<span class="comment">(*
** ATS/Postiats - Unleashing the Potential of Types!
** Copyright (C) 2010-2015 Hongwei Xi, ATS Trustful Software, Inc.
** All rights reserved
**
** ATS is free software;  you can  redistribute it and/or modify it under
** the terms of  the GNU GENERAL PUBLIC LICENSE (GPL) as published by the
** Free Software Foundation; either version 3, or (at  your  option)  any
** later version.
**
** ATS is distributed in the hope that it will be useful, but WITHOUT ANY
** WARRANTY; without  even  the  implied  warranty  of MERCHANTABILITY or
** FITNESS FOR A PARTICULAR PURPOSE.  See the  GNU General Public License
** for more details.
**
** You  should  have  received  a  copy of the GNU General Public License
** along  with  ATS;  see the  file COPYING.  If not, please write to the
** Free Software Foundation,  51 Franklin Street, Fifth Floor, Boston, MA
** 02110-1301, USA.
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
** Source:
** $PATSHOME/prelude/SATS/CODEGEN/stream_vt.atxt
** Time of generation: Sun Oct 23 11:07:08 2016
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="staexp"><span class="keyword">sortdef</span> t0p <span class="keyword">=</span> <span class="keyword">t@ype</span> <span class="keyword">and</span> vt0p <span class="keyword">=</span> <span class="keyword">vt@ype</span></span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="keyword">#if</span><span class="neuexp"><span class="keyword">(</span>0<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">// HX: linear lazy streams</span>
<span class="comment">// It is declared in [basics_dyn]</span>
<span class="comment">//</span>
<span class="keyword">datavtype</span>
<span class="staexp">stream_vt_con
  <span class="keyword">(</span>a<span class="keyword">:</span><span class="keyword">vt@ype+</span><span class="keyword">)</span> <span class="keyword">=</span>
<span class="comment">//</span>
<span class="comment">// vt@ype+: covariant</span>
<span class="comment">//</span>
  <span class="keyword">|</span> <span class="dynexp">stream_vt_nil <span class="keyword">of</span> <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span></span>
  <span class="keyword">|</span> <span class="dynexp">stream_vt_cons <span class="keyword">of</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span></span></span>
<span class="comment">//</span>
<span class="keyword">where</span>
<span class="staexp">stream_vt
  <span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span><span class="keyword">vt@ype</span></span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">lazy_vt</span><span class="keyword">(</span><span class="staexp">stream_vt_con</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">#endif</span> <span class="comment">// [#if(0)]</span>
<span class="comment">//</span>
<span class="keyword">vtypedef</span>
<span class="staexp">streamopt_vt<span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span>vt0p</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">Option_vt</span><span class="keyword">(</span><span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
stream_vt_is_nil<span class="keyword">(</span><span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">bool</span></span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
stream_vt_is_cons<span class="keyword">(</span><span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">bool</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
stream_vt_make_nil<span class="keyword">(</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
stream_vt_make_cons
  <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
stream_vt_make_sing<span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
stream_vt_make_con
  <span class="keyword">(</span>xs_con<span class="keyword">:</span> <span class="staexp">stream_vt_con</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">// HX-2014-04-07:</span>
<span class="comment">// this is a regular function</span>
<span class="comment">// instead of a cast function</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
stream_vt2t
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
stream2list_vt
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">List0_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">// end of [stream2list_vt]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
stream_vt_free <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">stream_vt</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
stream_vt_con_free <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">stream_vt_con</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
stream_vt_takeLte
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">intGte</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">// end of [stream_vt_takeLte]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
stream_vt_drop_exn
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">intGte</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">// end of [stream_vt_drop_exn]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
stream_vt_drop_opt
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">intGte</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">streamopt_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">// end of [stream_vt_drop_opt]</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
stream_vt_length
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">intGte</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
stream_vt_head_exn
  <span class="keyword">(</span><span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">exnwrt</span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
stream_vt_tail_exn
  <span class="keyword">(</span><span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">exnwrt</span><span class="keyword">&gt;</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
stream_vt_uncons_exn
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">exnwrt</span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
stream_vt_uncons_opt
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">exnwrt</span><span class="keyword">&gt;</span> <span class="staexp">Option_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
stream_vt_nth_exn
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">intGte</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">exnwrt</span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
stream_vt_nth_opt
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">intGte</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">Option_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
stream_vt_append
  <span class="keyword">(</span><span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
stream_vt_concat
  <span class="keyword">(</span>xss<span class="keyword">:</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
stream_vt_filter
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
stream_vt_filter_fun
<span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> pred<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">&amp;</span><span class="staexp">a</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp"><span class="keyword">fun</span></span><span class="keyword">&gt;</span> <span class="staexp">bool</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">stream_vt</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span> <span class="comment">// end of [stream_vt_filter_fun]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
stream_vt_filter_cloptr
<span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> pred<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">&amp;</span><span class="staexp">a</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloptr</span><span class="keyword">&gt;</span> <span class="staexp">bool</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">stream_vt</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span> <span class="comment">// end of [stream_vt_filter_cloptr]</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
stream_vt_ifilter_cloptr
<span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> pred<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">intGte</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">&amp;</span><span class="staexp">a</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloptr</span><span class="keyword">&gt;</span> <span class="staexp">bool</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">stream_vt</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span> <span class="comment">// end of [stream_vt_ifilter_cloptr]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
stream_vt_filterlin
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
stream_vt_filter$pred<span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
stream_vt_filterlin$pred<span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
stream_vt_filterlin$clear<span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">a</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">a</span><span class="staexp">?</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>b<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> stream_vt_map
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">b</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>b<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> stream_vt_map$fopr <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">a</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">a</span><span class="staexp">?!</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">b</span></span> <span class="comment">// lin-cleared</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>b<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> stream_vt_map_fun
<span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> fopr<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">&amp;</span><span class="staexp">a</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">a</span><span class="staexp">?!</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">fun1</span><span class="keyword">&gt;</span> <span class="staexp">b</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">b</span><span class="keyword">)</span></span> <span class="comment">// end-of-function</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>b<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> stream_vt_map_cloptr
<span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> fopr<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">&amp;</span><span class="staexp">a</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">a</span><span class="staexp">?!</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloptr1</span><span class="keyword">&gt;</span> <span class="staexp">b</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">b</span><span class="keyword">)</span></span> <span class="comment">// end-of-function</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a1<span class="keyword">,</span>a2<span class="keyword">:</span>t0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>b<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> stream_vt_map2$fopr
  <span class="keyword">(</span>x1<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">a1</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span><span class="keyword">,</span> x2<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">a2</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">b</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a1<span class="keyword">,</span>a2<span class="keyword">:</span>t0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>b<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> stream_vt_map2 <span class="keyword">(</span>
  xs1<span class="keyword">:</span> <span class="staexp">stream_vt</span> <span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a1</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">,</span> xs2<span class="keyword">:</span> <span class="staexp">stream_vt</span> <span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a2</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">stream_vt</span> <span class="keyword">(</span><span class="staexp">b</span><span class="keyword">)</span></span> <span class="comment">// end of [stream_vt_map2]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a1<span class="keyword">,</span>a2<span class="keyword">:</span>t0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>b<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> stream_vt_map2_fun
<span class="keyword">(</span>
  xs1<span class="keyword">:</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a1</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">,</span> xs2<span class="keyword">:</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a2</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">,</span> fopr<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">&amp;</span><span class="staexp">a1</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span><span class="keyword">,</span> <span class="staexp">&amp;</span><span class="staexp">a2</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp"><span class="keyword">fun</span></span><span class="keyword">&gt;</span> <span class="staexp">b</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">b</span><span class="keyword">)</span></span> <span class="comment">// end of [stream_vt_map2_fun]</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a1<span class="keyword">,</span>a2<span class="keyword">:</span>t0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>b<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> stream_vt_map2_cloptr
<span class="keyword">(</span>
  xs1<span class="keyword">:</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a1</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">,</span> xs2<span class="keyword">:</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a2</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">,</span> fopr<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">&amp;</span><span class="staexp">a1</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span><span class="keyword">,</span> <span class="staexp">&amp;</span><span class="staexp">a2</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloptr1</span><span class="keyword">&gt;</span> <span class="staexp">b</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">b</span><span class="keyword">)</span></span> <span class="comment">// end of [stream_vt_map2_cloptr]</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
stream_vt_tabulate<span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
stream_vt_tabulate$fopr<span class="keyword">(</span>idx<span class="keyword">:</span> <span class="staexp">intGte</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
stream_vt_labelize
  <span class="keyword">(</span><span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="keyword">@(</span><span class="staexp">intGte</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
stream_vt_foreach
  <span class="keyword">(</span><span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">stream_vt_con</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>env<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> stream_vt_foreach_env
  <span class="keyword">(</span><span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">env</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">stream_vt_con</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>env<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> stream_vt_foreach$cont
  <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">a</span><span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">env</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">bool</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>env<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> stream_vt_foreach$fwork
  <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">a</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">a</span><span class="staexp">?!</span><span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">env</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span> <span class="comment">// lin-cleared</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
stream_vt_foreach_cloptr
<span class="keyword">(</span>
  <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> fwork<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">&amp;</span><span class="staexp">a</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">a</span><span class="staexp">?!</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloptr1</span><span class="keyword">&gt;</span> <span class="staexp">void</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span></span> <span class="comment">// end of [stream_vt_foreach_cloptr]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
stream_vt_iforeach_cloptr
<span class="keyword">(</span>
  <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> fwork<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">intGte</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">&amp;</span><span class="staexp">a</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">a</span><span class="staexp">?!</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloptr1</span><span class="keyword">&gt;</span> <span class="staexp">void</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span></span> <span class="comment">// end of [stream_vt_iforeach_cloptr]</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
res<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
stream_vt_foldleft_cloptr
<span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> init<span class="keyword">:</span> <span class="staexp">res</span><span class="keyword">,</span> fopr<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">res</span><span class="keyword">,</span> <span class="staexp">&amp;</span><span class="staexp">a</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">a</span><span class="staexp">?!</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloptr1</span><span class="keyword">&gt;</span> <span class="staexp">res</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">res</span></span> <span class="comment">// end of [stream_vt_foldleft_cloptr]</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>env<span class="keyword">:</span>t0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
stream_vt_unfold
<span class="keyword">(</span>
  st0<span class="keyword">:</span> <span class="staexp">env</span><span class="keyword">,</span> fopr<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">&amp;</span><span class="staexp">env</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloref1</span><span class="keyword">&gt;</span> <span class="staexp">a</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span> <span class="comment">// end of [stream_vt_unfold]</span>

<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>env<span class="keyword">:</span>t0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
stream_vt_unfold_opt
<span class="keyword">(</span>
  st0<span class="keyword">:</span> <span class="staexp">env</span><span class="keyword">,</span> fopr<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">&amp;</span><span class="staexp">env</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloref1</span><span class="keyword">&gt;</span> <span class="staexp">Option_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span> <span class="comment">// end of [stream_vt_unfold_opt]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>x<span class="keyword">,</span>y<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
cross_stream_vt_list
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> ys<span class="keyword">:</span> <span class="staexp">List</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">y</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="keyword">@(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">y</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>x<span class="keyword">,</span>y<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
cross_stream_vt_list_vt
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> ys<span class="keyword">:</span> <span class="staexp">List_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">y</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="keyword">@(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">y</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">// HX-2016-07-01:</span>
<span class="comment">// [stream_vt_fprint] calls [fprint_val]</span>
<span class="comment">//</span>
<span class="comment">// HX-2016-09-12:</span>
<span class="comment">// Note that (n &lt; 0) means to print all the values</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
stream_vt_fprint$beg<span class="keyword">(</span>out<span class="keyword">:</span> <span class="staexp">FILEref</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
stream_vt_fprint$end<span class="keyword">(</span>out<span class="keyword">:</span> <span class="staexp">FILEref</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
stream_vt_fprint$sep<span class="keyword">(</span>out<span class="keyword">:</span> <span class="staexp">FILEref</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
stream_vt_fprint<span class="keyword">(</span><span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> out<span class="keyword">:</span> <span class="staexp">FILEref</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">absvtype</span>
streamer_vtype<span class="keyword">(</span>a<span class="keyword">:</span><span class="keyword">vt@ype+</span><span class="keyword">)</span> <span class="keyword">=</span> ptr</span>
<span class="comment">//</span>
<span class="keyword">vtypedef</span>
<span class="staexp">streamer_vt<span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span>vt0p</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">streamer_vtype</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
streamer_vt_make
  <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="keyword">(</span><span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">streamer_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
streamer_vt_free<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="keyword">(</span><span class="staexp">streamer_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span><span class="keyword">vt@ype</span>
<span class="keyword">}</span></span> streamer_vt_eval_exn<span class="keyword">(</span>xser<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">streamer_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">// overloading for certain symbols</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">~</span> <span class="keyword">with</span> streamer_vt_free</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">[</span><span class="keyword">]</span> <span class="keyword">with</span> streamer_vt_eval_exn</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">overload</span> iseqz <span class="keyword">with</span> stream_vt_is_nil</span>
<span class="dynexp"><span class="keyword">overload</span> isneqz <span class="keyword">with</span> stream_vt_is_cons</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> length <span class="keyword">with</span> stream_vt_length</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">.</span>head <span class="keyword">with</span> stream_vt_head_exn</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">.</span>tail <span class="keyword">with</span> stream_vt_tail_exn</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* end of [stream_vt.sats] *)</span>
</pre>
<pre class="patsyntax">
<span class="comment">(***********************************************************************)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(*                         Applied Type System                         *)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(***********************************************************************)</span>

<span class="comment">(*
** ATS/Postiats - Unleashing the Potential of Types!
** Copyright (C) 2010-2015 Hongwei Xi, ATS Trustful Software, Inc.
** All rights reserved
**
** ATS is free software;  you can  redistribute it and/or modify it under
** the terms of  the GNU GENERAL PUBLIC LICENSE (GPL) as published by the
** Free Software Foundation; either version 3, or (at  your  option)  any
** later version.
**
** ATS is distributed in the hope that it will be useful, but WITHOUT ANY
** WARRANTY; without  even  the  implied  warranty  of MERCHANTABILITY or
** FITNESS FOR A PARTICULAR PURPOSE.  See the  GNU General Public License
** for more details.
**
** You  should  have  received  a  copy of the GNU General Public License
** along  with  ATS;  see the  file COPYING.  If not, please write to the
** Free Software Foundation,  51 Franklin Street, Fifth Floor, Boston, MA
** 02110-1301, USA.
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
** Source:
** $PATSHOME/prelude/SATS/CODEGEN/array.atxt
** Time of generation: Mon Sep  5 21:48:36 2016
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* Author: Hongwei Xi *)</span>
<span class="comment">(* Authoremail: hwxi AT cs DOT bu DOT edu *)</span>
<span class="comment">(* Start time: Feburary, 2012 *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">vtypedef</span>
<span class="staexp">RD<span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span>vt0p</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">a</span></span> <span class="comment">// for commenting: read-only</span>
<span class="neuexp"><span class="keyword">#define</span> NSH <span class="keyword">(</span>x<span class="keyword">)</span> x</span> <span class="comment">// for commenting: no sharing</span>
<span class="neuexp"><span class="keyword">#define</span> SHR <span class="keyword">(</span>x<span class="keyword">)</span> x</span> <span class="comment">// for commenting: it is shared</span>

<span class="comment">(* ****** ****** *)</span>

<span class="staexp"><span class="keyword">sortdef</span> t0p <span class="keyword">=</span> <span class="keyword">t@ype</span></span>
<span class="staexp"><span class="keyword">sortdef</span> vtp <span class="keyword">=</span> viewtype</span>
<span class="staexp"><span class="keyword">sortdef</span> vt0p <span class="keyword">=</span> <span class="keyword">viewt@ype</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
//
// HX: [array_v] can also be defined as follows:
//
dataview
array_v
(
  a:vt@ype+, addr, int
) = // HX: for arry view
  | {l:addr}
    array_v_nil (a, l, 0)
  | {l:addr}{n:int}
    array_v_cons (a, l, n+1) of (a @ l, array_v (a, l+sizeof a, n))
// end of [array_v]
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">dataview</span>
<span class="staexp">arrayopt_v
<span class="keyword">(</span>
  a<span class="keyword">:</span><span class="keyword">vt@ype+</span><span class="keyword">,</span> addr<span class="keyword">,</span> int<span class="keyword">,</span> bool
<span class="keyword">)</span> <span class="keyword">=</span> <span class="comment">// HX: for optional array view</span>
  <span class="keyword">|</span> <span class="prfexp"><span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
    arrayopt_v_some <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">,</span> <span class="staexp">true</span><span class="keyword">)</span> <span class="keyword">of</span> <span class="staexp">array_v</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
  <span class="keyword">|</span> <span class="prfexp"><span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
    arrayopt_v_none <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">,</span> <span class="staexp">false</span><span class="keyword">)</span> <span class="keyword">of</span> <span class="staexp">array_v</span> <span class="keyword">(</span><span class="staexp">a</span><span class="staexp">?</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span></span>
<span class="comment">// end of [arrayopt_v]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="keyword">exception</span>
<span class="dynexp">ArraySubscriptExn <span class="keyword">of</span> <span class="keyword">(</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(*
fun
ArraySubscriptExn():&lt;&gt; exn = "mac#%ArraySubscriptExn_make"
fun
isArraySubscriptExn(x: !exn):&lt;&gt; bool = "mac#%isArraySubscriptExn"
//
macdef
ifArraySubscriptExn
  {tres}(exn, body) =
(
let val x = ,(exn) in
(
//
if
isArraySubscriptExn(x)
then (
  let prval () = __vfree_exn (x) in ,(body) end
) else $raise (x)
//
) : tres // end of [if]
end (* end of [let] *)
) // end of [ifArraySubscriptExn]
*)</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">praxi</span>
lemma_array_param
  <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>A<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="keyword">@[</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">]</span><span class="keyword">[</span><span class="staexp">n</span><span class="keyword">]</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><span class="keyword">[</span>n &gt;= 0<span class="keyword">]</span></span> <span class="staexp">void</span></span>
<span class="comment">// end of [lemma_array_param]</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">praxi</span>
lemma_array_v_param
  <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>pf<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">array_v</span> <span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><span class="keyword">[</span>n &gt;= 0<span class="keyword">]</span></span> <span class="staexp">void</span></span>
<span class="comment">// end of [lemma_array_v_param]</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">praxi</span>
array_v_nil <span class="keyword">:</span>
  <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">prf</span><span class="keyword">&gt;</span> <span class="staexp">array_v</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">0</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">praxi</span>
array_v_unnil <span class="keyword">:</span>
  <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span> <span class="staexp">array_v</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">0</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">prf</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prfun</span>
array_v_unnil_nil <span class="keyword">:</span>
  <span class="staexp"><span class="keyword">{</span>a1<span class="keyword">,</span>a2<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span> <span class="staexp">array_v</span> <span class="keyword">(</span><span class="staexp">a1</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">0</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">prf</span><span class="keyword">&gt;</span> <span class="staexp">array_v</span> <span class="keyword">(</span><span class="staexp">a2</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">0</span><span class="keyword">)</span></span>
<span class="comment">// end of [array_v_unnil_nil]</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">praxi</span>
array_v_cons <span class="keyword">:</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span><span class="staexp">a</span> <span class="staexp"><span class="keyword">@</span></span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">array_v</span> <span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">l</span><span class="staexp">+</span><span class="staexp">sizeof</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">prf</span><span class="keyword">&gt;</span> <span class="staexp">array_v</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">n</span><span class="staexp">+</span><span class="staexp">1</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">praxi</span>
array_v_uncons <span class="keyword">:</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int <span class="keyword">|</span> n <span class="keyword">&gt;</span> 0<span class="keyword">}</span></span>
<span class="staexp">array_v</span> <span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">prf</span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="staexp">a</span> <span class="staexp"><span class="keyword">@</span></span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">array_v</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">l</span><span class="staexp">+</span><span class="staexp">sizeof</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="staexp">-</span><span class="staexp">1</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="prfexp"><span class="keyword">prfun</span>
array_v_sing
  <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span> <span class="keyword">(</span>pf<span class="keyword">:</span> <span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span> <span class="staexp"><span class="keyword">@</span></span> <span class="staexp">l</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">array_v</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">1</span><span class="keyword">)</span></span>
<span class="prfexp"><span class="keyword">prfun</span>
array_v_unsing
  <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span> <span class="keyword">(</span>pf<span class="keyword">:</span> <span class="staexp">array_v</span> <span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">1</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">a</span> <span class="staexp"><span class="keyword">@</span></span> <span class="staexp">l</span></span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
array_getref_at
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span> <span class="keyword">(</span>A<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">RD</span><span class="keyword">(</span><span class="keyword">@[</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">]</span><span class="keyword">[</span><span class="staexp">n</span><span class="keyword">]</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">sizeLt</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">cPtr1</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>t0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk
<span class="keyword">}</span></span> array_get_at_gint
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>A<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">RD</span><span class="keyword">(</span><span class="keyword">@[</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">]</span><span class="keyword">[</span><span class="staexp">n</span><span class="keyword">]</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">g1intLt</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">a</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>t0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk
<span class="keyword">}</span></span> array_get_at_guint
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>A<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">RD</span><span class="keyword">(</span><span class="keyword">@[</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">]</span><span class="keyword">[</span><span class="staexp">n</span><span class="keyword">]</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">g1uintLt</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">a</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">[</span><span class="keyword">]</span> <span class="keyword">with</span> array_get_at_gint <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">[</span><span class="keyword">]</span> <span class="keyword">with</span> array_get_at_guint <span class="keyword">of</span> 0</span>
<span class="comment">//</span>
<span class="neuexp"><span class="keyword">symintr</span> array_get_at</span>
<span class="dynexp"><span class="keyword">overload</span> array_get_at <span class="keyword">with</span> array_get_at_gint <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> array_get_at <span class="keyword">with</span> array_get_at_guint <span class="keyword">of</span> 0</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>t0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk
<span class="keyword">}</span></span> array_set_at_gint
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>A<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="keyword">@[</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">]</span><span class="keyword">[</span><span class="staexp">n</span><span class="keyword">]</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">g1intLt</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>t0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk
<span class="keyword">}</span></span> array_set_at_guint
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>A<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="keyword">@[</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">]</span><span class="keyword">[</span><span class="staexp">n</span><span class="keyword">]</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">g1uintLt</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">[</span><span class="keyword">]</span> <span class="keyword">with</span> array_set_at_gint <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">[</span><span class="keyword">]</span> <span class="keyword">with</span> array_set_at_guint <span class="keyword">of</span> 0</span>
<span class="comment">//</span>
<span class="neuexp"><span class="keyword">symintr</span> array_set_at</span>
<span class="dynexp"><span class="keyword">overload</span> array_set_at <span class="keyword">with</span> array_set_at_gint <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> array_set_at <span class="keyword">with</span> array_set_at_guint <span class="keyword">of</span> 0</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk
<span class="keyword">}</span></span> array_exch_at_gint<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  A<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="keyword">@[</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">]</span><span class="keyword">[</span><span class="staexp">n</span><span class="keyword">]</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">g1intLt</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">a</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk
<span class="keyword">}</span></span> array_exch_at_guint<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  A<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="keyword">@[</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">]</span><span class="keyword">[</span><span class="staexp">n</span><span class="keyword">]</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">g1uintLt</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">a</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span>

<span class="neuexp"><span class="keyword">symintr</span> array_exch_at</span>
<span class="dynexp"><span class="keyword">overload</span> array_exch_at <span class="keyword">with</span> array_exch_at_gint <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> array_exch_at <span class="keyword">with</span> array_exch_at_guint <span class="keyword">of</span> 0</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
array_subreverse
 <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
 <span class="staexp"><span class="keyword">{</span>i<span class="keyword">,</span>j<span class="keyword">:</span>int <span class="keyword">|</span>
  0 &lt;= i<span class="keyword">;</span> i &lt;= j<span class="keyword">;</span> j &lt;= n<span class="keyword">}</span></span>
<span class="keyword">(</span>
  A<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="keyword">@[</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">]</span><span class="keyword">[</span><span class="staexp">n</span><span class="keyword">]</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">(</span><span class="staexp">i</span><span class="keyword">)</span><span class="keyword">,</span> j<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">(</span><span class="staexp">j</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span> <span class="comment">// end of [array_subreverse]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
array_interchange
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  A<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="keyword">@[</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">]</span><span class="keyword">[</span><span class="staexp">n</span><span class="keyword">]</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">sizeLt</span> <span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> j<span class="keyword">:</span> <span class="staexp">sizeLt</span> <span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span> <span class="comment">// end of [array_interchange]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
array_subcirculate
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  A<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="keyword">@[</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">]</span><span class="keyword">[</span><span class="staexp">n</span><span class="keyword">]</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">sizeLt</span> <span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> j<span class="keyword">:</span> <span class="staexp">sizeLt</span> <span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span> <span class="comment">// end of [array_subcirculate]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
array_ptr_takeout
  <span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>i<span class="keyword">:</span>nat <span class="keyword">|</span> i <span class="keyword">&lt;</span> n<span class="keyword">}</span></span>
<span class="keyword">(</span>
  <span class="prfexp"><span class="staexp">array_v</span> <span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span> <span class="keyword">|</span> <span class="staexp">ptr</span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">size_t</span> <span class="staexp">i</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="keyword">(</span>
  <span class="staexp">a</span> <span class="staexp"><span class="keyword">@</span></span> <span class="keyword">(</span><span class="staexp">l</span><span class="staexp">+</span><span class="staexp">i</span><span class="staexp">*</span><span class="staexp">sizeof</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">,</span> <span class="staexp">a</span> <span class="staexp"><span class="keyword">@</span></span> <span class="keyword">(</span><span class="staexp">l</span><span class="staexp">+</span><span class="staexp">i</span><span class="staexp">*</span><span class="staexp">sizeof</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">lin</span><span class="keyword">,</span><span class="staexp">prf</span><span class="keyword">&gt;</span> <span class="staexp">array_v</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">|</span> <span class="staexp">ptr</span> <span class="keyword">(</span><span class="staexp">l</span><span class="staexp">+</span><span class="staexp">i</span><span class="staexp">*</span><span class="staexp">sizeof</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">)</span></span> <span class="comment">(* end of [array_ptr_takeout] *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
array_ptr_alloc
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  asz<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="staexp">n</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp"><span class="keyword">[</span>l<span class="keyword">:</span>agz<span class="keyword">]</span></span>
<span class="keyword">(</span>
  <span class="staexp">array_v</span> <span class="keyword">(</span><span class="staexp">a</span><span class="staexp">?</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">mfree_gc_v</span> <span class="keyword">(</span><span class="staexp">l</span><span class="keyword">)</span> <span class="keyword">|</span> <span class="staexp">ptr</span> <span class="staexp">l</span>
<span class="keyword">)</span></span> <span class="comment">(* end of [array_ptr_alloc] *)</span>

<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span><span class="comment">(*void*)</span><span class="keyword">}</span></span>
array_ptr_free
  <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  <span class="prfexp"><span class="staexp">array_v</span> <span class="keyword">(</span><span class="staexp">a</span><span class="staexp">?</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span><span class="keyword">,</span> <span class="prfexp"><span class="staexp">mfree_gc_v</span> <span class="keyword">(</span><span class="staexp">l</span><span class="keyword">)</span></span> <span class="keyword">|</span> <span class="staexp">ptr</span> <span class="staexp">l</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span> <span class="comment">// end-of-function</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span><span class="comment">(*void*)</span><span class="keyword">}</span></span>
fprint_array$sep <span class="keyword">(</span>out<span class="keyword">:</span> <span class="staexp">FILEref</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
fprint_array_int<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  out<span class="keyword">:</span> <span class="staexp">FILEref</span><span class="keyword">,</span> A<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">RD</span><span class="keyword">(</span><span class="keyword">@[</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">]</span><span class="keyword">[</span><span class="staexp">n</span><span class="keyword">]</span><span class="keyword">)</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span></span> <span class="comment">// end of [fprint_array_int]</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
fprint_array_size<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  out<span class="keyword">:</span> <span class="staexp">FILEref</span><span class="keyword">,</span> A<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">RD</span><span class="keyword">(</span><span class="keyword">@[</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">]</span><span class="keyword">[</span><span class="staexp">n</span><span class="keyword">]</span><span class="keyword">)</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span></span> <span class="comment">// end of [fprint_array_size]</span>
<span class="comment">//</span>
<span class="neuexp"><span class="keyword">symintr</span> fprint_array</span>
<span class="dynexp"><span class="keyword">overload</span> fprint_array <span class="keyword">with</span> fprint_array_int</span>
<span class="dynexp"><span class="keyword">overload</span> fprint_array <span class="keyword">with</span> fprint_array_size</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
fprint_array_sep<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  out<span class="keyword">:</span> <span class="staexp">FILEref</span>
<span class="keyword">,</span> A<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">RD</span><span class="keyword">(</span><span class="keyword">@[</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">]</span><span class="keyword">[</span><span class="staexp">n</span><span class="keyword">]</span><span class="keyword">)</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="staexp">n</span><span class="keyword">,</span> sep<span class="keyword">:</span> <span class="staexp">NSH</span><span class="keyword">(</span><span class="staexp">string</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span></span> <span class="comment">// end of [fprint_array_sep]</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">overload</span> fprint <span class="keyword">with</span> fprint_array</span>
<span class="dynexp"><span class="keyword">overload</span> fprint <span class="keyword">with</span> fprint_array_sep</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
array_copy<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  to<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="keyword">@[</span><span class="staexp">a</span><span class="staexp">?</span><span class="keyword">]</span><span class="keyword">[</span><span class="staexp">n</span><span class="keyword">]</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="keyword">@[</span><span class="staexp">a</span><span class="keyword">]</span><span class="keyword">[</span><span class="staexp">n</span><span class="keyword">]</span>
<span class="keyword">,</span> from<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">RD</span><span class="keyword">(</span><span class="keyword">@[</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">]</span><span class="keyword">[</span><span class="staexp">n</span><span class="keyword">]</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="keyword">@[</span><span class="staexp">a</span><span class="staexp">?!</span><span class="keyword">]</span><span class="keyword">[</span><span class="staexp">n</span><span class="keyword">]</span>
<span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span> <span class="comment">// end of [array_copy]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
array_copy_from_list<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  A<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="keyword">@[</span><span class="staexp">a</span><span class="staexp">?</span><span class="keyword">]</span><span class="keyword">[</span><span class="staexp">n</span><span class="keyword">]</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="keyword">@[</span><span class="staexp">a</span><span class="keyword">]</span><span class="keyword">[</span><span class="staexp">n</span><span class="keyword">]</span><span class="keyword">,</span> xs<span class="keyword">:</span> <span class="staexp">list</span> <span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span> <span class="comment">// end of [array_copy_from_list]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
array_copy_from_list_vt<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  A<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="keyword">@[</span><span class="staexp">a</span><span class="staexp">?</span><span class="keyword">]</span><span class="keyword">[</span><span class="staexp">n</span><span class="keyword">]</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="keyword">@[</span><span class="staexp">a</span><span class="keyword">]</span><span class="keyword">[</span><span class="staexp">n</span><span class="keyword">]</span><span class="keyword">,</span> xs<span class="keyword">:</span> <span class="staexp">list_vt</span> <span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span> <span class="comment">// end of [array_copy_from_list_vt]</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
array_copy_to_list_vt<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  A<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">RD</span><span class="keyword">(</span><span class="keyword">@[</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">]</span><span class="keyword">[</span><span class="staexp">n</span><span class="keyword">]</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="keyword">@[</span><span class="staexp">a</span><span class="staexp">?!</span><span class="keyword">]</span><span class="keyword">[</span><span class="staexp">n</span><span class="keyword">]</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="staexp">n</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">list_vt</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span> <span class="comment">// endfun</span>

<span class="dynexp"><span class="keyword">macdef</span> array2list <span class="keyword">=</span> array_copy_to_list_vt</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
array_tabulate$fopr<span class="keyword">(</span>i<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">)</span><span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
array_ptr_tabulate
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  asz<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp"><span class="keyword">[</span>l<span class="keyword">:</span>addr<span class="keyword">]</span></span> <span class="keyword">(</span><span class="staexp">array_v</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">mfree_gc_v</span><span class="keyword">(</span><span class="staexp">l</span><span class="keyword">)</span> <span class="keyword">|</span> <span class="staexp">ptr</span><span class="keyword">(</span><span class="staexp">l</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">// end of [arrayptr_tabulate]</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> array_foreach<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  A<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="keyword">@[</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">]</span><span class="keyword">[</span><span class="staexp">n</span><span class="keyword">]</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="keyword">@[</span><span class="staexp">a</span><span class="keyword">]</span><span class="keyword">[</span><span class="staexp">n</span><span class="keyword">]</span><span class="keyword">,</span> asz<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">sizeLte</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span></span> <span class="comment">// end of [array_foreach]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>env<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> array_foreach_env<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  A<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="keyword">@[</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">]</span><span class="keyword">[</span><span class="staexp">n</span><span class="keyword">]</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="keyword">@[</span><span class="staexp">a</span><span class="keyword">]</span><span class="keyword">[</span><span class="staexp">n</span><span class="keyword">]</span><span class="keyword">,</span> asz<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="staexp">env</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">sizeLte</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span></span> <span class="comment">// end of [array_foreach_env]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>env<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> array_foreach$cont <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">a</span><span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">env</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">bool</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>env<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> array_foreach$fwork <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">a</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span><span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="staexp">env</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
array_foreach_funenv
  <span class="staexp"><span class="keyword">{</span>v<span class="keyword">:</span>view<span class="keyword">}</span></span>
  <span class="staexp"><span class="keyword">{</span>vt<span class="keyword">:</span>vtype<span class="keyword">}</span></span>
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="staexp"><span class="keyword">{</span>fe<span class="keyword">:</span>eff<span class="keyword">}</span></span>
<span class="keyword">(</span>
  <span class="prfexp">pfv<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">v</span></span>
<span class="keyword">|</span> A<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="keyword">@[</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">]</span><span class="keyword">[</span><span class="staexp">n</span><span class="keyword">]</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="keyword">@[</span><span class="staexp">a</span><span class="keyword">]</span><span class="keyword">[</span><span class="staexp">n</span><span class="keyword">]</span>
<span class="keyword">,</span> asz<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="staexp">n</span>
<span class="keyword">,</span> f<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp"><span class="keyword">!</span></span><span class="staexp">v</span> <span class="keyword">|</span> <span class="staexp">&amp;</span><span class="staexp">a</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span><span class="keyword">,</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">vt</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp"><span class="keyword">fun</span></span><span class="keyword">,</span><span class="staexp">fe</span><span class="keyword">&gt;</span> <span class="staexp">void</span>
<span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">vt</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="staexp">fe</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span>
<span class="comment">// end of [array_foreach_funenv]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
array_foreach_funenv_tsz
  <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
  <span class="staexp"><span class="keyword">{</span>v<span class="keyword">:</span>view<span class="keyword">}</span></span>
  <span class="staexp"><span class="keyword">{</span>vt<span class="keyword">:</span>vtype<span class="keyword">}</span></span>
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="staexp"><span class="keyword">{</span>fe<span class="keyword">:</span>eff<span class="keyword">}</span></span>
<span class="keyword">(</span>
  <span class="prfexp">pfv<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">v</span></span>
<span class="keyword">|</span> A<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="keyword">@[</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">]</span><span class="keyword">[</span><span class="staexp">n</span><span class="keyword">]</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="keyword">@[</span><span class="staexp">a</span><span class="keyword">]</span><span class="keyword">[</span><span class="staexp">n</span><span class="keyword">]</span>
<span class="keyword">,</span> asz<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> tsz<span class="keyword">:</span> <span class="staexp">sizeof_t</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span>
<span class="keyword">,</span> f<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp"><span class="keyword">!</span></span><span class="staexp">v</span> <span class="keyword">|</span> <span class="staexp">&amp;</span><span class="staexp">a</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span><span class="keyword">,</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">vt</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp"><span class="keyword">fun</span></span><span class="keyword">,</span><span class="staexp">fe</span><span class="keyword">&gt;</span> <span class="staexp">void</span>
<span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">vt</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="staexp">fe</span><span class="keyword">&gt;</span> <span class="staexp">void</span> <span class="keyword">=</span> "ext#%"</span>
<span class="comment">// end of [array_foreach_funenv_tsz]</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
array_foreach_fun
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>fe<span class="keyword">:</span>eff<span class="keyword">}</span></span>
<span class="keyword">(</span>
  <span class="staexp">&amp;</span><span class="keyword">(</span><span class="keyword">@[</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">]</span><span class="keyword">[</span><span class="staexp">n</span><span class="keyword">]</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="keyword">@[</span><span class="staexp">a</span><span class="keyword">]</span><span class="keyword">[</span><span class="staexp">n</span><span class="keyword">]</span>
<span class="keyword">,</span> <span class="staexp">size_t</span> <span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> <span class="keyword">(</span><span class="staexp">&amp;</span><span class="staexp">a</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp"><span class="keyword">fun</span></span><span class="keyword">,</span><span class="staexp">fe</span><span class="keyword">&gt;</span> <span class="staexp">void</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="staexp">fe</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span> <span class="comment">// end of [array_foreach_fun]</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
array_foreach_clo
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>fe<span class="keyword">:</span>eff<span class="keyword">}</span></span>
<span class="keyword">(</span>
  A<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="keyword">@[</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">]</span><span class="keyword">[</span><span class="staexp">n</span><span class="keyword">]</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="keyword">@[</span><span class="staexp">a</span><span class="keyword">]</span><span class="keyword">[</span><span class="staexp">n</span><span class="keyword">]</span>
<span class="keyword">,</span> asz<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> f<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="staexp">&amp;</span><span class="staexp">a</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">clo</span><span class="keyword">,</span><span class="staexp">fe</span><span class="keyword">&gt;</span> <span class="staexp">void</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="staexp">fe</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span> <span class="comment">// end of [array_foreach_clo]</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
array_foreach_cloptr
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>fe<span class="keyword">:</span>eff<span class="keyword">}</span></span>
<span class="keyword">(</span>
  A<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="keyword">@[</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">]</span><span class="keyword">[</span><span class="staexp">n</span><span class="keyword">]</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="keyword">@[</span><span class="staexp">a</span><span class="keyword">]</span><span class="keyword">[</span><span class="staexp">n</span><span class="keyword">]</span>
<span class="keyword">,</span> asz<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="staexp">n</span><span class="keyword">,</span> f<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">&amp;</span><span class="staexp">a</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloptr</span><span class="keyword">,</span><span class="staexp">fe</span><span class="keyword">&gt;</span> <span class="staexp">void</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="staexp">fe</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span> <span class="comment">// end of [array_foreach_cloptr]</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
array_foreach_cloref
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>fe<span class="keyword">:</span>eff<span class="keyword">}</span></span>
<span class="keyword">(</span>
  A<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="keyword">@[</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">]</span><span class="keyword">[</span><span class="staexp">n</span><span class="keyword">]</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="keyword">@[</span><span class="staexp">a</span><span class="keyword">]</span><span class="keyword">[</span><span class="staexp">n</span><span class="keyword">]</span>
<span class="keyword">,</span> asz<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> f<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">&amp;</span><span class="staexp">a</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloref</span><span class="keyword">,</span><span class="staexp">fe</span><span class="keyword">&gt;</span> <span class="staexp">void</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="staexp">fe</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span> <span class="comment">// end of [array_foreach_cloref]</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
array_foreach_vclo
  <span class="staexp"><span class="keyword">{</span>v<span class="keyword">:</span>view<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>fe<span class="keyword">:</span>eff<span class="keyword">}</span></span>
<span class="keyword">(</span>
  <span class="prfexp">pfv<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">v</span></span>
<span class="keyword">|</span> A<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="keyword">@[</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">]</span><span class="keyword">[</span><span class="staexp">n</span><span class="keyword">]</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="keyword">@[</span><span class="staexp">a</span><span class="keyword">]</span><span class="keyword">[</span><span class="staexp">n</span><span class="keyword">]</span>
<span class="keyword">,</span> asz<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="staexp">n</span><span class="keyword">,</span> f<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="staexp"><span class="keyword">!</span></span><span class="staexp">v</span> <span class="keyword">|</span> <span class="staexp">&amp;</span><span class="staexp">a</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">clo</span><span class="keyword">,</span><span class="staexp">fe</span><span class="keyword">&gt;</span> <span class="staexp">void</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="staexp">fe</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span> <span class="comment">// end of [array_foreach_vclo]</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
array_foreach_vcloptr
  <span class="staexp"><span class="keyword">{</span>v<span class="keyword">:</span>view<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>fe<span class="keyword">:</span>eff<span class="keyword">}</span></span>
<span class="keyword">(</span>
  <span class="prfexp">pfv<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">v</span></span>
<span class="keyword">|</span> A<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="keyword">@[</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">]</span><span class="keyword">[</span><span class="staexp">n</span><span class="keyword">]</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="keyword">@[</span><span class="staexp">a</span><span class="keyword">]</span><span class="keyword">[</span><span class="staexp">n</span><span class="keyword">]</span>
<span class="keyword">,</span> asz<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> f<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="keyword">(</span><span class="staexp"><span class="keyword">!</span></span><span class="staexp">v</span> <span class="keyword">|</span> <span class="staexp">&amp;</span><span class="staexp">a</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloptr</span><span class="keyword">,</span><span class="staexp">fe</span><span class="keyword">&gt;</span> <span class="staexp">void</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="staexp">fe</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span> <span class="comment">// end of [array_foreach_vcloptr]</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a1<span class="keyword">,</span>a2<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> array_foreach2
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  A1<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="keyword">@[</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a1</span><span class="keyword">)</span><span class="keyword">]</span><span class="keyword">[</span><span class="staexp">n</span><span class="keyword">]</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="keyword">@[</span><span class="staexp">a1</span><span class="keyword">]</span><span class="keyword">[</span><span class="staexp">n</span><span class="keyword">]</span>
<span class="keyword">,</span> A2<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="keyword">@[</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a2</span><span class="keyword">)</span><span class="keyword">]</span><span class="keyword">[</span><span class="staexp">n</span><span class="keyword">]</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="keyword">@[</span><span class="staexp">a2</span><span class="keyword">]</span><span class="keyword">[</span><span class="staexp">n</span><span class="keyword">]</span>
<span class="keyword">,</span> asz<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">sizeLte</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span></span> <span class="comment">// end of [array_foreach2]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a1<span class="keyword">,</span>a2<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>env<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> array_foreach2_env
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  A1<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="keyword">@[</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a1</span><span class="keyword">)</span><span class="keyword">]</span><span class="keyword">[</span><span class="staexp">n</span><span class="keyword">]</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="keyword">@[</span><span class="staexp">a1</span><span class="keyword">]</span><span class="keyword">[</span><span class="staexp">n</span><span class="keyword">]</span>
<span class="keyword">,</span> A2<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="keyword">@[</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a2</span><span class="keyword">)</span><span class="keyword">]</span><span class="keyword">[</span><span class="staexp">n</span><span class="keyword">]</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="keyword">@[</span><span class="staexp">a2</span><span class="keyword">]</span><span class="keyword">[</span><span class="staexp">n</span><span class="keyword">]</span>
<span class="keyword">,</span> asz<span class="keyword">:</span><span class="staexp">size_t</span> <span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="staexp">env</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">env</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">sizeLte</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span></span> <span class="comment">// end of [array_foreach2_env]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a1<span class="keyword">,</span>a2<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>env<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> array_foreach2$cont
  <span class="keyword">(</span>x1<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">a1</span><span class="keyword">,</span> x2<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">a2</span><span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">env</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">bool</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a1<span class="keyword">,</span>a2<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>env<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> array_foreach2$fwork
  <span class="keyword">(</span>x1<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">a1</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span><span class="keyword">,</span> x2<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">a2</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span><span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="staexp">env</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> array_iforeach
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  A<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="keyword">@[</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">]</span><span class="keyword">[</span><span class="staexp">n</span><span class="keyword">]</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="keyword">@[</span><span class="staexp">a</span><span class="keyword">]</span><span class="keyword">[</span><span class="staexp">n</span><span class="keyword">]</span><span class="keyword">,</span> asz<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="staexp">n</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">sizeLte</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span></span> <span class="comment">// end of [array_iforeach]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>env<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> array_iforeach_env
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  A<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="keyword">@[</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">]</span><span class="keyword">[</span><span class="staexp">n</span><span class="keyword">]</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="keyword">@[</span><span class="staexp">a</span><span class="keyword">]</span><span class="keyword">[</span><span class="staexp">n</span><span class="keyword">]</span><span class="keyword">,</span> asz<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="staexp">n</span><span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="staexp">env</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">sizeLte</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span></span> <span class="comment">// end of [array_iforeach_env]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>env<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> array_iforeach$cont<span class="keyword">(</span>i<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">a</span><span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">env</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">bool</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>env<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> array_iforeach$fwork<span class="keyword">(</span>i<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">a</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span><span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="staexp">env</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> array_rforeach<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  A<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="keyword">@[</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">]</span><span class="keyword">[</span><span class="staexp">n</span><span class="keyword">]</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="keyword">@[</span><span class="staexp">a</span><span class="keyword">]</span><span class="keyword">[</span><span class="staexp">n</span><span class="keyword">]</span><span class="keyword">,</span> asz<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">sizeLte</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span></span> <span class="comment">// end of [array_rforeach]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>env<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> array_rforeach_env<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  A<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="keyword">@[</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">]</span><span class="keyword">[</span><span class="staexp">n</span><span class="keyword">]</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="keyword">@[</span><span class="staexp">a</span><span class="keyword">]</span><span class="keyword">[</span><span class="staexp">n</span><span class="keyword">]</span><span class="keyword">,</span> asz<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="staexp">env</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">sizeLte</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span></span> <span class="comment">// end of [array_rforeach_env]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>env<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> array_rforeach$cont<span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">a</span><span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">env</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">bool</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>env<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> array_rforeach$fwork<span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">a</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span><span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="staexp">env</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
array_initize<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  A<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="keyword">@[</span><span class="staexp">a</span><span class="staexp">?</span><span class="keyword">]</span><span class="keyword">[</span><span class="staexp">n</span><span class="keyword">]</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="keyword">@[</span><span class="staexp">a</span><span class="keyword">]</span><span class="keyword">[</span><span class="staexp">n</span><span class="keyword">]</span><span class="keyword">,</span> asz<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span></span> <span class="comment">// end of [array_initize]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
array_initize$init <span class="keyword">(</span>i<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">a</span><span class="staexp">?</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
array_initize_elt<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  A<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="keyword">@[</span><span class="staexp">a</span><span class="staexp">?</span><span class="keyword">]</span><span class="keyword">[</span><span class="staexp">n</span><span class="keyword">]</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="keyword">@[</span><span class="staexp">a</span><span class="keyword">]</span><span class="keyword">[</span><span class="staexp">n</span><span class="keyword">]</span><span class="keyword">,</span> asz<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="staexp">n</span><span class="keyword">,</span> elt<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span> <span class="comment">// end of [array_initize_elt]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
array_initize_list<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  A<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="keyword">@[</span><span class="staexp">a</span><span class="staexp">?</span><span class="keyword">]</span><span class="keyword">[</span><span class="staexp">n</span><span class="keyword">]</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="keyword">@[</span><span class="staexp">a</span><span class="keyword">]</span><span class="keyword">[</span><span class="staexp">n</span><span class="keyword">]</span><span class="keyword">,</span> asz<span class="keyword">:</span> <span class="staexp">int</span> <span class="staexp">n</span><span class="keyword">,</span> xs<span class="keyword">:</span> <span class="staexp">list</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span> <span class="comment">// end of [array_initize_list]</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
array_initize_rlist<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  A<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="keyword">@[</span><span class="staexp">a</span><span class="staexp">?</span><span class="keyword">]</span><span class="keyword">[</span><span class="staexp">n</span><span class="keyword">]</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="keyword">@[</span><span class="staexp">a</span><span class="keyword">]</span><span class="keyword">[</span><span class="staexp">n</span><span class="keyword">]</span><span class="keyword">,</span> asz<span class="keyword">:</span> <span class="staexp">int</span> <span class="staexp">n</span><span class="keyword">,</span> xs<span class="keyword">:</span> <span class="staexp">list</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span> <span class="comment">// end of [array_initize_rlist]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
array_initize_list_vt<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  A<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="keyword">@[</span><span class="staexp">a</span><span class="staexp">?</span><span class="keyword">]</span><span class="keyword">[</span><span class="staexp">n</span><span class="keyword">]</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="keyword">@[</span><span class="staexp">a</span><span class="keyword">]</span><span class="keyword">[</span><span class="staexp">n</span><span class="keyword">]</span><span class="keyword">,</span> asz<span class="keyword">:</span> <span class="staexp">int</span> <span class="staexp">n</span><span class="keyword">,</span> xs<span class="keyword">:</span> <span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span> <span class="comment">// end of [array_initize_list_vt]</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
array_initize_rlist_vt<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  A<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="keyword">@[</span><span class="staexp">a</span><span class="staexp">?</span><span class="keyword">]</span><span class="keyword">[</span><span class="staexp">n</span><span class="keyword">]</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="keyword">@[</span><span class="staexp">a</span><span class="keyword">]</span><span class="keyword">[</span><span class="staexp">n</span><span class="keyword">]</span><span class="keyword">,</span> asz<span class="keyword">:</span> <span class="staexp">int</span> <span class="staexp">n</span><span class="keyword">,</span> xs<span class="keyword">:</span> <span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span> <span class="comment">// end of [array_initize_rlist_vt]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
array_uninitize
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  A<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="keyword">@[</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">]</span><span class="keyword">[</span><span class="staexp">n</span><span class="keyword">]</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="keyword">@[</span><span class="staexp">a</span><span class="staexp">?</span><span class="keyword">]</span><span class="keyword">[</span><span class="staexp">n</span><span class="keyword">]</span><span class="keyword">,</span> asz<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="staexp">n</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span></span> <span class="comment">// end of [array_uninitize]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
array_uninitize$clear<span class="keyword">(</span>i<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">a</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">a</span><span class="staexp">?</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
array_bsearch$ford <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">RD</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
array_bsearch
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>A<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">RD</span><span class="keyword">(</span><span class="keyword">@[</span><span class="staexp">a</span><span class="keyword">]</span><span class="keyword">[</span><span class="staexp">n</span><span class="keyword">]</span><span class="keyword">)</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">sizeLte</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
array_bsearch_fun
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
<span class="comment">//</span>
  A<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">RD</span><span class="keyword">(</span><span class="keyword">@[</span><span class="staexp">a</span><span class="keyword">]</span><span class="keyword">[</span><span class="staexp">n</span><span class="keyword">]</span><span class="keyword">)</span><span class="keyword">,</span> asz<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> key<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">RD</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> cmp<span class="keyword">:</span> <span class="staexp">cmpref</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span>
<span class="comment">//</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">sizeLte</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span></span> <span class="comment">// end of [array_bsearch_fun]</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">(*
** HX: this one is based on [bsearch] in [stdlib]
*)</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
array_bsearch_stdlib
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  A<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">RD</span><span class="keyword">(</span><span class="keyword">@[</span><span class="staexp">a</span><span class="keyword">]</span><span class="keyword">[</span><span class="staexp">n</span><span class="keyword">]</span><span class="keyword">)</span><span class="keyword">,</span> asz<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> key<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">RD</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> cmp<span class="keyword">:</span> <span class="staexp">cmpref</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">Ptr0</span></span> <span class="comment">(* found/~found : ~null/null *)</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
array_quicksort
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  A<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="keyword">@[</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">]</span><span class="keyword">[</span><span class="staexp">n</span><span class="keyword">]</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="keyword">@[</span><span class="staexp">a</span><span class="keyword">]</span><span class="keyword">[</span><span class="staexp">n</span><span class="keyword">]</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="staexp">n</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span> <span class="comment">// end-of-function</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
array_quicksort$cmp<span class="keyword">(</span>x1<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">RD</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> x2<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">RD</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int</span></span><span class="comment">(*sgn*)</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
** HX: this one is based on [qsort] in [stdlib]
*)</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
array_quicksort_stdlib
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  A<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="keyword">@[</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">]</span><span class="keyword">[</span><span class="staexp">n</span><span class="keyword">]</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="keyword">@[</span><span class="staexp">a</span><span class="keyword">]</span><span class="keyword">[</span><span class="staexp">n</span><span class="keyword">]</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="staexp">n</span><span class="keyword">,</span> cmp<span class="keyword">:</span> <span class="staexp">cmpref</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span> <span class="comment">// end of [array_quicksort_stdlib]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>b<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> array_mapto<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  A<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">array</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">,</span> B<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">array</span><span class="keyword">(</span><span class="staexp">b</span><span class="staexp">?</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">array</span> <span class="keyword">(</span><span class="staexp">b</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span></span> <span class="comment">// end of [array_mapto]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>b<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> array_mapto$fwork<span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">a</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">b</span><span class="staexp">?</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">b</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">,</span>b<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>c<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> array_map2to<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  A<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">array</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">,</span> B<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">array</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">b</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">,</span> C<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">array</span><span class="keyword">(</span><span class="staexp">c</span><span class="staexp">?</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">array</span> <span class="keyword">(</span><span class="staexp">c</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span></span> <span class="comment">// end of [array_map2to]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">,</span>b<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>c<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> array_map2to$fwork<span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">a</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">b</span><span class="keyword">,</span> z<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">c</span><span class="staexp">?</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">c</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
array_permute<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>A<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="keyword">@[</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">]</span><span class="keyword">[</span><span class="staexp">n</span><span class="keyword">]</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="keyword">@[</span><span class="staexp">a</span><span class="keyword">]</span><span class="keyword">[</span><span class="staexp">n</span><span class="keyword">]</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="comment">(*void*)</span><span class="keyword">}</span></span>
array_permute$randint <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int <span class="keyword">|</span> n <span class="keyword">&gt;</span> 0<span class="keyword">}</span></span> <span class="keyword">(</span><span class="staexp">size_t</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">sizeLt</span> <span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* end of [array.sats] *)</span>
</pre>
<pre class="patsyntax">
<span class="comment">(***********************************************************************)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(*                         Applied Type System                         *)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(***********************************************************************)</span>

<span class="comment">(*
** ATS/Postiats - Unleashing the Potential of Types!
** Copyright (C) 2010-2015 Hongwei Xi, ATS Trustful Software, Inc.
** All rights reserved
**
** ATS is free software;  you can  redistribute it and/or modify it under
** the terms of  the GNU GENERAL PUBLIC LICENSE (GPL) as published by the
** Free Software Foundation; either version 3, or (at  your  option)  any
** later version.
**
** ATS is distributed in the hope that it will be useful, but WITHOUT ANY
** WARRANTY; without  even  the  implied  warranty  of MERCHANTABILITY or
** FITNESS FOR A PARTICULAR PURPOSE.  See the  GNU General Public License
** for more details.
**
** You  should  have  received  a  copy of the GNU General Public License
** along  with  ATS;  see the  file COPYING.  If not, please write to the
** Free Software Foundation,  51 Franklin Street, Fifth Floor, Boston, MA
** 02110-1301, USA.
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
** Source:
** $PATSHOME/prelude/SATS/CODEGEN/arrayptr.atxt
** Time of generation: Mon Sep  5 21:48:36 2016
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* Author: Hongwei Xi *)</span>
<span class="comment">(* Authoremail: hwxi AT cs DOT bu DOT edu *)</span>
<span class="comment">(* Start time: February, 2012 *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="neuexp"><span class="keyword">#define</span> NSH <span class="keyword">(</span>x<span class="keyword">)</span> x</span> <span class="comment">// for commenting: no sharing</span>
<span class="neuexp"><span class="keyword">#define</span> SHR <span class="keyword">(</span>x<span class="keyword">)</span> x</span> <span class="comment">// for commenting: it is shared</span>

<span class="comment">(* ****** ****** *)</span>

<span class="staexp"><span class="keyword">sortdef</span> t0p <span class="keyword">=</span> <span class="keyword">t@ype</span> <span class="keyword">and</span> vt0p <span class="keyword">=</span> <span class="keyword">viewt@ype</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">#if</span><span class="neuexp"><span class="keyword">(</span>0<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">// HX-2013-06:</span>
<span class="comment">// it is declared in [basic_dyn.sats]</span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">absvtype</span>
arrayptr_vt0ype_addr_int_vtype
  <span class="keyword">(</span>a<span class="keyword">:</span><span class="keyword">vt0ype+</span><span class="keyword">,</span> l<span class="keyword">:</span> addr<span class="keyword">,</span> n<span class="keyword">:</span> int<span class="keyword">)</span> <span class="keyword">=</span> ptr <span class="keyword">(</span>l<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">stadef</span>
<span class="staexp">arrayptr <span class="keyword">=</span> <span class="staexp">arrayptr_vt0ype_addr_int_vtype</span></span>
<span class="keyword">vtypedef</span>
<span class="staexp">arrayptr
  <span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span>vt0p</span><span class="keyword">,</span> <span class="staexp">n<span class="keyword">:</span>int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>l<span class="keyword">:</span>addr<span class="keyword">]</span></span> <span class="staexp">arrayptr</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">#endif</span>

<span class="comment">(* ****** ****** *)</span>

<span class="staexp"><span class="keyword">absvtype</span>
arrayptrout_vt0ype_addr_int_vtype
  <span class="keyword">(</span>a<span class="keyword">:</span><span class="keyword">t@ype</span><span class="keyword">,</span> l<span class="keyword">:</span> addr<span class="keyword">,</span> n<span class="keyword">:</span> int<span class="keyword">)</span> <span class="keyword">=</span> ptr <span class="keyword">(</span>l<span class="keyword">)</span></span>
<span class="keyword">stadef</span> <span class="staexp">arrayptrout <span class="keyword">=</span> <span class="staexp">arrayptrout_vt0ype_addr_int_vtype</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="prfexp"><span class="keyword">praxi</span>
lemma_arrayptr_param<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
  <span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span> <span class="keyword">(</span>A<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">arrayptr</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><span class="keyword">[</span>n &gt;= 0<span class="keyword">]</span></span> <span class="staexp">void</span></span>
<span class="comment">// end of [lemma_arrayptr_param]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">castfn</span>
arrayptr_encode <span class="keyword">:</span>
  <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span><span class="staexp">array_v</span> <span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">mfree_gc_v</span> <span class="staexp">l</span> <span class="keyword">|</span> <span class="staexp">ptr</span> <span class="staexp">l</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">0</span><span class="keyword">&gt;</span> <span class="staexp">arrayptr</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="comment">// end of [arrayptr_encode]</span>
<span class="dynexp"><span class="keyword">castfn</span>
arrayptr_encode2 <span class="keyword">:</span>
  <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">@(</span><span class="staexp">array_v</span> <span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">mfree_gc_v</span> <span class="staexp">l</span> <span class="keyword">|</span> <span class="staexp">ptr</span> <span class="staexp">l</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">0</span><span class="keyword">&gt;</span> <span class="staexp">arrayptr</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="comment">// end of [arrayptr_encode2]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">castfn</span>
arrayptr_objectify
  <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span><span class="prfexp"><span class="staexp">array_v</span> <span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span> <span class="keyword">|</span> <span class="staexp">ptr</span><span class="keyword">(</span><span class="staexp">l</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="staexp">mfree_ngc_v</span><span class="keyword">(</span><span class="staexp">l</span><span class="keyword">)</span> <span class="keyword">|</span> <span class="staexp">arrayptr</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">// end of [arrayptr_objectify]</span>
<span class="dynexp"><span class="keyword">castfn</span>
arrayptr_unobjectify
  <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span><span class="prfexp"><span class="staexp">mfree_ngc_v</span><span class="keyword">(</span><span class="staexp">l</span><span class="keyword">)</span></span> <span class="keyword">|</span> <span class="staexp">arrayptr</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="staexp">array_v</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span> <span class="keyword">|</span> <span class="staexp">ptr</span><span class="keyword">(</span><span class="staexp">l</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">// end of [arrayptr_objectify]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">castfn</span>
arrayptr2ptr
  <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
  <span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span> <span class="keyword">(</span>A<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">arrayptr</span> <span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">ptr</span> <span class="keyword">(</span><span class="staexp">l</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">castfn</span>
arrayptrout2ptr
  <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span> <span class="keyword">(</span>A<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">arrayptrout</span> <span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">ptr</span> <span class="keyword">(</span><span class="staexp">l</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="prfexp"><span class="keyword">praxi</span>
arrayptr_takeout
  <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  A<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">arrayptr</span> <span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">arrayptrout</span> <span class="keyword">(</span><span class="staexp">a</span><span class="staexp">?</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">array_v</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span> <span class="comment">// end of [arrayptr_takeout]</span>

<span class="prfexp"><span class="keyword">praxi</span>
arrayptr_addback
  <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  <span class="prfexp">pf<span class="keyword">:</span> <span class="staexp">array_v</span> <span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span> <span class="keyword">|</span> A<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">arrayptrout</span> <span class="keyword">(</span><span class="staexp">a</span><span class="staexp">?</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">arrayptr</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span></span> <span class="comment">// end of [arrayptr_addback]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">castfn</span>
arrayptr_takeout_viewptr
  <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  A<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">arrayptr</span> <span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">arrayptrout</span> <span class="keyword">(</span><span class="staexp">a</span><span class="staexp">?</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">array_v</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span> <span class="keyword">|</span> <span class="staexp">ptr</span> <span class="staexp">l</span><span class="keyword">)</span></span> <span class="comment">// endfun</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">castfn</span>
arrpsz_encode <span class="keyword">:</span>
  <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">@(</span><span class="staexp">arrayptr</span> <span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">size_t</span> <span class="staexp">n</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">0</span><span class="keyword">&gt;</span> <span class="staexp">arrpsz</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="comment">// end of [arrpsz_encode]</span>

<span class="dynexp"><span class="keyword">castfn</span>
arrpsz_decode <span class="keyword">:</span>
  <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="staexp">arrpsz</span> <span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">0</span><span class="keyword">&gt;</span> <span class="keyword">@(</span><span class="staexp">arrayptr</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">size_t</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="comment">// end of [arrpsz_decode]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span>
arrpsz_get_ptrsize
  <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  psz<span class="keyword">:</span> <span class="staexp">arrpsz</span> <span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> asz<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">size_t</span><span class="staexp">?</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">size_t</span> <span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">arrayptr</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span> <span class="comment">// endfun</span>

<span class="comment">(* ****** ****** *)</span>

<span class="neuexp"><span class="keyword">symintr</span> arrayptr</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>t0p
<span class="keyword">}</span></span> arrayptr_make_elt
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span> <span class="keyword">(</span>asz<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="staexp">n</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">arrayptr</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="comment">// end of [arrayptr_make_elt]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
<span class="keyword">}</span></span> arrayptr_make_intrange
  <span class="staexp"><span class="keyword">{</span>l<span class="keyword">,</span>r<span class="keyword">:</span>int <span class="keyword">|</span> l &lt;= r<span class="keyword">}</span></span>
  <span class="keyword">(</span>l<span class="keyword">:</span> <span class="staexp">int</span> <span class="staexp">l</span><span class="keyword">,</span> r<span class="keyword">:</span> <span class="staexp">int</span> <span class="staexp">r</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">arrayptr</span> <span class="keyword">(</span><span class="staexp">intBtw</span><span class="keyword">(</span><span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">r</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">r</span><span class="staexp">-</span><span class="staexp">l</span><span class="keyword">)</span></span>
<span class="comment">// end of [arrayptr_make_intrange]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">// HX: this one is a field-selection</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
arrayptr_make_arrpsz
  <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>psz<span class="keyword">:</span> <span class="staexp">arrpsz</span> <span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">arrayptr</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> arrayptr <span class="keyword">with</span> arrayptr_make_arrpsz</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
arrayptr_make_list<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>asz<span class="keyword">:</span> <span class="staexp">int</span> <span class="staexp">n</span><span class="keyword">,</span> xs<span class="keyword">:</span> <span class="staexp">list</span> <span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">arrayptr</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="comment">// end of [arrayptr_make_list]</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
arrayptr_make_rlist<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>asz<span class="keyword">:</span> <span class="staexp">int</span> <span class="staexp">n</span><span class="keyword">,</span> xs<span class="keyword">:</span> <span class="staexp">list</span> <span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">arrayptr</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="comment">// end of [arrayptr_make_rlist]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
arrayptr_make_subarray
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>st<span class="keyword">,</span>ln<span class="keyword">:</span>int <span class="keyword">|</span> st+ln &lt;= n<span class="keyword">}</span></span>
  <span class="keyword">(</span>A<span class="keyword">:</span> <span class="staexp">RD</span><span class="keyword">(</span><span class="staexp">arrayref</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">size_t</span> <span class="keyword">(</span><span class="staexp">st</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">size_t</span> <span class="keyword">(</span><span class="staexp">ln</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">arrayptr</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">ln</span><span class="keyword">)</span></span>
<span class="comment">// end of [arrayref_make_subarray]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
arrayptr_make_list_vt<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>asz<span class="keyword">:</span> <span class="staexp">int</span> <span class="staexp">n</span><span class="keyword">,</span> xs<span class="keyword">:</span> <span class="staexp">list_vt</span> <span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">arrayptr</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="comment">// end of [arrayptr_make_list_vt]</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
arrayptr_make_rlist_vt<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>asz<span class="keyword">:</span> <span class="staexp">int</span> <span class="staexp">n</span><span class="keyword">,</span> xs<span class="keyword">:</span> <span class="staexp">list_vt</span> <span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">arrayptr</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="comment">// end of [arrayptr_make_rlist_vt]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
arrayptr_make_uninitized
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span> <span class="keyword">(</span>asz<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">arrayptr</span> <span class="keyword">(</span><span class="staexp">a</span><span class="staexp">?</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="comment">// end of [arrayptr_make_uninitized]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
arrayptr_imake_list<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  A<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">arrayptr</span> <span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">arrayptr</span> <span class="keyword">(</span><span class="staexp">a</span><span class="staexp">?!</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">list_vt</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span> <span class="comment">// end of [arrayptr_imake_list]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span> arrayptr_free
  <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>A<span class="keyword">:</span> <span class="staexp">arrayptr</span> <span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">// end of [arrayptr_free]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
fun{}
fprint_array$sep (out: FILEref): void
*)</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
fprint_arrayptr
  <span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  out<span class="keyword">:</span> <span class="staexp">FILEref</span><span class="keyword">,</span> A<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">arrayptr</span> <span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="staexp">n</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span></span> <span class="comment">// end of [fprint_arrayptr]</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
fprint_arrayptr_sep
  <span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  out<span class="keyword">:</span> <span class="staexp">FILEref</span>
<span class="keyword">,</span> A<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">arrayptr</span> <span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="staexp">n</span><span class="keyword">,</span> sep<span class="keyword">:</span> <span class="staexp">NSH</span><span class="keyword">(</span><span class="staexp">string</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span></span> <span class="comment">// end of [fprint_arrayptr_sep]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>t0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk
<span class="keyword">}</span></span> arrayptr_get_at_gint
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>i<span class="keyword">:</span>nat <span class="keyword">|</span> i <span class="keyword">&lt;</span> n<span class="keyword">}</span></span>
  <span class="keyword">(</span>A<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">arrayptr</span> <span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">g1int</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>t0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk
<span class="keyword">}</span></span> arrayptr_get_at_guint
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>i<span class="keyword">:</span>nat <span class="keyword">|</span> i <span class="keyword">&lt;</span> n<span class="keyword">}</span></span>
  <span class="keyword">(</span>A<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">arrayptr</span> <span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">g1uint</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="neuexp"><span class="keyword">symintr</span> arrayptr_get_at</span>
<span class="dynexp"><span class="keyword">overload</span> arrayptr_get_at <span class="keyword">with</span> arrayptr_get_at_gint</span>
<span class="dynexp"><span class="keyword">overload</span> arrayptr_get_at <span class="keyword">with</span> arrayptr_get_at_guint</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>t0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk
<span class="keyword">}</span></span> arrayptr_set_at_gint
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>i<span class="keyword">:</span>nat <span class="keyword">|</span> i <span class="keyword">&lt;</span> n<span class="keyword">}</span></span>
  <span class="keyword">(</span>A<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">arrayptr</span> <span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">g1int</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>t0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk
<span class="keyword">}</span></span> arrayptr_set_at_guint
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>i<span class="keyword">:</span>nat <span class="keyword">|</span> i <span class="keyword">&lt;</span> n<span class="keyword">}</span></span>
  <span class="keyword">(</span>A<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">arrayptr</span> <span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">g1uint</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="neuexp"><span class="keyword">symintr</span> arrayptr_set_at</span>
<span class="dynexp"><span class="keyword">overload</span> arrayptr_set_at <span class="keyword">with</span> arrayptr_set_at_gint <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> arrayptr_set_at <span class="keyword">with</span> arrayptr_set_at_guint <span class="keyword">of</span> 0</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk
<span class="keyword">}</span></span> arrayptr_exch_at_gint
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>i<span class="keyword">:</span>nat <span class="keyword">|</span> i <span class="keyword">&lt;</span> n<span class="keyword">}</span></span>
  <span class="keyword">(</span>A<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">arrayptr</span> <span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">g1int</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">a</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span>
<span class="comment">// end of [arrayptr_exch_at_gint]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk
<span class="keyword">}</span></span> arrayptr_exch_at_guint
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>i<span class="keyword">:</span>nat <span class="keyword">|</span> i <span class="keyword">&lt;</span> n<span class="keyword">}</span></span>
  <span class="keyword">(</span>A<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">arrayptr</span> <span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">g1uint</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">a</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span>
<span class="comment">// end of [arrayptr_exch_at_guint]</span>
<span class="comment">//</span>
<span class="neuexp"><span class="keyword">symintr</span> arrayptr_exch_at</span>
<span class="dynexp"><span class="keyword">overload</span> arrayptr_exch_at <span class="keyword">with</span> arrayptr_exch_at_gint <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> arrayptr_exch_at <span class="keyword">with</span> arrayptr_exch_at_guint <span class="keyword">of</span> 0</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
arrayptr_interchange
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  A<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">arrayptr</span> <span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">sizeLt</span> <span class="staexp">n</span><span class="keyword">,</span> j<span class="keyword">:</span> <span class="staexp">sizeLt</span> <span class="staexp">n</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span> <span class="comment">// end of [arrayptr_interchange]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
fun{a:vt0p}{env:vt0p}
array_foreach$cont (x: &amp;a, env: &amp;env): void
fun{a:vt0p}{env:vt0p}
array_foreach$fwork (x: &amp;a &gt;&gt; a, env: &amp;(env) &gt;&gt; _): void
*)</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> arrayptr_foreach<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  A<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">arrayptr</span> <span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> asz<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">sizeLte</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span></span> <span class="comment">// end of [arrayptr_foreach]</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>env<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> arrayptr_foreach_env<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  A<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">arrayptr</span> <span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> asz<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="staexp">env</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">sizeLte</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span></span> <span class="comment">// end of [arrayptr_foreach_env]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
arrayptr_foreach_fun
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>fe<span class="keyword">:</span>eff<span class="keyword">}</span></span>
<span class="keyword">(</span>
  A<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">arrayptr</span> <span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> asz<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="staexp">n</span><span class="keyword">,</span> f<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">&amp;</span><span class="staexp">a</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp"><span class="keyword">fun</span></span><span class="keyword">,</span><span class="staexp">fe</span><span class="keyword">&gt;</span> <span class="staexp">void</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="staexp">fe</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span> <span class="comment">// end of [arrayptr_foreach_fun]</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
arrayptr_foreach_funenv
  <span class="staexp"><span class="keyword">{</span>v<span class="keyword">:</span>view<span class="keyword">}</span></span>
  <span class="staexp"><span class="keyword">{</span>vt<span class="keyword">:</span>vtype<span class="keyword">}</span></span>
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="staexp"><span class="keyword">{</span>fe<span class="keyword">:</span>eff<span class="keyword">}</span></span>
<span class="keyword">(</span>
  <span class="prfexp">pfv<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">v</span></span>
<span class="keyword">|</span> A<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">arrayptr</span> <span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">,</span> asz<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="staexp">n</span>
<span class="keyword">,</span> f<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp"><span class="keyword">!</span></span><span class="staexp">v</span> <span class="keyword">|</span> <span class="staexp">&amp;</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">vt</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp"><span class="keyword">fun</span></span><span class="keyword">,</span><span class="staexp">fe</span><span class="keyword">&gt;</span> <span class="staexp">void</span>
<span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">vt</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="staexp">fe</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span>
<span class="comment">// end of [arrayptr_foreach_funenv]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
fun{a:vt0p}{env:vt0p}
array_iforeach$cont (i: size_t, x: &amp;a, env: &amp;env): void
fun{a:vt0p}{env:vt0p}
array_iforeach$fwork (i: size_t, x: &amp;a &gt;&gt; a, env: &amp;(env) &gt;&gt; _): void
*)</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> arrayptr_iforeach<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  A<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">arrayptr</span> <span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> asz<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">sizeLte</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span></span> <span class="comment">// end of [arrayptr_iforeach]</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>env<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> arrayptr_iforeach_env<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  A<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">arrayptr</span> <span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> asz<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="staexp">env</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">sizeLte</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span></span> <span class="comment">// end of [arrayptr_iforeach_env]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
fun{a:vt0p}{env:vt0p}
array_rforeach$cont (x: &amp;a, env: &amp;env): void
fun{a:vt0p}{env:vt0p}
array_rforeach$fwork (x: &amp;a &gt;&gt; a, env: &amp;(env) &gt;&gt; _): void
*)</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> arrayptr_rforeach<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  A<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">arrayptr</span> <span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> asz<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">sizeLte</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span></span> <span class="comment">// end of [arrayptr_rforeach]</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>env<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> arrayptr_rforeach_env<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  A<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">arrayptr</span> <span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> asz<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="staexp">env</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">sizeLte</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span></span> <span class="comment">// end of [arrayptr_rforeach_env]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">(*
fun{a:vt0p}
array_initize$init (i: size_t, x: &amp;a &gt;&gt; a?): void
*)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
arrayptr_initize
  <span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  A<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">arrayptr</span> <span class="keyword">(</span><span class="staexp">a</span><span class="staexp">?</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">arrayptr</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> asz<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="staexp">n</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span></span> <span class="comment">// end of [arrayptr_initize]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">macdef</span>
arrayptr_initialize <span class="keyword">=</span> arrayptr_initize</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">(*
fun{a:vt0p}
array_uninitize$clear (i: size_t, x: &amp;a &gt;&gt; a?): void
*)</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
arrayptr_uninitize
  <span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  A<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">arrayptr</span> <span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">arrayptr</span> <span class="keyword">(</span><span class="staexp">a</span><span class="staexp">?</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> asz<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="staexp">n</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span></span> <span class="comment">// end of [arrayptr_uninitize]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">macdef</span>
arrayptr_uninitialize <span class="keyword">=</span> arrayptr_uninitize</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
fun{a:vt0p}
array_uninitize$clear (i: size_t, x: &amp;a &gt;&gt; a?): void
*)</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
arrayptr_freelin
  <span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>A<span class="keyword">:</span> <span class="staexp">arrayptr</span> <span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> asz<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="comment">// end of [arrayptr_freelin]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">(*
fun{a:vt0p}
array_tabulate$fopr (index: size_t): (a)
*)</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
arrayptr_tabulate
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span> <span class="keyword">(</span>asz<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">arrayptr</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
arrayptr_tabulate_cloref
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span><span class="staexp">size_t</span> <span class="staexp">n</span><span class="keyword">,</span> <span class="keyword">(</span><span class="staexp">sizeLt</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloref</span><span class="keyword">&gt;</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">arrayptr</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
arrayptr_quicksort
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span><span class="keyword">(</span>A<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">arrayptr</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span><span class="keyword">,</span> asz<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">// overloading for certain symbols</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">[</span><span class="keyword">]</span> <span class="keyword">with</span> arrayptr_get_at_gint <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">[</span><span class="keyword">]</span> <span class="keyword">with</span> arrayptr_get_at_guint <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">[</span><span class="keyword">]</span> <span class="keyword">with</span> arrayptr_set_at_gint <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">[</span><span class="keyword">]</span> <span class="keyword">with</span> arrayptr_set_at_guint <span class="keyword">of</span> 0</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">overload</span> free <span class="keyword">with</span> arrayptr_free</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">overload</span> fprint <span class="keyword">with</span> fprint_arrayptr</span>
<span class="dynexp"><span class="keyword">overload</span> fprint <span class="keyword">with</span> fprint_arrayptr_sep</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">overload</span> ptrcast <span class="keyword">with</span> arrayptr2ptr</span>
<span class="dynexp"><span class="keyword">overload</span> ptrcast <span class="keyword">with</span> arrayptrout2ptr</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* end of [arrayptr.sats] *)</span>
</pre>
<pre class="patsyntax">
<span class="comment">(***********************************************************************)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(*                         Applied Type System                         *)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(***********************************************************************)</span>

<span class="comment">(*
** ATS/Postiats - Unleashing the Potential of Types!
** Copyright (C) 2010-2015 Hongwei Xi, ATS Trustful Software, Inc.
** All rights reserved
**
** ATS is free software;  you can  redistribute it and/or modify it under
** the terms of  the GNU GENERAL PUBLIC LICENSE (GPL) as published by the
** Free Software Foundation; either version 3, or (at  your  option)  any
** later version.
**
** ATS is distributed in the hope that it will be useful, but WITHOUT ANY
** WARRANTY; without  even  the  implied  warranty  of MERCHANTABILITY or
** FITNESS FOR A PARTICULAR PURPOSE.  See the  GNU General Public License
** for more details.
**
** You  should  have  received  a  copy of the GNU General Public License
** along  with  ATS;  see the  file COPYING.  If not, please write to the
** Free Software Foundation,  51 Franklin Street, Fifth Floor, Boston, MA
** 02110-1301, USA.
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
** Source:
** $PATSHOME/prelude/SATS/CODEGEN/arrayref.atxt
** Time of generation: Mon Sep  5 21:48:36 2016
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* Author: Hongwei Xi *)</span>
<span class="comment">(* Authoremail: hwxi AT cs DOT bu DOT edu *)</span>
<span class="comment">(* Start time: February, 2012 *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="neuexp"><span class="keyword">#define</span> NSH <span class="keyword">(</span>x<span class="keyword">)</span> x</span> <span class="comment">// for commenting: no sharing</span>
<span class="neuexp"><span class="keyword">#define</span> SHR <span class="keyword">(</span>x<span class="keyword">)</span> x</span> <span class="comment">// for commenting: it is shared</span>

<span class="comment">(* ****** ****** *)</span>

<span class="staexp"><span class="keyword">sortdef</span> tk <span class="keyword">=</span> tkind</span>

<span class="comment">(* ****** ****** *)</span>

<span class="staexp"><span class="keyword">sortdef</span> t0p <span class="keyword">=</span> <span class="keyword">t@ype</span> <span class="keyword">and</span> vt0p <span class="keyword">=</span> <span class="keyword">viewt@ype</span></span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">// arrayref: a reference to an array with no size information attached</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">#if</span><span class="neuexp"><span class="keyword">(</span>0<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">// HX-2013-06:</span>
<span class="comment">// it is declared in [basic_dyn.sats]</span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">abstype</span>
arrayref_vt0ype_int_type
  <span class="keyword">(</span>a<span class="keyword">:</span> <span class="keyword">vt@ype</span><span class="comment">(*elt*)</span><span class="keyword">,</span> n<span class="keyword">:</span> int<span class="comment">(*size*)</span><span class="keyword">)</span> <span class="keyword">=</span> ptr</span>
<span class="keyword">stadef</span> <span class="staexp">arrayref <span class="keyword">=</span> <span class="staexp">arrayref_vt0ype_int_type</span></span>
<span class="keyword">#endif</span>

<span class="comment">(* ****** ****** *)</span>

<span class="prfexp"><span class="keyword">praxi</span>
lemma_arrayref_param
  <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span> <span class="keyword">(</span>A<span class="keyword">:</span> <span class="staexp">arrayref</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><span class="keyword">[</span>n &gt;= 0<span class="keyword">]</span></span> <span class="staexp">void</span></span>
<span class="comment">// end of [lemma_arrayref_param]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">castfn</span>
arrayref2ptr<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span> <span class="keyword">(</span>A<span class="keyword">:</span> <span class="staexp">arrayref</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">Ptr0</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
** HX-2012-06:
** this function essentially passes the proof of array-view
** to GC (leaks it if GC is unavailable)
*)</span>
<span class="dynexp"><span class="keyword">castfn</span>
arrayptr_refize
  <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
  <span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span>
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span> <span class="keyword">(</span>
  A<span class="keyword">:</span> <span class="staexp">arrayptr</span> <span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">arrayref</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span> <span class="comment">// end of [arrayptr_refize]</span>

<span class="dynexp"><span class="keyword">castfn</span>
arrayref_get_viewptr
  <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span> <span class="keyword">(</span>
  A<span class="keyword">:</span> <span class="staexp">arrayref</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp"><span class="keyword">[</span>l<span class="keyword">:</span>addr<span class="keyword">]</span></span> <span class="keyword">(</span><span class="staexp">vbox</span> <span class="keyword">(</span><span class="staexp">array_v</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">|</span> <span class="staexp">ptr</span> <span class="staexp">l</span><span class="keyword">)</span></span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="neuexp"><span class="keyword">symintr</span> arrayref</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
arrayref_make_arrpsz
  <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>psz<span class="keyword">:</span> <span class="staexp">arrpsz</span> <span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">arrayref</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#%"</span>
<span class="dynexp"><span class="keyword">overload</span> arrayref <span class="keyword">with</span> arrayref_make_arrpsz</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
arrayref_make_elt
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span> <span class="keyword">(</span>asz<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="staexp">n</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">arrayref</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="comment">// end of [arrayref_make_elt]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
<span class="keyword">}</span></span> arrayref_make_intrange
  <span class="staexp"><span class="keyword">{</span>l<span class="keyword">,</span>r<span class="keyword">:</span>int <span class="keyword">|</span> l &lt;= r<span class="keyword">}</span></span> <span class="keyword">(</span>l<span class="keyword">:</span> <span class="staexp">int</span> <span class="staexp">l</span><span class="keyword">,</span> r<span class="keyword">:</span> <span class="staexp">int</span> <span class="staexp">r</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">arrayref</span> <span class="keyword">(</span><span class="staexp">int</span><span class="keyword">,</span> <span class="staexp">r</span><span class="staexp">-</span><span class="staexp">l</span><span class="keyword">)</span></span>
<span class="comment">// end of [arrayref_make_intrange]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
arrayref_make_list<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>asz<span class="keyword">:</span> <span class="staexp">int</span> <span class="staexp">n</span><span class="keyword">,</span> xs<span class="keyword">:</span> <span class="staexp">list</span> <span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">arrayref</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="comment">// end of [arrayref_make_list]</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
arrayref_make_rlist<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>asz<span class="keyword">:</span> <span class="staexp">int</span> <span class="staexp">n</span><span class="keyword">,</span> xs<span class="keyword">:</span> <span class="staexp">list</span> <span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">arrayref</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="comment">// end of [arrayref_make_rlist]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">// HX-2014-02:</span>
<span class="comment">// [A] must survive [arrayref_tail(A)]</span>
<span class="comment">// in order to support proper garbage-collection</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
arrayref_head
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>pos<span class="keyword">}</span></span> <span class="keyword">(</span>A<span class="keyword">:</span> <span class="staexp">arrayref</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">ref</span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span> <span class="comment">// A[0]</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
arrayref_tail
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>pos<span class="keyword">}</span></span> <span class="keyword">(</span>A<span class="keyword">:</span> <span class="staexp">arrayref</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">ref</span><span class="keyword">&gt;</span> <span class="staexp">arrayref</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="staexp">-</span><span class="staexp">1</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>t0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk
<span class="keyword">}</span></span> arrayref_get_at_gint
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>i<span class="keyword">:</span>nat <span class="keyword">|</span> i <span class="keyword">&lt;</span> n<span class="keyword">}</span></span>
<span class="keyword">(</span>
  A<span class="keyword">:</span> <span class="staexp">arrayref</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">g1int</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">ref</span><span class="keyword">&gt;</span> <span class="staexp">a</span></span> <span class="comment">// end of [arrayref_get_at_gint]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>t0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk
<span class="keyword">}</span></span> arrayref_get_at_guint
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>i<span class="keyword">:</span>nat <span class="keyword">|</span> i <span class="keyword">&lt;</span> n<span class="keyword">}</span></span>
<span class="keyword">(</span>
  A<span class="keyword">:</span> <span class="staexp">arrayref</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">g1uint</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">ref</span><span class="keyword">&gt;</span> <span class="staexp">a</span></span> <span class="comment">// end of [arrayref_get_at_guint]</span>
<span class="comment">//</span>
<span class="neuexp"><span class="keyword">symintr</span> arrayref_get_at</span>
<span class="dynexp"><span class="keyword">overload</span> arrayref_get_at <span class="keyword">with</span> arrayref_get_at_gint <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> arrayref_get_at <span class="keyword">with</span> arrayref_get_at_guint <span class="keyword">of</span> 0</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>t0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk
<span class="keyword">}</span></span> arrayref_set_at_gint
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>i<span class="keyword">:</span>nat <span class="keyword">|</span> i <span class="keyword">&lt;</span> n<span class="keyword">}</span></span> <span class="keyword">(</span>
  A<span class="keyword">:</span> <span class="staexp">arrayref</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">g1int</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="staexp">a</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">refwrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span> <span class="comment">// end of [arrayref_set_at_gint]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>t0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk
<span class="keyword">}</span></span> arrayref_set_at_guint
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>i<span class="keyword">:</span>nat <span class="keyword">|</span> i <span class="keyword">&lt;</span> n<span class="keyword">}</span></span> <span class="keyword">(</span>
  A<span class="keyword">:</span> <span class="staexp">arrayref</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">g1uint</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="staexp">a</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">refwrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span> <span class="comment">// end of [arrayref_set_at_guint]</span>
<span class="comment">//</span>
<span class="neuexp"><span class="keyword">symintr</span> arrayref_set_at</span>
<span class="dynexp"><span class="keyword">overload</span> arrayref_set_at <span class="keyword">with</span> arrayref_set_at_gint <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> arrayref_set_at <span class="keyword">with</span> arrayref_set_at_guint <span class="keyword">of</span> 0</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk
<span class="keyword">}</span></span> arrayref_exch_at_gint
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>i<span class="keyword">:</span>nat <span class="keyword">|</span> i <span class="keyword">&lt;</span> n<span class="keyword">}</span></span> <span class="keyword">(</span>
  A<span class="keyword">:</span> <span class="staexp">arrayref</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">g1int</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">a</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">refwrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span> <span class="comment">// end of [arrayref_exch_at_gint]</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk
<span class="keyword">}</span></span> arrayref_exch_at_guint
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>i<span class="keyword">:</span>nat <span class="keyword">|</span> i <span class="keyword">&lt;</span> n<span class="keyword">}</span></span> <span class="keyword">(</span>
  A<span class="keyword">:</span> <span class="staexp">arrayref</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">g1uint</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">a</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">refwrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span> <span class="comment">// end of [arrayref_exch_at_guint]</span>

<span class="neuexp"><span class="keyword">symintr</span> arrayref_exch_at</span>
<span class="dynexp"><span class="keyword">overload</span> arrayref_exch_at <span class="keyword">with</span> arrayref_exch_at_gint <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> arrayref_exch_at <span class="keyword">with</span> arrayref_exch_at_guint <span class="keyword">of</span> 0</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
arrayref_interchange
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span> <span class="keyword">(</span>A<span class="keyword">:</span> <span class="staexp">arrayref</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">sizeLt</span> <span class="staexp">n</span><span class="keyword">,</span> j<span class="keyword">:</span> <span class="staexp">sizeLt</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">refwrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span>
<span class="comment">// end of [arrayref_interchange]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
arrayref_subcirculate
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span> <span class="keyword">(</span>A<span class="keyword">:</span> <span class="staexp">arrayref</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">sizeLt</span> <span class="staexp">n</span><span class="keyword">,</span> j<span class="keyword">:</span> <span class="staexp">sizeLt</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">refwrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span>
<span class="comment">// end of [arrayref_subcirculate]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
fun{}
fprint_array$sep (out: FILEref): void
*)</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
fprint_arrayref
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span> <span class="keyword">(</span>
  out<span class="keyword">:</span> <span class="staexp">FILEref</span><span class="keyword">,</span> A<span class="keyword">:</span> <span class="staexp">arrayref</span> <span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="staexp">n</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span></span> <span class="comment">// end of [fprint_arrayref]</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
fprint_arrayref_sep
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span> <span class="keyword">(</span>
  out<span class="keyword">:</span> <span class="staexp">FILEref</span>
<span class="keyword">,</span> A<span class="keyword">:</span> <span class="staexp">arrayref</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> asz<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="staexp">n</span><span class="keyword">,</span> sep<span class="keyword">:</span> <span class="staexp">NSH</span><span class="keyword">(</span><span class="staexp">string</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span></span> <span class="comment">// end of [fprint_arrayref_sep]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
arrayref_copy<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>A<span class="keyword">:</span> <span class="staexp">arrayref</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">arrayptr</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="comment">// end of [arrayref_copy]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">(*
fun{a:vt0p}
array_tabulate$fopr (index: size_t): (a)
*)</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
arrayref_tabulate
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span> <span class="keyword">(</span>asz<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">arrayref</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
arrayref_tabulate_cloref
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span> <span class="keyword">(</span><span class="staexp">size_t</span> <span class="staexp">n</span><span class="keyword">,</span> <span class="keyword">(</span><span class="staexp">sizeLt</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloref</span><span class="keyword">&gt;</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">arrayref</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
fun{a:vt0p}{env:vt0p}
array_foreach$cont (x: &amp;a, env: &amp;env): void
fun{a:vt0p}{env:vt0p}
array_foreach$fwork (x: &amp;a &gt;&gt; a, env: &amp;(env) &gt;&gt; _): void
*)</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
arrayref_foreach<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  A<span class="keyword">:</span> <span class="staexp">arrayref</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> asz<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">sizeLte</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span></span> <span class="comment">// end of [arrayref_foreach]</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
<span class="staexp"><span class="keyword">{</span>env<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
arrayref_foreach_env<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  A<span class="keyword">:</span> <span class="staexp">arrayref</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> asz<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">env</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">sizeLte</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span></span> <span class="comment">// end of [arrayref_foreach_env]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
fun
{a:vt0p}
{env:vt0p}
array_iforeach$cont
  (i: size_t, x: &amp;a, env: &amp;env): void
fun
{a:vt0p}
{env:vt0p}
array_iforeach$fwork
  (i: size_t, x: &amp;a &gt;&gt; a, env: &amp;(env) &gt;&gt; _): void
*)</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
arrayref_iforeach<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  A<span class="keyword">:</span> <span class="staexp">arrayref</span> <span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> asz<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">sizeLte</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span></span> <span class="comment">// end of [arrayref_iforeach]</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
<span class="staexp"><span class="keyword">{</span>env<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
arrayref_iforeach_env<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  A<span class="keyword">:</span> <span class="staexp">arrayref</span> <span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> asz<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="staexp">env</span><span class="keyword">)</span><span class="staexp">&gt;&gt;</span><span class="staexp">env</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">sizeLte</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span></span> <span class="comment">// end of [arrayref_iforeach_env]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
fun{a:vt0p}{env:vt0p}
array_rforeach$cont (x: &amp;a, env: &amp;env): void
fun{a:vt0p}{env:vt0p}
array_rforeach$fwork (x: &amp;a &gt;&gt; a, env: &amp;(env) &gt;&gt; _): void
*)</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> arrayref_rforeach<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span> <span class="keyword">(</span>
  A<span class="keyword">:</span> <span class="staexp">arrayref</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> asz<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">sizeLte</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span></span> <span class="comment">// end of [arrayref_rforeach]</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>env<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> arrayref_rforeach_env<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span> <span class="keyword">(</span>
  A<span class="keyword">:</span> <span class="staexp">arrayref</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> asz<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="staexp">env</span><span class="keyword">)</span><span class="staexp">&gt;&gt;</span><span class="staexp">env</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">sizeLte</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span></span> <span class="comment">// end of [arrayref_rforeach_env]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
arrayref_quicksort
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span><span class="keyword">(</span>A<span class="keyword">:</span> <span class="staexp">arrayref</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> asz<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">// arrszref: a reference to an array with size information attached</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">#if</span><span class="neuexp"><span class="keyword">(</span>0<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">// HX-2013-06:</span>
<span class="comment">// it is declared in [basic_dyn.sats]</span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">abstype</span>
arrszref_vt0ype_type <span class="keyword">(</span>a<span class="keyword">:</span> <span class="keyword">vt@ype</span><span class="keyword">)</span> <span class="keyword">=</span> ptr</span>
<span class="keyword">stadef</span> <span class="staexp">arrszref <span class="keyword">=</span> <span class="staexp">arrszref_vt0ype_type</span></span>
<span class="comment">//</span>
<span class="keyword">#endif</span>

<span class="comment">(* ****** ****** *)</span>

<span class="neuexp"><span class="keyword">symintr</span> arrszref</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
arrszref_make_arrpsz
  <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span><span class="staexp">arrpsz</span> <span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">arrszref</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> arrszref <span class="keyword">with</span> arrszref_make_arrpsz</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
arrszref_make_arrayref
  <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>A<span class="keyword">:</span> <span class="staexp">SHR</span><span class="keyword">(</span><span class="staexp">arrayref</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">arrszref</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">// end of [arrszref_make_arrayref]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
<span class="keyword">}</span></span> arrszref_get_ref<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span> <span class="keyword">(</span>A<span class="keyword">:</span> <span class="staexp">arrszref</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">Ptr1</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
<span class="keyword">}</span></span> arrszref_get_size<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span> <span class="keyword">(</span>A<span class="keyword">:</span> <span class="staexp">arrszref</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">size_t</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
arrszref_get_refsize<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
  <span class="keyword">(</span>A<span class="keyword">:</span> <span class="staexp">arrszref</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> asz<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">size_t</span><span class="staexp">?</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">size_t</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp"><span class="keyword">#[</span>n<span class="keyword">:</span>nat<span class="keyword">]</span></span> <span class="staexp">arrayref</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="comment">// end of [arrszref_get_refsize]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
arrszref_make_elt <span class="keyword">(</span>asz<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">arrszref</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">// end of [arrszref_make_elt]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
arrszref_make_list <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">List</span> <span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">arrszref</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">// end of [arrszref_make_list]</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
arrszref_make_rlist <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">List</span> <span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">arrszref</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">// end of [arrszref_make_rlist]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
fun{}
fprint_array$sep (out: FILEref): void
*)</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
fprint_arrszref
  <span class="keyword">(</span>out<span class="keyword">:</span> <span class="staexp">FILEref</span><span class="keyword">,</span> A<span class="keyword">:</span> <span class="staexp">arrszref</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="comment">// end of [fprint_arrszref]</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
fprint_arrszref_sep <span class="keyword">(</span>
  out<span class="keyword">:</span> <span class="staexp">FILEref</span><span class="keyword">,</span> A<span class="keyword">:</span> <span class="staexp">arrszref</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> sep<span class="keyword">:</span> <span class="staexp">NSH</span><span class="keyword">(</span><span class="staexp">string</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span></span> <span class="comment">// end of [fprint_arrszref_sep]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
arrszref_get_at_size
  <span class="keyword">(</span>A<span class="keyword">:</span> <span class="staexp">arrszref</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">exnref</span><span class="keyword">&gt;</span> <span class="staexp">a</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>t0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk
<span class="keyword">}</span></span> arrszref_get_at_gint
  <span class="keyword">(</span>A<span class="keyword">:</span> <span class="staexp">arrszref</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">g0int</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">exnref</span><span class="keyword">&gt;</span> <span class="staexp">a</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>t0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk
<span class="keyword">}</span></span> arrszref_get_at_guint
  <span class="keyword">(</span>A<span class="keyword">:</span> <span class="staexp">arrszref</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">g0uint</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">exnref</span><span class="keyword">&gt;</span> <span class="staexp">a</span></span>
<span class="comment">//</span>
<span class="neuexp"><span class="keyword">symintr</span> arrszref_get_at</span>
<span class="dynexp"><span class="keyword">overload</span> arrszref_get_at <span class="keyword">with</span> arrszref_get_at_gint <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> arrszref_get_at <span class="keyword">with</span> arrszref_get_at_guint <span class="keyword">of</span> 0</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
arrszref_set_at_size
  <span class="keyword">(</span>A<span class="keyword">:</span> <span class="staexp">arrszref</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">exnrefwrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>t0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk
<span class="keyword">}</span></span> arrszref_set_at_gint
  <span class="keyword">(</span>A<span class="keyword">:</span> <span class="staexp">arrszref</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">g0int</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">exnrefwrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>t0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk
<span class="keyword">}</span></span> arrszref_set_at_guint
  <span class="keyword">(</span>A<span class="keyword">:</span> <span class="staexp">arrszref</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">g0uint</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">exnrefwrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="neuexp"><span class="keyword">symintr</span> arrszref_set_at</span>
<span class="dynexp"><span class="keyword">overload</span> arrszref_set_at <span class="keyword">with</span> arrszref_set_at_gint <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> arrszref_set_at <span class="keyword">with</span> arrszref_set_at_guint <span class="keyword">of</span> 0</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
arrszref_exch_at_size
  <span class="keyword">(</span>A<span class="keyword">:</span> <span class="staexp">arrszref</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">a</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">exnrefwrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span>
<span class="comment">// end of [arrszref_exch_at_size]</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk
<span class="keyword">}</span></span> arrszref_exch_at_gint
  <span class="keyword">(</span>A<span class="keyword">:</span> <span class="staexp">arrszref</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">g0int</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">a</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">exnrefwrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span>
<span class="comment">// end of [arrszref_exch_at_gint]</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>tk<span class="keyword">:</span>tk
<span class="keyword">}</span></span> arrszref_exch_at_guint
  <span class="keyword">(</span>A<span class="keyword">:</span> <span class="staexp">arrszref</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">g0uint</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">a</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">exnrefwrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span>
<span class="comment">// end of [arrszref_exch_at_guint]</span>

<span class="neuexp"><span class="keyword">symintr</span> arrszref_exch_at</span>
<span class="dynexp"><span class="keyword">overload</span> arrszref_exch_at <span class="keyword">with</span> arrszref_exch_at_gint <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> arrszref_exch_at <span class="keyword">with</span> arrszref_exch_at_guint <span class="keyword">of</span> 0</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
arrszref_interchange
  <span class="keyword">(</span>A<span class="keyword">:</span> <span class="staexp">arrszref</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">,</span> j<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">exnrefwrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span>
<span class="comment">// end of [arrszref_interchange]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
arrszref_subcirculate
  <span class="keyword">(</span>A<span class="keyword">:</span> <span class="staexp">arrszref</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">,</span> j<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">exnrefwrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span>
<span class="comment">// end of [arrszref_subcirculate]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">(*
fun{a:vt0p}
array_tabulate$fopr (index: size_t): (a)
*)</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
arrszref_tabulate <span class="keyword">(</span>asz<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">arrszref</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
arrszref_tabulate_cloref
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span> <span class="keyword">(</span><span class="staexp">size_t</span> <span class="staexp">n</span><span class="keyword">,</span> <span class="keyword">(</span><span class="staexp">sizeLt</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloref</span><span class="keyword">&gt;</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">arrszref</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">// overloading for certain symbols</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">[</span><span class="keyword">]</span> <span class="keyword">with</span> arrayref_get_at_gint <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">[</span><span class="keyword">]</span> <span class="keyword">with</span> arrayref_get_at_guint <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">[</span><span class="keyword">]</span> <span class="keyword">with</span> arrayref_set_at_gint <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">[</span><span class="keyword">]</span> <span class="keyword">with</span> arrayref_set_at_guint <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">[</span><span class="keyword">]</span> <span class="keyword">with</span> arrszref_get_at_gint <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">[</span><span class="keyword">]</span> <span class="keyword">with</span> arrszref_get_at_guint <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">[</span><span class="keyword">]</span> <span class="keyword">with</span> arrszref_set_at_gint <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">[</span><span class="keyword">]</span> <span class="keyword">with</span> arrszref_set_at_guint <span class="keyword">of</span> 0</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">.</span>head <span class="keyword">with</span> arrayref_head</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">.</span>tail <span class="keyword">with</span> arrayref_tail</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">.</span>size <span class="keyword">with</span> arrszref_get_size</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">overload</span> fprint <span class="keyword">with</span> fprint_arrayref</span>
<span class="dynexp"><span class="keyword">overload</span> fprint <span class="keyword">with</span> fprint_arrayref_sep</span>
<span class="dynexp"><span class="keyword">overload</span> fprint <span class="keyword">with</span> fprint_arrszref</span>
<span class="dynexp"><span class="keyword">overload</span> fprint <span class="keyword">with</span> fprint_arrszref_sep</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">overload</span> ptrcast <span class="keyword">with</span> arrayref2ptr</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* end of [arrayref.sats] *)</span>
</pre>
<pre class="patsyntax">
<span class="comment">(***********************************************************************)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(*                         Applied Type System                         *)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(***********************************************************************)</span>

<span class="comment">(*
** ATS/Postiats - Unleashing the Potential of Types!
** Copyright (C) 2010-2015 Hongwei Xi, ATS Trustful Software, Inc.
** All rights reserved
**
** ATS is free software;  you can  redistribute it and/or modify it under
** the terms of  the GNU GENERAL PUBLIC LICENSE (GPL) as published by the
** Free Software Foundation; either version 3, or (at  your  option)  any
** later version.
**
** ATS is distributed in the hope that it will be useful, but WITHOUT ANY
** WARRANTY; without  even  the  implied  warranty  of MERCHANTABILITY or
** FITNESS FOR A PARTICULAR PURPOSE.  See the  GNU General Public License
** for more details.
**
** You  should  have  received  a  copy of the GNU General Public License
** along  with  ATS;  see the  file COPYING.  If not, please write to the
** Free Software Foundation,  51 Franklin Street, Fifth Floor, Boston, MA
** 02110-1301, USA.
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
** Source:
** $PATSHOME/prelude/SATS/CODEGEN/matrix.atxt
** Time of generation: Mon Sep  5 21:48:36 2016
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* Author: Hongwei Xi *)</span>
<span class="comment">(* Authoremail: hwxi AT cs DOT bu DOT edu *)</span>
<span class="comment">(* Start time: Feburary, 2012 *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">vtypedef</span>
<span class="staexp">RD<span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span>vt0p</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">a</span></span> <span class="comment">// for commenting: read-only</span>
<span class="neuexp"><span class="keyword">#define</span> NSH <span class="keyword">(</span>x<span class="keyword">)</span> x</span> <span class="comment">// for commenting: no sharing</span>
<span class="neuexp"><span class="keyword">#define</span> SHR <span class="keyword">(</span>x<span class="keyword">)</span> x</span> <span class="comment">// for commenting: it is shared</span>

<span class="comment">(* ****** ****** *)</span>

<span class="staexp"><span class="keyword">sortdef</span> t0p <span class="keyword">=</span> <span class="keyword">t@ype</span></span>
<span class="staexp"><span class="keyword">sortdef</span> vtp <span class="keyword">=</span> viewtype</span>
<span class="staexp"><span class="keyword">sortdef</span> vt0p <span class="keyword">=</span> <span class="keyword">viewt@ype</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="staexp"><span class="keyword">absvt@ype</span>
matrix_vt0ype_int_int_vt0ype
  <span class="keyword">(</span>a<span class="keyword">:</span><span class="keyword">vt@ype+</span><span class="keyword">,</span> row<span class="keyword">:</span>int<span class="keyword">,</span> col<span class="keyword">:</span>int<span class="keyword">)</span> <span class="keyword">=</span> array<span class="keyword">(</span>a<span class="keyword">,</span> row*col<span class="keyword">)</span></span>
<span class="keyword">stadef</span> <span class="staexp">matrix <span class="keyword">=</span> <span class="staexp">matrix_vt0ype_int_int_vt0ype</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">viewdef</span>
<span class="staexp">matrix_v <span class="keyword">(</span>
  <span class="staexp">a<span class="keyword">:</span><span class="keyword">viewt@ype+</span></span><span class="keyword">,</span> <span class="staexp">l<span class="keyword">:</span>addr</span><span class="keyword">,</span> <span class="staexp">row<span class="keyword">:</span>int</span><span class="keyword">,</span> <span class="staexp">col<span class="keyword">:</span>int</span>
<span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">matrix</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">row</span><span class="keyword">,</span> <span class="staexp">col</span><span class="keyword">)</span> <span class="staexp"><span class="keyword">@</span></span> <span class="staexp">l</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">exception</span>
<span class="dynexp">MatrixSubscriptExn <span class="keyword">of</span> <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span></span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">praxi</span>
lemma_matrix_param
  <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
  <span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  M<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">matrix</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp"><span class="keyword">[</span>m &gt;= 0<span class="keyword">;</span> n &gt;= 0<span class="keyword">]</span></span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">praxi</span>
lemma_matrix_v_param
  <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
  <span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  pf0<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">matrix_v</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp"><span class="keyword">[</span>m &gt;= 0<span class="keyword">;</span> n &gt;= 0<span class="keyword">]</span></span> <span class="staexp">void</span></span> <span class="comment">// end-of-fun</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">praxi</span>
array2matrix_v
  <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
  <span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  pf0<span class="keyword">:</span>
  <span class="staexp">array_v</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">m</span><span class="staexp">*</span><span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">matrix_v</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">m</span><span class="comment">(*nrow*)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="comment">(*ncol*)</span><span class="keyword">)</span></span>
<span class="prfexp"><span class="keyword">praxi</span>
matrix2array_v
  <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
  <span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>pf0<span class="keyword">:</span> <span class="staexp">matrix_v</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">array_v</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">m</span><span class="staexp">*</span><span class="staexp">n</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">// HX: row-major style</span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">absview</span>
matrow_view
<span class="keyword">(</span>
  a<span class="keyword">:</span><span class="keyword">vt@ype+</span>
<span class="keyword">,</span> l<span class="keyword">:</span>addr<span class="keyword">,</span> m<span class="keyword">:</span>int<span class="keyword">,</span> n<span class="keyword">:</span>int
<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">stadef</span> <span class="staexp">matrow_v <span class="keyword">=</span> <span class="staexp">matrow_view</span></span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">absview</span>
matcol_view
<span class="keyword">(</span>
  a<span class="keyword">:</span><span class="keyword">vt@ype+</span>
<span class="keyword">,</span> l<span class="keyword">:</span>addr<span class="keyword">,</span> m<span class="keyword">:</span>int<span class="keyword">,</span> n<span class="keyword">:</span>int
<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">stadef</span> <span class="staexp">matcol_v <span class="keyword">=</span> <span class="staexp">matcol_view</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
matrix_getref_at_int
  <span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  M<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">RD</span><span class="keyword">(</span><span class="staexp">matrix</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">natLt</span> <span class="keyword">(</span><span class="staexp">m</span><span class="keyword">)</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">int</span> <span class="staexp">n</span><span class="keyword">,</span> j<span class="keyword">:</span> <span class="staexp">natLt</span> <span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">cPtr1</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span> <span class="comment">// end-of-function</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
matrix_getref_at_size
  <span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  M<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">RD</span><span class="keyword">(</span><span class="staexp">matrix</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">sizeLt</span> <span class="keyword">(</span><span class="staexp">m</span><span class="keyword">)</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="staexp">n</span><span class="keyword">,</span> j<span class="keyword">:</span> <span class="staexp">sizeLt</span> <span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">cPtr1</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span> <span class="comment">// end-of-function</span>
<span class="comment">//</span>
<span class="neuexp"><span class="keyword">symintr</span> matrix_getref_at</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span>
matrix_getref_at <span class="keyword">with</span> matrix_getref_at_int</span>
<span class="dynexp"><span class="keyword">overload</span>
matrix_getref_at <span class="keyword">with</span> matrix_getref_at_size</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
matrix_get_at_int
  <span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  M<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">RD</span><span class="keyword">(</span><span class="staexp">matrix</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">natLt</span> <span class="keyword">(</span><span class="staexp">m</span><span class="keyword">)</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">int</span> <span class="staexp">n</span><span class="keyword">,</span> j<span class="keyword">:</span> <span class="staexp">natLt</span> <span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span> <span class="comment">// end-of-function</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">[</span><span class="keyword">]</span> <span class="keyword">with</span> matrix_get_at_int</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
matrix_get_at_size
  <span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  M<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">RD</span><span class="keyword">(</span><span class="staexp">matrix</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">sizeLt</span> <span class="keyword">(</span><span class="staexp">m</span><span class="keyword">)</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="staexp">n</span><span class="keyword">,</span> j<span class="keyword">:</span> <span class="staexp">sizeLt</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span> <span class="comment">// endfun</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">[</span><span class="keyword">]</span> <span class="keyword">with</span> matrix_get_at_size</span>
<span class="comment">//</span>
<span class="neuexp"><span class="keyword">symintr</span> matrix_get_at</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span>
matrix_get_at <span class="keyword">with</span> matrix_get_at_int <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span>
matrix_get_at <span class="keyword">with</span> matrix_get_at_size <span class="keyword">of</span> 0</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
matrix_set_at_int
  <span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  M<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">matrix</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">natLt</span> <span class="keyword">(</span><span class="staexp">m</span><span class="keyword">)</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">int</span> <span class="staexp">n</span><span class="keyword">,</span> j<span class="keyword">:</span> <span class="staexp">natLt</span> <span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="staexp">a</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span> <span class="comment">// end-of-function</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">[</span><span class="keyword">]</span> <span class="keyword">with</span> matrix_set_at_int</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
matrix_set_at_size
  <span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  M<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">matrix</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">sizeLt</span> <span class="keyword">(</span><span class="staexp">m</span><span class="keyword">)</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="staexp">n</span><span class="keyword">,</span> j<span class="keyword">:</span> <span class="staexp">sizeLt</span> <span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="staexp">a</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span> <span class="comment">// end-of-function</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">[</span><span class="keyword">]</span> <span class="keyword">with</span> matrix_set_at_size</span>
<span class="comment">//</span>
<span class="neuexp"><span class="keyword">symintr</span> matrix_set_at</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span>
matrix_set_at <span class="keyword">with</span> matrix_set_at_int <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span>
matrix_set_at <span class="keyword">with</span> matrix_set_at_size <span class="keyword">of</span> 0</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
matrix_exch_at_int
  <span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  M<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">matrix</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">natLt</span> <span class="keyword">(</span><span class="staexp">m</span><span class="keyword">)</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">int</span> <span class="staexp">n</span><span class="keyword">,</span> j<span class="keyword">:</span> <span class="staexp">natLt</span> <span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">a</span><span class="staexp">&gt;&gt;</span><span class="staexp">a</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span> <span class="comment">// endfun</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
matrix_exch_at_size
  <span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  M<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">matrix</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">sizeLt</span> <span class="keyword">(</span><span class="staexp">m</span><span class="keyword">)</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="staexp">n</span><span class="keyword">,</span> j<span class="keyword">:</span> <span class="staexp">sizeLt</span> <span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">a</span><span class="staexp">&gt;&gt;</span><span class="staexp">a</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span> <span class="comment">// endfun</span>

<span class="neuexp"><span class="keyword">symintr</span> matrix_exch_at</span>
<span class="dynexp"><span class="keyword">overload</span> matrix_exch_at <span class="keyword">with</span> matrix_exch_at_int</span>
<span class="dynexp"><span class="keyword">overload</span> matrix_exch_at <span class="keyword">with</span> matrix_exch_at_size</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
matrix_ptr_alloc
  <span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  row<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="staexp">m</span><span class="keyword">,</span> col<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="staexp">n</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp"><span class="keyword">[</span>l<span class="keyword">:</span>agz<span class="keyword">]</span></span>
<span class="keyword">(</span>
  <span class="staexp">matrix_v</span><span class="keyword">(</span><span class="staexp">a</span><span class="staexp">?</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">mfree_gc_v</span> <span class="keyword">(</span><span class="staexp">l</span><span class="keyword">)</span> <span class="keyword">|</span> <span class="staexp">ptr</span> <span class="staexp">l</span>
<span class="keyword">)</span></span> <span class="comment">// end of [matrix_ptr_alloc]</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
matrix_ptr_free
  <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  <span class="prfexp"><span class="staexp">matrix_v</span><span class="keyword">(</span><span class="staexp">a</span><span class="staexp">?</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span><span class="keyword">,</span> <span class="prfexp"><span class="staexp">mfree_gc_v</span> <span class="staexp">l</span></span> <span class="keyword">|</span> <span class="staexp">ptr</span> <span class="staexp">l</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span> <span class="comment">// end of [matrix_ptr_free]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
matrix_tabulate$fopr
  <span class="keyword">(</span>i<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">,</span> j<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">)</span><span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
matrix_ptr_tabulate
  <span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  nrow<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="staexp">m</span><span class="keyword">,</span> ncol<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="staexp">n</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp"><span class="keyword">[</span>l<span class="keyword">:</span>addr<span class="keyword">]</span></span>
<span class="keyword">(</span>
  <span class="staexp">matrix_v</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">mfree_gc_v</span> <span class="keyword">(</span><span class="staexp">l</span><span class="keyword">)</span> <span class="keyword">|</span> <span class="staexp">ptr</span><span class="keyword">(</span><span class="staexp">l</span><span class="keyword">)</span>
<span class="keyword">)</span></span> <span class="comment">(* end of [matrixptr_tabulate] *)</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
fprint_matrix$sep1<span class="keyword">(</span>out<span class="keyword">:</span> <span class="staexp">FILEref</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span> <span class="comment">// col sep</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
fprint_matrix$sep2<span class="keyword">(</span>out<span class="keyword">:</span> <span class="staexp">FILEref</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span> <span class="comment">// row sep</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
fprint_matrix_int
  <span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  out<span class="keyword">:</span> <span class="staexp">FILEref</span>
<span class="keyword">,</span> mat<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">matrix</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> m<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">(</span><span class="staexp">m</span><span class="keyword">)</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span></span> <span class="comment">// end of [fprint_matrix_int]</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
fprint_matrix_size
  <span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  out<span class="keyword">:</span> <span class="staexp">FILEref</span>
<span class="keyword">,</span> mat<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">matrix</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> m<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">(</span><span class="staexp">m</span><span class="keyword">)</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span></span> <span class="comment">// end of [fprint_matrix_size]</span>
<span class="comment">//</span>
<span class="neuexp"><span class="keyword">symintr</span> fprint_matrix</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> fprint_matrix <span class="keyword">with</span> fprint_matrix_int</span>
<span class="dynexp"><span class="keyword">overload</span> fprint_matrix <span class="keyword">with</span> fprint_matrix_size</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
fprint_matrix_sep
  <span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  out<span class="keyword">:</span> <span class="staexp">FILEref</span>
<span class="keyword">,</span> M<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">matrix</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">,</span> m<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">(</span><span class="staexp">m</span><span class="keyword">)</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">,</span> sep1<span class="keyword">:</span> <span class="staexp">NSH</span><span class="keyword">(</span><span class="staexp">string</span><span class="keyword">)</span><span class="keyword">,</span> sep2<span class="keyword">:</span> <span class="staexp">NSH</span><span class="keyword">(</span><span class="staexp">string</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span></span> <span class="comment">// end of [fprint_matrix_sep]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
matrix_ptr_takeout_elt
  <span class="staexp"><span class="keyword">{</span>l0<span class="keyword">:</span>addr<span class="keyword">}</span></span>
  <span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="staexp"><span class="keyword">{</span>i<span class="keyword">,</span>j<span class="keyword">:</span>nat <span class="keyword">|</span> i <span class="keyword">&lt;</span> m<span class="keyword">;</span> j <span class="keyword">&lt;</span> n<span class="keyword">}</span></span>
<span class="keyword">(</span>
  <span class="prfexp">pfm<span class="keyword">:</span> <span class="staexp">matrix_v</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">l0</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="keyword">|</span> base<span class="keyword">:</span> <span class="staexp">ptr</span><span class="keyword">(</span><span class="staexp">l0</span><span class="keyword">)</span>
<span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">(</span><span class="staexp">i</span><span class="keyword">)</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> j<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">(</span><span class="staexp">j</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">&gt;</span>
<span class="staexp"><span class="keyword">[</span>l<span class="keyword">:</span>addr<span class="keyword">]</span></span>
<span class="keyword">(</span>
  <span class="staexp">a</span> <span class="staexp"><span class="keyword">@</span></span> <span class="staexp">l</span>
<span class="keyword">,</span> <span class="staexp">a</span> <span class="staexp"><span class="keyword">@</span></span> <span class="staexp">l</span> <span class="keyword">-&lt;</span><span class="staexp">lin</span><span class="keyword">,</span><span class="staexp">prf</span><span class="keyword">&gt;</span> <span class="staexp">matrix_v</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">l0</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">|</span> <span class="staexp">ptr</span> <span class="keyword">(</span><span class="staexp">l</span><span class="keyword">)</span>
<span class="keyword">)</span></span> <span class="comment">(* end of [matrix_ptr_takeout_elt] *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
matrix_ptr_takeout_row
  <span class="staexp"><span class="keyword">{</span>l0<span class="keyword">:</span>addr<span class="keyword">}</span></span>
  <span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="staexp"><span class="keyword">{</span>i<span class="keyword">:</span>int <span class="keyword">|</span> i <span class="keyword">&lt;</span> m<span class="keyword">}</span></span>
<span class="keyword">(</span>
  <span class="prfexp">pfm<span class="keyword">:</span> <span class="staexp">matrix_v</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">l0</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="keyword">|</span> base<span class="keyword">:</span> <span class="staexp">ptr</span><span class="keyword">(</span><span class="staexp">l0</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">(</span><span class="staexp">i</span><span class="keyword">)</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">&gt;</span>
<span class="staexp"><span class="keyword">[</span>l<span class="keyword">:</span>addr<span class="keyword">]</span></span>
<span class="keyword">(</span>
  <span class="staexp">matrow_v</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">,</span> <span class="staexp">matrow_v</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">lin</span><span class="keyword">,</span><span class="staexp">prf</span><span class="keyword">&gt;</span> <span class="staexp">matrix_v</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">l0</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">|</span> <span class="staexp">ptr</span> <span class="keyword">(</span><span class="staexp">l</span><span class="keyword">)</span>
<span class="keyword">)</span></span> <span class="comment">(* end of [matrix_ptr_takeout_row] *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
matrix_ptr_takeout_col
  <span class="staexp"><span class="keyword">{</span>l0<span class="keyword">:</span>addr<span class="keyword">}</span></span>
  <span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="staexp"><span class="keyword">{</span>i<span class="keyword">:</span>int <span class="keyword">|</span> i <span class="keyword">&lt;</span> m<span class="keyword">}</span></span>
<span class="keyword">(</span>
  <span class="prfexp">pfm<span class="keyword">:</span> <span class="staexp">matrix_v</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">l0</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="keyword">|</span> base<span class="keyword">:</span> <span class="staexp">ptr</span> <span class="staexp">l0</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">(</span><span class="staexp">i</span><span class="keyword">)</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">&gt;</span>
<span class="staexp"><span class="keyword">[</span>l<span class="keyword">:</span>addr<span class="keyword">]</span></span>
<span class="keyword">(</span>
  <span class="staexp">matcol_v</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">,</span> <span class="staexp">matcol_v</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">lin</span><span class="keyword">,</span><span class="staexp">prf</span><span class="keyword">&gt;</span> <span class="staexp">matrix_v</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">l0</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">|</span> <span class="staexp">ptr</span> <span class="keyword">(</span><span class="staexp">l</span><span class="keyword">)</span>
<span class="keyword">)</span></span> <span class="comment">(* end of [matrix_ptr_takeout_col] *)</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
matrix_foreach$rowsep<span class="keyword">(</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>env<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> matrix_foreach$fwork
  <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">a</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span><span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="staexp">env</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> matrix_foreach<span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  M<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">matrix</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span><span class="keyword">,</span> <span class="staexp">size_t</span><span class="keyword">(</span><span class="staexp">m</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">size_t</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span></span> <span class="comment">// end of [matrix_foreach]</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>env<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> matrix_foreach_env<span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  M<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">matrix</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span><span class="keyword">,</span> <span class="staexp">size_t</span><span class="keyword">(</span><span class="staexp">m</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">size_t</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="staexp">env</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span></span> <span class="comment">// end of [matrix_foreach_env]</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>env<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> matrix_foreachrow$fwork
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  A<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">array</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="staexp">env</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span></span> <span class="comment">// end of [matrix_foreachrow$fwork]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> matrix_foreachrow<span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  M<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">matrix</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span><span class="keyword">,</span> m<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">(</span><span class="staexp">m</span><span class="keyword">)</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span></span> <span class="comment">// end of [matrix_foreachrow]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>env<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> matrix_foreachrow_env<span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  M<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">matrix</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span><span class="keyword">,</span> m<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">(</span><span class="staexp">m</span><span class="keyword">)</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="staexp">env</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span></span> <span class="comment">// end of [matrix_foreachrow_env]</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
matrix_initize$init
  <span class="keyword">(</span>i<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">,</span> j<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">a</span><span class="staexp">?</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
matrix_initize<span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  M<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">matrix</span><span class="keyword">(</span><span class="staexp">a</span><span class="staexp">?</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">matrix</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> m<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">(</span><span class="staexp">m</span><span class="keyword">)</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span></span> <span class="comment">// end of [matrix_initize]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">macdef</span> matrix_initialize <span class="keyword">=</span> matrix_initize</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
matrix_uninitize$clear
  <span class="keyword">(</span>i<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">,</span> j<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">a</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">a</span><span class="staexp">?</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
matrix_uninitize<span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  M<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">matrix</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">matrix</span><span class="keyword">(</span><span class="staexp">a</span><span class="staexp">?</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> m<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">(</span><span class="staexp">m</span><span class="keyword">)</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span></span> <span class="comment">// end of [matrix_uninitize]</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
<span class="staexp"><span class="keyword">{</span>b<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
matrix_mapto$fwork
  <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">a</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">b</span><span class="staexp">?</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">b</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
<span class="staexp"><span class="keyword">{</span>b<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
matrix_mapto
  <span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  A<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">matrix</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">,</span> B<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">matrix</span><span class="keyword">(</span><span class="staexp">b</span><span class="staexp">?</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">matrix</span><span class="keyword">(</span><span class="staexp">b</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">,</span> m<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="staexp">m</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="staexp">n</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span></span> <span class="comment">// end of [matrix_mapto]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">,</span>b<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
<span class="staexp"><span class="keyword">{</span>c<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
matrix_map2to$fwork
  <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">a</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">b</span><span class="keyword">,</span> z<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">c</span><span class="staexp">?</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">c</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">,</span>b<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
<span class="staexp"><span class="keyword">{</span>c<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
matrix_map2to
  <span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  A<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">matrix</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">,</span> B<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">matrix</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">b</span><span class="keyword">)</span><span class="keyword">,</span>  <span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">,</span> C<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">matrix</span><span class="keyword">(</span><span class="staexp">c</span><span class="staexp">?</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">matrix</span><span class="keyword">(</span><span class="staexp">c</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">,</span> m<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="staexp">m</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="staexp">n</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span></span> <span class="comment">// end of [matrix_map2to]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* end of [matrix.sats] *)</span>
</pre>
<pre class="patsyntax">
<span class="comment">(***********************************************************************)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(*                         Applied Type System                         *)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(***********************************************************************)</span>

<span class="comment">(*
** ATS/Postiats - Unleashing the Potential of Types!
** Copyright (C) 2010-2015 Hongwei Xi, ATS Trustful Software, Inc.
** All rights reserved
**
** ATS is free software;  you can  redistribute it and/or modify it under
** the terms of  the GNU GENERAL PUBLIC LICENSE (GPL) as published by the
** Free Software Foundation; either version 3, or (at  your  option)  any
** later version.
**
** ATS is distributed in the hope that it will be useful, but WITHOUT ANY
** WARRANTY; without  even  the  implied  warranty  of MERCHANTABILITY or
** FITNESS FOR A PARTICULAR PURPOSE.  See the  GNU General Public License
** for more details.
**
** You  should  have  received  a  copy of the GNU General Public License
** along  with  ATS;  see the  file COPYING.  If not, please write to the
** Free Software Foundation,  51 Franklin Street, Fifth Floor, Boston, MA
** 02110-1301, USA.
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
** Source:
** $PATSHOME/prelude/SATS/CODEGEN/matrixptr.atxt
** Time of generation: Mon Sep  5 21:48:37 2016
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* Author: Hongwei Xi *)</span>
<span class="comment">(* Authoremail: hwxi AT cs DOT bu DOT edu *)</span>
<span class="comment">(* Start time: February, 2012 *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">typedef</span> <span class="staexp">SHR<span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span>type</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">a</span></span> <span class="comment">// for commenting purpose</span>
<span class="keyword">typedef</span> <span class="staexp">NSH<span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span>type</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">a</span></span> <span class="comment">// for commenting purpose</span>

<span class="comment">(* ****** ****** *)</span>

<span class="staexp"><span class="keyword">sortdef</span> t0p <span class="keyword">=</span> <span class="keyword">t@ype</span> <span class="keyword">and</span> vt0p <span class="keyword">=</span> <span class="keyword">viewt@ype</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="staexp"><span class="keyword">absvtype</span>
matrixptr_vt0ype_addr_int_int_vtype
  <span class="keyword">(</span>a<span class="keyword">:</span><span class="keyword">vt@ype+</span><span class="keyword">,</span> l<span class="keyword">:</span> addr<span class="keyword">,</span> m<span class="keyword">:</span> int<span class="keyword">,</span> n<span class="keyword">:</span> int<span class="keyword">)</span> <span class="keyword">=</span> ptr</span>
<span class="comment">//</span>
<span class="keyword">stadef</span>
<span class="staexp">matrixptr <span class="keyword">=</span> <span class="staexp">matrixptr_vt0ype_addr_int_int_vtype</span></span>
<span class="keyword">vtypedef</span>
<span class="staexp">matrixptr
  <span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span><span class="keyword">vt@ype</span></span><span class="keyword">,</span> <span class="staexp">m<span class="keyword">:</span> int</span><span class="keyword">,</span> <span class="staexp">n<span class="keyword">:</span> int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp"><span class="keyword">[</span>l<span class="keyword">:</span>addr<span class="keyword">]</span></span> <span class="staexp">matrixptr</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="staexp"><span class="keyword">absvtype</span>
matrixptrout_vt0ype_addr_int_int_vtype
  <span class="keyword">(</span>a<span class="keyword">:</span><span class="keyword">vt@ype</span><span class="keyword">,</span> l<span class="keyword">:</span> addr<span class="keyword">,</span> m<span class="keyword">:</span> int<span class="keyword">,</span> n<span class="keyword">:</span> int<span class="keyword">)</span> <span class="keyword">=</span> ptr</span>
<span class="comment">//</span>
<span class="keyword">stadef</span>
<span class="staexp">matrixptrout <span class="keyword">=</span> <span class="staexp">matrixptrout_vt0ype_addr_int_int_vtype</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="prfexp"><span class="keyword">praxi</span>
lemma_matrixptr_param<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
  <span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span> <span class="keyword">(</span>A<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">matrixptr</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><span class="keyword">[</span>m &gt;= 0<span class="keyword">;</span> n &gt;= 0<span class="keyword">]</span></span> <span class="staexp">void</span></span>
<span class="comment">// end of [lemma_matrixptr_param]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">castfn</span>
matrixptr_encode <span class="keyword">:</span>
  <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span><span class="staexp">matrix_v</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">mfree_gc_v</span><span class="keyword">(</span><span class="staexp">l</span><span class="keyword">)</span> <span class="keyword">|</span> <span class="staexp">ptr</span> <span class="staexp">l</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">0</span><span class="keyword">&gt;</span> <span class="staexp">matrixptr</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="comment">// end of [matrixptr_encode]</span>

<span class="dynexp"><span class="keyword">castfn</span>
matrixptr_encode2 <span class="keyword">:</span>
  <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">@(</span><span class="staexp">matrix_v</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">mfree_gc_v</span><span class="keyword">(</span><span class="staexp">l</span><span class="keyword">)</span> <span class="keyword">|</span> <span class="staexp">ptr</span> <span class="staexp">l</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">0</span><span class="keyword">&gt;</span> <span class="staexp">matrixptr</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="comment">// end of [matrixptr_encode2]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">castfn</span>
matrixptr2ptr
  <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
  <span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>A<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">matrixptr</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">ptr</span><span class="keyword">(</span><span class="staexp">l</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">castfn</span>
matrixptrout2ptr
  <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
  <span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>A<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">matrixptrout</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">ptr</span><span class="keyword">(</span><span class="staexp">l</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="prfexp"><span class="keyword">praxi</span>
matrixptr_takeout
  <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  <span class="staexp"><span class="keyword">!</span></span><span class="staexp">matrixptr</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">matrixptrout</span><span class="keyword">(</span><span class="staexp">a</span><span class="staexp">?</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">matrix_v</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span> <span class="comment">// endfun</span>
<span class="prfexp"><span class="keyword">praxi</span>
matrixptr_addback
  <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  <span class="prfexp">pf<span class="keyword">:</span> <span class="staexp">matrix_v</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="keyword">|</span> mat<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">matrixptrout</span><span class="keyword">(</span><span class="staexp">a</span><span class="staexp">?</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">matrixptr</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span></span> <span class="comment">// end of [matrixptr_addback]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
<span class="keyword">}</span></span> arrayptr2matrixptr_int
  <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">:</span>nat<span class="keyword">}</span></span>
  <span class="keyword">(</span>A<span class="keyword">:</span> <span class="staexp">arrayptr</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">m</span><span class="staexp">*</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> m<span class="keyword">:</span> <span class="staexp">int</span> <span class="staexp">m</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">int</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">matrixptr</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
<span class="keyword">}</span></span> arrayptr2matrixptr_size
  <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>A<span class="keyword">:</span> <span class="staexp">arrayptr</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">m</span><span class="staexp">*</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> m<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="staexp">m</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">matrixptr</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="neuexp"><span class="keyword">symintr</span> arrayptr2matrixptr</span>
<span class="dynexp"><span class="keyword">overload</span> arrayptr2matrixptr <span class="keyword">with</span> arrayptr2matrixptr_int</span>
<span class="dynexp"><span class="keyword">overload</span> arrayptr2matrixptr <span class="keyword">with</span> arrayptr2matrixptr_size</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>t0p
<span class="keyword">}</span></span> matrixptr_make_elt
  <span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>m<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="staexp">m</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="staexp">n</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">matrixptr</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="comment">// end of [matrixptr_make_elt]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
matrixptr_get_at_int
  <span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  A<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">matrixptr</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">natLt</span> <span class="keyword">(</span><span class="staexp">m</span><span class="keyword">)</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">int</span> <span class="staexp">n</span><span class="keyword">,</span> j<span class="keyword">:</span> <span class="staexp">natLt</span> <span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span> <span class="comment">// end of [matrixptr_get_at_int]</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
matrixptr_get_at_size
  <span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  A<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">matrixptr</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">sizeLt</span> <span class="keyword">(</span><span class="staexp">m</span><span class="keyword">)</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="staexp">n</span><span class="keyword">,</span> j<span class="keyword">:</span> <span class="staexp">sizeLt</span> <span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span> <span class="comment">// end of [matrixptr_get_at_size]</span>
<span class="comment">//</span>
<span class="neuexp"><span class="keyword">symintr</span> matrixptr_get_at</span>
<span class="dynexp"><span class="keyword">overload</span> matrixptr_get_at <span class="keyword">with</span> matrixptr_get_at_int <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> matrixptr_get_at <span class="keyword">with</span> matrixptr_get_at_size <span class="keyword">of</span> 0</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
matrixptr_set_at_int
  <span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  A<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">matrixptr</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">natLt</span> <span class="keyword">(</span><span class="staexp">m</span><span class="keyword">)</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">int</span> <span class="staexp">n</span><span class="keyword">,</span> j<span class="keyword">:</span> <span class="staexp">natLt</span> <span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="staexp">a</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span> <span class="comment">// end of [matrixptr_set_at_int]</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
matrixptr_set_at_size
  <span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  A<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">matrixptr</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">sizeLt</span> <span class="keyword">(</span><span class="staexp">m</span><span class="keyword">)</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="staexp">n</span><span class="keyword">,</span> j<span class="keyword">:</span> <span class="staexp">sizeLt</span> <span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="staexp">a</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span> <span class="comment">// end of [matrixptr_set_at_size]</span>
<span class="comment">//</span>
<span class="neuexp"><span class="keyword">symintr</span> matrixptr_set_at</span>
<span class="dynexp"><span class="keyword">overload</span> matrixptr_set_at <span class="keyword">with</span> matrixptr_set_at_int <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> matrixptr_set_at <span class="keyword">with</span> matrixptr_set_at_size <span class="keyword">of</span> 0</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
matrixptr_exch_at_int
  <span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  A<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">matrixptr</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">natLt</span> <span class="keyword">(</span><span class="staexp">m</span><span class="keyword">)</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">int</span> <span class="staexp">n</span><span class="keyword">,</span> j<span class="keyword">:</span> <span class="staexp">natLt</span> <span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">a</span><span class="staexp">&gt;&gt;</span><span class="staexp">a</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span> <span class="comment">// end of [matrixptr_exch_at_int]</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
matrixptr_exch_at_size
  <span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  A<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">matrixptr</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">sizeLt</span> <span class="keyword">(</span><span class="staexp">m</span><span class="keyword">)</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="staexp">n</span><span class="keyword">,</span> j<span class="keyword">:</span> <span class="staexp">sizeLt</span> <span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">a</span><span class="staexp">&gt;&gt;</span><span class="staexp">a</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span> <span class="comment">// end of [matrixptr_exch_at_size]</span>
<span class="comment">//</span>
<span class="neuexp"><span class="keyword">symintr</span> matrixptr_exch_at</span>
<span class="dynexp"><span class="keyword">overload</span> matrixptr_exch_at <span class="keyword">with</span> matrixptr_exch_at_int</span>
<span class="dynexp"><span class="keyword">overload</span> matrixptr_exch_at <span class="keyword">with</span> matrixptr_exch_at_size</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span> matrixptr_free
  <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>A<span class="keyword">:</span> <span class="staexp">matrixptr</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span> <span class="keyword">=</span> "mac#%"</span>
<span class="comment">// end of [matrixptr_free]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
fprint_matrix$sep1 // col separation
fprint_matrix$sep2 // row separation
*)</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
fprint_matrixptr<span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  out<span class="keyword">:</span> <span class="staexp">FILEref</span>
<span class="keyword">,</span> M<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">matrixptr</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> m<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="staexp">m</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="staexp">n</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span></span> <span class="comment">// end of [fprint_matrixptr]</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
fprint_matrixptr_sep<span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  out<span class="keyword">:</span> <span class="staexp">FILEref</span>
<span class="keyword">,</span> M<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">matrixptr</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> m<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="keyword">(</span><span class="staexp">m</span><span class="keyword">)</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">,</span> sep1<span class="keyword">:</span> <span class="staexp">NSH</span><span class="keyword">(</span><span class="staexp">string</span><span class="keyword">)</span><span class="keyword">,</span> sep2<span class="keyword">:</span> <span class="staexp">NSH</span><span class="keyword">(</span><span class="staexp">string</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span></span> <span class="comment">// end of [fprint_matrixptr_sep]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">(*
fun{a:vt0p}
matrix_initize$init (i: size_t, x: &amp;a &gt;&gt; a?): void
*)</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
matrixptr_initize
  <span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  M<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">matrixptr</span><span class="keyword">(</span><span class="staexp">a</span><span class="staexp">?</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">matrixptr</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> m<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">(</span><span class="staexp">m</span><span class="keyword">)</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span></span> <span class="comment">// end of [matrixptr_initize]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">macdef</span>
matrixptr_initialize <span class="keyword">=</span> matrixptr_initize</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">(*
fun{a:vt0p}
matrix_uninitize$clear
  (i: size_t, j: size_t, x: &amp;a &gt;&gt; a?): void
*)</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
matrixptr_uninitize
  <span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  M<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">matrixptr</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">matrixptr</span><span class="keyword">(</span><span class="staexp">a</span><span class="staexp">?</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> m<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">(</span><span class="staexp">m</span><span class="keyword">)</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span></span> <span class="comment">// end of [matrixptr_uninitize]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">macdef</span>
matrixptr_uninitialize <span class="keyword">=</span> matrixptr_uninitize</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">(*
fun{a:vt0p}
matrix_uninitize$clear
  (i: size_t, j: size_t, x: &amp;a &gt;&gt; a?): void
*)</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> matrixptr_freelin
  <span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  A<span class="keyword">:</span> <span class="staexp">matrixptr</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> m<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">(</span><span class="staexp">m</span><span class="keyword">)</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> "mac#%"</span> <span class="comment">// end-of-function</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">(*
fun{a:vt0p}
matrix_tabulate$fopr (i: size_t, j: size_t): (a)
*)</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
matrixptr_tabulate
  <span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span> <span class="keyword">(</span>nrow<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="staexp">m</span><span class="keyword">,</span> ncol<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">matrixptr</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
matrixptr_tabulate_cloref
  <span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  nrow<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="staexp">m</span><span class="keyword">,</span> ncol<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="staexp">n</span><span class="keyword">,</span> f<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">sizeLt</span><span class="keyword">(</span><span class="staexp">m</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">sizeLt</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloref</span><span class="keyword">&gt;</span> <span class="staexp">a</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">matrixptr</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span> <span class="comment">// end-of-function</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
fun{
a:vt0p}{env:vt0p
} matrix_foreach$fwork (x: &amp;a &gt;&gt; _, env: &amp;(env) &gt;&gt; _): void
*)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> matrixptr_foreach<span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  A<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">matrixptr</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span><span class="keyword">,</span> m<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="staexp">m</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="staexp">n</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span></span> <span class="comment">// end of [matrixptr_foreach]</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>env<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> matrixptr_foreach_env<span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  A<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">matrixptr</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span><span class="keyword">,</span> m<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="staexp">m</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="staexp">n</span><span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="staexp">env</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span></span> <span class="comment">// end of [matrixptr_foreach_env]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">// overloading for certain symbols</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">[</span><span class="keyword">]</span> <span class="keyword">with</span> matrixptr_get_at_int</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">[</span><span class="keyword">]</span> <span class="keyword">with</span> matrixptr_get_at_size</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">[</span><span class="keyword">]</span> <span class="keyword">with</span> matrixptr_set_at_int</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">[</span><span class="keyword">]</span> <span class="keyword">with</span> matrixptr_set_at_size</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">overload</span> fprint <span class="keyword">with</span> fprint_matrixptr</span>
<span class="dynexp"><span class="keyword">overload</span> fprint <span class="keyword">with</span> fprint_matrixptr_sep</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">overload</span> ptrcast <span class="keyword">with</span> matrixptr2ptr</span>
<span class="dynexp"><span class="keyword">overload</span> ptrcast <span class="keyword">with</span> matrixptrout2ptr</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* end of [matrixptr.sats] *)</span>
</pre>
<pre class="patsyntax">
<span class="comment">(***********************************************************************)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(*                         Applied Type System                         *)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(***********************************************************************)</span>

<span class="comment">(*
** ATS/Postiats - Unleashing the Potential of Types!
** Copyright (C) 2010-2015 Hongwei Xi, ATS Trustful Software, Inc.
** All rights reserved
**
** ATS is free software;  you can  redistribute it and/or modify it under
** the terms of  the GNU GENERAL PUBLIC LICENSE (GPL) as published by the
** Free Software Foundation; either version 3, or (at  your  option)  any
** later version.
**
** ATS is distributed in the hope that it will be useful, but WITHOUT ANY
** WARRANTY; without  even  the  implied  warranty  of MERCHANTABILITY or
** FITNESS FOR A PARTICULAR PURPOSE.  See the  GNU General Public License
** for more details.
**
** You  should  have  received  a  copy of the GNU General Public License
** along  with  ATS;  see the  file COPYING.  If not, please write to the
** Free Software Foundation,  51 Franklin Street, Fifth Floor, Boston, MA
** 02110-1301, USA.
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
** Source:
** $PATSHOME/prelude/SATS/CODEGEN/matrixref.atxt
** Time of generation: Mon Sep  5 21:48:37 2016
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* Author: Hongwei Xi *)</span>
<span class="comment">(* Authoremail: hwxi AT cs DOT bu DOT edu *)</span>
<span class="comment">(* Start time: April, 2013 *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="neuexp"><span class="keyword">#define</span> NSH <span class="keyword">(</span>x<span class="keyword">)</span> x</span> <span class="comment">// for commenting: no sharing</span>
<span class="neuexp"><span class="keyword">#define</span> SHR <span class="keyword">(</span>x<span class="keyword">)</span> x</span> <span class="comment">// for commenting: it is shared</span>

<span class="comment">(* ****** ****** *)</span>

<span class="staexp"><span class="keyword">sortdef</span> tk <span class="keyword">=</span> tkind</span>

<span class="comment">(* ****** ****** *)</span>

<span class="staexp"><span class="keyword">sortdef</span> t0p <span class="keyword">=</span> <span class="keyword">t@ype</span> <span class="keyword">and</span> vt0p <span class="keyword">=</span> <span class="keyword">viewt@ype</span></span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">// matrixref:</span>
<span class="comment">// reference to a matrix</span>
<span class="comment">// with no dimension info attached</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">abstype</span>
matrixref_vt0ype_int_int_type
  <span class="keyword">(</span>a<span class="keyword">:</span><span class="keyword">vt@ype</span><span class="comment">(*inv*)</span><span class="keyword">,</span> nrow<span class="keyword">:</span> int<span class="keyword">,</span> ncol<span class="keyword">:</span>int<span class="keyword">)</span> <span class="keyword">=</span> ptr</span>
<span class="comment">//</span>
<span class="keyword">stadef</span> <span class="staexp">matrixref <span class="keyword">=</span> <span class="staexp">matrixref_vt0ype_int_int_type</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="prfexp"><span class="keyword">praxi</span>
lemma_matrixref_param
  <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>M<span class="keyword">:</span> <span class="staexp">matrixref</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><span class="keyword">[</span>m &gt;= 0<span class="keyword">;</span> n &gt;= 0<span class="keyword">]</span></span> <span class="staexp">void</span></span>
<span class="comment">// end of [lemma_matrixref_param]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">castfn</span>
matrixref2ptr
  <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span> <span class="keyword">(</span>M<span class="keyword">:</span> <span class="staexp">matrixref</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">Ptr0</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">castfn</span>
matrixptr_refize
  <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span><span class="staexp">matrixptr</span> <span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">matrixref</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">castfn</span>
matrixref_get_viewptr
  <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
  <span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  M<span class="keyword">:</span> <span class="staexp">matrixref</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp"><span class="keyword">[</span>l<span class="keyword">:</span>addr<span class="keyword">]</span></span> <span class="keyword">(</span><span class="staexp">vbox</span> <span class="keyword">(</span><span class="staexp">matrix_v</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">|</span> <span class="staexp">ptr</span> <span class="staexp">l</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">castfn</span>
arrayref2matrixref
  <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">:</span>nat<span class="keyword">}</span></span> <span class="keyword">(</span>A<span class="keyword">:</span> <span class="staexp">arrayref</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">m</span><span class="staexp">*</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">matrixref</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="comment">// end of [arrayref2matrixref]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>t0p
<span class="keyword">}</span></span> matrixref_make_elt
  <span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span>m<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="staexp">m</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="staexp">n</span><span class="keyword">,</span> x0<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">matrixref</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="comment">// end of [matrixref_make_elt]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
matrixref_get_at_int
  <span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  M<span class="keyword">:</span> <span class="staexp">matrixref</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">natLt</span><span class="keyword">(</span><span class="staexp">m</span><span class="keyword">)</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> j<span class="keyword">:</span> <span class="staexp">natLt</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">ref</span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span> <span class="comment">// end of [matrixref_get_at_int]</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
matrixref_get_at_size
  <span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  M<span class="keyword">:</span> <span class="staexp">matrixref</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">sizeLt</span><span class="keyword">(</span><span class="staexp">m</span><span class="keyword">)</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> j<span class="keyword">:</span> <span class="staexp">sizeLt</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">ref</span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span> <span class="comment">// end of [matrixref_get_at_size]</span>
<span class="comment">//</span>
<span class="neuexp"><span class="keyword">symintr</span> matrixref_get_at</span>
<span class="dynexp"><span class="keyword">overload</span> matrixref_get_at <span class="keyword">with</span> matrixref_get_at_int <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> matrixref_get_at <span class="keyword">with</span> matrixref_get_at_size <span class="keyword">of</span> 0</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
matrixref_set_at_int
  <span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  M<span class="keyword">:</span> <span class="staexp">matrixref</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">natLt</span> <span class="keyword">(</span><span class="staexp">m</span><span class="keyword">)</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">int</span> <span class="staexp">n</span><span class="keyword">,</span> j<span class="keyword">:</span> <span class="staexp">natLt</span> <span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="staexp">a</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">refwrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span> <span class="comment">// end of [matrixref_set_at_int]</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
matrixref_set_at_size
  <span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  M<span class="keyword">:</span> <span class="staexp">matrixref</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">sizeLt</span> <span class="keyword">(</span><span class="staexp">m</span><span class="keyword">)</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="staexp">n</span><span class="keyword">,</span> j<span class="keyword">:</span> <span class="staexp">sizeLt</span> <span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="staexp">a</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">refwrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span> <span class="comment">// end of [matrixref_set_at_size]</span>

<span class="neuexp"><span class="keyword">symintr</span> matrixref_set_at</span>
<span class="dynexp"><span class="keyword">overload</span> matrixref_set_at <span class="keyword">with</span> matrixref_set_at_int <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> matrixref_set_at <span class="keyword">with</span> matrixref_set_at_size <span class="keyword">of</span> 0</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
matrixref_exch_at_int
  <span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  M<span class="keyword">:</span> <span class="staexp">matrixref</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">natLt</span> <span class="keyword">(</span><span class="staexp">m</span><span class="keyword">)</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">int</span> <span class="staexp">n</span><span class="keyword">,</span> j<span class="keyword">:</span> <span class="staexp">natLt</span> <span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">a</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">refwrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span> <span class="comment">// end of [matrixref_exch_at_int]</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
matrixref_exch_at_size
  <span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  M<span class="keyword">:</span> <span class="staexp">matrixref</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">sizeLt</span> <span class="keyword">(</span><span class="staexp">m</span><span class="keyword">)</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="staexp">n</span><span class="keyword">,</span> j<span class="keyword">:</span> <span class="staexp">sizeLt</span> <span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">a</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">refwrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span> <span class="comment">// end of [matrixref_exch_at_size]</span>

<span class="neuexp"><span class="keyword">symintr</span> matrixref_exch_at</span>
<span class="dynexp"><span class="keyword">overload</span> matrixref_exch_at <span class="keyword">with</span> matrixref_exch_at_int <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> matrixref_exch_at <span class="keyword">with</span> matrixref_exch_at_size <span class="keyword">of</span> 0</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
fprint_matrix$sep1 // col separation
fprint_matrix$sep2 // row separation
*)</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
fprint_matrixref<span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  out<span class="keyword">:</span> <span class="staexp">FILEref</span>
<span class="keyword">,</span> M<span class="keyword">:</span> <span class="staexp">matrixref</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> m<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="staexp">m</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="staexp">n</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span></span> <span class="comment">// end of [fprint_matrixref]</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
fprint_matrixref_sep<span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  out<span class="keyword">:</span> <span class="staexp">FILEref</span>
<span class="keyword">,</span> M<span class="keyword">:</span> <span class="staexp">matrixref</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> m<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="keyword">(</span><span class="staexp">m</span><span class="keyword">)</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">,</span> sep1<span class="keyword">:</span> <span class="staexp">NSH</span><span class="keyword">(</span><span class="staexp">string</span><span class="keyword">)</span><span class="keyword">,</span> sep2<span class="keyword">:</span> <span class="staexp">NSH</span><span class="keyword">(</span><span class="staexp">string</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span></span> <span class="comment">// end of [fprint_matrixref_sep]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
matrixref_copy
  <span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  M<span class="keyword">:</span> <span class="staexp">matrixref</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> m<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">(</span><span class="staexp">m</span><span class="keyword">)</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">matrixptr</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span> <span class="comment">// end-of-fun</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
fun{a:vt0p}
matrix_tabulate$fopr (i: size_t, j: size_t): (a)
*)</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
matrixref_tabulate
  <span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span> <span class="keyword">(</span>nrow<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="staexp">m</span><span class="keyword">,</span> ncol<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">matrixref</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
matrixref_tabulate_cloref
  <span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  nrow<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="staexp">m</span><span class="keyword">,</span> ncol<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="staexp">n</span><span class="keyword">,</span> f<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">sizeLt</span><span class="keyword">(</span><span class="staexp">m</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">sizeLt</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloref</span><span class="keyword">&gt;</span> <span class="staexp">a</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">matrixref</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span> <span class="comment">// end-of-fun</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
fun{
a:vt0p}{env:vt0p
} matrix_foreach$fwork
  (x: &amp;a &gt;&gt; _, env: &amp;(env) &gt;&gt; _): void
*)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> matrixref_foreach<span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  A<span class="keyword">:</span> <span class="staexp">matrixref</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> m<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="staexp">m</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="staexp">n</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span></span> <span class="comment">// end of [matrixref_foreach]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>env<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> matrixref_foreach_env<span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  A<span class="keyword">:</span> <span class="staexp">matrixref</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> m<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="staexp">m</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="staexp">n</span><span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="staexp">env</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span></span> <span class="comment">// end of [matrixref_foreach_env]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> matrixref_foreach_cloref<span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  A<span class="keyword">:</span> <span class="staexp">matrixref</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> m<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">(</span><span class="staexp">m</span><span class="keyword">)</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> fwork<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">&amp;</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloref1</span><span class="keyword">&gt;</span> <span class="staexp">void</span> 
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span></span> <span class="comment">// end of [mtrxszref_foreach_cloref]</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">// mtrxszref: a reference to a matrix with size information attached</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">abstype</span> <span class="comment">// in-variant</span>
mtrxszref_vt0ype_type<span class="keyword">(</span>a<span class="keyword">:</span><span class="keyword">vt@ype</span><span class="keyword">)</span> <span class="keyword">=</span> ptr</span>
<span class="comment">//</span>
<span class="keyword">stadef</span> <span class="staexp">mtrxszref <span class="keyword">=</span> <span class="staexp">mtrxszref_vt0ype_type</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
mtrxszref_make_matrixref
  <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  M<span class="keyword">:</span> <span class="staexp">matrixref</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> m<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="staexp">m</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="staexp">n</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">mtrxszref</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span> <span class="comment">// endfun</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
mtrxszref_get_ref<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span> <span class="keyword">(</span>M<span class="keyword">:</span> <span class="staexp">mtrxszref</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">Ptr1</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
mtrxszref_get_nrow<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span> <span class="keyword">(</span>M<span class="keyword">:</span> <span class="staexp">mtrxszref</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">size_t</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
mtrxszref_get_ncol<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span> <span class="keyword">(</span>M<span class="keyword">:</span> <span class="staexp">mtrxszref</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">size_t</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="neuexp"><span class="keyword">symintr</span> <span class="keyword">.</span>ref</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">.</span>ref <span class="keyword">with</span> mtrxszref_get_ref</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
mtrxszref_get_refsize<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
<span class="keyword">(</span>
  M<span class="keyword">:</span> <span class="staexp">mtrxszref</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span>
<span class="keyword">,</span> nrol<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">size_t</span><span class="staexp">?</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">size_t</span> <span class="staexp">m</span><span class="keyword">,</span> ncol<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">size_t</span><span class="staexp">?</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">size_t</span> <span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp"><span class="keyword">#[</span>m<span class="keyword">,</span>n<span class="keyword">:</span>nat<span class="keyword">]</span></span> <span class="staexp">matrixref</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span> <span class="comment">// endfun</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
mtrxszref_make_elt
  <span class="keyword">(</span>nrow<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">,</span> ncol<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">,</span> init<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">mtrxszref</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">// end of [mtrxszref_make_elt]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
mtrxszref_get_at_int
  <span class="keyword">(</span>M<span class="keyword">:</span> <span class="staexp">mtrxszref</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> j<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">exnref</span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
mtrxszref_get_at_size
  <span class="keyword">(</span>M<span class="keyword">:</span> <span class="staexp">mtrxszref</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">,</span> j<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">exnref</span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="neuexp"><span class="keyword">symintr</span> mtrxszref_get_at</span>
<span class="dynexp"><span class="keyword">overload</span> mtrxszref_get_at <span class="keyword">with</span> mtrxszref_get_at_int <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> mtrxszref_get_at <span class="keyword">with</span> mtrxszref_get_at_size <span class="keyword">of</span> 0</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
mtrxszref_set_at_int
  <span class="keyword">(</span>M<span class="keyword">:</span> <span class="staexp">mtrxszref</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> j<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">exnrefwrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
mtrxszref_set_at_size
  <span class="keyword">(</span>M<span class="keyword">:</span> <span class="staexp">mtrxszref</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">,</span> j<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">exnrefwrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="neuexp"><span class="keyword">symintr</span> mtrxszref_set_at</span>
<span class="dynexp"><span class="keyword">overload</span> mtrxszref_set_at <span class="keyword">with</span> mtrxszref_set_at_int <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> mtrxszref_set_at <span class="keyword">with</span> mtrxszref_set_at_size <span class="keyword">of</span> 0</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
fprint_matrix$sep1 // col separation
fprint_matrix$sep2 // row separation
*)</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
fprint_mtrxszref
<span class="keyword">(</span>
  out<span class="keyword">:</span> <span class="staexp">FILEref</span><span class="keyword">,</span> M<span class="keyword">:</span> <span class="staexp">mtrxszref</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span></span> <span class="comment">// end of [fprint_mtrxszref]</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
fprint_mtrxszref_sep
<span class="keyword">(</span>
  out<span class="keyword">:</span> <span class="staexp">FILEref</span>
<span class="keyword">,</span> M<span class="keyword">:</span> <span class="staexp">mtrxszref</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> sep1<span class="keyword">:</span> <span class="staexp">NSH</span><span class="keyword">(</span><span class="staexp">string</span><span class="keyword">)</span><span class="keyword">,</span> sep2<span class="keyword">:</span> <span class="staexp">NSH</span><span class="keyword">(</span><span class="staexp">string</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span></span> <span class="comment">// end of [fprint_mtrxszref_sep]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">(*
fun{
a:vt0p}{env:vt0p
} matrix_foreach$fwork
  (x: &amp;a &gt;&gt; _, env: &amp;(env) &gt;&gt; _): void
*)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> mtrxszref_foreach<span class="keyword">(</span><span class="staexp">mtrxszref</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>env<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> mtrxszref_foreach_env<span class="keyword">(</span><span class="staexp">mtrxszref</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="staexp">env</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span><span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>
a<span class="keyword">:</span>vt0p
<span class="keyword">}</span></span> mtrxszref_foreach_cloref
  <span class="keyword">(</span>A<span class="keyword">:</span> <span class="staexp">mtrxszref</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> fwork<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">&amp;</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloref1</span><span class="keyword">&gt;</span> <span class="staexp">void</span> <span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">(*
fun{a:vt0p}
matrix_tabulate$fopr (i: size_t, j: size_t): (a)
*)</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
mtrxszref_tabulate <span class="keyword">(</span>nrow<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">,</span> ncol<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">mtrxszref</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
mtrxszref_tabulate_cloref
  <span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  nrow<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="staexp">m</span><span class="keyword">,</span> ncol<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="staexp">n</span><span class="keyword">,</span> f<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">sizeLt</span><span class="keyword">(</span><span class="staexp">m</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">sizeLt</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloref</span><span class="keyword">&gt;</span> <span class="staexp">a</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">mtrxszref</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span> <span class="comment">// end-of-fun</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">// overloading for certain symbols</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">[</span><span class="keyword">]</span> <span class="keyword">with</span> matrixref_get_at_int <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">[</span><span class="keyword">]</span> <span class="keyword">with</span> matrixref_get_at_size <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">[</span><span class="keyword">]</span> <span class="keyword">with</span> matrixref_set_at_int <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">[</span><span class="keyword">]</span> <span class="keyword">with</span> matrixref_set_at_size <span class="keyword">of</span> 0</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">[</span><span class="keyword">]</span> <span class="keyword">with</span> mtrxszref_get_at_int <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">[</span><span class="keyword">]</span> <span class="keyword">with</span> mtrxszref_get_at_size <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">[</span><span class="keyword">]</span> <span class="keyword">with</span> mtrxszref_set_at_int <span class="keyword">of</span> 0</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">[</span><span class="keyword">]</span> <span class="keyword">with</span> mtrxszref_set_at_size <span class="keyword">of</span> 0</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">.</span>nrow <span class="keyword">with</span> mtrxszref_get_nrow</span>
<span class="dynexp"><span class="keyword">overload</span> <span class="keyword">.</span>ncol <span class="keyword">with</span> mtrxszref_get_ncol</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">overload</span> fprint <span class="keyword">with</span> fprint_matrixref</span>
<span class="dynexp"><span class="keyword">overload</span> fprint <span class="keyword">with</span> fprint_matrixref_sep</span>
<span class="dynexp"><span class="keyword">overload</span> fprint <span class="keyword">with</span> fprint_mtrxszref</span>
<span class="dynexp"><span class="keyword">overload</span> fprint <span class="keyword">with</span> fprint_mtrxszref_sep</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">overload</span> ptrcast <span class="keyword">with</span> matrixref2ptr</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* end of [matrixref.sats] *)</span>
</pre>
<pre class="patsyntax">
<span class="comment">(***********************************************************************)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(*                         Applied Type System                         *)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(***********************************************************************)</span>

<span class="comment">(*
** ATS/Postiats - Unleashing the Potential of Types!
** Copyright (C) 2010-2015 Hongwei Xi, ATS Trustful Software, Inc.
** All rights reserved
**
** ATS is free software;  you can  redistribute it and/or modify it under
** the terms of  the GNU GENERAL PUBLIC LICENSE (GPL) as published by the
** Free Software Foundation; either version 3, or (at  your  option)  any
** later version.
**
** ATS is distributed in the hope that it will be useful, but WITHOUT ANY
** WARRANTY; without  even  the  implied  warranty  of MERCHANTABILITY or
** FITNESS FOR A PARTICULAR PURPOSE.  See the  GNU General Public License
** for more details.
**
** You  should  have  received  a  copy of the GNU General Public License
** along  with  ATS;  see the  file COPYING.  If not, please write to the
** Free Software Foundation,  51 Franklin Street, Fifth Floor, Boston, MA
** 02110-1301, USA.
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
** Source:
** $PATSHOME/prelude/SATS/CODEGEN/gprint.atxt
** Time of generation: Mon Sep  5 21:48:37 2016
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* Author: Hongwei Xi *)</span>
<span class="comment">(* Authoremail: hwxi AT cs DOT bu DOT edu *)</span>
<span class="comment">(* Start time: August, 2012 *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="neuexp"><span class="keyword">#define</span> NSH <span class="keyword">(</span>x<span class="keyword">)</span> x</span> <span class="comment">// for commenting: no sharing</span>
<span class="neuexp"><span class="keyword">#define</span> SHR <span class="keyword">(</span>x<span class="keyword">)</span> x</span> <span class="comment">// for commenting: it is shared</span>

<span class="comment">(* ****** ****** *)</span>

<span class="staexp"><span class="keyword">sortdef</span> t0p <span class="keyword">=</span> <span class="keyword">t@ype</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
gprint$out<span class="keyword">(</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">FILEref</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
gprint_newline<span class="keyword">(</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
gprint_val <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
gprint_ref <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
gprint_int <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
gprint_bool <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">bool</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
gprint_char <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">char</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
gprint_float <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">float</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
gprint_double <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">double</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
gprint_string <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">string</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> gprint <span class="keyword">with</span> gprint_int</span>
<span class="dynexp"><span class="keyword">overload</span> gprint <span class="keyword">with</span> gprint_bool</span>
<span class="dynexp"><span class="keyword">overload</span> gprint <span class="keyword">with</span> gprint_char</span>
<span class="dynexp"><span class="keyword">overload</span> gprint <span class="keyword">with</span> gprint_float</span>
<span class="dynexp"><span class="keyword">overload</span> gprint <span class="keyword">with</span> gprint_double</span>
<span class="dynexp"><span class="keyword">overload</span> gprint <span class="keyword">with</span> gprint_string</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span> gprint_list$beg<span class="keyword">(</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span> gprint_list$end<span class="keyword">(</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span> gprint_list$sep<span class="keyword">(</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
gprint_list <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">List</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> gprint <span class="keyword">with</span> gprint_list</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span> gprint_listlist$beg1<span class="keyword">(</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span> gprint_listlist$end1<span class="keyword">(</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span> gprint_listlist$sep1<span class="keyword">(</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span> gprint_listlist$beg2<span class="keyword">(</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span> gprint_listlist$end2<span class="keyword">(</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span> gprint_listlist$sep2<span class="keyword">(</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
gprint_listlist <span class="keyword">(</span>xss<span class="keyword">:</span> <span class="staexp">List</span><span class="keyword">(</span><span class="staexp">List</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span> gprint_array$beg<span class="keyword">(</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span> gprint_array$end<span class="keyword">(</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span> gprint_array$sep<span class="keyword">(</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
gprint_array
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  <span class="staexp">&amp;</span><span class="keyword">(</span><span class="keyword">@[</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">]</span><span class="keyword">[</span><span class="staexp">n</span><span class="keyword">]</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">size_t</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span></span> <span class="comment">// end-of-function</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
gprint_arrayptr
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  <span class="staexp"><span class="keyword">!</span></span><span class="staexp">arrayptr</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">size_t</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span></span> <span class="comment">// end-of-function</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
gprint_arrayref
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span><span class="staexp">arrayref</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">size_t</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="comment">// end of [gprint_arrayref]</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
gprint_arrszref<span class="keyword">(</span>ASZ<span class="keyword">:</span> <span class="staexp">arrszref</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">overload</span> gprint <span class="keyword">with</span> gprint_arrayref</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* end of [gprint.sats] *)</span>
</pre>
<pre class="patsyntax">
<span class="comment">(***********************************************************************)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(*                         Applied Type System                         *)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(***********************************************************************)</span>

<span class="comment">(*
** ATS/Postiats - Unleashing the Potential of Types!
** Copyright (C) 2010-2015 Hongwei Xi, ATS Trustful Software, Inc.
** All rights reserved
**
** ATS is free software;  you can  redistribute it and/or modify it under
** the terms of  the GNU GENERAL PUBLIC LICENSE (GPL) as published by the
** Free Software Foundation; either version 3, or (at  your  option)  any
** later version.
**
** ATS is distributed in the hope that it will be useful, but WITHOUT ANY
** WARRANTY; without  even  the  implied  warranty  of MERCHANTABILITY or
** FITNESS FOR A PARTICULAR PURPOSE.  See the  GNU General Public License
** for more details.
**
** You  should  have  received  a  copy of the GNU General Public License
** along  with  ATS;  see the  file COPYING.  If not, please write to the
** Free Software Foundation,  51 Franklin Street, Fifth Floor, Boston, MA
** 02110-1301, USA.
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
** Source:
** $PATSHOME/prelude/SATS/CODEGEN/tostring.atxt
** Time of generation: Tue Oct 25 00:23:04 2016
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* Author: Hongwei Xi *)</span>
<span class="comment">(* Authoremail: hwxi AT cs DOT bu DOT edu *)</span>
<span class="comment">(* Start time: August, 2012 *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">vtypedef</span>
<span class="staexp">RD<span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span>vt0p</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">a</span></span> <span class="comment">// for commenting: read-only</span>
<span class="neuexp"><span class="keyword">#define</span> NSH <span class="keyword">(</span>x<span class="keyword">)</span> x</span> <span class="comment">// for commenting: no sharing</span>
<span class="neuexp"><span class="keyword">#define</span> SHR <span class="keyword">(</span>x<span class="keyword">)</span> x</span> <span class="comment">// for commenting: it is shared</span>

<span class="comment">(* ****** ****** *)</span>

<span class="staexp"><span class="keyword">sortdef</span> t0p <span class="keyword">=</span> <span class="keyword">t@ype</span></span>
<span class="staexp"><span class="keyword">sortdef</span> vt0p <span class="keyword">=</span> <span class="keyword">vt@ype</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
tostring_int<span class="keyword">(</span><span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">string</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
tostrptr_int<span class="keyword">(</span><span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">Strptr1</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
tostring_uint<span class="keyword">(</span><span class="staexp">uint</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">string</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
tostrptr_uint<span class="keyword">(</span><span class="staexp">uint</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">Strptr1</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
tostring_bool<span class="keyword">(</span><span class="staexp">bool</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">string</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
tostrptr_bool<span class="keyword">(</span><span class="staexp">bool</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">Strptr1</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
tostring_char<span class="keyword">(</span><span class="staexp">char</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">string</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
tostrptr_char<span class="keyword">(</span><span class="staexp">char</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">Strptr1</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
tostring_double<span class="keyword">(</span><span class="staexp">double</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">string</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
tostrptr_double<span class="keyword">(</span><span class="staexp">double</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">Strptr1</span></span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
tostrptr_list
  <span class="keyword">(</span>xs0<span class="keyword">:</span> <span class="staexp">List</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">Strptr1</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
tostrptr_list$beg<span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">String</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
tostrptr_list$end<span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">String</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
tostrptr_list$sep<span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">String</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
tostrptr_array
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  <span class="staexp">&amp;</span><span class="staexp">array</span><span class="keyword">(</span><span class="staexp">INV</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">size_t</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">Strptr1</span></span> <span class="comment">// end-of-function</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
tostrptr_array$beg<span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">String</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
tostrptr_array$end<span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">String</span></span>
<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span><span class="keyword">}</span></span>
tostrptr_array$sep<span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">String</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
tostrptr_arrayref
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="keyword">(</span><span class="staexp">arrayref</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">size_t</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">Strptr1</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>vt0p<span class="keyword">}</span></span>
tostrptr_arrszref<span class="keyword">(</span><span class="staexp">arrszref</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">Strptr1</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* end of [tostring.sats] *)</span>
</pre>
<pre class="patsyntax">
<span class="comment">(***********************************************************************)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(*                         Applied Type System                         *)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(***********************************************************************)</span>

<span class="comment">(*
** ATS/Postiats - Unleashing the Potential of Types!
** Copyright (C) 2010-2015 Hongwei Xi, ATS Trustful Software, Inc.
** All rights reserved
**
** ATS is free software;  you can  redistribute it and/or modify it under
** the terms of  the GNU GENERAL PUBLIC LICENSE (GPL) as published by the
** Free Software Foundation; either version 3, or (at  your  option)  any
** later version.
**
** ATS is distributed in the hope that it will be useful, but WITHOUT ANY
** WARRANTY; without  even  the  implied  warranty  of MERCHANTABILITY or
** FITNESS FOR A PARTICULAR PURPOSE.  See the  GNU General Public License
** for more details.
**
** You  should  have  received  a  copy of the GNU General Public License
** along  with  ATS;  see the  file COPYING.  If not, please write to the
** Free Software Foundation,  51 Franklin Street, Fifth Floor, Boston, MA
** 02110-1301, USA.
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
** Source:
** $PATSHOME/prelude/DATS/CODEGEN/basics.atxt
** Time of generation: Sun Oct  2 10:33:57 2016
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* Author: Hongwei Xi *)</span>
<span class="comment">(* Authoremail: hwxi AT cs DOT bu DOT edu *)</span>
<span class="comment">(* Start time: March, 2012 *)</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="keyword">staload</span>
UN <span class="keyword">=</span> "prelude/SATS/unsafe.sats"
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">primplmnt</span>
false_elim<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">case+</span> <span class="dynexp">0</span> <span class="keyword">of</span> _ <span class="keyword">=/=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="prfexp"><span class="keyword">primplmnt</span> prop_verify <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">)</span></span>
<span class="prfexp"><span class="keyword">primplmnt</span> prop_verify_and_add <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">)</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="prfexp"><span class="keyword">primplmnt</span> pridentity_v <span class="keyword">(</span>x<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">)</span></span>
<span class="prfexp"><span class="keyword">primplmnt</span> pridentity_vt <span class="keyword">(</span>x<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">)</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="prfexp"><span class="keyword">primplmnt</span> eqint_make <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> EQINT <span class="keyword">(</span><span class="keyword">)</span></span>
<span class="prfexp"><span class="keyword">primplmnt</span> eqint_make_gint <span class="keyword">(</span>x<span class="keyword">)</span> <span class="keyword">=</span> EQINT <span class="keyword">(</span><span class="keyword">)</span></span>
<span class="prfexp"><span class="keyword">primplmnt</span> eqint_make_guint <span class="keyword">(</span>x<span class="keyword">)</span> <span class="keyword">=</span> EQINT <span class="keyword">(</span><span class="keyword">)</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="prfexp"><span class="keyword">primplmnt</span> eqaddr_make <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> EQADDR <span class="keyword">(</span><span class="keyword">)</span></span>
<span class="prfexp"><span class="keyword">primplmnt</span> eqaddr_make_ptr <span class="keyword">(</span>x<span class="keyword">)</span> <span class="keyword">=</span> EQADDR <span class="keyword">(</span><span class="keyword">)</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="prfexp"><span class="keyword">primplmnt</span> eqbool_make <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> EQBOOL <span class="keyword">(</span><span class="keyword">)</span></span>
<span class="prfexp"><span class="keyword">primplmnt</span> eqbool_make_bool <span class="keyword">(</span>x<span class="keyword">)</span> <span class="keyword">=</span> EQBOOL <span class="keyword">(</span><span class="keyword">)</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
lazy_force <span class="keyword">(</span>lazyval<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">!</span>lazyval</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
lazy_vt_force <span class="keyword">(</span>lazyval<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">!</span>lazyval</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
stamped_vt2t_ref<span class="staexp"><span class="keyword">{</span>x<span class="keyword">}</span></span><span class="keyword">(</span>x<span class="keyword">)</span> <span class="keyword">=</span>
  $UN<span class="keyword">.</span>ptr0_get&lt;<span class="staexp">stamped_t</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">&gt;</span><span class="keyword">(</span><span class="dynexp"><span class="keyword">addr@</span></span>x<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="prfexp"><span class="keyword">primplmnt</span>
unit_v_elim <span class="keyword">(</span>pf<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="prfexp"><span class="keyword">prval</span> unit_v <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> pf</span> <span class="dynexp"><span class="keyword">in</span> <span class="comment">(*nothing*)</span>
<span class="keyword">end</span></span></span> <span class="comment">// end of [unit_v_elim]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span> box<span class="keyword">(</span>x<span class="keyword">)</span> <span class="keyword">=</span> $UN<span class="keyword">.</span>cast<span class="keyword">(</span>x<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span> unbox<span class="keyword">(</span>x<span class="keyword">)</span> <span class="keyword">=</span> $UN<span class="keyword">.</span>cast<span class="keyword">(</span>x<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span> box_vt<span class="keyword">(</span>x<span class="keyword">)</span> <span class="keyword">=</span> $UN<span class="keyword">.</span>castvwtp0<span class="keyword">(</span>x<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span> unbox_vt<span class="keyword">(</span>x<span class="keyword">)</span> <span class="keyword">=</span> $UN<span class="keyword">.</span>castvwtp0<span class="keyword">(</span>x<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">// HX:</span>
<span class="comment">// See prelude/basics_dyn.sats</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
opt_unsome_get <span class="keyword">(</span>x<span class="keyword">)</span> <span class="keyword">=</span>
  <span class="keyword">let</span> <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> opt_unsome <span class="keyword">(</span>x<span class="keyword">)</span></span> <span class="keyword">in</span> x <span class="keyword">end</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
//
// HX: [atspre_argv_at_at] in basics.cats
//
implement
argv_get_at
  (argv, i) = x where {
  val (pf, fpf | p) =
    argv_takeout_strarr (argv)
  val x = !p.[i]
  prval () = minus_addback (fpf, pf | argv)
} // end of [argv_get_at]
*)</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span>
assertexn_bool0 <span class="keyword">(</span>b<span class="keyword">)</span> <span class="keyword">=</span>
  <span class="keyword">if</span> not<span class="keyword">(</span>b<span class="keyword">)</span> <span class="keyword">then</span> <span class="dynexp"><span class="keyword">$raise</span> AssertExn<span class="keyword">(</span><span class="keyword">)</span></span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span>
assertexn_bool1 <span class="keyword">(</span>b<span class="keyword">)</span> <span class="keyword">=</span>
  <span class="keyword">if</span> not<span class="keyword">(</span>b<span class="keyword">)</span> <span class="keyword">then</span> <span class="dynexp"><span class="keyword">$raise</span> AssertExn<span class="keyword">(</span><span class="keyword">)</span></span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
gidentity <span class="keyword">(</span>x<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span>x<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
gidentity_vt <span class="keyword">(</span>x<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span>x<span class="keyword">)</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
gcopy_val <span class="keyword">(</span>x<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span>x<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span><span class="keyword">t@ype</span></span><span class="keyword">)</span>
gcopy_ref&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>x<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span>x<span class="keyword">)</span></span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
gequal_val_val&lt;<span class="staexp">int</span><span class="keyword">&gt;</span> <span class="keyword">(</span>x<span class="keyword">,</span> y<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span>x <span class="keyword">=</span> y<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">implement</span>
gequal_val_val&lt;<span class="staexp">bool</span><span class="keyword">&gt;</span> <span class="keyword">(</span>x<span class="keyword">,</span> y<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span>x <span class="keyword">=</span> y<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">implement</span>
gequal_val_val&lt;<span class="staexp">char</span><span class="keyword">&gt;</span> <span class="keyword">(</span>x<span class="keyword">,</span> y<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span>x <span class="keyword">=</span> y<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">implement</span>
gequal_val_val&lt;<span class="staexp">double</span><span class="keyword">&gt;</span> <span class="keyword">(</span>x<span class="keyword">,</span> y<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span>x <span class="keyword">=</span> y<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">implement</span>
gequal_val_val&lt;<span class="staexp">string</span><span class="keyword">&gt;</span> <span class="keyword">(</span>x<span class="keyword">,</span> y<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span>x <span class="keyword">=</span> y<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span><span class="keyword">t@ype</span></span><span class="keyword">)</span>
gequal_ref_ref&lt;<span class="staexp">a</span><span class="keyword">&gt;</span>
  <span class="keyword">(</span>x<span class="keyword">,</span> y<span class="keyword">)</span> <span class="keyword">=</span> gequal_val_val&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>x<span class="keyword">,</span> y<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
tostring_val<span class="keyword">(</span>x<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> str <span class="keyword">=</span>
  <span class="keyword">$effmask_wrt</span><span class="keyword">(</span>tostrptr_val&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>x<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="keyword">in</span>
  strptr2string<span class="keyword">(</span>str<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [tostring_val]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
tostring_ref<span class="keyword">(</span>x<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> str <span class="keyword">=</span>
  <span class="keyword">$effmask_wrt</span><span class="keyword">(</span>tostrptr_ref&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>x<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="keyword">in</span>
  strptr2string<span class="keyword">(</span>str<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [tostring_ref]</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span><span class="keyword">t@ype</span></span><span class="keyword">)</span>
tostrptr_ref&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>x<span class="keyword">)</span> <span class="keyword">=</span> tostrptr_val&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>x<span class="keyword">)</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
fprint_val <span class="keyword">(</span>out<span class="keyword">,</span> x<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> str <span class="keyword">=</span> tostrptr_val&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>x<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span> <span class="keyword">=</span> fprint_strptr <span class="keyword">(</span>out<span class="keyword">,</span> str<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span> <span class="keyword">=</span> strptr_free <span class="keyword">(</span>str<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">in</span>
  <span class="comment">// nothing</span>
<span class="keyword">end</span></span></span> <span class="comment">// end of [fprint_val]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">(</span><span class="staexp">a<span class="keyword">:</span><span class="keyword">t@ype</span></span><span class="keyword">)</span>
fprint_ref&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">,</span> x<span class="keyword">)</span> <span class="keyword">=</span> fprint_val&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">,</span> x<span class="keyword">)</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
//
// HX-2014-02-25: commented out
//
implement{a}
print_val (x) = fprint_val&lt;a&gt; (stdout_ref, x)
implement{a}
prerr_val (x) = fprint_val&lt;a&gt; (stderr_ref, x)
implement{a}
print_ref (x) = fprint_ref&lt;a&gt; (stdout_ref, x)
implement{a}
prerr_ref (x) = fprint_ref&lt;a&gt; (stderr_ref, x)
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* end of [basics.dats] *)</span>
</pre>
<pre class="patsyntax">
<span class="comment">(***********************************************************************)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(*                         Applied Type System                         *)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(***********************************************************************)</span>

<span class="comment">(*
** ATS/Postiats - Unleashing the Potential of Types!
** Copyright (C) 2010-2015 Hongwei Xi, ATS Trustful Software, Inc.
** All rights reserved
**
** ATS is free software;  you can  redistribute it and/or modify it under
** the terms of  the GNU GENERAL PUBLIC LICENSE (GPL) as published by the
** Free Software Foundation; either version 3, or (at  your  option)  any
** later version.
**
** ATS is distributed in the hope that it will be useful, but WITHOUT ANY
** WARRANTY; without  even  the  implied  warranty  of MERCHANTABILITY or
** FITNESS FOR A PARTICULAR PURPOSE.  See the  GNU General Public License
** for more details.
**
** You  should  have  received  a  copy of the GNU General Public License
** along  with  ATS;  see the  file COPYING.  If not, please write to the
** Free Software Foundation,  51 Franklin Street, Fifth Floor, Boston, MA
** 02110-1301, USA.
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* Author: Hongwei Xi *)</span>
<span class="comment">(* Authoremail: gmhwxiATgmailDOTcom *)</span>
<span class="comment">(* Start time: May, 2012 *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
** Source:
** $PATSHOME/prelude/DATS/CODEGEN/integer.atxt
** Time of generation: Sat Oct 22 17:10:47 2016
*)</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="neuexp"><span class="keyword">#define</span>
ATS_DYNLOADFLAG 0</span> <span class="comment">// no dynloading</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="keyword">staload</span> UN <span class="keyword">=</span> "prelude/SATS/unsafe.sats"
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
g0int2int&lt;<span class="staexp">intknd</span><span class="keyword">,</span><span class="staexp">intknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0int2int_int_int</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
g0int_neg&lt;<span class="staexp">intknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0int_neg_int</span>
<span class="dynexp"><span class="keyword">implement</span>
g0int_abs&lt;<span class="staexp">intknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0int_abs_int</span>
<span class="dynexp"><span class="keyword">implement</span>
g0int_succ&lt;<span class="staexp">intknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0int_succ_int</span>
<span class="dynexp"><span class="keyword">implement</span>
g0int_pred&lt;<span class="staexp">intknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0int_pred_int</span>
<span class="dynexp"><span class="keyword">implement</span>
g0int_half&lt;<span class="staexp">intknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0int_half_int</span>
<span class="dynexp"><span class="keyword">implement</span>
g0int_add&lt;<span class="staexp">intknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0int_add_int</span>
<span class="dynexp"><span class="keyword">implement</span>
g0int_sub&lt;<span class="staexp">intknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0int_sub_int</span>
<span class="dynexp"><span class="keyword">implement</span>
g0int_mul&lt;<span class="staexp">intknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0int_mul_int</span>
<span class="dynexp"><span class="keyword">implement</span>
g0int_div&lt;<span class="staexp">intknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0int_div_int</span>
<span class="dynexp"><span class="keyword">implement</span>
g0int_mod&lt;<span class="staexp">intknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0int_mod_int</span>
<span class="dynexp"><span class="keyword">implement</span>
g0int_asl&lt;<span class="staexp">intknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0int_asl_int</span>
<span class="dynexp"><span class="keyword">implement</span>
g0int_asr&lt;<span class="staexp">intknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0int_asr_int</span>
<span class="dynexp"><span class="keyword">implement</span>
g0int_isltz&lt;<span class="staexp">intknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0int_isltz_int</span>
<span class="dynexp"><span class="keyword">implement</span>
g0int_isltez&lt;<span class="staexp">intknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0int_isltez_int</span>
<span class="dynexp"><span class="keyword">implement</span>
g0int_isgtz&lt;<span class="staexp">intknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0int_isgtz_int</span>
<span class="dynexp"><span class="keyword">implement</span>
g0int_isgtez&lt;<span class="staexp">intknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0int_isgtez_int</span>
<span class="dynexp"><span class="keyword">implement</span>
g0int_iseqz&lt;<span class="staexp">intknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0int_iseqz_int</span>
<span class="dynexp"><span class="keyword">implement</span>
g0int_isneqz&lt;<span class="staexp">intknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0int_isneqz_int</span>
<span class="dynexp"><span class="keyword">implement</span>
g0int_lt&lt;<span class="staexp">intknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0int_lt_int</span>
<span class="dynexp"><span class="keyword">implement</span>
g0int_lte&lt;<span class="staexp">intknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0int_lte_int</span>
<span class="dynexp"><span class="keyword">implement</span>
g0int_gt&lt;<span class="staexp">intknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0int_gt_int</span>
<span class="dynexp"><span class="keyword">implement</span>
g0int_gte&lt;<span class="staexp">intknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0int_gte_int</span>
<span class="dynexp"><span class="keyword">implement</span>
g0int_eq&lt;<span class="staexp">intknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0int_eq_int</span>
<span class="dynexp"><span class="keyword">implement</span>
g0int_neq&lt;<span class="staexp">intknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0int_neq_int</span>
<span class="dynexp"><span class="keyword">implement</span>
g0int_compare&lt;<span class="staexp">intknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0int_compare_int</span>
<span class="dynexp"><span class="keyword">implement</span>
g0int_max&lt;<span class="staexp">intknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0int_max_int</span>
<span class="dynexp"><span class="keyword">implement</span>
g0int_min&lt;<span class="staexp">intknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0int_min_int</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
fprint_val&lt;<span class="staexp">int</span><span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">,</span> x<span class="keyword">)</span> <span class="keyword">=</span> fprint_int <span class="keyword">(</span>out<span class="keyword">,</span> x<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
mul_int1_size0<span class="keyword">(</span>i<span class="keyword">,</span> j<span class="keyword">)</span> <span class="keyword">=</span>
  <span class="keyword">let</span> <span class="dynexp"><span class="keyword">val</span> i <span class="keyword">=</span> g1int2uint_int_size<span class="keyword">(</span>i<span class="keyword">)</span></span> <span class="keyword">in</span> i * j <span class="keyword">end</span></span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
mul_size0_int1<span class="keyword">(</span>i<span class="keyword">,</span> j<span class="keyword">)</span> <span class="keyword">=</span>
  <span class="keyword">let</span> <span class="dynexp"><span class="keyword">val</span> j <span class="keyword">=</span> g1int2uint_int_size<span class="keyword">(</span>j<span class="keyword">)</span></span> <span class="keyword">in</span> i * j <span class="keyword">end</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">tk</span><span class="keyword">}</span><span class="comment">(*tk*)</span>
g0int_npow
  <span class="keyword">(</span>x<span class="keyword">,</span> n<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="keyword">typedef</span> <span class="staexp">gint <span class="keyword">=</span> <span class="staexp">g0int</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
loop
<span class="keyword">(</span>
  x<span class="keyword">:</span> <span class="staexp">gint</span><span class="keyword">,</span> res<span class="keyword">:</span> <span class="staexp">gint</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">int</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">gint</span> <span class="keyword">=</span> <span class="keyword">(</span>
<span class="comment">//</span>
<span class="keyword">if</span>
<span class="keyword">(</span>n <span class="keyword">&gt;</span> <span class="dynexp">1</span><span class="keyword">)</span>
<span class="keyword">then</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> n2 <span class="keyword">=</span> n &gt;&gt; <span class="dynexp">1</span></span>
  <span class="dynexp"><span class="keyword">val</span> b0 <span class="keyword">=</span> n - <span class="keyword">(</span>n2 &lt;&lt; <span class="dynexp">1</span><span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> xx <span class="keyword">=</span> x * x</span>
<span class="keyword">in</span>
  <span class="keyword">if</span> b0 <span class="keyword">=</span> <span class="dynexp">0</span>
    <span class="keyword">then</span> loop<span class="keyword">(</span>xx<span class="keyword">,</span> res<span class="keyword">,</span> n2<span class="keyword">)</span> <span class="keyword">else</span> loop<span class="keyword">(</span>xx<span class="keyword">,</span> x * res<span class="keyword">,</span> n2<span class="keyword">)</span>
  <span class="comment">// end of [if]</span>
<span class="keyword">end</span> <span class="comment">// end of [then]</span>
<span class="keyword">else</span> <span class="keyword">(</span>
  <span class="keyword">if</span> n <span class="keyword">&gt;</span> <span class="dynexp">0</span> <span class="keyword">then</span> x * res <span class="keyword">else</span> res
<span class="keyword">)</span> <span class="comment">(* end of [else] *)</span>
<span class="comment">//</span>
<span class="keyword">)</span></span> <span class="comment">(* end of [loop] *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> res <span class="keyword">=</span> $UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>gint<span class="keyword">}</span></span><span class="keyword">(</span><span class="dynexp">1</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  <span class="keyword">$effmask_all</span><span class="keyword">(</span>loop<span class="keyword">(</span>x<span class="keyword">,</span> res<span class="keyword">,</span> n<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [g0int_npow]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
g1int2int&lt;<span class="staexp">intknd</span><span class="keyword">,</span><span class="staexp">intknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g1int2int_int_int</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
g1int_neg&lt;<span class="staexp">intknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g1int_neg_int</span>
<span class="dynexp"><span class="keyword">implement</span>
g1int_abs&lt;<span class="staexp">intknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g1int_abs_int</span>
<span class="dynexp"><span class="keyword">implement</span>
g1int_succ&lt;<span class="staexp">intknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g1int_succ_int</span>
<span class="dynexp"><span class="keyword">implement</span>
g1int_pred&lt;<span class="staexp">intknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g1int_pred_int</span>
<span class="dynexp"><span class="keyword">implement</span>
g1int_half&lt;<span class="staexp">intknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g1int_half_int</span>
<span class="dynexp"><span class="keyword">implement</span>
g1int_add&lt;<span class="staexp">intknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g1int_add_int</span>
<span class="dynexp"><span class="keyword">implement</span>
g1int_sub&lt;<span class="staexp">intknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g1int_sub_int</span>
<span class="dynexp"><span class="keyword">implement</span>
g1int_mul&lt;<span class="staexp">intknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g1int_mul_int</span>
<span class="dynexp"><span class="keyword">implement</span>
g1int_div&lt;<span class="staexp">intknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g1int_div_int</span>
<span class="dynexp"><span class="keyword">implement</span>
g1int_nmod&lt;<span class="staexp">intknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g1int_nmod_int</span>
<span class="dynexp"><span class="keyword">implement</span>
g1int_isltz&lt;<span class="staexp">intknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g1int_isltz_int</span>
<span class="dynexp"><span class="keyword">implement</span>
g1int_isltez&lt;<span class="staexp">intknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g1int_isltez_int</span>
<span class="dynexp"><span class="keyword">implement</span>
g1int_isgtz&lt;<span class="staexp">intknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g1int_isgtz_int</span>
<span class="dynexp"><span class="keyword">implement</span>
g1int_isgtez&lt;<span class="staexp">intknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g1int_isgtez_int</span>
<span class="dynexp"><span class="keyword">implement</span>
g1int_iseqz&lt;<span class="staexp">intknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g1int_iseqz_int</span>
<span class="dynexp"><span class="keyword">implement</span>
g1int_isneqz&lt;<span class="staexp">intknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g1int_isneqz_int</span>
<span class="dynexp"><span class="keyword">implement</span>
g1int_lt&lt;<span class="staexp">intknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g1int_lt_int</span>
<span class="dynexp"><span class="keyword">implement</span>
g1int_lte&lt;<span class="staexp">intknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g1int_lte_int</span>
<span class="dynexp"><span class="keyword">implement</span>
g1int_gt&lt;<span class="staexp">intknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g1int_gt_int</span>
<span class="dynexp"><span class="keyword">implement</span>
g1int_gte&lt;<span class="staexp">intknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g1int_gte_int</span>
<span class="dynexp"><span class="keyword">implement</span>
g1int_eq&lt;<span class="staexp">intknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g1int_eq_int</span>
<span class="dynexp"><span class="keyword">implement</span>
g1int_neq&lt;<span class="staexp">intknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g1int_neq_int</span>
<span class="dynexp"><span class="keyword">implement</span>
g1int_compare&lt;<span class="staexp">intknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g1int_compare_int</span>
<span class="dynexp"><span class="keyword">implement</span>
g1int_max&lt;<span class="staexp">intknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g1int_max_int</span>
<span class="dynexp"><span class="keyword">implement</span>
g1int_min&lt;<span class="staexp">intknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g1int_min_int</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">tk</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
g1int_sgn<span class="keyword">(</span>x<span class="keyword">)</span> <span class="keyword">=</span> compare_g1int_int&lt;<span class="staexp">tk</span><span class="keyword">&gt;</span> <span class="keyword">(</span>x<span class="keyword">,</span> <span class="dynexp">0</span><span class="keyword">)</span></span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span>
<span class="staexp"><span class="keyword">}</span></span> add_size1_int1
  <span class="staexp"><span class="keyword">{</span>i<span class="keyword">,</span>j<span class="keyword">}</span></span><span class="keyword">(</span>i<span class="keyword">,</span> j<span class="keyword">)</span> <span class="keyword">=</span> $UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>size_t<span class="keyword">(</span>i+j<span class="keyword">)</span><span class="keyword">}</span></span><span class="keyword">(</span>i+g0i2u<span class="keyword">(</span>j<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span>
<span class="staexp"><span class="keyword">}</span></span> add_int1_size1
  <span class="staexp"><span class="keyword">{</span>i<span class="keyword">,</span>j<span class="keyword">}</span></span><span class="keyword">(</span>i<span class="keyword">,</span> j<span class="keyword">)</span> <span class="keyword">=</span> $UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>size_t<span class="keyword">(</span>i+j<span class="keyword">)</span><span class="keyword">}</span></span><span class="keyword">(</span>g0i2u<span class="keyword">(</span>i<span class="keyword">)</span>+j<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span>
<span class="staexp"><span class="keyword">}</span></span> sub_size1_int1
  <span class="staexp"><span class="keyword">{</span>i<span class="keyword">,</span>j<span class="keyword">}</span></span><span class="keyword">(</span>i<span class="keyword">,</span> j<span class="keyword">)</span> <span class="keyword">=</span> $UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>size_t<span class="keyword">(</span>i-j<span class="keyword">)</span><span class="keyword">}</span></span><span class="keyword">(</span>i-g0i2u<span class="keyword">(</span>j<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">tk</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
g1int_mul2
  <span class="staexp"><span class="keyword">{</span>i<span class="keyword">,</span>j<span class="keyword">}</span></span><span class="keyword">(</span>x<span class="keyword">,</span> y<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span> pf <span class="keyword">=</span>
  mul_make<span class="staexp"><span class="keyword">{</span>i<span class="keyword">,</span>j<span class="keyword">}</span></span><span class="keyword">(</span><span class="keyword">)</span></span> <span class="keyword">in</span> <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> g1int_mul&lt;<span class="staexp">tk</span><span class="keyword">&gt;</span> <span class="keyword">(</span>x<span class="keyword">,</span> y<span class="keyword">)</span><span class="keyword">)</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [let] // end of [g1int_mul2]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
mul_int1_size1
  <span class="staexp"><span class="keyword">{</span>i<span class="keyword">,</span>j<span class="keyword">}</span></span><span class="keyword">(</span>i<span class="keyword">,</span> j<span class="keyword">)</span> <span class="keyword">=</span> $UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>size_t<span class="keyword">(</span>i*j<span class="keyword">)</span><span class="keyword">}</span></span><span class="keyword">(</span>g0i2u<span class="keyword">(</span>i<span class="keyword">)</span>*j<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
mul_size1_int1
  <span class="staexp"><span class="keyword">{</span>i<span class="keyword">,</span>j<span class="keyword">}</span></span><span class="keyword">(</span>i<span class="keyword">,</span> j<span class="keyword">)</span> <span class="keyword">=</span> $UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>size_t<span class="keyword">(</span>i*j<span class="keyword">)</span><span class="keyword">}</span></span><span class="keyword">(</span>i*g0i2u<span class="keyword">(</span>j<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">tk</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
g1int_ndiv
  <span class="staexp"><span class="keyword">{</span>i<span class="keyword">,</span>j<span class="keyword">}</span></span><span class="keyword">(</span>x<span class="keyword">,</span> y<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> q <span class="keyword">=</span>
g1int_div&lt;<span class="staexp">tk</span><span class="keyword">&gt;</span><span class="keyword">(</span>x<span class="keyword">,</span> y<span class="keyword">)</span></span> <span class="keyword">in</span> $UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>g1int<span class="keyword">(</span>tk<span class="keyword">,</span>ndiv<span class="keyword">(</span>i<span class="keyword">,</span>j<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">}</span></span><span class="keyword">(</span>q<span class="keyword">)</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [let] // end of [g1int_ndiv]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">tk</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
g1int_ndiv2
  <span class="staexp"><span class="keyword">{</span>i<span class="keyword">,</span>j<span class="keyword">}</span></span><span class="keyword">(</span>x<span class="keyword">,</span> y<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span>
<span class="keyword">[</span><span class="staexp">q<span class="keyword">:</span>int</span><span class="keyword">]</span> q <span class="keyword">=</span> g1int_div<span class="keyword">(</span>x<span class="keyword">,</span> y<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span>
<span class="keyword">[</span><span class="staexp">q2<span class="keyword">:</span>int</span><span class="keyword">,</span><span class="staexp">r<span class="keyword">:</span>int</span><span class="keyword">]</span>
pf_istot <span class="keyword">=</span> divmod_istot<span class="staexp"><span class="keyword">{</span>i<span class="keyword">,</span>j<span class="keyword">}</span></span><span class="keyword">(</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span>
EQINT<span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span> <span class="keyword">=</span>
  $UN<span class="keyword">.</span>castview0<span class="staexp"><span class="keyword">{</span>EQINT<span class="keyword">(</span>q<span class="keyword">,</span>q2<span class="keyword">)</span><span class="keyword">}</span></span><span class="keyword">(</span><span class="dynexp">0</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  <span class="keyword">(</span><span class="prfexp">pf_istot</span> <span class="keyword">|</span> q<span class="comment">(*quotient*)</span><span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [let] // end of [g1int_ndiv2]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">tk</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
ndiv_g1int_int1
  <span class="keyword">(</span>x<span class="keyword">,</span> y<span class="keyword">)</span> <span class="keyword">=</span> g1i2i<span class="keyword">(</span>g1int_ndiv<span class="keyword">(</span>x<span class="keyword">,</span> g1i2i<span class="keyword">(</span>y<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">tk</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
g1int_nmod2
  <span class="staexp"><span class="keyword">{</span>i<span class="keyword">,</span>j<span class="keyword">}</span></span><span class="keyword">(</span>x<span class="keyword">,</span> y<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> r <span class="keyword">=</span> g1int_nmod<span class="keyword">(</span>x<span class="keyword">,</span> y<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span>
<span class="keyword">[</span><span class="staexp">q<span class="keyword">:</span>int</span><span class="keyword">,</span><span class="staexp">r2<span class="keyword">:</span>int</span><span class="keyword">]</span>
pf_istot <span class="keyword">=</span> divmod_istot<span class="staexp"><span class="keyword">{</span>i<span class="keyword">,</span>j<span class="keyword">}</span></span><span class="keyword">(</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span>
EQINT<span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span> <span class="keyword">=</span>
  $UN<span class="keyword">.</span>castview0<span class="staexp"><span class="keyword">{</span>EQINT<span class="keyword">(</span>i%j<span class="keyword">,</span>r2<span class="keyword">)</span><span class="keyword">}</span></span><span class="keyword">(</span><span class="dynexp">0</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  <span class="keyword">(</span><span class="prfexp">pf_istot</span> <span class="keyword">|</span> r<span class="comment">(*remainder*)</span><span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [let] // end of [g1int_nmod2]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">tk</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
nmod_g1int_int1
  <span class="keyword">(</span>x<span class="keyword">,</span> y<span class="keyword">)</span> <span class="keyword">=</span> g1i2i<span class="keyword">(</span>g1int_nmod<span class="keyword">(</span>x<span class="keyword">,</span> g1i2i<span class="keyword">(</span>y<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">tk</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
nmod2_g1int_int1
  <span class="staexp"><span class="keyword">{</span>i<span class="keyword">,</span>j<span class="keyword">}</span></span><span class="keyword">(</span>x<span class="keyword">,</span> y<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> r <span class="keyword">=</span> nmod_g1int_int1<span class="keyword">(</span>x<span class="keyword">,</span> y<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span>
<span class="keyword">[</span><span class="staexp">q<span class="keyword">:</span>int</span><span class="keyword">,</span><span class="staexp">r2<span class="keyword">:</span>int</span><span class="keyword">]</span>
pf_istot <span class="keyword">=</span> divmod_istot<span class="staexp"><span class="keyword">{</span>i<span class="keyword">,</span>j<span class="keyword">}</span></span><span class="keyword">(</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span>
EQINT<span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span> <span class="keyword">=</span> $UN<span class="keyword">.</span>castview0<span class="staexp"><span class="keyword">{</span>EQINT<span class="keyword">(</span>i%j<span class="keyword">,</span>r2<span class="keyword">)</span><span class="keyword">}</span></span><span class="keyword">(</span><span class="dynexp">0</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  <span class="keyword">(</span><span class="prfexp">pf_istot</span> <span class="keyword">|</span> r<span class="comment">(*remainder*)</span><span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [let] // end of [nmod2_g1int_int1]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">tk</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
g1int_ngcd
  <span class="keyword">(</span>x<span class="keyword">,</span> y<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> loop<span class="staexp"><span class="keyword">{</span>i<span class="keyword">,</span>j<span class="keyword">:</span>nat<span class="keyword">}</span></span> <span class="keyword">.&lt;</span><span class="staexp">j</span><span class="keyword">&gt;.</span>
<span class="keyword">(</span>
  x<span class="keyword">:</span> <span class="staexp">g1int</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">g1int</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">j</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp"><span class="keyword">[</span>r<span class="keyword">:</span>nat<span class="keyword">]</span></span> <span class="staexp">g1int</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">r</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">if</span> y <span class="keyword">&gt;</span> <span class="dynexp">0</span> <span class="keyword">then</span> loop <span class="keyword">(</span>y<span class="keyword">,</span> g1int_nmod <span class="keyword">(</span>x<span class="keyword">,</span> y<span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">else</span> x
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [loop]</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  loop <span class="keyword">(</span>x<span class="keyword">,</span> y<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [g1int_ngcd]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">// HX: int -&gt; uint</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
g0int2uint&lt;<span class="staexp">intknd</span><span class="keyword">,</span><span class="staexp">uintknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0int2uint_int_uint</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">// HX: uint -&gt; int</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
g0uint2int&lt;<span class="staexp">uintknd</span><span class="keyword">,</span><span class="staexp">intknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0uint2int_uint_int</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">// HX: uint -&gt; uint</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
g0uint2uint&lt;<span class="staexp">uintknd</span><span class="keyword">,</span><span class="staexp">uintknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0uint2uint_uint_uint</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
g0uint_succ&lt;<span class="staexp">uintknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0uint_succ_uint</span>
<span class="dynexp"><span class="keyword">implement</span>
g0uint_pred&lt;<span class="staexp">uintknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0uint_pred_uint</span>
<span class="dynexp"><span class="keyword">implement</span>
g0uint_half&lt;<span class="staexp">uintknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0uint_half_uint</span>
<span class="dynexp"><span class="keyword">implement</span>
g0uint_add&lt;<span class="staexp">uintknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0uint_add_uint</span>
<span class="dynexp"><span class="keyword">implement</span>
g0uint_sub&lt;<span class="staexp">uintknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0uint_sub_uint</span>
<span class="dynexp"><span class="keyword">implement</span>
g0uint_mul&lt;<span class="staexp">uintknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0uint_mul_uint</span>
<span class="dynexp"><span class="keyword">implement</span>
g0uint_div&lt;<span class="staexp">uintknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0uint_div_uint</span>
<span class="dynexp"><span class="keyword">implement</span>
g0uint_mod&lt;<span class="staexp">uintknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0uint_mod_uint</span>
<span class="dynexp"><span class="keyword">implement</span>
g0uint_lsl&lt;<span class="staexp">uintknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0uint_lsl_uint</span>
<span class="dynexp"><span class="keyword">implement</span>
g0uint_lsr&lt;<span class="staexp">uintknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0uint_lsr_uint</span>
<span class="dynexp"><span class="keyword">implement</span>
g0uint_lnot&lt;<span class="staexp">uintknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0uint_lnot_uint</span>
<span class="dynexp"><span class="keyword">implement</span>
g0uint_lor&lt;<span class="staexp">uintknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0uint_lor_uint</span>
<span class="dynexp"><span class="keyword">implement</span>
g0uint_lxor&lt;<span class="staexp">uintknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0uint_lxor_uint</span>
<span class="dynexp"><span class="keyword">implement</span>
g0uint_land&lt;<span class="staexp">uintknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0uint_land_uint</span>
<span class="dynexp"><span class="keyword">implement</span>
g0uint_isgtz&lt;<span class="staexp">uintknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0uint_isgtz_uint</span>
<span class="dynexp"><span class="keyword">implement</span>
g0uint_iseqz&lt;<span class="staexp">uintknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0uint_iseqz_uint</span>
<span class="dynexp"><span class="keyword">implement</span>
g0uint_isneqz&lt;<span class="staexp">uintknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0uint_isneqz_uint</span>
<span class="dynexp"><span class="keyword">implement</span>
g0uint_lt&lt;<span class="staexp">uintknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0uint_lt_uint</span>
<span class="dynexp"><span class="keyword">implement</span>
g0uint_lte&lt;<span class="staexp">uintknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0uint_lte_uint</span>
<span class="dynexp"><span class="keyword">implement</span>
g0uint_gt&lt;<span class="staexp">uintknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0uint_gt_uint</span>
<span class="dynexp"><span class="keyword">implement</span>
g0uint_gte&lt;<span class="staexp">uintknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0uint_gte_uint</span>
<span class="dynexp"><span class="keyword">implement</span>
g0uint_eq&lt;<span class="staexp">uintknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0uint_eq_uint</span>
<span class="dynexp"><span class="keyword">implement</span>
g0uint_neq&lt;<span class="staexp">uintknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0uint_neq_uint</span>
<span class="dynexp"><span class="keyword">implement</span>
g0uint_compare&lt;<span class="staexp">uintknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0uint_compare_uint</span>
<span class="dynexp"><span class="keyword">implement</span>
g0uint_max&lt;<span class="staexp">uintknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0uint_max_uint</span>
<span class="dynexp"><span class="keyword">implement</span>
g0uint_min&lt;<span class="staexp">uintknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0uint_min_uint</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
fprint_val&lt;<span class="staexp">uint</span><span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">,</span> x<span class="keyword">)</span> <span class="keyword">=</span> fprint_uint <span class="keyword">(</span>out<span class="keyword">,</span> x<span class="keyword">)</span></span><span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">// HX: int -&gt; uint</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
g1int2uint&lt;<span class="staexp">intknd</span><span class="keyword">,</span><span class="staexp">uintknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g1int2uint_int_uint</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">// HX: uint -&gt; int</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
g1uint2int&lt;<span class="staexp">uintknd</span><span class="keyword">,</span><span class="staexp">intknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g1uint2int_uint_int</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">// HX: uint -&gt; uint</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
g1uint2uint&lt;<span class="staexp">uintknd</span><span class="keyword">,</span><span class="staexp">uintknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g1uint2uint_uint_uint</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
g1uint_succ&lt;<span class="staexp">uintknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g1uint_succ_uint</span>
<span class="dynexp"><span class="keyword">implement</span>
g1uint_pred&lt;<span class="staexp">uintknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g1uint_pred_uint</span>
<span class="dynexp"><span class="keyword">implement</span>
g1uint_half&lt;<span class="staexp">uintknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g1uint_half_uint</span>
<span class="dynexp"><span class="keyword">implement</span>
g1uint_add&lt;<span class="staexp">uintknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g1uint_add_uint</span>
<span class="dynexp"><span class="keyword">implement</span>
g1uint_sub&lt;<span class="staexp">uintknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g1uint_sub_uint</span>
<span class="dynexp"><span class="keyword">implement</span>
g1uint_mul&lt;<span class="staexp">uintknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g1uint_mul_uint</span>
<span class="dynexp"><span class="keyword">implement</span>
g1uint_div&lt;<span class="staexp">uintknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g1uint_div_uint</span>
<span class="dynexp"><span class="keyword">implement</span>
g1uint_mod&lt;<span class="staexp">uintknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g1uint_mod_uint</span>
<span class="dynexp"><span class="keyword">implement</span>
g1uint_isgtz&lt;<span class="staexp">uintknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g1uint_isgtz_uint</span>
<span class="dynexp"><span class="keyword">implement</span>
g1uint_iseqz&lt;<span class="staexp">uintknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g1uint_iseqz_uint</span>
<span class="dynexp"><span class="keyword">implement</span>
g1uint_isneqz&lt;<span class="staexp">uintknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g1uint_isneqz_uint</span>
<span class="dynexp"><span class="keyword">implement</span>
g1uint_lt&lt;<span class="staexp">uintknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g1uint_lt_uint</span>
<span class="dynexp"><span class="keyword">implement</span>
g1uint_lte&lt;<span class="staexp">uintknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g1uint_lte_uint</span>
<span class="dynexp"><span class="keyword">implement</span>
g1uint_gt&lt;<span class="staexp">uintknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g1uint_gt_uint</span>
<span class="dynexp"><span class="keyword">implement</span>
g1uint_gte&lt;<span class="staexp">uintknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g1uint_gte_uint</span>
<span class="dynexp"><span class="keyword">implement</span>
g1uint_eq&lt;<span class="staexp">uintknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g1uint_eq_uint</span>
<span class="dynexp"><span class="keyword">implement</span>
g1uint_neq&lt;<span class="staexp">uintknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g1uint_neq_uint</span>
<span class="dynexp"><span class="keyword">implement</span>
g1uint_compare&lt;<span class="staexp">uintknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g1uint_compare_uint</span>
<span class="dynexp"><span class="keyword">implement</span>
g1uint_max&lt;<span class="staexp">uintknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g1uint_max_uint</span>
<span class="dynexp"><span class="keyword">implement</span>
g1uint_min&lt;<span class="staexp">uintknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g1uint_min_uint</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">tk</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
g1uint_div2
  <span class="staexp"><span class="keyword">{</span>i<span class="keyword">,</span>j<span class="keyword">}</span></span><span class="keyword">(</span>x<span class="keyword">,</span> y<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> lemma_g1uint_param <span class="keyword">(</span>x<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">[</span><span class="staexp">q<span class="keyword">:</span>int</span><span class="keyword">]</span> q <span class="keyword">=</span> g1uint_div <span class="keyword">(</span>x<span class="keyword">,</span> y<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span>
<span class="keyword">[</span><span class="staexp">q2<span class="keyword">:</span>int</span><span class="keyword">,</span><span class="staexp">r<span class="keyword">:</span>int</span><span class="keyword">]</span> pf <span class="keyword">=</span> divmod_istot<span class="staexp"><span class="keyword">{</span>i<span class="keyword">,</span>j<span class="keyword">}</span></span><span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span> EQINT<span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span> <span class="keyword">=</span> $UN<span class="keyword">.</span>castview0<span class="staexp"><span class="keyword">{</span>EQINT<span class="keyword">(</span>q<span class="keyword">,</span>q2<span class="keyword">)</span><span class="keyword">}</span></span><span class="keyword">(</span><span class="dynexp">0</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> q<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [let] // end of [g1uint_div2]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">tk</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
g1uint_mod2 <span class="staexp"><span class="keyword">{</span>i<span class="keyword">,</span>j<span class="keyword">}</span></span> <span class="keyword">(</span>x<span class="keyword">,</span> y<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
  <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> lemma_g1uint_param <span class="keyword">(</span>x<span class="keyword">)</span></span>
<span class="comment">//</span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">[</span><span class="staexp">r<span class="keyword">:</span>int</span><span class="keyword">]</span> r <span class="keyword">=</span> g1uint_mod <span class="keyword">(</span>x<span class="keyword">,</span> y<span class="keyword">)</span></span>
  <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">[</span><span class="staexp">q<span class="keyword">:</span>int</span><span class="keyword">,</span><span class="staexp">r2<span class="keyword">:</span>int</span><span class="keyword">]</span> pf <span class="keyword">=</span> divmod_istot<span class="staexp"><span class="keyword">{</span>i<span class="keyword">,</span>j<span class="keyword">}</span></span><span class="keyword">(</span><span class="keyword">)</span></span>
  <span class="prfexp"><span class="keyword">prval</span> EQINT<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> $UN<span class="keyword">.</span>castview0<span class="staexp"><span class="keyword">{</span>EQINT<span class="keyword">(</span>r<span class="keyword">,</span>r2<span class="keyword">)</span><span class="keyword">}</span></span><span class="keyword">(</span><span class="dynexp">0</span><span class="keyword">)</span></span>
<span class="keyword">in</span>
  <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> r<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [let] // end of [g1uint_mod2]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span> g0int2string&lt;<span class="staexp">intknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0int2string_int</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span> g0string2int&lt;<span class="staexp">intknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0string2int_int</span>
<span class="dynexp"><span class="keyword">implement</span> g0string2uint&lt;<span class="staexp">uintknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0string2uint_uint</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">tk</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
g1string2int<span class="keyword">(</span>rep<span class="keyword">)</span> <span class="keyword">=</span> g1ofg0_int<span class="keyword">(</span>g0string2int&lt;<span class="staexp">tk</span><span class="keyword">&gt;</span><span class="keyword">(</span>rep<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">tk</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
g1string2uint<span class="keyword">(</span>rep<span class="keyword">)</span> <span class="keyword">=</span> g1ofg0_uint<span class="keyword">(</span>g0string2uint&lt;<span class="staexp">tk</span><span class="keyword">&gt;</span><span class="keyword">(</span>rep<span class="keyword">)</span><span class="keyword">)</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">tk</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
lt_g0int_int
  <span class="keyword">(</span>x<span class="keyword">,</span> y<span class="keyword">)</span> <span class="keyword">=</span> g0int_lt&lt;<span class="staexp">tk</span><span class="keyword">&gt;</span> <span class="keyword">(</span>x<span class="keyword">,</span> g0int2int<span class="keyword">(</span>y<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">tk</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
lte_g0int_int
  <span class="keyword">(</span>x<span class="keyword">,</span> y<span class="keyword">)</span> <span class="keyword">=</span> g0int_lte&lt;<span class="staexp">tk</span><span class="keyword">&gt;</span> <span class="keyword">(</span>x<span class="keyword">,</span> g0int2int<span class="keyword">(</span>y<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">tk</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
gt_g0int_int
  <span class="keyword">(</span>x<span class="keyword">,</span> y<span class="keyword">)</span> <span class="keyword">=</span> g0int_gt&lt;<span class="staexp">tk</span><span class="keyword">&gt;</span> <span class="keyword">(</span>x<span class="keyword">,</span> g0int2int<span class="keyword">(</span>y<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">tk</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
gte_g0int_int
  <span class="keyword">(</span>x<span class="keyword">,</span> y<span class="keyword">)</span> <span class="keyword">=</span> g0int_gte&lt;<span class="staexp">tk</span><span class="keyword">&gt;</span> <span class="keyword">(</span>x<span class="keyword">,</span> g0int2int<span class="keyword">(</span>y<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">tk</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
eq_g0int_int
  <span class="keyword">(</span>x<span class="keyword">,</span> y<span class="keyword">)</span> <span class="keyword">=</span> g0int_eq&lt;<span class="staexp">tk</span><span class="keyword">&gt;</span> <span class="keyword">(</span>x<span class="keyword">,</span> g0int2int<span class="keyword">(</span>y<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">tk</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
neq_g0int_int
  <span class="keyword">(</span>x<span class="keyword">,</span> y<span class="keyword">)</span> <span class="keyword">=</span> g0int_neq&lt;<span class="staexp">tk</span><span class="keyword">&gt;</span> <span class="keyword">(</span>x<span class="keyword">,</span> g0int2int<span class="keyword">(</span>y<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">tk</span><span class="keyword">}</span>
compare_g0int_int
  <span class="keyword">(</span>x<span class="keyword">,</span> y<span class="keyword">)</span> <span class="keyword">=</span> g0int_compare&lt;<span class="staexp">tk</span><span class="keyword">&gt;</span><span class="keyword">(</span>x<span class="keyword">,</span> g0int2int<span class="keyword">(</span>y<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">tk</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
lt_g1int_int
  <span class="keyword">(</span>x<span class="keyword">,</span> y<span class="keyword">)</span> <span class="keyword">=</span> g1int_lt&lt;<span class="staexp">tk</span><span class="keyword">&gt;</span> <span class="keyword">(</span>x<span class="keyword">,</span> g1int2int<span class="keyword">(</span>y<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">tk</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
lte_g1int_int
  <span class="keyword">(</span>x<span class="keyword">,</span> y<span class="keyword">)</span> <span class="keyword">=</span> g1int_lte&lt;<span class="staexp">tk</span><span class="keyword">&gt;</span> <span class="keyword">(</span>x<span class="keyword">,</span> g1int2int<span class="keyword">(</span>y<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">tk</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
gt_g1int_int
  <span class="keyword">(</span>x<span class="keyword">,</span> y<span class="keyword">)</span> <span class="keyword">=</span> g1int_gt&lt;<span class="staexp">tk</span><span class="keyword">&gt;</span> <span class="keyword">(</span>x<span class="keyword">,</span> g1int2int<span class="keyword">(</span>y<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">tk</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
gte_g1int_int
  <span class="keyword">(</span>x<span class="keyword">,</span> y<span class="keyword">)</span> <span class="keyword">=</span> g1int_gte&lt;<span class="staexp">tk</span><span class="keyword">&gt;</span> <span class="keyword">(</span>x<span class="keyword">,</span> g1int2int<span class="keyword">(</span>y<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">tk</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
eq_g1int_int
  <span class="keyword">(</span>x<span class="keyword">,</span> y<span class="keyword">)</span> <span class="keyword">=</span> g1int_eq&lt;<span class="staexp">tk</span><span class="keyword">&gt;</span> <span class="keyword">(</span>x<span class="keyword">,</span> g1int2int<span class="keyword">(</span>y<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">tk</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
neq_g1int_int
  <span class="keyword">(</span>x<span class="keyword">,</span> y<span class="keyword">)</span> <span class="keyword">=</span> g1int_neq&lt;<span class="staexp">tk</span><span class="keyword">&gt;</span> <span class="keyword">(</span>x<span class="keyword">,</span> g1int2int<span class="keyword">(</span>y<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">tk</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
compare_g1int_int
  <span class="keyword">(</span>x<span class="keyword">,</span> y<span class="keyword">)</span> <span class="keyword">=</span> g1int_compare&lt;<span class="staexp">tk</span><span class="keyword">&gt;</span> <span class="keyword">(</span>x<span class="keyword">,</span> g1int2int<span class="keyword">(</span>y<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">tk</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
lt_g0uint_int
  <span class="keyword">(</span>x<span class="keyword">,</span> y<span class="keyword">)</span> <span class="keyword">=</span> g0uint_lt&lt;<span class="staexp">tk</span><span class="keyword">&gt;</span> <span class="keyword">(</span>x<span class="keyword">,</span> g0int2uint<span class="keyword">(</span>y<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">tk</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
lte_g0uint_int
  <span class="keyword">(</span>x<span class="keyword">,</span> y<span class="keyword">)</span> <span class="keyword">=</span> g0uint_lte&lt;<span class="staexp">tk</span><span class="keyword">&gt;</span> <span class="keyword">(</span>x<span class="keyword">,</span> g0int2uint<span class="keyword">(</span>y<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">tk</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
gt_g0uint_int
  <span class="keyword">(</span>x<span class="keyword">,</span> y<span class="keyword">)</span> <span class="keyword">=</span> g0uint_gt&lt;<span class="staexp">tk</span><span class="keyword">&gt;</span> <span class="keyword">(</span>x<span class="keyword">,</span> g0int2uint<span class="keyword">(</span>y<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">tk</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
gte_g0uint_int
  <span class="keyword">(</span>x<span class="keyword">,</span> y<span class="keyword">)</span> <span class="keyword">=</span> g0uint_gte&lt;<span class="staexp">tk</span><span class="keyword">&gt;</span> <span class="keyword">(</span>x<span class="keyword">,</span> g0int2uint<span class="keyword">(</span>y<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">tk</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
eq_g0uint_int
  <span class="keyword">(</span>x<span class="keyword">,</span> y<span class="keyword">)</span> <span class="keyword">=</span> g0uint_eq&lt;<span class="staexp">tk</span><span class="keyword">&gt;</span> <span class="keyword">(</span>x<span class="keyword">,</span> g0int2uint<span class="keyword">(</span>y<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">tk</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
neq_g0uint_int
  <span class="keyword">(</span>x<span class="keyword">,</span> y<span class="keyword">)</span> <span class="keyword">=</span> g0uint_neq&lt;<span class="staexp">tk</span><span class="keyword">&gt;</span> <span class="keyword">(</span>x<span class="keyword">,</span> g0int2uint<span class="keyword">(</span>y<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">tk</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
lt_g1uint_int
  <span class="keyword">(</span>x<span class="keyword">,</span> y<span class="keyword">)</span> <span class="keyword">=</span> g1uint_lt&lt;<span class="staexp">tk</span><span class="keyword">&gt;</span> <span class="keyword">(</span>x<span class="keyword">,</span> g1int2uint<span class="keyword">(</span>y<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">tk</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
lte_g1uint_int
  <span class="keyword">(</span>x<span class="keyword">,</span> y<span class="keyword">)</span> <span class="keyword">=</span> g1uint_lte&lt;<span class="staexp">tk</span><span class="keyword">&gt;</span> <span class="keyword">(</span>x<span class="keyword">,</span> g1int2uint<span class="keyword">(</span>y<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">tk</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
gt_g1uint_int
  <span class="keyword">(</span>x<span class="keyword">,</span> y<span class="keyword">)</span> <span class="keyword">=</span> g1uint_gt&lt;<span class="staexp">tk</span><span class="keyword">&gt;</span> <span class="keyword">(</span>x<span class="keyword">,</span> g1int2uint<span class="keyword">(</span>y<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">tk</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
gte_g1uint_int
  <span class="keyword">(</span>x<span class="keyword">,</span> y<span class="keyword">)</span> <span class="keyword">=</span> g1uint_gte&lt;<span class="staexp">tk</span><span class="keyword">&gt;</span> <span class="keyword">(</span>x<span class="keyword">,</span> g1int2uint<span class="keyword">(</span>y<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">tk</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
eq_g1uint_int
  <span class="keyword">(</span>x<span class="keyword">,</span> y<span class="keyword">)</span> <span class="keyword">=</span> g1uint_eq&lt;<span class="staexp">tk</span><span class="keyword">&gt;</span> <span class="keyword">(</span>x<span class="keyword">,</span> g1int2uint<span class="keyword">(</span>y<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">tk</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
neq_g1uint_int
  <span class="keyword">(</span>x<span class="keyword">,</span> y<span class="keyword">)</span> <span class="keyword">=</span> g1uint_neq&lt;<span class="staexp">tk</span><span class="keyword">&gt;</span> <span class="keyword">(</span>x<span class="keyword">,</span> g1int2uint<span class="keyword">(</span>y<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* end of [integer.dats] *)</span>
</pre>
<pre class="patsyntax">
<span class="comment">(***********************************************************************)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(*                         Applied Type System                         *)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(***********************************************************************)</span>

<span class="comment">(*
** ATS/Postiats - Unleashing the Potential of Types!
** Copyright (C) 2010-2015 Hongwei Xi, ATS Trustful Software, Inc.
** All rights reserved
**
** ATS is free software;  you can  redistribute it and/or modify it under
** the terms of  the GNU GENERAL PUBLIC LICENSE (GPL) as published by the
** Free Software Foundation; either version 3, or (at  your  option)  any
** later version.
**
** ATS is distributed in the hope that it will be useful, but WITHOUT ANY
** WARRANTY; without  even  the  implied  warranty  of MERCHANTABILITY or
** FITNESS FOR A PARTICULAR PURPOSE.  See the  GNU General Public License
** for more details.
**
** You  should  have  received  a  copy of the GNU General Public License
** along  with  ATS;  see the  file COPYING.  If not, please write to the
** Free Software Foundation,  51 Franklin Street, Fifth Floor, Boston, MA
** 02110-1301, USA.
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
** Source:
** $PATSHOME/prelude/DATS/CODEGEN/pointer.atxt
** Time of generation: Sun Oct  2 10:33:52 2016
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* Author: Hongwei Xi *)</span>
<span class="comment">(* Authoremail: hwxi AT cs DOT bu DOT edu *)</span>
<span class="comment">(* Start time: March, 2012 *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">staload</span> UN <span class="keyword">=</span> "prelude/SATS/unsafe.sats"

<span class="comment">(* ****** ****** *)</span>

<span class="prfexp"><span class="keyword">primplmnt</span>
lemma_ptr_param
  <span class="staexp"><span class="keyword">{</span>l<span class="keyword">}</span></span> <span class="keyword">(</span>p<span class="keyword">)</span> <span class="keyword">=</span> lemma_addr_param <span class="staexp"><span class="keyword">{</span>l<span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span></span>
<span class="comment">// end of [lemma_ptr_param]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="prfexp"><span class="keyword">primplmnt</span>
ptr_get_index<span class="staexp"><span class="keyword">{</span>l<span class="keyword">}</span></span><span class="keyword">(</span>p<span class="keyword">)</span> <span class="keyword">=</span> eqaddr_make<span class="staexp"><span class="keyword">{</span>l<span class="keyword">,</span> l<span class="keyword">}</span></span><span class="keyword">(</span><span class="keyword">)</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
ptr0_succ<span class="keyword">(</span>p<span class="keyword">)</span> <span class="keyword">=</span> add_ptr_bsz<span class="keyword">(</span>p<span class="keyword">,</span> sizeof&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
ptr0_pred<span class="keyword">(</span>p<span class="keyword">)</span> <span class="keyword">=</span> sub_ptr_bsz<span class="keyword">(</span>p<span class="keyword">,</span> sizeof&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">)</span></span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">tk</span><span class="keyword">}</span>
ptr0_add_gint<span class="keyword">(</span>p<span class="keyword">,</span> i<span class="keyword">)</span> <span class="keyword">=</span>
  add_ptr_bsz<span class="keyword">(</span>p<span class="keyword">,</span> g0int2uint<span class="keyword">(</span>i<span class="keyword">)</span> * sizeof&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">tk</span><span class="keyword">}</span>
ptr0_sub_gint<span class="keyword">(</span>p<span class="keyword">,</span> i<span class="keyword">)</span> <span class="keyword">=</span>
  sub_ptr_bsz<span class="keyword">(</span>p<span class="keyword">,</span> g0int2uint<span class="keyword">(</span>i<span class="keyword">)</span> * sizeof&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">tk</span><span class="keyword">}</span>
ptr0_add_guint<span class="keyword">(</span>p<span class="keyword">,</span> i<span class="keyword">)</span> <span class="keyword">=</span>
  add_ptr_bsz<span class="keyword">(</span>p<span class="keyword">,</span> g0uint2uint<span class="keyword">(</span>i<span class="keyword">)</span> * sizeof&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">tk</span><span class="keyword">}</span>
ptr0_sub_guint<span class="keyword">(</span>p<span class="keyword">,</span> i<span class="keyword">)</span> <span class="keyword">=</span>
  sub_ptr_bsz<span class="keyword">(</span>p<span class="keyword">,</span> g0uint2uint<span class="keyword">(</span>i<span class="keyword">)</span> * sizeof&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
ptr1_succ<span class="staexp"><span class="keyword">{</span>l<span class="keyword">}</span></span><span class="keyword">(</span>p<span class="keyword">)</span> <span class="keyword">=</span>
$UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>ptr<span class="keyword">(</span>l+sizeof<span class="keyword">(</span>a<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">}</span></span><span class="keyword">(</span>add_ptr_bsz<span class="keyword">(</span>p<span class="keyword">,</span> sizeof&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
ptr1_pred<span class="staexp"><span class="keyword">{</span>l<span class="keyword">}</span></span><span class="keyword">(</span>p<span class="keyword">)</span> <span class="keyword">=</span>
$UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>ptr<span class="keyword">(</span>l-sizeof<span class="keyword">(</span>a<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">}</span></span><span class="keyword">(</span>sub_ptr_bsz<span class="keyword">(</span>p<span class="keyword">,</span> sizeof&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">tk</span><span class="keyword">}</span>
ptr1_add_gint<span class="staexp"><span class="keyword">{</span>l<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>i<span class="keyword">}</span></span><span class="keyword">(</span>p<span class="keyword">,</span> i<span class="keyword">)</span> <span class="keyword">=</span>
$UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>ptr<span class="keyword">(</span>l+i*sizeof<span class="keyword">(</span>a<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">}</span></span><span class="keyword">(</span>ptr0_add_gint&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">tk</span><span class="keyword">&gt;</span><span class="keyword">(</span>p<span class="keyword">,</span> i<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">tk</span><span class="keyword">}</span>
ptr1_sub_gint<span class="staexp"><span class="keyword">{</span>l<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>i<span class="keyword">}</span></span><span class="keyword">(</span>p<span class="keyword">,</span> i<span class="keyword">)</span> <span class="keyword">=</span>
$UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>ptr<span class="keyword">(</span>l-i*sizeof<span class="keyword">(</span>a<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">}</span></span><span class="keyword">(</span>ptr0_sub_gint&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">tk</span><span class="keyword">&gt;</span><span class="keyword">(</span>p<span class="keyword">,</span> i<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">tk</span><span class="keyword">}</span>
ptr1_add_guint<span class="staexp"><span class="keyword">{</span>l<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>i<span class="keyword">}</span></span><span class="keyword">(</span>p<span class="keyword">,</span> i<span class="keyword">)</span> <span class="keyword">=</span>
$UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>ptr<span class="keyword">(</span>l+i*sizeof<span class="keyword">(</span>a<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">}</span></span><span class="keyword">(</span>ptr0_add_guint&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">tk</span><span class="keyword">&gt;</span><span class="keyword">(</span>p<span class="keyword">,</span> i<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">tk</span><span class="keyword">}</span>
ptr1_sub_guint<span class="staexp"><span class="keyword">{</span>l<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>i<span class="keyword">}</span></span><span class="keyword">(</span>p<span class="keyword">,</span> i<span class="keyword">)</span> <span class="keyword">=</span>
$UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>ptr<span class="keyword">(</span>l-i*sizeof<span class="keyword">(</span>a<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">}</span></span><span class="keyword">(</span>ptr0_sub_guint&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">tk</span><span class="keyword">&gt;</span><span class="keyword">(</span>p<span class="keyword">,</span> i<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
ptr_get<span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> p<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">!</span>p</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
ptr_set<span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> p<span class="keyword">,</span> x<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">!</span>p := x<span class="keyword">)</span></span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
ptr_exch<span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> p<span class="keyword">,</span> xr<span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">{</span>
  <span class="dynexp"><span class="keyword">val</span> x0 <span class="keyword">=</span> xr</span><span class="keyword">;</span> <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> xr := <span class="keyword">!</span>p</span><span class="keyword">;</span> <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">!</span>p := x0</span>
<span class="keyword">}</span></span> <span class="comment">// end of [ptr_exch]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
ptr_nullize
  <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> x<span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
  ptr_nullize_tsz<span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> x<span class="keyword">,</span> sizeof&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">)</span>
<span class="keyword">)</span></span> <span class="comment">(* ptr_nullize *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
ptr_alloc<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> ptr_alloc_tsz<span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="keyword">(</span>sizeof&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">)</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
aptr_make_elt<span class="keyword">(</span>x<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pf</span><span class="keyword">,</span> <span class="prfexp">fpf</span> <span class="keyword">|</span> p<span class="keyword">)</span> <span class="keyword">=</span> ptr_alloc<span class="keyword">(</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  <span class="keyword">!</span>p := x<span class="keyword">;</span>
  $UN<span class="keyword">.</span>castvwtp0<span class="staexp"><span class="keyword">{</span>aPtr1<span class="keyword">(</span>a<span class="keyword">)</span><span class="keyword">}</span></span><span class="keyword">(</span><span class="keyword">(</span>pf<span class="keyword">,</span> fpf<span class="keyword">,</span> p<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [aptr_make_elt]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
cptr_succ<span class="staexp"><span class="keyword">{</span>l<span class="keyword">}</span></span><span class="keyword">(</span>cp<span class="keyword">)</span> <span class="keyword">=</span>
$UN<span class="keyword">.</span>cast<span class="keyword">(</span>add_ptr_bsz<span class="keyword">(</span>cptr2ptr<span class="keyword">(</span>cp<span class="keyword">)</span><span class="keyword">,</span> sizeof&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
cptr_pred<span class="staexp"><span class="keyword">{</span>l<span class="keyword">}</span></span><span class="keyword">(</span>cp<span class="keyword">)</span> <span class="keyword">=</span>
$UN<span class="keyword">.</span>cast<span class="keyword">(</span>sub_ptr_bsz<span class="keyword">(</span>cptr2ptr<span class="keyword">(</span>cp<span class="keyword">)</span><span class="keyword">,</span> sizeof&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
aptr_getfree_elt
  <span class="staexp"><span class="keyword">{</span>l<span class="keyword">}</span></span><span class="keyword">(</span>ap<span class="keyword">)</span> <span class="keyword">=</span> x0 <span class="keyword">where</span>
<span class="keyword">{</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> p0 <span class="keyword">=</span> aptr2ptr<span class="keyword">(</span>ap<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> x0 <span class="keyword">=</span> $UN<span class="keyword">.</span>ptr1_get&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>p0<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span>
pfat_ <span class="keyword">=</span> $UN<span class="keyword">.</span>castview0<span class="staexp"><span class="keyword">{</span><span class="keyword">(</span>a?<span class="keyword">)</span><span class="keyword">@</span>l<span class="keyword">}</span></span><span class="keyword">(</span><span class="dynexp">0</span><span class="keyword">)</span></span>
<span class="prfexp"><span class="keyword">prval</span>
pfgc_ <span class="keyword">=</span> $UN<span class="keyword">.</span>castview0<span class="staexp"><span class="keyword">{</span>mfree_gc_v<span class="keyword">(</span>l<span class="keyword">)</span><span class="keyword">}</span></span><span class="keyword">(</span><span class="dynexp">0</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> ptr_free<span class="staexp"><span class="keyword">{</span>a?<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>l<span class="keyword">}</span></span><span class="keyword">(</span><span class="prfexp">pfgc_</span><span class="keyword">,</span> <span class="prfexp">pfat_</span> <span class="keyword">|</span> p0<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> $UN<span class="keyword">.</span>cast2void<span class="keyword">(</span>ap<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">}</span></span> <span class="comment">(* end of [aptr_getfree_elt] *)</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
aptr_get_elt<span class="keyword">(</span>ap<span class="keyword">)</span> <span class="keyword">=</span>
  $UN<span class="keyword">.</span>ptr1_get&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>aptr2ptr<span class="keyword">(</span>ap<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
aptr_set_elt<span class="keyword">(</span>ap<span class="keyword">,</span> x0<span class="keyword">)</span> <span class="keyword">=</span>
  $UN<span class="keyword">.</span>ptr1_set&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>aptr2ptr<span class="keyword">(</span>ap<span class="keyword">)</span><span class="keyword">,</span> x0<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
aptr_exch_elt<span class="keyword">(</span>ap<span class="keyword">,</span> x0<span class="keyword">)</span> <span class="keyword">=</span>
  $UN<span class="keyword">.</span>ptr1_exch&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>aptr2ptr<span class="keyword">(</span>ap<span class="keyword">)</span><span class="keyword">,</span> x0<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
aptr_vtget0_elt
  <span class="staexp"><span class="keyword">{</span>l<span class="keyword">}</span></span><span class="keyword">(</span>ap<span class="keyword">)</span> <span class="keyword">=</span> x0 <span class="keyword">where</span>
<span class="keyword">{</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> x0 <span class="keyword">=</span>
  $UN<span class="keyword">.</span>ptr1_get&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>aptr2ptr<span class="keyword">(</span>ap<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> $UN<span class="keyword">.</span>castvwtp2void<span class="keyword">(</span>ap<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">}</span></span> <span class="comment">(* end of [aptr_vtget0_elt] *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
aptr_vtget1_elt
  <span class="staexp"><span class="keyword">{</span>l<span class="keyword">}</span></span><span class="keyword">(</span>ap<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> x0 <span class="keyword">=</span>
  $UN<span class="keyword">.</span>ptr1_get&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>aptr2ptr<span class="keyword">(</span>ap<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">vtypedef</span>
<span class="staexp">res_vt <span class="keyword">=</span> <span class="keyword">(</span><span class="staexp">minus_v</span><span class="keyword">(</span><span class="staexp">aptr</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span><span class="staexp">l</span><span class="keyword">)</span><span class="keyword">,</span><span class="staexp">a</span><span class="keyword">)</span> <span class="keyword">|</span> <span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  $UN<span class="keyword">.</span>castvwtp0<span class="staexp"><span class="keyword">{</span>res_vt<span class="keyword">}</span></span><span class="keyword">(</span>x0<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [aptr_vtget1_elt]</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
fprint_val&lt;<span class="staexp">ptr</span><span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">,</span> p<span class="keyword">)</span> <span class="keyword">=</span> fprint_ptr <span class="keyword">(</span>out<span class="keyword">,</span> p<span class="keyword">)</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* end of [pointer.dats] *)</span>
</pre>
<pre class="patsyntax">
<span class="comment">(***********************************************************************)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(*                         Applied Type System                         *)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(***********************************************************************)</span>

<span class="comment">(*
** ATS/Postiats - Unleashing the Potential of Types!
** Copyright (C) 2010-2015 Hongwei Xi, ATS Trustful Software, Inc.
** All rights reserved
**
** ATS is free software;  you can  redistribute it and/or modify it under
** the terms of  the GNU GENERAL PUBLIC LICENSE (GPL) as published by the
** Free Software Foundation; either version 3, or (at  your  option)  any
** later version.
**
** ATS is distributed in the hope that it will be useful, but WITHOUT ANY
** WARRANTY; without  even  the  implied  warranty  of MERCHANTABILITY or
** FITNESS FOR A PARTICULAR PURPOSE.  See the  GNU General Public License
** for more details.
**
** You  should  have  received  a  copy of the GNU General Public License
** along  with  ATS;  see the  file COPYING.  If not, please write to the
** Free Software Foundation,  51 Franklin Street, Fifth Floor, Boston, MA
** 02110-1301, USA.
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
** Source:
** $PATSHOME/prelude/DATS/CODEGEN/memory.atxt
** Time of generation: Sun Oct  2 10:33:55 2016
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">staload</span>
UN <span class="keyword">=</span> "prelude/SATS/unsafe.sats"

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
memory$free<span class="staexp"><span class="keyword">{</span>l<span class="keyword">}</span></span>
  <span class="keyword">(</span><span class="prfexp">pfat</span><span class="keyword">,</span> <span class="prfexp">pfmf</span> <span class="keyword">|</span> p<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span> pfgc <span class="keyword">=</span> $UN<span class="keyword">.</span>castview0<span class="staexp"><span class="keyword">{</span>mfree_gc_v<span class="keyword">(</span>l<span class="keyword">)</span><span class="keyword">}</span></span><span class="keyword">(</span>pfmf<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  mfree_gc <span class="keyword">(</span><span class="prfexp">pfat</span><span class="keyword">,</span> <span class="prfexp">pfgc</span> <span class="keyword">|</span> p<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [memory$free]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
memory$alloc
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">}</span></span> <span class="keyword">(</span>bsz<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">[</span><span class="staexp">l<span class="keyword">:</span>addr</span><span class="keyword">]</span>
  <span class="keyword">(</span><span class="prfexp">pfat</span><span class="keyword">,</span> <span class="prfexp">pfgc</span> <span class="keyword">|</span> p<span class="keyword">)</span> <span class="keyword">=</span> malloc_gc <span class="keyword">(</span>bsz<span class="keyword">)</span></span>
<span class="prfexp"><span class="keyword">prval</span> pfmf <span class="keyword">=</span> $UN<span class="keyword">.</span>castview0<span class="staexp"><span class="keyword">{</span>memory$free_v<span class="keyword">(</span>l<span class="keyword">)</span><span class="keyword">}</span></span><span class="keyword">(</span>pfgc<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  <span class="keyword">(</span><span class="prfexp">pfat</span><span class="keyword">,</span> <span class="prfexp">pfmf</span> <span class="keyword">|</span> p<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [memory$alloc]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* end of [memory.dats] *)</span>
</pre>
<pre class="patsyntax">
<span class="comment">(***********************************************************************)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(*                         Applied Type System                         *)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(***********************************************************************)</span>

<span class="comment">(*
** ATS/Postiats - Unleashing the Potential of Types!
** Copyright (C) 2010-2015 Hongwei Xi, ATS Trustful Software, Inc.
** All rights reserved
**
** ATS is free software;  you can  redistribute it and/or modify it under
** the terms of  the GNU GENERAL PUBLIC LICENSE (GPL) as published by the
** Free Software Foundation; either version 3, or (at  your  option)  any
** later version.
**
** ATS is distributed in the hope that it will be useful, but WITHOUT ANY
** WARRANTY; without  even  the  implied  warranty  of MERCHANTABILITY or
** FITNESS FOR A PARTICULAR PURPOSE.  See the  GNU General Public License
** for more details.
**
** You  should  have  received  a  copy of the GNU General Public License
** along  with  ATS;  see the  file COPYING.  If not, please write to the
** Free Software Foundation,  51 Franklin Street, Fifth Floor, Boston, MA
** 02110-1301, USA.
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
** Source:
** $PATSHOME/prelude/DATS/CODEGEN/bool.atxt
** Time of generation: Sun Oct  2 10:33:54 2016
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* Author: Hongwei Xi *)</span>
<span class="comment">(* Authoremail: hwxi AT cs DOT bu DOT edu *)</span>
<span class="comment">(* Start time: Feburary, 2012 *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="neuexp"><span class="keyword">#define</span> ATS_DYNLOADFLAG 0</span> <span class="comment">// no dynloading at run-time</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
//
// HX: see CATS/bool.cats
//
implement
bool2string
  (b) = if b then "true" else "false"
// end of [bool2string]
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
//
// HX: see CATS/bool.cats
//
implement
fprint_bool (out, x) =
  fprint_string (out, bool2string (x))
// end of [fprint_bool]
*)</span>

<span class="dynexp"><span class="keyword">implement</span> fprint_val&lt;<span class="staexp">bool</span><span class="keyword">&gt;</span> <span class="keyword">=</span> fprint_bool</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* end of [bool.dats] *)</span>
</pre>
<pre class="patsyntax">
<span class="comment">(***********************************************************************)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(*                         Applied Type System                         *)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(***********************************************************************)</span>

<span class="comment">(*
** ATS/Postiats - Unleashing the Potential of Types!
** Copyright (C) 2010-2015 Hongwei Xi, ATS Trustful Software, Inc.
** All rights reserved
**
** ATS is free software;  you can  redistribute it and/or modify it under
** the terms of  the GNU GENERAL PUBLIC LICENSE (GPL) as published by the
** Free Software Foundation; either version 3, or (at  your  option)  any
** later version.
**
** ATS is distributed in the hope that it will be useful, but WITHOUT ANY
** WARRANTY; without  even  the  implied  warranty  of MERCHANTABILITY or
** FITNESS FOR A PARTICULAR PURPOSE.  See the  GNU General Public License
** for more details.
**
** You  should  have  received  a  copy of the GNU General Public License
** along  with  ATS;  see the  file COPYING.  If not, please write to the
** Free Software Foundation,  51 Franklin Street, Fifth Floor, Boston, MA
** 02110-1301, USA.
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
** Source:
** $PATSHOME/prelude/DATS/CODEGEN/char.atxt
** Time of generation: Sun Oct  2 10:33:54 2016
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* Author: Hongwei Xi *)</span>
<span class="comment">(* Authoremail: hwxi AT cs DOT bu DOT edu *)</span>
<span class="comment">(* Start time: Feburary, 2012 *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="neuexp"><span class="keyword">#define</span> ATS_DYNLOADFLAG 0</span> <span class="comment">// no dynloading at run-time</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">staload</span> UN <span class="keyword">=</span> "prelude/SATS/unsafe.sats"

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">tk</span><span class="keyword">}</span>
g0int_of_char
  <span class="keyword">(</span>c<span class="keyword">)</span> <span class="keyword">=</span> __cast <span class="keyword">(</span>c<span class="keyword">)</span> <span class="keyword">where</span> <span class="keyword">{</span>
  <span class="keyword">extern</span> <span class="dynexp"><span class="keyword">castfn</span> __cast <span class="keyword">(</span>c<span class="keyword">:</span> <span class="staexp">char</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">g0int</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="keyword">}</span></span> <span class="comment">// end of [g0int_of_char]</span>
<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">tk</span><span class="keyword">}</span>
g0int_of_schar
  <span class="keyword">(</span>c<span class="keyword">)</span> <span class="keyword">=</span> __cast <span class="keyword">(</span>c<span class="keyword">)</span> <span class="keyword">where</span> <span class="keyword">{</span>
  <span class="keyword">extern</span> <span class="dynexp"><span class="keyword">castfn</span> __cast <span class="keyword">(</span>c<span class="keyword">:</span> <span class="staexp">schar</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">g0int</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="keyword">}</span></span> <span class="comment">// end of [g0int_of_schar]</span>
<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">tk</span><span class="keyword">}</span>
g0int_of_uchar
  <span class="keyword">(</span>c<span class="keyword">)</span> <span class="keyword">=</span> __cast <span class="keyword">(</span>c<span class="keyword">)</span> <span class="keyword">where</span> <span class="keyword">{</span>
  <span class="keyword">extern</span> <span class="dynexp"><span class="keyword">castfn</span> __cast <span class="keyword">(</span>c<span class="keyword">:</span> <span class="staexp">uchar</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">g0int</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="keyword">}</span></span> <span class="comment">// end of [g0int_of_uchar]</span>

<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">tk</span><span class="keyword">}</span>
g0uint_of_uchar
  <span class="keyword">(</span>c<span class="keyword">)</span> <span class="keyword">=</span> __cast <span class="keyword">(</span>c<span class="keyword">)</span> <span class="keyword">where</span> <span class="keyword">{</span>
  <span class="keyword">extern</span> <span class="dynexp"><span class="keyword">castfn</span> __cast <span class="keyword">(</span>c<span class="keyword">:</span> <span class="staexp">uchar</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">g0uint</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="keyword">}</span></span> <span class="comment">// end of [g0uint_of_uchar]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">tk</span><span class="keyword">}</span>
g1int_of_char1
  <span class="staexp"><span class="keyword">{</span>c<span class="keyword">}</span></span> <span class="keyword">(</span>c<span class="keyword">)</span> <span class="keyword">=</span> __cast <span class="keyword">(</span>c<span class="keyword">)</span> <span class="keyword">where</span> <span class="keyword">{</span>
  <span class="keyword">extern</span> <span class="dynexp"><span class="keyword">castfn</span> __cast <span class="keyword">(</span>c<span class="keyword">:</span> <span class="staexp">char</span> <span class="staexp">c</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">g1int</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">c</span><span class="keyword">)</span></span>
<span class="keyword">}</span></span> <span class="comment">// end of [g1int_of_char1]</span>
<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">tk</span><span class="keyword">}</span>
g1int_of_schar1
  <span class="staexp"><span class="keyword">{</span>c<span class="keyword">}</span></span> <span class="keyword">(</span>c<span class="keyword">)</span> <span class="keyword">=</span> __cast <span class="keyword">(</span>c<span class="keyword">)</span> <span class="keyword">where</span> <span class="keyword">{</span>
  <span class="keyword">extern</span> <span class="dynexp"><span class="keyword">castfn</span> __cast <span class="keyword">(</span>c<span class="keyword">:</span> <span class="staexp">schar</span> <span class="staexp">c</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">g1int</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">c</span><span class="keyword">)</span></span>
<span class="keyword">}</span></span> <span class="comment">// end of [g1int_of_schar1]</span>
<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">tk</span><span class="keyword">}</span>
g1int_of_uchar1
  <span class="staexp"><span class="keyword">{</span>c<span class="keyword">}</span></span> <span class="keyword">(</span>c<span class="keyword">)</span> <span class="keyword">=</span> __cast <span class="keyword">(</span>c<span class="keyword">)</span> <span class="keyword">where</span> <span class="keyword">{</span>
  <span class="keyword">extern</span> <span class="dynexp"><span class="keyword">castfn</span> __cast <span class="keyword">(</span>c<span class="keyword">:</span> <span class="staexp">uchar</span> <span class="staexp">c</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">g1int</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">c</span><span class="keyword">)</span></span>
<span class="keyword">}</span></span> <span class="comment">// end of [g1int_of_uchar1]</span>

<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">tk</span><span class="keyword">}</span>
g1uint_of_uchar1
  <span class="staexp"><span class="keyword">{</span>c<span class="keyword">}</span></span> <span class="keyword">(</span>c<span class="keyword">)</span> <span class="keyword">=</span> __cast <span class="keyword">(</span>c<span class="keyword">)</span> <span class="keyword">where</span> <span class="keyword">{</span>
  <span class="keyword">extern</span> <span class="dynexp"><span class="keyword">castfn</span> __cast <span class="keyword">(</span>c<span class="keyword">:</span> <span class="staexp">uchar</span> <span class="staexp">c</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">g1uint</span> <span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">c</span><span class="keyword">)</span></span>
<span class="keyword">}</span></span> <span class="comment">// end of [g1uint_of_uchar1]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
char2string<span class="keyword">(</span>c<span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">$effmask_wrt</span>
<span class="keyword">(</span>
  $UN<span class="keyword">.</span>castvwtp0<span class="staexp"><span class="keyword">{</span>string<span class="keyword">}</span></span><span class="keyword">(</span>char2strptr<span class="keyword">(</span>c<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">)</span></span> <span class="comment">(* end of [char2string] *)</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
char2strptr<span class="keyword">(</span>c<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="neuexp"><span class="keyword">#define</span> BSZ 16</span>
<span class="comment">//</span>
<span class="keyword">typedef</span>
<span class="staexp">cstring <span class="keyword">=</span> <span class="staexp"><span class="keyword">$extype</span>"atstype_string"</span></span>
<span class="comment">//</span>
<span class="keyword">var</span> buf <span class="keyword">=</span> <span class="dynexp"><span class="keyword">@[</span>byte<span class="keyword">]</span><span class="keyword">[</span>BSZ<span class="keyword">]</span><span class="keyword">(</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> bufp <span class="keyword">=</span> $UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>cstring<span class="keyword">}</span></span><span class="keyword">(</span><span class="dynexp"><span class="keyword">addr@</span></span>buf<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> _<span class="comment">(*int*)</span> <span class="keyword">=</span>
  <span class="dynexp"><span class="keyword">$extfcall</span><span class="keyword">(</span>ssize_t<span class="keyword">,</span> "snprintf"<span class="keyword">,</span> bufp<span class="keyword">,</span> BSZ<span class="keyword">,</span> "%c"<span class="keyword">,</span> c<span class="keyword">)</span></span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  $UN<span class="keyword">.</span>castvwtp0<span class="staexp"><span class="keyword">{</span>Strptr1<span class="keyword">}</span></span><span class="keyword">(</span>string0_copy<span class="keyword">(</span>$UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>string<span class="keyword">}</span></span><span class="keyword">(</span>bufp<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [char2strptr]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span> fprint_val&lt;<span class="staexp">char</span><span class="keyword">&gt;</span> <span class="keyword">=</span> fprint_char</span>
<span class="dynexp"><span class="keyword">implement</span> fprint_val&lt;<span class="staexp">uchar</span><span class="keyword">&gt;</span> <span class="keyword">=</span> fprint_uchar</span>
<span class="dynexp"><span class="keyword">implement</span> fprint_val&lt;<span class="staexp">schar</span><span class="keyword">&gt;</span> <span class="keyword">=</span> fprint_schar</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* end of [char.dats] *)</span>
</pre>
<pre class="patsyntax">
<span class="comment">(***********************************************************************)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(*                         Applied Type System                         *)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(***********************************************************************)</span>

<span class="comment">(*
** ATS/Postiats - Unleashing the Potential of Types!
** Copyright (C) 2010-2015 Hongwei Xi, ATS Trustful Software, Inc.
** All rights reserved
**
** ATS is free software;  you can  redistribute it and/or modify it under
** the terms of  the GNU GENERAL PUBLIC LICENSE (GPL) as published by the
** Free Software Foundation; either version 3, or (at  your  option)  any
** later version.
**
** ATS is distributed in the hope that it will be useful, but WITHOUT ANY
** WARRANTY; without  even  the  implied  warranty  of MERCHANTABILITY or
** FITNESS FOR A PARTICULAR PURPOSE.  See the  GNU General Public License
** for more details.
**
** You  should  have  received  a  copy of the GNU General Public License
** along  with  ATS;  see the  file COPYING.  If not, please write to the
** Free Software Foundation,  51 Franklin Street, Fifth Floor, Boston, MA
** 02110-1301, USA.
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
** Source:
** $PATSHOME/prelude/DATS/CODEGEN/float.atxt
** Time of generation: Sun Oct  2 10:33:54 2016
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* Author: Hongwei Xi *)</span>
<span class="comment">(* Authoremail: hwxi AT cs DOT bu DOT edu *)</span>
<span class="comment">(* Start time: Feburary, 2012 *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="neuexp"><span class="keyword">#define</span> ATS_DYNLOADFLAG 0</span> <span class="comment">// no dynloading at run-time</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="keyword">staload</span> UN <span class="keyword">=</span> "prelude/SATS/unsafe.sats"
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>


<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
g0int2float&lt;<span class="staexp">intknd</span><span class="keyword">,</span><span class="staexp">fltknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0int2float_int_float</span>
<span class="dynexp"><span class="keyword">implement</span>
g0int2float&lt;<span class="staexp">intknd</span><span class="keyword">,</span><span class="staexp">dblknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0int2float_int_double</span>
<span class="dynexp"><span class="keyword">implement</span>
g0int2float&lt;<span class="staexp">lintknd</span><span class="keyword">,</span><span class="staexp">dblknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0int2float_lint_double</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
g0float2int&lt;<span class="staexp">fltknd</span><span class="keyword">,</span> <span class="staexp">intknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0float2int_float_int</span>
<span class="dynexp"><span class="keyword">implement</span>
g0float2int&lt;<span class="staexp">fltknd</span><span class="keyword">,</span> <span class="staexp">lintknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0float2int_float_lint</span>
<span class="dynexp"><span class="keyword">implement</span>
g0float2int&lt;<span class="staexp">dblknd</span><span class="keyword">,</span> <span class="staexp">intknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0float2int_double_int</span>
<span class="dynexp"><span class="keyword">implement</span>
g0float2int&lt;<span class="staexp">dblknd</span><span class="keyword">,</span> <span class="staexp">lintknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0float2int_double_lint</span>
<span class="dynexp"><span class="keyword">implement</span>
g0float2int&lt;<span class="staexp">dblknd</span><span class="keyword">,</span> <span class="staexp">llintknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0float2int_double_llint</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
g0float2float&lt;<span class="staexp">fltknd</span><span class="keyword">,</span><span class="staexp">fltknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0float2float_float_float</span>
<span class="dynexp"><span class="keyword">implement</span>
g0float2float&lt;<span class="staexp">fltknd</span><span class="keyword">,</span><span class="staexp">dblknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0float2float_float_double</span>
<span class="dynexp"><span class="keyword">implement</span>
g0float2float&lt;<span class="staexp">dblknd</span><span class="keyword">,</span><span class="staexp">fltknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0float2float_double_float</span>
<span class="dynexp"><span class="keyword">implement</span>
g0float2float&lt;<span class="staexp">dblknd</span><span class="keyword">,</span><span class="staexp">dblknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0float2float_double_double</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span> g0string2float&lt;<span class="staexp">dblknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0string2float_double</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span> g0float_neg&lt;<span class="staexp">fltknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0float_neg_float</span>
<span class="dynexp"><span class="keyword">implement</span> g0float_abs&lt;<span class="staexp">fltknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0float_abs_float</span>
<span class="dynexp"><span class="keyword">implement</span> g0float_succ&lt;<span class="staexp">fltknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0float_succ_float</span>
<span class="dynexp"><span class="keyword">implement</span> g0float_pred&lt;<span class="staexp">fltknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0float_pred_float</span>

<span class="dynexp"><span class="keyword">implement</span> g0float_add&lt;<span class="staexp">fltknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0float_add_float</span>
<span class="dynexp"><span class="keyword">implement</span> g0float_sub&lt;<span class="staexp">fltknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0float_sub_float</span>
<span class="dynexp"><span class="keyword">implement</span> g0float_mul&lt;<span class="staexp">fltknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0float_mul_float</span>
<span class="dynexp"><span class="keyword">implement</span> g0float_div&lt;<span class="staexp">fltknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0float_div_float</span>
<span class="dynexp"><span class="keyword">implement</span> g0float_mod&lt;<span class="staexp">fltknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0float_mod_float</span>

<span class="dynexp"><span class="keyword">implement</span> g0float_lt&lt;<span class="staexp">fltknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0float_lt_float</span>
<span class="dynexp"><span class="keyword">implement</span> g0float_lte&lt;<span class="staexp">fltknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0float_lte_float</span>
<span class="dynexp"><span class="keyword">implement</span> g0float_gt&lt;<span class="staexp">fltknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0float_gt_float</span>
<span class="dynexp"><span class="keyword">implement</span> g0float_gte&lt;<span class="staexp">fltknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0float_gte_float</span>
<span class="dynexp"><span class="keyword">implement</span> g0float_eq&lt;<span class="staexp">fltknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0float_eq_float</span>
<span class="dynexp"><span class="keyword">implement</span> g0float_neq&lt;<span class="staexp">fltknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0float_neq_float</span>
<span class="dynexp"><span class="keyword">implement</span> g0float_compare&lt;<span class="staexp">fltknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0float_compare_float</span>

<span class="dynexp"><span class="keyword">implement</span> g0float_max&lt;<span class="staexp">fltknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0float_max_float</span>
<span class="dynexp"><span class="keyword">implement</span> g0float_min&lt;<span class="staexp">fltknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0float_min_float</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span> g0float_neg&lt;<span class="staexp">dblknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0float_neg_double</span>
<span class="dynexp"><span class="keyword">implement</span> g0float_abs&lt;<span class="staexp">dblknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0float_abs_double</span>
<span class="dynexp"><span class="keyword">implement</span> g0float_succ&lt;<span class="staexp">dblknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0float_succ_double</span>
<span class="dynexp"><span class="keyword">implement</span> g0float_pred&lt;<span class="staexp">dblknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0float_pred_double</span>

<span class="dynexp"><span class="keyword">implement</span> g0float_add&lt;<span class="staexp">dblknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0float_add_double</span>
<span class="dynexp"><span class="keyword">implement</span> g0float_sub&lt;<span class="staexp">dblknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0float_sub_double</span>
<span class="dynexp"><span class="keyword">implement</span> g0float_mul&lt;<span class="staexp">dblknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0float_mul_double</span>
<span class="dynexp"><span class="keyword">implement</span> g0float_div&lt;<span class="staexp">dblknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0float_div_double</span>
<span class="dynexp"><span class="keyword">implement</span> g0float_mod&lt;<span class="staexp">dblknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0float_mod_double</span>

<span class="dynexp"><span class="keyword">implement</span> g0float_lt&lt;<span class="staexp">dblknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0float_lt_double</span>
<span class="dynexp"><span class="keyword">implement</span> g0float_lte&lt;<span class="staexp">dblknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0float_lte_double</span>
<span class="dynexp"><span class="keyword">implement</span> g0float_gt&lt;<span class="staexp">dblknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0float_gt_double</span>
<span class="dynexp"><span class="keyword">implement</span> g0float_gte&lt;<span class="staexp">dblknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0float_gte_double</span>
<span class="dynexp"><span class="keyword">implement</span> g0float_eq&lt;<span class="staexp">dblknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0float_eq_double</span>
<span class="dynexp"><span class="keyword">implement</span> g0float_neq&lt;<span class="staexp">dblknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0float_neq_double</span>
<span class="dynexp"><span class="keyword">implement</span> g0float_compare&lt;<span class="staexp">dblknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0float_compare_double</span>

<span class="dynexp"><span class="keyword">implement</span> g0float_max&lt;<span class="staexp">dblknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0float_max_double</span>
<span class="dynexp"><span class="keyword">implement</span> g0float_min&lt;<span class="staexp">dblknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0float_min_double</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span> g0float_neg&lt;<span class="staexp">ldblknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0float_neg_ldouble</span>
<span class="dynexp"><span class="keyword">implement</span> g0float_abs&lt;<span class="staexp">ldblknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0float_abs_ldouble</span>
<span class="dynexp"><span class="keyword">implement</span> g0float_succ&lt;<span class="staexp">ldblknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0float_succ_ldouble</span>
<span class="dynexp"><span class="keyword">implement</span> g0float_pred&lt;<span class="staexp">ldblknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0float_pred_ldouble</span>

<span class="dynexp"><span class="keyword">implement</span> g0float_add&lt;<span class="staexp">ldblknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0float_add_ldouble</span>
<span class="dynexp"><span class="keyword">implement</span> g0float_sub&lt;<span class="staexp">ldblknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0float_sub_ldouble</span>
<span class="dynexp"><span class="keyword">implement</span> g0float_mul&lt;<span class="staexp">ldblknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0float_mul_ldouble</span>
<span class="dynexp"><span class="keyword">implement</span> g0float_div&lt;<span class="staexp">ldblknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0float_div_ldouble</span>
<span class="dynexp"><span class="keyword">implement</span> g0float_mod&lt;<span class="staexp">ldblknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0float_mod_ldouble</span>

<span class="dynexp"><span class="keyword">implement</span> g0float_lt&lt;<span class="staexp">ldblknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0float_lt_ldouble</span>
<span class="dynexp"><span class="keyword">implement</span> g0float_lte&lt;<span class="staexp">ldblknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0float_lte_ldouble</span>
<span class="dynexp"><span class="keyword">implement</span> g0float_gt&lt;<span class="staexp">ldblknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0float_gt_ldouble</span>
<span class="dynexp"><span class="keyword">implement</span> g0float_gte&lt;<span class="staexp">ldblknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0float_gte_ldouble</span>
<span class="dynexp"><span class="keyword">implement</span> g0float_eq&lt;<span class="staexp">ldblknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0float_eq_ldouble</span>
<span class="dynexp"><span class="keyword">implement</span> g0float_neq&lt;<span class="staexp">ldblknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0float_neq_ldouble</span>
<span class="dynexp"><span class="keyword">implement</span> g0float_compare&lt;<span class="staexp">ldblknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0float_compare_ldouble</span>

<span class="dynexp"><span class="keyword">implement</span> g0float_max&lt;<span class="staexp">ldblknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0float_max_ldouble</span>
<span class="dynexp"><span class="keyword">implement</span> g0float_min&lt;<span class="staexp">ldblknd</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0float_min_ldouble</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span> fprint_val&lt;<span class="staexp">float</span><span class="keyword">&gt;</span> <span class="keyword">=</span> fprint_float</span>
<span class="dynexp"><span class="keyword">implement</span> fprint_val&lt;<span class="staexp">double</span><span class="keyword">&gt;</span> <span class="keyword">=</span> fprint_double</span>
<span class="dynexp"><span class="keyword">implement</span> fprint_val&lt;<span class="staexp">ldouble</span><span class="keyword">&gt;</span> <span class="keyword">=</span> fprint_ldouble</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">tk</span><span class="keyword">}</span><span class="comment">(*tk*)</span>
g0float_npow
  <span class="keyword">(</span>x<span class="keyword">,</span> n<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="keyword">typedef</span> <span class="staexp">gfloat <span class="keyword">=</span> <span class="staexp">g0float</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
loop
<span class="keyword">(</span>
  x<span class="keyword">:</span> <span class="staexp">gfloat</span><span class="keyword">,</span> res<span class="keyword">:</span> <span class="staexp">gfloat</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">int</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">gfloat</span> <span class="keyword">=</span> <span class="keyword">(</span>
<span class="comment">//</span>
<span class="keyword">if</span>
<span class="keyword">(</span>n <span class="keyword">&gt;</span> <span class="dynexp">1</span><span class="keyword">)</span>
<span class="keyword">then</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> n2 <span class="keyword">=</span> n &gt;&gt; <span class="dynexp">1</span></span>
  <span class="dynexp"><span class="keyword">val</span> b0 <span class="keyword">=</span> n - <span class="keyword">(</span>n2 &lt;&lt; <span class="dynexp">1</span><span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> xx <span class="keyword">=</span> x * x</span>
<span class="keyword">in</span>
  <span class="keyword">if</span> b0 <span class="keyword">=</span> <span class="dynexp">0</span>
    <span class="keyword">then</span> loop<span class="keyword">(</span>xx<span class="keyword">,</span> res<span class="keyword">,</span> n2<span class="keyword">)</span> <span class="keyword">else</span> loop<span class="keyword">(</span>xx<span class="keyword">,</span> x * res<span class="keyword">,</span> n2<span class="keyword">)</span>
  <span class="comment">// end of [if]</span>
<span class="keyword">end</span> <span class="comment">// end of [then]</span>
<span class="keyword">else</span> <span class="keyword">(</span>
  <span class="keyword">if</span> n <span class="keyword">&gt;</span> <span class="dynexp">0</span> <span class="keyword">then</span> x * res <span class="keyword">else</span> res
<span class="keyword">)</span> <span class="comment">(* end of [else] *)</span>
<span class="comment">//</span>
<span class="keyword">)</span></span> <span class="comment">(* end of [loop] *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> res <span class="keyword">=</span> $UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>gfloat<span class="keyword">}</span></span><span class="keyword">(</span><span class="dynexp">1.0</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  <span class="keyword">$effmask_all</span><span class="keyword">(</span>loop<span class="keyword">(</span>x<span class="keyword">,</span> res<span class="keyword">,</span> n<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [g0float_npow]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* end of [float.dats] *)</span>
</pre>
<pre class="patsyntax">
<span class="comment">(***********************************************************************)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(*                         Applied Type System                         *)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(***********************************************************************)</span>

<span class="comment">(*
** ATS/Postiats - Unleashing the Potential of Types!
** Copyright (C) 2010-2015 Hongwei Xi, ATS Trustful Software, Inc.
** All rights reserved
**
** ATS is free software;  you can  redistribute it and/or modify it under
** the terms of  the GNU GENERAL PUBLIC LICENSE (GPL) as published by the
** Free Software Foundation; either version 3, or (at  your  option)  any
** later version.
**
** ATS is distributed in the hope that it will be useful, but WITHOUT ANY
** WARRANTY; without  even  the  implied  warranty  of MERCHANTABILITY or
** FITNESS FOR A PARTICULAR PURPOSE.  See the  GNU General Public License
** for more details.
**
** You  should  have  received  a  copy of the GNU General Public License
** along  with  ATS;  see the  file COPYING.  If not, please write to the
** Free Software Foundation,  51 Franklin Street, Fifth Floor, Boston, MA
** 02110-1301, USA.
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
** Source:
** $PATSHOME/prelude/DATS/CODEGEN/string.atxt
** Time of generation: Sat Oct 22 23:15:09 2016
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* Author: Hongwei Xi *)</span>
<span class="comment">(* Authoremail: hwxi AT cs DOT bu DOT edu *)</span>
<span class="comment">(* Start time: April, 2012 *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="neuexp"><span class="keyword">#define</span> ATS_DYNLOADFLAG 0</span> <span class="comment">// no dynloading at run-time</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">staload</span> UN <span class="keyword">=</span> "prelude/SATS/unsafe.sats"

<span class="comment">(* ****** ****** *)</span>

<span class="neuexp"><span class="keyword">#define</span> CNUL '\000'</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">overload</span> + <span class="keyword">with</span> add_ptr_bsz</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">macdef</span> castvwtp_trans <span class="keyword">=</span> $UN<span class="keyword">.</span>castvwtp0</span> <span class="comment">// former name</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">extern</span>
<span class="dynexp"><span class="keyword">fun</span> memcpy
  <span class="keyword">(</span>d<span class="keyword">:</span><span class="staexp">ptr</span><span class="keyword">,</span> s<span class="keyword">:</span><span class="staexp">ptr</span><span class="keyword">,</span> n<span class="keyword">:</span><span class="staexp">size_t</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">ptr</span> <span class="keyword">=</span> "mac#atspre_string_memcpy"</span>
<span class="comment">// end of [memcpy]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
string_char<span class="keyword">(</span>str<span class="keyword">)</span> <span class="keyword">=</span>
  $UN<span class="keyword">.</span>ptr0_get&lt;<span class="staexp">char</span><span class="keyword">&gt;</span><span class="keyword">(</span>string2ptr<span class="keyword">(</span>str<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
string_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pfat</span><span class="keyword">,</span> <span class="prfexp">pfgc</span> <span class="keyword">|</span> p0<span class="keyword">)</span> <span class="keyword">=</span> malloc_gc<span class="keyword">(</span>i2sz<span class="keyword">(</span><span class="dynexp">1</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span> <span class="keyword">=</span> $UN<span class="keyword">.</span>ptr0_set&lt;<span class="staexp">char</span><span class="keyword">&gt;</span> <span class="keyword">(</span>p0<span class="keyword">,</span> <span class="dynexp">'\000'</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  $UN<span class="keyword">.</span>castvwtp0<span class="staexp"><span class="keyword">{</span>strnptr<span class="keyword">(</span>0<span class="keyword">)</span><span class="keyword">}</span></span><span class="keyword">(</span><span class="keyword">(</span><span class="prfexp">pfat</span><span class="keyword">,</span> <span class="prfexp">pfgc</span> <span class="keyword">|</span> p0<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [string_nil]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
string_sing<span class="keyword">(</span>chr<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pfat</span><span class="keyword">,</span> <span class="prfexp">pfgc</span> <span class="keyword">|</span> p0<span class="keyword">)</span> <span class="keyword">=</span> malloc_gc<span class="keyword">(</span>i2sz<span class="keyword">(</span><span class="dynexp">2</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span> <span class="keyword">=</span> $UN<span class="keyword">.</span>ptr0_set&lt;<span class="staexp">char</span><span class="keyword">&gt;</span> <span class="keyword">(</span>p0<span class="keyword">,</span> chr<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span> <span class="keyword">=</span> $UN<span class="keyword">.</span>ptr0_set_at&lt;<span class="staexp">char</span><span class="keyword">&gt;</span> <span class="keyword">(</span>p0<span class="keyword">,</span> <span class="dynexp">1</span><span class="keyword">,</span> <span class="dynexp">'\000'</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  $UN<span class="keyword">.</span>castvwtp0<span class="staexp"><span class="keyword">{</span>strnptr<span class="keyword">(</span>1<span class="keyword">)</span><span class="keyword">}</span></span><span class="keyword">(</span><span class="keyword">(</span><span class="prfexp">pfat</span><span class="keyword">,</span> <span class="prfexp">pfgc</span> <span class="keyword">|</span> p0<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [string_sing]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
string_is_empty
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">}</span></span><span class="keyword">(</span>str<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> p <span class="keyword">=</span> string2ptr<span class="keyword">(</span>str<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  $UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>bool<span class="keyword">(</span>n==0<span class="keyword">)</span><span class="keyword">}</span></span><span class="keyword">(</span>$UN<span class="keyword">.</span>ptr1_get&lt;<span class="staexp">char</span><span class="keyword">&gt;</span><span class="keyword">(</span>p<span class="keyword">)</span> <span class="keyword">=</span> CNUL<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [string_is_empty]</span>
<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span>
string_isnot_empty
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">}</span></span><span class="keyword">(</span>str<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> p <span class="keyword">=</span> string2ptr<span class="keyword">(</span>str<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  $UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>bool<span class="keyword">(</span>n <span class="keyword">&gt;</span> 0<span class="keyword">)</span><span class="keyword">}</span></span><span class="keyword">(</span>$UN<span class="keyword">.</span>ptr1_get&lt;<span class="staexp">char</span><span class="keyword">&gt;</span><span class="keyword">(</span>p<span class="keyword">)</span> != CNUL<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [string_isnot_empty]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
string_is_atend_size
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>i<span class="keyword">}</span></span><span class="keyword">(</span>str<span class="keyword">,</span> i<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> p_i <span class="keyword">=</span>
  add_ptr_bsz<span class="keyword">(</span>string2ptr<span class="keyword">(</span>str<span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  $UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>bool<span class="keyword">(</span>n==i<span class="keyword">)</span><span class="keyword">}</span></span><span class="keyword">(</span>$UN<span class="keyword">.</span>ptr1_get&lt;<span class="staexp">char</span><span class="keyword">&gt;</span><span class="keyword">(</span>p_i<span class="keyword">)</span> <span class="keyword">=</span> CNUL<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [string_is_atend_size]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">tk</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
string_is_atend_gint<span class="keyword">(</span>str<span class="keyword">,</span> i<span class="keyword">)</span> <span class="keyword">=</span>
  string_is_atend_size<span class="keyword">(</span>str<span class="keyword">,</span> g1int2uint<span class="keyword">(</span>i<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">// end of [string_is_atend_gint]</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">tk</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
string_is_atend_guint<span class="keyword">(</span>str<span class="keyword">,</span> i<span class="keyword">)</span> <span class="keyword">=</span>
  string_is_atend_size<span class="keyword">(</span>str<span class="keyword">,</span> g1uint2uint<span class="keyword">(</span>i<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">// end of [string_is_atend_guint]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
string_get_at_size<span class="keyword">(</span>str<span class="keyword">,</span> i<span class="keyword">)</span> <span class="keyword">=</span>
  $UN<span class="keyword">.</span>ptr1_get&lt;<span class="staexp">charNZ</span><span class="keyword">&gt;</span><span class="keyword">(</span>string2ptr<span class="keyword">(</span>str<span class="keyword">)</span>+i<span class="keyword">)</span></span>
<span class="comment">// end of [string_get_at_size]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">tk</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
string_get_at_gint<span class="keyword">(</span>str<span class="keyword">,</span> i<span class="keyword">)</span> <span class="keyword">=</span>
  string_get_at_size<span class="keyword">(</span>str<span class="keyword">,</span> g1int2uint<span class="keyword">(</span>i<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">// end of [string_get_at_gint]</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">tk</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
string_get_at_guint<span class="keyword">(</span>str<span class="keyword">,</span> i<span class="keyword">)</span> <span class="keyword">=</span>
  string_get_at_size<span class="keyword">(</span>str<span class="keyword">,</span> g1uint2uint<span class="keyword">(</span>i<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">// end of [string_get_at_guint]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
string_test_at_size
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>i<span class="keyword">}</span></span><span class="keyword">(</span>str<span class="keyword">,</span> i<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="keyword">extern</span>
<span class="dynexp"><span class="keyword">castfn</span>
__cast
<span class="keyword">(</span>
  c<span class="keyword">:</span> <span class="staexp">char</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">&gt;</span>
<span class="staexp"><span class="keyword">[</span>c<span class="keyword">:</span>int<span class="keyword">]</span></span>
<span class="keyword">(</span>
  <span class="staexp">string_index_p</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">,</span> <span class="staexp">c</span><span class="keyword">)</span> <span class="keyword">|</span> <span class="staexp">char</span><span class="keyword">(</span><span class="staexp">c</span><span class="keyword">)</span>
<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
<span class="comment">//</span>
__cast
<span class="keyword">(</span>
  $UN<span class="keyword">.</span>ptr1_get&lt;<span class="staexp">char</span><span class="keyword">&gt;</span><span class="keyword">(</span>string2ptr<span class="keyword">(</span>str<span class="keyword">)</span>+i<span class="keyword">)</span>
<span class="keyword">)</span> <span class="comment">(* __cast *)</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [string_test_at_size]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">tk</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
string_test_at_gint <span class="keyword">(</span>str<span class="keyword">,</span> i<span class="keyword">)</span> <span class="keyword">=</span>
  string_test_at_size <span class="keyword">(</span>str<span class="keyword">,</span> g1int2uint<span class="keyword">(</span>i<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">// end of [string_test_at_gint]</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">tk</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
string_test_at_guint <span class="keyword">(</span>str<span class="keyword">,</span> i<span class="keyword">)</span> <span class="keyword">=</span>
  string_test_at_size <span class="keyword">(</span>str<span class="keyword">,</span> g1uint2uint<span class="keyword">(</span>i<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">// end of [string_test_at_guint]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
strcmp<span class="keyword">(</span>x1<span class="keyword">,</span> x2<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="keyword">extern</span>
<span class="dynexp"><span class="keyword">fun</span>
__strcmp
<span class="keyword">(</span>
  x1<span class="keyword">:</span> <span class="staexp">string</span><span class="keyword">,</span> x2<span class="keyword">:</span> <span class="staexp">string</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int</span> <span class="keyword">=</span> "mac#atspre_strcmp"</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  __strcmp<span class="keyword">(</span>x1<span class="keyword">,</span> x2<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [let] // end of [strcmp]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
strintcmp
  <span class="staexp"><span class="keyword">{</span>n1<span class="keyword">,</span>n2<span class="keyword">}</span></span><span class="keyword">(</span>x1<span class="keyword">,</span> n2<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span>
  lemma_string_param <span class="keyword">(</span>x1<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> loop
  <span class="staexp"><span class="keyword">{</span>n2<span class="keyword">:</span>nat<span class="keyword">}</span></span> <span class="keyword">.&lt;</span><span class="staexp">n2</span><span class="keyword">&gt;.</span>
<span class="keyword">(</span>
  p1<span class="keyword">:</span> <span class="staexp">ptr</span><span class="keyword">,</span> n2<span class="keyword">:</span> <span class="staexp">int</span> <span class="staexp">n2</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
  <span class="dynexp"><span class="keyword">val</span> c <span class="keyword">=</span> $UN<span class="keyword">.</span>ptr0_get&lt;<span class="staexp">char</span><span class="keyword">&gt;</span><span class="keyword">(</span>p1<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">if</span>
c != CNUL
<span class="keyword">then</span> <span class="keyword">(</span>
  <span class="keyword">if</span> n2 <span class="keyword">&gt;</span> <span class="dynexp">0</span>
    <span class="keyword">then</span> loop <span class="keyword">(</span>ptr_succ&lt;<span class="staexp">char</span><span class="keyword">&gt;</span><span class="keyword">(</span>p1<span class="keyword">)</span><span class="keyword">,</span> n2-<span class="dynexp">1</span><span class="keyword">)</span>
    <span class="keyword">else</span> <span class="dynexp">1</span><span class="comment">(*gt*)</span>
  <span class="comment">// end of [if]</span>
<span class="keyword">)</span> <span class="keyword">else</span> <span class="keyword">(</span>
  <span class="keyword">if</span> n2 <span class="keyword">&gt;</span> <span class="dynexp">0</span> <span class="keyword">then</span> <span class="keyword">~</span><span class="dynexp">1</span><span class="comment">(*lt*)</span> <span class="keyword">else</span> <span class="dynexp">0</span><span class="comment">(*eq*)</span>
<span class="keyword">)</span> <span class="comment">(* end of [else] *)</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [loop]</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  $UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>int<span class="keyword">(</span>sgn<span class="keyword">(</span>n1-n2<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">}</span></span><span class="keyword">(</span>loop <span class="keyword">(</span>string2ptr<span class="keyword">(</span>x1<span class="keyword">)</span><span class="keyword">,</span> n2<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [strintcmp]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
strlencmp
  <span class="staexp"><span class="keyword">{</span>n1<span class="keyword">,</span>n2<span class="keyword">}</span></span><span class="keyword">(</span>x1<span class="keyword">,</span> x2<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> lemma_string_param <span class="keyword">(</span>x1<span class="keyword">)</span></span>
<span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> lemma_string_param <span class="keyword">(</span>x2<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> loop
  <span class="staexp"><span class="keyword">{</span>n1<span class="keyword">:</span>nat<span class="keyword">}</span></span> <span class="keyword">.&lt;</span><span class="staexp">n1</span><span class="keyword">&gt;.</span> <span class="keyword">(</span>
  p1<span class="keyword">:</span> <span class="staexp">ptr</span><span class="keyword">,</span> p2<span class="keyword">:</span> <span class="staexp">ptr</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> c1 <span class="keyword">=</span> $UN<span class="keyword">.</span>ptr0_get&lt;<span class="staexp">char</span><span class="keyword">&gt;</span><span class="keyword">(</span>p1<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> c2 <span class="keyword">=</span> $UN<span class="keyword">.</span>ptr0_get&lt;<span class="staexp">char</span><span class="keyword">&gt;</span><span class="keyword">(</span>p2<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">if</span>
c1 != CNUL
<span class="keyword">then</span> <span class="keyword">let</span>
  <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span>
  __assert <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">where</span>
  <span class="keyword">{</span>
      <span class="keyword">extern</span> <span class="prfexp"><span class="keyword">praxi</span> __assert <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><span class="keyword">[</span>n1 <span class="keyword">&gt;</span> 0<span class="keyword">]</span></span> <span class="staexp">void</span></span>
  <span class="keyword">}</span></span> <span class="comment">(* end of [prval] *)</span>
<span class="keyword">in</span>
  <span class="keyword">if</span> c2 != CNUL
    <span class="keyword">then</span> <span class="keyword">(</span>
      loop<span class="staexp"><span class="keyword">{</span>n1-1<span class="keyword">}</span></span><span class="keyword">(</span>ptr_succ&lt;<span class="staexp">char</span><span class="keyword">&gt;</span><span class="keyword">(</span>p1<span class="keyword">)</span><span class="keyword">,</span> ptr_succ&lt;<span class="staexp">char</span><span class="keyword">&gt;</span><span class="keyword">(</span>p2<span class="keyword">)</span><span class="keyword">)</span>
    <span class="keyword">)</span> <span class="keyword">else</span> <span class="dynexp">1</span><span class="comment">(*gt*)</span> <span class="comment">// end of [else]</span>
  <span class="comment">// end of [if]</span>
<span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">(</span>
  <span class="keyword">if</span> c2 != CNUL <span class="keyword">then</span> <span class="keyword">~</span><span class="dynexp">1</span><span class="comment">(*lt*)</span> <span class="keyword">else</span> <span class="dynexp">0</span><span class="comment">(*eq*)</span>
<span class="keyword">)</span> <span class="comment">(* end of [if] *)</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [loop]</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  $UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>int<span class="keyword">(</span>sgn<span class="keyword">(</span>n1-n2<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">}</span></span><span class="keyword">(</span>loop<span class="staexp"><span class="keyword">{</span>n1<span class="keyword">}</span></span><span class="keyword">(</span>string2ptr<span class="keyword">(</span>x1<span class="keyword">)</span><span class="keyword">,</span> string2ptr<span class="keyword">(</span>x2<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [strlencmp]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
string_make_list<span class="keyword">(</span>cs<span class="keyword">)</span> <span class="keyword">=</span>
  string_make_listlen<span class="keyword">(</span>cs<span class="keyword">,</span> list_length<span class="keyword">(</span>cs<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">// end of [string_make_list]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
string_make_listlen
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">}</span></span><span class="keyword">(</span>cs<span class="keyword">,</span> n<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> lemma_list_param <span class="keyword">(</span>cs<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> loop
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>nat<span class="keyword">}</span></span> <span class="keyword">.&lt;</span><span class="staexp">n</span><span class="keyword">&gt;.</span>
<span class="keyword">(</span>
  cs<span class="keyword">:</span> <span class="staexp">list</span> <span class="keyword">(</span><span class="staexp">char</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">int</span> <span class="staexp">n</span><span class="keyword">,</span> p<span class="keyword">:</span> <span class="staexp">ptr</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">ptr</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="keyword">in</span>
  <span class="keyword">if</span> n <span class="keyword">&gt;</span> <span class="dynexp">0</span> <span class="keyword">then</span> <span class="keyword">let</span>
    <span class="dynexp"><span class="keyword">val+</span>list_cons <span class="keyword">(</span>c<span class="keyword">,</span> cs<span class="keyword">)</span> <span class="keyword">=</span> cs</span>
    <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> $UN<span class="keyword">.</span>ptr0_set&lt;<span class="staexp">char</span><span class="keyword">&gt;</span><span class="keyword">(</span>p<span class="keyword">,</span> c<span class="keyword">)</span></span>
  <span class="keyword">in</span>
    loop <span class="keyword">(</span>cs<span class="keyword">,</span> n-<span class="dynexp">1</span><span class="keyword">,</span> ptr_succ&lt;<span class="staexp">char</span><span class="keyword">&gt;</span><span class="keyword">(</span>p<span class="keyword">)</span><span class="keyword">)</span>
  <span class="keyword">end</span> <span class="keyword">else</span> p <span class="comment">// end of [if]</span>
<span class="keyword">end</span></span> <span class="comment">// end of [loop]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> n1 <span class="keyword">=</span> n + <span class="dynexp">1</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pf</span><span class="keyword">,</span> <span class="prfexp">pfgc</span> <span class="keyword">|</span> p0<span class="keyword">)</span> <span class="keyword">=</span>
  <span class="keyword">$effmask_wrt</span> <span class="keyword">(</span>malloc_gc<span class="keyword">(</span>i2sz<span class="keyword">(</span>n1<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> p1 <span class="keyword">=</span> <span class="keyword">$effmask_wrt</span> <span class="keyword">(</span>loop <span class="keyword">(</span>cs<span class="keyword">,</span> n<span class="keyword">,</span> p0<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span>
  <span class="keyword">$effmask_wrt</span> <span class="keyword">(</span>$UN<span class="keyword">.</span>ptr0_set&lt;<span class="staexp">char</span><span class="keyword">&gt;</span><span class="keyword">(</span>p1<span class="keyword">,</span> CNUL<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  castvwtp_trans<span class="staexp"><span class="keyword">{</span>strnptr<span class="keyword">(</span>n<span class="keyword">)</span><span class="keyword">}</span></span><span class="keyword">(</span><span class="keyword">(</span><span class="prfexp">pf</span><span class="keyword">,</span> <span class="prfexp">pfgc</span> <span class="keyword">|</span> p0<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [string_make_listlen]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
string_make_rlist<span class="keyword">(</span>cs<span class="keyword">)</span> <span class="keyword">=</span>
  string_make_rlistlen<span class="keyword">(</span>cs<span class="keyword">,</span> list_length<span class="keyword">(</span>cs<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">// end of [string_make_rlist]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
string_make_rlistlen
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">}</span></span><span class="keyword">(</span>cs<span class="keyword">,</span> n<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> lemma_list_param <span class="keyword">(</span>cs<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> loop
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>nat<span class="keyword">}</span></span> <span class="keyword">.&lt;</span><span class="staexp">n</span><span class="keyword">&gt;.</span>
<span class="keyword">(</span>
  cs<span class="keyword">:</span> <span class="staexp">list</span><span class="keyword">(</span><span class="staexp">char</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">int</span> <span class="staexp">n</span><span class="keyword">,</span> p<span class="keyword">:</span> <span class="staexp">ptr</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">ptr</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">if</span>
n <span class="keyword">&gt;</span> <span class="dynexp">0</span>
<span class="keyword">then</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> p1 <span class="keyword">=</span> ptr_pred&lt;<span class="staexp">char</span><span class="keyword">&gt;</span><span class="keyword">(</span>p<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val+</span>list_cons <span class="keyword">(</span>c<span class="keyword">,</span> cs<span class="keyword">)</span> <span class="keyword">=</span> cs</span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> $UN<span class="keyword">.</span>ptr0_set&lt;<span class="staexp">char</span><span class="keyword">&gt;</span><span class="keyword">(</span>p1<span class="keyword">,</span> c<span class="keyword">)</span></span>
<span class="keyword">in</span>
  loop <span class="keyword">(</span>cs<span class="keyword">,</span> n-<span class="dynexp">1</span><span class="keyword">,</span> p1<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [then]</span>
<span class="keyword">else</span> <span class="keyword">(</span>p<span class="keyword">)</span> <span class="comment">// end of [else]</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [loop]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> n1 <span class="keyword">=</span> n + <span class="dynexp">1</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span>
<span class="keyword">(</span><span class="prfexp">pf</span><span class="keyword">,</span> <span class="prfexp">pfgc</span> <span class="keyword">|</span> p0<span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">$effmask_wrt</span><span class="keyword">(</span>malloc_gc<span class="keyword">(</span>i2sz<span class="keyword">(</span>n1<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> p1 <span class="keyword">=</span> ptr_add&lt;<span class="staexp">char</span><span class="keyword">&gt;</span><span class="keyword">(</span>p0<span class="keyword">,</span> n<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">$effmask_wrt</span>
  <span class="keyword">(</span>$UN<span class="keyword">.</span>ptr0_set&lt;<span class="staexp">char</span><span class="keyword">&gt;</span><span class="keyword">(</span>p1<span class="keyword">,</span> CNUL<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> p0 <span class="keyword">=</span> <span class="keyword">$effmask_wrt</span><span class="keyword">(</span>loop<span class="keyword">(</span>cs<span class="keyword">,</span> n<span class="keyword">,</span> p1<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  castvwtp_trans<span class="staexp"><span class="keyword">{</span>strnptr<span class="keyword">(</span>n<span class="keyword">)</span><span class="keyword">}</span></span><span class="keyword">(</span><span class="keyword">(</span><span class="prfexp">pf</span><span class="keyword">,</span> <span class="prfexp">pfgc</span> <span class="keyword">|</span> p0<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [string_make_rlistlen]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
string_make_list_vt
  <span class="keyword">(</span>cs<span class="keyword">)</span> <span class="keyword">=</span> str <span class="keyword">where</span>
<span class="keyword">{</span>
<span class="comment">//</span>
  <span class="dynexp"><span class="keyword">val</span> str <span class="keyword">=</span>
  string_make_list<span class="keyword">(</span>$UN<span class="keyword">.</span>list_vt2t<span class="keyword">(</span>cs<span class="keyword">)</span><span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="comment">(*freed*)</span><span class="keyword">)</span> <span class="keyword">=</span> list_vt_free&lt;<span class="staexp">char</span><span class="keyword">&gt;</span><span class="keyword">(</span>cs<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">}</span></span> <span class="comment">(* end of [string_make_list_vt] *)</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
string_make_substring
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>st<span class="keyword">,</span>ln<span class="keyword">}</span></span>
  <span class="keyword">(</span>str<span class="keyword">,</span> st<span class="keyword">,</span> ln<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">$effmask_wrt</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> ln1 <span class="keyword">=</span> succ<span class="keyword">(</span>ln<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pf</span><span class="keyword">,</span> <span class="prfexp">pfgc</span> <span class="keyword">|</span> p_dst<span class="keyword">)</span> <span class="keyword">=</span> malloc_gc <span class="keyword">(</span>ln1<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span>
p_src <span class="keyword">=</span> string2ptr<span class="keyword">(</span>str<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span>
p_dst <span class="keyword">=</span> memcpy <span class="keyword">(</span>p_dst<span class="keyword">,</span> p_src + st<span class="keyword">,</span> ln<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> $UN<span class="keyword">.</span>ptr0_set&lt;<span class="staexp">char</span><span class="keyword">&gt;</span><span class="keyword">(</span>p_dst + ln<span class="keyword">,</span> CNUL<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  castvwtp_trans<span class="staexp"><span class="keyword">{</span>strnptr<span class="keyword">(</span>ln<span class="keyword">)</span><span class="keyword">}</span></span><span class="keyword">(</span><span class="keyword">(</span><span class="prfexp">pf</span><span class="keyword">,</span> <span class="prfexp">pfgc</span> <span class="keyword">|</span> p_dst<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [string_make_substring]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
string_head
  <span class="keyword">(</span>str<span class="keyword">)</span> <span class="keyword">=</span> $UN<span class="keyword">.</span>ptr0_get&lt;<span class="staexp">charNZ</span><span class="keyword">&gt;</span><span class="keyword">(</span>string2ptr<span class="keyword">(</span>str<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
string_tail
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">}</span></span><span class="keyword">(</span>str<span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
  $UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>string<span class="keyword">(</span>n-1<span class="keyword">)</span><span class="keyword">}</span></span><span class="keyword">(</span>ptr_succ&lt;<span class="staexp">char</span><span class="keyword">&gt;</span><span class="keyword">(</span>string2ptr<span class="keyword">(</span>str<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
string0_length
  <span class="keyword">(</span>str<span class="keyword">)</span> <span class="keyword">=</span> string1_length&lt;<span class="keyword">&gt;</span><span class="keyword">(</span>g1ofg0<span class="keyword">(</span>str<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">// end of [string0_length]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
string1_length
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">}</span></span><span class="keyword">(</span>str<span class="keyword">)</span> <span class="keyword">=</span>
  __strlen <span class="keyword">(</span>str<span class="keyword">)</span> <span class="keyword">where</span>
<span class="keyword">{</span>
  <span class="keyword">extern</span>
  <span class="dynexp"><span class="keyword">fun</span>
  __strlen <span class="keyword">(</span><span class="staexp">string</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">size_t</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#atspre_strlen"</span>
<span class="keyword">}</span></span> <span class="comment">// end of [where] // end of [string1_length]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
string0_nlength
  <span class="keyword">(</span>str1<span class="keyword">,</span> n2<span class="keyword">)</span> <span class="keyword">=</span>
  string1_nlength&lt;<span class="keyword">&gt;</span> <span class="keyword">(</span>g1ofg0<span class="keyword">(</span>str1<span class="keyword">)</span><span class="keyword">,</span> g1ofg0<span class="keyword">(</span>n2<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">// end of [string0_nlength]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
string1_nlength
  <span class="keyword">(</span>str1<span class="keyword">,</span> n2<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
loop<span class="staexp"><span class="keyword">{</span>n1<span class="keyword">,</span>n2<span class="keyword">,</span>r<span class="keyword">:</span>nat<span class="keyword">}</span></span> <span class="keyword">.&lt;</span><span class="staexp">n1</span><span class="keyword">&gt;.</span>
<span class="keyword">(</span>
  str1<span class="keyword">:</span> <span class="staexp">string</span><span class="keyword">(</span><span class="staexp">n1</span><span class="keyword">)</span><span class="keyword">,</span> n2<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">(</span><span class="staexp">n2</span><span class="keyword">)</span><span class="keyword">,</span> r<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">(</span><span class="staexp">r</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">size_t</span><span class="keyword">(</span><span class="staexp">min</span><span class="keyword">(</span><span class="staexp">n1</span><span class="keyword">,</span><span class="staexp">n2</span><span class="keyword">)</span><span class="staexp">+</span><span class="staexp">r</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span>
<span class="comment">//</span>
<span class="keyword">if</span>
<span class="keyword">(</span>n2 <span class="keyword">&gt;</span> <span class="dynexp">0</span><span class="keyword">)</span>
<span class="keyword">then</span> <span class="keyword">(</span>
<span class="comment">//</span>
<span class="keyword">if</span>
isneqz<span class="keyword">(</span>str1<span class="keyword">)</span>
<span class="keyword">then</span> loop<span class="keyword">(</span>str1<span class="dynexp"><span class="keyword">.</span>tail</span><span class="keyword">(</span><span class="keyword">)</span><span class="keyword">,</span> pred<span class="keyword">(</span>n2<span class="keyword">)</span><span class="keyword">,</span> succ<span class="keyword">(</span>r<span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">else</span> <span class="keyword">(</span>r<span class="keyword">)</span>
<span class="comment">//</span>
<span class="keyword">)</span> <span class="comment">(* end of [then] *)</span>
<span class="keyword">else</span> <span class="keyword">(</span>r<span class="keyword">)</span> <span class="comment">// end of [else]</span>
<span class="comment">//</span>
<span class="keyword">)</span></span> <span class="comment">(* end of [loop] *)</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span>
  lemma_string_param<span class="keyword">(</span>str1<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> lemma_g1uint_param<span class="keyword">(</span>n2<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  loop <span class="keyword">(</span>str1<span class="keyword">,</span> n2<span class="keyword">,</span> i2sz<span class="keyword">(</span><span class="dynexp">0</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [string1_nlength]</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
string0_copy
  <span class="keyword">(</span>str<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> str <span class="keyword">=</span> g1ofg0<span class="keyword">(</span>str<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> str2 <span class="keyword">=</span> string1_copy <span class="keyword">(</span>str<span class="keyword">)</span></span>
<span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> lemma_strnptr_param <span class="keyword">(</span>str2<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  strnptr2strptr <span class="keyword">(</span>str2<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [string0_copy]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
string1_copy
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">}</span></span><span class="keyword">(</span>str<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> n <span class="keyword">=</span> string1_length <span class="keyword">(</span>str<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> n1 <span class="keyword">=</span> succ<span class="keyword">(</span>n<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pf</span><span class="keyword">,</span> <span class="prfexp">pfgc</span> <span class="keyword">|</span> p<span class="keyword">)</span> <span class="keyword">=</span> malloc_gc <span class="keyword">(</span>n1<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> _<span class="comment">(*p*)</span> <span class="keyword">=</span> <span class="keyword">$effmask_wrt</span> <span class="keyword">(</span>memcpy <span class="keyword">(</span>p<span class="keyword">,</span> string2ptr<span class="keyword">(</span>str<span class="keyword">)</span><span class="keyword">,</span> n1<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  castvwtp_trans<span class="staexp"><span class="keyword">{</span>strnptr<span class="keyword">(</span>n<span class="keyword">)</span><span class="keyword">}</span></span><span class="keyword">(</span><span class="keyword">(</span><span class="prfexp">pf</span><span class="keyword">,</span> <span class="prfexp">pfgc</span> <span class="keyword">|</span> p<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [string1_copy]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
strchr<span class="staexp"><span class="keyword">{</span>n<span class="keyword">}</span></span><span class="keyword">(</span>str<span class="keyword">,</span> c0<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> lemma_string_param <span class="keyword">(</span>str<span class="keyword">)</span></span>
<span class="keyword">extern</span> <span class="dynexp"><span class="keyword">fun</span> __strchr <span class="keyword">(</span><span class="staexp">string</span><span class="keyword">,</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">ptr</span> <span class="keyword">=</span> "mac#atspre_strchr"</span>
<span class="keyword">extern</span> <span class="dynexp"><span class="keyword">fun</span> __sub <span class="keyword">(</span><span class="staexp">ptr</span><span class="keyword">,</span> <span class="staexp">ptr</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">ssizeBtw</span> <span class="keyword">(</span><span class="staexp">0</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#atspre_sub_ptr_ptr"</span>
<span class="dynexp"><span class="keyword">val</span> p0 <span class="keyword">=</span> string2ptr<span class="keyword">(</span>str<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> p1 <span class="keyword">=</span> __strchr <span class="keyword">(</span>str<span class="keyword">,</span> <span class="keyword">(</span>char2int0<span class="keyword">)</span>c0<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  <span class="keyword">if</span> p1 <span class="keyword">&gt;</span> the_null_ptr <span class="keyword">then</span> __sub <span class="keyword">(</span>p1<span class="keyword">,</span> p0<span class="keyword">)</span> <span class="keyword">else</span> i2ssz<span class="keyword">(</span><span class="keyword">~</span><span class="dynexp">1</span><span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [strchr]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
strrchr<span class="staexp"><span class="keyword">{</span>n<span class="keyword">}</span></span><span class="keyword">(</span>str<span class="keyword">,</span> c0<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> lemma_string_param <span class="keyword">(</span>str<span class="keyword">)</span></span>
<span class="keyword">extern</span> <span class="dynexp"><span class="keyword">fun</span> __strrchr <span class="keyword">(</span><span class="staexp">string</span><span class="keyword">,</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">ptr</span> <span class="keyword">=</span> "mac#atspre_strrchr"</span>
<span class="keyword">extern</span> <span class="dynexp"><span class="keyword">fun</span> __sub <span class="keyword">(</span><span class="staexp">ptr</span><span class="keyword">,</span> <span class="staexp">ptr</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">ssizeBtw</span> <span class="keyword">(</span><span class="staexp">0</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#atspre_sub_ptr_ptr"</span>
<span class="dynexp"><span class="keyword">val</span> p0 <span class="keyword">=</span> string2ptr<span class="keyword">(</span>str<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> p1 <span class="keyword">=</span> __strrchr <span class="keyword">(</span>str<span class="keyword">,</span> <span class="keyword">(</span>char2int0<span class="keyword">)</span>c0<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  <span class="keyword">if</span> p1 <span class="keyword">&gt;</span> the_null_ptr <span class="keyword">then</span> __sub <span class="keyword">(</span>p1<span class="keyword">,</span> p0<span class="keyword">)</span> <span class="keyword">else</span> i2ssz<span class="keyword">(</span><span class="keyword">~</span><span class="dynexp">1</span><span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [strrchr]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
strstr<span class="staexp"><span class="keyword">{</span>n<span class="keyword">}</span></span>
  <span class="keyword">(</span>haystack<span class="keyword">,</span> needle<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> lemma_string_param <span class="keyword">(</span>haystack<span class="keyword">)</span></span>
<span class="keyword">extern</span> <span class="dynexp"><span class="keyword">fun</span> __strstr <span class="keyword">(</span><span class="staexp">string</span><span class="keyword">,</span> <span class="staexp">string</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">ptr</span> <span class="keyword">=</span> "mac#atspre_strstr"</span>
<span class="keyword">extern</span> <span class="dynexp"><span class="keyword">fun</span> __sub <span class="keyword">(</span><span class="staexp">ptr</span><span class="keyword">,</span> <span class="staexp">ptr</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">ssizeBtw</span> <span class="keyword">(</span><span class="staexp">0</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#atspre_sub_ptr_ptr"</span>
<span class="dynexp"><span class="keyword">val</span> p0 <span class="keyword">=</span> string2ptr<span class="keyword">(</span>haystack<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> p1 <span class="keyword">=</span> __strstr <span class="keyword">(</span>haystack<span class="keyword">,</span> needle<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  <span class="keyword">if</span> p1 <span class="keyword">&gt;</span> the_null_ptr <span class="keyword">then</span> __sub <span class="keyword">(</span>p1<span class="keyword">,</span> p0<span class="keyword">)</span> <span class="keyword">else</span> i2ssz<span class="keyword">(</span><span class="keyword">~</span><span class="dynexp">1</span><span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [strstr]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
strspn<span class="staexp"><span class="keyword">{</span>n<span class="keyword">}</span></span>
  <span class="keyword">(</span>str<span class="keyword">,</span> accept<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> lemma_string_param <span class="keyword">(</span>str<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">extern</span>
<span class="dynexp"><span class="keyword">fun</span>
__strspn <span class="keyword">(</span><span class="staexp">string</span><span class="keyword">,</span> <span class="staexp">string</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">sizeLte</span> <span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#atspre_strspn"</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  __strspn <span class="keyword">(</span>str<span class="keyword">,</span> accept<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [strspn]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
strcspn<span class="staexp"><span class="keyword">{</span>n<span class="keyword">}</span></span>
  <span class="keyword">(</span>str<span class="keyword">,</span> reject<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> lemma_string_param <span class="keyword">(</span>str<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">extern</span>
<span class="dynexp"><span class="keyword">fun</span>
__strcspn <span class="keyword">(</span><span class="staexp">string</span><span class="keyword">,</span> <span class="staexp">string</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">sizeLte</span> <span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span> <span class="keyword">=</span> "mac#atspre_strcspn"</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  __strcspn <span class="keyword">(</span>str<span class="keyword">,</span> reject<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [strcspn]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
string_index
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">}</span></span><span class="keyword">(</span>str<span class="keyword">,</span> c<span class="keyword">)</span> <span class="keyword">=</span> $UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>ssizeBtw<span class="keyword">(</span><span class="keyword">~</span>1<span class="keyword">,</span>n<span class="keyword">)</span><span class="keyword">}</span></span><span class="keyword">(</span>strchr <span class="keyword">(</span>str<span class="keyword">,</span> c<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">// end of [string_index]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
string_rindex
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">}</span></span><span class="keyword">(</span>str<span class="keyword">,</span> c<span class="keyword">)</span> <span class="keyword">=</span> $UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>ssizeBtw<span class="keyword">(</span><span class="keyword">~</span>1<span class="keyword">,</span>n<span class="keyword">)</span><span class="keyword">}</span></span><span class="keyword">(</span>strrchr <span class="keyword">(</span>str<span class="keyword">,</span> c<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">// end of [string_rindex]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
string0_append
  <span class="keyword">(</span>x1<span class="keyword">,</span> x2<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> x1 <span class="keyword">=</span> g1ofg0<span class="keyword">(</span>x1<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> x2 <span class="keyword">=</span> g1ofg0<span class="keyword">(</span>x2<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> x12 <span class="keyword">=</span> string1_append <span class="keyword">(</span>x1<span class="keyword">,</span> x2<span class="keyword">)</span></span>
<span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> lemma_strnptr_param <span class="keyword">(</span>x12<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  strnptr2strptr <span class="keyword">(</span>x12<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [string0_append]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
string1_append
  <span class="staexp"><span class="keyword">{</span>n1<span class="keyword">,</span>n2<span class="keyword">}</span></span><span class="keyword">(</span>x1<span class="keyword">,</span> x2<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> n1 <span class="keyword">=</span> strlen <span class="keyword">(</span>x1<span class="keyword">)</span> <span class="keyword">and</span> n2 <span class="keyword">=</span> strlen <span class="keyword">(</span>x2<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> n12 <span class="keyword">=</span> n1 + n2</span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pf</span><span class="keyword">,</span> <span class="prfexp">fpf</span> <span class="keyword">|</span> p<span class="keyword">)</span> <span class="keyword">=</span> malloc_gc <span class="keyword">(</span>succ<span class="keyword">(</span>n12<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> p1 <span class="keyword">=</span> memcpy <span class="keyword">(</span>p<span class="keyword">,</span> string2ptr<span class="keyword">(</span>x1<span class="keyword">)</span><span class="keyword">,</span> n1<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> p2 <span class="keyword">=</span> memcpy <span class="keyword">(</span>p + n1<span class="keyword">,</span> string2ptr<span class="keyword">(</span>x2<span class="keyword">)</span><span class="keyword">,</span> succ<span class="keyword">(</span>n2<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  castvwtp_trans<span class="staexp"><span class="keyword">{</span>strnptr<span class="keyword">(</span>n1+n2<span class="keyword">)</span><span class="keyword">}</span></span><span class="keyword">(</span><span class="keyword">(</span><span class="prfexp">pf</span><span class="keyword">,</span> <span class="prfexp">fpf</span> <span class="keyword">|</span> p<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [string1_append]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
string0_append3
  <span class="keyword">(</span>x1<span class="keyword">,</span> x2<span class="keyword">,</span> x3<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="keyword">var</span> xs <span class="keyword">=</span> <span class="dynexp"><span class="keyword">@[</span>string<span class="keyword">]</span><span class="keyword">(</span>x1<span class="keyword">,</span> x2<span class="keyword">,</span> x3<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
<span class="comment">//</span>
stringarr_concat&lt;<span class="keyword">&gt;</span>
  <span class="keyword">(</span>$UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>arrayref<span class="keyword">(</span>string<span class="keyword">,</span>3<span class="keyword">)</span><span class="keyword">}</span></span><span class="keyword">(</span><span class="dynexp"><span class="keyword">addr@</span></span>xs<span class="keyword">)</span><span class="keyword">,</span> i2sz<span class="keyword">(</span><span class="dynexp">3</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [string0_append3]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
string0_append4
  <span class="keyword">(</span>x1<span class="keyword">,</span> x2<span class="keyword">,</span> x3<span class="keyword">,</span> x4<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="keyword">var</span> xs <span class="keyword">=</span> <span class="dynexp"><span class="keyword">@[</span>string<span class="keyword">]</span><span class="keyword">(</span>x1<span class="keyword">,</span> x2<span class="keyword">,</span> x3<span class="keyword">,</span> x4<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
<span class="comment">//</span>
stringarr_concat&lt;<span class="keyword">&gt;</span>
  <span class="keyword">(</span>$UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>arrayref<span class="keyword">(</span>string<span class="keyword">,</span>4<span class="keyword">)</span><span class="keyword">}</span></span><span class="keyword">(</span><span class="dynexp"><span class="keyword">addr@</span></span>xs<span class="keyword">)</span><span class="keyword">,</span> i2sz<span class="keyword">(</span><span class="dynexp">4</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [string0_append4]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
string0_append5
  <span class="keyword">(</span>x1<span class="keyword">,</span> x2<span class="keyword">,</span> x3<span class="keyword">,</span> x4<span class="keyword">,</span> x5<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="keyword">var</span> xs <span class="keyword">=</span> <span class="dynexp"><span class="keyword">@[</span>string<span class="keyword">]</span><span class="keyword">(</span>x1<span class="keyword">,</span> x2<span class="keyword">,</span> x3<span class="keyword">,</span> x4<span class="keyword">,</span> x5<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
<span class="comment">//</span>
stringarr_concat&lt;<span class="keyword">&gt;</span>
  <span class="keyword">(</span>$UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>arrayref<span class="keyword">(</span>string<span class="keyword">,</span>5<span class="keyword">)</span><span class="keyword">}</span></span><span class="keyword">(</span><span class="dynexp"><span class="keyword">addr@</span></span>xs<span class="keyword">)</span><span class="keyword">,</span> i2sz<span class="keyword">(</span><span class="dynexp">5</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [string0_append5]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
string0_append6
  <span class="keyword">(</span>x1<span class="keyword">,</span> x2<span class="keyword">,</span> x3<span class="keyword">,</span> x4<span class="keyword">,</span> x5<span class="keyword">,</span> x6<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="keyword">var</span> xs <span class="keyword">=</span> <span class="dynexp"><span class="keyword">@[</span>string<span class="keyword">]</span><span class="keyword">(</span>x1<span class="keyword">,</span> x2<span class="keyword">,</span> x3<span class="keyword">,</span> x4<span class="keyword">,</span> x5<span class="keyword">,</span> x6<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
<span class="comment">//</span>
stringarr_concat&lt;<span class="keyword">&gt;</span>
  <span class="keyword">(</span>$UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>arrayref<span class="keyword">(</span>string<span class="keyword">,</span>6<span class="keyword">)</span><span class="keyword">}</span></span><span class="keyword">(</span><span class="dynexp"><span class="keyword">addr@</span></span>xs<span class="keyword">)</span><span class="keyword">,</span> i2sz<span class="keyword">(</span><span class="dynexp">6</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [string0_append6]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
stringarr_concat<span class="keyword">(</span>xs<span class="keyword">,</span> asz<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> loop
<span class="keyword">(</span>
  p1<span class="keyword">:</span> <span class="staexp">ptr</span><span class="keyword">,</span> p2<span class="keyword">:</span> <span class="staexp">ptr</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">,</span> ntot<span class="keyword">:</span> <span class="staexp">size_t</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">size_t</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">if</span>
i <span class="keyword">&gt;</span> <span class="dynexp">0</span>
<span class="keyword">then</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> x <span class="keyword">=</span> $UN<span class="keyword">.</span>ptr0_get&lt;<span class="staexp">string</span><span class="keyword">&gt;</span> <span class="keyword">(</span>p1<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> nx<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="keyword">=</span> string_length <span class="keyword">(</span>x<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> $UN<span class="keyword">.</span>ptr0_set&lt;<span class="staexp">size_t</span><span class="keyword">&gt;</span> <span class="keyword">(</span>p2<span class="keyword">,</span> nx<span class="keyword">)</span></span>
<span class="keyword">in</span>
  loop<span class="keyword">(</span>ptr_succ&lt;<span class="staexp">string</span><span class="keyword">&gt;</span> <span class="keyword">(</span>p1<span class="keyword">)</span><span class="keyword">,</span> ptr_succ&lt;<span class="staexp">size_t</span><span class="keyword">&gt;</span> <span class="keyword">(</span>p2<span class="keyword">)</span><span class="keyword">,</span> pred<span class="keyword">(</span>i<span class="keyword">)</span><span class="keyword">,</span> ntot+nx<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [then]</span>
<span class="keyword">else</span> ntot <span class="comment">// end of [else]</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [loop]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> loop2
<span class="keyword">(</span>
  p1<span class="keyword">:</span> <span class="staexp">ptr</span><span class="keyword">,</span> p2<span class="keyword">:</span> <span class="staexp">ptr</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">,</span> pres<span class="keyword">:</span> <span class="staexp">ptr</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">if</span>
i <span class="keyword">&gt;</span> <span class="dynexp">0</span>
<span class="keyword">then</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> x <span class="keyword">=</span> $UN<span class="keyword">.</span>ptr0_get&lt;<span class="staexp">string</span><span class="keyword">&gt;</span> <span class="keyword">(</span>p1<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> nx <span class="keyword">=</span> $UN<span class="keyword">.</span>ptr0_get&lt;<span class="staexp">size_t</span><span class="keyword">&gt;</span> <span class="keyword">(</span>p2<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> _<span class="comment">(*ptr*)</span> <span class="keyword">=</span> memcpy <span class="keyword">(</span>pres<span class="keyword">,</span> $UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>ptr<span class="keyword">}</span></span><span class="keyword">(</span>x<span class="keyword">)</span><span class="keyword">,</span> nx<span class="keyword">)</span></span>
<span class="keyword">in</span>
  loop2 <span class="keyword">(</span>ptr_succ&lt;<span class="staexp">string</span><span class="keyword">&gt;</span> <span class="keyword">(</span>p1<span class="keyword">)</span><span class="keyword">,</span> ptr_succ&lt;<span class="staexp">size_t</span><span class="keyword">&gt;</span> <span class="keyword">(</span>p2<span class="keyword">)</span><span class="keyword">,</span> pred<span class="keyword">(</span>i<span class="keyword">)</span><span class="keyword">,</span> pres+nx<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [then]</span>
<span class="keyword">else</span> $UN<span class="keyword">.</span>ptr0_set&lt;<span class="staexp">char</span><span class="keyword">&gt;</span> <span class="keyword">(</span>pres<span class="keyword">,</span> CNUL<span class="keyword">)</span> <span class="comment">// else</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [loop2]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> p1 <span class="keyword">=</span> $UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>ptr<span class="keyword">}</span></span><span class="keyword">(</span>xs<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> nxs <span class="keyword">=</span> arrayptr_make_uninitized&lt;<span class="staexp">size_t</span><span class="keyword">&gt;</span> <span class="keyword">(</span>asz<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> p2 <span class="keyword">=</span> arrayptr2ptr <span class="keyword">(</span>nxs<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> ntot <span class="keyword">=</span>
  <span class="keyword">$effmask_all</span> <span class="keyword">(</span>loop <span class="keyword">(</span>p1<span class="keyword">,</span> p2<span class="keyword">,</span> asz<span class="keyword">,</span> i2sz<span class="keyword">(</span><span class="dynexp">0</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pf</span><span class="keyword">,</span> <span class="prfexp">pfgc</span> <span class="keyword">|</span> pres<span class="keyword">)</span> <span class="keyword">=</span> malloc_gc <span class="keyword">(</span>g1ofg0<span class="keyword">(</span>succ<span class="keyword">(</span>ntot<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">$effmask_all</span> <span class="keyword">(</span>loop2 <span class="keyword">(</span>p1<span class="keyword">,</span> p2<span class="keyword">,</span> asz<span class="keyword">,</span> pres<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="comment">(*freed*)</span><span class="keyword">)</span> <span class="keyword">=</span> arrayptr_free <span class="keyword">(</span>nxs<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  castvwtp_trans<span class="staexp"><span class="keyword">{</span>Strptr1<span class="keyword">}</span></span><span class="keyword">(</span><span class="keyword">(</span><span class="prfexp">pf</span><span class="keyword">,</span> <span class="prfexp">pfgc</span> <span class="keyword">|</span> pres<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [stringarr_concat]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
stringlst_concat
  <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span> res <span class="keyword">where</span>
<span class="keyword">{</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> n <span class="keyword">=</span> list_length<span class="keyword">(</span>xs<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> lemma_list_param<span class="keyword">(</span>xs<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span>
<span class="keyword">[</span><span class="staexp">n<span class="keyword">:</span>int</span><span class="keyword">]</span> EQINT<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> eqint_make_gint<span class="keyword">(</span>n<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> xs2 <span class="keyword">=</span> arrayptr_make_list <span class="keyword">(</span>n<span class="keyword">,</span> xs<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> res <span class="keyword">=</span>
stringarr_concat
  <span class="keyword">(</span>$UN<span class="keyword">.</span>castvwtp1<span class="staexp"><span class="keyword">{</span>arrayref<span class="keyword">(</span>string<span class="keyword">,</span>n<span class="keyword">)</span><span class="keyword">}</span></span><span class="keyword">(</span>xs2<span class="keyword">)</span><span class="keyword">,</span> i2sz<span class="keyword">(</span>n<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="comment">(*freed*)</span><span class="keyword">)</span> <span class="keyword">=</span> arrayptr_free<span class="staexp"><span class="keyword">{</span>string<span class="keyword">}</span></span><span class="keyword">(</span>xs2<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">}</span></span> <span class="comment">(* end of [stringlst_concat] *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
string_explode
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">}</span></span><span class="keyword">(</span>x<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> lemma_string_param <span class="keyword">(</span>x<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">viewtypedef</span> <span class="staexp">res<span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">list_vt</span> <span class="keyword">(</span><span class="staexp">charNZ</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> loop
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>nat<span class="keyword">}</span></span> <span class="keyword">.&lt;</span><span class="staexp">n</span><span class="keyword">&gt;.</span>
<span class="keyword">(</span>
  x<span class="keyword">:</span> <span class="staexp">string</span> <span class="staexp">n</span><span class="keyword">,</span> res<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">ptr</span><span class="staexp">?</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">res</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> p <span class="keyword">=</span> string2ptr <span class="keyword">(</span>x<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> c <span class="keyword">=</span> $UN<span class="keyword">.</span>ptr1_get&lt;<span class="staexp">Char</span><span class="keyword">&gt;</span> <span class="keyword">(</span>p<span class="keyword">)</span></span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">if</span> c != CNUL <span class="keyword">then</span> <span class="keyword">let</span>
  <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span>
  __assert <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">where</span>
  <span class="keyword">{</span>
    <span class="keyword">extern</span> <span class="prfexp"><span class="keyword">praxi</span> __assert <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><span class="keyword">[</span>n <span class="keyword">&gt;</span> 0<span class="keyword">]</span></span> <span class="staexp">void</span></span>
  <span class="keyword">}</span></span> <span class="comment">(* prval *)</span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> res :=
    list_vt_cons<span class="staexp"><span class="keyword">{</span>charNZ<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>0<span class="keyword">}</span></span><span class="keyword">(</span>c<span class="keyword">,</span> _<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val+</span>list_vt_cons <span class="keyword">(</span>_<span class="keyword">,</span> res1<span class="keyword">)</span> <span class="keyword">=</span> res</span>
  <span class="dynexp"><span class="keyword">val</span> x <span class="keyword">=</span> $UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>string<span class="keyword">(</span>n-1<span class="keyword">)</span><span class="keyword">}</span></span><span class="keyword">(</span>ptr1_succ&lt;<span class="staexp">char</span><span class="keyword">&gt;</span><span class="keyword">(</span>p<span class="keyword">)</span><span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> loop <span class="keyword">(</span>x<span class="keyword">,</span> res1<span class="keyword">)</span></span>
<span class="keyword">in</span>
  <span class="keyword">fold@</span> <span class="keyword">(</span>res<span class="keyword">)</span>
<span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">let</span>
  <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span>
  __assert <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">where</span>
  <span class="keyword">{</span>
    <span class="keyword">extern</span> <span class="prfexp"><span class="keyword">praxi</span> __assert <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><span class="keyword">[</span>n == 0<span class="keyword">]</span></span> <span class="staexp">void</span></span>
  <span class="keyword">}</span></span> <span class="comment">(* [prval] *)</span>
<span class="keyword">in</span>
  res := list_vt_nil <span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [if]</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [loop]</span>
<span class="comment">//</span>
<span class="keyword">var</span> res<span class="keyword">:</span> <span class="staexp">ptr</span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">$effmask_wrt</span> <span class="keyword">(</span>loop <span class="keyword">(</span>x<span class="keyword">,</span> res<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  res
<span class="keyword">end</span></span> <span class="comment">// end of [string_explode]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
string_tabulate<span class="staexp"><span class="keyword">{</span>n<span class="keyword">}</span></span><span class="keyword">(</span>n<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> lemma_g1uint_param <span class="keyword">(</span>n<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> loop <span class="keyword">(</span>
  p<span class="keyword">:</span> <span class="staexp">ptr</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">size_t</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">if</span> i <span class="keyword">&lt;</span> n <span class="keyword">then</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> c <span class="keyword">=</span> string_tabulate$fopr <span class="keyword">(</span>i<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> $UN<span class="keyword">.</span>ptr0_set&lt;<span class="staexp">char</span><span class="keyword">&gt;</span> <span class="keyword">(</span>p<span class="keyword">,</span> c<span class="keyword">)</span></span>
<span class="keyword">in</span>
  loop <span class="keyword">(</span>ptr_succ&lt;<span class="staexp">char</span><span class="keyword">&gt;</span> <span class="keyword">(</span>p<span class="keyword">)</span><span class="keyword">,</span> n<span class="keyword">,</span> succ <span class="keyword">(</span>i<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span> <span class="keyword">else</span>
  $UN<span class="keyword">.</span>ptr0_set&lt;<span class="staexp">char</span><span class="keyword">&gt;</span> <span class="keyword">(</span>p<span class="keyword">,</span> CNUL<span class="keyword">)</span>
<span class="comment">// end of [if]</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [loop]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> n1 <span class="keyword">=</span> succ<span class="keyword">(</span>n<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pf</span><span class="keyword">,</span> <span class="prfexp">fpf</span> <span class="keyword">|</span> p0<span class="keyword">)</span> <span class="keyword">=</span> malloc_gc <span class="keyword">(</span>n1<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> loop <span class="keyword">(</span>p0<span class="keyword">,</span> n<span class="keyword">,</span> g1int2uint <span class="keyword">(</span><span class="dynexp">0</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  castvwtp_trans<span class="staexp"><span class="keyword">{</span>strnptr<span class="keyword">(</span>n<span class="keyword">)</span><span class="keyword">}</span></span><span class="keyword">(</span><span class="keyword">(</span><span class="prfexp">pf</span><span class="keyword">,</span> <span class="prfexp">fpf</span> <span class="keyword">|</span> p0<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [string_tabulate]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
string_tabulate_cloref
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">}</span></span><span class="keyword">(</span>n<span class="keyword">,</span> fopr<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
string_tabulate$fopr&lt;<span class="keyword">&gt;</span><span class="keyword">(</span>i<span class="keyword">)</span> <span class="keyword">=</span> fopr<span class="keyword">(</span>$UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>sizeLt<span class="keyword">(</span>n<span class="keyword">)</span><span class="keyword">}</span></span><span class="keyword">(</span>i<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  string_tabulate&lt;<span class="keyword">&gt;</span><span class="keyword">(</span>n<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [string_tabulate_cloref]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
string_forall
  <span class="keyword">(</span>str<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
loop
<span class="keyword">(</span>
  p<span class="keyword">:</span> <span class="staexp">ptr</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">bool</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> c0 <span class="keyword">=</span> $UN<span class="keyword">.</span>ptr0_get&lt;<span class="staexp">char</span><span class="keyword">&gt;</span><span class="keyword">(</span>p<span class="keyword">)</span></span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">if</span>
c0 <span class="keyword">=</span> CNUL
<span class="keyword">then</span> true <span class="keyword">else</span>
<span class="keyword">(</span>
  <span class="keyword">if</span> string_forall$pred<span class="keyword">(</span>c0<span class="keyword">)</span> <span class="keyword">then</span> loop<span class="keyword">(</span>ptr0_succ&lt;<span class="staexp">char</span><span class="keyword">&gt;</span><span class="keyword">(</span>p<span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">else</span> false
<span class="keyword">)</span> <span class="comment">(* end of [if] *)</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [loop]</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  loop<span class="keyword">(</span>string2ptr<span class="keyword">(</span>str<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [string_forall]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
string_iforall
  <span class="keyword">(</span>str<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
loop
<span class="keyword">(</span>
  i<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> p<span class="keyword">:</span> <span class="staexp">ptr</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">bool</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> c0 <span class="keyword">=</span> $UN<span class="keyword">.</span>ptr0_get&lt;<span class="staexp">char</span><span class="keyword">&gt;</span><span class="keyword">(</span>p<span class="keyword">)</span></span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">if</span>
c0 <span class="keyword">=</span> CNUL
<span class="keyword">then</span> true <span class="keyword">else</span>
<span class="keyword">(</span>
  <span class="keyword">if</span> string_iforall$pred<span class="keyword">(</span>i<span class="keyword">,</span> c0<span class="keyword">)</span> <span class="keyword">then</span> loop<span class="keyword">(</span>i+<span class="dynexp">1</span><span class="keyword">,</span> ptr0_succ&lt;<span class="staexp">char</span><span class="keyword">&gt;</span><span class="keyword">(</span>p<span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">else</span> false
<span class="keyword">)</span> <span class="comment">(* end of [if] *)</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [loop]</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  loop<span class="keyword">(</span><span class="dynexp">0</span><span class="keyword">,</span> string2ptr<span class="keyword">(</span>str<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [string_iforall]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">env</span><span class="keyword">}</span>
string_foreach$cont<span class="keyword">(</span>c<span class="keyword">,</span> env<span class="keyword">)</span> <span class="keyword">=</span> true</span>
<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">env</span><span class="keyword">}</span>
string_foreach$fwork<span class="keyword">(</span>c<span class="keyword">,</span> env<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span></span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
string_foreach<span class="keyword">(</span>str<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">var</span> env<span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">in</span> string_foreach_env<span class="keyword">(</span>str<span class="keyword">,</span> env<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [string_foreach]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">env</span><span class="keyword">}</span>
string_foreach_env
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">}</span></span><span class="keyword">(</span>str<span class="keyword">,</span> env<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> loop <span class="keyword">(</span>
  p<span class="keyword">:</span> <span class="staexp">ptr</span><span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">env</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">ptr</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> c <span class="keyword">=</span> $UN<span class="keyword">.</span>ptr0_get&lt;<span class="staexp">char</span><span class="keyword">&gt;</span> <span class="keyword">(</span>p<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> cont <span class="keyword">=</span> <span class="keyword">(</span>
    <span class="keyword">if</span> c != CNUL
      <span class="keyword">then</span> string_foreach$cont&lt;<span class="staexp">env</span><span class="keyword">&gt;</span> <span class="keyword">(</span>c<span class="keyword">,</span> env<span class="keyword">)</span> <span class="keyword">else</span> false
    <span class="comment">// end of [if]</span>
  <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">bool</span></span> <span class="comment">// end of [val]</span>
<span class="keyword">in</span>
  <span class="keyword">if</span> cont <span class="keyword">then</span> <span class="keyword">let</span>
    <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span>
      string_foreach$fwork&lt;<span class="staexp">env</span><span class="keyword">&gt;</span> <span class="keyword">(</span>c<span class="keyword">,</span> env<span class="keyword">)</span></span> <span class="keyword">in</span> loop<span class="keyword">(</span>ptr_succ&lt;<span class="staexp">char</span><span class="keyword">&gt;</span> <span class="keyword">(</span>p<span class="keyword">)</span><span class="keyword">,</span> env<span class="keyword">)</span>
    <span class="comment">// end of [val]</span>
  <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">(</span>p<span class="keyword">)</span> <span class="comment">// end of [if]</span>
<span class="keyword">end</span></span> <span class="comment">// end of [fun]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> p0 <span class="keyword">=</span>
  string2ptr <span class="keyword">(</span>str<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> p1 <span class="keyword">=</span> loop <span class="keyword">(</span>p0<span class="keyword">,</span> env<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  $UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>sizeLte<span class="keyword">(</span>n<span class="keyword">)</span><span class="keyword">}</span></span><span class="keyword">(</span>p1 - p0<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [string_foreach_env]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">env</span><span class="keyword">}</span>
string_rforeach$cont <span class="keyword">(</span>c<span class="keyword">,</span> env<span class="keyword">)</span> <span class="keyword">=</span> true</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">env</span><span class="keyword">}</span>
string_rforeach$fwork <span class="keyword">(</span>c<span class="keyword">,</span> env<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span></span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
string_rforeach<span class="keyword">(</span>str<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">var</span> env<span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">in</span> string_rforeach_env<span class="keyword">(</span>str<span class="keyword">,</span> env<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [string_rforeach]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">env</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
string_rforeach_env
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">}</span></span><span class="keyword">(</span>str<span class="keyword">,</span> env<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> loop
<span class="keyword">(</span>
  p0<span class="keyword">:</span> <span class="staexp">ptr</span><span class="keyword">,</span> p1<span class="keyword">:</span> <span class="staexp">ptr</span><span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">env</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">ptr</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">if</span>
<span class="keyword">(</span>p1 <span class="keyword">&gt;</span> p0<span class="keyword">)</span>
<span class="keyword">then</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> p2 <span class="keyword">=</span> ptr_pred&lt;<span class="staexp">char</span><span class="keyword">&gt;</span> <span class="keyword">(</span>p1<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> c2 <span class="keyword">=</span> $UN<span class="keyword">.</span>ptr0_get&lt;<span class="staexp">charNZ</span><span class="keyword">&gt;</span> <span class="keyword">(</span>p2<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> cont <span class="keyword">=</span>
    string_rforeach$cont&lt;<span class="staexp">env</span><span class="keyword">&gt;</span> <span class="keyword">(</span>c2<span class="keyword">,</span> env<span class="keyword">)</span></span>
  <span class="comment">// end of [val]</span>
<span class="keyword">in</span>
  <span class="keyword">if</span> cont
    <span class="keyword">then</span> <span class="keyword">let</span>
      <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span>
      string_rforeach$fwork&lt;<span class="staexp">env</span><span class="keyword">&gt;</span> <span class="keyword">(</span>c2<span class="keyword">,</span> env<span class="keyword">)</span></span>
    <span class="keyword">in</span>
      loop <span class="keyword">(</span>p0<span class="keyword">,</span> p2<span class="keyword">,</span> env<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [then]</span>
    <span class="keyword">else</span> <span class="keyword">(</span>p1<span class="keyword">)</span> <span class="comment">// end of [else]    </span>
<span class="keyword">end</span> <span class="comment">// end of [then]</span>
<span class="keyword">else</span> <span class="keyword">(</span>p1<span class="keyword">)</span> <span class="comment">// end of [else]</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [loop]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> p0 <span class="keyword">=</span> ptrcast<span class="keyword">(</span>str<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> p1 <span class="keyword">=</span> ptr_add&lt;<span class="staexp">char</span><span class="keyword">&gt;</span> <span class="keyword">(</span>p0<span class="keyword">,</span> length<span class="keyword">(</span>str<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  $UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>sizeLte<span class="keyword">(</span>n<span class="keyword">)</span><span class="keyword">}</span></span><span class="keyword">(</span>p1 - loop <span class="keyword">(</span>p0<span class="keyword">,</span> p1<span class="keyword">,</span> env<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [string_rforeach_env]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
streamize_string_char
  <span class="keyword">(</span>str<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="keyword">typedef</span> <span class="staexp">elt <span class="keyword">=</span> <span class="staexp">charNZ</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
auxmain
<span class="keyword">(</span>
  p<span class="keyword">:</span> <span class="staexp">ptr</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">elt</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="dynexp"><span class="keyword">$ldelay</span><span class="keyword">(</span>
<span class="comment">//</span>
<span class="keyword">let</span>
<span class="comment">//</span>
<span class="keyword">val</span> c0 <span class="keyword">=</span> $UN<span class="keyword">.</span>ptr0_get&lt;Char<span class="keyword">&gt;</span><span class="keyword">(</span>p<span class="keyword">)</span>
<span class="comment">//</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">if</span>
isneqz<span class="keyword">(</span>c0<span class="keyword">)</span>
<span class="keyword">then</span> <span class="keyword">(</span>
  stream_vt_cons<span class="keyword">(</span>c0<span class="keyword">,</span> auxmain<span class="keyword">(</span>ptr0_succ&lt;Char<span class="keyword">&gt;</span><span class="keyword">(</span>p<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">else</span> stream_vt_nil<span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span>
<span class="comment">//</span>
<span class="keyword">end</span> <span class="keyword">:</span> stream_vt_con<span class="keyword">(</span>elt<span class="keyword">)</span> <span class="comment">// end of [let]</span>
<span class="keyword">)</span></span></span> <span class="comment">(* end of [auxmain] *)</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  auxmain<span class="keyword">(</span>string2ptr<span class="keyword">(</span>str<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [streamize_string_char]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
//
// HX-2013-03: it is now defined as a macro
//
implement
stropt_none () = $UN.cast{stropt(~1)}(the_null_ptr)
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
stropt_is_none<span class="staexp"><span class="keyword">{</span>n<span class="keyword">}</span></span><span class="keyword">(</span>x<span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
  $UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>bool<span class="keyword">(</span>n <span class="keyword">&lt;</span> 0<span class="keyword">)</span><span class="keyword">}</span></span><span class="keyword">(</span>ptr0_is_null<span class="keyword">(</span>$UN<span class="keyword">.</span>cast2ptr<span class="keyword">(</span>x<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">)</span></span> <span class="comment">// end of [stropt_is_none]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
stropt_is_some<span class="staexp"><span class="keyword">{</span>n<span class="keyword">}</span></span><span class="keyword">(</span>x<span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
  $UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>bool<span class="keyword">(</span>n&gt;=0<span class="keyword">)</span><span class="keyword">}</span></span><span class="keyword">(</span>ptr0_isnot_null<span class="keyword">(</span>$UN<span class="keyword">.</span>cast2ptr<span class="keyword">(</span>x<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">)</span></span> <span class="comment">// end of [stropt_is_some]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
stropt_length <span class="keyword">(</span>x<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> lemma_stropt_param<span class="keyword">(</span>x<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">if</span>
stropt_is_some<span class="keyword">(</span>x<span class="keyword">)</span>
<span class="keyword">then</span> g1uint2int<span class="keyword">(</span>string1_length<span class="keyword">(</span>stropt_unsome<span class="keyword">(</span>x<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">else</span> i2ssz<span class="keyword">(</span><span class="keyword">~</span><span class="dynexp">1</span><span class="keyword">)</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [stropt_length]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span> fprint_val&lt;<span class="staexp">string</span><span class="keyword">&gt;</span> <span class="keyword">=</span> fprint_string</span>
<span class="dynexp"><span class="keyword">implement</span> fprint_val&lt;<span class="staexp">stropt</span><span class="keyword">&gt;</span> <span class="keyword">=</span> fprint_stropt</span>

<span class="comment">(* ****** ****** *)</span>

<span class="extcode"><span class="extcode">%{$
//
atstype_string
atspre_string_make_snprintf
(
  atstype_string fmt, ...
) {
  char *res ;
  va_list ap0 ;
//
  va_start(ap0, fmt) ;
//
// HX: [8] is kind of random
//
  res =
  atspre_string_make_vsnprintf(8, fmt, ap0) ;
//
  va_end(ap0) ;
//
  return (res) ;
//
} // end of [atspre_string_make_snprintf]
//
atstype_string
atspre_string_make_vsnprintf
(
  atstype_size bsz
, atstype_string fmt, va_list ap0
) {
//
  int ntot ;
  char *res ;
  va_list ap1 ;
//
  res = atspre_malloc_gc(bsz) ;
//
  va_copy(ap1, ap0) ;
  ntot = vsnprintf(res, bsz, (char*)fmt, ap1) ;
  va_end(ap1) ;
//
  if (ntot &gt;= bsz)
  {
    bsz = ntot + 1 ;
    res = atspre_realloc_gc(res, bsz) ;
    ntot = vsnprintf(res, bsz, (char*)fmt, ap0) ;
  }
//
  if (ntot &lt; 0) {
    atspre_mfree_gc(res) ; return (char*)0 ;
  }
//
  return (res) ;
//
} // end of [atspre_string_make_vsnprintf]
//
%}</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* end of [string.dats] *)</span>
</pre>
<pre class="patsyntax">
<span class="comment">(***********************************************************************)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(*                         Applied Type System                         *)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(***********************************************************************)</span>

<span class="comment">(*
** ATS/Postiats - Unleashing the Potential of Types!
** Copyright (C) 2010-2015 Hongwei Xi, ATS Trustful Software, Inc.
** All rights reserved
**
** ATS is free software;  you can  redistribute it and/or modify it under
** the terms of  the GNU GENERAL PUBLIC LICENSE (GPL) as published by the
** Free Software Foundation; either version 3, or (at  your  option)  any
** later version.
**
** ATS is distributed in the hope that it will be useful, but WITHOUT ANY
** WARRANTY; without  even  the  implied  warranty  of MERCHANTABILITY or
** FITNESS FOR A PARTICULAR PURPOSE.  See the  GNU General Public License
** for more details.
**
** You  should  have  received  a  copy of the GNU General Public License
** along  with  ATS;  see the  file COPYING.  If not, please write to the
** Free Software Foundation,  51 Franklin Street, Fifth Floor, Boston, MA
** 02110-1301, USA.
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
** Source:
** $PATSHOME/prelude/DATS/CODEGEN/strptr.atxt
** Time of generation: Sun Oct  2 10:33:54 2016
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* Author: Hongwei Xi *)</span>
<span class="comment">(* Authoremail: hwxi AT cs DOT bu DOT edu *)</span>
<span class="comment">(* Start time: April, 2012 *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="neuexp"><span class="keyword">#define</span> ATS_DYNLOADFLAG 0</span> <span class="comment">// no dynloading at run-time</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">staload</span> UN <span class="keyword">=</span> "prelude/SATS/unsafe.sats"

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">staload</span> _<span class="comment">(*anon*)</span> <span class="keyword">=</span> "prelude/DATS/integer.dats"

<span class="comment">(* ****** ****** *)</span>

<span class="neuexp"><span class="keyword">#define</span> CNUL '\000'</span>
<span class="neuexp"><span class="keyword">#define</span> nullp the_null_ptr</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">overload</span> + <span class="keyword">with</span> add_ptr_bsz</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
strptr_is_null<span class="keyword">(</span>str<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span>strptr2ptr <span class="keyword">(</span>str<span class="keyword">)</span> <span class="keyword">=</span> nullp<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
strptr_isnot_null<span class="keyword">(</span>str<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span>strptr2ptr <span class="keyword">(</span>str<span class="keyword">)</span> <span class="keyword">&gt;</span> nullp<span class="keyword">)</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
strptr_is_empty<span class="keyword">(</span>str<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> p <span class="keyword">=</span> strptr2ptr<span class="keyword">(</span>str<span class="keyword">)</span></span> <span class="keyword">in</span> $UN<span class="keyword">.</span>ptr1_get&lt;<span class="staexp">char</span><span class="keyword">&gt;</span><span class="keyword">(</span>p<span class="keyword">)</span> <span class="keyword">=</span> CNUL
<span class="keyword">end</span></span> <span class="comment">// end of [strptr_is_empty]</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
strptr_isnot_empty<span class="keyword">(</span>str<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> p <span class="keyword">=</span> strptr2ptr<span class="keyword">(</span>str<span class="keyword">)</span></span> <span class="keyword">in</span> $UN<span class="keyword">.</span>ptr1_get&lt;<span class="staexp">char</span><span class="keyword">&gt;</span><span class="keyword">(</span>p<span class="keyword">)</span> != CNUL
<span class="keyword">end</span></span> <span class="comment">// end of [strptr_isnot_empty]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
strnptr_get_at_size<span class="keyword">(</span>str<span class="keyword">,</span> i<span class="keyword">)</span> <span class="keyword">=</span>
  $UN<span class="keyword">.</span>ptr0_get&lt;<span class="staexp">charNZ</span><span class="keyword">&gt;</span><span class="keyword">(</span>strnptr2ptr<span class="keyword">(</span>str<span class="keyword">)</span>+i<span class="keyword">)</span></span>
<span class="comment">// end of [strnptr_get_at_size]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">tk</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
strnptr_get_at_gint<span class="keyword">(</span>str<span class="keyword">,</span> i<span class="keyword">)</span> <span class="keyword">=</span>
  strnptr_get_at_size<span class="keyword">(</span>str<span class="keyword">,</span> g1int2uint<span class="keyword">(</span>i<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">// end of [strnptr_get_at_gint]</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">tk</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
strnptr_get_at_guint<span class="keyword">(</span>str<span class="keyword">,</span> i<span class="keyword">)</span> <span class="keyword">=</span>
  strnptr_get_at_size<span class="keyword">(</span>str<span class="keyword">,</span> g1uint2uint<span class="keyword">(</span>i<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">// end of [strnptr_get_at_guint]</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
strnptr_set_at_size<span class="keyword">(</span>str<span class="keyword">,</span> i<span class="keyword">,</span> c<span class="keyword">)</span> <span class="keyword">=</span>
  $UN<span class="keyword">.</span>ptr0_set&lt;<span class="staexp">charNZ</span><span class="keyword">&gt;</span><span class="keyword">(</span>strnptr2ptr<span class="keyword">(</span>str<span class="keyword">)</span>+i<span class="keyword">,</span> c<span class="keyword">)</span></span>
<span class="comment">// end of [strnptr_set_at_size]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">tk</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
strnptr_set_at_gint<span class="keyword">(</span>str<span class="keyword">,</span> i<span class="keyword">,</span> c<span class="keyword">)</span> <span class="keyword">=</span>
  strnptr_set_at_size <span class="keyword">(</span>str<span class="keyword">,</span> g1int2uint<span class="keyword">(</span>i<span class="keyword">)</span><span class="keyword">,</span> c<span class="keyword">)</span></span>
<span class="comment">// end of [strnptr_set_at_gint]</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">tk</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
strnptr_set_at_guint<span class="keyword">(</span>str<span class="keyword">,</span> i<span class="keyword">,</span> c<span class="keyword">)</span> <span class="keyword">=</span>
  strnptr_set_at_size<span class="keyword">(</span>str<span class="keyword">,</span> g1uint2uint<span class="keyword">(</span>i<span class="keyword">)</span><span class="keyword">,</span> c<span class="keyword">)</span></span>
<span class="comment">// end of [strnptr_set_at_guint]</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
lt_strptr_strptr
  <span class="keyword">(</span>x1<span class="keyword">,</span> x2<span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
  compare_strptr_strptr<span class="keyword">(</span>x1<span class="keyword">,</span> x2<span class="keyword">)</span> <span class="keyword">&lt;</span> <span class="dynexp">0</span>
<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">implement</span>
lte_strptr_strptr
  <span class="keyword">(</span>x1<span class="keyword">,</span> x2<span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
  compare_strptr_strptr<span class="keyword">(</span>x1<span class="keyword">,</span> x2<span class="keyword">)</span> &lt;= <span class="dynexp">0</span>
<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">implement</span>
gt_strptr_strptr
  <span class="keyword">(</span>x1<span class="keyword">,</span> x2<span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
  compare_strptr_strptr<span class="keyword">(</span>x1<span class="keyword">,</span> x2<span class="keyword">)</span> <span class="keyword">&gt;</span> <span class="dynexp">0</span>
<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">implement</span>
gte_strptr_strptr
  <span class="keyword">(</span>x1<span class="keyword">,</span> x2<span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
  compare_strptr_strptr<span class="keyword">(</span>x1<span class="keyword">,</span> x2<span class="keyword">)</span> &gt;= <span class="dynexp">0</span>
<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">implement</span>
eq_strptr_strptr
  <span class="keyword">(</span>x1<span class="keyword">,</span> x2<span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
  compare_strptr_strptr<span class="keyword">(</span>x1<span class="keyword">,</span> x2<span class="keyword">)</span> <span class="keyword">=</span> <span class="dynexp">0</span>
<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">implement</span>
neq_strptr_strptr
  <span class="keyword">(</span>x1<span class="keyword">,</span> x2<span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
  compare_strptr_strptr<span class="keyword">(</span>x1<span class="keyword">,</span> x2<span class="keyword">)</span> != <span class="dynexp">0</span>
<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
//
// HX: implemented in [strptr.cats]
//
implement
print_strptr (x) = fprint_strptr (stdout_ref, x)
implement
prerr_strptr (x) = fprint_strptr (stderr_ref, x)
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
strnptr_is_null <span class="keyword">(</span>str<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span>strnptr2ptr <span class="keyword">(</span>str<span class="keyword">)</span> <span class="keyword">=</span> nullp<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
strnptr_isnot_null <span class="keyword">(</span>str<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span>strnptr2ptr <span class="keyword">(</span>str<span class="keyword">)</span> <span class="keyword">&gt;</span> nullp<span class="keyword">)</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
strptr_length<span class="keyword">(</span>x<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> isnot <span class="keyword">=</span> ptr_isnot_null<span class="keyword">(</span>strptr2ptr<span class="keyword">(</span>x<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">if</span> isnot
  <span class="keyword">then</span> g0u2i<span class="keyword">(</span>string_length<span class="keyword">(</span>$UN<span class="keyword">.</span>strptr2string<span class="keyword">(</span>x<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span>
  <span class="keyword">else</span> g0i2i<span class="keyword">(</span><span class="keyword">~</span><span class="dynexp">1</span><span class="keyword">)</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [strptr_length]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
strnptr_length<span class="keyword">(</span>x<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> lemma_strnptr_param <span class="keyword">(</span>x<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> isnot <span class="keyword">=</span> ptr_isnot_null<span class="keyword">(</span>strnptr2ptr<span class="keyword">(</span>x<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">if</span> isnot
  <span class="keyword">then</span> g1u2i<span class="keyword">(</span>string_length<span class="keyword">(</span>$UN<span class="keyword">.</span>strnptr2string<span class="keyword">(</span>x<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span>
  <span class="keyword">else</span> g1i2i<span class="keyword">(</span><span class="keyword">~</span><span class="dynexp">1</span><span class="keyword">)</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [strnptr_length]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
strptr0_copy<span class="keyword">(</span>x<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> isnot <span class="keyword">=</span> ptr_isnot_null<span class="keyword">(</span>strptr2ptr<span class="keyword">(</span>x<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">if</span> isnot
  <span class="keyword">then</span> string0_copy<span class="keyword">(</span>$UN<span class="keyword">.</span>strptr2string<span class="keyword">(</span>x<span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">else</span> strptr_null<span class="keyword">(</span><span class="keyword">)</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [strptr0_copy]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
strptr1_copy<span class="keyword">(</span>x<span class="keyword">)</span> <span class="keyword">=</span> string0_copy<span class="keyword">(</span>$UN<span class="keyword">.</span>strptr2string<span class="keyword">(</span>x<span class="keyword">)</span><span class="keyword">)</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
strnptr_copy
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">}</span></span><span class="keyword">(</span>x<span class="keyword">)</span> <span class="keyword">=</span> x2 <span class="keyword">where</span>
<span class="keyword">{</span>
  <span class="dynexp"><span class="keyword">val</span> x <span class="keyword">=</span> strnptr2ptr<span class="keyword">(</span>x<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> x <span class="keyword">=</span> $UN<span class="keyword">.</span>castvwtp0<span class="staexp"><span class="keyword">{</span>Strptr0<span class="keyword">}</span></span><span class="keyword">(</span>x<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> x2 <span class="keyword">=</span> $UN<span class="keyword">.</span>castvwtp0<span class="staexp"><span class="keyword">{</span>strnptr<span class="keyword">(</span>n<span class="keyword">)</span><span class="keyword">}</span></span><span class="keyword">(</span>strptr0_copy<span class="keyword">(</span>x<span class="keyword">)</span><span class="keyword">)</span></span>
  <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span> <span class="keyword">=</span> $UN<span class="keyword">.</span>cast2void<span class="keyword">(</span>x<span class="keyword">)</span></span>
<span class="keyword">}</span></span> <span class="comment">(* end of [strnptr_copy] *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
strptr_append
  <span class="keyword">(</span>x1<span class="keyword">,</span> x2<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span>
isnot1 <span class="keyword">=</span>
ptr_isnot_null<span class="keyword">(</span>strptr2ptr<span class="keyword">(</span>x1<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">if</span>
isnot1
<span class="keyword">then</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span>
isnot2 <span class="keyword">=</span>
ptr_isnot_null<span class="keyword">(</span>strptr2ptr<span class="keyword">(</span>x2<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">if</span> <span class="keyword">(</span>
isnot2
<span class="keyword">)</span> <span class="keyword">then</span> <span class="keyword">(</span>
  strnptr2strptr<span class="keyword">(</span>
    string1_append<span class="keyword">(</span>$UN<span class="keyword">.</span>strptr2string<span class="keyword">(</span>x1<span class="keyword">)</span><span class="keyword">,</span> $UN<span class="keyword">.</span>strptr2string<span class="keyword">(</span>x2<span class="keyword">)</span><span class="keyword">)</span>
  <span class="keyword">)</span> <span class="comment">(*strnptr2strptr*)</span>
<span class="keyword">)</span> <span class="keyword">else</span> strptr1_copy<span class="keyword">(</span>x1<span class="keyword">)</span>
<span class="comment">// end of [if]</span>
<span class="comment">//</span>
<span class="keyword">end</span> <span class="keyword">else</span>
<span class="keyword">(</span>
  strptr0_copy<span class="keyword">(</span>x2<span class="keyword">)</span>
<span class="keyword">)</span> <span class="comment">(* end of [if] *)</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [strptr_append]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
strptrlst_free <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> loop
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">List_vt</span><span class="keyword">(</span><span class="staexp">Strptr0</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">case+</span> xs <span class="keyword">of</span>
<span class="keyword">|</span> <span class="keyword">~</span>list_vt_cons
    <span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span>strptr_free <span class="keyword">(</span>x<span class="keyword">)</span><span class="keyword">;</span> loop <span class="keyword">(</span>xs<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">|</span> <span class="keyword">~</span>list_vt_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [loop]</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  <span class="keyword">$effmask_all</span> <span class="keyword">(</span>loop <span class="keyword">(</span>xs<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [strptrlst_free]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
strptrlst_concat <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> lemma_list_vt_param <span class="keyword">(</span>xs<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> loop
  <span class="staexp"><span class="keyword">{</span>n0<span class="keyword">:</span>nat<span class="keyword">}</span></span> <span class="keyword">.&lt;</span><span class="staexp">n0</span><span class="keyword">&gt;.</span>
<span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">Strptr0</span><span class="keyword">,</span> <span class="staexp">n0</span><span class="keyword">)</span><span class="staexp">&gt;&gt;</span><span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">Strptr1</span><span class="keyword">,</span> <span class="staexp">n1</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp"><span class="keyword">#[</span>n1<span class="keyword">:</span>nat <span class="keyword">|</span> n1 &lt;= n0<span class="keyword">]</span></span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">case+</span> xs <span class="keyword">of</span>
<span class="keyword">|</span> <span class="keyword">@</span>list_vt_cons
    <span class="keyword">(</span>x<span class="keyword">,</span> xs1<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
    <span class="dynexp"><span class="keyword">val</span> isnot <span class="keyword">=</span> strptr_isnot_null <span class="keyword">(</span>x<span class="keyword">)</span></span>
  <span class="keyword">in</span>
    <span class="keyword">if</span> isnot <span class="keyword">then</span> <span class="keyword">let</span>
      <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> loop <span class="keyword">(</span>xs1<span class="keyword">)</span></span>
      <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">fold@</span> <span class="keyword">(</span>xs<span class="keyword">)</span></span>
    <span class="dynexp"><span class="keyword">in</span>
      <span class="comment">// nothing</span>
    <span class="keyword">end</span></span> <span class="keyword">else</span> <span class="keyword">let</span>
      <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span>
        strptr_free_null <span class="keyword">(</span>x<span class="keyword">)</span></span>
      <span class="dynexp"><span class="keyword">val</span> xs1 <span class="keyword">=</span> xs1</span>
      <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">free@</span><span class="staexp"><span class="keyword">{</span><span class="keyword">..</span><span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>0<span class="keyword">}</span></span><span class="keyword">(</span>xs<span class="keyword">)</span></span>
      <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span>xs := xs1<span class="keyword">)</span></span>
    <span class="keyword">in</span>
      loop <span class="keyword">(</span>xs<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [if]</span>
  <span class="keyword">end</span> <span class="comment">// end of [list_vt_cons]</span>
<span class="keyword">|</span> <span class="keyword">@</span>list_vt_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">fold@</span> <span class="keyword">(</span>xs<span class="keyword">)</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [loop]</span>
<span class="comment">//</span>
<span class="keyword">var</span> xs <span class="keyword">=</span> xs
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> loop <span class="keyword">(</span>xs<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">case+</span> xs <span class="keyword">of</span>
<span class="keyword">|</span> <span class="keyword">~</span>list_vt_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> strptr_null <span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">|</span> <span class="keyword">~</span>list_vt_cons <span class="keyword">(</span>x<span class="keyword">,</span> <span class="keyword">~</span>list_vt_nil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> x
<span class="keyword">|</span> _ <span class="keyword">=&gt;</span> <span class="keyword">let</span>
    <span class="dynexp"><span class="keyword">val</span> res <span class="keyword">=</span>
      stringlst_concat <span class="keyword">(</span>$UN<span class="keyword">.</span>castvwtp1<span class="staexp"><span class="keyword">{</span>List<span class="keyword">(</span>string<span class="keyword">)</span><span class="keyword">}</span></span><span class="keyword">(</span>xs<span class="keyword">)</span><span class="keyword">)</span></span>
    <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span>
    loop <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">where</span> <span class="keyword">{</span>
      <span class="dynexp"><span class="keyword">fun</span> loop <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>nat<span class="keyword">}</span></span> <span class="keyword">.&lt;</span><span class="staexp">n</span><span class="keyword">&gt;.</span>
        <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">list_vt</span> <span class="keyword">(</span><span class="staexp">Strptr1</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span> <span class="keyword">=</span>
        <span class="keyword">case+</span> xs <span class="keyword">of</span>
        <span class="keyword">|</span> <span class="keyword">~</span>list_vt_cons <span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span>strptr_free <span class="keyword">(</span>x<span class="keyword">)</span><span class="keyword">;</span> loop <span class="keyword">(</span>xs<span class="keyword">)</span><span class="keyword">)</span>
        <span class="keyword">|</span> <span class="keyword">~</span>list_vt_nil <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span></span>
      <span class="comment">// end of [loop]</span>
    <span class="keyword">}</span></span> <span class="comment">// end of [where] // end of [val]</span>
  <span class="keyword">in</span>
    res
  <span class="keyword">end</span> <span class="comment">// end of [_]</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [strptrlst_concat]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">env</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
strnptr_foreach$cont <span class="keyword">(</span>c<span class="keyword">,</span> env<span class="keyword">)</span> <span class="keyword">=</span> true</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
strnptr_foreach <span class="keyword">(</span>str<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">var</span> env<span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">in</span> strnptr_foreach_env&lt;<span class="staexp">void</span><span class="keyword">&gt;</span> <span class="keyword">(</span>str<span class="keyword">,</span> env<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [strnptr_foreach]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">env</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
strnptr_foreach_env
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">}</span></span><span class="keyword">(</span>str<span class="keyword">,</span> env<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> loop
<span class="keyword">(</span>
  p<span class="keyword">:</span> <span class="staexp">ptr</span><span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">env</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">ptr</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="neuexp"><span class="keyword">#define</span> NUL '\000'</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> c <span class="keyword">=</span> $UN<span class="keyword">.</span>ptr0_get&lt;<span class="staexp">Char</span><span class="keyword">&gt;</span> <span class="keyword">(</span>p<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">if</span>
<span class="keyword">(</span>c != NUL<span class="keyword">)</span>
<span class="keyword">then</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pf</span><span class="keyword">,</span> <span class="prfexp">fpf</span> <span class="keyword">|</span> p<span class="keyword">)</span> <span class="keyword">=</span>
    $UN<span class="keyword">.</span>ptr0_vtake<span class="staexp"><span class="keyword">{</span>charNZ<span class="keyword">}</span></span><span class="keyword">(</span>p<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> cont <span class="keyword">=</span>
    strnptr_foreach$cont&lt;<span class="staexp">env</span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="keyword">!</span>p<span class="keyword">,</span> env<span class="keyword">)</span></span>
  <span class="comment">// end of [val]</span>
<span class="keyword">in</span>
  <span class="keyword">if</span> cont
    <span class="keyword">then</span> <span class="keyword">let</span>
      <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span>
      strnptr_foreach$fwork&lt;<span class="staexp">env</span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="keyword">!</span>p<span class="keyword">,</span> env<span class="keyword">)</span></span>
      <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span> <span class="keyword">=</span> fpf <span class="keyword">(</span>pf<span class="keyword">)</span></span>
    <span class="keyword">in</span>
      loop <span class="keyword">(</span>ptr_succ&lt;<span class="staexp">char</span><span class="keyword">&gt;</span> <span class="keyword">(</span>p<span class="keyword">)</span><span class="keyword">,</span> env<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [then]</span>
    <span class="keyword">else</span> <span class="keyword">let</span>
      <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span> <span class="keyword">=</span> fpf <span class="keyword">(</span>pf<span class="keyword">)</span></span> <span class="keyword">in</span> <span class="keyword">(</span>p<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [else]    </span>
<span class="keyword">end</span> <span class="comment">// end of [then]</span>
<span class="keyword">else</span> <span class="keyword">(</span>p<span class="keyword">)</span> <span class="comment">// end of [else]</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [loop]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> p0 <span class="keyword">=</span> ptrcast<span class="keyword">(</span>str<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  $UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>sizeLte<span class="keyword">(</span>n<span class="keyword">)</span><span class="keyword">}</span></span><span class="keyword">(</span>loop <span class="keyword">(</span>p0<span class="keyword">,</span> env<span class="keyword">)</span> - p0<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [strnptr_foreach_env]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">env</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
strnptr_rforeach$cont <span class="keyword">(</span>c<span class="keyword">,</span> env<span class="keyword">)</span> <span class="keyword">=</span> true</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
strnptr_rforeach
  <span class="keyword">(</span>str<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="keyword">var</span> env<span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">)</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  strnptr_rforeach_env&lt;<span class="staexp">void</span><span class="keyword">&gt;</span> <span class="keyword">(</span>str<span class="keyword">,</span> env<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [strnptr_rforeach]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">env</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
strnptr_rforeach_env
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">}</span></span><span class="keyword">(</span>str<span class="keyword">,</span> env<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> loop
<span class="keyword">(</span>
  p0<span class="keyword">:</span> <span class="staexp">ptr</span><span class="keyword">,</span> p1<span class="keyword">:</span> <span class="staexp">ptr</span><span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">env</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">ptr</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">if</span>
<span class="keyword">(</span>p1 <span class="keyword">&gt;</span> p0<span class="keyword">)</span>
<span class="keyword">then</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> p2 <span class="keyword">=</span> ptr_pred&lt;<span class="staexp">char</span><span class="keyword">&gt;</span> <span class="keyword">(</span>p1<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pf</span><span class="keyword">,</span> <span class="prfexp">fpf</span> <span class="keyword">|</span> p2<span class="keyword">)</span> <span class="keyword">=</span>
    $UN<span class="keyword">.</span>ptr0_vtake<span class="staexp"><span class="keyword">{</span>charNZ<span class="keyword">}</span></span><span class="keyword">(</span>p2<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> cont <span class="keyword">=</span>
    strnptr_rforeach$cont&lt;<span class="staexp">env</span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="keyword">!</span>p2<span class="keyword">,</span> env<span class="keyword">)</span></span>
  <span class="comment">// end of [val]</span>
<span class="keyword">in</span>
  <span class="keyword">if</span> cont
    <span class="keyword">then</span> <span class="keyword">let</span>
      <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span>
      strnptr_rforeach$fwork&lt;<span class="staexp">env</span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="keyword">!</span>p2<span class="keyword">,</span> env<span class="keyword">)</span></span>
      <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span> <span class="keyword">=</span> fpf <span class="keyword">(</span>pf<span class="keyword">)</span></span>
    <span class="keyword">in</span>
      loop <span class="keyword">(</span>p0<span class="keyword">,</span> p2<span class="keyword">,</span> env<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [then]</span>
    <span class="keyword">else</span> <span class="keyword">let</span>
      <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span> <span class="keyword">=</span> fpf <span class="keyword">(</span>pf<span class="keyword">)</span></span> <span class="keyword">in</span> <span class="keyword">(</span>p1<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [else]    </span>
<span class="keyword">end</span> <span class="comment">// end of [then]</span>
<span class="keyword">else</span> <span class="keyword">(</span>p1<span class="keyword">)</span> <span class="comment">// end of [else]</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [loop]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> p0 <span class="keyword">=</span> ptrcast<span class="keyword">(</span>str<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> p1 <span class="keyword">=</span> ptr_add&lt;<span class="staexp">char</span><span class="keyword">&gt;</span> <span class="keyword">(</span>p0<span class="keyword">,</span> length<span class="keyword">(</span>str<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  $UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>sizeLte<span class="keyword">(</span>n<span class="keyword">)</span><span class="keyword">}</span></span><span class="keyword">(</span>p1 - loop <span class="keyword">(</span>p0<span class="keyword">,</span> p1<span class="keyword">,</span> env<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [strnptr_rforeach_env]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* end of [strptr.dats] *)</span>
</pre>
<pre class="patsyntax">
<span class="comment">(***********************************************************************)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(*                         Applied Type System                         *)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(***********************************************************************)</span>

<span class="comment">(*
** ATS/Postiats - Unleashing the Potential of Types!
** Copyright (C) 2010-2015 Hongwei Xi, ATS Trustful Software, Inc.
** All rights reserved
**
** ATS is free software;  you can  redistribute it and/or modify it under
** the terms of  the GNU GENERAL PUBLIC LICENSE (GPL) as published by the
** Free Software Foundation; either version 3, or (at  your  option)  any
** later version.
**
** ATS is distributed in the hope that it will be useful, but WITHOUT ANY
** WARRANTY; without  even  the  implied  warranty  of MERCHANTABILITY or
** FITNESS FOR A PARTICULAR PURPOSE.  See the  GNU General Public License
** for more details.
**
** You  should  have  received  a  copy of the GNU General Public License
** along  with  ATS;  see the  file COPYING.  If not, please write to the
** Free Software Foundation,  51 Franklin Street, Fifth Floor, Boston, MA
** 02110-1301, USA.
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
** Source:
** $PATSHOME/prelude/DATS/CODEGEN/unsafe.atxt
** Time of generation: Sun Oct  2 10:33:56 2016
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* Author: Hongwei Xi *)</span>
<span class="comment">(* Authoremail: hwxi AT cs DOT bu DOT edu *)</span>
<span class="comment">(* Start time: April, 2012 *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">staload</span> "prelude/SATS/unsafe.sats"

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
int2ptr<span class="keyword">(</span>i<span class="keyword">)</span> <span class="keyword">=</span> cast<span class="staexp"><span class="keyword">{</span>ptr<span class="keyword">}</span></span><span class="keyword">(</span>cast<span class="staexp"><span class="keyword">{</span>intptr<span class="keyword">}</span></span><span class="keyword">(</span>i<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
ptr2int<span class="keyword">(</span>p<span class="keyword">)</span> <span class="keyword">=</span> cast<span class="staexp"><span class="keyword">{</span>int<span class="keyword">}</span></span><span class="keyword">(</span>cast<span class="staexp"><span class="keyword">{</span>intptr<span class="keyword">}</span></span><span class="keyword">(</span>p<span class="keyword">)</span><span class="keyword">)</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
ptr0_get
  <span class="keyword">(</span>p<span class="keyword">)</span> <span class="keyword">=</span> x <span class="keyword">where</span> <span class="keyword">{</span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">[</span><span class="staexp">l<span class="keyword">:</span>addr</span><span class="keyword">]</span>
    p <span class="keyword">=</span> g1ofg0_ptr<span class="keyword">(</span>p<span class="keyword">)</span></span>
  <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span>pf<span class="keyword">,</span> fpf<span class="keyword">)</span> <span class="keyword">=</span> __assert <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">where</span> <span class="keyword">{</span>
    <span class="keyword">extern</span> <span class="prfexp"><span class="keyword">praxi</span> __assert <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">a</span> <span class="staexp"><span class="keyword">@</span></span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">a</span><span class="staexp">?</span> <span class="staexp"><span class="keyword">@</span></span> <span class="staexp">l</span> <span class="keyword">-&lt;</span><span class="staexp">lin</span><span class="keyword">,</span><span class="staexp">prf</span><span class="keyword">&gt;</span> <span class="staexp">void</span><span class="keyword">)</span></span>
  <span class="keyword">}</span></span> <span class="comment">// end of [prval]</span>
  <span class="dynexp"><span class="keyword">val</span> x <span class="keyword">=</span> <span class="keyword">!</span>p</span>
  <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fpf <span class="keyword">(</span>pf<span class="keyword">)</span></span>
<span class="keyword">}</span></span> <span class="comment">// end of [ptr0_get]</span>

<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span> ptr1_get <span class="keyword">=</span> ptr0_get&lt;<span class="staexp">a</span><span class="keyword">&gt;</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
ptr0_set
  <span class="keyword">(</span>p<span class="keyword">,</span> x<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">where</span> <span class="keyword">{</span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">[</span><span class="staexp">l<span class="keyword">:</span>addr</span><span class="keyword">]</span>
    p <span class="keyword">=</span> g1ofg0_ptr<span class="keyword">(</span>p<span class="keyword">)</span></span>
  <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span>pf<span class="keyword">,</span> fpf<span class="keyword">)</span> <span class="keyword">=</span> __assert <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">where</span> <span class="keyword">{</span>
    <span class="keyword">extern</span> <span class="prfexp"><span class="keyword">praxi</span> __assert <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">a</span><span class="staexp">?</span> <span class="staexp"><span class="keyword">@</span></span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">a</span> <span class="staexp"><span class="keyword">@</span></span> <span class="staexp">l</span> <span class="keyword">-&lt;</span><span class="staexp">lin</span><span class="keyword">,</span><span class="staexp">prf</span><span class="keyword">&gt;</span> <span class="staexp">void</span><span class="keyword">)</span></span>
  <span class="keyword">}</span></span> <span class="comment">// end of [prval]</span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">!</span>p := x</span>
  <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fpf <span class="keyword">(</span>pf<span class="keyword">)</span></span>
<span class="keyword">}</span></span> <span class="comment">// end of [ptr0_set]</span>

<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span> ptr1_set <span class="keyword">=</span> ptr0_set&lt;<span class="staexp">a</span><span class="keyword">&gt;</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
ptr0_exch
  <span class="keyword">(</span>p<span class="keyword">,</span> x<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">where</span> <span class="keyword">{</span>
  <span class="dynexp"><span class="keyword">val</span> p <span class="keyword">=</span> g1ofg0_ptr<span class="keyword">(</span>p<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pf</span><span class="keyword">,</span> <span class="prfexp">fpf</span> <span class="keyword">|</span> p<span class="keyword">)</span> <span class="keyword">=</span> ptr_vtake<span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="keyword">(</span>p<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> tmp <span class="keyword">=</span> <span class="keyword">!</span>p</span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span> <span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">!</span>p := x</span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span> <span class="keyword">)</span> <span class="keyword">=</span> x := tmp</span>
  <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fpf <span class="keyword">(</span>pf<span class="keyword">)</span></span>
<span class="keyword">}</span></span> <span class="comment">// end of [ptr0_exch]</span>

<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span> ptr1_exch <span class="keyword">=</span> ptr0_exch&lt;<span class="staexp">a</span><span class="keyword">&gt;</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
ptr0_intch
  <span class="keyword">(</span>p1<span class="keyword">,</span> p2<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">where</span> <span class="keyword">{</span>
  <span class="dynexp"><span class="keyword">val</span> p1 <span class="keyword">=</span> g1ofg0_ptr<span class="keyword">(</span>p1<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> p2 <span class="keyword">=</span> g1ofg0_ptr<span class="keyword">(</span>p2<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pf1</span><span class="keyword">,</span> <span class="prfexp">fpf1</span> <span class="keyword">|</span> p1<span class="keyword">)</span> <span class="keyword">=</span> ptr_vtake<span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="keyword">(</span>p1<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pf2</span><span class="keyword">,</span> <span class="prfexp">fpf2</span> <span class="keyword">|</span> p2<span class="keyword">)</span> <span class="keyword">=</span> ptr_vtake<span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="keyword">(</span>p2<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> tmp <span class="keyword">=</span> <span class="keyword">!</span>p1</span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span> <span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">!</span>p1 := <span class="keyword">!</span>p2</span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span> <span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">!</span>p2 := tmp</span>
  <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fpf1 <span class="keyword">(</span>pf1<span class="keyword">)</span></span>
  <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fpf2 <span class="keyword">(</span>pf2<span class="keyword">)</span></span>
<span class="keyword">}</span></span> <span class="comment">(* end of [ptr0_intch] *)</span>

<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span> ptr1_intch <span class="keyword">=</span> ptr0_intch&lt;<span class="staexp">a</span><span class="keyword">&gt;</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
ptr0_getinc<span class="keyword">(</span>p0<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> p <span class="keyword">=</span> p0</span>
  <span class="dynexp"><span class="keyword">val</span> x <span class="keyword">=</span> ptr0_get&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>p<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> p0 := ptr_succ&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>p<span class="keyword">)</span></span> <span class="keyword">in</span> <span class="keyword">(</span>x<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [ptr0_getinc]</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
ptr1_getinc<span class="keyword">(</span>p0<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> p <span class="keyword">=</span> p0</span>
  <span class="dynexp"><span class="keyword">val</span> x <span class="keyword">=</span> ptr0_get&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>p<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> p0 := ptr_succ&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>p<span class="keyword">)</span></span> <span class="keyword">in</span> <span class="keyword">(</span>x<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [ptr1_getinc]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
ptr0_setinc<span class="keyword">(</span>p0<span class="keyword">,</span> x<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> p <span class="keyword">=</span> p0</span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> ptr0_set&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>p<span class="keyword">,</span> x<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> p0 := ptr_succ&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>p<span class="keyword">)</span></span> <span class="dynexp"><span class="keyword">in</span> <span class="comment">(*void*)</span>
<span class="keyword">end</span></span></span> <span class="comment">// end of [ptr0_setinc]</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
ptr1_setinc<span class="keyword">(</span>p0<span class="keyword">,</span> x<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> p <span class="keyword">=</span> p0</span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> ptr0_set&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>p<span class="keyword">,</span> x<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> p0 := ptr_succ&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>p<span class="keyword">)</span></span> <span class="dynexp"><span class="keyword">in</span> <span class="comment">(*void*)</span>
<span class="keyword">end</span></span></span> <span class="comment">// end of [ptr1_setinc]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
ptr0_get_at_int <span class="keyword">(</span>p<span class="keyword">,</span> i<span class="keyword">)</span> <span class="keyword">=</span>
  ptr0_get&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>ptr0_add_gint&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>p<span class="keyword">,</span> i<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
ptr0_set_at_int <span class="keyword">(</span>p<span class="keyword">,</span> i<span class="keyword">,</span> x<span class="keyword">)</span> <span class="keyword">=</span>
  ptr0_set&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>ptr0_add_gint&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>p<span class="keyword">,</span> i<span class="keyword">)</span><span class="keyword">,</span> x<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
ptr0_get_at_size <span class="keyword">(</span>p<span class="keyword">,</span> i<span class="keyword">)</span> <span class="keyword">=</span>
  ptr0_get&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>ptr0_add_guint&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>p<span class="keyword">,</span> i<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
ptr0_set_at_size <span class="keyword">(</span>p<span class="keyword">,</span> i<span class="keyword">,</span> x<span class="keyword">)</span> <span class="keyword">=</span>
  ptr0_set&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>ptr0_add_guint&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>p<span class="keyword">,</span> i<span class="keyword">)</span><span class="keyword">,</span> x<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span>
cptr_get <span class="keyword">(</span>p<span class="keyword">)</span> <span class="keyword">=</span> ptr1_get&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>cptr2ptr<span class="keyword">(</span>p<span class="keyword">)</span><span class="keyword">)</span></span>

<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span>
cptr_set <span class="keyword">(</span>p<span class="keyword">,</span> x<span class="keyword">)</span> <span class="keyword">=</span> ptr1_set&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>cptr2ptr<span class="keyword">(</span>p<span class="keyword">)</span><span class="keyword">,</span> x<span class="keyword">)</span></span>

<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span>
cptr_exch <span class="keyword">(</span>p<span class="keyword">,</span> x<span class="keyword">)</span> <span class="keyword">=</span> ptr1_exch&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>cptr2ptr<span class="keyword">(</span>p<span class="keyword">)</span><span class="keyword">,</span> x<span class="keyword">)</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span>
ptr0_addby <span class="keyword">(</span>p<span class="keyword">,</span> x<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> x0 <span class="keyword">=</span> ptr0_get&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>p<span class="keyword">)</span></span> <span class="keyword">in</span> ptr0_set&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>p<span class="keyword">,</span> gadd_val_val&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>x0<span class="keyword">,</span> x<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [ptr0_addby]</span>
<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span> ptr1_addby <span class="keyword">=</span> ptr0_addby&lt;<span class="staexp">a</span><span class="keyword">&gt;</span></span>

<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span>
ptr0_subby <span class="keyword">(</span>p<span class="keyword">,</span> x<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> x0 <span class="keyword">=</span> ptr0_get&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>p<span class="keyword">)</span></span> <span class="keyword">in</span> ptr0_set&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>p<span class="keyword">,</span> gsub_val_val&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>x0<span class="keyword">,</span> x<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [ptr0_subby]</span>
<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span> ptr1_subby <span class="keyword">=</span> ptr0_subby&lt;<span class="staexp">a</span><span class="keyword">&gt;</span></span>

<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span>
ptr0_mulby <span class="keyword">(</span>p<span class="keyword">,</span> x<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> x0 <span class="keyword">=</span> ptr0_get&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>p<span class="keyword">)</span></span> <span class="keyword">in</span> ptr0_set&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>p<span class="keyword">,</span> gmul_val_val&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>x0<span class="keyword">,</span> x<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [ptr0_mulby]</span>
<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span> ptr1_mulby <span class="keyword">=</span> ptr0_mulby&lt;<span class="staexp">a</span><span class="keyword">&gt;</span></span>

<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span>
ptr0_divby <span class="keyword">(</span>p<span class="keyword">,</span> x<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> x0 <span class="keyword">=</span> ptr0_get&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>p<span class="keyword">)</span></span> <span class="keyword">in</span> ptr0_set&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>p<span class="keyword">,</span> gdiv_val_val&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>x0<span class="keyword">,</span> x<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [ptr0_divby]</span>
<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span> ptr1_divby <span class="keyword">=</span> ptr0_divby&lt;<span class="staexp">a</span><span class="keyword">&gt;</span></span>

<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span>
ptr0_modby <span class="keyword">(</span>p<span class="keyword">,</span> x<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> x0 <span class="keyword">=</span> ptr0_get&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>p<span class="keyword">)</span></span> <span class="keyword">in</span> ptr0_set&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>p<span class="keyword">,</span> gmod_val_val&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>x0<span class="keyword">,</span> x<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [ptr0_modby]</span>
<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span> ptr1_modby <span class="keyword">=</span> ptr0_modby&lt;<span class="staexp">a</span><span class="keyword">&gt;</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span>
ptr1_list_next
  <span class="keyword">(</span>p<span class="keyword">)</span> <span class="keyword">=</span> p_next <span class="keyword">where</span>
<span class="keyword">{</span>
  <span class="dynexp"><span class="keyword">val</span> xs <span class="keyword">=</span>
  castvwtp1<span class="staexp"><span class="keyword">{</span>list_vt<span class="keyword">(</span>a<span class="keyword">,</span>1<span class="keyword">)</span><span class="keyword">}</span></span><span class="keyword">(</span>p<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val+</span><span class="keyword">@</span>list_vt_cons<span class="keyword">(</span>_<span class="keyword">,</span> xs_next<span class="keyword">)</span> <span class="keyword">=</span> xs</span>
  <span class="dynexp"><span class="keyword">val</span> p_next <span class="keyword">=</span> <span class="dynexp"><span class="keyword">addr@</span></span><span class="keyword">(</span>xs_next<span class="keyword">)</span></span>
  <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">fold@</span> <span class="keyword">(</span>xs<span class="keyword">)</span></span>
  <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span> <span class="keyword">=</span> cast2void <span class="keyword">(</span>xs<span class="keyword">)</span></span>
<span class="keyword">}</span></span> <span class="comment">(* end of [ptr1_list_next] *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* end of [unsafe.dats] *)</span>
</pre>
<pre class="patsyntax">
<span class="comment">(***********************************************************************)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(*                         Applied Type System                         *)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(***********************************************************************)</span>

<span class="comment">(*
** ATS/Postiats - Unleashing the Potential of Types!
** Copyright (C) 2010-2015 Hongwei Xi, ATS Trustful Software, Inc.
** All rights reserved
**
** ATS is free software;  you can  redistribute it and/or modify it under
** the terms of  the GNU GENERAL PUBLIC LICENSE (GPL) as published by the
** Free Software Foundation; either version 3, or (at  your  option)  any
** later version.
**
** ATS is distributed in the hope that it will be useful, but WITHOUT ANY
** WARRANTY; without  even  the  implied  warranty  of MERCHANTABILITY or
** FITNESS FOR A PARTICULAR PURPOSE.  See the  GNU General Public License
** for more details.
**
** You  should  have  received  a  copy of the GNU General Public License
** along  with  ATS;  see the  file COPYING.  If not, please write to the
** Free Software Foundation,  51 Franklin Street, Fifth Floor, Boston, MA
** 02110-1301, USA.
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
** Source:
** $PATSHOME/prelude/DATS/CODEGEN/checkast.atxt
** Time of generation: Sun Oct  2 10:33:56 2016
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* Author: Hongwei Xi *)</span>
<span class="comment">(* Authoremail: gmhwxiATgmailDOTcom *)</span>
<span class="comment">(* Start time: December, 2013 *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">staload</span>
UN <span class="keyword">=</span> "prelude/SATS/unsafe.sats"

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
staload "prelude/SATS/checkast.sats"
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">tk</span><span class="keyword">}</span>
checkast_gintLt
  <span class="keyword">(</span>x<span class="keyword">,</span> i<span class="keyword">,</span> errmsg<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> x <span class="keyword">=</span> g1ofg0_int<span class="keyword">(</span>x<span class="keyword">)</span></span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">if</span> x <span class="keyword">&lt;</span> i
  <span class="keyword">then</span> <span class="keyword">(</span>x<span class="keyword">)</span>
  <span class="keyword">else</span> <span class="keyword">let</span>
    <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span>
      <span class="dynexp">fprint!</span> <span class="keyword">(</span>stderr_ref<span class="keyword">,</span> <span class="dynstr">"exit(ATS): "</span><span class="keyword">,</span> errmsg<span class="keyword">)</span></span> <span class="keyword">in</span> exit<span class="keyword">(</span><span class="dynexp">1</span><span class="keyword">)</span>
    <span class="comment">// end of [val]</span>
  <span class="keyword">end</span> <span class="comment">// end of [else]</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [checkast_gintLt]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">tk</span><span class="keyword">}</span>
checkast_gintLte
  <span class="keyword">(</span>x<span class="keyword">,</span> i<span class="keyword">,</span> errmsg<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> x <span class="keyword">=</span> g1ofg0_int<span class="keyword">(</span>x<span class="keyword">)</span></span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">if</span> x &lt;= i
  <span class="keyword">then</span> <span class="keyword">(</span>x<span class="keyword">)</span>
  <span class="keyword">else</span> <span class="keyword">let</span>
    <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span>
      <span class="dynexp">fprint!</span> <span class="keyword">(</span>stderr_ref<span class="keyword">,</span> <span class="dynstr">"exit(ATS): "</span><span class="keyword">,</span> errmsg<span class="keyword">)</span></span> <span class="keyword">in</span> exit<span class="keyword">(</span><span class="dynexp">1</span><span class="keyword">)</span>
    <span class="comment">// end of [val]</span>
  <span class="keyword">end</span> <span class="comment">// end of [else]</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [checkast_gintLte]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">tk</span><span class="keyword">}</span>
checkast_gintGt
  <span class="keyword">(</span>x<span class="keyword">,</span> i<span class="keyword">,</span> errmsg<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> x <span class="keyword">=</span> g1ofg0_int<span class="keyword">(</span>x<span class="keyword">)</span></span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">if</span> x <span class="keyword">&gt;</span> i
  <span class="keyword">then</span> <span class="keyword">(</span>x<span class="keyword">)</span>
  <span class="keyword">else</span> <span class="keyword">let</span>
    <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span>
      <span class="dynexp">fprint!</span> <span class="keyword">(</span>stderr_ref<span class="keyword">,</span> <span class="dynstr">"exit(ATS): "</span><span class="keyword">,</span> errmsg<span class="keyword">)</span></span> <span class="keyword">in</span> exit<span class="keyword">(</span><span class="dynexp">1</span><span class="keyword">)</span>
    <span class="comment">// end of [val]</span>
  <span class="keyword">end</span> <span class="comment">// end of [else]</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [checkast_gintGt]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">tk</span><span class="keyword">}</span>
checkast_gintGte
  <span class="keyword">(</span>x<span class="keyword">,</span> i<span class="keyword">,</span> errmsg<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> x <span class="keyword">=</span> g1ofg0_int<span class="keyword">(</span>x<span class="keyword">)</span></span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">if</span> x &gt;= i
  <span class="keyword">then</span> <span class="keyword">(</span>x<span class="keyword">)</span>
  <span class="keyword">else</span> <span class="keyword">let</span>
    <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span>
      <span class="dynexp">fprint!</span> <span class="keyword">(</span>stderr_ref<span class="keyword">,</span> <span class="dynstr">"exit(ATS): "</span><span class="keyword">,</span> errmsg<span class="keyword">)</span></span> <span class="keyword">in</span> exit<span class="keyword">(</span><span class="dynexp">1</span><span class="keyword">)</span>
    <span class="comment">// end of [val]</span>
  <span class="keyword">end</span> <span class="comment">// end of [else]</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [checkast_gintGte]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">tk</span><span class="keyword">}</span>
checkast_gintBtw
  <span class="keyword">(</span>x<span class="keyword">,</span> i<span class="keyword">,</span> j<span class="keyword">,</span> errmsg<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> x <span class="keyword">=</span> g1ofg0_int<span class="keyword">(</span>x<span class="keyword">)</span></span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">if</span> x &gt;= i
  <span class="keyword">then</span>
    <span class="keyword">if</span> x <span class="keyword">&lt;</span> j <span class="keyword">then</span> <span class="keyword">(</span>x<span class="keyword">)</span>
    <span class="keyword">else</span> <span class="keyword">let</span>
      <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span>
      <span class="dynexp">fprint!</span> <span class="keyword">(</span>stderr_ref<span class="keyword">,</span> <span class="dynstr">"exit(ATS): "</span><span class="keyword">,</span> errmsg<span class="keyword">)</span></span> <span class="keyword">in</span> exit<span class="keyword">(</span><span class="dynexp">1</span><span class="keyword">)</span>
      <span class="comment">// end of [val]</span>
    <span class="keyword">end</span> <span class="comment">// end of [else]</span>
  <span class="keyword">else</span> <span class="keyword">let</span>
    <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span>
      <span class="dynexp">fprint!</span> <span class="keyword">(</span>stderr_ref<span class="keyword">,</span> <span class="dynstr">"exit(ATS): "</span><span class="keyword">,</span> errmsg<span class="keyword">)</span></span> <span class="keyword">in</span> exit<span class="keyword">(</span><span class="dynexp">1</span><span class="keyword">)</span>
    <span class="comment">// end of [val]</span>
  <span class="keyword">end</span> <span class="comment">// end of [else]</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [checkast_gintBtw]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">tk</span><span class="keyword">}</span>
checkast_gintBtwe
  <span class="keyword">(</span>x<span class="keyword">,</span> i<span class="keyword">,</span> j<span class="keyword">,</span> errmsg<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> x <span class="keyword">=</span> g1ofg0_int<span class="keyword">(</span>x<span class="keyword">)</span></span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">if</span> x &gt;= i
  <span class="keyword">then</span>
    <span class="keyword">if</span> x &lt;= j <span class="keyword">then</span> <span class="keyword">(</span>x<span class="keyword">)</span>
    <span class="keyword">else</span> <span class="keyword">let</span>
      <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span>
      <span class="dynexp">fprint!</span> <span class="keyword">(</span>stderr_ref<span class="keyword">,</span> <span class="dynstr">"exit(ATS): "</span><span class="keyword">,</span> errmsg<span class="keyword">)</span></span> <span class="keyword">in</span> exit<span class="keyword">(</span><span class="dynexp">1</span><span class="keyword">)</span>
      <span class="comment">// end of [val]</span>
    <span class="keyword">end</span> <span class="comment">// end of [else]</span>
  <span class="keyword">else</span> <span class="keyword">let</span>
    <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span>
      <span class="dynexp">fprint!</span> <span class="keyword">(</span>stderr_ref<span class="keyword">,</span> <span class="dynstr">"exit(ATS): "</span><span class="keyword">,</span> errmsg<span class="keyword">)</span></span> <span class="keyword">in</span> exit<span class="keyword">(</span><span class="dynexp">1</span><span class="keyword">)</span>
    <span class="comment">// end of [val]</span>
  <span class="keyword">end</span> <span class="comment">// end of [else]</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [checkast_gintBtwe]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span>
checkast_Ptr1
  <span class="keyword">(</span>x<span class="keyword">,</span> errmsg<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> x <span class="keyword">=</span> g1ofg0_ptr<span class="keyword">(</span>x<span class="keyword">)</span></span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">if</span> x <span class="keyword">&gt;</span> <span class="dynexp">0</span>
  <span class="keyword">then</span> <span class="keyword">(</span>x<span class="keyword">)</span>
  <span class="keyword">else</span> <span class="keyword">let</span>
    <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span>
      <span class="dynexp">fprint!</span> <span class="keyword">(</span>stderr_ref<span class="keyword">,</span> <span class="dynstr">"exit(ATS): "</span><span class="keyword">,</span> errmsg<span class="keyword">)</span></span> <span class="keyword">in</span> exit<span class="keyword">(</span><span class="dynexp">1</span><span class="keyword">)</span>
    <span class="comment">// end of [val]</span>
  <span class="keyword">end</span> <span class="comment">// end of [else]</span>
<span class="comment">// end of [if]</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [checkast_Ptr1]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span>
checkast_Strptr1
  <span class="keyword">(</span>x<span class="keyword">,</span> errmsg<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> p <span class="keyword">=</span> strptr2ptr<span class="keyword">(</span>x<span class="keyword">)</span></span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">if</span> p <span class="keyword">&gt;</span> <span class="dynexp">0</span>
  <span class="keyword">then</span> <span class="keyword">(</span>x<span class="keyword">)</span>
  <span class="keyword">else</span> <span class="keyword">let</span>
    <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span>
      strptr_free_null <span class="keyword">(</span>x<span class="keyword">)</span></span>
    <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span> <span class="keyword">=</span>
      <span class="dynexp">fprint!</span> <span class="keyword">(</span>stderr_ref<span class="keyword">,</span> <span class="dynstr">"exit(ATS): "</span><span class="keyword">,</span> errmsg<span class="keyword">)</span></span>
    <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span> <span class="keyword">=</span> exit_void<span class="keyword">(</span><span class="dynexp">1</span><span class="keyword">)</span></span>
  <span class="keyword">in</span>
    $UN<span class="keyword">.</span>castvwtp0<span class="staexp"><span class="keyword">{</span>Strptr1<span class="keyword">}</span></span><span class="keyword">(</span><span class="dynexp">0</span><span class="keyword">)</span>
  <span class="keyword">end</span> <span class="comment">// end of [else]</span>
<span class="comment">// end of [if]</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [checkast_Strptr1]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* end of [checkast.dats] *)</span>
</pre>
<pre class="patsyntax">
<span class="comment">(***********************************************************************)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(*                         Applied Type System                         *)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(***********************************************************************)</span>

<span class="comment">(*
** ATS/Postiats - Unleashing the Potential of Types!
** Copyright (C) 2010-2015 Hongwei Xi, ATS Trustful Software, Inc.
** All rights reserved
**
** ATS is free software;  you can  redistribute it and/or modify it under
** the terms of  the GNU GENERAL PUBLIC LICENSE (GPL) as published by the
** Free Software Foundation; either version 3, or (at  your  option)  any
** later version.
**
** ATS is distributed in the hope that it will be useful, but WITHOUT ANY
** WARRANTY; without  even  the  implied  warranty  of MERCHANTABILITY or
** FITNESS FOR A PARTICULAR PURPOSE.  See the  GNU General Public License
** for more details.
**
** You  should  have  received  a  copy of the GNU General Public License
** along  with  ATS;  see the  file COPYING.  If not, please write to the
** Free Software Foundation,  51 Franklin Street, Fifth Floor, Boston, MA
** 02110-1301, USA.
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
** Source:
** $PATSHOME/prelude/DATS/CODEGEN/tuple.atxt
** Time of generation: Sun Oct  2 10:33:55 2016
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* Author: Hongwei Xi *)</span>
<span class="comment">(* Authoremail: hwxi AT cs DOT bu DOT edu *)</span>
<span class="comment">(* Start time: December, 2012 *)</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
fprint_tup$beg&lt;<span class="keyword">&gt;</span>
  <span class="keyword">(</span>out<span class="keyword">)</span> <span class="keyword">=</span> fprint_string<span class="keyword">(</span>out<span class="keyword">,</span> <span class="dynstr">"("</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">implement</span>
fprint_tup$end&lt;<span class="keyword">&gt;</span>
  <span class="keyword">(</span>out<span class="keyword">)</span> <span class="keyword">=</span> fprint_string<span class="keyword">(</span>out<span class="keyword">,</span> <span class="dynstr">")"</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">implement</span>
fprint_tup$sep&lt;<span class="keyword">&gt;</span>
  <span class="keyword">(</span>out<span class="keyword">)</span> <span class="keyword">=</span> fprint_string<span class="keyword">(</span>out<span class="keyword">,</span> <span class="dynstr">", "</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a0<span class="keyword">,</span>a1</span><span class="keyword">}</span>
fprint_tupval2
  <span class="keyword">(</span>out<span class="keyword">,</span> x<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fprint_tup$beg&lt;<span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fprint_val&lt;<span class="staexp">a0</span><span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">,</span> x<span class="dynexp"><span class="keyword">.0</span></span><span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fprint_tup$sep&lt;<span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fprint_val&lt;<span class="staexp">a1</span><span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">,</span> x<span class="dynexp"><span class="keyword">.1</span></span><span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fprint_tup$end&lt;<span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">in</span>
  <span class="comment">// nothing</span>
<span class="keyword">end</span></span></span> <span class="comment">// end of [fprint_tupval2]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">(</span><span class="staexp">a0</span><span class="keyword">,</span><span class="staexp">a1</span><span class="keyword">)</span>
fprint_val&lt;<span class="staexp">tup</span><span class="keyword">(</span><span class="staexp">a0</span><span class="keyword">,</span><span class="staexp">a1</span><span class="keyword">)</span><span class="keyword">&gt;</span>
  <span class="keyword">(</span>out<span class="keyword">,</span> x<span class="keyword">)</span> <span class="keyword">=</span> fprint_tupval2&lt;<span class="staexp">a0</span><span class="keyword">,</span><span class="staexp">a1</span><span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">,</span> x<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a0<span class="keyword">,</span>a1<span class="keyword">,</span>a2</span><span class="keyword">}</span>
fprint_tupval3
  <span class="keyword">(</span>out<span class="keyword">,</span> x<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fprint_tup$beg&lt;<span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fprint_val&lt;<span class="staexp">a0</span><span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">,</span> x<span class="dynexp"><span class="keyword">.0</span></span><span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fprint_tup$sep&lt;<span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fprint_val&lt;<span class="staexp">a1</span><span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">,</span> x<span class="dynexp"><span class="keyword">.1</span></span><span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fprint_tup$sep&lt;<span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fprint_val&lt;<span class="staexp">a2</span><span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">,</span> x<span class="dynexp"><span class="keyword">.2</span></span><span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fprint_tup$end&lt;<span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">in</span>
  <span class="comment">// nothing</span>
<span class="keyword">end</span></span></span> <span class="comment">// end of [fprint_tupval3]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">(</span><span class="staexp">a0</span><span class="keyword">,</span><span class="staexp">a1</span><span class="keyword">,</span><span class="staexp">a2</span><span class="keyword">)</span>
fprint_val&lt;<span class="staexp">tup</span><span class="keyword">(</span><span class="staexp">a0</span><span class="keyword">,</span><span class="staexp">a1</span><span class="keyword">,</span><span class="staexp">a2</span><span class="keyword">)</span><span class="keyword">&gt;</span>
  <span class="keyword">(</span>out<span class="keyword">,</span> x<span class="keyword">)</span> <span class="keyword">=</span> fprint_tupval3&lt;<span class="staexp">a0</span><span class="keyword">,</span><span class="staexp">a1</span><span class="keyword">,</span><span class="staexp">a2</span><span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">,</span> x<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a0<span class="keyword">,</span>a1<span class="keyword">,</span>a2<span class="keyword">,</span>a3</span><span class="keyword">}</span>
fprint_tupval4
  <span class="keyword">(</span>out<span class="keyword">,</span> x<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fprint_tup$beg&lt;<span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fprint_val&lt;<span class="staexp">a0</span><span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">,</span> x<span class="dynexp"><span class="keyword">.0</span></span><span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fprint_tup$sep&lt;<span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fprint_val&lt;<span class="staexp">a1</span><span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">,</span> x<span class="dynexp"><span class="keyword">.1</span></span><span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fprint_tup$sep&lt;<span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fprint_val&lt;<span class="staexp">a2</span><span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">,</span> x<span class="dynexp"><span class="keyword">.2</span></span><span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fprint_tup$sep&lt;<span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fprint_val&lt;<span class="staexp">a3</span><span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">,</span> x<span class="dynexp"><span class="keyword">.3</span></span><span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fprint_tup$end&lt;<span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">in</span>
  <span class="comment">// nothing</span>
<span class="keyword">end</span></span></span> <span class="comment">// end of [fprint_tupval4]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">(</span><span class="staexp">a0</span><span class="keyword">,</span><span class="staexp">a1</span><span class="keyword">,</span><span class="staexp">a2</span><span class="keyword">,</span><span class="staexp">a3</span><span class="keyword">)</span>
fprint_val&lt;<span class="staexp">tup</span><span class="keyword">(</span><span class="staexp">a0</span><span class="keyword">,</span><span class="staexp">a1</span><span class="keyword">,</span><span class="staexp">a2</span><span class="keyword">,</span><span class="staexp">a3</span><span class="keyword">)</span><span class="keyword">&gt;</span>
  <span class="keyword">(</span>out<span class="keyword">,</span> x<span class="keyword">)</span> <span class="keyword">=</span> fprint_tupval4&lt;<span class="staexp">a0</span><span class="keyword">,</span><span class="staexp">a1</span><span class="keyword">,</span><span class="staexp">a2</span><span class="keyword">,</span><span class="staexp">a3</span><span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">,</span> x<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a0<span class="keyword">,</span>a1</span><span class="keyword">}</span>
fprint_tupref2
  <span class="keyword">(</span>out<span class="keyword">,</span> x<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fprint_tup$beg&lt;<span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fprint_ref&lt;<span class="staexp">a0</span><span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">,</span> x<span class="dynexp"><span class="keyword">.0</span></span><span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fprint_tup$sep&lt;<span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fprint_ref&lt;<span class="staexp">a1</span><span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">,</span> x<span class="dynexp"><span class="keyword">.1</span></span><span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fprint_tup$end&lt;<span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">in</span>
  <span class="comment">// nothing</span>
<span class="keyword">end</span></span></span> <span class="comment">// end of [fprint_tupref2]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">(</span><span class="staexp">a0</span><span class="keyword">,</span><span class="staexp">a1</span><span class="keyword">)</span>
fprint_ref&lt;<span class="staexp">tup</span><span class="keyword">(</span><span class="staexp">a0</span><span class="keyword">,</span><span class="staexp">a1</span><span class="keyword">)</span><span class="keyword">&gt;</span>
  <span class="keyword">(</span>out<span class="keyword">,</span> x<span class="keyword">)</span> <span class="keyword">=</span> fprint_tupref2&lt;<span class="staexp">a0</span><span class="keyword">,</span><span class="staexp">a1</span><span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">,</span> x<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a0<span class="keyword">,</span>a1<span class="keyword">,</span>a2</span><span class="keyword">}</span>
fprint_tupref3
  <span class="keyword">(</span>out<span class="keyword">,</span> x<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fprint_tup$beg&lt;<span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fprint_ref&lt;<span class="staexp">a0</span><span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">,</span> x<span class="dynexp"><span class="keyword">.0</span></span><span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fprint_tup$sep&lt;<span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fprint_ref&lt;<span class="staexp">a1</span><span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">,</span> x<span class="dynexp"><span class="keyword">.1</span></span><span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fprint_tup$sep&lt;<span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fprint_ref&lt;<span class="staexp">a2</span><span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">,</span> x<span class="dynexp"><span class="keyword">.2</span></span><span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fprint_tup$end&lt;<span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">in</span>
  <span class="comment">// nothing</span>
<span class="keyword">end</span></span></span> <span class="comment">// end of [fprint_tupref3]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">(</span><span class="staexp">a0</span><span class="keyword">,</span><span class="staexp">a1</span><span class="keyword">,</span><span class="staexp">a2</span><span class="keyword">)</span>
fprint_ref&lt;<span class="staexp">tup</span><span class="keyword">(</span><span class="staexp">a0</span><span class="keyword">,</span><span class="staexp">a1</span><span class="keyword">,</span><span class="staexp">a2</span><span class="keyword">)</span><span class="keyword">&gt;</span>
  <span class="keyword">(</span>out<span class="keyword">,</span> x<span class="keyword">)</span> <span class="keyword">=</span> fprint_tupref3&lt;<span class="staexp">a0</span><span class="keyword">,</span><span class="staexp">a1</span><span class="keyword">,</span><span class="staexp">a2</span><span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">,</span> x<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a0<span class="keyword">,</span>a1<span class="keyword">,</span>a2<span class="keyword">,</span>a3</span><span class="keyword">}</span>
fprint_tupref4
  <span class="keyword">(</span>out<span class="keyword">,</span> x<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fprint_tup$beg&lt;<span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fprint_ref&lt;<span class="staexp">a0</span><span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">,</span> x<span class="dynexp"><span class="keyword">.0</span></span><span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fprint_tup$sep&lt;<span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fprint_ref&lt;<span class="staexp">a1</span><span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">,</span> x<span class="dynexp"><span class="keyword">.1</span></span><span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fprint_tup$sep&lt;<span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fprint_ref&lt;<span class="staexp">a2</span><span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">,</span> x<span class="dynexp"><span class="keyword">.2</span></span><span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fprint_tup$sep&lt;<span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fprint_ref&lt;<span class="staexp">a3</span><span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">,</span> x<span class="dynexp"><span class="keyword">.3</span></span><span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fprint_tup$end&lt;<span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">in</span>
  <span class="comment">// nothing</span>
<span class="keyword">end</span></span></span> <span class="comment">// end of [fprint_tupref4]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">(</span><span class="staexp">a0</span><span class="keyword">,</span><span class="staexp">a1</span><span class="keyword">,</span><span class="staexp">a2</span><span class="keyword">,</span><span class="staexp">a3</span><span class="keyword">)</span>
fprint_ref&lt;<span class="staexp">tup</span><span class="keyword">(</span><span class="staexp">a0</span><span class="keyword">,</span><span class="staexp">a1</span><span class="keyword">,</span><span class="staexp">a2</span><span class="keyword">,</span><span class="staexp">a3</span><span class="keyword">)</span><span class="keyword">&gt;</span>
  <span class="keyword">(</span>out<span class="keyword">,</span> x<span class="keyword">)</span> <span class="keyword">=</span> fprint_tupref4&lt;<span class="staexp">a0</span><span class="keyword">,</span><span class="staexp">a1</span><span class="keyword">,</span><span class="staexp">a2</span><span class="keyword">,</span><span class="staexp">a3</span><span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">,</span> x<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
fprint_tupbox$beg&lt;<span class="keyword">&gt;</span>
  <span class="keyword">(</span>out<span class="keyword">)</span> <span class="keyword">=</span> fprint_string<span class="keyword">(</span>out<span class="keyword">,</span> <span class="dynstr">"$tup("</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
fprint_tupbox$end&lt;<span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">)</span> <span class="keyword">=</span> fprint_string<span class="keyword">(</span>out<span class="keyword">,</span> <span class="dynstr">")"</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">implement</span>
fprint_tupbox$sep&lt;<span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">)</span> <span class="keyword">=</span> fprint_string<span class="keyword">(</span>out<span class="keyword">,</span> <span class="dynstr">", "</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a0</span><span class="keyword">}</span>
fprint_tupbox1
  <span class="keyword">(</span>out<span class="keyword">,</span> x<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fprint_tupbox$beg&lt;<span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fprint_val&lt;<span class="staexp">a0</span><span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">,</span> x<span class="dynexp"><span class="keyword">.0</span></span><span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fprint_tupbox$end&lt;<span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">in</span>
  <span class="comment">// nothing</span>
<span class="keyword">end</span></span></span> <span class="comment">// end of [fprint_tupbox1]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span><span class="keyword">(</span><span class="staexp">a0</span><span class="keyword">)</span>
fprint_val&lt;<span class="staexp">tupbox</span><span class="keyword">(</span><span class="staexp">a0</span><span class="keyword">)</span><span class="keyword">&gt;</span>
  <span class="keyword">(</span>out<span class="keyword">,</span> x<span class="keyword">)</span> <span class="keyword">=</span> fprint_tupbox1&lt;<span class="staexp">a0</span><span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">,</span> x<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a0<span class="keyword">,</span>a1</span><span class="keyword">}</span>
fprint_tupbox2
  <span class="keyword">(</span>out<span class="keyword">,</span> x<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fprint_tupbox$beg&lt;<span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fprint_val&lt;<span class="staexp">a0</span><span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">,</span> x<span class="dynexp"><span class="keyword">.0</span></span><span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fprint_tupbox$sep&lt;<span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fprint_val&lt;<span class="staexp">a1</span><span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">,</span> x<span class="dynexp"><span class="keyword">.1</span></span><span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fprint_tupbox$end&lt;<span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">in</span>
  <span class="comment">// nothing</span>
<span class="keyword">end</span></span></span> <span class="comment">// end of [fprint_tupbox2]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span><span class="keyword">(</span><span class="staexp">a0</span><span class="keyword">,</span><span class="staexp">a1</span><span class="keyword">)</span>
fprint_val&lt;<span class="staexp">tupbox</span><span class="keyword">(</span><span class="staexp">a0</span><span class="keyword">,</span><span class="staexp">a1</span><span class="keyword">)</span><span class="keyword">&gt;</span>
  <span class="keyword">(</span>out<span class="keyword">,</span> x<span class="keyword">)</span> <span class="keyword">=</span> fprint_tupbox2&lt;<span class="staexp">a0</span><span class="keyword">,</span><span class="staexp">a1</span><span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">,</span> x<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a0<span class="keyword">,</span>a1<span class="keyword">,</span>a2</span><span class="keyword">}</span>
fprint_tupbox3
  <span class="keyword">(</span>out<span class="keyword">,</span> x<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fprint_tupbox$beg&lt;<span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fprint_val&lt;<span class="staexp">a0</span><span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">,</span> x<span class="dynexp"><span class="keyword">.0</span></span><span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fprint_tupbox$sep&lt;<span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fprint_val&lt;<span class="staexp">a1</span><span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">,</span> x<span class="dynexp"><span class="keyword">.1</span></span><span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fprint_tupbox$sep&lt;<span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fprint_val&lt;<span class="staexp">a2</span><span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">,</span> x<span class="dynexp"><span class="keyword">.2</span></span><span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fprint_tupbox$end&lt;<span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">in</span>
  <span class="comment">// nothing</span>
<span class="keyword">end</span></span></span> <span class="comment">// end of [fprint_tupbox3]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span><span class="keyword">(</span><span class="staexp">a0</span><span class="keyword">,</span><span class="staexp">a1</span><span class="keyword">,</span><span class="staexp">a2</span><span class="keyword">)</span>
fprint_val&lt;<span class="staexp">tupbox</span><span class="keyword">(</span><span class="staexp">a0</span><span class="keyword">,</span><span class="staexp">a1</span><span class="keyword">,</span><span class="staexp">a2</span><span class="keyword">)</span><span class="keyword">&gt;</span>
  <span class="keyword">(</span>out<span class="keyword">,</span> x<span class="keyword">)</span> <span class="keyword">=</span> fprint_tupbox3&lt;<span class="staexp">a0</span><span class="keyword">,</span><span class="staexp">a1</span><span class="keyword">,</span><span class="staexp">a2</span><span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">,</span> x<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a0<span class="keyword">,</span>a1<span class="keyword">,</span>a2<span class="keyword">,</span>a3</span><span class="keyword">}</span>
fprint_tupbox4
  <span class="keyword">(</span>out<span class="keyword">,</span> x<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fprint_tupbox$beg&lt;<span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fprint_val&lt;<span class="staexp">a0</span><span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">,</span> x<span class="dynexp"><span class="keyword">.0</span></span><span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fprint_tupbox$sep&lt;<span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fprint_val&lt;<span class="staexp">a1</span><span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">,</span> x<span class="dynexp"><span class="keyword">.1</span></span><span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fprint_tupbox$sep&lt;<span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fprint_val&lt;<span class="staexp">a2</span><span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">,</span> x<span class="dynexp"><span class="keyword">.2</span></span><span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fprint_tupbox$sep&lt;<span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fprint_val&lt;<span class="staexp">a3</span><span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">,</span> x<span class="dynexp"><span class="keyword">.3</span></span><span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fprint_tupbox$end&lt;<span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">in</span>
  <span class="comment">// nothing</span>
<span class="keyword">end</span></span></span> <span class="comment">// end of [fprint_tupbox4]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span><span class="keyword">(</span><span class="staexp">a0</span><span class="keyword">,</span><span class="staexp">a1</span><span class="keyword">,</span><span class="staexp">a2</span><span class="keyword">,</span><span class="staexp">a3</span><span class="keyword">)</span>
fprint_val&lt;<span class="staexp">tupbox</span><span class="keyword">(</span><span class="staexp">a0</span><span class="keyword">,</span><span class="staexp">a1</span><span class="keyword">,</span><span class="staexp">a2</span><span class="keyword">,</span><span class="staexp">a3</span><span class="keyword">)</span><span class="keyword">&gt;</span>
  <span class="keyword">(</span>out<span class="keyword">,</span> x<span class="keyword">)</span> <span class="keyword">=</span> fprint_tupbox4&lt;<span class="staexp">a0</span><span class="keyword">,</span><span class="staexp">a1</span><span class="keyword">,</span><span class="staexp">a2</span><span class="keyword">,</span><span class="staexp">a3</span><span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">,</span> x<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a0<span class="keyword">,</span>a1</span><span class="keyword">}</span>
tupval2_equal<span class="keyword">(</span>x<span class="keyword">,</span> y<span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
<span class="comment">//</span>
<span class="keyword">if</span>
gequal_val_val&lt;<span class="staexp">a0</span><span class="keyword">&gt;</span><span class="keyword">(</span>x<span class="dynexp"><span class="keyword">.0</span></span><span class="keyword">,</span> y<span class="dynexp"><span class="keyword">.0</span></span><span class="keyword">)</span>
<span class="keyword">then</span> gequal_val_val&lt;<span class="staexp">a1</span><span class="keyword">&gt;</span><span class="keyword">(</span>x<span class="dynexp"><span class="keyword">.1</span></span><span class="keyword">,</span> y<span class="dynexp"><span class="keyword">.1</span></span><span class="keyword">)</span> <span class="keyword">else</span> false
<span class="comment">//</span>
<span class="keyword">)</span></span> <span class="comment">(* end of [tupval2_val_val] *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">(</span><span class="staexp">a0</span><span class="keyword">,</span><span class="staexp">a1</span><span class="keyword">)</span>
gequal_val_val&lt;<span class="staexp">tup</span><span class="keyword">(</span><span class="staexp">a0</span><span class="keyword">,</span><span class="staexp">a1</span><span class="keyword">)</span><span class="keyword">&gt;</span> <span class="keyword">(</span>x<span class="keyword">,</span> y<span class="keyword">)</span> <span class="keyword">=</span> tupval2_equal&lt;<span class="staexp">a0</span><span class="keyword">,</span><span class="staexp">a1</span><span class="keyword">&gt;</span> <span class="keyword">(</span>x<span class="keyword">,</span> y<span class="keyword">)</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a0<span class="keyword">,</span>a1<span class="keyword">,</span>a2</span><span class="keyword">}</span>
tupval3_equal<span class="keyword">(</span>x<span class="keyword">,</span> y<span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
<span class="comment">//</span>
<span class="keyword">if</span>
gequal_val_val&lt;<span class="staexp">a0</span><span class="keyword">&gt;</span><span class="keyword">(</span>x<span class="dynexp"><span class="keyword">.0</span></span><span class="keyword">,</span> y<span class="dynexp"><span class="keyword">.0</span></span><span class="keyword">)</span>
<span class="keyword">then</span>
<span class="keyword">(</span>
  <span class="keyword">if</span> gequal_val_val&lt;<span class="staexp">a1</span><span class="keyword">&gt;</span><span class="keyword">(</span>x<span class="dynexp"><span class="keyword">.1</span></span><span class="keyword">,</span> y<span class="dynexp"><span class="keyword">.1</span></span><span class="keyword">)</span>
    <span class="keyword">then</span> gequal_val_val&lt;<span class="staexp">a2</span><span class="keyword">&gt;</span><span class="keyword">(</span>x<span class="dynexp"><span class="keyword">.2</span></span><span class="keyword">,</span> y<span class="dynexp"><span class="keyword">.2</span></span><span class="keyword">)</span> <span class="keyword">else</span> false
  <span class="comment">// end of [if]</span>
<span class="keyword">)</span> <span class="keyword">else</span> false
<span class="comment">//</span>
<span class="keyword">)</span></span> <span class="comment">(* end of [tupval3_val_val] *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">(</span><span class="staexp">a0</span><span class="keyword">,</span><span class="staexp">a1</span><span class="keyword">,</span><span class="staexp">a2</span><span class="keyword">)</span>
gequal_val_val&lt;<span class="staexp">tup</span><span class="keyword">(</span><span class="staexp">a0</span><span class="keyword">,</span><span class="staexp">a1</span><span class="keyword">,</span><span class="staexp">a2</span><span class="keyword">)</span><span class="keyword">&gt;</span> <span class="keyword">(</span>x<span class="keyword">,</span> y<span class="keyword">)</span> <span class="keyword">=</span> tupval3_equal&lt;<span class="staexp">a0</span><span class="keyword">,</span><span class="staexp">a1</span><span class="keyword">,</span><span class="staexp">a2</span><span class="keyword">&gt;</span> <span class="keyword">(</span>x<span class="keyword">,</span> y<span class="keyword">)</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a0<span class="keyword">,</span>a1<span class="keyword">,</span>a2<span class="keyword">,</span>a3</span><span class="keyword">}</span>
tupval4_equal<span class="keyword">(</span>x<span class="keyword">,</span> y<span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
<span class="comment">//</span>
<span class="keyword">if</span>
gequal_val_val&lt;<span class="staexp">a0</span><span class="keyword">&gt;</span><span class="keyword">(</span>x<span class="dynexp"><span class="keyword">.0</span></span><span class="keyword">,</span> y<span class="dynexp"><span class="keyword">.0</span></span><span class="keyword">)</span>
<span class="keyword">then</span>
<span class="keyword">(</span>
<span class="keyword">if</span>
gequal_val_val&lt;<span class="staexp">a1</span><span class="keyword">&gt;</span><span class="keyword">(</span>x<span class="dynexp"><span class="keyword">.1</span></span><span class="keyword">,</span> y<span class="dynexp"><span class="keyword">.1</span></span><span class="keyword">)</span>
<span class="keyword">then</span> <span class="keyword">(</span>
<span class="keyword">if</span>
gequal_val_val&lt;<span class="staexp">a2</span><span class="keyword">&gt;</span><span class="keyword">(</span>x<span class="dynexp"><span class="keyword">.2</span></span><span class="keyword">,</span> y<span class="dynexp"><span class="keyword">.2</span></span><span class="keyword">)</span>
  <span class="keyword">then</span> gequal_val_val&lt;<span class="staexp">a3</span><span class="keyword">&gt;</span><span class="keyword">(</span>x<span class="dynexp"><span class="keyword">.3</span></span><span class="keyword">,</span> y<span class="dynexp"><span class="keyword">.3</span></span><span class="keyword">)</span> <span class="keyword">else</span> false
<span class="comment">// end of [if]</span>
<span class="keyword">)</span> <span class="keyword">else</span> false
<span class="keyword">)</span> <span class="keyword">else</span> false
<span class="comment">//</span>
<span class="keyword">)</span></span> <span class="comment">(* end of [tupval4_val_val] *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">(</span><span class="staexp">a0</span><span class="keyword">,</span><span class="staexp">a1</span><span class="keyword">,</span><span class="staexp">a2</span><span class="keyword">,</span><span class="staexp">a3</span><span class="keyword">)</span>
gequal_val_val&lt;<span class="staexp">tup</span><span class="keyword">(</span><span class="staexp">a0</span><span class="keyword">,</span><span class="staexp">a1</span><span class="keyword">,</span><span class="staexp">a2</span><span class="keyword">,</span><span class="staexp">a3</span><span class="keyword">)</span><span class="keyword">&gt;</span> <span class="keyword">(</span>x<span class="keyword">,</span> y<span class="keyword">)</span> <span class="keyword">=</span> tupval4_equal&lt;<span class="staexp">a0</span><span class="keyword">,</span><span class="staexp">a1</span><span class="keyword">,</span><span class="staexp">a2</span><span class="keyword">,</span><span class="staexp">a3</span><span class="keyword">&gt;</span> <span class="keyword">(</span>x<span class="keyword">,</span> y<span class="keyword">)</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a0<span class="keyword">,</span>a1</span><span class="keyword">}</span>
tupval2_compare <span class="keyword">(</span>x<span class="keyword">,</span> y<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> sgn0 <span class="keyword">=</span> gcompare_val_val&lt;<span class="staexp">a0</span><span class="keyword">&gt;</span> <span class="keyword">(</span>x<span class="dynexp"><span class="keyword">.0</span></span><span class="keyword">,</span> y<span class="dynexp"><span class="keyword">.0</span></span><span class="keyword">)</span></span>
<span class="keyword">in</span>
  <span class="keyword">if</span> sgn0 != <span class="dynexp">0</span>
    <span class="keyword">then</span> sgn0 <span class="keyword">else</span> gcompare_val_val&lt;<span class="staexp">a1</span><span class="keyword">&gt;</span> <span class="keyword">(</span>x<span class="dynexp"><span class="keyword">.1</span></span><span class="keyword">,</span> y<span class="dynexp"><span class="keyword">.1</span></span><span class="keyword">)</span>
  <span class="comment">// end of [if]</span>
<span class="keyword">end</span></span> <span class="comment">// end of [tupval2_compare]  </span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">(</span><span class="staexp">a0</span><span class="keyword">,</span><span class="staexp">a1</span><span class="keyword">)</span>
gcompare_val_val&lt;<span class="staexp">tup</span><span class="keyword">(</span><span class="staexp">a0</span><span class="keyword">,</span><span class="staexp">a1</span><span class="keyword">)</span><span class="keyword">&gt;</span> <span class="keyword">(</span>x<span class="keyword">,</span> y<span class="keyword">)</span> <span class="keyword">=</span> tupval2_compare&lt;<span class="staexp">a0</span><span class="keyword">,</span><span class="staexp">a1</span><span class="keyword">&gt;</span> <span class="keyword">(</span>x<span class="keyword">,</span> y<span class="keyword">)</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a0<span class="keyword">,</span>a1<span class="keyword">,</span>a2</span><span class="keyword">}</span>
tupval3_compare <span class="keyword">(</span>x<span class="keyword">,</span> y<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> sgn0 <span class="keyword">=</span> gcompare_val_val&lt;<span class="staexp">a0</span><span class="keyword">&gt;</span> <span class="keyword">(</span>x<span class="dynexp"><span class="keyword">.0</span></span><span class="keyword">,</span> y<span class="dynexp"><span class="keyword">.0</span></span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">if</span>
sgn0 != <span class="dynexp">0</span>
<span class="keyword">then</span> sgn0
<span class="keyword">else</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> sgn1 <span class="keyword">=</span> gcompare_val_val&lt;<span class="staexp">a1</span><span class="keyword">&gt;</span> <span class="keyword">(</span>x<span class="dynexp"><span class="keyword">.1</span></span><span class="keyword">,</span> y<span class="dynexp"><span class="keyword">.1</span></span><span class="keyword">)</span></span>
<span class="keyword">in</span>
  <span class="keyword">if</span> sgn1 != <span class="dynexp">0</span>
    <span class="keyword">then</span> sgn1 <span class="keyword">else</span> gcompare_val_val&lt;<span class="staexp">a2</span><span class="keyword">&gt;</span> <span class="keyword">(</span>x<span class="dynexp"><span class="keyword">.2</span></span><span class="keyword">,</span> y<span class="dynexp"><span class="keyword">.2</span></span><span class="keyword">)</span>
  <span class="comment">// end of [if]</span>
<span class="keyword">end</span> <span class="comment">// end of [if]</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [tupval3_compare]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">(</span><span class="staexp">a0</span><span class="keyword">,</span><span class="staexp">a1</span><span class="keyword">,</span><span class="staexp">a2</span><span class="keyword">)</span>
gcompare_val_val&lt;<span class="staexp">tup</span><span class="keyword">(</span><span class="staexp">a0</span><span class="keyword">,</span><span class="staexp">a1</span><span class="keyword">,</span><span class="staexp">a2</span><span class="keyword">)</span><span class="keyword">&gt;</span> <span class="keyword">(</span>x<span class="keyword">,</span> y<span class="keyword">)</span> <span class="keyword">=</span> tupval3_compare&lt;<span class="staexp">a0</span><span class="keyword">,</span><span class="staexp">a1</span><span class="keyword">,</span><span class="staexp">a2</span><span class="keyword">&gt;</span> <span class="keyword">(</span>x<span class="keyword">,</span> y<span class="keyword">)</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a0<span class="keyword">,</span>a1<span class="keyword">,</span>a2<span class="keyword">,</span>a3</span><span class="keyword">}</span>
tupval4_compare <span class="keyword">(</span>x<span class="keyword">,</span> y<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> sgn0 <span class="keyword">=</span> gcompare_val_val&lt;<span class="staexp">a0</span><span class="keyword">&gt;</span> <span class="keyword">(</span>x<span class="dynexp"><span class="keyword">.0</span></span><span class="keyword">,</span> y<span class="dynexp"><span class="keyword">.0</span></span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">if</span>
sgn0 != <span class="dynexp">0</span>
<span class="keyword">then</span> sgn0
<span class="keyword">else</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> sgn1 <span class="keyword">=</span> gcompare_val_val&lt;<span class="staexp">a1</span><span class="keyword">&gt;</span> <span class="keyword">(</span>x<span class="dynexp"><span class="keyword">.1</span></span><span class="keyword">,</span> y<span class="dynexp"><span class="keyword">.1</span></span><span class="keyword">)</span></span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">if</span> sgn1 != <span class="dynexp">0</span> <span class="keyword">then</span> sgn1
<span class="keyword">else</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> sgn2 <span class="keyword">=</span> gcompare_val_val&lt;<span class="staexp">a2</span><span class="keyword">&gt;</span> <span class="keyword">(</span>x<span class="dynexp"><span class="keyword">.2</span></span><span class="keyword">,</span> y<span class="dynexp"><span class="keyword">.2</span></span><span class="keyword">)</span></span>
<span class="keyword">in</span>
  <span class="keyword">if</span> sgn2 != <span class="dynexp">0</span>
    <span class="keyword">then</span> sgn2 <span class="keyword">else</span> gcompare_val_val&lt;<span class="staexp">a3</span><span class="keyword">&gt;</span> <span class="keyword">(</span>x<span class="dynexp"><span class="keyword">.3</span></span><span class="keyword">,</span> y<span class="dynexp"><span class="keyword">.3</span></span><span class="keyword">)</span>
  <span class="comment">// end of [if]</span>
<span class="keyword">end</span> <span class="comment">// end of [if]</span>
<span class="comment">//</span>
<span class="keyword">end</span> <span class="comment">// end of [if]</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [tupval4_compare]  </span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">(</span><span class="staexp">a0</span><span class="keyword">,</span><span class="staexp">a1</span><span class="keyword">,</span><span class="staexp">a2</span><span class="keyword">,</span><span class="staexp">a3</span><span class="keyword">)</span>
gcompare_val_val&lt;<span class="staexp">tup</span><span class="keyword">(</span><span class="staexp">a0</span><span class="keyword">,</span><span class="staexp">a1</span><span class="keyword">,</span><span class="staexp">a2</span><span class="keyword">,</span><span class="staexp">a3</span><span class="keyword">)</span><span class="keyword">&gt;</span> <span class="keyword">(</span>x<span class="keyword">,</span> y<span class="keyword">)</span> <span class="keyword">=</span> tupval4_compare&lt;<span class="staexp">a0</span><span class="keyword">,</span><span class="staexp">a1</span><span class="keyword">,</span><span class="staexp">a2</span><span class="keyword">,</span><span class="staexp">a3</span><span class="keyword">&gt;</span> <span class="keyword">(</span>x<span class="keyword">,</span> y<span class="keyword">)</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* end of [tuple.dats] *)</span>
</pre>
<pre class="patsyntax">
<span class="comment">(***********************************************************************)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(*                         Applied Type System                         *)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(***********************************************************************)</span>

<span class="comment">(*
** ATS/Postiats - Unleashing the Potential of Types!
** Copyright (C) 2010-2015 Hongwei Xi, ATS Trustful Software, Inc.
** All rights reserved
**
** ATS is free software;  you can  redistribute it and/or modify it under
** the terms of  the GNU GENERAL PUBLIC LICENSE (GPL) as published by the
** Free Software Foundation; either version 3, or (at  your  option)  any
** later version.
**
** ATS is distributed in the hope that it will be useful, but WITHOUT ANY
** WARRANTY; without  even  the  implied  warranty  of MERCHANTABILITY or
** FITNESS FOR A PARTICULAR PURPOSE.  See the  GNU General Public License
** for more details.
**
** You  should  have  received  a  copy of the GNU General Public License
** along  with  ATS;  see the  file COPYING.  If not, please write to the
** Free Software Foundation,  51 Franklin Street, Fifth Floor, Boston, MA
** 02110-1301, USA.
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
** Source:
** $PATSHOME/prelude/DATS/CODEGEN/reference.atxt
** Time of generation: Sun Oct  2 10:33:56 2016
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* Author: Hongwei Xi *)</span>
<span class="comment">(* Authoremail: hwxi AT cs DOT bu DOT edu *)</span>
<span class="comment">(* Start time: May, 2012 *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
ref <span class="keyword">=</span> ref_make_elt&lt;<span class="staexp">a</span><span class="keyword">&gt;</span></span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
ref_make_elt <span class="keyword">(</span>x0<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pfat</span><span class="keyword">,</span> <span class="prfexp">pfgc</span> <span class="keyword">|</span> p<span class="keyword">)</span> <span class="keyword">=</span> ptr_alloc&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="keyword">)</span></span>
  <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> mfree_gc_v_elim <span class="keyword">(</span>pfgc<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">!</span>p := x0</span> <span class="comment">// initialization</span>
<span class="keyword">in</span>
  ref_make_viewptr <span class="keyword">(</span><span class="prfexp">pfat</span> <span class="keyword">|</span> p<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [ref_make_elt]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
ref_get_elt
  <span class="keyword">(</span>r<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">!</span>p <span class="keyword">where</span> <span class="keyword">{</span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">vbox _</span> <span class="keyword">|</span> p<span class="keyword">)</span> <span class="keyword">=</span> ref_get_viewptr <span class="keyword">(</span>r<span class="keyword">)</span></span>
<span class="keyword">}</span></span> <span class="comment">// end of [ref_get_elt]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
ref_set_elt
  <span class="keyword">(</span>r<span class="keyword">,</span> x<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">vbox _</span> <span class="keyword">|</span> p<span class="keyword">)</span> <span class="keyword">=</span> ref_get_viewptr <span class="keyword">(</span>r<span class="keyword">)</span></span>
<span class="keyword">in</span>
  <span class="keyword">!</span>p := x <span class="comment">// assignment</span>
<span class="keyword">end</span></span> <span class="comment">// end of [ref_set_elt]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
ref_exch_elt
  <span class="keyword">(</span>r<span class="keyword">,</span> x<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">vbox _</span> <span class="keyword">|</span> p<span class="keyword">)</span> <span class="keyword">=</span> ref_get_viewptr <span class="keyword">(</span>r<span class="keyword">)</span></span>
<span class="keyword">in</span>
  <span class="keyword">!</span>p :=: x <span class="comment">// exchanging</span>
<span class="keyword">end</span></span> <span class="comment">// end of [ref_exch_elt]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
ref_app_fun<span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span> <span class="keyword">(</span>r<span class="keyword">,</span> f<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">vbox _</span> <span class="keyword">|</span> p<span class="keyword">)</span> <span class="keyword">=</span> ref_get_viewptr <span class="keyword">(</span>r<span class="keyword">)</span></span> <span class="keyword">in</span> f <span class="keyword">(</span><span class="keyword">!</span>p<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [ref_app_fun]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
ref_app_funenv<span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span>
  <span class="keyword">(</span><span class="prfexp">pfv</span> <span class="keyword">|</span> r<span class="keyword">,</span> f<span class="keyword">,</span> env<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">vbox _</span> <span class="keyword">|</span> p<span class="keyword">)</span> <span class="keyword">=</span> ref_get_viewptr <span class="keyword">(</span>r<span class="keyword">)</span></span> <span class="keyword">in</span> f <span class="keyword">(</span><span class="prfexp">pfv</span> <span class="keyword">|</span> <span class="keyword">!</span>p<span class="keyword">,</span> env<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [ref_app_funenv]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
ref_vtakeout<span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span> <span class="keyword">(</span>r<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span>
  <span class="prfexp">vbox pf</span> <span class="keyword">|</span> p
<span class="keyword">)</span> <span class="keyword">=</span> ref_get_viewptr <span class="keyword">(</span>r<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span>pf<span class="keyword">,</span> fpf<span class="keyword">)</span> <span class="keyword">=</span> __copy <span class="keyword">(</span>pf<span class="keyword">)</span> <span class="keyword">where</span>
<span class="keyword">{</span>
  <span class="keyword">extern</span> <span class="prfexp"><span class="keyword">praxi</span> __copy <span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span> <span class="keyword">(</span>pf<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">a</span> <span class="staexp"><span class="keyword">@</span></span> <span class="staexp">l</span><span class="keyword">)</span><span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">a</span> <span class="staexp"><span class="keyword">@</span></span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">a</span> <span class="staexp"><span class="keyword">@</span></span> <span class="staexp">l</span> <span class="keyword">-&lt;</span><span class="staexp">lin</span><span class="keyword">,</span><span class="staexp">prf</span><span class="keyword">&gt;</span> <span class="staexp">void</span><span class="keyword">)</span></span>
<span class="keyword">}</span></span> <span class="comment">(* end of [prval] *)</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  <span class="keyword">(</span><span class="prfexp">pf</span><span class="keyword">,</span> <span class="prfexp">fpf</span> <span class="keyword">|</span> p<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [ref_vtakeout]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* end of [reference.dats] *)</span>
</pre>
<pre class="patsyntax">
<span class="comment">(***********************************************************************)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(*                         Applied Type System                         *)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(***********************************************************************)</span>

<span class="comment">(*
** ATS/Postiats - Unleashing the Potential of Types!
** Copyright (C) 2010-2015 Hongwei Xi, ATS Trustful Software, Inc.
** All rights reserved
**
** ATS is free software;  you can  redistribute it and/or modify it under
** the terms of  the GNU GENERAL PUBLIC LICENSE (GPL) as published by the
** Free Software Foundation; either version 3, or (at  your  option)  any
** later version.
**
** ATS is distributed in the hope that it will be useful, but WITHOUT ANY
** WARRANTY; without  even  the  implied  warranty  of MERCHANTABILITY or
** FITNESS FOR A PARTICULAR PURPOSE.  See the  GNU General Public License
** for more details.
**
** You  should  have  received  a  copy of the GNU General Public License
** along  with  ATS;  see the  file COPYING.  If not, please write to the
** Free Software Foundation,  51 Franklin Street, Fifth Floor, Boston, MA
** 02110-1301, USA.
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
** Source:
** $PATSHOME/prelude/DATS/CODEGEN/filebas.atxt
** Time of generation: Sun Oct  2 10:33:56 2016
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* Author: Hongwei Xi *)</span>
<span class="comment">(* Authoremail: hwxi AT cs DOT bu DOT edu *)</span>
<span class="comment">(* Start time: Feburary, 2012 *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="neuexp"><span class="keyword">#define</span>
ATS_DYNLOADFLAG 0</span> <span class="comment">// no dynloading at run-time</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">staload</span>
UN <span class="keyword">=</span> "prelude/SATS/unsafe.sats"

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">staload</span>
_<span class="comment">(*INT*)</span> <span class="keyword">=</span> "prelude/DATS/integer.dats"

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">staload</span>
STDIO <span class="keyword">=</span> "libats/libc/SATS/stdio.sats"
<span class="keyword">vtypedef</span>
<span class="staexp">FILEptr1 <span class="keyword">=</span> <span class="staexp">$STDIO<span class="keyword">.</span>FILEptr1</span></span> <span class="comment">(*linear/nonnull*)</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="keyword">staload</span> STAT <span class="keyword">=</span> "libats/libc/SATS/sys/stat.sats"
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="neuexp"><span class="keyword">#define</span> c2i char2int0</span>
<span class="neuexp"><span class="keyword">#define</span> i2c int2char0</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">// HX-2013-06:</span>
<span class="comment">// this is just Unix convention</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span> dirsep_get <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="dynexp">'/'</span></span>
<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span> dirname_self <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="dynstr">"."</span></span>
<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span> dirname_parent <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="dynstr">".."</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
filename_get_ext <span class="keyword">(</span>name<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="neuexp"><span class="keyword">#define</span> NUL '\000'</span>
<span class="dynexp"><span class="keyword">overload</span> + <span class="keyword">with</span> add_ptr_bsz</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> loop
<span class="keyword">(</span>
  p1<span class="keyword">:</span> <span class="staexp">ptr</span><span class="keyword">,</span> p2<span class="keyword">:</span> <span class="staexp">ptr</span><span class="keyword">,</span> c0<span class="keyword">:</span> <span class="staexp">char</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">ptr</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> c <span class="keyword">=</span> $UN<span class="keyword">.</span>ptr0_get&lt;<span class="staexp">char</span><span class="keyword">&gt;</span> <span class="keyword">(</span>p1<span class="keyword">)</span></span>
<span class="keyword">in</span>
  <span class="keyword">if</span> c != NUL <span class="keyword">then</span> <span class="keyword">let</span>
    <span class="dynexp"><span class="keyword">val</span> p1 <span class="keyword">=</span> p1 + i2sz<span class="keyword">(</span><span class="dynexp">1</span><span class="keyword">)</span></span>
  <span class="keyword">in</span>
    <span class="keyword">if</span> c != c0 <span class="keyword">then</span> loop <span class="keyword">(</span>p1<span class="keyword">,</span> p2<span class="keyword">,</span> c0<span class="keyword">)</span> <span class="keyword">else</span> loop <span class="keyword">(</span>p1<span class="keyword">,</span> p1<span class="keyword">,</span> c0<span class="keyword">)</span>
  <span class="keyword">end</span> <span class="keyword">else</span> p2 <span class="comment">// end of [if]</span>
<span class="keyword">end</span></span> <span class="comment">// end of [loop]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> p1 <span class="keyword">=</span> string2ptr<span class="keyword">(</span>name<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> p2 <span class="keyword">=</span> <span class="keyword">$effmask_all</span> <span class="keyword">(</span>loop <span class="keyword">(</span>p1<span class="keyword">,</span> the_null_ptr<span class="keyword">,</span> <span class="dynexp">'.'</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  $UN<span class="keyword">.</span>castvwtp0<span class="staexp"><span class="keyword">{</span>vStrptr0<span class="keyword">}</span></span><span class="keyword">(</span>p2<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [filename_get_ext]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
filename_test_ext
  <span class="keyword">(</span>name<span class="keyword">,</span> ext0<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">fpf</span> <span class="keyword">|</span> ext<span class="keyword">)</span> <span class="keyword">=</span> filename_get_ext <span class="keyword">(</span>name<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> ans <span class="keyword">=</span>
<span class="keyword">(</span>
  <span class="keyword">if</span> strptr2ptr<span class="keyword">(</span>ext<span class="keyword">)</span> <span class="keyword">&gt;</span> <span class="dynexp">0</span>
    <span class="keyword">then</span> eq_string_string <span class="keyword">(</span>ext0<span class="keyword">,</span> $UN<span class="keyword">.</span>strptr2string<span class="keyword">(</span>ext<span class="keyword">)</span><span class="keyword">)</span>
    <span class="keyword">else</span> false
  <span class="comment">// end of [if]</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">bool</span></span> <span class="comment">// end of [val]</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fpf <span class="keyword">(</span>ext<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  ans
<span class="keyword">end</span></span> <span class="comment">// end of [filename_test_ext]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
filename_get_base <span class="keyword">(</span>name<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="neuexp"><span class="keyword">#define</span> NUL '\000'</span>
<span class="dynexp"><span class="keyword">overload</span> + <span class="keyword">with</span> add_ptr_bsz</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> loop
<span class="keyword">(</span>
  p1<span class="keyword">:</span> <span class="staexp">ptr</span><span class="keyword">,</span> p2<span class="keyword">:</span> <span class="staexp">ptr</span><span class="keyword">,</span> c0<span class="keyword">:</span> <span class="staexp">char</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">ptr</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> c <span class="keyword">=</span> $UN<span class="keyword">.</span>ptr0_get&lt;<span class="staexp">char</span><span class="keyword">&gt;</span> <span class="keyword">(</span>p1<span class="keyword">)</span></span>
<span class="keyword">in</span>
  <span class="keyword">if</span> c != NUL <span class="keyword">then</span> <span class="keyword">let</span>
    <span class="dynexp"><span class="keyword">val</span> p1 <span class="keyword">=</span> p1 + i2sz<span class="keyword">(</span><span class="dynexp">1</span><span class="keyword">)</span></span>
  <span class="keyword">in</span>
    <span class="keyword">if</span> c != c0 <span class="keyword">then</span> loop <span class="keyword">(</span>p1<span class="keyword">,</span> p2<span class="keyword">,</span> c0<span class="keyword">)</span> <span class="keyword">else</span> loop <span class="keyword">(</span>p1<span class="keyword">,</span> p1<span class="keyword">,</span> c0<span class="keyword">)</span>
  <span class="keyword">end</span> <span class="keyword">else</span> p2 <span class="comment">// end of [if]</span>
<span class="keyword">end</span></span> <span class="comment">// end of [loop]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> c0 <span class="keyword">=</span> dirsep_get&lt;<span class="keyword">&gt;</span> <span class="keyword">(</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> p1 <span class="keyword">=</span> string2ptr<span class="keyword">(</span>name<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> p2 <span class="keyword">=</span> <span class="keyword">$effmask_all</span> <span class="keyword">(</span>loop <span class="keyword">(</span>p1<span class="keyword">,</span> p1<span class="keyword">,</span> c0<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  $UN<span class="keyword">.</span>castvwtp0<span class="staexp"><span class="keyword">{</span>vStrptr1<span class="keyword">}</span></span><span class="keyword">(</span>p2<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [filename_get_base]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
filename_test_base
  <span class="keyword">(</span>name<span class="keyword">,</span> base0<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">fpf</span> <span class="keyword">|</span> base<span class="keyword">)</span> <span class="keyword">=</span> filename_get_base <span class="keyword">(</span>name<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> ans <span class="keyword">=</span> eq_string_string <span class="keyword">(</span>base0<span class="keyword">,</span> $UN<span class="keyword">.</span>strptr2string<span class="keyword">(</span>base<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fpf <span class="keyword">(</span>base<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  ans
<span class="keyword">end</span></span> <span class="comment">// end of [filename_test_base]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
//
// HX-2013-04:
// this is now implemented in [filebas.cats].
//
local

extern
castfn file_mode
  {fm:file_mode} (x: string):&lt;&gt; file_mode (fm)
// end of [extern]

in (* in of [local] *)

implement file_mode_r = file_mode ("r")
implement file_mode_rr = file_mode ("r+")
implement file_mode_w = file_mode ("w")
implement file_mode_ww = file_mode ("w+")
implement file_mode_a = file_mode ("a")
implement file_mode_aa = file_mode ("a+")

end // end of [local]
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">extern</span>
<span class="dynexp"><span class="keyword">castfn</span>
__cast_filp <span class="keyword">(</span>r<span class="keyword">:</span> <span class="staexp">FILEref</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">FILEptr1</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
test_file_mode
  <span class="keyword">(</span>path<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="keyword">typedef</span> <span class="staexp">stat <span class="keyword">=</span> <span class="staexp">$STAT<span class="keyword">.</span>stat</span></span>
<span class="comment">//</span>
<span class="keyword">var</span> st<span class="keyword">:</span> <span class="staexp">stat</span><span class="staexp">?</span>
<span class="dynexp"><span class="keyword">val</span> err <span class="keyword">=</span> $STAT<span class="keyword">.</span>stat <span class="keyword">(</span>path<span class="keyword">,</span> st<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">if</span> err &gt;= <span class="dynexp">0</span>
<span class="keyword">then</span> <span class="keyword">let</span>
  <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> opt_unsome<span class="staexp"><span class="keyword">{</span>stat<span class="keyword">}</span></span><span class="keyword">(</span>st<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> test <span class="keyword">=</span>
  test_file_mode$pred&lt;<span class="keyword">&gt;</span> <span class="keyword">(</span>$UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>uint<span class="keyword">}</span></span><span class="keyword">(</span>st<span class="dynexp"><span class="keyword">.</span>st_mode</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="keyword">in</span>
  <span class="keyword">if</span> test <span class="keyword">then</span> <span class="dynexp">1</span><span class="comment">(*true*)</span> <span class="keyword">else</span> <span class="dynexp">0</span><span class="comment">(*false*)</span>
<span class="keyword">end</span> <span class="comment">// end of [then]</span>
<span class="keyword">else</span> <span class="keyword">let</span>
  <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> opt_unnone<span class="staexp"><span class="keyword">{</span>stat<span class="keyword">}</span></span><span class="keyword">(</span>st<span class="keyword">)</span></span> <span class="keyword">in</span> <span class="keyword">~</span><span class="dynexp">1</span><span class="comment">(*failure*)</span>
<span class="keyword">end</span> <span class="comment">// end of [else]</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [test_file_mode]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
fileref_open_opt
  <span class="keyword">(</span>path<span class="keyword">,</span> fm<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span>
filp <span class="keyword">=</span> $STDIO<span class="keyword">.</span>fopen <span class="keyword">(</span>path<span class="keyword">,</span> fm<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span>
isnot <span class="keyword">=</span> $STDIO<span class="keyword">.</span>FILEptr2ptr<span class="keyword">(</span>filp<span class="keyword">)</span> <span class="keyword">&gt;</span> <span class="dynexp">0</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">if</span>
isnot
<span class="keyword">then</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> filr <span class="keyword">=</span>
  $STDIO<span class="keyword">.</span>FILEptr_refize<span class="keyword">(</span>filp<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  Some_vt<span class="staexp"><span class="keyword">{</span>FILEref<span class="keyword">}</span></span><span class="keyword">(</span>filr<span class="keyword">)</span> <span class="comment">// success</span>
<span class="keyword">end</span> <span class="comment">// end of [then]</span>
<span class="keyword">else</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span>
  $STDIO<span class="keyword">.</span>FILEptr_free_null<span class="keyword">(</span>filp<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  None_vt<span class="staexp"><span class="keyword">{</span>FILEref<span class="keyword">}</span></span><span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span> <span class="comment">// failure</span>
<span class="keyword">end</span> <span class="comment">// end of [else]</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [fileref_open_opt]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
//
// HX: atspre_fileref_close
//
implement
fileref_close (fil) = $STDIO.fclose0_exn (fil)
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
//
// HX: atspre_fileref_flush
//
implement
fileref_flush (fil) = $STDIO.fflush0_exn (fil)
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
//
// HX: atspre_fileref_getc
//
implement fileref_getc (inp) = $STDIO.fgetc0 (inp)
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
//
// HX: atspre_fileref_putc_int
// HX: atspre_fileref_putc_char
//
implement
fileref_putc_int (out, c) = let
  val _(*ignored*) = $STDIO.fputc0 (c, out) in (*nothing*)
end // end of [fileref_putc_int]
implement
fileref_putc_char (out, c) = fileref_putc_int (out, (c2i)c)
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
//
// HX: atspre_fileref_puts
//
implement
fileref_puts (out, s) = let
  val _(*ignored*) = $STDIO.fputs0 (s, out) in (*nothing*)
end // end of [fileref_puts]
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
//
// HX: atspre_fileref_is_eof
//
implement
fileref_is_eof (fil) =
  if $STDIO.feof0 (fil) != 0 true else false
// end of [fileref_is_eof]
*)</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span> fileref_load&lt;<span class="staexp">int</span><span class="keyword">&gt;</span> <span class="keyword">=</span> fileref_load_int</span>
<span class="dynexp"><span class="keyword">implement</span> fileref_load&lt;<span class="staexp">lint</span><span class="keyword">&gt;</span> <span class="keyword">=</span> fileref_load_lint</span>
<span class="dynexp"><span class="keyword">implement</span> fileref_load&lt;<span class="staexp">uint</span><span class="keyword">&gt;</span> <span class="keyword">=</span> fileref_load_uint</span>
<span class="dynexp"><span class="keyword">implement</span> fileref_load&lt;<span class="staexp">ulint</span><span class="keyword">&gt;</span> <span class="keyword">=</span> fileref_load_ulint</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span> fileref_load&lt;<span class="staexp">float</span><span class="keyword">&gt;</span> <span class="keyword">=</span> fileref_load_float</span>
<span class="dynexp"><span class="keyword">implement</span> fileref_load&lt;<span class="staexp">double</span><span class="keyword">&gt;</span> <span class="keyword">=</span> fileref_load_double</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span>
fileref_get_optval <span class="keyword">(</span>r<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">var</span> x<span class="keyword">:</span> <span class="staexp">a</span><span class="staexp">?</span>
  <span class="dynexp"><span class="keyword">val</span> yn <span class="keyword">=</span> fileref_load&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>r<span class="keyword">,</span> x<span class="keyword">)</span></span>
<span class="keyword">in</span>
  option_vt_make_opt&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>yn<span class="keyword">,</span> x<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [fileref_get_optval]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span>
fileref_get_exnmsg
  <span class="keyword">(</span>r<span class="keyword">,</span> msg<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">var</span> x<span class="keyword">:</span> <span class="staexp">a</span><span class="staexp">?</span>
  <span class="dynexp"><span class="keyword">val</span> yn <span class="keyword">=</span> fileref_load&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>r<span class="keyword">,</span> x<span class="keyword">)</span></span>
<span class="keyword">in</span>
  <span class="keyword">if</span> yn <span class="keyword">then</span> <span class="keyword">let</span>
    <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> opt_unsome <span class="keyword">(</span>x<span class="keyword">)</span></span> <span class="keyword">in</span> x
  <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">let</span>
    <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> opt_unnone <span class="keyword">(</span>x<span class="keyword">)</span></span> <span class="keyword">in</span> exit_errmsg <span class="keyword">(</span><span class="dynexp">1</span><span class="keyword">,</span> msg<span class="keyword">)</span>
  <span class="keyword">end</span> <span class="comment">(* end of [if] *)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [fileref_get_exnmsg]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
fileref_get_line_charlst
  <span class="keyword">(</span>inp<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> EOL <span class="keyword">=</span> <span class="dynexp">'\n'</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> loop
<span class="keyword">(</span>
  inp<span class="keyword">:</span> <span class="staexp">FILEref</span><span class="keyword">,</span> res<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">ptr</span><span class="staexp">?</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">charlst_vt</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> i <span class="keyword">=</span> fileref_getc <span class="keyword">(</span>inp<span class="keyword">)</span></span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">if</span> i &gt;= <span class="dynexp">0</span> <span class="keyword">then</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> c <span class="keyword">=</span> int2char0<span class="keyword">(</span>i<span class="keyword">)</span></span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">if</span> <span class="keyword">(</span>c != EOL<span class="keyword">)</span> <span class="keyword">then</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span>
  <span class="keyword">(</span>
    res :=
    list_vt_cons<span class="staexp"><span class="keyword">{</span>char<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>0<span class="keyword">}</span></span><span class="keyword">(</span>c<span class="keyword">,</span> _<span class="keyword">)</span>
  <span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val+</span>list_vt_cons <span class="keyword">(</span>_<span class="keyword">,</span> res1<span class="keyword">)</span> <span class="keyword">=</span> res</span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> loop <span class="keyword">(</span>inp<span class="keyword">,</span> res1<span class="keyword">)</span></span>
  <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">fold@</span> <span class="keyword">(</span>res<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">in</span>
  <span class="comment">// nothing</span>
<span class="keyword">end</span></span> <span class="keyword">else</span> <span class="keyword">(</span>res := list_vt_nil<span class="keyword">)</span>
<span class="comment">//</span>
<span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">(</span>res := list_vt_nil<span class="keyword">)</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [loop]</span>
<span class="comment">//</span>
<span class="keyword">var</span> res<span class="keyword">:</span> <span class="staexp">ptr</span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> loop <span class="keyword">(</span>inp<span class="keyword">,</span> res<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  res
<span class="keyword">end</span></span> <span class="comment">// end of [fileref_get_line_charlst]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
fileref_get_lines_charlstlst
  <span class="keyword">(</span>inp<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="keyword">vtypedef</span> <span class="staexp">line <span class="keyword">=</span> <span class="staexp">charlst_vt</span></span>
<span class="keyword">vtypedef</span> <span class="staexp">lines <span class="keyword">=</span> <span class="staexp">List0_vt</span> <span class="keyword">(</span><span class="staexp">line</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> loop
<span class="keyword">(</span>
  inp<span class="keyword">:</span> <span class="staexp">FILEref</span>
<span class="keyword">,</span> res<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">lines</span><span class="staexp">?</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">lines</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> iseof <span class="keyword">=</span> fileref_is_eof <span class="keyword">(</span>inp<span class="keyword">)</span></span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">if</span> iseof <span class="keyword">then</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span>res := list_vt_nil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">in</span>
  <span class="comment">// nothing</span>
<span class="keyword">end</span></span> <span class="keyword">else</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> line <span class="keyword">=</span>
    fileref_get_line_charlst <span class="keyword">(</span>inp<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span>
  <span class="keyword">(</span>
    res := list_vt_cons<span class="staexp"><span class="keyword">{</span>line<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>0<span class="keyword">}</span></span><span class="keyword">(</span>line<span class="keyword">,</span> _<span class="keyword">)</span>
  <span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val+</span>list_vt_cons <span class="keyword">(</span>_<span class="keyword">,</span> res1<span class="keyword">)</span> <span class="keyword">=</span> res</span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> loop <span class="keyword">(</span>inp<span class="keyword">,</span> res1<span class="keyword">)</span></span>
  <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">fold@</span> <span class="keyword">(</span>res<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">in</span>
  <span class="comment">// nothing</span>
<span class="keyword">end</span></span> <span class="comment">// end of [if]</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [loop]</span>
<span class="comment">//</span>
<span class="keyword">var</span> res<span class="keyword">:</span> <span class="staexp">lines</span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> loop <span class="keyword">(</span>inp<span class="keyword">,</span> res<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  res
<span class="keyword">end</span></span> <span class="comment">// end of [fileref_get_lines_charlstlst]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
fileref_get_file_charlst
  <span class="keyword">(</span>inp<span class="keyword">)</span> <span class="keyword">=</span> fileref_get2_file_charlst <span class="keyword">(</span>inp<span class="keyword">,</span> <span class="keyword">~</span><span class="dynexp">1</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">local</span>

<span class="dynexp"><span class="keyword">fun</span> loop
<span class="keyword">(</span>
  inp<span class="keyword">:</span> <span class="staexp">FILEref</span>
<span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> res<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">ptr</span><span class="staexp">?</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">charlst_vt</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">int</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">if</span> n != <span class="dynexp">0</span> <span class="keyword">then</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> i <span class="keyword">=</span> fileref_getc <span class="keyword">(</span>inp<span class="keyword">)</span></span>
<span class="keyword">in</span>
  <span class="keyword">if</span> i &gt;= <span class="dynexp">0</span> <span class="keyword">then</span> <span class="keyword">let</span>
    <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span>
    <span class="keyword">(</span>
      res :=
      list_vt_cons<span class="staexp"><span class="keyword">{</span>char<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>0<span class="keyword">}</span></span><span class="keyword">(</span>i2c<span class="keyword">(</span>i<span class="keyword">)</span><span class="keyword">,</span> _<span class="keyword">)</span>
    <span class="keyword">)</span></span>
    <span class="dynexp"><span class="keyword">val+</span>list_vt_cons <span class="keyword">(</span>_<span class="keyword">,</span> res1<span class="keyword">)</span> <span class="keyword">=</span> res</span>
    <span class="dynexp"><span class="keyword">val</span> n <span class="keyword">=</span> loop <span class="keyword">(</span>inp<span class="keyword">,</span> pred<span class="keyword">(</span>n<span class="keyword">)</span><span class="keyword">,</span> res1<span class="keyword">)</span></span>
    <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">fold@</span> <span class="keyword">(</span>res<span class="keyword">)</span></span>
  <span class="keyword">in</span>
    n
  <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">let</span>
    <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> res := list_vt_nil <span class="keyword">(</span><span class="keyword">)</span></span> <span class="keyword">in</span> <span class="keyword">(</span>n<span class="keyword">)</span>
  <span class="keyword">end</span> <span class="comment">// end of [if]</span>
<span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> res := list_vt_nil <span class="keyword">(</span><span class="keyword">)</span></span> <span class="keyword">in</span> n<span class="comment">(*=0*)</span>
<span class="keyword">end</span> <span class="comment">// end of [if]</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [loop]</span>

<span class="keyword">in</span> <span class="comment">(* in of [local] *)</span>

<span class="dynexp"><span class="keyword">implement</span>
fileref_get2_file_charlst
  <span class="keyword">(</span>inp<span class="keyword">,</span> n<span class="keyword">)</span> <span class="keyword">=</span> res <span class="keyword">where</span>
<span class="keyword">{</span>
  <span class="keyword">var</span> res<span class="keyword">:</span> <span class="staexp">ptr</span><span class="keyword">;</span> <span class="dynexp"><span class="keyword">val</span> _<span class="comment">(*nleft*)</span> <span class="keyword">=</span> loop <span class="keyword">(</span>inp<span class="keyword">,</span> n<span class="keyword">,</span> res<span class="keyword">)</span></span>
<span class="keyword">}</span></span> <span class="comment">// end of [fileref_nget_file_charlst]</span>

<span class="keyword">end</span> <span class="comment">// end of [local]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
fileref_put_charlst
  <span class="keyword">(</span>out<span class="keyword">,</span> cs<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> loop
<span class="keyword">(</span>
  out<span class="keyword">:</span> <span class="staexp">FILEref</span><span class="keyword">,</span> cs<span class="keyword">:</span> <span class="staexp">List</span><span class="keyword">(</span><span class="staexp">char</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">case+</span> cs <span class="keyword">of</span>
<span class="keyword">|</span> list_cons <span class="keyword">(</span>c<span class="keyword">,</span> cs<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
    <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fileref_putc <span class="keyword">(</span>out<span class="keyword">,</span> c<span class="keyword">)</span></span> <span class="keyword">in</span> loop <span class="keyword">(</span>out<span class="keyword">,</span> cs<span class="keyword">)</span>
  <span class="keyword">end</span> <span class="comment">// end of [list_cons]</span>
<span class="keyword">|</span> list_nil <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [loop]</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  loop <span class="keyword">(</span>out<span class="keyword">,</span> cs<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [fileref_put_charlst]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
fileref_get_line_string$bufsize <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="dynexp">64</span></span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
fileref_get_file_string$bufsize <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="dynexp">1024</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
fileref_get_line_string
  <span class="keyword">(</span>inp<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="keyword">var</span> nlen<span class="keyword">:</span> <span class="staexp">int</span> <span class="comment">// uninitialized</span>
<span class="dynexp"><span class="keyword">val</span> line <span class="keyword">=</span> fileref_get_line_string_main <span class="keyword">(</span>inp<span class="keyword">,</span> nlen<span class="keyword">)</span></span>
<span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> lemma_strnptr_param <span class="keyword">(</span>line<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  strnptr2strptr <span class="keyword">(</span>line<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [fileref_get_line_string]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
fileref_get_line_string_main
  <span class="keyword">(</span>inp<span class="keyword">,</span> nlen<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> bsz <span class="keyword">=</span>
fileref_get_line_string$bufsize <span class="keyword">(</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">[</span><span class="staexp">l<span class="keyword">:</span>addr</span><span class="keyword">,</span><span class="staexp">n<span class="keyword">:</span>int</span><span class="keyword">]</span> str <span class="keyword">=</span> <span class="dynexp"><span class="keyword">$extfcall</span>
<span class="keyword">(</span>
Strnptr0<span class="keyword">,</span> "atspre_fileref_get_line_string_main2"<span class="keyword">,</span> bsz<span class="keyword">,</span> inp<span class="keyword">,</span> <span class="keyword">addr@</span><span class="keyword">(</span>nlen<span class="keyword">)</span>
<span class="keyword">)</span></span></span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> lemma_strnptr_param <span class="keyword">(</span>str<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">extern</span>
<span class="prfexp"><span class="keyword">praxi</span>
__assert <span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span> <span class="keyword">(</span>pf<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">int</span><span class="staexp">?</span> <span class="staexp"><span class="keyword">@</span></span> <span class="staexp">l</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">int</span> <span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span> <span class="staexp"><span class="keyword">@</span></span> <span class="staexp">l</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> __assert <span class="keyword">(</span><span class="dynexp"><span class="keyword">view@</span></span><span class="keyword">(</span>nlen<span class="keyword">)</span><span class="keyword">)</span></span> 
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> isnot <span class="keyword">=</span> strnptr_isnot_null <span class="keyword">(</span>str<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">if</span> isnot <span class="keyword">then</span> str <span class="keyword">else</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span>
  <span class="keyword">)</span> <span class="keyword">=</span> exit_errmsg_void <span class="keyword">(</span><span class="dynexp">1</span><span class="keyword">,</span> <span class="dynstr">"[fileref_get_line_string] failed."</span><span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> assert <span class="keyword">(</span>nlen &gt;= <span class="dynexp">0</span><span class="keyword">)</span></span> <span class="comment">// HX: for TC // deadcode at run-time</span>
<span class="keyword">in</span>
  str <span class="comment">// HX: [str]=null is not returned</span>
<span class="keyword">end</span> <span class="comment">(* end of [if] *)</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [fileref_get_line_string_main]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
fileref_get_lines_stringlst
  <span class="keyword">(</span>inp<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="keyword">vtypedef</span> <span class="staexp">line <span class="keyword">=</span> <span class="staexp">Strptr1</span></span>
<span class="keyword">vtypedef</span> <span class="staexp">lines <span class="keyword">=</span> <span class="staexp">List0_vt</span> <span class="keyword">(</span><span class="staexp">line</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> loop
<span class="keyword">(</span>
  inp<span class="keyword">:</span> <span class="staexp">FILEref</span>
<span class="keyword">,</span> res<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">lines</span><span class="staexp">?</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">lines</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> iseof <span class="keyword">=</span> fileref_is_eof <span class="keyword">(</span>inp<span class="keyword">)</span></span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">if</span> iseof <span class="keyword">then</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span>res := list_vt_nil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">in</span>
  <span class="comment">// nothing</span>
<span class="keyword">end</span></span> <span class="keyword">else</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> line <span class="keyword">=</span>
    fileref_get_line_string <span class="keyword">(</span>inp<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span>
  <span class="keyword">(</span>
    res := list_vt_cons<span class="staexp"><span class="keyword">{</span>line<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>0<span class="keyword">}</span></span><span class="keyword">(</span>line<span class="keyword">,</span> _<span class="keyword">)</span>
  <span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val+</span>list_vt_cons <span class="keyword">(</span>_<span class="keyword">,</span> res1<span class="keyword">)</span> <span class="keyword">=</span> res</span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> loop <span class="keyword">(</span>inp<span class="keyword">,</span> res1<span class="keyword">)</span></span>
  <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">fold@</span> <span class="keyword">(</span>res<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">in</span>
  <span class="comment">// nothing</span>
<span class="keyword">end</span></span> <span class="comment">// end of [if]</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [loop]</span>
<span class="comment">//</span>
<span class="keyword">var</span> res<span class="keyword">:</span> <span class="staexp">lines</span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> loop <span class="keyword">(</span>inp<span class="keyword">,</span> res<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  res
<span class="keyword">end</span></span> <span class="comment">// end of [fileref_get_lines_stringlst]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
fileref_get_file_string
  <span class="keyword">(</span>inp<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> loop
<span class="keyword">(</span>
  inp<span class="keyword">:</span> <span class="staexp">FILEref</span>
<span class="keyword">,</span> p0<span class="keyword">:</span> <span class="staexp">ptr</span><span class="keyword">,</span> n0<span class="keyword">:</span> <span class="staexp">size_t</span>
<span class="keyword">,</span> p1<span class="keyword">:</span> <span class="staexp">ptr</span><span class="keyword">,</span> n1<span class="keyword">:</span> <span class="staexp">size_t</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">Strptr1</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="neuexp"><span class="keyword">#define</span> CNUL '\000'</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> nw <span class="keyword">=</span>
<span class="dynexp"><span class="keyword">$extfcall</span><span class="keyword">(</span>size_t<span class="keyword">,</span> "atslib_libc_fread"<span class="keyword">,</span> p1<span class="keyword">,</span> 1<span class="keyword">,</span> n1<span class="keyword">,</span> inp<span class="keyword">)</span></span></span>
<span class="comment">//</span>
<span class="keyword">in</span> <span class="comment">(* in-of-let *)</span>
<span class="comment">//</span>
<span class="keyword">if</span>
<span class="keyword">(</span>nw <span class="keyword">&gt;</span> <span class="dynexp">0</span><span class="keyword">)</span>
<span class="keyword">then</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> n1 <span class="keyword">=</span> n1 - nw</span>
  <span class="dynexp"><span class="keyword">val</span> p1 <span class="keyword">=</span> add_ptr_bsz <span class="keyword">(</span>p1<span class="keyword">,</span> nw<span class="keyword">)</span></span>
<span class="keyword">in</span>
  <span class="keyword">if</span> n1 <span class="keyword">&gt;</span> <span class="dynexp">0</span> <span class="keyword">then</span>
    loop <span class="keyword">(</span>inp<span class="keyword">,</span> p0<span class="keyword">,</span> n0<span class="keyword">,</span> p1<span class="keyword">,</span> n1<span class="keyword">)</span> <span class="keyword">else</span> loop2 <span class="keyword">(</span>inp<span class="keyword">,</span> p0<span class="keyword">,</span> n0<span class="keyword">)</span>
  <span class="comment">// end of [if]</span>
<span class="keyword">end</span> <span class="comment">// end of [then]</span>
<span class="keyword">else</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> $UN<span class="keyword">.</span>ptr0_set&lt;<span class="staexp">char</span><span class="keyword">&gt;</span> <span class="keyword">(</span>p1<span class="keyword">,</span> CNUL<span class="keyword">)</span></span> <span class="keyword">in</span> $UN<span class="keyword">.</span>castvwtp0<span class="staexp"><span class="keyword">{</span>Strptr1<span class="keyword">}</span></span><span class="keyword">(</span>p0<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [else]</span>
<span class="comment">//</span>
<span class="keyword">end</span> <span class="comment">// end of [loop]</span>
<span class="comment">//</span>
<span class="keyword">and</span> loop2
<span class="keyword">(</span>
  inp<span class="keyword">:</span> <span class="staexp">FILEref</span><span class="keyword">,</span> p0<span class="keyword">:</span> <span class="staexp">ptr</span><span class="keyword">,</span> n0<span class="keyword">:</span> <span class="staexp">size_t</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">Strptr1</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> bsz <span class="keyword">=</span> succ<span class="keyword">(</span>n0<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> bsz2 <span class="keyword">=</span> g1ofg0<span class="keyword">(</span>bsz + bsz<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pf</span><span class="keyword">,</span> <span class="prfexp">pfgc</span> <span class="keyword">|</span> p0_<span class="keyword">)</span> <span class="keyword">=</span> malloc_gc <span class="keyword">(</span>bsz2<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> p0_ <span class="keyword">=</span> $UN<span class="keyword">.</span>castvwtp0<span class="staexp"><span class="keyword">{</span>ptr<span class="keyword">}</span></span><span class="keyword">(</span><span class="keyword">(</span><span class="prfexp">pf</span><span class="keyword">,</span> <span class="prfexp">pfgc</span> <span class="keyword">|</span> p0_<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
  <span class="dynexp"><span class="keyword">val</span> _<span class="comment">(*ptr*)</span> <span class="keyword">=</span> <span class="dynexp"><span class="keyword">$extfcall</span><span class="keyword">(</span>ptr<span class="keyword">,</span> "atslib_libc_memcpy"<span class="keyword">,</span> p0_<span class="keyword">,</span> p0<span class="keyword">,</span> n0<span class="keyword">)</span></span></span>
<span class="comment">//</span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> strptr_free <span class="keyword">(</span>$UN<span class="keyword">.</span>castvwtp0<span class="staexp"><span class="keyword">{</span>Strptr1<span class="keyword">}</span></span><span class="keyword">(</span>p0<span class="keyword">)</span><span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> n0_ <span class="keyword">=</span> pred<span class="keyword">(</span>g0ofg1<span class="keyword">(</span>bsz2<span class="keyword">)</span><span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> p1_ <span class="keyword">=</span> add_ptr_bsz <span class="keyword">(</span>p0_<span class="keyword">,</span> n0<span class="keyword">)</span></span>
<span class="keyword">in</span>
  loop <span class="keyword">(</span>inp<span class="keyword">,</span> p0_<span class="keyword">,</span> n0_<span class="keyword">,</span> p1_<span class="keyword">,</span> bsz<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [loop2]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> bsz <span class="keyword">=</span>
  fileref_get_file_string$bufsize <span class="keyword">(</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> bsz <span class="keyword">=</span> i2sz<span class="keyword">(</span>bsz<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pf</span><span class="keyword">,</span> <span class="prfexp">pfgc</span> <span class="keyword">|</span> p0_<span class="keyword">)</span> <span class="keyword">=</span> malloc_gc <span class="keyword">(</span>bsz<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> p0_ <span class="keyword">=</span> $UN<span class="keyword">.</span>castvwtp0<span class="staexp"><span class="keyword">{</span>ptr<span class="keyword">}</span></span><span class="keyword">(</span><span class="keyword">(</span><span class="prfexp">pf</span><span class="keyword">,</span> <span class="prfexp">pfgc</span> <span class="keyword">|</span> p0_<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> n0_ <span class="keyword">=</span> pred<span class="keyword">(</span>bsz<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  loop <span class="keyword">(</span>inp<span class="keyword">,</span> p0_<span class="keyword">,</span> n0_<span class="keyword">,</span> p0_<span class="keyword">,</span> n0_<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [fileref_get_file_string]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="extcode"><span class="extcode">%{
extern
atstype_ptr
atspre_fileref_get_line_string_main2
(
  atstype_int bsz0
, atstype_ptr filp0
, atstype_ref nlen // int *nlen
)
{
//
  int bsz = bsz0 ;
  FILE *filp = (FILE*)filp0 ;
  int ofs = 0, ofs2 ;
  char *buf, *buf2, *pres ;
  buf = atspre_malloc_gc(bsz) ;
//
  while (1) {
    buf2 = buf+ofs ;
    pres = fgets(buf2, bsz-ofs, filp) ;
    if (!pres)
    {
      if (feof(filp))
      {
        *buf2 = '\000' ;
        *(int*)nlen = ofs ; return buf ;
      } else {
        atspre_mfree_gc(buf) ;
        *(int*)nlen = -1 ; return (char*)0 ;
      } // end of [if]
    }
    ofs2 = strlen(buf2) ;
    if (ofs2==0) return buf ;
    ofs += ofs2 ; // HX: ofs &gt; 0
//
// HX: the newline symbol needs to be trimmed:
//
    if (buf[ofs-1]=='\n')
    {
      buf[ofs-1] = '\0'; *(int*)nlen = ofs-1 ; return buf ;
    }
//
// HX: there is room // so there are no more chars:
//
    if (ofs+1 &lt; bsz) { *(int*)nlen = ofs ; return buf ; }
//
// HX: there is no room // so another call to [fgets] is needed:
//
    bsz *= 2 ;
    buf2 = buf ; buf = atspre_malloc_gc(bsz) ; memcpy(buf, buf2, ofs) ;
    atspre_mfree_gc(buf2) ;
  } // end of [while]
//
  return buf ; // HX: deadcode
//
} // end of [atspre_fileref_get_line_string_main2]
%}</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
fileref_get_word <span class="keyword">(</span>inp<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="keyword">vtypedef</span>
<span class="staexp">res <span class="keyword">=</span> <span class="staexp">List0_vt</span><span class="keyword">(</span><span class="staexp">charNZ</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
loop1 <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">res</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> c <span class="keyword">=</span> $STDIO<span class="keyword">.</span>fgetc0 <span class="keyword">(</span>inp<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">if</span>
<span class="keyword">(</span>c <span class="keyword">&gt;</span> <span class="dynexp">0</span><span class="keyword">)</span>
<span class="keyword">then</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> c <span class="keyword">=</span> $UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>charNZ<span class="keyword">}</span></span><span class="keyword">(</span>c<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> test <span class="keyword">=</span> fileref_get_word$isalpha&lt;<span class="keyword">&gt;</span> <span class="keyword">(</span>c<span class="keyword">)</span></span>
<span class="keyword">in</span>
  <span class="keyword">if</span> test <span class="keyword">then</span> loop2 <span class="keyword">(</span>c<span class="keyword">,</span> list_vt_nil<span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">else</span> loop1 <span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [then]</span>
<span class="keyword">else</span> list_vt_nil <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span>
<span class="comment">//</span>
<span class="keyword">end</span> <span class="comment">// end of [loop1]</span>

<span class="keyword">and</span> loop2
<span class="keyword">(</span>
  c<span class="keyword">:</span> <span class="staexp">charNZ</span><span class="keyword">,</span> cs<span class="keyword">:</span> <span class="staexp">res</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">res</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> c2 <span class="keyword">=</span> $STDIO<span class="keyword">.</span>fgetc0 <span class="keyword">(</span>inp<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">if</span>
<span class="keyword">(</span>c2 <span class="keyword">&gt;</span> <span class="dynexp">0</span><span class="keyword">)</span>
<span class="keyword">then</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> c2 <span class="keyword">=</span> $UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>charNZ<span class="keyword">}</span></span><span class="keyword">(</span>c2<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> test <span class="keyword">=</span> fileref_get_word$isalpha&lt;<span class="keyword">&gt;</span> <span class="keyword">(</span>c2<span class="keyword">)</span></span>
<span class="keyword">in</span>
  <span class="keyword">if</span> test <span class="keyword">then</span> loop2 <span class="keyword">(</span>c2<span class="keyword">,</span> list_vt_cons<span class="keyword">(</span>c<span class="keyword">,</span> cs<span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">else</span> list_vt_cons<span class="keyword">(</span>c<span class="keyword">,</span> cs<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [then]</span>
<span class="keyword">else</span> list_vt_cons<span class="keyword">(</span>c<span class="keyword">,</span> cs<span class="keyword">)</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [loop2]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> cs <span class="keyword">=</span> loop1 <span class="keyword">(</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  <span class="keyword">case+</span> cs <span class="keyword">of</span>
  <span class="keyword">|</span> list_vt_cons _ <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="dynexp"><span class="keyword">val</span> str <span class="keyword">=</span>
        string_make_rlist <span class="keyword">(</span>$UN<span class="keyword">.</span>list_vt2t<span class="keyword">(</span>cs<span class="keyword">)</span><span class="keyword">)</span></span>
      <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> list_vt_free <span class="keyword">(</span>cs<span class="keyword">)</span></span>
    <span class="keyword">in</span>
      strnptr2strptr <span class="keyword">(</span>str<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [list_vt_cons]</span>
  <span class="keyword">|</span> <span class="keyword">~</span>list_vt_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> strptr_null <span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [fileref_get_word]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
fileref_get_word$isalpha <span class="keyword">(</span>charNZ<span class="keyword">)</span> <span class="keyword">=</span> isalpha <span class="keyword">(</span>charNZ<span class="keyword">)</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
fileref_foreach
  <span class="keyword">(</span>inp<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">var</span> env<span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">in</span>
  fileref_foreach_env <span class="keyword">(</span>inp<span class="keyword">,</span> env<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [fileref_foreach]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">local</span>
<span class="comment">//</span>
<span class="keyword">staload</span>
"libats/libc/SATS/stdio.sats"
<span class="comment">//</span>
<span class="keyword">extern</span>
<span class="dynexp"><span class="keyword">fun</span>
fread
<span class="keyword">(</span>
  <span class="staexp">ptr</span><span class="keyword">,</span> <span class="staexp">size_t</span><span class="keyword">,</span> <span class="staexp">size_t</span><span class="keyword">,</span> <span class="staexp">FILEref</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">Size</span> <span class="keyword">=</span> "mac#atslib_libc_fread"</span>
<span class="comment">//</span>
<span class="keyword">in</span> <span class="comment">(* in of [local] *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">env</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
fileref_foreach_env
   <span class="keyword">(</span>inp<span class="keyword">,</span> env<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> loop
  <span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  <span class="prfexp">pf<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">b0ytes</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span> <span class="staexp"><span class="keyword">@</span></span> <span class="staexp">l</span></span>
<span class="keyword">|</span> inp<span class="keyword">:</span> <span class="staexp">FILEref</span><span class="keyword">,</span> bufp<span class="keyword">:</span> <span class="staexp">ptr</span><span class="keyword">(</span><span class="staexp">l</span><span class="keyword">)</span><span class="keyword">,</span> bsz<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">env</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> bsz2 <span class="keyword">=</span> fread <span class="keyword">(</span>bufp<span class="keyword">,</span> i2sz<span class="keyword">(</span><span class="dynexp">1</span><span class="keyword">)</span><span class="keyword">,</span> bsz<span class="keyword">,</span> inp<span class="keyword">)</span></span>
<span class="prfexp"><span class="keyword">prval</span> <span class="keyword">[</span><span class="staexp">n2<span class="keyword">:</span>int</span><span class="keyword">]</span> EQINT<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> g1uint_get_index <span class="keyword">(</span>bsz2<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">if</span> bsz2 <span class="keyword">&gt;</span> <span class="dynexp">0</span> <span class="keyword">then</span>
<span class="keyword">{</span>
  <span class="dynexp"><span class="keyword">val</span> A <span class="keyword">=</span> $UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>arrayref<span class="keyword">(</span>char<span class="keyword">,</span>n2<span class="keyword">)</span><span class="keyword">}</span></span><span class="keyword">(</span>bufp<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fileref_foreach$fworkv&lt;<span class="staexp">env</span><span class="keyword">&gt;</span> <span class="keyword">(</span>A<span class="keyword">,</span> bsz2<span class="keyword">,</span> env<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span> <span class="keyword">=</span> loop <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> inp<span class="keyword">,</span> bufp<span class="keyword">,</span> bsz<span class="keyword">,</span> env<span class="keyword">)</span></span>
<span class="keyword">}</span> <span class="comment">(* end of [if] *)</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [loop]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> bsz <span class="keyword">=</span> fileref_foreach$bufsize&lt;<span class="keyword">&gt;</span> <span class="keyword">(</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pf1</span><span class="keyword">,</span> <span class="prfexp">pf2</span> <span class="keyword">|</span> bufp<span class="keyword">)</span> <span class="keyword">=</span> memory$alloc&lt;<span class="keyword">&gt;</span> <span class="keyword">(</span>bsz<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span> <span class="keyword">=</span> loop <span class="keyword">(</span><span class="prfexp">pf1</span> <span class="keyword">|</span> inp<span class="keyword">,</span> bufp<span class="keyword">,</span> bsz<span class="keyword">,</span> env<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span> <span class="keyword">=</span> memory$free&lt;<span class="keyword">&gt;</span> <span class="keyword">(</span><span class="prfexp">pf1</span><span class="keyword">,</span> <span class="prfexp">pf2</span> <span class="keyword">|</span> bufp<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">in</span>
  <span class="comment">// nothing</span>
<span class="keyword">end</span></span></span> <span class="comment">// end of [fileref_foreach_env]</span>

<span class="keyword">end</span> <span class="comment">// end of [local]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
fileref_foreach$bufsize<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> i2sz<span class="keyword">(</span><span class="dynexp">4</span>*<span class="dynexp">1024</span><span class="keyword">)</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">env</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
fileref_foreach$fworkv
  <span class="keyword">(</span>A<span class="keyword">,</span> n<span class="keyword">,</span> env<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">env</span><span class="keyword">}</span>
array_foreach$cont<span class="keyword">(</span>x<span class="keyword">,</span> env<span class="keyword">)</span> <span class="keyword">=</span> true</span>
<span class="dynexp"><span class="keyword">implement</span>
array_foreach$fwork&lt;<span class="staexp">char</span><span class="keyword">&gt;&lt;</span><span class="staexp">env</span><span class="keyword">&gt;</span>
  <span class="keyword">(</span>x<span class="keyword">,</span> env<span class="keyword">)</span> <span class="keyword">=</span> fileref_foreach$fwork&lt;<span class="staexp">env</span><span class="keyword">&gt;</span> <span class="keyword">(</span>x<span class="keyword">,</span> env<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  ignoret<span class="keyword">(</span>arrayref_foreach_env&lt;<span class="staexp">char</span><span class="keyword">&gt;&lt;</span><span class="staexp">env</span><span class="keyword">&gt;</span> <span class="keyword">(</span>A<span class="keyword">,</span> n<span class="keyword">,</span> env<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [fileref_foreach$fworkv]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
streamize_fileref_char
  <span class="keyword">(</span>inp<span class="keyword">)</span> <span class="keyword">=</span> auxmain<span class="keyword">(</span>inp<span class="keyword">)</span> <span class="keyword">where</span>
<span class="keyword">{</span>
<span class="comment">//</span>
<span class="keyword">typedef</span> <span class="staexp">elt <span class="keyword">=</span> <span class="staexp">char</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
auxmain
<span class="keyword">(</span>
  inp
<span class="keyword">:</span> <span class="staexp">FILEref</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">elt</span><span class="keyword">)</span><span class="keyword">=</span> <span class="dynexp"><span class="keyword">$ldelay</span>
<span class="keyword">(</span>
<span class="comment">//</span>
<span class="keyword">let</span>
  <span class="keyword">val</span> c0 <span class="keyword">=</span> fileref_getc<span class="keyword">(</span>inp<span class="keyword">)</span>
<span class="keyword">in</span>
  <span class="keyword">if</span> c0 &gt;= 0
    <span class="keyword">then</span> <span class="keyword">(</span>
      stream_vt_cons<span class="keyword">(</span>int2char0<span class="keyword">(</span>c0<span class="keyword">)</span><span class="keyword">,</span> auxmain<span class="keyword">(</span>inp<span class="keyword">)</span><span class="keyword">)</span>
    <span class="keyword">)</span> <span class="keyword">else</span> <span class="keyword">(</span>
<span class="comment">(*
      fileref_close(inp); // HX: FILEref is not freed!
*)</span>
      stream_vt_nil<span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span>
    <span class="keyword">)</span> <span class="comment">(* else *)</span>
  <span class="comment">// end of [[if]</span>
<span class="keyword">end</span> <span class="keyword">:</span> stream_vt_con<span class="keyword">(</span>elt<span class="keyword">)</span>
<span class="comment">//</span>
<span class="comment">(*
,
//
fileref_close(inp) // HX-2016-09-12: FILEref is not freed!
//
*)</span>
<span class="keyword">)</span></span></span> <span class="comment">(* end of [auxmain] *)</span>
<span class="comment">//</span>
<span class="keyword">}</span></span> <span class="comment">(* end of [streamize_fileref_char] *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
streamize_fileref_line
  <span class="keyword">(</span>inp<span class="keyword">)</span> <span class="keyword">=</span> auxmain<span class="keyword">(</span>inp<span class="keyword">)</span> <span class="keyword">where</span>
<span class="keyword">{</span>
<span class="comment">//</span>
<span class="keyword">vtypedef</span> <span class="staexp">elt <span class="keyword">=</span> <span class="staexp">Strptr1</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
auxmain
<span class="keyword">(</span>
  inp
<span class="keyword">:</span> <span class="staexp">FILEref</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">elt</span><span class="keyword">)</span><span class="keyword">=</span> <span class="dynexp"><span class="keyword">$ldelay</span>
<span class="keyword">(</span>
<span class="comment">//</span>
<span class="keyword">let</span>
  <span class="keyword">val</span> iseof <span class="keyword">=</span> fileref_is_eof<span class="keyword">(</span>inp<span class="keyword">)</span>
<span class="keyword">in</span>
  <span class="keyword">if</span> iseof
    <span class="keyword">then</span> <span class="keyword">let</span>
<span class="comment">(*
      val () =
        fileref_close(inp)
      // end of [val]
*)</span>
    <span class="keyword">in</span>
      stream_vt_nil<span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [then]</span>
    <span class="keyword">else</span> <span class="keyword">let</span>
      <span class="keyword">val</span> line <span class="keyword">=</span>
        fileref_get_line_string<span class="keyword">(</span>inp<span class="keyword">)</span>
      <span class="comment">// end of [val]</span>
    <span class="keyword">in</span>
      stream_vt_cons<span class="keyword">(</span>line<span class="keyword">,</span> auxmain<span class="keyword">(</span>inp<span class="keyword">)</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [else]</span>
<span class="keyword">end</span> <span class="keyword">:</span> stream_vt_con<span class="keyword">(</span>elt<span class="keyword">)</span>
<span class="comment">//</span>
<span class="comment">(*
,
//
fileref_close(inp) // HX-2016-09-12: FILEref is not freed!
//
*)</span>
<span class="keyword">)</span></span></span> <span class="comment">(* end of [auxmain] *)</span>
<span class="comment">//</span>
<span class="keyword">}</span></span> <span class="comment">(* end of [streamize_fileref_line] *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* end of [filebas.dats] *)</span>
</pre>
<pre class="patsyntax">
<span class="comment">(***********************************************************************)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(*                         Applied Type System                         *)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(***********************************************************************)</span>

<span class="comment">(*
** ATS/Postiats - Unleashing the Potential of Types!
** Copyright (C) 2010-2015 Hongwei Xi, ATS Trustful Software, Inc.
** All rights reserved
**
** ATS is free software;  you can  redistribute it and/or modify it under
** the terms of  the GNU GENERAL PUBLIC LICENSE (GPL) as published by the
** Free Software Foundation; either version 3, or (at  your  option)  any
** later version.
**
** ATS is distributed in the hope that it will be useful, but WITHOUT ANY
** WARRANTY; without  even  the  implied  warranty  of MERCHANTABILITY or
** FITNESS FOR A PARTICULAR PURPOSE.  See the  GNU General Public License
** for more details.
**
** You  should  have  received  a  copy of the GNU General Public License
** along  with  ATS;  see the  file COPYING.  If not, please write to the
** Free Software Foundation,  51 Franklin Street, Fifth Floor, Boston, MA
** 02110-1301, USA.
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
** Source:
** $PATSHOME/prelude/DATS/CODEGEN/intrange.atxt
** Time of generation: Sun Oct  2 10:33:57 2016
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* Author: Hongwei Xi *)</span>
<span class="comment">(* Authoremail: hwxi AT cs DOT bu DOT edu *)</span>
<span class="comment">(* Start time: June, 2012 *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span>
intrange_foreach
  <span class="keyword">(</span>l<span class="keyword">,</span> r<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">var</span> env<span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">in</span>
  intrange_foreach_env&lt;<span class="staexp">void</span><span class="keyword">&gt;</span> <span class="keyword">(</span>l<span class="keyword">,</span> r<span class="keyword">,</span> env<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [intrange_foreach]</span>

<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">tenv</span><span class="keyword">}</span>
intrange_foreach_env
  <span class="keyword">(</span>l<span class="keyword">,</span> r<span class="keyword">,</span> env<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> loop
<span class="keyword">(</span>
  l<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> r<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">tenv</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">int</span> <span class="keyword">=</span>
<span class="keyword">(</span>
<span class="comment">//</span>
<span class="keyword">if</span>
l <span class="keyword">&lt;</span> r
<span class="keyword">then</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> cont <span class="keyword">=</span> intrange_foreach$cont&lt;<span class="staexp">tenv</span><span class="keyword">&gt;</span> <span class="keyword">(</span>l<span class="keyword">,</span> env<span class="keyword">)</span></span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">if</span>
cont
<span class="keyword">then</span> <span class="keyword">(</span>
  intrange_foreach$fwork&lt;<span class="staexp">tenv</span><span class="keyword">&gt;</span> <span class="keyword">(</span>l<span class="keyword">,</span> env<span class="keyword">)</span><span class="keyword">;</span> loop <span class="keyword">(</span>succ<span class="keyword">(</span>l<span class="keyword">)</span><span class="keyword">,</span> r<span class="keyword">,</span> env<span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">else</span> l <span class="comment">// end of [if]</span>
<span class="comment">//</span>
<span class="keyword">end</span> <span class="comment">// end of [then]</span>
<span class="keyword">else</span> l <span class="comment">// end of [else]</span>
<span class="comment">//</span>
<span class="keyword">)</span></span> <span class="comment">// end of [loop]</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  loop <span class="keyword">(</span>l<span class="keyword">,</span> r<span class="keyword">,</span> env<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [intrange_foreach_env]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">env</span><span class="keyword">}</span>
intrange_foreach$cont <span class="keyword">(</span>i<span class="keyword">,</span> env<span class="keyword">)</span> <span class="keyword">=</span> true</span>
<span class="comment">(*
implement{env}
intrange_foreach$fwork (i, env) = ((*void*))
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
int_foreach_cloref
  <span class="keyword">(</span>n<span class="keyword">,</span> fwork<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span>
<span class="comment">//</span>
intrange_foreach_cloref&lt;<span class="keyword">&gt;</span> <span class="keyword">(</span><span class="dynexp">0</span><span class="keyword">,</span> n<span class="keyword">,</span> fwork<span class="keyword">)</span>
<span class="comment">//</span>
<span class="keyword">)</span></span> <span class="comment">(* end of [int_foreach_cloref] *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
intrange_foreach_cloref
  <span class="keyword">(</span>l<span class="keyword">,</span> r<span class="keyword">,</span> fwork<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">(</span><span class="staexp">env</span><span class="keyword">)</span><span class="comment">(*tmp*)</span>
intrange_foreach$cont&lt;<span class="staexp">env</span><span class="keyword">&gt;</span> <span class="keyword">(</span>i<span class="keyword">,</span> env<span class="keyword">)</span> <span class="keyword">=</span> true</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">(</span><span class="staexp">env</span><span class="keyword">)</span><span class="comment">(*tmp*)</span>
intrange_foreach$fwork&lt;<span class="staexp">env</span><span class="keyword">&gt;</span><span class="keyword">(</span>i<span class="keyword">,</span> env<span class="keyword">)</span> <span class="keyword">=</span> fwork<span class="keyword">(</span>i<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">var</span> env<span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">)</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  intrange_foreach_env&lt;<span class="staexp">void</span><span class="keyword">&gt;</span> <span class="keyword">(</span>l<span class="keyword">,</span> r<span class="keyword">,</span> env<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [intrange_foreach_cloref]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span>
intrange_rforeach
  <span class="keyword">(</span>l<span class="keyword">,</span> r<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">var</span> env<span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">in</span>
  intrange_rforeach_env&lt;<span class="staexp">void</span><span class="keyword">&gt;</span> <span class="keyword">(</span>l<span class="keyword">,</span> r<span class="keyword">,</span> env<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [intrange_rforeach]</span>

<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">tenv</span><span class="keyword">}</span>
intrange_rforeach_env
  <span class="keyword">(</span>l<span class="keyword">,</span> r<span class="keyword">,</span> env<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> loop
<span class="keyword">(</span>
  l<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> r<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">tenv</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">int</span> <span class="keyword">=</span>
<span class="keyword">(</span>
<span class="comment">//</span>
<span class="keyword">if</span>
l <span class="keyword">&lt;</span> r
<span class="keyword">then</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> r1 <span class="keyword">=</span> pred <span class="keyword">(</span>r<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> cont <span class="keyword">=</span> intrange_rforeach$cont&lt;<span class="staexp">tenv</span><span class="keyword">&gt;</span> <span class="keyword">(</span>r1<span class="keyword">,</span> env<span class="keyword">)</span></span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">if</span>
cont
<span class="keyword">then</span> <span class="keyword">(</span>
  intrange_rforeach$fwork&lt;<span class="staexp">tenv</span><span class="keyword">&gt;</span> <span class="keyword">(</span>r1<span class="keyword">,</span> env<span class="keyword">)</span><span class="keyword">;</span> loop <span class="keyword">(</span>l<span class="keyword">,</span> r1<span class="keyword">,</span> env<span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">else</span> r <span class="comment">// end of [if]</span>
<span class="comment">//</span>
<span class="keyword">end</span> <span class="comment">// end of [then]</span>
<span class="keyword">else</span> r <span class="comment">// end of [else]</span>
<span class="comment">//</span>
<span class="keyword">)</span></span> <span class="comment">// end of [loop]</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  loop <span class="keyword">(</span>l<span class="keyword">,</span> r<span class="keyword">,</span> env<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [intrange_rforeach_env]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">env</span><span class="keyword">}</span>
intrange_rforeach$cont <span class="keyword">(</span>i<span class="keyword">,</span> env<span class="keyword">)</span> <span class="keyword">=</span> true</span>
<span class="comment">(*
implement{env}
intrange_rforeach$fwork (i, env) = ((*void*))
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
int_rforeach_cloref
  <span class="keyword">(</span>n<span class="keyword">,</span> fwork<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span>
<span class="comment">//</span>
intrange_rforeach_cloref&lt;<span class="keyword">&gt;</span> <span class="keyword">(</span><span class="dynexp">0</span><span class="keyword">,</span> n<span class="keyword">,</span> fwork<span class="keyword">)</span>
<span class="comment">//</span>
<span class="keyword">)</span></span> <span class="comment">(* end of [int_rforeach_cloref] *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
intrange_rforeach_cloref
  <span class="keyword">(</span>l<span class="keyword">,</span> r<span class="keyword">,</span> fwork<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">(</span><span class="staexp">env</span><span class="keyword">)</span><span class="comment">(*tmp*)</span>
intrange_rforeach$cont&lt;<span class="staexp">env</span><span class="keyword">&gt;</span> <span class="keyword">(</span>i<span class="keyword">,</span> env<span class="keyword">)</span> <span class="keyword">=</span> true</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">(</span><span class="staexp">env</span><span class="keyword">)</span><span class="comment">(*tmp*)</span>
intrange_rforeach$fwork&lt;<span class="staexp">env</span><span class="keyword">&gt;</span><span class="keyword">(</span>i<span class="keyword">,</span> env<span class="keyword">)</span> <span class="keyword">=</span> fwork<span class="keyword">(</span>i<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">var</span> env<span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">)</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  intrange_rforeach_env&lt;<span class="staexp">void</span><span class="keyword">&gt;</span> <span class="keyword">(</span>l<span class="keyword">,</span> r<span class="keyword">,</span> env<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [intrange_rforeach_cloref]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span>
intrange2_foreach
  <span class="keyword">(</span>l1<span class="keyword">,</span> r1<span class="keyword">,</span> l2<span class="keyword">,</span> r2<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">var</span> env<span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">in</span>
  intrange2_foreach_env&lt;<span class="staexp">void</span><span class="keyword">&gt;</span> <span class="keyword">(</span>l1<span class="keyword">,</span> r1<span class="keyword">,</span> l2<span class="keyword">,</span> r2<span class="keyword">,</span> env<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [intrange2_foreach]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">tenv</span><span class="keyword">}</span>
intrange2_foreach_env
  <span class="keyword">(</span>l1<span class="keyword">,</span> r1<span class="keyword">,</span> l2<span class="keyword">,</span> r2<span class="keyword">,</span> env<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fnx</span>
loop1
<span class="keyword">(</span>
  i<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="staexp">tenv</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span>
<span class="keyword">(</span>
<span class="keyword">if</span> i <span class="keyword">&lt;</span> r1 <span class="keyword">then</span> loop2 <span class="keyword">(</span>i<span class="keyword">,</span> l2<span class="keyword">,</span> env<span class="keyword">)</span> <span class="keyword">else</span> <span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">)</span>
<span class="comment">//</span>
<span class="keyword">and</span>
loop2
<span class="keyword">(</span>
  i<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> j<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="keyword">(</span><span class="staexp">tenv</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span>
<span class="keyword">(</span>
<span class="keyword">if</span>
j <span class="keyword">&lt;</span> r2
<span class="keyword">then</span> <span class="keyword">(</span>
  intrange2_foreach$fwork<span class="keyword">(</span>i<span class="keyword">,</span> j<span class="keyword">,</span> env<span class="keyword">)</span><span class="keyword">;</span> loop2 <span class="keyword">(</span>i<span class="keyword">,</span> j+<span class="dynexp">1</span><span class="keyword">,</span> env<span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">else</span> loop1 <span class="keyword">(</span>i+<span class="dynexp">1</span><span class="keyword">,</span> env<span class="keyword">)</span>
<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  loop1 <span class="keyword">(</span>l1<span class="keyword">,</span> env<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [intrange2_foreach]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
streamize_intrange_l
  <span class="keyword">(</span>m<span class="keyword">)</span> <span class="keyword">=</span> aux0<span class="keyword">(</span>m<span class="keyword">)</span> <span class="keyword">where</span>
<span class="keyword">{</span>
<span class="comment">//</span>
<span class="keyword">vtypedef</span> <span class="staexp">res_vt <span class="keyword">=</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">int</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> aux0
<span class="keyword">(</span>
  m<span class="keyword">:</span> <span class="staexp">int</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">res_vt</span> <span class="keyword">=</span> <span class="dynexp"><span class="keyword">$ldelay</span><span class="keyword">(</span>stream_vt_cons<span class="keyword">(</span>m<span class="keyword">,</span> aux0<span class="keyword">(</span>m+1<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span></span></span>
<span class="comment">//</span>
<span class="keyword">}</span></span> <span class="comment">(* end of [streamize_intrange_l] *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
streamize_intrange_lr
  <span class="keyword">(</span>m<span class="keyword">,</span> n<span class="keyword">)</span> <span class="keyword">=</span> aux0<span class="keyword">(</span>m<span class="keyword">)</span> <span class="keyword">where</span>
<span class="keyword">{</span>
<span class="comment">//</span>
<span class="keyword">vtypedef</span> <span class="staexp">res_vt <span class="keyword">=</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">int</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> aux0
<span class="keyword">(</span>
  m<span class="keyword">:</span> <span class="staexp">int</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">res_vt</span> <span class="keyword">=</span> <span class="dynexp"><span class="keyword">$ldelay</span>
<span class="keyword">(</span>
  <span class="keyword">if</span> m <span class="keyword">&lt;</span> n
    <span class="keyword">then</span> stream_vt_cons<span class="keyword">(</span>m<span class="keyword">,</span> aux0<span class="keyword">(</span>m+1<span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">else</span> stream_vt_nil<span class="keyword">(</span><span class="keyword">)</span>
  <span class="comment">// end of [if]</span>
<span class="keyword">)</span> <span class="keyword">:</span> stream_vt_con<span class="keyword">(</span>int<span class="keyword">)</span></span></span> <span class="comment">// [aux0]</span>
<span class="comment">//</span>
<span class="keyword">}</span></span> <span class="comment">(* end of [streamize_intrange_lr] *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* end of [intrange.dats] *)</span>
</pre>
<pre class="patsyntax">
<span class="comment">(***********************************************************************)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(*                         Applied Type System                         *)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(***********************************************************************)</span>

<span class="comment">(*
** ATS/Postiats - Unleashing the Potential of Types!
** Copyright (C) 2010-2015 Hongwei Xi, ATS Trustful Software, Inc.
** All rights reserved
**
** ATS is free software;  you can  redistribute it and/or modify it under
** the terms of  the GNU GENERAL PUBLIC LICENSE (GPL) as published by the
** Free Software Foundation; either version 3, or (at  your  option)  any
** later version.
**
** ATS is distributed in the hope that it will be useful, but WITHOUT ANY
** WARRANTY; without  even  the  implied  warranty  of MERCHANTABILITY or
** FITNESS FOR A PARTICULAR PURPOSE.  See the  GNU General Public License
** for more details.
**
** You  should  have  received  a  copy of the GNU General Public License
** along  with  ATS;  see the  file COPYING.  If not, please write to the
** Free Software Foundation,  51 Franklin Street, Fifth Floor, Boston, MA
** 02110-1301, USA.
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
** Source:
** $PATSHOME/prelude/DATS/CODEGEN/list.atxt
** Time of generation: Tue Oct 18 18:01:04 2016
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* Author: Hongwei Xi *)</span>
<span class="comment">(* Authoremail: gmhwxiATgmailDOTcom *)</span>
<span class="comment">(* Start time: Feburary, 2012 *)</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="keyword">staload</span>
UN <span class="keyword">=</span> "prelude/SATS/unsafe.sats"
<span class="keyword">staload</span>
_<span class="comment">(*anon*)</span> <span class="keyword">=</span> "prelude/DATS/unsafe.dats"
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="staexp"><span class="keyword">abstype</span>
List0_<span class="keyword">(</span>a<span class="keyword">:</span><span class="keyword">t@ype+</span><span class="keyword">)</span> <span class="keyword">=</span> List0<span class="keyword">(</span>a<span class="keyword">)</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="prfexp"><span class="keyword">primplmnt</span>
lemma_list_param<span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
<span class="comment">//</span>
<span class="keyword">case+</span> xs <span class="keyword">of</span>
<span class="keyword">|</span> list_nil _ <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">|</span> list_cons _ <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span>
<span class="comment">//</span>
<span class="keyword">)</span></span> <span class="comment">(* lemma_list_param *)</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">x</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_make_sing<span class="keyword">(</span>x<span class="keyword">)</span> <span class="keyword">=</span>
  list_vt_cons<span class="staexp"><span class="keyword">{</span>x<span class="keyword">}</span></span><span class="keyword">(</span>x<span class="keyword">,</span> list_vt_nil<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">x</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_make_pair<span class="keyword">(</span>x1<span class="keyword">,</span> x2<span class="keyword">)</span> <span class="keyword">=</span>
  list_vt_cons<span class="staexp"><span class="keyword">{</span>x<span class="keyword">}</span></span><span class="keyword">(</span>x1<span class="keyword">,</span> list_vt_cons<span class="staexp"><span class="keyword">{</span>x<span class="keyword">}</span></span><span class="keyword">(</span>x2<span class="keyword">,</span> list_vt_nil<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">x</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_make_elt
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">}</span></span> <span class="keyword">(</span>n<span class="keyword">,</span> x<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> loop
  <span class="staexp"><span class="keyword">{</span>i<span class="keyword">:</span>nat <span class="keyword">|</span> i &lt;= n<span class="keyword">}</span></span> <span class="keyword">.&lt;</span><span class="staexp">i</span><span class="keyword">&gt;.</span>
<span class="keyword">(</span>
  i<span class="keyword">:</span> <span class="staexp">int</span> <span class="staexp">i</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="staexp">x</span><span class="keyword">,</span> res<span class="keyword">:</span> <span class="staexp">list_vt</span> <span class="keyword">(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">n</span><span class="staexp">-</span><span class="staexp">i</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">list_vt</span> <span class="keyword">(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span>
  <span class="keyword">if</span> i <span class="keyword">&gt;</span> <span class="dynexp">0</span> <span class="keyword">then</span>
    loop <span class="keyword">(</span>pred<span class="keyword">(</span>i<span class="keyword">)</span><span class="keyword">,</span> x<span class="keyword">,</span> list_vt_cons <span class="keyword">(</span>x<span class="keyword">,</span> res<span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">else</span> res
  <span class="comment">// end of [if]</span>
<span class="keyword">)</span></span> <span class="comment">// end of [loop]</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  loop <span class="keyword">(</span>n<span class="keyword">,</span> x<span class="keyword">,</span> list_vt_nil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list_make_elt]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
list_make_intrange
  <span class="staexp"><span class="keyword">{</span>l0<span class="keyword">,</span>r<span class="keyword">}</span></span> <span class="keyword">(</span>l0<span class="keyword">,</span> r<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="keyword">typedef</span> <span class="staexp">elt <span class="keyword">=</span> <span class="staexp">intBtw</span><span class="keyword">(</span><span class="staexp">l0</span><span class="keyword">,</span> <span class="staexp">r</span><span class="keyword">)</span></span>
<span class="keyword">vtypedef</span> <span class="staexp">res<span class="keyword">(</span><span class="staexp">l<span class="keyword">:</span>int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">elt</span><span class="keyword">,</span> <span class="staexp">r</span><span class="staexp">-</span><span class="staexp">l</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
loop
<span class="staexp"><span class="keyword">{</span>
  l<span class="keyword">:</span>int <span class="keyword">|</span> l0 &lt;= l<span class="keyword">;</span> l &lt;= r
<span class="keyword">}</span></span> <span class="keyword">.&lt;</span><span class="staexp">r</span><span class="staexp">-</span><span class="staexp">l</span><span class="keyword">&gt;.</span> <span class="keyword">(</span>
  l<span class="keyword">:</span> <span class="staexp">int</span> <span class="staexp">l</span><span class="keyword">,</span> r<span class="keyword">:</span> <span class="staexp">int</span> <span class="staexp">r</span><span class="keyword">,</span> res<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">ptr</span><span class="staexp">?</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">res</span> <span class="keyword">(</span><span class="staexp">l</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span> <span class="keyword">=</span>
  <span class="keyword">if</span> l <span class="keyword">&lt;</span> r <span class="keyword">then</span> <span class="keyword">let</span>
    <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> res :=
      list_vt_cons<span class="staexp"><span class="keyword">{</span>elt<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>0<span class="keyword">}</span></span><span class="keyword">(</span>l<span class="keyword">,</span> _<span class="keyword">)</span></span>
    <span class="dynexp"><span class="keyword">val+</span>list_vt_cons <span class="keyword">(</span>_<span class="keyword">,</span> res1<span class="keyword">)</span> <span class="keyword">=</span> res</span>
    <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> loop <span class="keyword">(</span>l+<span class="dynexp">1</span><span class="keyword">,</span> r<span class="keyword">,</span> res1<span class="keyword">)</span></span>
  <span class="keyword">in</span>
    <span class="keyword">fold@</span> <span class="keyword">(</span>res<span class="keyword">)</span>
  <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">(</span>res := list_vt_nil<span class="keyword">)</span></span>
<span class="comment">// end of [loop]</span>
<span class="comment">//</span>
<span class="keyword">var</span> res<span class="keyword">:</span> <span class="staexp">ptr</span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">$effmask_wrt</span> <span class="keyword">(</span>loop <span class="keyword">(</span>l0<span class="keyword">,</span> r<span class="keyword">,</span> res<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  res
<span class="keyword">end</span></span> <span class="comment">// end of [list_make_intrange]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_make_array
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">}</span></span> <span class="keyword">(</span>A<span class="keyword">,</span> n<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> lemma_array_param<span class="keyword">(</span>A<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">vtypedef</span> <span class="staexp">res<span class="keyword">(</span><span class="staexp">n<span class="keyword">:</span>int</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> loop
  <span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span>
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>nat<span class="keyword">}</span></span> <span class="keyword">.&lt;</span><span class="staexp">n</span><span class="keyword">&gt;.</span> <span class="keyword">(</span>
  <span class="prfexp">pf<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">array_v</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">array_v</span> <span class="keyword">(</span><span class="staexp">a</span><span class="staexp">?!</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="keyword">|</span> p<span class="keyword">:</span> <span class="staexp">ptr</span> <span class="staexp">l</span>
<span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="staexp">n</span>
<span class="keyword">,</span> res<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">ptr</span><span class="staexp">?</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">res</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span> <span class="keyword">=</span>
  <span class="keyword">if</span> n <span class="keyword">&gt;</span> <span class="dynexp">0</span> <span class="keyword">then</span> <span class="keyword">let</span>
    <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span>
      pf1<span class="keyword">,</span> pf2
    <span class="keyword">)</span> <span class="keyword">=</span> array_v_uncons <span class="keyword">(</span>pf<span class="keyword">)</span></span>
    <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> res :=
      list_vt_cons<span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>0<span class="keyword">}</span></span><span class="keyword">(</span>_<span class="keyword">,</span> _<span class="keyword">)</span></span>
    <span class="dynexp"><span class="keyword">val+</span>list_vt_cons <span class="keyword">(</span>x<span class="keyword">,</span> res1<span class="keyword">)</span> <span class="keyword">=</span> res</span>
    <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> x := <span class="keyword">!</span>p</span>
    <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> loop <span class="keyword">(</span><span class="prfexp">pf2</span> <span class="keyword">|</span> ptr1_succ&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>p<span class="keyword">)</span><span class="keyword">,</span> pred<span class="keyword">(</span>n<span class="keyword">)</span><span class="keyword">,</span> res1<span class="keyword">)</span></span>
    <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> pf := array_v_cons <span class="keyword">(</span>pf1<span class="keyword">,</span> pf2<span class="keyword">)</span></span>
    <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">fold@</span> <span class="keyword">(</span>res<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">in</span>
    <span class="comment">// nothing</span>
  <span class="keyword">end</span></span> <span class="keyword">else</span> <span class="keyword">let</span>
    <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> array_v_unnil <span class="keyword">(</span>pf<span class="keyword">)</span></span>
    <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> pf := array_v_nil <span class="keyword">(</span><span class="keyword">)</span></span>
  <span class="keyword">in</span>
    res := list_vt_nil <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">end</span></span> <span class="comment">// end of [if]</span>
<span class="comment">// end of [loop]</span>
<span class="keyword">var</span> res<span class="keyword">:</span> <span class="staexp">ptr</span> <span class="comment">// uninitialized</span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> loop <span class="keyword">(</span><span class="prfexp"><span class="dynexp"><span class="keyword">view@</span></span><span class="keyword">(</span>A<span class="keyword">)</span></span> <span class="keyword">|</span> <span class="dynexp"><span class="keyword">addr@</span></span><span class="keyword">(</span>A<span class="keyword">)</span><span class="keyword">,</span> n<span class="keyword">,</span> res<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  res
<span class="keyword">end</span></span> <span class="comment">// end of [list_make_array]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_make_arrpsz
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">}</span></span> <span class="keyword">(</span>A0<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="keyword">var</span> asz<span class="keyword">:</span> <span class="staexp">size_t</span>
<span class="dynexp"><span class="keyword">val</span> A <span class="keyword">=</span> arrpsz_get_ptrsize <span class="keyword">(</span>A0<span class="keyword">,</span> asz<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> p <span class="keyword">=</span> arrayptr2ptr <span class="keyword">(</span>A<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span>
pfarr <span class="keyword">=</span> arrayptr_takeout <span class="keyword">(</span>A<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> res <span class="keyword">=</span> list_make_array <span class="keyword">(</span><span class="keyword">!</span>p<span class="keyword">,</span> asz<span class="keyword">)</span></span>
<span class="prfexp"><span class="keyword">prval</span><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> arrayptr_addback <span class="keyword">(</span><span class="prfexp">pfarr</span> <span class="keyword">|</span> A<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> arrayptr_free <span class="keyword">(</span>A<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  res
<span class="keyword">end</span></span> <span class="comment">// end of [list_make_arrpsz]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
print_list <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span> fprint_list&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>stdout_ref<span class="keyword">,</span> xs<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
prerr_list <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span> fprint_list&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>stderr_ref<span class="keyword">,</span> xs<span class="keyword">)</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
fprint_list$sep
  <span class="keyword">(</span>out<span class="keyword">)</span> <span class="keyword">=</span> fprint_string <span class="keyword">(</span>out<span class="keyword">,</span> <span class="dynstr">", "</span><span class="keyword">)</span></span>
<span class="comment">// end of [fprint_list$sep]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
fprint_list <span class="keyword">(</span>out<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span><span class="keyword">(</span><span class="staexp">env</span><span class="keyword">)</span>
list_iforeach$fwork&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">env</span><span class="keyword">&gt;</span>
  <span class="keyword">(</span>i<span class="keyword">,</span> x<span class="keyword">,</span> env<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span>
    <span class="keyword">if</span> i <span class="keyword">&gt;</span> <span class="dynexp">0</span> <span class="keyword">then</span> fprint_list$sep&lt;<span class="comment">(*none*)</span><span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">)</span></span>
  <span class="comment">// end of [val]</span>
<span class="keyword">in</span>
  fprint_val&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">,</span> x<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list_iforeach$fwork]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> _<span class="comment">(*len*)</span> <span class="keyword">=</span> list_iforeach&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>xs<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">in</span>
  <span class="comment">// nothing</span>
<span class="keyword">end</span></span></span> <span class="comment">// end of [fprint_list]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
fprint_list_sep
  <span class="keyword">(</span>out<span class="keyword">,</span> xs<span class="keyword">,</span> sep<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
fprint_list$sep&lt;<span class="comment">(*none*)</span><span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">)</span> <span class="keyword">=</span> fprint_string <span class="keyword">(</span>out<span class="keyword">,</span> sep<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  fprint_list&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">,</span> xs<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [fprint_list_sep]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">(*
//
// HX-2012-05:
// Compiling this can be a great challenge!
//
*)</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
fprint_listlist_sep
  <span class="keyword">(</span>out<span class="keyword">,</span> xss<span class="keyword">,</span> sep1<span class="keyword">,</span> sep2<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
fprint_val&lt;<span class="staexp">List0_</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">&gt;</span>
  <span class="keyword">(</span>out<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> xs <span class="keyword">=</span> $UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>List0<span class="keyword">(</span>a<span class="keyword">)</span><span class="keyword">}</span></span><span class="keyword">(</span>xs<span class="keyword">)</span></span>
<span class="keyword">in</span>
  fprint_list_sep&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">,</span> xs<span class="keyword">,</span> sep2<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [fprint_val]</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  fprint_list_sep&lt;<span class="staexp">List0_</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">,</span> $UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>List<span class="keyword">(</span>List0_<span class="keyword">(</span>a<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">}</span></span><span class="keyword">(</span>xss<span class="keyword">)</span><span class="keyword">,</span> sep1<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [fprint_listlist_sep]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
list_is_nil <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span>
  <span class="keyword">case+</span> xs <span class="keyword">of</span> list_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> true <span class="keyword">|</span> _ <span class="keyword">=&gt;&gt;</span> false</span>
<span class="comment">// end of [list_is_nil]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
list_is_cons <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span>
  <span class="keyword">case+</span> xs <span class="keyword">of</span> list_cons _ <span class="keyword">=&gt;</span> true <span class="keyword">|</span> _ <span class="keyword">=&gt;&gt;</span> false</span>
<span class="comment">// end of [list_is_cons]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">x</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_is_sing <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span>
  <span class="keyword">case+</span> xs <span class="keyword">of</span> list_sing <span class="keyword">(</span>x<span class="keyword">)</span> <span class="keyword">=&gt;</span> true <span class="keyword">|</span> _ <span class="keyword">=&gt;&gt;</span> false</span>
<span class="comment">// end of [list_is_sing]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">x</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_is_pair <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span>
  <span class="keyword">case+</span> xs <span class="keyword">of</span> list_pair <span class="keyword">(</span>x1<span class="keyword">,</span> x2<span class="keyword">)</span> <span class="keyword">=&gt;</span> true <span class="keyword">|</span> _ <span class="keyword">=&gt;&gt;</span> false</span>
<span class="comment">// end of [list_is_pair]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">x</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_head <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span>
  <span class="keyword">let</span> <span class="dynexp"><span class="keyword">val+</span>list_cons <span class="keyword">(</span>x<span class="keyword">,</span> _<span class="keyword">)</span> <span class="keyword">=</span> xs</span> <span class="keyword">in</span> x <span class="keyword">end</span></span>
<span class="comment">// end of [list_head]</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">x</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_tail <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span>
  <span class="keyword">let</span> <span class="dynexp"><span class="keyword">val+</span>list_cons <span class="keyword">(</span>_<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=</span> xs</span> <span class="keyword">in</span> xs <span class="keyword">end</span></span>
<span class="comment">// end of [list_tail]</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">x</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_last <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> loop
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">List1</span> <span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">x</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val+</span>list_cons <span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=</span> xs</span>
<span class="keyword">in</span>
  <span class="keyword">case+</span> xs <span class="keyword">of</span>
  <span class="keyword">|</span> list_cons _ <span class="keyword">=&gt;</span> loop <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">|</span> list_nil _ <span class="keyword">=&gt;</span> x
<span class="keyword">end</span></span> <span class="comment">// end of [loop]</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  <span class="keyword">$effmask_all</span> <span class="keyword">(</span>loop <span class="keyword">(</span>xs<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list_last]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">x</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_head_exn <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
<span class="keyword">case+</span> xs <span class="keyword">of</span>
<span class="keyword">|</span> list_cons <span class="keyword">(</span>x<span class="keyword">,</span> _<span class="keyword">)</span> <span class="keyword">=&gt;</span> x <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> <span class="dynexp"><span class="keyword">$raise</span> ListSubscriptExn<span class="keyword">(</span><span class="keyword">)</span></span>
<span class="keyword">)</span></span> <span class="comment">(* end of [list_head_exn] *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">x</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_tail_exn <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
<span class="keyword">case+</span> xs <span class="keyword">of</span>
<span class="keyword">|</span> list_cons <span class="keyword">(</span>_<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span> xs <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> <span class="dynexp"><span class="keyword">$raise</span> ListSubscriptExn<span class="keyword">(</span><span class="keyword">)</span></span>
<span class="keyword">)</span></span> <span class="comment">(* end of [list_tail_exn] *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">x</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_last_exn <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
<span class="keyword">case+</span> xs <span class="keyword">of</span>
<span class="keyword">|</span> list_cons _ <span class="keyword">=&gt;</span> list_last <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> <span class="dynexp"><span class="keyword">$raise</span> ListSubscriptExn<span class="keyword">(</span><span class="keyword">)</span></span>
<span class="keyword">)</span></span> <span class="comment">(* end of [list_last_exn] *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_nth <span class="keyword">(</span>xs<span class="keyword">,</span> i<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> loop
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">,</span>i<span class="keyword">:</span>nat <span class="keyword">|</span> i <span class="keyword">&lt;</span> n<span class="keyword">}</span></span> <span class="keyword">.&lt;</span><span class="staexp">i</span><span class="keyword">&gt;.</span> <span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp">list</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">int</span> <span class="staexp">i</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">a</span> <span class="keyword">=</span>
  <span class="keyword">if</span> i <span class="keyword">&gt;</span> <span class="dynexp">0</span> <span class="keyword">then</span> <span class="keyword">let</span>
    <span class="dynexp"><span class="keyword">val+</span>list_cons <span class="keyword">(</span>_<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=</span> xs</span> <span class="keyword">in</span> loop <span class="keyword">(</span>xs<span class="keyword">,</span> pred<span class="keyword">(</span>i<span class="keyword">)</span><span class="keyword">)</span>
  <span class="keyword">end</span> <span class="keyword">else</span> list_head&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>xs<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  loop <span class="keyword">(</span>xs<span class="keyword">,</span> i<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list_nth]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_nth_opt <span class="keyword">(</span>xs<span class="keyword">,</span> i<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> loop
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>nat<span class="keyword">}</span></span> <span class="keyword">.&lt;</span><span class="staexp">n</span><span class="keyword">&gt;.</span>
<span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp">list</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">intGte</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">Option_vt</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
<span class="keyword">case+</span> xs <span class="keyword">of</span>
<span class="keyword">|</span> list_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> None_vt <span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">|</span> list_cons <span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span>
    <span class="keyword">if</span> i <span class="keyword">=</span> <span class="dynexp">0</span> <span class="keyword">then</span> Some_vt<span class="keyword">(</span>x<span class="keyword">)</span> <span class="keyword">else</span> loop <span class="keyword">(</span>xs<span class="keyword">,</span> pred<span class="keyword">(</span>i<span class="keyword">)</span><span class="keyword">)</span>
  <span class="comment">// end of [list_vt_cons]</span>
<span class="keyword">)</span></span> <span class="comment">(* end of [loop] *)</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> lemma_list_param <span class="keyword">(</span>xs<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  loop <span class="keyword">(</span>xs<span class="keyword">,</span> i<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list_nth_opt]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_get_at <span class="keyword">(</span>xs<span class="keyword">,</span> i<span class="keyword">)</span> <span class="keyword">=</span> list_nth&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>xs<span class="keyword">,</span> i<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_get_at_opt <span class="keyword">(</span>xs<span class="keyword">,</span> i<span class="keyword">)</span> <span class="keyword">=</span> list_nth_opt&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>xs<span class="keyword">,</span> i<span class="keyword">)</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_set_at
  <span class="keyword">(</span>xs<span class="keyword">,</span> i<span class="keyword">,</span> x_new<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span>xs1<span class="keyword">,</span> xs2<span class="keyword">)</span> <span class="keyword">=</span>
    <span class="keyword">$effmask_wrt</span> <span class="keyword">(</span>list_split_at&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>xs<span class="keyword">,</span> i<span class="keyword">)</span><span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val+</span>list_cons <span class="keyword">(</span>x_old<span class="keyword">,</span> xs2<span class="keyword">)</span> <span class="keyword">=</span> xs2</span>
  <span class="dynexp"><span class="keyword">val</span> xs2 <span class="keyword">=</span> list_cons<span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="keyword">(</span>x_new<span class="keyword">,</span> xs2<span class="keyword">)</span></span>
<span class="keyword">in</span>
  <span class="keyword">$effmask_wrt</span> <span class="keyword">(</span>list_append1_vt&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>xs1<span class="keyword">,</span> xs2<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// ed of [list_set_at]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_exch_at
  <span class="keyword">(</span>xs<span class="keyword">,</span> i<span class="keyword">,</span> x_new<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span>xs1<span class="keyword">,</span> xs2<span class="keyword">)</span> <span class="keyword">=</span>
    <span class="keyword">$effmask_wrt</span> <span class="keyword">(</span>list_split_at&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>xs<span class="keyword">,</span> i<span class="keyword">)</span><span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val+</span>list_cons <span class="keyword">(</span>x_old<span class="keyword">,</span> xs2<span class="keyword">)</span> <span class="keyword">=</span> xs2</span>
  <span class="dynexp"><span class="keyword">val</span> xs2 <span class="keyword">=</span> list_cons<span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="keyword">(</span>x_new<span class="keyword">,</span> xs2<span class="keyword">)</span></span>
<span class="keyword">in</span>
  <span class="keyword">(</span><span class="keyword">$effmask_wrt</span> <span class="keyword">(</span>list_append1_vt&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>xs1<span class="keyword">,</span> xs2<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> x_old<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// ed of [list_exch_at]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_insert_at
  <span class="keyword">(</span>xs<span class="keyword">,</span> i<span class="keyword">,</span> x<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> loop<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="staexp"><span class="keyword">{</span>i<span class="keyword">:</span>nat <span class="keyword">|</span> i &lt;= n<span class="keyword">}</span></span> <span class="keyword">.&lt;</span><span class="staexp">i</span><span class="keyword">&gt;.</span>
<span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp">list</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">int</span> <span class="staexp">i</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="staexp">a</span>
<span class="keyword">,</span> res<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">ptr</span><span class="staexp">?</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">list</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="staexp">+</span><span class="staexp">1</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span> <span class="keyword">=</span>
<span class="comment">//</span>
<span class="keyword">if</span>
i <span class="keyword">&gt;</span> <span class="dynexp">0</span>
<span class="keyword">then</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val+</span>list_cons<span class="keyword">(</span>x1<span class="keyword">,</span> xs1<span class="keyword">)</span> <span class="keyword">=</span> xs</span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> res :=
    list_cons<span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>0<span class="keyword">}</span></span><span class="keyword">(</span>x1<span class="keyword">,</span> _<span class="comment">(*?*)</span><span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val+</span>list_cons
    <span class="keyword">(</span>_<span class="keyword">,</span> res1<span class="keyword">)</span> <span class="keyword">=</span> res</span> <span class="comment">// res1 = res.1</span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> loop <span class="keyword">(</span>xs1<span class="keyword">,</span> i-<span class="dynexp">1</span><span class="keyword">,</span> x<span class="keyword">,</span> res1<span class="keyword">)</span></span>
  <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">fold@</span> <span class="keyword">(</span>res<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">in</span>
  <span class="comment">// nothing</span>
<span class="keyword">end</span></span> <span class="comment">// end of [then]</span>
<span class="keyword">else</span> res := list_cons <span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">var</span>
res<span class="keyword">:</span> <span class="staexp">ptr</span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span>
  <span class="keyword">$effmask_wrt</span><span class="keyword">(</span>loop<span class="keyword">(</span>xs<span class="keyword">,</span> i<span class="keyword">,</span> x<span class="keyword">,</span> res<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  res
<span class="keyword">end</span></span> <span class="comment">// end of [list_insert_at]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_remove_at
  <span class="keyword">(</span>xs<span class="keyword">,</span> i<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="keyword">var</span> x0<span class="keyword">:</span> <span class="staexp">a</span> <span class="comment">// uninitized</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  <span class="keyword">$effmask_wrt</span><span class="keyword">(</span>list_takeout_at<span class="keyword">(</span>xs<span class="keyword">,</span> i<span class="keyword">,</span> x0<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list_remove_at]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_takeout_at
  <span class="keyword">(</span>xs<span class="keyword">,</span> i<span class="keyword">,</span> x0<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> loop<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="staexp"><span class="keyword">{</span>i<span class="keyword">:</span>nat <span class="keyword">|</span> i <span class="keyword">&lt;</span> n<span class="keyword">}</span></span> <span class="keyword">.&lt;</span><span class="staexp">i</span><span class="keyword">&gt;.</span>
<span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp">list</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">int</span> <span class="staexp">i</span><span class="keyword">,</span> x0<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">a</span><span class="staexp">?</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">a</span>
<span class="keyword">,</span> res<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">ptr</span><span class="staexp">?</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">list</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="staexp">-</span><span class="staexp">1</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val+</span>list_cons <span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=</span> xs</span>
<span class="comment">//</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">if</span> i <span class="keyword">&gt;</span> <span class="dynexp">0</span> <span class="keyword">then</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span>
    res :=
    list_cons<span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>0<span class="keyword">}</span></span><span class="keyword">(</span>x<span class="keyword">,</span> _<span class="comment">(*?*)</span><span class="keyword">)</span></span>
  <span class="comment">// end of [val]</span>
  <span class="dynexp"><span class="keyword">val+</span>list_cons
    <span class="keyword">(</span>_<span class="keyword">,</span> res1<span class="keyword">)</span> <span class="keyword">=</span> res</span> <span class="comment">// res1 = res.1</span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> loop <span class="keyword">(</span>xs<span class="keyword">,</span> i-<span class="dynexp">1</span><span class="keyword">,</span> x0<span class="keyword">,</span> res1<span class="keyword">)</span></span>
  <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">fold@</span> <span class="keyword">(</span>res<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">in</span>
  <span class="comment">// nothing</span>
<span class="keyword">end</span></span> <span class="keyword">else</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> x0 := x</span><span class="keyword">;</span> <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> res := xs</span>
<span class="dynexp"><span class="keyword">in</span>
  <span class="comment">// nothing</span>
<span class="keyword">end</span></span> <span class="comment">// end of [if]</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [loop]</span>
<span class="comment">//</span>
<span class="keyword">var</span> res<span class="keyword">:</span> <span class="staexp">ptr</span><span class="staexp">?</span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> loop <span class="keyword">(</span>xs<span class="keyword">,</span> i<span class="keyword">,</span> x0<span class="keyword">,</span> res<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  res
<span class="keyword">end</span></span> <span class="comment">// end of [list_takeout_at]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">x</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_length <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> lemma_list_param <span class="keyword">(</span>xs<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> loop
  <span class="staexp"><span class="keyword">{</span>i<span class="keyword">,</span>j<span class="keyword">:</span>nat<span class="keyword">}</span></span> <span class="keyword">.&lt;</span><span class="staexp">i</span><span class="keyword">&gt;.</span> <span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp">list</span> <span class="keyword">(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span><span class="keyword">,</span> j<span class="keyword">:</span> <span class="staexp">int</span> <span class="staexp">j</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int</span> <span class="keyword">(</span><span class="staexp">i</span><span class="staexp">+</span><span class="staexp">j</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span>
  <span class="keyword">case+</span> xs <span class="keyword">of</span>
  <span class="keyword">|</span> list_cons <span class="keyword">(</span>_<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span> loop <span class="keyword">(</span>xs<span class="keyword">,</span> j+<span class="dynexp">1</span><span class="keyword">)</span> <span class="keyword">|</span> _ <span class="keyword">=&gt;&gt;</span> j
<span class="keyword">)</span></span> <span class="comment">// end of [loop]</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  loop <span class="keyword">(</span>xs<span class="keyword">,</span> <span class="dynexp">0</span><span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list_length]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">x</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_copy
  <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span> res <span class="keyword">where</span> <span class="keyword">{</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span>
  lemma_list_param<span class="keyword">(</span>xs<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">vtypedef</span> <span class="staexp">res <span class="keyword">=</span> <span class="staexp">List0_vt</span> <span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> loop
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>nat<span class="keyword">}</span></span> <span class="keyword">.&lt;</span><span class="staexp">n</span><span class="keyword">&gt;.</span>
<span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp">list</span> <span class="keyword">(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">,</span> res<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">res</span><span class="staexp">?</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">list_vt</span> <span class="keyword">(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">case+</span> xs <span class="keyword">of</span>
<span class="keyword">|</span> list_cons
    <span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
    <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> res :=
      list_vt_cons<span class="staexp"><span class="keyword">{</span>x<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>0<span class="keyword">}</span></span><span class="keyword">(</span>x<span class="keyword">,</span> _<span class="comment">(*?*)</span><span class="keyword">)</span></span>
    <span class="dynexp"><span class="keyword">val+</span>list_vt_cons
      <span class="keyword">(</span>_<span class="keyword">,</span> res1<span class="keyword">)</span> <span class="keyword">=</span> res</span> <span class="comment">// res1 = res.1</span>
    <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> loop <span class="keyword">(</span>xs<span class="keyword">,</span> res1<span class="keyword">)</span></span>
    <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">fold@</span> <span class="keyword">(</span>res<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">in</span>
    <span class="comment">// nothing</span>
  <span class="keyword">end</span></span> <span class="comment">// end of [cons]</span>
<span class="keyword">|</span> list_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> res := list_vt_nil <span class="keyword">(</span><span class="keyword">)</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [loop]</span>
<span class="comment">//</span>
<span class="keyword">var</span> res<span class="keyword">:</span> <span class="staexp">res</span><span class="staexp">?</span> <span class="keyword">;</span> <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> loop <span class="keyword">(</span>xs<span class="keyword">,</span> res<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">}</span></span> <span class="comment">// end of [list_copy]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_append
  <span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">}</span></span> <span class="keyword">(</span>xs<span class="keyword">,</span> ys<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> ys <span class="keyword">=</span> __cast <span class="keyword">(</span>ys<span class="keyword">)</span> <span class="keyword">where</span> <span class="keyword">{</span>
    <span class="keyword">extern</span> <span class="dynexp"><span class="keyword">castfn</span> __cast <span class="keyword">(</span>ys<span class="keyword">:</span> <span class="staexp">list</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">list_vt</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
  <span class="keyword">}</span></span> <span class="comment">// end of [where] // end of [val]</span>
<span class="keyword">in</span>
<span class="keyword">$effmask_wrt</span>
<span class="keyword">(</span>
  list_of_list_vt <span class="keyword">(</span>list_append2_vt <span class="keyword">(</span>xs<span class="keyword">,</span> ys<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="comment">// end of [$effmask_wrt]</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list_append]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_append1_vt
  <span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">}</span></span> <span class="keyword">(</span>xs<span class="keyword">,</span> ys<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> ys <span class="keyword">=</span> __cast <span class="keyword">(</span>ys<span class="keyword">)</span> <span class="keyword">where</span> <span class="keyword">{</span>
    <span class="keyword">extern</span> <span class="dynexp"><span class="keyword">castfn</span> __cast <span class="keyword">(</span>ys<span class="keyword">:</span> <span class="staexp">list</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">list_vt</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
  <span class="keyword">}</span></span> <span class="comment">// end of [val]</span>
<span class="keyword">in</span>
  list_of_list_vt <span class="keyword">(</span>list_vt_append <span class="keyword">(</span>xs<span class="keyword">,</span> ys<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list_append1_vt]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_append2_vt
  <span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">}</span></span> <span class="keyword">(</span>xs<span class="keyword">,</span> ys<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> lemma_list_param <span class="keyword">(</span>xs<span class="keyword">)</span></span>
<span class="prfexp"><span class="keyword">prval</span><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> lemma_list_vt_param <span class="keyword">(</span>ys<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> loop
  <span class="staexp"><span class="keyword">{</span>m<span class="keyword">:</span>nat<span class="keyword">}</span></span> <span class="keyword">.&lt;</span><span class="staexp">m</span><span class="keyword">&gt;.</span> <span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp">list</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">)</span>
<span class="keyword">,</span> ys<span class="keyword">:</span> <span class="staexp">list_vt</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">,</span> res<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">ptr</span><span class="staexp">?</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">list_vt</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">m</span><span class="staexp">+</span><span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span> <span class="keyword">=</span>
  <span class="keyword">case+</span> xs <span class="keyword">of</span>
  <span class="keyword">|</span> list_cons
      <span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> res :=
        list_vt_cons<span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>0<span class="keyword">}</span></span><span class="keyword">(</span>x<span class="keyword">,</span> _<span class="comment">(*?*)</span><span class="keyword">)</span></span>
      <span class="dynexp"><span class="keyword">val+</span>list_vt_cons
        <span class="keyword">(</span>_<span class="keyword">,</span> res1<span class="keyword">)</span> <span class="keyword">=</span> res</span> <span class="comment">// res1 = res.1</span>
      <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> loop <span class="keyword">(</span>xs<span class="keyword">,</span> ys<span class="keyword">,</span> res1<span class="keyword">)</span></span>
      <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">fold@</span> <span class="keyword">(</span>res<span class="keyword">)</span></span>
    <span class="dynexp"><span class="keyword">in</span>
      <span class="comment">// nothing</span>
    <span class="keyword">end</span></span> <span class="comment">// end of [list_cons]</span>
  <span class="keyword">|</span> list_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> res := ys</span>
<span class="comment">// end of [loop]</span>
<span class="keyword">var</span> res<span class="keyword">:</span> <span class="staexp">ptr</span> <span class="comment">// uninitialized</span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> loop <span class="keyword">(</span>xs<span class="keyword">,</span> ys<span class="keyword">,</span> res<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  res
<span class="keyword">end</span></span> <span class="comment">// end of [list_append2_vt]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_extend <span class="keyword">(</span>xs<span class="keyword">,</span> y<span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
  list_append2_vt&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>xs<span class="keyword">,</span> list_vt_sing <span class="keyword">(</span>y<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">)</span></span> <span class="comment">// end of [list_extend]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">x</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_reverse <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span>
  list_reverse_append2_vt&lt;<span class="staexp">x</span><span class="keyword">&gt;</span> <span class="keyword">(</span>xs<span class="keyword">,</span> list_vt_nil<span class="keyword">)</span>
<span class="keyword">)</span></span> <span class="comment">// end of [list_reverse]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_reverse_append
  <span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">}</span></span> <span class="keyword">(</span>xs<span class="keyword">,</span> ys<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> ys <span class="keyword">=</span> __cast <span class="keyword">(</span>ys<span class="keyword">)</span> <span class="keyword">where</span>
<span class="keyword">{</span>
  <span class="keyword">extern</span> <span class="dynexp"><span class="keyword">castfn</span> __cast <span class="keyword">(</span>ys<span class="keyword">:</span> <span class="staexp">list</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">list_vt</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="keyword">}</span></span> <span class="comment">// end of [where] // end of [val]</span>
<span class="comment">//</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">$effmask_wrt</span>
<span class="keyword">(</span>
  list_of_list_vt <span class="keyword">(</span>list_reverse_append2_vt&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>xs<span class="keyword">,</span> ys<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="comment">(* end of [$effmask_wrt] *)</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list_reverse_append]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_reverse_append1_vt
  <span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">}</span></span> <span class="keyword">(</span>xs<span class="keyword">,</span> ys<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span>
  lemma_list_vt_param<span class="keyword">(</span>xs<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> lemma_list_param<span class="keyword">(</span>ys<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> loop<span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">:</span>nat<span class="keyword">}</span></span> <span class="keyword">.&lt;</span><span class="staexp">m</span><span class="keyword">&gt;.</span>
<span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp">list_vt</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">)</span><span class="keyword">,</span> ys<span class="keyword">:</span> <span class="staexp">list</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">list</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">m</span><span class="staexp">+</span><span class="staexp">n</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">case+</span> xs <span class="keyword">of</span>
<span class="keyword">|</span> <span class="keyword">@</span>list_vt_cons
    <span class="keyword">(</span>x<span class="keyword">,</span> xs1<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
    <span class="dynexp"><span class="keyword">val</span> xs1_ <span class="keyword">=</span> xs1</span>
    <span class="dynexp"><span class="keyword">val</span> ys <span class="keyword">=</span> __cast <span class="keyword">(</span>ys<span class="keyword">)</span> <span class="keyword">where</span> <span class="keyword">{</span>
      <span class="keyword">extern</span> <span class="dynexp"><span class="keyword">castfn</span> __cast <span class="keyword">(</span>ys<span class="keyword">:</span> <span class="staexp">list</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">list_vt</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
    <span class="keyword">}</span></span> <span class="comment">// end of [val]</span>
    <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> xs1 := ys</span>
    <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">fold@</span> <span class="keyword">(</span>xs<span class="keyword">)</span></span>
  <span class="keyword">in</span>
    loop <span class="keyword">(</span>xs1_<span class="keyword">,</span> list_of_list_vt<span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="keyword">(</span>xs<span class="keyword">)</span><span class="keyword">)</span>
  <span class="keyword">end</span> <span class="comment">// end of [list_vt_cons]</span>
<span class="keyword">|</span> <span class="keyword">~</span>list_vt_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> ys
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [loop]</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  loop <span class="keyword">(</span>xs<span class="keyword">,</span> ys<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list_reverse_append1_vt]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_reverse_append2_vt
  <span class="keyword">(</span>xs<span class="keyword">,</span> ys<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> lemma_list_param<span class="keyword">(</span>xs<span class="keyword">)</span></span>
<span class="prfexp"><span class="keyword">prval</span><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> lemma_list_vt_param<span class="keyword">(</span>ys<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> loop
  <span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">:</span>nat<span class="keyword">}</span></span> <span class="keyword">.&lt;</span><span class="staexp">m</span><span class="keyword">&gt;.</span>
<span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp">list</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">)</span><span class="keyword">,</span> ys<span class="keyword">:</span> <span class="staexp">list_vt</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">list_vt</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">m</span><span class="staexp">+</span><span class="staexp">n</span><span class="keyword">)</span> <span class="keyword">=</span>
  <span class="keyword">case+</span> xs <span class="keyword">of</span>
  <span class="keyword">|</span> list_cons
      <span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span> loop <span class="keyword">(</span>xs<span class="keyword">,</span> list_vt_cons<span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="keyword">(</span>x<span class="keyword">,</span> ys<span class="keyword">)</span><span class="keyword">)</span>
  <span class="keyword">|</span> list_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> ys</span> <span class="comment">// end of [list_nil]</span>
<span class="comment">// end of [loop]</span>
<span class="keyword">in</span>
  loop <span class="keyword">(</span>xs<span class="keyword">,</span> ys<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list_reverse_append2_vt]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_concat <span class="keyword">(</span>xss<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> lemma_list_param<span class="keyword">(</span>xss<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">typedef</span> <span class="staexp">T <span class="keyword">=</span> <span class="staexp">List</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">fun</span> aux <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>nat<span class="keyword">}</span></span> <span class="keyword">.&lt;</span><span class="staexp">n</span><span class="keyword">&gt;.</span>
<span class="keyword">(</span>
  xs0<span class="keyword">:</span> <span class="staexp">T</span>
<span class="keyword">,</span> xss<span class="keyword">:</span> <span class="staexp">list</span> <span class="keyword">(</span><span class="staexp">T</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">List0_vt</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="prfexp"><span class="keyword">prval</span><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> lemma_list_param<span class="keyword">(</span>xs0<span class="keyword">)</span></span>
<span class="keyword">in</span>
  <span class="keyword">case+</span> xss <span class="keyword">of</span>
  <span class="keyword">|</span> list_cons
      <span class="keyword">(</span>xs<span class="keyword">,</span> xss<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="dynexp"><span class="keyword">val</span> res <span class="keyword">=</span> aux <span class="keyword">(</span>xs<span class="keyword">,</span> xss<span class="keyword">)</span></span>
      <span class="dynexp"><span class="keyword">val</span> ys0 <span class="keyword">=</span> list_copy <span class="keyword">(</span>xs0<span class="keyword">)</span></span>
    <span class="keyword">in</span>
      list_vt_append&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>ys0<span class="keyword">,</span> res<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [list_cons]</span>
  <span class="keyword">|</span> list_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> list_copy <span class="keyword">(</span>xs0<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [aux]</span>
<span class="comment">//</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">case+</span> xss <span class="keyword">of</span>
<span class="keyword">|</span> list_cons
    <span class="keyword">(</span>xs<span class="keyword">,</span> xss<span class="keyword">)</span> <span class="keyword">=&gt;</span> aux <span class="keyword">(</span>xs<span class="keyword">,</span> xss<span class="keyword">)</span>
<span class="keyword">|</span> list_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> list_vt_nil <span class="keyword">(</span><span class="keyword">)</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list_concat]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_take <span class="keyword">(</span>xs<span class="keyword">,</span> i<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> loop
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="staexp"><span class="keyword">{</span>i<span class="keyword">:</span>nat <span class="keyword">|</span> i &lt;= n<span class="keyword">}</span></span> <span class="keyword">.&lt;</span><span class="staexp">i</span><span class="keyword">&gt;.</span> <span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp">list</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">int</span> <span class="staexp">i</span>
<span class="keyword">,</span> res<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">ptr</span><span class="staexp">?</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">list_vt</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span> <span class="keyword">=</span>
  <span class="keyword">if</span> i <span class="keyword">&gt;</span> <span class="dynexp">0</span> <span class="keyword">then</span> <span class="keyword">let</span>
    <span class="dynexp"><span class="keyword">val+</span>list_cons <span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=</span> xs</span>
    <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> res :=
      list_vt_cons<span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>0<span class="keyword">}</span></span><span class="keyword">(</span>x<span class="keyword">,</span> _<span class="comment">(*?*)</span><span class="keyword">)</span></span>
    <span class="dynexp"><span class="keyword">val+</span>list_vt_cons
      <span class="keyword">(</span>_<span class="keyword">,</span> res1<span class="keyword">)</span> <span class="keyword">=</span> res</span> <span class="comment">// res1 = res.1</span>
    <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> loop <span class="keyword">(</span>xs<span class="keyword">,</span> i-<span class="dynexp">1</span><span class="keyword">,</span> res1<span class="keyword">)</span></span>
    <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">fold@</span> <span class="keyword">(</span>res<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">in</span>
    <span class="comment">// nothing</span>
  <span class="keyword">end</span></span> <span class="keyword">else</span> <span class="keyword">(</span>res := list_vt_nil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">// end of [loop]</span>
<span class="comment">//</span>
<span class="keyword">var</span> res<span class="keyword">:</span> <span class="staexp">ptr</span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> loop <span class="keyword">(</span>xs<span class="keyword">,</span> i<span class="keyword">,</span> res<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  res
<span class="keyword">end</span></span> <span class="comment">// end of [list_take]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_take_exn
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>i<span class="keyword">}</span></span> <span class="keyword">(</span>xs<span class="keyword">,</span> i<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> lemma_list_param<span class="keyword">(</span>xs<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> loop
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>nat<span class="keyword">}</span></span>
  <span class="staexp"><span class="keyword">{</span>i<span class="keyword">:</span>nat<span class="keyword">}</span></span> <span class="keyword">.&lt;</span><span class="staexp">i</span><span class="keyword">&gt;.</span> <span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp">list</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">int</span> <span class="staexp">i</span>
<span class="keyword">,</span> res<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">ptr</span><span class="staexp">?</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">list_vt</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">j</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp"><span class="keyword">#[</span>
  j<span class="keyword">:</span>nat <span class="keyword">|</span> <span class="keyword">(</span>i &lt;= n &amp;&amp; i == j<span class="keyword">)</span> || <span class="keyword">(</span>i <span class="keyword">&gt;</span> n &amp;&amp; n == j<span class="keyword">)</span>
<span class="keyword">]</span></span> <span class="staexp">bool</span> <span class="keyword">(</span><span class="staexp">i</span> <span class="staexp">&lt;=</span> <span class="staexp">n</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">if</span> i <span class="keyword">&gt;</span> <span class="dynexp">0</span>
<span class="keyword">then</span> <span class="keyword">let</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">case+</span> xs <span class="keyword">of</span>
<span class="keyword">|</span> list_cons
    <span class="keyword">(</span>x<span class="keyword">,</span> xs1<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
    <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span> <span class="keyword">=</span>
    res := list_vt_cons<span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>0<span class="keyword">}</span></span><span class="keyword">(</span>x<span class="keyword">,</span> _<span class="keyword">)</span></span>
    <span class="dynexp"><span class="keyword">val+</span>list_vt_cons <span class="keyword">(</span>_<span class="keyword">,</span> res1<span class="keyword">)</span> <span class="keyword">=</span> res</span>
    <span class="dynexp"><span class="keyword">val</span> ans <span class="keyword">=</span> loop <span class="keyword">(</span>xs1<span class="keyword">,</span> i-<span class="dynexp">1</span><span class="keyword">,</span> res1<span class="keyword">)</span></span>
  <span class="keyword">in</span>
    <span class="keyword">fold@</span> <span class="keyword">(</span>res<span class="keyword">)</span><span class="keyword">;</span> ans
  <span class="keyword">end</span> <span class="comment">// end of [list_cons]</span>
<span class="keyword">|</span> list_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
    <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span> <span class="keyword">=</span>
    res := list_vt_nil <span class="keyword">(</span><span class="keyword">)</span></span> <span class="keyword">in</span> false<span class="comment">(*fail*)</span>
  <span class="keyword">end</span> <span class="comment">// end of [list_nil]</span>
<span class="comment">//</span>
<span class="keyword">end</span> <span class="comment">// end of [then]</span>
<span class="keyword">else</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> res := list_vt_nil <span class="keyword">(</span><span class="keyword">)</span></span> <span class="keyword">in</span> true<span class="comment">(*succ*)</span>
<span class="keyword">end</span> <span class="comment">// end of [else]</span>
<span class="comment">// end of [if]</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [loop] </span>
<span class="comment">//   </span>
<span class="keyword">var</span> res<span class="keyword">:</span> <span class="staexp">ptr</span>
<span class="dynexp"><span class="keyword">val</span> ans <span class="keyword">=</span> loop<span class="staexp"><span class="keyword">{</span>n<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>i<span class="keyword">}</span></span><span class="keyword">(</span>xs<span class="keyword">,</span> i<span class="keyword">,</span> res<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">if</span> ans
<span class="keyword">then</span> res <span class="comment">// i &lt;= n &amp;&amp; length (res) == i</span>
<span class="keyword">else</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> list_vt_free&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>res<span class="keyword">)</span></span> <span class="keyword">in</span> <span class="dynexp"><span class="keyword">$raise</span> ListSubscriptExn<span class="keyword">(</span><span class="keyword">)</span></span>
<span class="keyword">end</span> <span class="comment">// end of [if]</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">(* end of [list_take_exn] *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_drop <span class="keyword">(</span>xs<span class="keyword">,</span> i<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> loop
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="staexp"><span class="keyword">{</span>i<span class="keyword">:</span>nat <span class="keyword">|</span> i &lt;= n<span class="keyword">}</span></span> <span class="keyword">.&lt;</span><span class="staexp">i</span><span class="keyword">&gt;.</span>
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">list</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">int</span> <span class="staexp">i</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">list</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="staexp">-</span><span class="staexp">i</span><span class="keyword">)</span> <span class="keyword">=</span>
  <span class="keyword">if</span> i <span class="keyword">&gt;</span> <span class="dynexp">0</span> <span class="keyword">then</span> <span class="keyword">let</span>
    <span class="dynexp"><span class="keyword">val+</span>list_cons <span class="keyword">(</span>_<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=</span> xs</span> <span class="keyword">in</span> loop <span class="keyword">(</span>xs<span class="keyword">,</span> i-<span class="dynexp">1</span><span class="keyword">)</span>
  <span class="keyword">end</span> <span class="keyword">else</span> xs</span> <span class="comment">// end of [if]</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  loop <span class="keyword">(</span>xs<span class="keyword">,</span> i<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list_drop]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_drop_exn
  <span class="keyword">(</span>xs<span class="keyword">,</span> i<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> lemma_list_param<span class="keyword">(</span>xs<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> loop
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>nat<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>i<span class="keyword">:</span>nat<span class="keyword">}</span></span> <span class="keyword">.&lt;</span><span class="staexp">i</span><span class="keyword">&gt;.</span> <span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp">list</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">int</span> <span class="staexp">i</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">exn</span><span class="keyword">&gt;</span> <span class="staexp"><span class="keyword">[</span>i &lt;= n<span class="keyword">]</span></span> <span class="staexp">list</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="staexp">-</span><span class="staexp">i</span><span class="keyword">)</span> <span class="keyword">=</span>
  <span class="keyword">if</span> i <span class="keyword">&gt;</span> <span class="dynexp">0</span> <span class="keyword">then</span> <span class="keyword">(</span>
    <span class="keyword">case+</span> xs <span class="keyword">of</span>
    <span class="keyword">|</span> list_cons <span class="keyword">(</span>_<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span> loop <span class="keyword">(</span>xs<span class="keyword">,</span> i-<span class="dynexp">1</span><span class="keyword">)</span>
    <span class="keyword">|</span> list_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="dynexp"><span class="keyword">$raise</span> ListSubscriptExn<span class="keyword">(</span><span class="keyword">)</span></span>
  <span class="keyword">)</span> <span class="keyword">else</span> <span class="keyword">(</span>xs<span class="keyword">)</span></span> <span class="comment">// end of [if]</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  loop <span class="keyword">(</span>xs<span class="keyword">,</span> i<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list_drop_exn]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">x</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_split_at
  <span class="keyword">(</span>xs<span class="keyword">,</span> i<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> loop
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="staexp"><span class="keyword">{</span>i<span class="keyword">:</span>nat <span class="keyword">|</span> i &lt;= n<span class="keyword">}</span></span> <span class="keyword">.&lt;</span><span class="staexp">n</span><span class="keyword">&gt;.</span>
<span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp">list</span> <span class="keyword">(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">int</span> <span class="staexp">i</span>
<span class="keyword">,</span> res<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">ptr</span><span class="staexp">?</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">list_vt</span> <span class="keyword">(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">list</span> <span class="keyword">(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">n</span><span class="staexp">-</span><span class="staexp">i</span><span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
<span class="keyword">if</span> i <span class="keyword">&gt;</span> <span class="dynexp">0</span>
  <span class="keyword">then</span> <span class="keyword">let</span>
    <span class="dynexp"><span class="keyword">val+</span>list_cons <span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=</span> xs</span>
    <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span>
      res := list_vt_cons<span class="staexp"><span class="keyword">{</span>x<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>0<span class="keyword">}</span></span><span class="keyword">(</span>x<span class="keyword">,</span> _<span class="keyword">)</span></span>
    <span class="comment">// end of [val]</span>
    <span class="dynexp"><span class="keyword">val+</span>list_vt_cons <span class="keyword">(</span>_<span class="keyword">,</span> res1<span class="keyword">)</span> <span class="keyword">=</span> res</span>
    <span class="dynexp"><span class="keyword">val</span> xs2 <span class="keyword">=</span> loop <span class="keyword">(</span>xs<span class="keyword">,</span> i-<span class="dynexp">1</span><span class="keyword">,</span> res1<span class="keyword">)</span></span>
    <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">fold@</span> <span class="keyword">(</span>res<span class="keyword">)</span></span>
  <span class="keyword">in</span>
    xs2
  <span class="keyword">end</span> <span class="comment">// end of [then]</span>
  <span class="keyword">else</span> <span class="keyword">let</span>
    <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> res := list_vt_nil <span class="keyword">(</span><span class="keyword">)</span></span> <span class="keyword">in</span> xs
  <span class="keyword">end</span> <span class="comment">// end of [else]</span>
<span class="comment">// end of [if]</span>
<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">var</span> res<span class="keyword">:</span> <span class="staexp">ptr</span>
<span class="dynexp"><span class="keyword">val</span> xs2 <span class="keyword">=</span> loop <span class="keyword">(</span>xs<span class="keyword">,</span> i<span class="keyword">,</span> res<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  <span class="keyword">(</span>res<span class="keyword">,</span> xs2<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list_split_at]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">x</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_exists
  <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span> loop<span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">where</span>
<span class="keyword">{</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
loop <span class="keyword">:</span>
<span class="staexp"><span class="keyword">$d2ctype</span><span class="keyword">(</span>list_exists&lt;x<span class="keyword">&gt;</span><span class="keyword">)</span></span> <span class="keyword">=</span> <span class="keyword">lam</span><span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=&gt;</span>
<span class="comment">//</span>
<span class="keyword">case+</span> xs <span class="keyword">of</span>
<span class="keyword">|</span> list_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> false
<span class="keyword">|</span> list_cons<span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span>
    <span class="keyword">if</span> list_exists$pred&lt;<span class="staexp">x</span><span class="keyword">&gt;</span> <span class="keyword">(</span>x<span class="keyword">)</span> <span class="keyword">then</span> true <span class="keyword">else</span> loop<span class="keyword">(</span>xs<span class="keyword">)</span></span>
  <span class="comment">// end of [list_cons]</span>
<span class="comment">//</span>
<span class="keyword">}</span></span> <span class="comment">(* end of [list_exists] *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">x</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_exists_cloref
  <span class="keyword">(</span>xs<span class="keyword">,</span> pred<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span><span class="keyword">(</span><span class="staexp">x2</span><span class="keyword">)</span>
list_exists$pred&lt;<span class="staexp">x2</span><span class="keyword">&gt;</span><span class="keyword">(</span>x2<span class="keyword">)</span> <span class="keyword">=</span> pred<span class="keyword">(</span>$UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>x<span class="keyword">}</span></span><span class="keyword">(</span>x2<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  list_exists&lt;<span class="staexp">x</span><span class="keyword">&gt;</span> <span class="keyword">(</span>xs<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list_exists_cloref]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">x</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_iexists_cloref
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">}</span></span><span class="keyword">(</span>xs<span class="keyword">,</span> pred<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> lemma_list_param<span class="keyword">(</span>xs<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
loop
<span class="staexp"><span class="keyword">{</span> i<span class="keyword">,</span>j<span class="keyword">:</span>nat
<span class="keyword">|</span> i+j == n
<span class="keyword">}</span></span> <span class="keyword">.&lt;</span><span class="staexp">n</span><span class="staexp">-</span><span class="staexp">i</span><span class="keyword">&gt;.</span>
<span class="keyword">(</span>
  i<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">(</span><span class="staexp">i</span><span class="keyword">)</span><span class="keyword">,</span> xs<span class="keyword">:</span> <span class="staexp">list</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">j</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span>
<span class="keyword">(</span>
  <span class="keyword">case+</span> xs <span class="keyword">of</span>
  <span class="keyword">|</span> list_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> false
  <span class="keyword">|</span> list_cons<span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span>
      <span class="keyword">if</span> pred<span class="keyword">(</span>i<span class="keyword">,</span> x<span class="keyword">)</span> <span class="keyword">then</span> true <span class="keyword">else</span> loop<span class="keyword">(</span>i+<span class="dynexp">1</span><span class="keyword">,</span> xs<span class="keyword">)</span>
    <span class="comment">// end of [list_cons]</span>
<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  loop<span class="keyword">(</span><span class="dynexp">0</span><span class="keyword">,</span> xs<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list_iexists_cloref]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">x</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_forall
  <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span> loop<span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">where</span>
<span class="keyword">{</span>
<span class="dynexp"><span class="keyword">fun</span>
loop <span class="keyword">:</span>
<span class="staexp"><span class="keyword">$d2ctype</span><span class="keyword">(</span>list_forall&lt;x<span class="keyword">&gt;</span><span class="keyword">)</span></span> <span class="keyword">=</span> <span class="keyword">lam</span><span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=&gt;</span>
<span class="comment">//</span>
<span class="keyword">case+</span> xs <span class="keyword">of</span>
<span class="keyword">|</span> list_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> true
<span class="keyword">|</span> list_cons<span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span>
    <span class="keyword">if</span> list_forall$pred&lt;<span class="staexp">x</span><span class="keyword">&gt;</span> <span class="keyword">(</span>x<span class="keyword">)</span> <span class="keyword">then</span> loop<span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">else</span> false</span>
  <span class="comment">// end of [list_cons]</span>
<span class="comment">//</span>
<span class="keyword">}</span></span> <span class="comment">(* end of [list_forall] *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">x</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_forall_cloref
  <span class="keyword">(</span>xs<span class="keyword">,</span> pred<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span><span class="keyword">(</span><span class="staexp">x2</span><span class="keyword">)</span>
list_forall$pred&lt;<span class="staexp">x2</span><span class="keyword">&gt;</span><span class="keyword">(</span>x2<span class="keyword">)</span> <span class="keyword">=</span> pred<span class="keyword">(</span>$UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>x<span class="keyword">}</span></span><span class="keyword">(</span>x2<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  list_forall&lt;<span class="staexp">x</span><span class="keyword">&gt;</span> <span class="keyword">(</span>xs<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list_forall_cloref]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">x</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_iforall_cloref
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">}</span></span><span class="keyword">(</span>xs<span class="keyword">,</span> pred<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> lemma_list_param<span class="keyword">(</span>xs<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
loop
<span class="staexp"><span class="keyword">{</span> i<span class="keyword">,</span>j<span class="keyword">:</span>nat
<span class="keyword">|</span> i+j == n
<span class="keyword">}</span></span> <span class="keyword">.&lt;</span><span class="staexp">n</span><span class="staexp">-</span><span class="staexp">i</span><span class="keyword">&gt;.</span>
<span class="keyword">(</span>
  i<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">(</span><span class="staexp">i</span><span class="keyword">)</span><span class="keyword">,</span> xs<span class="keyword">:</span> <span class="staexp">list</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">j</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span>
<span class="keyword">(</span>
  <span class="keyword">case+</span> xs <span class="keyword">of</span>
  <span class="keyword">|</span> list_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> true
  <span class="keyword">|</span> list_cons<span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span>
      <span class="keyword">if</span> pred<span class="keyword">(</span>i<span class="keyword">,</span> x<span class="keyword">)</span> <span class="keyword">then</span> loop<span class="keyword">(</span>i+<span class="dynexp">1</span><span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">else</span> false
    <span class="comment">// end of [list_cons]</span>
<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  loop<span class="keyword">(</span><span class="dynexp">0</span><span class="keyword">,</span> xs<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list_iforall_cloref]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_equal$eqfn <span class="keyword">=</span> gequal_val_val&lt;<span class="staexp">a</span><span class="keyword">&gt;</span></span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">x</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_equal
<span class="keyword">(</span>
  xs1<span class="keyword">,</span> xs2
<span class="keyword">)</span> <span class="keyword">=</span> loop<span class="keyword">(</span>xs1<span class="keyword">,</span> xs2<span class="keyword">)</span> <span class="keyword">where</span>
<span class="keyword">{</span>
<span class="dynexp"><span class="keyword">fun</span>
loop <span class="keyword">:</span>
<span class="staexp"><span class="keyword">$d2ctype</span>
<span class="keyword">(</span>
  list_equal&lt;x<span class="keyword">&gt;</span>
<span class="keyword">)</span></span> <span class="keyword">=</span> <span class="keyword">lam</span><span class="keyword">(</span>xs1<span class="keyword">,</span> xs2<span class="keyword">)</span> <span class="keyword">=&gt;</span>
<span class="comment">//</span>
<span class="keyword">case+</span> xs1 <span class="keyword">of</span>
<span class="keyword">|</span> list_nil<span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span> <span class="keyword">=&gt;</span>
  <span class="keyword">(</span>
    <span class="keyword">case+</span> xs2 <span class="keyword">of</span>
    <span class="keyword">|</span> list_nil _ <span class="keyword">=&gt;</span> true
    <span class="keyword">|</span> list_cons _ <span class="keyword">=&gt;</span> false
  <span class="keyword">)</span> <span class="comment">// end of [list_nil]</span>
<span class="keyword">|</span> list_cons<span class="keyword">(</span>x1<span class="keyword">,</span> xs1<span class="keyword">)</span> <span class="keyword">=&gt;</span>
  <span class="keyword">(</span>
    <span class="keyword">case+</span> xs2 <span class="keyword">of</span>
    <span class="keyword">|</span> list_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> false
    <span class="keyword">|</span> list_cons<span class="keyword">(</span>x2<span class="keyword">,</span> xs2<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
        <span class="dynexp"><span class="keyword">val</span> test <span class="keyword">=</span>
          list_equal$eqfn&lt;<span class="staexp">x</span><span class="keyword">&gt;</span> <span class="keyword">(</span>x1<span class="keyword">,</span> x2<span class="keyword">)</span></span>
        <span class="comment">// end of [val]</span>
      <span class="keyword">in</span>
        <span class="keyword">if</span> test <span class="keyword">then</span> loop<span class="keyword">(</span>xs1<span class="keyword">,</span> xs2<span class="keyword">)</span> <span class="keyword">else</span> false
      <span class="keyword">end</span> <span class="comment">// end of [list_cons]</span>
  <span class="keyword">)</span></span> <span class="comment">(* end of [list_cons] *)</span>
<span class="comment">//</span>
<span class="keyword">}</span></span> <span class="comment">(* end of [list_equal] *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">x</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_equal_cloref
  <span class="keyword">(</span>xs1<span class="keyword">,</span> xs2<span class="keyword">,</span> eqfn<span class="keyword">)</span> <span class="keyword">=</span>
  list_equal&lt;<span class="staexp">x</span><span class="keyword">&gt;</span><span class="keyword">(</span>xs1<span class="keyword">,</span> xs2<span class="keyword">)</span> <span class="keyword">where</span>
<span class="keyword">{</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">y</span><span class="keyword">}</span>
list_equal$eqfn<span class="keyword">(</span>x1<span class="keyword">,</span> x2<span class="keyword">)</span> <span class="keyword">=</span> eqfn<span class="keyword">(</span>$UN<span class="keyword">.</span>cast<span class="keyword">(</span>x1<span class="keyword">)</span><span class="keyword">,</span> $UN<span class="keyword">.</span>cast<span class="keyword">(</span>x2<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">}</span></span> <span class="comment">(* end of [list_equal_cloref] *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">x</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_find
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">}</span></span><span class="keyword">(</span>xs<span class="keyword">,</span> x0<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> lemma_list_param<span class="keyword">(</span>xs<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
loop
<span class="staexp"><span class="keyword">{</span> i<span class="keyword">:</span>nat
<span class="keyword">|</span> i &lt;= n
<span class="keyword">}</span></span> <span class="keyword">.&lt;</span><span class="staexp">n</span><span class="staexp">-</span><span class="staexp">i</span><span class="keyword">&gt;.</span>
<span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp">list</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">n</span><span class="staexp">-</span><span class="staexp">i</span><span class="keyword">)</span>
<span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">(</span><span class="staexp">i</span><span class="keyword">)</span><span class="keyword">,</span> x0<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">x</span><span class="staexp">?</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">opt</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">i</span> <span class="staexp">&gt;=</span> <span class="staexp">0</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp"><span class="keyword">#[</span>i<span class="keyword">:</span>int <span class="keyword">|</span> i <span class="keyword">&lt;</span> n<span class="keyword">]</span></span> <span class="staexp">int</span><span class="keyword">(</span><span class="staexp">i</span><span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
<span class="keyword">case+</span> xs <span class="keyword">of</span>
<span class="keyword">|</span> list_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span>
  <span class="keyword">(</span>
    opt_none<span class="keyword">(</span>x0<span class="keyword">)</span><span class="keyword">;</span> <span class="keyword">~</span><span class="dynexp">1</span>
  <span class="keyword">)</span> <span class="comment">(* list_nil *)</span>
<span class="keyword">|</span> list_cons<span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span>
  <span class="keyword">(</span>
    <span class="keyword">if</span> list_find$pred&lt;<span class="staexp">x</span><span class="keyword">&gt;</span><span class="keyword">(</span>x<span class="keyword">)</span>
      <span class="keyword">then</span> <span class="keyword">(</span>x0 := x<span class="keyword">;</span> opt_some<span class="keyword">(</span>x0<span class="keyword">)</span><span class="keyword">;</span> i<span class="keyword">)</span> <span class="keyword">else</span> loop<span class="keyword">(</span>xs<span class="keyword">,</span> i+<span class="dynexp">1</span><span class="keyword">,</span> x0<span class="keyword">)</span>
    <span class="comment">// end of [if]</span>
  <span class="keyword">)</span> <span class="comment">(* list_cons *)</span>
<span class="keyword">)</span></span> <span class="comment">(* end of [loop] *)</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  loop<span class="keyword">(</span>xs<span class="keyword">,</span> <span class="dynexp">0</span><span class="keyword">,</span> x0<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list_find]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">x</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_find_exn
  <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span> loop<span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">where</span>
<span class="keyword">{</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
loop <span class="keyword">:</span>
<span class="staexp"><span class="keyword">$d2ctype</span><span class="keyword">(</span>list_find_exn&lt;x<span class="keyword">&gt;</span><span class="keyword">)</span></span> <span class="keyword">=</span> <span class="keyword">lam</span><span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=&gt;</span>
<span class="comment">//</span>
<span class="keyword">case+</span> xs <span class="keyword">of</span>
<span class="keyword">|</span> list_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span>
    <span class="dynexp"><span class="keyword">$raise</span> NotFoundExn<span class="keyword">(</span><span class="keyword">)</span></span>
<span class="keyword">|</span> list_cons<span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span>
    <span class="keyword">if</span> list_find$pred&lt;<span class="staexp">x</span><span class="keyword">&gt;</span><span class="keyword">(</span>x<span class="keyword">)</span> <span class="keyword">then</span> x <span class="keyword">else</span> loop<span class="keyword">(</span>xs<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">}</span></span> <span class="comment">(* end of [list_find_exn] *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">x</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_find_opt
  <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span> loop<span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">where</span>
<span class="keyword">{</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
loop <span class="keyword">:</span>
<span class="staexp"><span class="keyword">$d2ctype</span><span class="keyword">(</span>list_find_opt&lt;x<span class="keyword">&gt;</span><span class="keyword">)</span></span> <span class="keyword">=</span> <span class="keyword">lam</span><span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=&gt;</span>
<span class="comment">//</span>
<span class="keyword">case+</span> xs <span class="keyword">of</span>
<span class="keyword">|</span> list_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span>
    None_vt<span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span>
<span class="keyword">|</span> list_cons<span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span>
    <span class="keyword">if</span> list_find$pred&lt;<span class="staexp">x</span><span class="keyword">&gt;</span><span class="keyword">(</span>x<span class="keyword">)</span> <span class="keyword">then</span> Some_vt<span class="staexp"><span class="keyword">{</span>x<span class="keyword">}</span></span><span class="keyword">(</span>x<span class="keyword">)</span> <span class="keyword">else</span> loop<span class="keyword">(</span>xs<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">}</span></span> <span class="comment">(* end of [list_find_opt] *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">key</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_assoc$eqfn <span class="keyword">=</span> gequal_val_val&lt;<span class="staexp">key</span><span class="keyword">&gt;</span></span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">key<span class="keyword">,</span>itm</span><span class="keyword">}</span>
list_assoc
  <span class="keyword">(</span>kxs<span class="keyword">,</span> k0<span class="keyword">,</span> x0<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> loop
<span class="keyword">(</span>
  kxs<span class="keyword">:</span> <span class="staexp">List</span> <span class="keyword">@(</span><span class="staexp">key</span><span class="keyword">,</span> <span class="staexp">itm</span><span class="keyword">)</span>
<span class="keyword">,</span> k0<span class="keyword">:</span> <span class="staexp">key</span><span class="keyword">,</span> x0<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">itm</span><span class="staexp">?</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">opt</span> <span class="keyword">(</span><span class="staexp">itm</span><span class="keyword">,</span> <span class="staexp">b</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp"><span class="keyword">#[</span>b<span class="keyword">:</span>bool<span class="keyword">]</span></span> <span class="staexp">bool</span><span class="keyword">(</span><span class="staexp">b</span><span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
  <span class="keyword">case+</span> kxs <span class="keyword">of</span>
  <span class="keyword">|</span> list_cons
      <span class="keyword">(</span>kx<span class="keyword">,</span> kxs<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="dynexp"><span class="keyword">val</span> iseq <span class="keyword">=</span> list_assoc$eqfn&lt;<span class="staexp">key</span><span class="keyword">&gt;</span> <span class="keyword">(</span>k0<span class="keyword">,</span> kx<span class="dynexp"><span class="keyword">.0</span></span><span class="keyword">)</span></span>
    <span class="keyword">in</span>
      <span class="keyword">if</span> iseq
        <span class="keyword">then</span> <span class="keyword">let</span>
          <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> x0 := kx<span class="dynexp"><span class="keyword">.1</span></span></span>
          <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> opt_some<span class="staexp"><span class="keyword">{</span>itm<span class="keyword">}</span></span><span class="keyword">(</span>x0<span class="keyword">)</span></span>
        <span class="keyword">in</span>
          true
        <span class="keyword">end</span> <span class="comment">// end of [then]</span>
        <span class="keyword">else</span> loop <span class="keyword">(</span>kxs<span class="keyword">,</span> k0<span class="keyword">,</span> x0<span class="keyword">)</span>
      <span class="comment">// end of [if]</span>
    <span class="keyword">end</span> <span class="comment">// end of [list_cons]</span>
  <span class="keyword">|</span> list_nil <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span> <span class="keyword">=&gt;</span>
      <span class="keyword">let</span> <span class="prfexp"><span class="keyword">prval</span><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> opt_none<span class="staexp"><span class="keyword">{</span>itm<span class="keyword">}</span></span><span class="keyword">(</span>x0<span class="keyword">)</span></span> <span class="keyword">in</span> false <span class="keyword">end</span> 
    <span class="comment">// end of [list_nil]</span>
<span class="keyword">)</span></span> <span class="comment">(* end of [loop] *)</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  <span class="keyword">$effmask_all</span> <span class="keyword">(</span>loop <span class="keyword">(</span>kxs<span class="keyword">,</span> k0<span class="keyword">,</span> x0<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list_assoc]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">key<span class="keyword">,</span>itm</span><span class="keyword">}</span>
list_assoc_exn
  <span class="keyword">(</span>kxs<span class="keyword">,</span> k0<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">var</span> x0<span class="keyword">:</span> <span class="staexp">itm</span><span class="staexp">?</span>
  <span class="dynexp"><span class="keyword">val</span> ans <span class="keyword">=</span> list_assoc&lt;<span class="staexp">key</span><span class="keyword">,</span><span class="staexp">itm</span><span class="keyword">&gt;</span> <span class="keyword">(</span>kxs<span class="keyword">,</span> k0<span class="keyword">,</span> x0<span class="keyword">)</span></span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">if</span> ans
  <span class="keyword">then</span> <span class="keyword">let</span>
    <span class="prfexp"><span class="keyword">prval</span><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> opt_unsome<span class="staexp"><span class="keyword">{</span>itm<span class="keyword">}</span></span><span class="keyword">(</span>x0<span class="keyword">)</span></span> <span class="keyword">in</span> x0
  <span class="keyword">end</span> <span class="comment">// end of [then]</span>
  <span class="keyword">else</span> <span class="keyword">let</span>
    <span class="prfexp"><span class="keyword">prval</span><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> opt_unnone<span class="staexp"><span class="keyword">{</span>itm<span class="keyword">}</span></span><span class="keyword">(</span>x0<span class="keyword">)</span></span> <span class="keyword">in</span> <span class="dynexp"><span class="keyword">$raise</span> NotFoundExn<span class="keyword">(</span><span class="keyword">)</span></span>
  <span class="keyword">end</span> <span class="comment">// end of [else]</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list_assoc_exn]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">key<span class="keyword">,</span>itm</span><span class="keyword">}</span>
list_assoc_opt
  <span class="keyword">(</span>kxs<span class="keyword">,</span> k0<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">var</span> x0<span class="keyword">:</span> <span class="staexp">itm</span><span class="staexp">?</span>
  <span class="dynexp"><span class="keyword">val</span> ans <span class="keyword">=</span> list_assoc&lt;<span class="staexp">key</span><span class="keyword">,</span><span class="staexp">itm</span><span class="keyword">&gt;</span> <span class="keyword">(</span>kxs<span class="keyword">,</span> k0<span class="keyword">,</span> x0<span class="keyword">)</span></span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">if</span> ans
  <span class="keyword">then</span> <span class="keyword">let</span>
    <span class="prfexp"><span class="keyword">prval</span><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> opt_unsome<span class="staexp"><span class="keyword">{</span>itm<span class="keyword">}</span></span><span class="keyword">(</span>x0<span class="keyword">)</span></span> <span class="keyword">in</span> Some_vt<span class="staexp"><span class="keyword">{</span>itm<span class="keyword">}</span></span><span class="keyword">(</span>x0<span class="keyword">)</span>
  <span class="keyword">end</span> <span class="comment">// end of [then]</span>
  <span class="keyword">else</span> <span class="keyword">let</span>
    <span class="prfexp"><span class="keyword">prval</span><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> opt_unnone<span class="staexp"><span class="keyword">{</span>itm<span class="keyword">}</span></span><span class="keyword">(</span>x0<span class="keyword">)</span></span> <span class="keyword">in</span> None_vt<span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span>
  <span class="keyword">end</span> <span class="comment">// end of [else]</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list_assoc_opt]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">x</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_filter<span class="staexp"><span class="keyword">{</span>n<span class="keyword">}</span></span><span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> lemma_list_param<span class="keyword">(</span>xs<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> loop
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>nat<span class="keyword">}</span></span> <span class="keyword">.&lt;</span><span class="staexp">n</span><span class="keyword">&gt;.</span> <span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp">list</span> <span class="keyword">(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">,</span> res<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">ptr</span><span class="staexp">?</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">listLte_vt</span> <span class="keyword">(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">(</span>
  <span class="keyword">case+</span> xs <span class="keyword">of</span>
  <span class="keyword">|</span> list_cons <span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="dynexp"><span class="keyword">val</span> test <span class="keyword">=</span> list_filter$pred&lt;<span class="staexp">x</span><span class="keyword">&gt;</span> <span class="keyword">(</span>x<span class="keyword">)</span></span>
    <span class="keyword">in</span>
      <span class="keyword">case+</span> test <span class="keyword">of</span>
      <span class="keyword">|</span> true <span class="keyword">=&gt;</span> <span class="keyword">let</span>
          <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> res :=
            list_vt_cons<span class="staexp"><span class="keyword">{</span>x<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>0<span class="keyword">}</span></span><span class="keyword">(</span>x<span class="keyword">,</span> _<span class="comment">(*?*)</span><span class="keyword">)</span></span>
          <span class="dynexp"><span class="keyword">val+</span>list_vt_cons
            <span class="keyword">(</span>_<span class="keyword">,</span> res1<span class="keyword">)</span> <span class="keyword">=</span> res</span> <span class="comment">// res1 = res.1</span>
          <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> loop <span class="keyword">(</span>xs<span class="keyword">,</span> res1<span class="keyword">)</span></span>
          <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">fold@</span> <span class="keyword">(</span>res<span class="keyword">)</span></span>
        <span class="dynexp"><span class="keyword">in</span>
          <span class="comment">// nothing</span>
        <span class="keyword">end</span></span> <span class="comment">// end of [true]</span>
      <span class="keyword">|</span> false <span class="keyword">=&gt;</span> loop <span class="keyword">(</span>xs<span class="keyword">,</span> res<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [list_cons]</span>
  <span class="keyword">|</span> list_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span>res := list_vt_nil<span class="keyword">)</span>
<span class="keyword">)</span></span> <span class="comment">// end of [loop]</span>
<span class="comment">//</span>
<span class="keyword">var</span> res<span class="keyword">:</span> <span class="staexp">ptr</span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> loop <span class="keyword">(</span>xs<span class="keyword">,</span> res<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  res <span class="comment">(*listLte_vt(x, n)*)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list_filter]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">x</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_labelize
  <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span> res <span class="keyword">where</span> <span class="keyword">{</span>
<span class="comment">//</span>
<span class="keyword">typedef</span> <span class="staexp">ix <span class="keyword">=</span> <span class="keyword">@(</span><span class="staexp">int</span><span class="keyword">,</span> <span class="staexp">x</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> lemma_list_param<span class="keyword">(</span>xs<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> loop
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>nat<span class="keyword">}</span></span> <span class="keyword">.&lt;</span><span class="staexp">n</span><span class="keyword">&gt;.</span> <span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp">list</span> <span class="keyword">(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">int</span>
<span class="keyword">,</span> res<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">ptr</span><span class="staexp">?</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">list_vt</span> <span class="keyword">(</span><span class="staexp">ix</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="keyword">in</span>
  <span class="keyword">case+</span> xs <span class="keyword">of</span>
  <span class="keyword">|</span> list_cons
      <span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> res :=
        list_vt_cons<span class="staexp"><span class="keyword">{</span>ix<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>0<span class="keyword">}</span></span><span class="keyword">(</span>_<span class="keyword">,</span> _<span class="keyword">)</span></span>
      <span class="dynexp"><span class="keyword">val+</span>list_vt_cons <span class="keyword">(</span>ix<span class="keyword">,</span> res1<span class="keyword">)</span> <span class="keyword">=</span> res</span>
      <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> ix<span class="dynexp"><span class="keyword">.0</span></span> := i <span class="keyword">and</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> ix<span class="dynexp"><span class="keyword">.1</span></span> := x</span>
      <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> loop <span class="keyword">(</span>xs<span class="keyword">,</span> i+<span class="dynexp">1</span><span class="keyword">,</span> res1<span class="keyword">)</span></span>
    <span class="keyword">in</span>
      <span class="keyword">fold@</span> <span class="keyword">(</span>res<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [list_cons]</span>
  <span class="keyword">|</span> list_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span>res := list_vt_nil<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [loop]</span>
<span class="comment">//</span>
<span class="keyword">var</span> res<span class="keyword">:</span> <span class="staexp">ptr</span> <span class="keyword">;</span> <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> loop <span class="keyword">(</span>xs<span class="keyword">,</span> <span class="dynexp">0</span><span class="keyword">,</span> res<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">}</span></span> <span class="comment">// end of [list_labelize]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">x</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_app <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> lemma_list_param<span class="keyword">(</span>xs<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
loop<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>nat<span class="keyword">}</span></span> <span class="keyword">.&lt;</span><span class="staexp">n</span><span class="keyword">&gt;.</span> <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">list</span> <span class="keyword">(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span>
<span class="keyword">(</span>
<span class="keyword">case+</span> xs <span class="keyword">of</span>
<span class="keyword">|</span> list_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">|</span> list_cons <span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span>list_app$fwork<span class="keyword">(</span>x<span class="keyword">)</span><span class="keyword">;</span> loop <span class="keyword">(</span>xs<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">)</span></span> <span class="comment">(* end of [loop] *)</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  loop <span class="keyword">(</span>xs<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list_app]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">x</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_app_fun<span class="keyword">(</span>xs<span class="keyword">,</span> f<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> lemma_list_param<span class="keyword">(</span>xs<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
loop<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>nat<span class="keyword">}</span></span> <span class="keyword">.&lt;</span><span class="staexp">n</span><span class="keyword">&gt;.</span>
<span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp">list</span> <span class="keyword">(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> f<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">fun1</span><span class="keyword">&gt;</span> <span class="staexp">void</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">(</span>
<span class="comment">//</span>
<span class="keyword">case+</span> xs <span class="keyword">of</span>
<span class="keyword">|</span> list_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">|</span> list_cons <span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span>f<span class="keyword">(</span>x<span class="keyword">)</span><span class="keyword">;</span> loop <span class="keyword">(</span>xs<span class="keyword">,</span> f<span class="keyword">)</span><span class="keyword">)</span>
<span class="comment">//</span>
<span class="keyword">)</span></span> <span class="comment">(* end of [loop] *)</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  loop <span class="keyword">(</span>xs<span class="keyword">,</span> f<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list_app_fun]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">x</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_app_cloref<span class="keyword">(</span>xs<span class="keyword">,</span> f<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> lemma_list_param<span class="keyword">(</span>xs<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
loop<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>nat<span class="keyword">}</span></span> <span class="keyword">.&lt;</span><span class="staexp">n</span><span class="keyword">&gt;.</span>
<span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp">list</span> <span class="keyword">(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> f<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloref1</span><span class="keyword">&gt;</span> <span class="staexp">void</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">(</span>
<span class="comment">//</span>
<span class="keyword">case+</span> xs <span class="keyword">of</span>
<span class="keyword">|</span> list_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">|</span> list_cons <span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span>f<span class="keyword">(</span>x<span class="keyword">)</span><span class="keyword">;</span> loop <span class="keyword">(</span>xs<span class="keyword">,</span> f<span class="keyword">)</span><span class="keyword">)</span>
<span class="comment">//</span>
<span class="keyword">)</span></span> <span class="comment">(* end of [loop] *)</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  loop <span class="keyword">(</span>xs<span class="keyword">,</span> f<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list_app_cloref]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">x</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">y</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_map<span class="staexp"><span class="keyword">{</span>n<span class="keyword">}</span></span><span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> lemma_list_param<span class="keyword">(</span>xs<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> loop
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>nat<span class="keyword">}</span></span> <span class="keyword">.&lt;</span><span class="staexp">n</span><span class="keyword">&gt;.</span> <span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp">list</span> <span class="keyword">(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">,</span> res<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">ptr</span><span class="staexp">?</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">list_vt</span> <span class="keyword">(</span><span class="staexp">y</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">(</span>
  <span class="keyword">case+</span> xs <span class="keyword">of</span>
  <span class="keyword">|</span> list_cons <span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="dynexp"><span class="keyword">val</span> y <span class="keyword">=</span>
        list_map$fopr&lt;<span class="staexp">x</span><span class="keyword">&gt;&lt;</span><span class="staexp">y</span><span class="keyword">&gt;</span> <span class="keyword">(</span>x<span class="keyword">)</span></span>
      <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> res :=
        list_vt_cons<span class="staexp"><span class="keyword">{</span>y<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>0<span class="keyword">}</span></span><span class="keyword">(</span>y<span class="keyword">,</span> _<span class="comment">(*?*)</span><span class="keyword">)</span></span>
      <span class="dynexp"><span class="keyword">val+</span>list_vt_cons
        <span class="keyword">(</span>_<span class="keyword">,</span> res1<span class="keyword">)</span> <span class="keyword">=</span> res</span> <span class="comment">// res1 = res.1</span>
      <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> loop <span class="keyword">(</span>xs<span class="keyword">,</span> res1<span class="keyword">)</span></span>
      <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">fold@</span> <span class="keyword">(</span>res<span class="keyword">)</span></span>
    <span class="dynexp"><span class="keyword">in</span>
      <span class="comment">// nothing</span>
    <span class="keyword">end</span></span> <span class="comment">// end of [list_cons]</span>
  <span class="keyword">|</span> list_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span>res := list_vt_nil<span class="keyword">)</span>
<span class="keyword">)</span></span> <span class="comment">// end of [loop]</span>
<span class="comment">//</span>
<span class="keyword">var</span> res<span class="keyword">:</span> <span class="staexp">ptr</span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> loop <span class="keyword">(</span>xs<span class="keyword">,</span> res<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  res <span class="comment">(*list_vt (y, n)*)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list_map]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">x</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">y</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_map_fun
  <span class="keyword">(</span>xs<span class="keyword">,</span> fopr<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">x2</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">y2</span><span class="keyword">}</span>
list_map$fopr<span class="keyword">(</span>x2<span class="keyword">)</span> <span class="keyword">=</span>
  $UN<span class="keyword">.</span>castvwtp0<span class="staexp"><span class="keyword">{</span>y2<span class="keyword">}</span></span><span class="keyword">(</span>fopr<span class="keyword">(</span>$UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>x<span class="keyword">}</span></span><span class="keyword">(</span>x2<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  list_map&lt;<span class="staexp">x</span><span class="keyword">&gt;&lt;</span><span class="staexp">y</span><span class="keyword">&gt;</span> <span class="keyword">(</span>xs<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list_map_fun]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">x</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">y</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_map_clo
  <span class="keyword">(</span>xs<span class="keyword">,</span> fopr<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> fopr <span class="keyword">=</span>
  $UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span><span class="keyword">(</span>x<span class="keyword">)</span> <span class="keyword">-&lt;</span>cloref1<span class="keyword">&gt;</span> y<span class="keyword">}</span></span><span class="keyword">(</span><span class="dynexp"><span class="keyword">addr@</span></span>fopr<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">x2</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">y2</span><span class="keyword">}</span>
list_map$fopr<span class="keyword">(</span>x2<span class="keyword">)</span> <span class="keyword">=</span>
  $UN<span class="keyword">.</span>castvwtp0<span class="staexp"><span class="keyword">{</span>y2<span class="keyword">}</span></span><span class="keyword">(</span>fopr<span class="keyword">(</span>$UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>x<span class="keyword">}</span></span><span class="keyword">(</span>x2<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  list_map&lt;<span class="staexp">x</span><span class="keyword">&gt;&lt;</span><span class="staexp">y</span><span class="keyword">&gt;</span> <span class="keyword">(</span>xs<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list_map_clo]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">x</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">y</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_map_cloref
  <span class="keyword">(</span>xs<span class="keyword">,</span> fopr<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">x2</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">y2</span><span class="keyword">}</span>
list_map$fopr<span class="keyword">(</span>x2<span class="keyword">)</span> <span class="keyword">=</span>
  $UN<span class="keyword">.</span>castvwtp0<span class="staexp"><span class="keyword">{</span>y2<span class="keyword">}</span></span><span class="keyword">(</span>fopr<span class="keyword">(</span>$UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>x<span class="keyword">}</span></span><span class="keyword">(</span>x2<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  list_map&lt;<span class="staexp">x</span><span class="keyword">&gt;&lt;</span><span class="staexp">y</span><span class="keyword">&gt;</span> <span class="keyword">(</span>xs<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list_map_cloref]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
implement
{x}{y}(*tmp*)
list_map_funenv
  {v}{vt}{n}{fe}
  (pfv | xs, f, env) = let
//
prval() =
  lemma_list_param(xs)
//
vtypedef ys = List0_vt(y)
//
fun loop {n:nat} .&lt;n&gt;. (
  pfv: !v
| xs: list (x, n)
, f: (!v | x, !vt) -&lt;fun,fe&gt; y
, env: !vt
, res: &amp;ys? &gt;&gt; list_vt (y, n)
) :&lt;!wrt,fe&gt; void = let
in
//
case+ xs of
| list_cons
    (x, xs) =&gt; let
    val y = f (pfv | x, env)
    val () = res :=
      list_vt_cons{y}{0}(y, _(*?*))
    val+list_vt_cons
      (_, res1) = res // res1 = res.1
    val () = loop (pfv | xs, f, env, res1)
    prval () = fold@ (res)
  in
    (*nothing*)
  end // end of [list_vt_cons]
| list_nil (
  ) =&gt; (res := list_vt_nil ())
//
end // end of [loop]
//
var res: ys // uninitialized
val () = loop (pfv | xs, f, env, res)
//
in
  res(*list_vt(y,n)*)
end // end of [list_map_funenv]
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">x</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">y</span><span class="keyword">}</span>
list_imap<span class="staexp"><span class="keyword">{</span>n<span class="keyword">}</span></span><span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> lemma_list_param<span class="keyword">(</span>xs<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> loop
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>nat<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>i<span class="keyword">:</span>nat<span class="keyword">}</span></span> <span class="keyword">.&lt;</span><span class="staexp">n</span><span class="keyword">&gt;.</span>
<span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp">list</span> <span class="keyword">(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">(</span><span class="staexp">i</span><span class="keyword">)</span>
<span class="keyword">,</span> res<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">ptr</span><span class="staexp">?</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">list_vt</span> <span class="keyword">(</span><span class="staexp">y</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">(</span>
  <span class="keyword">case+</span> xs <span class="keyword">of</span>
  <span class="keyword">|</span> list_cons
      <span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="dynexp"><span class="keyword">val</span> y <span class="keyword">=</span>
        list_imap$fopr&lt;<span class="staexp">x</span><span class="keyword">&gt;&lt;</span><span class="staexp">y</span><span class="keyword">&gt;</span> <span class="keyword">(</span>i<span class="keyword">,</span> x<span class="keyword">)</span></span>
      <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> res :=
        list_vt_cons<span class="staexp"><span class="keyword">{</span>y<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>0<span class="keyword">}</span></span><span class="keyword">(</span>y<span class="keyword">,</span> _<span class="comment">(*?*)</span><span class="keyword">)</span></span>
      <span class="dynexp"><span class="keyword">val+</span>list_vt_cons
        <span class="keyword">(</span>_<span class="keyword">,</span> res1<span class="keyword">)</span> <span class="keyword">=</span> res</span> <span class="comment">// res1 = res.1</span>
      <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> loop <span class="keyword">(</span>xs<span class="keyword">,</span> i+<span class="dynexp">1</span><span class="keyword">,</span> res1<span class="keyword">)</span></span>
      <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">fold@</span> <span class="keyword">(</span>res<span class="keyword">)</span></span>
    <span class="dynexp"><span class="keyword">in</span>
      <span class="comment">// nothing</span>
    <span class="keyword">end</span></span> <span class="comment">// end of [list_cons]</span>
  <span class="keyword">|</span> list_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span>res := list_vt_nil<span class="keyword">)</span>
<span class="keyword">)</span></span> <span class="comment">// end of [loop]</span>
<span class="comment">//</span>
<span class="keyword">var</span> res<span class="keyword">:</span> <span class="staexp">ptr</span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> loop <span class="keyword">(</span>xs<span class="keyword">,</span> <span class="dynexp">0</span><span class="keyword">,</span> res<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  res <span class="comment">(*list_vt (y, n)*)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list_imap]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">x</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">y</span><span class="keyword">}</span>
list_mapopt<span class="staexp"><span class="keyword">{</span>n<span class="keyword">}</span></span><span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> lemma_list_param<span class="keyword">(</span>xs<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> loop
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>nat<span class="keyword">}</span></span> <span class="keyword">.&lt;</span><span class="staexp">n</span><span class="keyword">&gt;.</span> <span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp">list</span> <span class="keyword">(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">,</span> res<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">ptr</span><span class="staexp">?</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">listLte_vt</span> <span class="keyword">(</span><span class="staexp">y</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">case+</span> xs <span class="keyword">of</span>
<span class="keyword">|</span> list_cons <span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
    <span class="dynexp"><span class="keyword">val</span> opt <span class="keyword">=</span>
      list_mapopt$fopr&lt;<span class="staexp">x</span><span class="keyword">&gt;&lt;</span><span class="staexp">y</span><span class="keyword">&gt;</span> <span class="keyword">(</span>x<span class="keyword">)</span></span>
    <span class="comment">// end of [val]</span>
  <span class="keyword">in</span>
    <span class="keyword">case+</span> opt <span class="keyword">of</span>
    <span class="keyword">|</span> <span class="keyword">~</span>Some_vt <span class="keyword">(</span>y<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
        <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> res :=
          list_vt_cons<span class="staexp"><span class="keyword">{</span>y<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>0<span class="keyword">}</span></span><span class="keyword">(</span>y<span class="keyword">,</span> _<span class="comment">(*?*)</span><span class="keyword">)</span></span>
        <span class="dynexp"><span class="keyword">val+</span>list_vt_cons
          <span class="keyword">(</span>_<span class="keyword">,</span> res1<span class="keyword">)</span> <span class="keyword">=</span> res</span> <span class="comment">// res1 = res.1</span>
        <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> loop <span class="keyword">(</span>xs<span class="keyword">,</span> res1<span class="keyword">)</span></span>
        <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">fold@</span> <span class="keyword">(</span>res<span class="keyword">)</span></span>
      <span class="dynexp"><span class="keyword">in</span>
        <span class="comment">// nothing</span>
      <span class="keyword">end</span></span> <span class="comment">// end of [Some_vt]</span>
    <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> loop <span class="keyword">(</span>xs<span class="keyword">,</span> res<span class="keyword">)</span>
  <span class="keyword">end</span> <span class="comment">// end of [list_cons]</span>
<span class="keyword">|</span> list_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span>res := list_vt_nil<span class="keyword">)</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [loop]</span>
<span class="comment">//</span>
<span class="keyword">var</span> res<span class="keyword">:</span> <span class="staexp">ptr</span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> loop <span class="keyword">(</span>xs<span class="keyword">,</span> res<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  res <span class="comment">(*listLte_vt(y, n)*)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list_mapopt]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
implement
{x}{y}(*tmp*)
list_mapopt_funenv
  {v}{vt}{n}{fe}
  (pfv | xs, f, env) = let
//
prval() =
  lemma_list_param(xs)
//
vtypedef ys = List0_vt(y)
//
fun loop {n:nat} .&lt;n&gt;. (
  pfv: !v
| xs: list (x, n)
, f: (!v | x, !vt) -&lt;fun,fe&gt; Option_vt (y)
, env: !vt
, res: &amp;ys? &gt;&gt; listLte_vt (y, n)
) :&lt;!wrt,fe&gt; void = let
in
  case+ xs of
  | list_cons
      (x, xs) =&gt; let
      val opt = f (pfv | x, env)
    in
      case+ opt of
      | ~Some_vt (y) =&gt; let
          val () = res :=
            list_vt_cons{y}{0}(y, _(*?*))
          val+list_vt_cons
            (_, res1) = res // res1 = res.1
          val () = loop (pfv | xs, f, env, res1)
          prval () = fold@ (res)
        in
          (*nothing*)
        end // end of [Some_vt]
      | ~None_vt () =&gt; loop (pfv | xs, f, env, res)
    end // end of [list_vt_cons]
  | list_nil () =&gt; (res := list_vt_nil ())
    // end of [list_nil]
end // end of [loop]
//
var res: ys // uninitialized
val () = loop (pfv | xs, f, env, res)
//
in
  res(*listLte_vt(y,n)*)
end // end of [list_mapopt_funenv]
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">x1<span class="keyword">,</span>x2</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">y</span><span class="keyword">}</span>
list_map2
  <span class="staexp"><span class="keyword">{</span>n1<span class="keyword">,</span>n2<span class="keyword">}</span></span><span class="keyword">(</span>xs1<span class="keyword">,</span> xs2<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> lemma_list_param<span class="keyword">(</span>xs1<span class="keyword">)</span></span>
<span class="prfexp"><span class="keyword">prval</span><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> lemma_list_param<span class="keyword">(</span>xs2<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
loop<span class="staexp"><span class="keyword">{</span>n1<span class="keyword">,</span>n2<span class="keyword">:</span>nat<span class="keyword">}</span></span>
<span class="keyword">(</span>
  xs1<span class="keyword">:</span> <span class="staexp">list</span> <span class="keyword">(</span><span class="staexp">x1</span><span class="keyword">,</span> <span class="staexp">n1</span><span class="keyword">)</span>
<span class="keyword">,</span> xs2<span class="keyword">:</span> <span class="staexp">list</span> <span class="keyword">(</span><span class="staexp">x2</span><span class="keyword">,</span> <span class="staexp">n2</span><span class="keyword">)</span>
<span class="keyword">,</span> res<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">ptr</span><span class="staexp">?</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">list_vt</span> <span class="keyword">(</span><span class="staexp">y</span><span class="keyword">,</span> <span class="staexp">min</span><span class="keyword">(</span><span class="staexp">n1</span><span class="keyword">,</span><span class="staexp">n2</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">case+</span> <span class="keyword">(</span>xs1<span class="keyword">,</span> xs2<span class="keyword">)</span> <span class="keyword">of</span>
<span class="keyword">|</span> <span class="keyword">(</span>list_cons <span class="keyword">(</span>x1<span class="keyword">,</span> xs1<span class="keyword">)</span><span class="keyword">,</span>
   list_cons <span class="keyword">(</span>x2<span class="keyword">,</span> xs2<span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=&gt;</span>
  <span class="keyword">{</span>
    <span class="dynexp"><span class="keyword">val</span> y <span class="keyword">=</span> list_map2$fopr <span class="keyword">(</span>x1<span class="keyword">,</span> x2<span class="keyword">)</span></span>
    <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span>
      res := list_vt_cons<span class="staexp"><span class="keyword">{</span>y<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>0<span class="keyword">}</span></span><span class="keyword">(</span>y<span class="keyword">,</span> _<span class="keyword">)</span></span>
    <span class="dynexp"><span class="keyword">val+</span>list_vt_cons <span class="keyword">(</span>_<span class="keyword">,</span> res1<span class="keyword">)</span> <span class="keyword">=</span> res</span>
    <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span> <span class="keyword">=</span> loop <span class="keyword">(</span>xs1<span class="keyword">,</span> xs2<span class="keyword">,</span> res1<span class="keyword">)</span></span>
    <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="comment">(*folded*)</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">fold@</span> <span class="keyword">(</span>res<span class="keyword">)</span></span>
  <span class="keyword">}</span> <span class="comment">(* end of [cons, cons] *)</span>
<span class="keyword">|</span> <span class="keyword">(</span>_<span class="keyword">,</span> _<span class="keyword">)</span> <span class="keyword">=&gt;&gt;</span> <span class="keyword">(</span>res := list_vt_nil<span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [loop]</span>
<span class="comment">//</span>
<span class="keyword">var</span> res<span class="keyword">:</span> <span class="staexp">ptr</span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span> <span class="keyword">=</span> loop <span class="keyword">(</span>xs1<span class="keyword">,</span> xs2<span class="keyword">,</span> res<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  res
<span class="keyword">end</span></span> <span class="comment">// end of [list_map2]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">x</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_tabulate
  <span class="keyword">(</span>n<span class="keyword">)</span> <span class="keyword">=</span> res <span class="keyword">where</span> <span class="keyword">{</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> loop
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="staexp"><span class="keyword">{</span>i<span class="keyword">:</span>nat <span class="keyword">|</span> i &lt;= n<span class="keyword">}</span></span>
  <span class="keyword">.&lt;</span><span class="staexp">n</span><span class="staexp">-</span><span class="staexp">i</span><span class="keyword">&gt;.</span> <span class="keyword">(</span>
  n<span class="keyword">:</span> <span class="staexp">int</span> <span class="staexp">n</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">int</span> <span class="staexp">i</span>
<span class="keyword">,</span> res<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">ptr</span><span class="staexp">?</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">list_vt</span> <span class="keyword">(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">n</span><span class="staexp">-</span><span class="staexp">i</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span>
  <span class="keyword">if</span> n <span class="keyword">&gt;</span> i <span class="keyword">then</span> <span class="keyword">let</span>
    <span class="dynexp"><span class="keyword">val</span> x <span class="keyword">=</span>
      list_tabulate$fopr&lt;<span class="staexp">x</span><span class="keyword">&gt;</span> <span class="keyword">(</span>i<span class="keyword">)</span></span>
    <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> res :=
      list_vt_cons<span class="staexp"><span class="keyword">{</span>x<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>0<span class="keyword">}</span></span><span class="keyword">(</span>x<span class="keyword">,</span> _<span class="comment">(*?*)</span><span class="keyword">)</span></span>
    <span class="dynexp"><span class="keyword">val+</span>list_vt_cons
      <span class="keyword">(</span>_<span class="keyword">,</span> res1<span class="keyword">)</span> <span class="keyword">=</span> res</span> <span class="comment">// res1 = res.1</span>
    <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> loop <span class="keyword">(</span>n<span class="keyword">,</span> succ<span class="keyword">(</span>i<span class="keyword">)</span><span class="keyword">,</span> res1<span class="keyword">)</span></span>
    <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">fold@</span> <span class="keyword">(</span>res<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">in</span>
    <span class="comment">// nothing</span>
  <span class="keyword">end</span></span> <span class="keyword">else</span> <span class="keyword">(</span>res := list_vt_nil<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">var</span> res<span class="keyword">:</span> <span class="staexp">ptr</span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> loop <span class="keyword">(</span>n<span class="keyword">,</span> <span class="dynexp">0</span><span class="keyword">,</span> res<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">}</span></span> <span class="comment">// end of [list_tabulate]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_tabulate_fun <span class="keyword">(</span>n<span class="keyword">,</span> f<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> f <span class="keyword">=</span> $UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>int <span class="keyword">-&gt;</span> a<span class="keyword">}</span></span><span class="keyword">(</span>f<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span><span class="keyword">(</span><span class="staexp">a2</span><span class="keyword">)</span>
list_tabulate$fopr&lt;<span class="staexp">a2</span><span class="keyword">&gt;</span> <span class="keyword">(</span>n<span class="keyword">)</span> <span class="keyword">=</span> $UN<span class="keyword">.</span>castvwtp0<span class="staexp"><span class="keyword">{</span>a2<span class="keyword">}</span></span><span class="keyword">(</span>f<span class="keyword">(</span>n<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  list_tabulate&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>n<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list_tabulate_fun]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_tabulate_clo <span class="keyword">(</span>n<span class="keyword">,</span> f<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> f <span class="keyword">=</span> $UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>int <span class="keyword">-&lt;</span>cloref1<span class="keyword">&gt;</span> a<span class="keyword">}</span></span><span class="keyword">(</span><span class="dynexp"><span class="keyword">addr@</span></span>f<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span><span class="keyword">(</span><span class="staexp">a2</span><span class="keyword">)</span>
list_tabulate$fopr&lt;<span class="staexp">a2</span><span class="keyword">&gt;</span> <span class="keyword">(</span>n<span class="keyword">)</span> <span class="keyword">=</span> $UN<span class="keyword">.</span>castvwtp0<span class="staexp"><span class="keyword">{</span>a2<span class="keyword">}</span></span><span class="keyword">(</span>f<span class="keyword">(</span>n<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  list_tabulate&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>n<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list_tabulate_clo]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_tabulate_cloref <span class="keyword">(</span>n<span class="keyword">,</span> f<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> f <span class="keyword">=</span> $UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>int <span class="keyword">-&lt;</span>cloref1<span class="keyword">&gt;</span> a<span class="keyword">}</span></span><span class="keyword">(</span>f<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span><span class="keyword">(</span><span class="staexp">a2</span><span class="keyword">)</span>
list_tabulate$fopr&lt;<span class="staexp">a2</span><span class="keyword">&gt;</span> <span class="keyword">(</span>n<span class="keyword">)</span> <span class="keyword">=</span> $UN<span class="keyword">.</span>castvwtp0<span class="staexp"><span class="keyword">{</span>a2<span class="keyword">}</span></span><span class="keyword">(</span>f<span class="keyword">(</span>n<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  list_tabulate&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>n<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list_tabulate_cloref]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">x<span class="keyword">,</span>y</span><span class="keyword">}</span>
list_zip <span class="keyword">(</span>xs<span class="keyword">,</span> ys<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="keyword">typedef</span> <span class="staexp">xy <span class="keyword">=</span> <span class="keyword">@(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">y</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
list_zipwith$fopr&lt;<span class="staexp">x</span><span class="keyword">,</span><span class="staexp">y</span><span class="keyword">&gt;&lt;</span><span class="staexp">xy</span><span class="keyword">&gt;</span> <span class="keyword">(</span>x<span class="keyword">,</span> y<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">@(</span>x<span class="keyword">,</span> y<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  <span class="keyword">$effmask_all</span> <span class="keyword">(</span>list_zipwith&lt;<span class="staexp">x</span><span class="keyword">,</span><span class="staexp">y</span><span class="keyword">&gt;&lt;</span><span class="staexp">xy</span><span class="keyword">&gt;</span> <span class="keyword">(</span>xs<span class="keyword">,</span> ys<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list_zip]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">x<span class="keyword">,</span>y</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">xy</span><span class="keyword">}</span>
list_zipwith
  <span class="keyword">(</span>xs<span class="keyword">,</span> ys<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> lemma_list_param<span class="keyword">(</span>xs<span class="keyword">)</span></span>
<span class="prfexp"><span class="keyword">prval</span><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> lemma_list_param<span class="keyword">(</span>ys<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> loop
  <span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">:</span>nat<span class="keyword">}</span></span> <span class="keyword">.&lt;</span><span class="staexp">m</span><span class="keyword">&gt;.</span> <span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp">list</span> <span class="keyword">(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">)</span>
<span class="keyword">,</span> ys<span class="keyword">:</span> <span class="staexp">list</span> <span class="keyword">(</span><span class="staexp">y</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">,</span> res<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">ptr</span><span class="staexp">?</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">list_vt</span> <span class="keyword">(</span><span class="staexp">xy</span><span class="keyword">,</span> <span class="staexp">min</span><span class="keyword">(</span><span class="staexp">m</span><span class="keyword">,</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">case+</span> xs <span class="keyword">of</span>
<span class="keyword">|</span> list_cons <span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span>
  <span class="keyword">case+</span> ys <span class="keyword">of</span>
  <span class="keyword">|</span> list_cons <span class="keyword">(</span>y<span class="keyword">,</span> ys<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="dynexp"><span class="keyword">val</span> xy <span class="keyword">=</span>
        list_zipwith$fopr&lt;<span class="staexp">x</span><span class="keyword">,</span><span class="staexp">y</span><span class="keyword">&gt;&lt;</span><span class="staexp">xy</span><span class="keyword">&gt;</span> <span class="keyword">(</span>x<span class="keyword">,</span> y<span class="keyword">)</span></span>
      <span class="comment">// end of [val]</span>
      <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> res :=
        list_vt_cons<span class="staexp"><span class="keyword">{</span>xy<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>0<span class="keyword">}</span></span><span class="keyword">(</span>xy<span class="keyword">,</span> _<span class="comment">(*y*)</span><span class="keyword">)</span></span>
      <span class="dynexp"><span class="keyword">val+</span>list_vt_cons
        <span class="keyword">(</span>xy<span class="keyword">,</span> res1<span class="keyword">)</span> <span class="keyword">=</span> res</span> <span class="comment">// res1 = res.1</span>
      <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> loop <span class="keyword">(</span>xs<span class="keyword">,</span> ys<span class="keyword">,</span> res1<span class="keyword">)</span></span>
    <span class="keyword">in</span>
      <span class="keyword">fold@</span> <span class="keyword">(</span>res<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [list_cons]</span>
  <span class="keyword">|</span> list_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span>res := list_vt_nil<span class="keyword">)</span>
  <span class="keyword">)</span> <span class="comment">// end of [list_cons]</span>
<span class="keyword">|</span> list_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span>res := list_vt_nil<span class="keyword">)</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [loop]</span>
<span class="comment">//</span>
<span class="keyword">var</span> res<span class="keyword">:</span> <span class="staexp">ptr</span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> loop <span class="keyword">(</span>xs<span class="keyword">,</span> ys<span class="keyword">,</span> res<span class="keyword">)</span></span>
<span class="keyword">in</span>
  res
<span class="keyword">end</span></span> <span class="comment">// end of [list_zipwith]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">x<span class="keyword">,</span>y</span><span class="keyword">}</span>
list_cross <span class="keyword">(</span>xs<span class="keyword">,</span> ys<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="keyword">typedef</span> <span class="staexp">xy <span class="keyword">=</span> <span class="keyword">@(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">y</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
list_crosswith$fopr&lt;<span class="staexp">x</span><span class="keyword">,</span><span class="staexp">y</span><span class="keyword">&gt;&lt;</span><span class="staexp">xy</span><span class="keyword">&gt;</span> <span class="keyword">(</span>x<span class="keyword">,</span> y<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">@(</span>x<span class="keyword">,</span> y<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  <span class="keyword">$effmask_all</span> <span class="keyword">(</span>list_crosswith&lt;<span class="staexp">x</span><span class="keyword">,</span><span class="staexp">y</span><span class="keyword">&gt;&lt;</span><span class="staexp">xy</span><span class="keyword">&gt;</span> <span class="keyword">(</span>xs<span class="keyword">,</span> ys<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list_cross]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">x<span class="keyword">,</span>y</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">xy</span><span class="keyword">}</span>
list_crosswith
  <span class="keyword">(</span>xs<span class="keyword">,</span> ys<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> lemma_list_param<span class="keyword">(</span>xs<span class="keyword">)</span></span>
<span class="prfexp"><span class="keyword">prval</span><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> lemma_list_param<span class="keyword">(</span>ys<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fnx</span> loop1
  <span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">:</span>nat<span class="keyword">}</span></span> <span class="keyword">.&lt;</span><span class="staexp">m</span><span class="keyword">,</span><span class="staexp">0</span><span class="keyword">,</span><span class="staexp">0</span><span class="keyword">&gt;.</span>
<span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp">list</span> <span class="keyword">(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">)</span>
<span class="keyword">,</span> ys<span class="keyword">:</span> <span class="staexp">list</span> <span class="keyword">(</span><span class="staexp">y</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">,</span> res<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">ptr</span><span class="staexp">?</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">list_vt</span> <span class="keyword">(</span><span class="staexp">xy</span><span class="keyword">,</span> <span class="staexp">m</span><span class="staexp">*</span><span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="keyword">in</span>
  <span class="keyword">case+</span> xs <span class="keyword">of</span>
  <span class="keyword">|</span> list_cons
      <span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span> loop2 <span class="keyword">(</span>xs<span class="keyword">,</span> ys<span class="keyword">,</span> x<span class="keyword">,</span> ys<span class="keyword">,</span> res<span class="keyword">)</span>
  <span class="keyword">|</span> list_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span>res := list_vt_nil<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [loop1]</span>

<span class="keyword">and</span> loop2
  <span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">,</span>n2<span class="keyword">:</span>nat<span class="keyword">}</span></span> <span class="keyword">.&lt;</span><span class="staexp">m</span><span class="keyword">,</span><span class="staexp">n2</span><span class="keyword">,</span><span class="staexp">1</span><span class="keyword">&gt;.</span>
<span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp">list</span> <span class="keyword">(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">)</span>
<span class="keyword">,</span> ys<span class="keyword">:</span> <span class="staexp">list</span> <span class="keyword">(</span><span class="staexp">y</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">,</span> x<span class="keyword">:</span> <span class="staexp">x</span><span class="keyword">,</span> ys2<span class="keyword">:</span> <span class="staexp">list</span> <span class="keyword">(</span><span class="staexp">y</span><span class="keyword">,</span> <span class="staexp">n2</span><span class="keyword">)</span>
<span class="keyword">,</span> res<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">ptr</span><span class="staexp">?</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">list_vt</span> <span class="keyword">(</span><span class="staexp">xy</span><span class="keyword">,</span> <span class="staexp">m</span><span class="staexp">*</span><span class="staexp">n</span><span class="staexp">+</span><span class="staexp">n2</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">case+</span> ys2 <span class="keyword">of</span>
<span class="keyword">|</span> list_cons
    <span class="keyword">(</span>y<span class="keyword">,</span> ys2<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
    <span class="dynexp"><span class="keyword">val</span> xy <span class="keyword">=</span> 
      list_crosswith$fopr&lt;<span class="staexp">x</span><span class="keyword">,</span><span class="staexp">y</span><span class="keyword">&gt;&lt;</span><span class="staexp">xy</span><span class="keyword">&gt;</span> <span class="keyword">(</span>x<span class="keyword">,</span> y<span class="keyword">)</span></span>
    <span class="comment">// end of [val]</span>
    <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> res :=
      list_vt_cons<span class="staexp"><span class="keyword">{</span>xy<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>0<span class="keyword">}</span></span><span class="keyword">(</span>xy<span class="keyword">,</span> _<span class="comment">(*?*)</span><span class="keyword">)</span></span>
    <span class="dynexp"><span class="keyword">val+</span>list_vt_cons <span class="keyword">(</span>_<span class="keyword">,</span> res1<span class="keyword">)</span> <span class="keyword">=</span> res</span>
    <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> loop2 <span class="keyword">(</span>xs<span class="keyword">,</span> ys<span class="keyword">,</span> x<span class="keyword">,</span> ys2<span class="keyword">,</span> res1<span class="keyword">)</span></span>
    <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> mul_gte_gte_gte<span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">}</span></span><span class="keyword">(</span><span class="keyword">)</span></span>
  <span class="keyword">in</span>
    <span class="keyword">fold@</span> <span class="keyword">(</span>res<span class="keyword">)</span>
  <span class="keyword">end</span> <span class="comment">// end of [list_cons]</span>
<span class="keyword">|</span> list_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> loop1 <span class="keyword">(</span>xs<span class="keyword">,</span> ys<span class="keyword">,</span> res<span class="keyword">)</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [loop2]</span>
<span class="comment">//</span>
<span class="keyword">var</span> res<span class="keyword">:</span> <span class="staexp">ptr</span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> loop1 <span class="keyword">(</span>xs<span class="keyword">,</span> ys<span class="keyword">,</span> res<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  res
<span class="keyword">end</span></span> <span class="comment">// end of [list_crosswith]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">x</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_foreach<span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="keyword">var</span> env<span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">in</span> list_foreach_env&lt;<span class="staexp">x</span><span class="keyword">&gt;&lt;</span><span class="staexp">void</span><span class="keyword">&gt;</span><span class="keyword">(</span>xs<span class="keyword">,</span> env<span class="keyword">)</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list_foreach]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">x</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">env</span><span class="keyword">}</span>
list_foreach_env
  <span class="keyword">(</span>xs<span class="keyword">,</span> env<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> lemma_list_param<span class="keyword">(</span>xs<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
loop
<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>nat<span class="keyword">}</span></span> <span class="keyword">.&lt;</span><span class="staexp">n</span><span class="keyword">&gt;.</span>
<span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp">list</span> <span class="keyword">(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">env</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">case+</span> xs <span class="keyword">of</span>
<span class="keyword">|</span> list_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">|</span> list_cons<span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
    <span class="dynexp"><span class="keyword">val</span> test <span class="keyword">=</span>
      list_foreach$cont&lt;<span class="staexp">x</span><span class="keyword">&gt;&lt;</span><span class="staexp">env</span><span class="keyword">&gt;</span> <span class="keyword">(</span>x<span class="keyword">,</span> env<span class="keyword">)</span></span>
    <span class="comment">// end of [val]</span>
  <span class="keyword">in</span>
    <span class="keyword">if</span> test <span class="keyword">then</span> <span class="keyword">let</span>
      <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span>
      list_foreach$fwork&lt;<span class="staexp">x</span><span class="keyword">&gt;&lt;</span><span class="staexp">env</span><span class="keyword">&gt;</span> <span class="keyword">(</span>x<span class="keyword">,</span> env<span class="keyword">)</span></span>
    <span class="keyword">in</span>
      loop <span class="keyword">(</span>xs<span class="keyword">,</span> env<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="comment">// end of [if]</span>
  <span class="keyword">end</span> <span class="comment">// end of [list_cons]</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [loop]</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  loop <span class="keyword">(</span>xs<span class="keyword">,</span> env<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list_foreach_env]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">x</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">env</span><span class="keyword">}</span>
list_foreach$cont <span class="keyword">(</span>x<span class="keyword">,</span> env<span class="keyword">)</span> <span class="keyword">=</span> true</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">x</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_foreach_fun
  <span class="keyword">(</span>xs<span class="keyword">,</span> f<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> loop <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">List</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span>
<span class="comment">//</span>
<span class="keyword">case+</span> xs <span class="keyword">of</span>
<span class="keyword">|</span> list_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">|</span> list_cons <span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span>f <span class="keyword">(</span>x<span class="keyword">)</span><span class="keyword">;</span> loop <span class="keyword">(</span>xs<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  <span class="keyword">$effmask_all</span> <span class="keyword">(</span>loop <span class="keyword">(</span>xs<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list_foreach_fun]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">x</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_foreach_clo
  <span class="keyword">(</span>xs<span class="keyword">,</span> f<span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
<span class="keyword">$effmask_all</span>
  <span class="keyword">(</span>list_foreach_cloref&lt;<span class="staexp">x</span><span class="keyword">&gt;</span><span class="keyword">(</span>xs<span class="keyword">,</span> $UN<span class="keyword">.</span>cast<span class="keyword">(</span><span class="dynexp"><span class="keyword">addr@</span></span>f<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">)</span></span> <span class="comment">(* list_foreach_clo *)</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">x</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_foreach_vclo
  <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> xs<span class="keyword">,</span> f<span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
<span class="keyword">$effmask_all</span>
  <span class="keyword">(</span>list_foreach_cloref&lt;<span class="staexp">x</span><span class="keyword">&gt;</span><span class="keyword">(</span>xs<span class="keyword">,</span> $UN<span class="keyword">.</span>cast<span class="keyword">(</span><span class="dynexp"><span class="keyword">addr@</span></span>f<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">)</span></span> <span class="comment">(* list_foreach_vclo *)</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">x</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_foreach_cloptr
  <span class="keyword">(</span>xs<span class="keyword">,</span> f<span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
<span class="keyword">$effmask_all</span>
  <span class="keyword">(</span>list_foreach_cloref&lt;<span class="staexp">x</span><span class="keyword">&gt;</span><span class="keyword">(</span>xs<span class="keyword">,</span> $UN<span class="keyword">.</span>castvwtp1<span class="keyword">(</span>f<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">)</span></span> <span class="comment">(* list_foreach_cloptr *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">x</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_foreach_vcloptr
  <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> xs<span class="keyword">,</span> f<span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
<span class="keyword">$effmask_all</span>
  <span class="keyword">(</span>list_foreach_cloref&lt;<span class="staexp">x</span><span class="keyword">&gt;</span><span class="keyword">(</span>xs<span class="keyword">,</span> $UN<span class="keyword">.</span>castvwtp1<span class="keyword">(</span>f<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">)</span></span> <span class="comment">(* list_foreach_vcloptr *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">x</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_foreach_cloref
  <span class="keyword">(</span>xs<span class="keyword">,</span> f<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> loop <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">List</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span>
<span class="comment">//</span>
<span class="keyword">case+</span> xs <span class="keyword">of</span>
<span class="keyword">|</span> list_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">|</span> list_cons <span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span>f <span class="keyword">(</span>x<span class="keyword">)</span><span class="keyword">;</span> loop <span class="keyword">(</span>xs<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  <span class="keyword">$effmask_all</span> <span class="keyword">(</span>loop <span class="keyword">(</span>xs<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list_foreach_cloref]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">x</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_foreach_funenv
  <span class="staexp"><span class="keyword">{</span>v<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>vt<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>fe<span class="keyword">}</span></span>
  <span class="keyword">(</span><span class="prfexp">pfv</span> <span class="keyword">|</span> xs<span class="keyword">,</span> f<span class="keyword">,</span> env<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> lemma_list_param<span class="keyword">(</span>xs<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
loop<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>nat<span class="keyword">}</span></span> <span class="keyword">.&lt;</span><span class="staexp">n</span><span class="keyword">&gt;.</span>
<span class="keyword">(</span>
  <span class="prfexp">pfv<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">v</span></span>
<span class="keyword">|</span> xs<span class="keyword">:</span> <span class="staexp">list</span> <span class="keyword">(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">,</span> f<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp"><span class="keyword">!</span></span><span class="staexp">v</span> <span class="keyword">|</span> <span class="staexp">x</span><span class="keyword">,</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">vt</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp"><span class="keyword">fun</span></span><span class="keyword">,</span><span class="staexp">fe</span><span class="keyword">&gt;</span> <span class="staexp">void</span>
<span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">vt</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="staexp">fe</span><span class="keyword">&gt;</span> <span class="staexp">void</span> <span class="keyword">=</span>
<span class="keyword">(</span>
  <span class="keyword">case+</span> xs <span class="keyword">of</span>
  <span class="keyword">|</span> list_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">|</span> list_cons<span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> f <span class="keyword">(</span><span class="prfexp">pfv</span> <span class="keyword">|</span> x<span class="keyword">,</span> env<span class="keyword">)</span></span> <span class="keyword">in</span> loop <span class="keyword">(</span><span class="prfexp">pfv</span> <span class="keyword">|</span> xs<span class="keyword">,</span> f<span class="keyword">,</span> env<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [list_cons]</span>
<span class="keyword">)</span></span> <span class="comment">(* end of [loop] *)</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  loop <span class="keyword">(</span><span class="prfexp">pfv</span> <span class="keyword">|</span> xs<span class="keyword">,</span> f<span class="keyword">,</span> env<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list_foreach_funenv]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">x<span class="keyword">,</span>y</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_foreach2<span class="keyword">(</span>xs<span class="keyword">,</span> ys<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">var</span> env<span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">in</span> list_foreach2_env&lt;<span class="staexp">x</span><span class="keyword">,</span><span class="staexp">y</span><span class="keyword">&gt;&lt;</span><span class="staexp">void</span><span class="keyword">&gt;</span> <span class="keyword">(</span>xs<span class="keyword">,</span> ys<span class="keyword">,</span> env<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list_foreach2]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">x<span class="keyword">,</span>y</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">env</span><span class="keyword">}</span>
list_foreach2_env
  <span class="keyword">(</span>xs<span class="keyword">,</span> ys<span class="keyword">,</span> env<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> lemma_list_param<span class="keyword">(</span>xs<span class="keyword">)</span></span>
<span class="prfexp"><span class="keyword">prval</span><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> lemma_list_param<span class="keyword">(</span>ys<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> loop
  <span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">:</span>nat<span class="keyword">}</span></span> <span class="keyword">.&lt;</span><span class="staexp">m</span><span class="keyword">&gt;.</span> <span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp">list</span> <span class="keyword">(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">)</span><span class="keyword">,</span> ys<span class="keyword">:</span> <span class="staexp">list</span> <span class="keyword">(</span><span class="staexp">y</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">env</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">case+</span> xs <span class="keyword">of</span>
<span class="keyword">|</span> list_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">|</span> list_cons<span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span>
  <span class="keyword">case+</span> ys <span class="keyword">of</span>
  <span class="keyword">|</span> list_cons <span class="keyword">(</span>y<span class="keyword">,</span> ys<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="dynexp"><span class="keyword">val</span> test <span class="keyword">=</span>
        list_foreach2$cont&lt;<span class="staexp">x</span><span class="keyword">,</span><span class="staexp">y</span><span class="keyword">&gt;&lt;</span><span class="staexp">env</span><span class="keyword">&gt;</span> <span class="keyword">(</span>x<span class="keyword">,</span> y<span class="keyword">,</span> env<span class="keyword">)</span></span>
      <span class="comment">// end of [val]</span>
    <span class="keyword">in</span>
      <span class="keyword">if</span> test <span class="keyword">then</span> <span class="keyword">let</span>
        <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> list_foreach2$fwork&lt;<span class="staexp">x</span><span class="keyword">,</span><span class="staexp">y</span><span class="keyword">&gt;&lt;</span><span class="staexp">env</span><span class="keyword">&gt;</span> <span class="keyword">(</span>x<span class="keyword">,</span> y<span class="keyword">,</span> env<span class="keyword">)</span></span>
      <span class="keyword">in</span>
        loop <span class="keyword">(</span>xs<span class="keyword">,</span> ys<span class="keyword">,</span> env<span class="keyword">)</span>
      <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="comment">// end of [if]</span>
    <span class="keyword">end</span> <span class="comment">// end of [list_cons]</span>
  <span class="keyword">|</span> list_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">)</span> <span class="comment">(* end of [list_cons] *)</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [loop]</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  loop <span class="keyword">(</span>xs<span class="keyword">,</span> ys<span class="keyword">,</span> env<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list_foreach2_env]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">x<span class="keyword">,</span>y</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">env</span><span class="keyword">}</span>
list_foreach2$cont <span class="keyword">(</span>x<span class="keyword">,</span> y<span class="keyword">,</span> env<span class="keyword">)</span> <span class="keyword">=</span> true</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">x</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_iforeach<span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">var</span> env<span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">in</span> list_iforeach_env&lt;<span class="staexp">x</span><span class="keyword">&gt;&lt;</span><span class="staexp">void</span><span class="keyword">&gt;</span> <span class="keyword">(</span>xs<span class="keyword">,</span> env<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list_iforeach]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">x</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">env</span><span class="keyword">}</span>
list_iforeach_env
  <span class="keyword">(</span>xs<span class="keyword">,</span> env<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> lemma_list_param<span class="keyword">(</span>xs<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
loop
<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>nat<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>i<span class="keyword">:</span>nat<span class="keyword">}</span></span> <span class="keyword">.&lt;</span><span class="staexp">n</span><span class="keyword">&gt;.</span>
<span class="keyword">(</span>
  i<span class="keyword">:</span> <span class="staexp">int</span> <span class="staexp">i</span><span class="keyword">,</span> xs<span class="keyword">:</span> <span class="staexp">list</span> <span class="keyword">(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">env</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">intBtwe</span><span class="keyword">(</span><span class="staexp">i</span><span class="keyword">,</span><span class="staexp">n</span><span class="staexp">+</span><span class="staexp">i</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span>
<span class="comment">//</span>
<span class="keyword">case+</span> xs <span class="keyword">of</span>
<span class="keyword">|</span> list_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span>i<span class="keyword">)</span>
<span class="keyword">|</span> list_cons<span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
    <span class="dynexp"><span class="keyword">val</span> test <span class="keyword">=</span>
      list_iforeach$cont&lt;<span class="staexp">x</span><span class="keyword">&gt;&lt;</span><span class="staexp">env</span><span class="keyword">&gt;</span> <span class="keyword">(</span>i<span class="keyword">,</span> x<span class="keyword">,</span> env<span class="keyword">)</span></span>
    <span class="comment">// end of [test]</span>
  <span class="keyword">in</span>
    <span class="keyword">if</span> test <span class="keyword">then</span> <span class="keyword">let</span>
      <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> list_iforeach$fwork&lt;<span class="staexp">x</span><span class="keyword">&gt;&lt;</span><span class="staexp">env</span><span class="keyword">&gt;</span> <span class="keyword">(</span>i<span class="keyword">,</span> x<span class="keyword">,</span> env<span class="keyword">)</span></span>
    <span class="keyword">in</span>
      loop <span class="keyword">(</span>succ<span class="keyword">(</span>i<span class="keyword">)</span><span class="keyword">,</span> xs<span class="keyword">,</span> env<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">(</span>i<span class="keyword">)</span> <span class="comment">// end of [if]</span>
  <span class="keyword">end</span> <span class="comment">// end of [list_cons]</span>
<span class="comment">//</span>
<span class="keyword">)</span></span> <span class="comment">(* end of [loop] *)</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  loop <span class="keyword">(</span><span class="dynexp">0</span><span class="keyword">,</span> xs<span class="keyword">,</span> env<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list_iforeach_env]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">x</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">env</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_iforeach$cont<span class="keyword">(</span>i<span class="keyword">,</span> x<span class="keyword">,</span> env<span class="keyword">)</span> <span class="keyword">=</span> true</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">x</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_iforeach_cloref
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">}</span></span><span class="keyword">(</span>xs<span class="keyword">,</span> fwork<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> lemma_list_param<span class="keyword">(</span>xs<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
loop
<span class="staexp"><span class="keyword">{</span>
  i<span class="keyword">,</span>j<span class="keyword">:</span>nat
<span class="keyword">|</span> i+j == n
<span class="keyword">}</span></span> <span class="keyword">.&lt;</span><span class="staexp">n</span><span class="staexp">-</span><span class="staexp">i</span><span class="keyword">&gt;.</span>
<span class="keyword">(</span>
  i<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">(</span><span class="staexp">i</span><span class="keyword">)</span><span class="keyword">,</span> xs<span class="keyword">:</span> <span class="staexp">list</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">j</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span>
<span class="comment">//</span>
<span class="keyword">case+</span> xs <span class="keyword">of</span>
<span class="keyword">|</span> list_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">|</span> list_cons <span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span>fwork <span class="keyword">(</span>i<span class="keyword">,</span> x<span class="keyword">)</span><span class="keyword">;</span> loop <span class="keyword">(</span>i+<span class="dynexp">1</span><span class="keyword">,</span> xs<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  loop <span class="keyword">(</span><span class="dynexp">0</span><span class="keyword">,</span> xs<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list_iforeach_cloref]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">x</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_iforeach_funenv
  <span class="staexp"><span class="keyword">{</span>v<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>vt<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>n<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>fe<span class="keyword">}</span></span>
<span class="keyword">(</span>
  <span class="prfexp">pfv</span> <span class="keyword">|</span> xs<span class="keyword">,</span> fwork<span class="keyword">,</span> env
<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> lemma_list_param<span class="keyword">(</span>xs<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
loop
<span class="staexp"><span class="keyword">{</span> i<span class="keyword">:</span>nat
<span class="keyword">|</span> i &lt;= n
<span class="keyword">}</span></span> <span class="keyword">.&lt;</span><span class="staexp">n</span><span class="staexp">-</span><span class="staexp">i</span><span class="keyword">&gt;.</span>
<span class="keyword">(</span>
  <span class="prfexp">pfv<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">v</span></span>
<span class="keyword">|</span> i<span class="keyword">:</span> <span class="staexp">int</span> <span class="staexp">i</span>
<span class="keyword">,</span> xs<span class="keyword">:</span> <span class="staexp">list</span> <span class="keyword">(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">n</span><span class="staexp">-</span><span class="staexp">i</span><span class="keyword">)</span>
<span class="keyword">,</span> fwork<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp"><span class="keyword">!</span></span><span class="staexp">v</span> <span class="keyword">|</span> <span class="staexp">natLt</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">x</span><span class="keyword">,</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">vt</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp"><span class="keyword">fun</span></span><span class="keyword">,</span><span class="staexp">fe</span><span class="keyword">&gt;</span> <span class="staexp">void</span>
<span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">vt</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="staexp">fe</span><span class="keyword">&gt;</span> <span class="staexp">int</span> <span class="staexp">n</span> <span class="keyword">=</span> <span class="keyword">(</span>
<span class="comment">//</span>
<span class="keyword">case+</span> xs <span class="keyword">of</span>
<span class="keyword">|</span> list_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> i
<span class="keyword">|</span> list_cons<span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
    <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fwork <span class="keyword">(</span><span class="prfexp">pfv</span> <span class="keyword">|</span> i<span class="keyword">,</span> x<span class="keyword">,</span> env<span class="keyword">)</span></span> <span class="keyword">in</span> loop <span class="keyword">(</span><span class="prfexp">pfv</span> <span class="keyword">|</span> i+<span class="dynexp">1</span><span class="keyword">,</span> xs<span class="keyword">,</span> fwork<span class="keyword">,</span> env<span class="keyword">)</span>
  <span class="keyword">end</span> <span class="comment">// end of [list_cons]</span>
<span class="keyword">)</span></span> <span class="comment">(* end of [loop] *)</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  loop <span class="keyword">(</span><span class="prfexp">pfv</span> <span class="keyword">|</span> <span class="dynexp">0</span><span class="keyword">,</span> xs<span class="keyword">,</span> fwork<span class="keyword">,</span> env<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list_iforeach_funenv]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">x<span class="keyword">,</span>y</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_iforeach2
  <span class="keyword">(</span>xs<span class="keyword">,</span> ys<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">var</span> env<span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">in</span>
  list_iforeach2_env&lt;<span class="staexp">x</span><span class="keyword">,</span><span class="staexp">y</span><span class="keyword">&gt;&lt;</span><span class="staexp">void</span><span class="keyword">&gt;</span> <span class="keyword">(</span>xs<span class="keyword">,</span> ys<span class="keyword">,</span> env<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list_iforeach2]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">x<span class="keyword">,</span>y</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">env</span><span class="keyword">}</span>
list_iforeach2_env
  <span class="keyword">(</span>xs<span class="keyword">,</span> ys<span class="keyword">,</span> env<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> lemma_list_param<span class="keyword">(</span>xs<span class="keyword">)</span></span>
<span class="prfexp"><span class="keyword">prval</span><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> lemma_list_param<span class="keyword">(</span>ys<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> loop
  <span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">:</span>nat<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>i<span class="keyword">:</span>nat<span class="keyword">}</span></span> <span class="keyword">.&lt;</span><span class="staexp">m</span><span class="keyword">&gt;.</span>
<span class="keyword">(</span>
  i<span class="keyword">:</span> <span class="staexp">int</span> <span class="staexp">i</span><span class="keyword">,</span> xs<span class="keyword">:</span> <span class="staexp">list</span> <span class="keyword">(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">)</span><span class="keyword">,</span> ys<span class="keyword">:</span> <span class="staexp">list</span> <span class="keyword">(</span><span class="staexp">y</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">env</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">intBtwe</span><span class="keyword">(</span><span class="staexp">i</span><span class="keyword">,</span> <span class="staexp">min</span><span class="keyword">(</span><span class="staexp">m</span><span class="keyword">,</span><span class="staexp">n</span><span class="keyword">)</span><span class="staexp">+</span><span class="staexp">i</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">case+</span> xs <span class="keyword">of</span>
<span class="keyword">|</span> list_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> i <span class="comment">// the number of processed elements</span>
<span class="keyword">|</span> list_cons<span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span>
  <span class="keyword">case+</span> ys <span class="keyword">of</span>
  <span class="keyword">|</span> list_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span>i<span class="keyword">)</span>
  <span class="keyword">|</span> list_cons<span class="keyword">(</span>y<span class="keyword">,</span> ys<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="dynexp"><span class="keyword">val</span> test <span class="keyword">=</span>
        list_iforeach2$cont&lt;<span class="staexp">x</span><span class="keyword">,</span><span class="staexp">y</span><span class="keyword">&gt;&lt;</span><span class="staexp">env</span><span class="keyword">&gt;</span> <span class="keyword">(</span>i<span class="keyword">,</span> x<span class="keyword">,</span> y<span class="keyword">,</span> env<span class="keyword">)</span></span>
      <span class="comment">// end of [val]</span>
    <span class="keyword">in</span>
      <span class="keyword">if</span> test
        <span class="keyword">then</span> <span class="keyword">let</span>
          <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span> <span class="keyword">=</span>
            list_iforeach2$fwork&lt;<span class="staexp">x</span><span class="keyword">,</span><span class="staexp">y</span><span class="keyword">&gt;&lt;</span><span class="staexp">env</span><span class="keyword">&gt;</span> <span class="keyword">(</span>i<span class="keyword">,</span> x<span class="keyword">,</span> y<span class="keyword">,</span> env<span class="keyword">)</span></span>
          <span class="comment">// end of [val]</span>
        <span class="keyword">in</span>
          loop<span class="keyword">(</span>succ<span class="keyword">(</span>i<span class="keyword">)</span><span class="keyword">,</span> xs<span class="keyword">,</span> ys<span class="keyword">,</span> env<span class="keyword">)</span>
        <span class="keyword">end</span> <span class="comment">// end of [then]</span>
        <span class="keyword">else</span> <span class="keyword">(</span>i<span class="keyword">)</span> <span class="comment">// end of [else]</span>
    <span class="keyword">end</span> <span class="comment">// end of [list_cons]</span>
  <span class="keyword">)</span> <span class="comment">(* end of [list_cons] *)</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [loop]</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  loop <span class="keyword">(</span><span class="dynexp">0</span><span class="keyword">,</span> xs<span class="keyword">,</span> ys<span class="keyword">,</span> env<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list_iforeach2_env]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">x<span class="keyword">,</span>y</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">env</span><span class="keyword">}</span>
list_iforeach2$cont<span class="keyword">(</span>i<span class="keyword">,</span> x<span class="keyword">,</span> y<span class="keyword">,</span> env<span class="keyword">)</span> <span class="keyword">=</span> true</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">res</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">x</span><span class="keyword">}</span>
list_foldleft
  <span class="keyword">(</span>xs<span class="keyword">,</span> ini<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> lemma_list_param<span class="keyword">(</span>xs<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> loop
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>nat<span class="keyword">}</span></span> <span class="keyword">.&lt;</span><span class="staexp">n</span><span class="keyword">&gt;.</span>
<span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp">list</span> <span class="keyword">(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> acc<span class="keyword">:</span> <span class="staexp">res</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">res</span> <span class="keyword">=</span>
  <span class="keyword">case+</span> xs <span class="keyword">of</span>
  <span class="keyword">|</span> list_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> acc
  <span class="keyword">|</span> list_cons <span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="dynexp"><span class="keyword">val</span> acc <span class="keyword">=</span>
        list_foldleft$fopr&lt;<span class="staexp">res</span><span class="keyword">&gt;&lt;</span><span class="staexp">x</span><span class="keyword">&gt;</span> <span class="keyword">(</span>acc<span class="keyword">,</span> x<span class="keyword">)</span></span>
      <span class="comment">// end of [val]</span>
    <span class="keyword">in</span>
      loop <span class="keyword">(</span>xs<span class="keyword">,</span> acc<span class="keyword">)</span>
    <span class="keyword">end</span></span> <span class="comment">// end of [list_cons]</span>
<span class="comment">// end of [loop]</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  loop <span class="keyword">(</span>xs<span class="keyword">,</span> ini<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list_foldleft]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">x</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">res</span><span class="keyword">}</span>
list_foldright
  <span class="keyword">(</span>xs<span class="keyword">,</span> snk<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> lemma_list_param<span class="keyword">(</span>xs<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> aux
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>nat<span class="keyword">}</span></span> <span class="keyword">.&lt;</span><span class="staexp">n</span><span class="keyword">&gt;.</span>
<span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp">list</span> <span class="keyword">(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> acc<span class="keyword">:</span> <span class="staexp">res</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">res</span> <span class="keyword">=</span>
  <span class="keyword">case+</span> xs <span class="keyword">of</span>
  <span class="keyword">|</span> list_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> acc
  <span class="keyword">|</span> list_cons<span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span>
      list_foldright$fopr&lt;<span class="staexp">x</span><span class="keyword">&gt;&lt;</span><span class="staexp">res</span><span class="keyword">&gt;</span> <span class="keyword">(</span>x<span class="keyword">,</span> aux <span class="keyword">(</span>xs<span class="keyword">,</span> acc<span class="keyword">)</span><span class="keyword">)</span></span>
    <span class="comment">// end of [list_cons]</span>
<span class="comment">// end of [aux]</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  aux <span class="keyword">(</span>xs<span class="keyword">,</span> snk<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list_foldright]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_mergesort$cmp
  <span class="keyword">(</span>x1<span class="keyword">,</span> x2<span class="keyword">)</span> <span class="keyword">=</span> gcompare_val_val&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>x1<span class="keyword">,</span> x2<span class="keyword">)</span></span>
<span class="comment">// end of [list_mergesort$cmp]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_mergesort
  <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> xs <span class="keyword">=</span> list_copy&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>xs<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
list_vt_mergesort$cmp&lt;<span class="staexp">a</span><span class="keyword">&gt;</span>
  <span class="keyword">(</span>x1<span class="keyword">,</span> x2<span class="keyword">)</span> <span class="keyword">=</span> list_mergesort$cmp&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>x1<span class="keyword">,</span> x2<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  list_vt_mergesort&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>xs<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list_mergesort]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_mergesort_fun
  <span class="keyword">(</span>xs<span class="keyword">,</span> cmp<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a2</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_mergesort$cmp
  <span class="keyword">(</span>x1<span class="keyword">,</span> x2<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="keyword">typedef</span> <span class="staexp">cmp2 <span class="keyword">=</span> <span class="staexp">cmpval</span><span class="keyword">(</span><span class="staexp">a2</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> cmp2 <span class="keyword">=</span> $UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>cmp2<span class="keyword">}</span></span><span class="keyword">(</span>cmp<span class="keyword">)</span></span> <span class="keyword">in</span> cmp2 <span class="keyword">(</span>x1<span class="keyword">,</span> x2<span class="keyword">)</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list_mergesort$cmp]</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  list_mergesort&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>xs<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list_mergesort_fun]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_mergesort_cloref
  <span class="keyword">(</span>xs<span class="keyword">,</span> cmp<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a2</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_mergesort$cmp
  <span class="keyword">(</span>x1<span class="keyword">,</span> x2<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="keyword">typedef</span> <span class="staexp">cmp2 <span class="keyword">=</span> <span class="keyword">(</span><span class="staexp">a2</span><span class="keyword">,</span> <span class="staexp">a2</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloref</span><span class="keyword">&gt;</span> <span class="staexp">int</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> cmp2 <span class="keyword">=</span> $UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>cmp2<span class="keyword">}</span></span><span class="keyword">(</span>cmp<span class="keyword">)</span></span> <span class="keyword">in</span> cmp2 <span class="keyword">(</span>x1<span class="keyword">,</span> x2<span class="keyword">)</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list_mergesort$cmp]</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  list_mergesort&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>xs<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list_mergesort_cloref]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_quicksort$cmp
  <span class="keyword">(</span>x1<span class="keyword">,</span> x2<span class="keyword">)</span> <span class="keyword">=</span> gcompare_val_val&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>x1<span class="keyword">,</span> x2<span class="keyword">)</span></span>
<span class="comment">// end of [list_quicksort$cmp]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_quicksort
  <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> xs <span class="keyword">=</span> list_copy&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>xs<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
list_vt_quicksort$cmp&lt;<span class="staexp">a</span><span class="keyword">&gt;</span>
  <span class="keyword">(</span>x1<span class="keyword">,</span> x2<span class="keyword">)</span> <span class="keyword">=</span> list_quicksort$cmp&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>x1<span class="keyword">,</span> x2<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  list_vt_quicksort&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>xs<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list_quicksort]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_quicksort_fun
  <span class="keyword">(</span>xs<span class="keyword">,</span> cmp<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a2</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_quicksort$cmp
  <span class="keyword">(</span>x1<span class="keyword">,</span> x2<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> cmp <span class="keyword">=</span> $UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>cmpval<span class="keyword">(</span>a2<span class="keyword">)</span><span class="keyword">}</span></span><span class="keyword">(</span>cmp<span class="keyword">)</span></span> <span class="keyword">in</span> cmp <span class="keyword">(</span>x1<span class="keyword">,</span> x2<span class="keyword">)</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list_quicksort$cmp]</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  list_quicksort&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>xs<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list_quicksort_fun]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
streamize_list_elt
  <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
auxmain
<span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp">List</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="dynexp"><span class="keyword">$ldelay</span>
<span class="keyword">(</span>
  <span class="keyword">case+</span> xs <span class="keyword">of</span>
  <span class="keyword">|</span> list_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> stream_vt_nil<span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">|</span> list_cons<span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span> stream_vt_cons<span class="keyword">(</span>x<span class="keyword">,</span> auxmain<span class="keyword">(</span>xs<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> stream_vt_con<span class="keyword">(</span>a<span class="keyword">)</span></span></span> <span class="comment">// $ldelay</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  <span class="keyword">$effmask_all</span><span class="keyword">(</span>auxmain<span class="keyword">(</span>xs<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [streamize_list_elt]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
streamize_list_choose2
  <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="keyword">typedef</span> <span class="staexp">a2 <span class="keyword">=</span> <span class="keyword">@(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
auxmain
<span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp">List</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">a2</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="dynexp"><span class="keyword">$ldelay</span>
<span class="keyword">(</span>
  <span class="keyword">case+</span> xs <span class="keyword">of</span>
  <span class="keyword">|</span> list_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> stream_vt_nil<span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">|</span> list_cons<span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">!</span><span class="keyword">(</span>auxmain2<span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> stream_vt_con<span class="keyword">(</span><span class="keyword">@(</span>a<span class="keyword">,</span> a<span class="keyword">)</span><span class="keyword">)</span></span> <span class="comment">// $ldelay</span>
<span class="comment">//</span>
<span class="keyword">and</span>
auxmain2
<span class="keyword">(</span>
  x0<span class="keyword">:</span> <span class="staexp">a</span><span class="keyword">,</span> xs<span class="keyword">:</span> <span class="staexp">List</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">a2</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="dynexp"><span class="keyword">$ldelay</span>
<span class="keyword">(</span>
  <span class="keyword">case+</span> xs <span class="keyword">of</span>
  <span class="keyword">|</span> list_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">!</span><span class="keyword">(</span>auxmain<span class="keyword">(</span>xs<span class="keyword">)</span><span class="keyword">)</span>
  <span class="keyword">|</span> list_cons<span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span> stream_vt_cons<span class="keyword">(</span><span class="keyword">(</span>x0<span class="keyword">,</span> x<span class="keyword">)</span><span class="keyword">,</span> auxmain2<span class="keyword">(</span>x0<span class="keyword">,</span> xs<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> stream_vt_con<span class="keyword">(</span><span class="keyword">@(</span>a<span class="keyword">,</span> a<span class="keyword">)</span><span class="keyword">)</span></span></span> <span class="comment">// $ldelay</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  <span class="keyword">$effmask_all</span><span class="keyword">(</span>auxmain<span class="keyword">(</span>xs<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [streamize_list_choose2]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a<span class="keyword">,</span>b</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
streamize_list_zip
  <span class="keyword">(</span>xs<span class="keyword">,</span> ys<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
auxmain
<span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp">List</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span>
<span class="keyword">,</span> ys<span class="keyword">:</span> <span class="staexp">List</span><span class="keyword">(</span><span class="staexp">b</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="keyword">@(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">b</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="dynexp"><span class="keyword">$ldelay</span>
<span class="keyword">(</span>
<span class="keyword">case+</span> xs <span class="keyword">of</span>
<span class="keyword">|</span> list_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span>
    stream_vt_nil<span class="keyword">(</span><span class="keyword">)</span>
  <span class="comment">// end of [list_nil]</span>
<span class="keyword">|</span> list_cons<span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span>
  <span class="keyword">(</span>
    <span class="keyword">case+</span> ys <span class="keyword">of</span>
    <span class="keyword">|</span> list_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> stream_vt_nil<span class="keyword">(</span><span class="keyword">)</span>
    <span class="keyword">|</span> list_cons<span class="keyword">(</span>y<span class="keyword">,</span> ys<span class="keyword">)</span> <span class="keyword">=&gt;</span> stream_vt_cons<span class="keyword">(</span><span class="keyword">(</span>x<span class="keyword">,</span> y<span class="keyword">)</span><span class="keyword">,</span> auxmain<span class="keyword">(</span>xs<span class="keyword">,</span> ys<span class="keyword">)</span><span class="keyword">)</span>
  <span class="keyword">)</span> <span class="comment">(* end of [list_cons] *)</span>
<span class="keyword">)</span> <span class="keyword">:</span> stream_vt_con<span class="keyword">(</span><span class="keyword">@(</span>a<span class="keyword">,</span> b<span class="keyword">)</span><span class="keyword">)</span></span></span> <span class="comment">// auxmain</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  <span class="keyword">$effmask_all</span><span class="keyword">(</span>auxmain<span class="keyword">(</span>xs<span class="keyword">,</span> ys<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [streamize_list_zip]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a<span class="keyword">,</span>b</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
streamize_list_cross
  <span class="keyword">(</span>xs<span class="keyword">,</span> ys<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
auxone
<span class="keyword">(</span>
  x0<span class="keyword">:</span> <span class="staexp">a</span>
<span class="keyword">,</span> ys<span class="keyword">:</span> <span class="staexp">List</span><span class="keyword">(</span><span class="staexp">b</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="keyword">@(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">b</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="dynexp"><span class="keyword">$ldelay</span>
<span class="keyword">(</span>
<span class="keyword">case+</span> ys <span class="keyword">of</span>
<span class="keyword">|</span> list_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span>
    stream_vt_nil<span class="keyword">(</span><span class="keyword">)</span>
  <span class="comment">// end of [list_nil]</span>
<span class="keyword">|</span> list_cons<span class="keyword">(</span>y<span class="keyword">,</span> ys<span class="keyword">)</span> <span class="keyword">=&gt;</span>
    stream_vt_cons<span class="keyword">(</span><span class="keyword">(</span>x0<span class="keyword">,</span> y<span class="keyword">)</span><span class="keyword">,</span> auxone<span class="keyword">(</span>x0<span class="keyword">,</span> ys<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> stream_vt_con<span class="keyword">(</span><span class="keyword">@(</span>a<span class="keyword">,</span> b<span class="keyword">)</span><span class="keyword">)</span></span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
auxmain
<span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp">List</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span>
<span class="keyword">,</span> ys<span class="keyword">:</span> <span class="staexp">List</span><span class="keyword">(</span><span class="staexp">b</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="keyword">@(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">b</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="dynexp"><span class="keyword">$ldelay</span>
<span class="keyword">(</span>
<span class="keyword">case+</span> xs <span class="keyword">of</span>
<span class="keyword">|</span> list_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span>
    stream_vt_nil<span class="keyword">(</span><span class="keyword">)</span>
  <span class="comment">// end of [list_nil]</span>
<span class="keyword">|</span> list_cons<span class="keyword">(</span>x0<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span>
    <span class="keyword">!</span><span class="keyword">(</span>stream_vt_append<span class="keyword">(</span>auxone<span class="keyword">(</span>x0<span class="keyword">,</span> ys<span class="keyword">)</span><span class="keyword">,</span> auxmain<span class="keyword">(</span>xs<span class="keyword">,</span> ys<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> stream_vt_con<span class="keyword">(</span><span class="keyword">@(</span>a<span class="keyword">,</span> b<span class="keyword">)</span><span class="keyword">)</span></span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  <span class="keyword">$effmask_all</span><span class="keyword">(</span>auxmain<span class="keyword">(</span>xs<span class="keyword">,</span> ys<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [streamize_list_cross]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* end of [list.dats] *)</span>
</pre>
<pre class="patsyntax">
<span class="comment">(***********************************************************************)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(*                         Applied Type System                         *)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(***********************************************************************)</span>

<span class="comment">(*
** ATS/Postiats - Unleashing the Potential of Types!
** Copyright (C) 2010-2015 Hongwei Xi, ATS Trustful Software, Inc.
** All rights reserved
**
** ATS is free software;  you can  redistribute it and/or modify it under
** the terms of  the GNU GENERAL PUBLIC LICENSE (GPL) as published by the
** Free Software Foundation; either version 3, or (at  your  option)  any
** later version.
**
** ATS is distributed in the hope that it will be useful, but WITHOUT ANY
** WARRANTY; without  even  the  implied  warranty  of MERCHANTABILITY or
** FITNESS FOR A PARTICULAR PURPOSE.  See the  GNU General Public License
** for more details.
**
** You  should  have  received  a  copy of the GNU General Public License
** along  with  ATS;  see the  file COPYING.  If not, please write to the
** Free Software Foundation,  51 Franklin Street, Fifth Floor, Boston, MA
** 02110-1301, USA.
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
** Source:
** $PATSHOME/prelude/DATS/CODEGEN/list_vt.atxt
** Time of generation: Sat Oct 22 23:15:09 2016
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* Author: Hongwei Xi *)</span>
<span class="comment">(* Authoremail: hwxi AT cs DOT bu DOT edu *)</span>
<span class="comment">(* Start time: Feburary, 2012 *)</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="keyword">staload</span>
UN <span class="keyword">=</span> "prelude/SATS/unsafe.sats"
<span class="keyword">staload</span>
_<span class="comment">(*anon*)</span> <span class="keyword">=</span> "prelude/DATS/unsafe.dats"
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="staexp"><span class="keyword">absvtype</span>
List0_vt_<span class="keyword">(</span>a<span class="keyword">:</span><span class="keyword">vt@ype+</span><span class="keyword">)</span> <span class="keyword">=</span> List0_vt<span class="keyword">(</span>a<span class="keyword">)</span></span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_vt_make_sing <span class="keyword">(</span>x<span class="keyword">)</span> <span class="keyword">=</span>
  list_vt_cons<span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="keyword">(</span>x<span class="keyword">,</span> list_vt_nil<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_vt_make_pair <span class="keyword">(</span>x1<span class="keyword">,</span> x2<span class="keyword">)</span> <span class="keyword">=</span>
  list_vt_cons<span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="keyword">(</span>x1<span class="keyword">,</span> list_vt_cons<span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="keyword">(</span>x2<span class="keyword">,</span> list_vt_nil<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
print_list_vt <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span> fprint_list_vt&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>stdout_ref<span class="keyword">,</span> xs<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
prerr_list_vt <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span> fprint_list_vt&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>stderr_ref<span class="keyword">,</span> xs<span class="keyword">)</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
fprint_list_vt$sep <span class="keyword">(</span>out<span class="keyword">)</span> <span class="keyword">=</span> fprint_list$sep&lt;<span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">)</span></span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
fprint_list_vt
  <span class="keyword">(</span>out<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span><span class="keyword">(</span><span class="staexp">env</span><span class="keyword">)</span>
list_vt_iforeach$fwork&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">env</span><span class="keyword">&gt;</span>
  <span class="keyword">(</span>i<span class="keyword">,</span> x<span class="keyword">,</span> env<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span>
    <span class="keyword">if</span> i <span class="keyword">&gt;</span> <span class="dynexp">0</span> <span class="keyword">then</span> fprint_list_vt$sep&lt;<span class="comment">(*none*)</span><span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">)</span></span>
  <span class="comment">// end of [val]</span>
<span class="keyword">in</span>
  fprint_ref&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">,</span> x<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list_iforeach$fwork]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> _<span class="comment">(*n*)</span> <span class="keyword">=</span> list_vt_iforeach&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>xs<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">in</span>
  <span class="comment">// nothing</span>
<span class="keyword">end</span></span></span> <span class="comment">// end of [fprint_list_vt]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
fprint_list_vt_sep
  <span class="keyword">(</span>out<span class="keyword">,</span> xs<span class="keyword">,</span> sep<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
fprint_list_vt$sep&lt;<span class="comment">(*none*)</span><span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">)</span> <span class="keyword">=</span> fprint_string <span class="keyword">(</span>out<span class="keyword">,</span> sep<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  fprint_list_vt&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">,</span> xs<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [fprint_list_vt_sep]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">x</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_vt_is_nil <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span>
  <span class="keyword">case+</span> xs <span class="keyword">of</span> list_vt_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> true <span class="keyword">|</span> _ <span class="keyword">=&gt;&gt;</span> false</span>
<span class="comment">// end of [list_vt_is_nil]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">x</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_vt_is_cons <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span>
  <span class="keyword">case+</span> xs <span class="keyword">of</span> list_vt_cons _ <span class="keyword">=&gt;</span> true <span class="keyword">|</span> _ <span class="keyword">=&gt;&gt;</span> false</span>
<span class="comment">// end of [list_vt_is_cons]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">x</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_vt_is_sing <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span>
  <span class="keyword">case+</span> xs <span class="keyword">of</span> list_vt_sing <span class="keyword">(</span>x<span class="keyword">)</span> <span class="keyword">=&gt;</span> true <span class="keyword">|</span> _ <span class="keyword">=&gt;&gt;</span> false</span>
<span class="comment">// end of [list_vt_is_sing]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">x</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_vt_is_pair <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span>
  <span class="keyword">case+</span> xs <span class="keyword">of</span> list_vt_pair <span class="keyword">(</span>x1<span class="keyword">,</span> x2<span class="keyword">)</span> <span class="keyword">=&gt;</span> true <span class="keyword">|</span> _ <span class="keyword">=&gt;&gt;</span> false</span>
<span class="comment">// end of [list_vt_is_pair]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
list_vt_unnil <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val+</span><span class="keyword">~</span>list_vt_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> xs</span> <span class="dynexp"><span class="keyword">in</span> <span class="comment">(*nothing*)</span>
<span class="keyword">end</span></span></span> <span class="comment">// end of [list_vt_unnil]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_vt_uncons <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val+</span><span class="keyword">~</span>list_vt_cons <span class="keyword">(</span>x<span class="keyword">,</span> xs1<span class="keyword">)</span> <span class="keyword">=</span> xs</span> <span class="keyword">in</span> xs := xs1<span class="keyword">;</span> x
<span class="keyword">end</span></span> <span class="comment">// end of [list_vt_uncons]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_vt_length <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> loop
  <span class="staexp"><span class="keyword">{</span>i<span class="keyword">,</span>j<span class="keyword">:</span>nat<span class="keyword">}</span></span> <span class="keyword">.&lt;</span><span class="staexp">i</span><span class="keyword">&gt;.</span>
<span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">list_vt</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span><span class="keyword">,</span> j<span class="keyword">:</span> <span class="staexp">int</span> <span class="staexp">j</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">int</span> <span class="keyword">(</span><span class="staexp">i</span><span class="staexp">+</span><span class="staexp">j</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">case+</span> xs <span class="keyword">of</span>
<span class="keyword">|</span> list_vt_cons
    <span class="keyword">(</span>_<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span> loop <span class="keyword">(</span>xs<span class="keyword">,</span> j + <span class="dynexp">1</span><span class="keyword">)</span>
<span class="keyword">|</span> list_vt_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> j
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [loop]</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> lemma_list_vt_param <span class="keyword">(</span>xs<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  loop <span class="keyword">(</span>xs<span class="keyword">,</span> <span class="dynexp">0</span><span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list_vt_length]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">x</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_vt_copy <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">x2</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_vt_copylin$copy
  <span class="keyword">(</span>x<span class="keyword">)</span> <span class="keyword">=</span> $UN<span class="keyword">.</span>ptr0_get&lt;<span class="staexp">x2</span><span class="keyword">&gt;</span><span class="keyword">(</span><span class="dynexp"><span class="keyword">addr@</span></span>x<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  <span class="keyword">$effmask_all</span> <span class="keyword">(</span>list_vt_copylin&lt;<span class="staexp">x</span><span class="keyword">&gt;</span> <span class="keyword">(</span>xs<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list_vt_copy]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">x</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_vt_copylin
  <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> lemma_list_vt_param <span class="keyword">(</span>xs<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> loop
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>nat<span class="keyword">}</span></span> <span class="keyword">.&lt;</span><span class="staexp">n</span><span class="keyword">&gt;.</span> <span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">list_vt</span> <span class="keyword">(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> res<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">ptr</span><span class="staexp">?</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">list_vt</span> <span class="keyword">(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">case+</span> xs <span class="keyword">of</span>
<span class="keyword">|</span> <span class="keyword">@</span>list_vt_cons
    <span class="keyword">(</span>x<span class="keyword">,</span> xs1<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
    <span class="dynexp"><span class="keyword">val</span> x <span class="keyword">=</span>
      list_vt_copylin$copy&lt;<span class="staexp">x</span><span class="keyword">&gt;</span> <span class="keyword">(</span>x<span class="keyword">)</span></span>
    <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span>
      res := list_vt_cons<span class="staexp"><span class="keyword">{</span>x<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>0<span class="keyword">}</span></span><span class="keyword">(</span>x<span class="keyword">,</span> _<span class="keyword">)</span></span>
    <span class="dynexp"><span class="keyword">val+</span>list_vt_cons <span class="keyword">(</span>_<span class="keyword">,</span> res1<span class="keyword">)</span> <span class="keyword">=</span> res</span>
    <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> loop <span class="keyword">(</span>xs1<span class="keyword">,</span> res1<span class="keyword">)</span></span>
    <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">fold@</span> <span class="keyword">(</span>xs<span class="keyword">)</span></span>
    <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">fold@</span> <span class="keyword">(</span>res<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">in</span>
    <span class="comment">// nothing</span>
  <span class="keyword">end</span></span> <span class="comment">// end of [list_vt_cons]</span>
<span class="keyword">|</span> list_vt_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> res := list_vt_nil <span class="keyword">(</span><span class="keyword">)</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [loop]</span>
<span class="comment">//</span>
<span class="keyword">var</span> res<span class="keyword">:</span> <span class="staexp">ptr</span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span>
  <span class="keyword">$effmask_all</span><span class="keyword">(</span>loop <span class="keyword">(</span>xs<span class="keyword">,</span> res<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  res
<span class="keyword">end</span></span> <span class="comment">// end of [list_vt_copylin]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">x</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_vt_copylin_fun
  <span class="keyword">(</span>xs<span class="keyword">,</span> f<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">x2</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_vt_copylin$copy
  <span class="keyword">(</span>x<span class="keyword">)</span> <span class="keyword">=</span> x2 <span class="keyword">where</span>
<span class="keyword">{</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> f2 <span class="keyword">=</span>
  $UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span><span class="keyword">(</span>&amp;RD<span class="keyword">(</span>x2<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">-&gt;</span>x2<span class="keyword">}</span></span><span class="keyword">(</span>f<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> x2 <span class="keyword">=</span> <span class="keyword">$effmask_all</span><span class="keyword">(</span>f2<span class="keyword">(</span>x<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">}</span></span> <span class="comment">(* end of [copy] *)</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  list_vt_copylin&lt;<span class="staexp">x</span><span class="keyword">&gt;</span> <span class="keyword">(</span>xs<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list_vt_copylin_fun]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_vt_getref_at
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>i<span class="keyword">}</span></span> <span class="keyword">(</span>xs<span class="keyword">,</span> i<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> loop <span class="staexp"><span class="keyword">{</span>
  n<span class="keyword">,</span>i<span class="keyword">:</span>nat <span class="keyword">|</span> i &lt;= n
<span class="keyword">}</span></span> <span class="keyword">.&lt;</span><span class="staexp">i</span><span class="keyword">&gt;.</span> <span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">list_vt</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">int</span> <span class="staexp">i</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">Ptr1</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="keyword">in</span>
  <span class="keyword">if</span> i <span class="keyword">&gt;</span> <span class="dynexp">0</span> <span class="keyword">then</span> <span class="keyword">let</span>
    <span class="dynexp"><span class="keyword">val+</span><span class="keyword">@</span>list_vt_cons <span class="keyword">(</span>_<span class="keyword">,</span> xs1<span class="keyword">)</span> <span class="keyword">=</span> xs</span>
    <span class="dynexp"><span class="keyword">val</span> res <span class="keyword">=</span> loop<span class="staexp"><span class="keyword">{</span>n-1<span class="keyword">,</span>i-1<span class="keyword">}</span></span><span class="keyword">(</span>xs1<span class="keyword">,</span> pred<span class="keyword">(</span>i<span class="keyword">)</span><span class="keyword">)</span></span>
  <span class="keyword">in</span>
    <span class="keyword">fold@</span> <span class="keyword">(</span>xs<span class="keyword">)</span><span class="keyword">;</span> res
  <span class="keyword">end</span> <span class="keyword">else</span>
    $UN<span class="keyword">.</span>cast2Ptr1<span class="keyword">(</span><span class="dynexp"><span class="keyword">addr@</span></span><span class="keyword">(</span>xs<span class="keyword">)</span><span class="keyword">)</span>
  <span class="comment">// end of [if]</span>
<span class="keyword">end</span></span> <span class="comment">// end of [loop]</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  $UN<span class="keyword">.</span>ptr2cptr<span class="staexp"><span class="keyword">{</span>list_vt<span class="keyword">(</span>a<span class="keyword">,</span>n-i<span class="keyword">)</span><span class="keyword">}</span></span><span class="keyword">(</span>loop <span class="keyword">(</span>xs<span class="keyword">,</span> i<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list_vt_getref_at]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_vt_get_at
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">}</span></span> <span class="keyword">(</span>xs<span class="keyword">,</span> i<span class="keyword">)</span> <span class="keyword">=</span> x <span class="keyword">where</span>
<span class="keyword">{</span>
<span class="comment">//</span>
<span class="keyword">var</span> xs <span class="keyword">=</span> __ref <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">where</span>
<span class="keyword">{</span>
  <span class="keyword">extern</span>
  <span class="dynexp"><span class="keyword">castfn</span> __ref
    <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">list_vt</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">list_vt</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="keyword">}</span> <span class="comment">// end of [val]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> pi <span class="keyword">=</span> list_vt_getref_at <span class="keyword">(</span>xs<span class="keyword">,</span> i<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val+</span>list_cons <span class="keyword">(</span>x<span class="keyword">,</span> _<span class="keyword">)</span> <span class="keyword">=</span>
  $UN<span class="keyword">.</span>ptr1_get&lt;<span class="staexp">List1</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">&gt;</span> <span class="keyword">(</span>cptr2ptr<span class="keyword">(</span>pi<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> __unref <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">where</span>
<span class="keyword">{</span>
  <span class="keyword">extern</span> <span class="prfexp"><span class="keyword">praxi</span> __unref <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">list_vt</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="keyword">}</span></span> <span class="comment">// end of [prval]</span>
<span class="comment">//</span>
<span class="keyword">}</span></span> <span class="comment">// end of [list_vt_get_at]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_vt_set_at
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">}</span></span> <span class="keyword">(</span>xs<span class="keyword">,</span> i<span class="keyword">,</span> x0<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="keyword">var</span> xs <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">extern</span>
  <span class="dynexp"><span class="keyword">castfn</span> __ref
    <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">list_vt</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">list_vt</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
  <span class="comment">// end of [__ref]</span>
<span class="keyword">in</span>
  __ref <span class="keyword">(</span>xs<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [val]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> pi <span class="keyword">=</span> list_vt_getref_at <span class="keyword">(</span>xs<span class="keyword">,</span> i<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pf</span><span class="keyword">,</span> <span class="prfexp">fpf</span> <span class="keyword">|</span> pi<span class="keyword">)</span> <span class="keyword">=</span> $UN<span class="keyword">.</span>cptr_vtake <span class="keyword">(</span>pi<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val+</span><span class="keyword">@</span>list_vt_cons <span class="keyword">(</span>x1<span class="keyword">,</span> xs1<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">!</span>pi</span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> x1 := x0</span>
<span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">fold@</span> <span class="keyword">(</span><span class="keyword">!</span>pi<span class="keyword">)</span></span>
<span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fpf <span class="keyword">(</span>pf<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">extern</span> <span class="prfexp"><span class="keyword">praxi</span> __unref <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">list_vt</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="keyword">in</span>
  __unref <span class="keyword">(</span>xs<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [prval]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">in</span>
  <span class="comment">// nothing</span>
<span class="keyword">end</span></span></span> <span class="comment">// end of [list_vt_set_at]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_vt_exch_at
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">}</span></span> <span class="keyword">(</span>xs<span class="keyword">,</span> i<span class="keyword">,</span> x0<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="keyword">var</span> xs <span class="keyword">=</span> __ref <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">where</span>
<span class="keyword">{</span>
  <span class="keyword">extern</span>
  <span class="dynexp"><span class="keyword">castfn</span> __ref
    <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">list_vt</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">list_vt</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="keyword">}</span> <span class="comment">// end of [val]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> pi <span class="keyword">=</span> list_vt_getref_at <span class="keyword">(</span>xs<span class="keyword">,</span> i<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pf</span><span class="keyword">,</span> <span class="prfexp">fpf</span> <span class="keyword">|</span> pi<span class="keyword">)</span> <span class="keyword">=</span> $UN<span class="keyword">.</span>cptr_vtake <span class="keyword">(</span>pi<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val+</span><span class="keyword">@</span>list_vt_cons <span class="keyword">(</span>x1<span class="keyword">,</span> xs1<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">!</span>pi</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> t <span class="keyword">=</span> x1</span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> x1 := x0</span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> x0 := t</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">fold@</span> <span class="keyword">(</span><span class="keyword">!</span>pi<span class="keyword">)</span></span>
<span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fpf <span class="keyword">(</span>pf<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> __unref <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">where</span>
<span class="keyword">{</span>
  <span class="keyword">extern</span> <span class="prfexp"><span class="keyword">praxi</span> __unref <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">list_vt</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="keyword">}</span></span> <span class="comment">// end of [prval]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">in</span>
  <span class="comment">// nothing</span>
<span class="keyword">end</span></span></span> <span class="comment">// end of [list_vt_exch_at]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_vt_insert_at
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">}</span></span> <span class="keyword">(</span>xs<span class="keyword">,</span> i<span class="keyword">,</span> x<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> pi <span class="keyword">=</span> list_vt_getref_at <span class="keyword">(</span>xs<span class="keyword">,</span> i<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> xs_i <span class="keyword">=</span> $UN<span class="keyword">.</span>cptr_get <span class="keyword">(</span>pi<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> xs1_i <span class="keyword">=</span> list_vt_cons <span class="keyword">(</span>x<span class="keyword">,</span> xs_i<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span>
  $UN<span class="keyword">.</span>ptr1_set&lt;<span class="staexp">List1_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">&gt;</span> <span class="keyword">(</span>cptr2ptr<span class="keyword">(</span>pi<span class="keyword">)</span><span class="keyword">,</span> xs1_i<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> __assert <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">where</span>
<span class="keyword">{</span>
  <span class="keyword">extern</span>
  <span class="prfexp"><span class="keyword">praxi</span> __assert <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">list_vt</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">list_vt</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="staexp">+</span><span class="staexp">1</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="keyword">}</span></span> <span class="comment">// end of [prval]</span>
<span class="dynexp"><span class="keyword">in</span>
  <span class="comment">// nothing</span>
<span class="keyword">end</span></span></span> <span class="comment">// end of [list_vt_insert_at]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_vt_takeout_at
<span class="staexp"><span class="keyword">{</span>n<span class="keyword">}</span></span> <span class="keyword">(</span>xs<span class="keyword">,</span> i<span class="keyword">)</span> <span class="keyword">=</span> x1 <span class="keyword">where</span>
<span class="keyword">{</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> pi <span class="keyword">=</span> list_vt_getref_at <span class="keyword">(</span>xs<span class="keyword">,</span> i<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> xs_i <span class="keyword">=</span> $UN<span class="keyword">.</span>cptr_get <span class="keyword">(</span>pi<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val+</span><span class="keyword">~</span>list_vt_cons <span class="keyword">(</span>x1<span class="keyword">,</span> xs1_i<span class="keyword">)</span> <span class="keyword">=</span> xs_i</span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span>
  $UN<span class="keyword">.</span>ptr1_set&lt;<span class="staexp">List0_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">&gt;</span> <span class="keyword">(</span>cptr2ptr<span class="keyword">(</span>pi<span class="keyword">)</span><span class="keyword">,</span> xs1_i<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span>
__assert <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">where</span>
<span class="keyword">{</span>
  <span class="keyword">extern</span>
  <span class="prfexp"><span class="keyword">praxi</span> __assert <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">list_vt</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">list_vt</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="staexp">-</span><span class="staexp">1</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="keyword">}</span></span> <span class="comment">(* end of [prval] *)</span>
<span class="comment">//</span>
<span class="keyword">}</span></span> <span class="comment">// end of [list_vt_takeout_at]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_vt_copy <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span>
  list_copy&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>$UN<span class="keyword">.</span>list_vt2t<span class="keyword">(</span>xs<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_vt_free <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">(</span><span class="staexp">a2<span class="keyword">:</span>t0p</span><span class="keyword">)</span>
list_vt_freelin$clear&lt;<span class="staexp">a2</span><span class="keyword">&gt;</span>
  <span class="keyword">(</span>x<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> topize <span class="keyword">(</span>x<span class="keyword">)</span></span> <span class="dynexp"><span class="keyword">in</span> <span class="comment">(*void*)</span>
<span class="keyword">end</span></span></span> <span class="comment">// end of [list_vt_freelin$clear]</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  list_vt_freelin&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>xs<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list_vt_free]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_vt_freelin$clear <span class="keyword">(</span>x<span class="keyword">)</span> <span class="keyword">=</span> gclear_ref <span class="keyword">(</span>x<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_vt_freelin <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> lemma_list_vt_param <span class="keyword">(</span>xs<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> loop
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>nat<span class="keyword">}</span></span> <span class="keyword">.&lt;</span><span class="staexp">n</span><span class="keyword">&gt;.</span> <span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp">list_vt</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span> <span class="keyword">=</span>
<span class="keyword">(</span>
  <span class="keyword">case+</span> xs <span class="keyword">of</span>
  <span class="keyword">|</span> <span class="keyword">@</span>list_vt_cons
      <span class="keyword">(</span>x<span class="keyword">,</span> xs1<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span>
        list_vt_freelin$clear&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>x<span class="keyword">)</span></span>
      <span class="dynexp"><span class="keyword">val</span> xs1 <span class="keyword">=</span> xs1</span>
      <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">free@</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>0<span class="keyword">}</span></span><span class="keyword">(</span>xs<span class="keyword">)</span></span>
    <span class="keyword">in</span>
      loop <span class="keyword">(</span>xs1<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [list_vt_cons]</span>
  <span class="keyword">|</span> <span class="keyword">~</span>list_vt_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">)</span></span> <span class="comment">(* end of [loop] *)</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  loop <span class="keyword">(</span>xs<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list_vt_freelin]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_vt_freelin_fun
  <span class="keyword">(</span>xs<span class="keyword">,</span> f<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a2</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_vt_freelin$clear
  <span class="keyword">(</span>x<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">where</span>
<span class="keyword">{</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> f2 <span class="keyword">=</span>
  $UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span><span class="keyword">(</span>&amp;a2 &gt;&gt; _?<span class="keyword">)</span> <span class="keyword">-&gt;</span> void<span class="keyword">}</span></span><span class="keyword">(</span>f<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">$effmask_all</span><span class="keyword">(</span>f2<span class="keyword">(</span>x<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">}</span></span> <span class="comment">(* end of [clear] *)</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  list_vt_freelin&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>xs<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list_vt_freelin_fun]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_vt_uninitize$clear <span class="keyword">(</span>x<span class="keyword">)</span> <span class="keyword">=</span> gclear_ref <span class="keyword">(</span>x<span class="keyword">)</span></span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_vt_uninitize
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">}</span></span> <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> lemma_list_vt_param <span class="keyword">(</span>xs<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> loop
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>nat<span class="keyword">}</span></span> <span class="keyword">.&lt;</span><span class="staexp">n</span><span class="keyword">&gt;.</span> <span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">list_vt</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">list_vt</span> <span class="keyword">(</span><span class="staexp">a</span><span class="staexp">?</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span> <span class="keyword">=</span>
<span class="keyword">(</span>
  <span class="keyword">case+</span> xs <span class="keyword">of</span>
  <span class="keyword">|</span> <span class="keyword">@</span>list_vt_cons
      <span class="keyword">(</span>x<span class="keyword">,</span> xs1<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span>
        list_vt_uninitize$clear <span class="keyword">(</span>x<span class="keyword">)</span></span>
      <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> loop <span class="keyword">(</span>xs1<span class="keyword">)</span></span>
      <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">fold@</span> <span class="staexp"><span class="keyword">{</span>a?<span class="keyword">}</span></span> <span class="keyword">(</span>xs<span class="keyword">)</span></span>
    <span class="dynexp"><span class="keyword">in</span>
      <span class="comment">// nothing</span>
    <span class="keyword">end</span></span> <span class="comment">// end of [list_vt_cons]</span>
  <span class="keyword">|</span> <span class="keyword">@</span>list_vt_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">fold@</span> <span class="staexp"><span class="keyword">{</span>a?<span class="keyword">}</span></span> <span class="keyword">(</span>xs<span class="keyword">)</span>
<span class="keyword">)</span></span> <span class="comment">(* end of [loop] *)</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  loop <span class="keyword">(</span>xs<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list_vt_uninitize]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_vt_append
  <span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">}</span></span> <span class="keyword">(</span>xs<span class="keyword">,</span> ys<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> lemma_list_vt_param <span class="keyword">(</span>xs<span class="keyword">)</span></span>
<span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> lemma_list_vt_param <span class="keyword">(</span>ys<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> loop
  <span class="staexp"><span class="keyword">{</span>m<span class="keyword">:</span>nat<span class="keyword">}</span></span> <span class="keyword">.&lt;</span><span class="staexp">m</span><span class="keyword">&gt;.</span>
<span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">list_vt</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">list_vt</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">m</span><span class="staexp">+</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> ys<span class="keyword">:</span> <span class="staexp">list_vt</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">case+</span> xs <span class="keyword">of</span>
<span class="keyword">|</span> <span class="keyword">@</span>list_vt_cons
    <span class="keyword">(</span>x<span class="keyword">,</span> xs1<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
    <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> loop <span class="keyword">(</span>xs1<span class="keyword">,</span> ys<span class="keyword">)</span></span><span class="keyword">;</span> <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">fold@</span> <span class="keyword">(</span>xs<span class="keyword">)</span></span> <span class="dynexp"><span class="keyword">in</span> <span class="comment">(*none*)</span>
  <span class="keyword">end</span></span> <span class="comment">// end of [list_vt_cons]</span>
<span class="keyword">|</span> <span class="keyword">~</span>list_vt_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span>xs := ys<span class="keyword">)</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">(* end of [loop] *)</span>
<span class="comment">//</span>
<span class="keyword">var</span> res <span class="keyword">=</span> xs
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> loop <span class="keyword">(</span>res<span class="keyword">,</span> ys<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  res
<span class="keyword">end</span></span> <span class="comment">// end of [list_vt_append]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_vt_extend
  <span class="keyword">(</span>xs<span class="keyword">,</span> y<span class="keyword">)</span> <span class="keyword">=</span> list_vt_append&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>xs<span class="keyword">,</span> cons_vt<span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="keyword">(</span>y<span class="keyword">,</span> nil_vt<span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">// end of [list_vt_extend]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_vt_unextend
  <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> loop
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>pos<span class="keyword">}</span></span> <span class="keyword">.&lt;</span><span class="staexp">n</span><span class="keyword">&gt;.</span>
<span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">list_vt</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">list_vt</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="staexp">-</span><span class="staexp">1</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val+</span><span class="keyword">@</span>list_vt_cons <span class="keyword">(</span>x<span class="keyword">,</span> xs1<span class="keyword">)</span> <span class="keyword">=</span> xs</span>
<span class="comment">//</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">case+</span> xs1 <span class="keyword">of</span>
<span class="keyword">|</span> list_vt_cons _ <span class="keyword">=&gt;</span> <span class="keyword">let</span>
    <span class="dynexp"><span class="keyword">val</span> x <span class="keyword">=</span> loop <span class="keyword">(</span>xs1<span class="keyword">)</span></span>
    <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">fold@</span> <span class="keyword">(</span>xs<span class="keyword">)</span></span>
  <span class="keyword">in</span>
    x
  <span class="keyword">end</span> <span class="comment">// end of [list_vt_cons]</span>
<span class="keyword">|</span> list_vt_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
    <span class="dynexp"><span class="keyword">val</span> x <span class="keyword">=</span> x</span>
    <span class="dynexp"><span class="keyword">val</span> xs1 <span class="keyword">=</span> xs1</span>
    <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">free@</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>0<span class="keyword">}</span></span><span class="keyword">(</span>xs<span class="keyword">)</span></span>
  <span class="keyword">in</span>
    xs := xs1<span class="keyword">;</span> x
  <span class="keyword">end</span> <span class="comment">// end of [list_vt_nil]</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [loop]</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  loop <span class="keyword">(</span>xs<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list_vt_unextend]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_vt_reverse <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span> list_vt_reverse_append&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>xs<span class="keyword">,</span> list_vt_nil<span class="keyword">)</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_vt_reverse_append
  <span class="keyword">(</span>xs<span class="keyword">,</span> ys<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> lemma_list_vt_param <span class="keyword">(</span>xs<span class="keyword">)</span></span>
<span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> lemma_list_vt_param <span class="keyword">(</span>ys<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> loop
  <span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">:</span>nat<span class="keyword">}</span></span> <span class="keyword">.&lt;</span><span class="staexp">m</span><span class="keyword">&gt;.</span>
<span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp">list_vt</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">)</span><span class="keyword">,</span> ys<span class="keyword">:</span> <span class="staexp">list_vt</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">list_vt</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">m</span><span class="staexp">+</span><span class="staexp">n</span><span class="keyword">)</span> <span class="keyword">=</span>
  <span class="keyword">case+</span> xs <span class="keyword">of</span>
  <span class="keyword">|</span> <span class="keyword">@</span>list_vt_cons
      <span class="keyword">(</span>_<span class="keyword">,</span> xs1<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="dynexp"><span class="keyword">val</span> xs1_ <span class="keyword">=</span> xs1</span>
      <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> xs1 := ys</span><span class="keyword">;</span> <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">fold@</span> <span class="keyword">(</span>xs<span class="keyword">)</span></span>
    <span class="keyword">in</span>
      loop <span class="keyword">(</span>xs1_<span class="keyword">,</span> xs<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [cons]</span>
  <span class="keyword">|</span> <span class="keyword">~</span>list_vt_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> ys</span>
<span class="comment">(* end of [loop] *)</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  loop <span class="keyword">(</span>xs<span class="keyword">,</span> ys<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list_vt_reverse_append]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">x</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_vt_split_at
  <span class="keyword">(</span>xs<span class="keyword">,</span> i<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> loop
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="staexp"><span class="keyword">{</span>i<span class="keyword">:</span>nat <span class="keyword">|</span> i &lt;= n<span class="keyword">}</span></span> <span class="keyword">.&lt;</span><span class="staexp">n</span><span class="keyword">&gt;.</span>
<span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">list_vt</span> <span class="keyword">(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">list_vt</span> <span class="keyword">(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">int</span> <span class="staexp">i</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">list_vt</span> <span class="keyword">(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">n</span><span class="staexp">-</span><span class="staexp">i</span><span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
<span class="keyword">if</span> i <span class="keyword">&gt;</span> <span class="dynexp">0</span> <span class="keyword">then</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val+</span><span class="keyword">@</span>cons_vt <span class="keyword">(</span>x<span class="keyword">,</span> xs1<span class="keyword">)</span> <span class="keyword">=</span> xs</span>
<span class="dynexp"><span class="keyword">val</span> res <span class="keyword">=</span> loop <span class="keyword">(</span>xs1<span class="keyword">,</span> i-<span class="dynexp">1</span><span class="keyword">)</span></span>
<span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">fold@</span> <span class="keyword">(</span>xs<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  res
<span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> res <span class="keyword">=</span> xs</span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> xs := list_vt_nil<span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span></span>
<span class="keyword">in</span>
  res
<span class="keyword">end</span> <span class="comment">// end of [if]</span>
<span class="keyword">)</span></span> <span class="comment">// end of [loop]</span>
<span class="comment">//</span>
<span class="keyword">var</span> xs <span class="keyword">=</span> xs
<span class="dynexp"><span class="keyword">val</span> res <span class="keyword">=</span> loop <span class="keyword">(</span>xs<span class="keyword">,</span> i<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  <span class="keyword">(</span>xs<span class="keyword">,</span> res<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list_split_vt_at]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_vt_concat
  <span class="keyword">(</span>xss<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="keyword">viewtypedef</span> <span class="staexp">VT <span class="keyword">=</span> <span class="staexp">List_vt</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="keyword">viewtypedef</span> <span class="staexp">VT0 <span class="keyword">=</span> <span class="staexp">List0_vt</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> loop
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>nat<span class="keyword">}</span></span> <span class="keyword">.&lt;</span><span class="staexp">n</span><span class="keyword">&gt;.</span>
<span class="keyword">(</span>
  res<span class="keyword">:</span> <span class="staexp">VT</span><span class="keyword">,</span> xss<span class="keyword">:</span> <span class="staexp">list_vt</span> <span class="keyword">(</span><span class="staexp">VT</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">VT0</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="keyword">in</span>
  <span class="keyword">case+</span> xss <span class="keyword">of</span>
  <span class="keyword">|</span> <span class="keyword">~</span>list_vt_cons
      <span class="keyword">(</span>xs<span class="keyword">,</span> xss<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="dynexp"><span class="keyword">val</span> res <span class="keyword">=</span> list_vt_append&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>xs<span class="keyword">,</span> res<span class="keyword">)</span></span>
    <span class="keyword">in</span>
      loop <span class="keyword">(</span>res<span class="keyword">,</span> xss<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [list_vt_cons]</span>
  <span class="keyword">|</span> <span class="keyword">~</span>list_vt_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> lemma_list_vt_param <span class="keyword">(</span>res<span class="keyword">)</span></span> <span class="keyword">in</span> res
    <span class="keyword">end</span> <span class="comment">// end of [list_vt_nil]</span>
<span class="keyword">end</span></span> <span class="comment">(* end of [loop] *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> xss <span class="keyword">=</span> list_vt_reverse <span class="keyword">(</span>xss<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> lemma_list_vt_param <span class="keyword">(</span>xss<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">case+</span> xss <span class="keyword">of</span>
<span class="keyword">|</span> <span class="keyword">~</span>list_vt_cons
    <span class="keyword">(</span>xs<span class="keyword">,</span> xss<span class="keyword">)</span> <span class="keyword">=&gt;</span> loop <span class="keyword">(</span>xs<span class="keyword">,</span> xss<span class="keyword">)</span>
<span class="keyword">|</span> <span class="keyword">~</span>list_vt_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> list_vt_nil <span class="keyword">(</span><span class="keyword">)</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list_vt_concat]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_vt_separate <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> lemma_list_vt_param <span class="keyword">(</span>xs<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> loop
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>nat<span class="keyword">}</span></span> <span class="keyword">.&lt;</span><span class="staexp">n</span><span class="keyword">&gt;.</span> <span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp">list_vt</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">,</span> res1<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">ptr</span><span class="staexp">?</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">list_vt</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n1</span><span class="keyword">)</span>
<span class="keyword">,</span> res2<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">ptr</span><span class="staexp">?</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">list_vt</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n2</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp"><span class="keyword">#[</span>n1<span class="keyword">,</span>n2<span class="keyword">:</span>nat <span class="keyword">|</span> n1+n2==n<span class="keyword">]</span></span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">case+</span> xs <span class="keyword">of</span>
<span class="keyword">|</span> <span class="keyword">@</span>list_vt_cons
    <span class="keyword">(</span>x<span class="keyword">,</span> xs_tl<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
    <span class="dynexp"><span class="keyword">val</span> xs_tl_v <span class="keyword">=</span> xs_tl</span>
    <span class="dynexp"><span class="keyword">val</span> test <span class="keyword">=</span> list_vt_separate$pred <span class="keyword">(</span>x<span class="keyword">)</span></span>
  <span class="keyword">in</span>
    <span class="keyword">if</span> test <span class="keyword">then</span> <span class="keyword">let</span>
      <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> res1 := xs</span>
      <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> loop <span class="keyword">(</span>xs_tl_v<span class="keyword">,</span> xs_tl<span class="keyword">,</span> res2<span class="keyword">)</span></span>
    <span class="keyword">in</span>
      <span class="keyword">fold@</span> <span class="keyword">(</span>res1<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">let</span>
      <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> res2 := xs</span>
      <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> loop <span class="keyword">(</span>xs_tl_v<span class="keyword">,</span> res1<span class="keyword">,</span> xs_tl<span class="keyword">)</span></span>
    <span class="keyword">in</span>
      <span class="keyword">fold@</span> <span class="keyword">(</span>res2<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [if]</span>
  <span class="keyword">end</span> <span class="comment">// end of [list_vt_cons]</span>
<span class="keyword">|</span> <span class="keyword">~</span>list_vt_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span>
    res1 := list_vt_nil<span class="keyword">;</span> res2 := list_vt_nil
  <span class="keyword">)</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [loop]</span>
<span class="comment">//</span>
<span class="keyword">var</span> res1<span class="keyword">:</span> <span class="staexp">ptr</span>
<span class="keyword">var</span> res2<span class="keyword">:</span> <span class="staexp">ptr</span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> loop <span class="keyword">(</span>xs<span class="keyword">,</span> res1<span class="keyword">,</span> res2<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> xs := res1</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  res2
<span class="keyword">end</span></span> <span class="comment">// end of [list_vt_separate]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_vt_filter <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
list_vt_filterlin$pred&lt;<span class="staexp">a</span><span class="keyword">&gt;</span>
  <span class="keyword">(</span>x<span class="keyword">)</span> <span class="keyword">=</span> list_vt_filter$pred&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>x<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">implement</span>
list_vt_filterlin$clear&lt;<span class="staexp">a</span><span class="keyword">&gt;</span>
  <span class="keyword">(</span>x<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> topize <span class="keyword">(</span>x<span class="keyword">)</span></span> <span class="dynexp"><span class="keyword">in</span> <span class="comment">(*void*)</span>
<span class="keyword">end</span></span></span> <span class="comment">// end of [list_vt_filterlin$clear]</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  list_vt_filterlin&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>xs<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list_vt_filter]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_vt_filterlin <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> lemma_list_vt_param <span class="keyword">(</span>xs<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> loop
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>nat<span class="keyword">}</span></span> <span class="keyword">.&lt;</span><span class="staexp">n</span><span class="keyword">&gt;.</span>
<span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">list_vt</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">listLte_vt</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">case+</span> xs <span class="keyword">of</span>
<span class="keyword">|</span> <span class="keyword">@</span>list_vt_cons
    <span class="keyword">(</span>x<span class="keyword">,</span> xs1<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
    <span class="dynexp"><span class="keyword">val</span> test <span class="keyword">=</span>
      list_vt_filterlin$pred&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>x<span class="keyword">)</span></span>
  <span class="keyword">in</span>
    <span class="keyword">if</span> test <span class="keyword">then</span> <span class="keyword">let</span>
      <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> loop <span class="keyword">(</span>xs1<span class="keyword">)</span></span>
    <span class="keyword">in</span>
      <span class="keyword">fold@</span> <span class="keyword">(</span>xs<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">let</span>
      <span class="dynexp"><span class="keyword">val</span> xs1 <span class="keyword">=</span> xs1</span>
      <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span>
        list_vt_filterlin$clear&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>x<span class="keyword">)</span></span>
      <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">free@</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>0<span class="keyword">}</span></span><span class="keyword">(</span>xs<span class="keyword">)</span></span>
      <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> xs := xs1</span>
    <span class="keyword">in</span>
      loop <span class="keyword">(</span>xs<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [if]</span>
  <span class="keyword">end</span> <span class="comment">// end of [list_vt_cons]</span>
<span class="keyword">|</span> <span class="keyword">@</span>list_vt_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">fold@</span> <span class="keyword">(</span>xs<span class="keyword">)</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [loop]</span>
<span class="comment">//</span>
<span class="keyword">var</span> xs <span class="keyword">=</span> xs
<span class="comment">//</span>
<span class="keyword">in</span>
  loop <span class="keyword">(</span>xs<span class="keyword">)</span><span class="keyword">;</span> xs
<span class="keyword">end</span></span> <span class="comment">// end of [list_vt_filterlin]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_vt_filterlin$clear <span class="keyword">(</span>x<span class="keyword">)</span> <span class="keyword">=</span> gclear_ref <span class="keyword">(</span>x<span class="keyword">)</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_vt_app
  <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">case+</span> xs <span class="keyword">of</span>
<span class="keyword">|</span> <span class="keyword">@</span>list_vt_cons
    <span class="keyword">(</span>x<span class="keyword">,</span> xs1<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
    <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span>
      list_vt_app$fwork&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>x<span class="keyword">)</span></span>
    <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> list_vt_app&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>xs1<span class="keyword">)</span></span>
    <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">fold@</span> <span class="keyword">(</span>xs<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">in</span>
    <span class="comment">// nothing</span>
  <span class="keyword">end</span></span> <span class="comment">// end of [cons]</span>
<span class="keyword">|</span> list_vt_nil <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list_vt_app]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_vt_appfree
  <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">case+</span> xs <span class="keyword">of</span>
<span class="keyword">|</span> <span class="keyword">@</span>list_vt_cons
    <span class="keyword">(</span>x<span class="keyword">,</span> xs1<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
    <span class="dynexp"><span class="keyword">val</span> xs1 <span class="keyword">=</span> xs1</span>
    <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> list_vt_appfree$fwork&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>x<span class="keyword">)</span></span>
    <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">free@</span> <span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>0<span class="keyword">}</span></span> <span class="keyword">(</span>xs<span class="keyword">)</span></span>
  <span class="keyword">in</span>
    list_vt_appfree&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>xs1<span class="keyword">)</span>
  <span class="keyword">end</span> <span class="comment">// end of [cons]</span>
<span class="keyword">|</span> <span class="keyword">~</span>list_vt_nil <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list_vt_appfree]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">b</span><span class="keyword">}</span>
list_vt_map
  <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> lemma_list_vt_param <span class="keyword">(</span>xs<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> loop
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>nat<span class="keyword">}</span></span> <span class="keyword">.&lt;</span><span class="staexp">n</span><span class="keyword">&gt;.</span> <span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">list_vt</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">,</span> res<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">ptr</span><span class="staexp">?</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">list_vt</span> <span class="keyword">(</span><span class="staexp">b</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="keyword">in</span>
  <span class="keyword">case+</span> xs <span class="keyword">of</span>
  <span class="keyword">|</span> <span class="keyword">@</span>list_vt_cons
      <span class="keyword">(</span>x<span class="keyword">,</span> xs1<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="dynexp"><span class="keyword">val</span> y <span class="keyword">=</span>
        list_vt_map$fopr&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">b</span><span class="keyword">&gt;</span> <span class="keyword">(</span>x<span class="keyword">)</span></span>
      <span class="comment">// end of [val]</span>
      <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> res := list_vt_cons<span class="staexp"><span class="keyword">{</span>b<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>0<span class="keyword">}</span></span><span class="keyword">(</span>y<span class="keyword">,</span> _<span class="keyword">)</span></span>
      <span class="dynexp"><span class="keyword">val+</span>list_vt_cons <span class="keyword">(</span>_<span class="keyword">,</span> res1<span class="keyword">)</span> <span class="keyword">=</span> res</span>
      <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> loop <span class="keyword">(</span>xs1<span class="keyword">,</span> res1<span class="keyword">)</span></span>
      <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">fold@</span> <span class="keyword">(</span>xs<span class="keyword">)</span></span>
      <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">fold@</span> <span class="keyword">(</span>res<span class="keyword">)</span></span>
    <span class="dynexp"><span class="keyword">in</span>
      <span class="comment">// nothing</span>
    <span class="keyword">end</span></span> <span class="comment">// end of [list_vt_cons]</span>
  <span class="keyword">|</span> list_vt_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span>res := list_vt_nil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [loop]</span>
<span class="comment">//</span>
<span class="keyword">var</span> res<span class="keyword">:</span> <span class="staexp">ptr</span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> loop <span class="keyword">(</span>xs<span class="keyword">,</span> res<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  res
<span class="keyword">end</span></span> <span class="comment">// end of [list_vt_map]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">x</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">y</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_vt_map_fun
  <span class="keyword">(</span>xs<span class="keyword">,</span> f<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">x2</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">y2</span><span class="keyword">}</span>
list_vt_map$fopr <span class="keyword">(</span>x2<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> f <span class="keyword">=</span> $UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span><span class="keyword">(</span>&amp;x2<span class="keyword">)</span><span class="keyword">-&gt;</span>y<span class="keyword">}</span></span><span class="keyword">(</span>f<span class="keyword">)</span></span> <span class="keyword">in</span> $UN<span class="keyword">.</span>castvwtp0<span class="staexp"><span class="keyword">{</span>y2<span class="keyword">}</span></span><span class="keyword">(</span>f<span class="keyword">(</span>x2<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list_vt_map$fopr]</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  list_vt_map&lt;<span class="staexp">x</span><span class="keyword">&gt;&lt;</span><span class="staexp">y</span><span class="keyword">&gt;</span> <span class="keyword">(</span>xs<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list_vt_map_fun]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">x</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">y</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_vt_map_clo
  <span class="keyword">(</span>xs<span class="keyword">,</span> f<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> f <span class="keyword">=</span> $UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span><span class="keyword">(</span>&amp;x<span class="keyword">)</span> <span class="keyword">-&lt;</span>cloref1<span class="keyword">&gt;</span> y<span class="keyword">}</span></span><span class="keyword">(</span><span class="dynexp"><span class="keyword">addr@</span></span>f<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">x2</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">y2</span><span class="keyword">}</span>
list_vt_map$fopr <span class="keyword">(</span>x2<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> f <span class="keyword">=</span> $UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span><span class="keyword">(</span>&amp;x2<span class="keyword">)</span><span class="keyword">-&lt;</span>cloref1<span class="keyword">&gt;</span>y<span class="keyword">}</span></span><span class="keyword">(</span>f<span class="keyword">)</span></span> <span class="keyword">in</span> $UN<span class="keyword">.</span>castvwtp0<span class="staexp"><span class="keyword">{</span>y2<span class="keyword">}</span></span><span class="keyword">(</span>f<span class="keyword">(</span>x2<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list_vt_map$fopr]</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  list_vt_map&lt;<span class="staexp">x</span><span class="keyword">&gt;&lt;</span><span class="staexp">y</span><span class="keyword">&gt;</span> <span class="keyword">(</span>xs<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list_vt_map_clo]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">x</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">y</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_vt_map_cloref
  <span class="keyword">(</span>xs<span class="keyword">,</span> f<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">x2</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">y2</span><span class="keyword">}</span>
list_vt_map$fopr <span class="keyword">(</span>x2<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> f <span class="keyword">=</span> $UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span><span class="keyword">(</span>&amp;x2<span class="keyword">)</span><span class="keyword">-&lt;</span>cloref1<span class="keyword">&gt;</span>y<span class="keyword">}</span></span><span class="keyword">(</span>f<span class="keyword">)</span></span> <span class="keyword">in</span> $UN<span class="keyword">.</span>castvwtp0<span class="staexp"><span class="keyword">{</span>y2<span class="keyword">}</span></span><span class="keyword">(</span>f<span class="keyword">(</span>x2<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list_vt_map$fopr]</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  list_vt_map&lt;<span class="staexp">x</span><span class="keyword">&gt;&lt;</span><span class="staexp">y</span><span class="keyword">&gt;</span> <span class="keyword">(</span>xs<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list_vt_map_cloref]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">b</span><span class="keyword">}</span>
list_vt_mapfree
  <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> lemma_list_vt_param <span class="keyword">(</span>xs<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> loop
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>nat<span class="keyword">}</span></span> <span class="keyword">.&lt;</span><span class="staexp">n</span><span class="keyword">&gt;.</span> <span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp">list_vt</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">,</span> res<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">ptr</span><span class="staexp">?</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">list_vt</span> <span class="keyword">(</span><span class="staexp">b</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="keyword">in</span>
  <span class="keyword">case+</span> xs <span class="keyword">of</span>
  <span class="keyword">|</span> <span class="keyword">@</span>list_vt_cons
      <span class="keyword">(</span>x<span class="keyword">,</span> xs1<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="dynexp"><span class="keyword">val</span> y <span class="keyword">=</span>
      list_vt_mapfree$fopr&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">b</span><span class="keyword">&gt;</span> <span class="keyword">(</span>x<span class="keyword">)</span></span>
      <span class="dynexp"><span class="keyword">val</span> xs1_val <span class="keyword">=</span> xs1</span>
      <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="comment">(*freed*)</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">free@</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>0<span class="keyword">}</span></span><span class="keyword">(</span>xs<span class="keyword">)</span></span>
      <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> res := list_vt_cons<span class="staexp"><span class="keyword">{</span>b<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>0<span class="keyword">}</span></span><span class="keyword">(</span>y<span class="keyword">,</span> _<span class="keyword">)</span></span>
      <span class="dynexp"><span class="keyword">val+</span>list_vt_cons <span class="keyword">(</span>_<span class="keyword">,</span> res1<span class="keyword">)</span> <span class="keyword">=</span> res</span>
      <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> loop <span class="keyword">(</span>xs1_val<span class="keyword">,</span> res1<span class="keyword">)</span></span>
      <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="comment">(*folded*)</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">fold@</span><span class="keyword">(</span>res<span class="keyword">)</span></span>
    <span class="dynexp"><span class="keyword">in</span>
      <span class="comment">// nothing</span>
    <span class="keyword">end</span></span> <span class="comment">// end of [list_vt_cons]</span>
  <span class="keyword">|</span> <span class="keyword">~</span>list_vt_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span>res := list_vt_nil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [loop]</span>
<span class="comment">//</span>
<span class="keyword">var</span> res<span class="keyword">:</span> <span class="staexp">ptr</span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> loop <span class="keyword">(</span>xs<span class="keyword">,</span> res<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  res
<span class="keyword">end</span></span> <span class="comment">// end of [list_vt_mapfree]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">x</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">y</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_vt_mapfree_fun
  <span class="keyword">(</span>xs<span class="keyword">,</span> f<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">x2</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">y2</span><span class="keyword">}</span>
list_vt_mapfree$fopr <span class="keyword">(</span>x2<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> f <span class="keyword">=</span> $UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span><span class="keyword">(</span>&amp;x2&gt;&gt;_?<span class="keyword">)</span><span class="keyword">-&gt;</span>y<span class="keyword">}</span></span><span class="keyword">(</span>f<span class="keyword">)</span></span> <span class="keyword">in</span> $UN<span class="keyword">.</span>castvwtp0<span class="staexp"><span class="keyword">{</span>y2<span class="keyword">}</span></span><span class="keyword">(</span>f<span class="keyword">(</span>x2<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list_vt_mapfree$fopr]</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  list_vt_mapfree&lt;<span class="staexp">x</span><span class="keyword">&gt;&lt;</span><span class="staexp">y</span><span class="keyword">&gt;</span> <span class="keyword">(</span>xs<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list_vt_mapfree_fun]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">x</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">y</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_vt_mapfree_clo
  <span class="keyword">(</span>xs<span class="keyword">,</span> f<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> f <span class="keyword">=</span>
$UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span><span class="keyword">(</span>&amp;x&gt;&gt;_?<span class="keyword">)</span> <span class="keyword">-&lt;</span>cloref1<span class="keyword">&gt;</span> y<span class="keyword">}</span></span><span class="keyword">(</span><span class="dynexp"><span class="keyword">addr@</span></span>f<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">x2</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">y2</span><span class="keyword">}</span>
list_vt_mapfree$fopr <span class="keyword">(</span>x2<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> f <span class="keyword">=</span> $UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span><span class="keyword">(</span>&amp;x2&gt;&gt;_?<span class="keyword">)</span><span class="keyword">-&lt;</span>cloref1<span class="keyword">&gt;</span>y<span class="keyword">}</span></span><span class="keyword">(</span>f<span class="keyword">)</span></span> <span class="keyword">in</span> $UN<span class="keyword">.</span>castvwtp0<span class="staexp"><span class="keyword">{</span>y2<span class="keyword">}</span></span><span class="keyword">(</span>f<span class="keyword">(</span>x2<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list_vt_mapfree$fopr]</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  list_vt_mapfree&lt;<span class="staexp">x</span><span class="keyword">&gt;&lt;</span><span class="staexp">y</span><span class="keyword">&gt;</span> <span class="keyword">(</span>xs<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list_vt_mapfree_clo]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">x</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">y</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_vt_mapfree_cloref
  <span class="keyword">(</span>xs<span class="keyword">,</span> f<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">x2</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">y2</span><span class="keyword">}</span>
list_vt_mapfree$fopr <span class="keyword">(</span>x2<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> f <span class="keyword">=</span> $UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span><span class="keyword">(</span>&amp;x2&gt;&gt;_?<span class="keyword">)</span><span class="keyword">-&lt;</span>cloref1<span class="keyword">&gt;</span>y<span class="keyword">}</span></span><span class="keyword">(</span>f<span class="keyword">)</span></span> <span class="keyword">in</span> $UN<span class="keyword">.</span>castvwtp0<span class="staexp"><span class="keyword">{</span>y2<span class="keyword">}</span></span><span class="keyword">(</span>f<span class="keyword">(</span>x2<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list_vt_mapfree$fopr]</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  list_vt_mapfree&lt;<span class="staexp">x</span><span class="keyword">&gt;&lt;</span><span class="staexp">y</span><span class="keyword">&gt;</span> <span class="keyword">(</span>xs<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list_vt_mapfree_cloref]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">x</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_vt_foreach
  <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">var</span> env<span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">in</span>
  list_vt_foreach_env&lt;<span class="staexp">x</span><span class="keyword">&gt;&lt;</span><span class="staexp">void</span><span class="keyword">&gt;</span> <span class="keyword">(</span>xs<span class="keyword">,</span> env<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list_vt_foreach]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">x</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">env</span><span class="keyword">}</span>
list_vt_foreach_env
  <span class="keyword">(</span>xs<span class="keyword">,</span> env<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> lemma_list_vt_param <span class="keyword">(</span>xs<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> loop
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>nat<span class="keyword">}</span></span> <span class="keyword">.&lt;</span><span class="staexp">n</span><span class="keyword">&gt;.</span>
<span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">list_vt</span> <span class="keyword">(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">env</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">case+</span> xs <span class="keyword">of</span>
<span class="keyword">|</span> <span class="keyword">@</span>list_vt_cons
    <span class="keyword">(</span>x<span class="keyword">,</span> xs1<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
    <span class="dynexp"><span class="keyword">val</span> test <span class="keyword">=</span>
      list_vt_foreach$cont <span class="keyword">(</span>x<span class="keyword">,</span> env<span class="keyword">)</span></span>
    <span class="comment">// end of [val]</span>
  <span class="keyword">in</span>
    <span class="keyword">if</span> test <span class="keyword">then</span> <span class="keyword">let</span>
      <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span>
        list_vt_foreach$fwork&lt;<span class="staexp">x</span><span class="keyword">&gt;&lt;</span><span class="staexp">env</span><span class="keyword">&gt;</span> <span class="keyword">(</span>x<span class="keyword">,</span> env<span class="keyword">)</span></span>
      <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> loop <span class="keyword">(</span>xs1<span class="keyword">,</span> env<span class="keyword">)</span></span>
      <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">fold@</span> <span class="keyword">(</span>xs<span class="keyword">)</span></span>
    <span class="dynexp"><span class="keyword">in</span>
      <span class="comment">// nothing</span>
    <span class="keyword">end</span></span> <span class="keyword">else</span> <span class="keyword">let</span>
      <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">fold@</span> <span class="keyword">(</span>xs<span class="keyword">)</span></span> <span class="dynexp"><span class="keyword">in</span> <span class="comment">(*nothing*)</span>
    <span class="keyword">end</span></span> <span class="comment">// end of [if]</span>
  <span class="keyword">end</span> <span class="comment">// end of [cons]</span>
<span class="keyword">|</span> list_vt_nil <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [loop]</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  loop <span class="keyword">(</span>xs<span class="keyword">,</span> env<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list_vt_foreach_env]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">x</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">env</span><span class="keyword">}</span>
list_vt_foreach$cont <span class="keyword">(</span>x<span class="keyword">,</span> env<span class="keyword">)</span> <span class="keyword">=</span> true</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_vt_foreach_fun
  <span class="staexp"><span class="keyword">{</span>fe<span class="keyword">}</span></span> <span class="keyword">(</span>xs<span class="keyword">,</span> f<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> lemma_list_vt_param <span class="keyword">(</span>xs<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
loop
<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>nat<span class="keyword">}</span></span> <span class="keyword">.&lt;</span><span class="staexp">n</span><span class="keyword">&gt;.</span>
<span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">list_vt</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> f<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">&amp;</span><span class="staexp">a</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">fe</span><span class="keyword">&gt;</span> <span class="staexp">void</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="staexp">fe</span><span class="keyword">&gt;</span> <span class="staexp">void</span> <span class="keyword">=</span>
  <span class="keyword">case+</span> xs <span class="keyword">of</span>
  <span class="keyword">|</span> <span class="keyword">@</span>list_vt_cons
      <span class="keyword">(</span>x<span class="keyword">,</span> xs1<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> f <span class="keyword">(</span>x<span class="keyword">)</span></span>
      <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> loop <span class="keyword">(</span>xs1<span class="keyword">,</span> f<span class="keyword">)</span></span>
    <span class="keyword">in</span>
      <span class="keyword">fold@</span> <span class="keyword">(</span>xs<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [cons]</span>
  <span class="keyword">|</span> list_vt_nil <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span></span>
<span class="comment">// end of [loop]</span>
<span class="keyword">in</span>
  loop <span class="keyword">(</span>xs<span class="keyword">,</span> f<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list_vt_foreach_fun]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_vt_foreach_funenv
  <span class="staexp"><span class="keyword">{</span>v<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>vt<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>fe<span class="keyword">}</span></span>
  <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> xs<span class="keyword">,</span> f<span class="keyword">,</span> env<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> lemma_list_vt_param <span class="keyword">(</span>xs<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> loop
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>nat<span class="keyword">}</span></span> <span class="keyword">.&lt;</span><span class="staexp">n</span><span class="keyword">&gt;.</span> <span class="keyword">(</span>
  <span class="prfexp">pf<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">v</span></span>
<span class="keyword">|</span> xs<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">list_vt</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">,</span> f<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp"><span class="keyword">!</span></span><span class="staexp">v</span> <span class="keyword">|</span> <span class="staexp">&amp;</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">vt</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">fe</span><span class="keyword">&gt;</span> <span class="staexp">void</span>
<span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">vt</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="staexp">fe</span><span class="keyword">&gt;</span> <span class="staexp">void</span> <span class="keyword">=</span>
  <span class="keyword">case+</span> xs <span class="keyword">of</span>
  <span class="keyword">|</span> <span class="keyword">@</span>list_vt_cons
      <span class="keyword">(</span>x<span class="keyword">,</span> xs1<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> f <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> x<span class="keyword">,</span> env<span class="keyword">)</span></span>
      <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> loop <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> xs1<span class="keyword">,</span> f<span class="keyword">,</span> env<span class="keyword">)</span></span>
    <span class="keyword">in</span>
      <span class="keyword">fold@</span> <span class="keyword">(</span>xs<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [cons]</span>
  <span class="keyword">|</span> list_vt_nil <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span></span>
<span class="comment">// end of [loop]</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  loop <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> xs<span class="keyword">,</span> f<span class="keyword">,</span> env<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list_vt_foreach_funenv]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">x</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
list_vt_iforeach
  <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">var</span> env<span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">in</span>
  list_vt_iforeach_env&lt;<span class="staexp">x</span><span class="keyword">&gt;&lt;</span><span class="staexp">void</span><span class="keyword">&gt;</span> <span class="keyword">(</span>xs<span class="keyword">,</span> env<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list_vt_iforeach]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">x</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">env</span><span class="keyword">}</span>
list_vt_iforeach_env
  <span class="keyword">(</span>xs<span class="keyword">,</span> env<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> lemma_list_vt_param <span class="keyword">(</span>xs<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> loop
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>nat<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>i<span class="keyword">:</span>nat<span class="keyword">}</span></span> <span class="keyword">.&lt;</span><span class="staexp">n</span><span class="keyword">&gt;.</span> <span class="keyword">(</span>
  i<span class="keyword">:</span> <span class="staexp">int</span> <span class="staexp">i</span><span class="keyword">,</span> xs<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">list_vt</span> <span class="keyword">(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">env</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">intBtwe</span><span class="keyword">(</span><span class="staexp">i</span><span class="keyword">,</span> <span class="staexp">n</span><span class="staexp">+</span><span class="staexp">i</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="keyword">in</span>
  <span class="keyword">case+</span> xs <span class="keyword">of</span>
  <span class="keyword">|</span> <span class="keyword">@</span>list_vt_cons
      <span class="keyword">(</span>x<span class="keyword">,</span> xs1<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="dynexp"><span class="keyword">val</span> test <span class="keyword">=</span>
        list_vt_iforeach$cont&lt;<span class="staexp">x</span><span class="keyword">&gt;&lt;</span><span class="staexp">env</span><span class="keyword">&gt;</span> <span class="keyword">(</span>i<span class="keyword">,</span> x<span class="keyword">,</span> env<span class="keyword">)</span></span>
      <span class="comment">// end of [val]</span>
    <span class="keyword">in</span>
      <span class="keyword">if</span> test <span class="keyword">then</span> <span class="keyword">let</span>
        <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span>
          list_vt_iforeach$fwork&lt;<span class="staexp">x</span><span class="keyword">&gt;&lt;</span><span class="staexp">env</span><span class="keyword">&gt;</span> <span class="keyword">(</span>i<span class="keyword">,</span> x<span class="keyword">,</span> env<span class="keyword">)</span></span>
        <span class="comment">// end of [val]</span>
        <span class="dynexp"><span class="keyword">val</span> i <span class="keyword">=</span> loop <span class="keyword">(</span>succ<span class="keyword">(</span>i<span class="keyword">)</span><span class="keyword">,</span> xs1<span class="keyword">,</span> env<span class="keyword">)</span></span>
        <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">fold@</span> <span class="keyword">(</span>xs<span class="keyword">)</span></span>
      <span class="keyword">in</span>
        i <span class="comment">// the number of processed elements</span>
      <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">let</span>
        <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">fold@</span> <span class="keyword">(</span>xs<span class="keyword">)</span></span>
      <span class="keyword">in</span>
        i <span class="comment">// the number of processed elements</span>
      <span class="keyword">end</span> <span class="comment">// end of [if]</span>
    <span class="keyword">end</span> <span class="comment">// end of [cons]</span>
  <span class="keyword">|</span> list_vt_nil <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span>i<span class="keyword">)</span> <span class="comment">// |processed-elements|</span>
<span class="keyword">end</span></span> <span class="comment">// end of [loop]</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  loop <span class="keyword">(</span><span class="dynexp">0</span><span class="keyword">,</span> xs<span class="keyword">,</span> env<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list_vt_iforeach_env]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">x</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">env</span><span class="keyword">}</span>
list_vt_iforeach$cont <span class="keyword">(</span>i<span class="keyword">,</span> x<span class="keyword">,</span> env<span class="keyword">)</span> <span class="keyword">=</span> true</span>

<span class="comment">(* ****** ****** *)</span>

<span class="neuexp"><span class="keyword">#include</span> "./SHARE/list_vt_mergesort.dats"</span>
<span class="neuexp"><span class="keyword">#include</span> "./SHARE/list_vt_quicksort.dats"</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
streamize_list_vt_elt
  <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
auxmain
<span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp">List_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="dynexp"><span class="keyword">$ldelay</span>
<span class="keyword">(</span>
<span class="comment">//</span>
<span class="keyword">(</span>
<span class="keyword">case+</span> xs <span class="keyword">of</span>
<span class="keyword">|</span> <span class="keyword">~</span>list_vt_nil
    <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> stream_vt_nil<span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">|</span> <span class="keyword">~</span>list_vt_cons
    <span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span>
    stream_vt_cons<span class="keyword">(</span>x<span class="keyword">,</span> auxmain<span class="keyword">(</span>xs<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> stream_vt_con<span class="keyword">(</span>a<span class="keyword">)</span>
<span class="comment">//</span>
<span class="keyword">,</span>
<span class="comment">//</span>
list_vt_free<span class="keyword">(</span>xs<span class="keyword">)</span>
<span class="keyword">)</span></span></span> <span class="comment">(* end of [auxmain] *)</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  <span class="keyword">$effmask_all</span><span class="keyword">(</span>auxmain<span class="keyword">(</span>xs<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">(* end of [streamize_list_vt_elt] *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">tk</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
listize_g0int_rep
  <span class="keyword">(</span>i0<span class="keyword">,</span> base<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
loop<span class="staexp"><span class="keyword">{</span>i<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
i0<span class="keyword">:</span> <span class="staexp">g1int</span><span class="keyword">(</span><span class="staexp">tk</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span><span class="keyword">,</span> res<span class="keyword">:</span> <span class="staexp">List0_vt</span><span class="keyword">(</span><span class="staexp">int</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">List0_vt</span><span class="keyword">(</span><span class="staexp">int</span><span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
<span class="keyword">if</span>
isgtz<span class="keyword">(</span>i0<span class="keyword">)</span>
<span class="keyword">then</span>
loop
<span class="keyword">(</span> ndiv_g1int_int1<span class="keyword">(</span>i0<span class="keyword">,</span> base<span class="keyword">)</span>
<span class="keyword">,</span> list_vt_cons<span class="keyword">(</span>nmod_g1int_int1<span class="keyword">(</span>i0<span class="keyword">,</span> base<span class="keyword">)</span><span class="keyword">,</span> res<span class="keyword">)</span>
<span class="keyword">)</span> <span class="comment">(* end of [then] *)</span>
<span class="keyword">else</span> res <span class="comment">// end-of-else</span>
<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
<span class="comment">//</span>
$UN<span class="keyword">.</span>castvwtp0
<span class="keyword">(</span>
<span class="keyword">$effmask_all</span><span class="keyword">(</span>loop<span class="keyword">(</span>g1ofg0_int<span class="keyword">(</span>i0<span class="keyword">)</span><span class="keyword">,</span> list_vt_nil<span class="comment">(*void*)</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="comment">(* $UN.castvwtp0 *)</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [listize_g0int_rep]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* end of [list_vt.dats] *)</span>
</pre>
<pre class="patsyntax">
<span class="comment">(***********************************************************************)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(*                         Applied Type System                         *)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(***********************************************************************)</span>

<span class="comment">(*
** ATS/Postiats - Unleashing the Potential of Types!
** Copyright (C) 2010-2015 Hongwei Xi, ATS Trustful Software, Inc.
** All rights reserved
**
** ATS is free software;  you can  redistribute it and/or modify it under
** the terms of  the GNU GENERAL PUBLIC LICENSE (GPL) as published by the
** Free Software Foundation; either version 3, or (at  your  option)  any
** later version.
**
** ATS is distributed in the hope that it will be useful, but WITHOUT ANY
** WARRANTY; without  even  the  implied  warranty  of MERCHANTABILITY or
** FITNESS FOR A PARTICULAR PURPOSE.  See the  GNU General Public License
** for more details.
**
** You  should  have  received  a  copy of the GNU General Public License
** along  with  ATS;  see the  file COPYING.  If not, please write to the
** Free Software Foundation,  51 Franklin Street, Fifth Floor, Boston, MA
** 02110-1301, USA.
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
** Source:
** $PATSHOME/prelude/DATS/CODEGEN/option.atxt
** Time of generation: Sun Oct  2 10:33:58 2016
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* Author: Hongwei Xi *)</span>
<span class="comment">(* Authoremail: hwxi AT cs DOT bu DOT edu *)</span>
<span class="comment">(* Start time: Feburary, 2012 *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span> option_some <span class="keyword">(</span>x<span class="keyword">)</span> <span class="keyword">=</span> Some <span class="keyword">(</span>x<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span> option_none <span class="keyword">(</span> <span class="keyword">)</span> <span class="keyword">=</span> None <span class="keyword">(</span> <span class="keyword">)</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
option_is_some <span class="keyword">(</span>opt<span class="keyword">)</span> <span class="keyword">=</span>
  <span class="keyword">case+</span> opt <span class="keyword">of</span> Some _ <span class="keyword">=&gt;</span> true <span class="keyword">|</span> None _ <span class="keyword">=&gt;</span> false</span>
<span class="comment">// end of [option_is_some]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
option_is_none <span class="keyword">(</span>opt<span class="keyword">)</span> <span class="keyword">=</span>
  <span class="keyword">case+</span> opt <span class="keyword">of</span> Some _ <span class="keyword">=&gt;</span> false <span class="keyword">|</span> None _ <span class="keyword">=&gt;</span> true</span>
<span class="comment">// end of [option_is_none]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
option_unsome
  <span class="keyword">(</span>opt<span class="keyword">)</span> <span class="keyword">=</span> x <span class="keyword">where</span> <span class="keyword">{</span> <span class="dynexp"><span class="keyword">val+</span>Some <span class="keyword">(</span>x<span class="keyword">)</span> <span class="keyword">=</span> opt</span> <span class="keyword">}</span></span>
<span class="comment">// end of [option_unsome]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
option_unsome_exn
  <span class="keyword">(</span>opt<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span>
  <span class="keyword">case+</span> opt <span class="keyword">of</span>
  <span class="keyword">|</span> Some x <span class="keyword">=&gt;</span> x <span class="keyword">|</span> None _ <span class="keyword">=&gt;</span> <span class="dynexp"><span class="keyword">$raise</span> NotSomeExn<span class="keyword">(</span><span class="keyword">)</span></span>
<span class="keyword">)</span></span> <span class="comment">// end of [option_unsome_exn]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
option_equal
  <span class="keyword">(</span>opt1<span class="keyword">,</span> opt2<span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
<span class="comment">//</span>
<span class="keyword">case+</span> opt1 <span class="keyword">of</span>
<span class="keyword">|</span> None <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span>
  <span class="keyword">(</span>
    <span class="keyword">case+</span> opt1 <span class="keyword">of</span> None <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> true <span class="keyword">|</span> Some _ <span class="keyword">=&gt;</span> false
  <span class="keyword">)</span>
<span class="keyword">|</span> Some x1 <span class="keyword">=&gt;</span>
  <span class="keyword">(</span>
    <span class="keyword">case+</span> opt2 <span class="keyword">of</span> None <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> false <span class="keyword">|</span> Some x2 <span class="keyword">=&gt;</span> option_equal$eqfn<span class="keyword">(</span>x1<span class="keyword">,</span> x2<span class="keyword">)</span>
  <span class="keyword">)</span>
<span class="comment">//</span>
<span class="keyword">)</span></span> <span class="comment">(* end of [option_equal] *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
fprint_option
  <span class="keyword">(</span>out<span class="keyword">,</span> opt<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">case+</span> opt <span class="keyword">of</span>
<span class="keyword">|</span> Some <span class="keyword">(</span>x<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">{</span>
    <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span>
    <span class="keyword">)</span> <span class="keyword">=</span> fprint_string <span class="keyword">(</span>out<span class="keyword">,</span> <span class="dynstr">"Some("</span><span class="keyword">)</span></span>
    <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fprint_val&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">,</span> x<span class="keyword">)</span></span>
    <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fprint_string <span class="keyword">(</span>out<span class="keyword">,</span> <span class="dynstr">")"</span><span class="keyword">)</span></span>
  <span class="keyword">}</span> <span class="comment">(* end of [Some] *)</span>
<span class="keyword">|</span> None <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> fprint_string <span class="keyword">(</span>out<span class="keyword">,</span> <span class="dynstr">"None()"</span><span class="keyword">)</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [fprint_option]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* end of [option.dats] *)</span>
</pre>
<pre class="patsyntax">
<span class="comment">(***********************************************************************)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(*                         Applied Type System                         *)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(***********************************************************************)</span>

<span class="comment">(*
** ATS/Postiats - Unleashing the Potential of Types!
** Copyright (C) 2010-2015 Hongwei Xi, ATS Trustful Software, Inc.
** All rights reserved
**
** ATS is free software;  you can  redistribute it and/or modify it under
** the terms of  the GNU GENERAL PUBLIC LICENSE (GPL) as published by the
** Free Software Foundation; either version 3, or (at  your  option)  any
** later version.
**
** ATS is distributed in the hope that it will be useful, but WITHOUT ANY
** WARRANTY; without  even  the  implied  warranty  of MERCHANTABILITY or
** FITNESS FOR A PARTICULAR PURPOSE.  See the  GNU General Public License
** for more details.
**
** You  should  have  received  a  copy of the GNU General Public License
** along  with  ATS;  see the  file COPYING.  If not, please write to the
** Free Software Foundation,  51 Franklin Street, Fifth Floor, Boston, MA
** 02110-1301, USA.
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
** Source:
** $PATSHOME/prelude/DATS/CODEGEN/option_vt.atxt
** Time of generation: Sun Oct  2 10:33:58 2016
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* Author: Hongwei Xi *)</span>
<span class="comment">(* Authoremail: hwxi AT cs DOT bu DOT edu *)</span>
<span class="comment">(* Start time: Feburary, 2012 *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span> option_vt_some <span class="keyword">(</span>x<span class="keyword">)</span> <span class="keyword">=</span> Some_vt <span class="keyword">(</span>x<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span> option_vt_none <span class="keyword">(</span> <span class="keyword">)</span> <span class="keyword">=</span> None_vt <span class="keyword">(</span> <span class="keyword">)</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
option_vt_make_opt
  <span class="keyword">(</span>b<span class="keyword">,</span> x<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span>
  <span class="keyword">if</span> b <span class="keyword">then</span> <span class="keyword">let</span>
    <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> opt_unsome<span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="keyword">(</span>x<span class="keyword">)</span></span> <span class="keyword">in</span> Some_vt<span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="keyword">(</span>x<span class="keyword">)</span>
  <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">let</span>
    <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> opt_unnone<span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="keyword">(</span>x<span class="keyword">)</span></span> <span class="keyword">in</span> None_vt<span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="keyword">(</span> <span class="keyword">)</span>
  <span class="keyword">end</span> <span class="comment">// end of [if]</span>
<span class="keyword">)</span></span> <span class="comment">(* end of [option_vt_make_opt] *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
option_vt_is_some
  <span class="keyword">(</span>opt<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">case+</span> opt <span class="keyword">of</span>
  <span class="keyword">|</span> Some_vt _ <span class="keyword">=&gt;</span> true <span class="keyword">|</span> None_vt _ <span class="keyword">=&gt;</span> false</span>
<span class="comment">// end of [option_is_some]</span>

<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span>
option_vt_is_none
  <span class="keyword">(</span>opt<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">case+</span> opt <span class="keyword">of</span>
  <span class="keyword">|</span> Some_vt _ <span class="keyword">=&gt;</span> false <span class="keyword">|</span> None_vt _ <span class="keyword">=&gt;</span> true</span>
<span class="comment">// end of [option_is_none]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
option_vt_unsome
  <span class="keyword">(</span>opt<span class="keyword">)</span> <span class="keyword">=</span> x <span class="keyword">where</span> <span class="keyword">{</span> <span class="dynexp"><span class="keyword">val+</span> <span class="keyword">~</span>Some_vt <span class="keyword">(</span>x<span class="keyword">)</span> <span class="keyword">=</span> opt</span> <span class="keyword">}</span></span>
<span class="comment">// end of [option_unsome]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
option_vt_unnone
  <span class="keyword">(</span>opt<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">where</span> <span class="keyword">{</span> <span class="dynexp"><span class="keyword">val+</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> opt</span> <span class="keyword">}</span></span>
<span class="comment">// end of [option_unnone]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
option_vt_free <span class="keyword">(</span>opt<span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
<span class="keyword">case+</span> opt <span class="keyword">of</span> <span class="keyword">~</span>Some_vt _ <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">)</span></span> <span class="comment">// end of [option_vt_free]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
fprint_option_vt
  <span class="keyword">(</span>out<span class="keyword">,</span> opt<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">case+</span> opt <span class="keyword">of</span>
<span class="keyword">|</span> <span class="keyword">@</span>Some_vt <span class="keyword">(</span>x<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">{</span>
    <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span>
    <span class="keyword">)</span> <span class="keyword">=</span> fprint_string <span class="keyword">(</span>out<span class="keyword">,</span> <span class="dynstr">"Some_vt("</span><span class="keyword">)</span></span>
    <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fprint_ref&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">,</span> x<span class="keyword">)</span></span>
    <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fprint_string <span class="keyword">(</span>out<span class="keyword">,</span> <span class="dynstr">")"</span><span class="keyword">)</span></span>
    <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">fold@</span> <span class="keyword">(</span>opt<span class="keyword">)</span></span>
  <span class="keyword">}</span> <span class="comment">(* end of [Some_vt] *)</span>
<span class="keyword">|</span> None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">{</span>
    <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fprint_string <span class="keyword">(</span>out<span class="keyword">,</span> <span class="dynstr">"None_vt()"</span><span class="keyword">)</span></span>
  <span class="keyword">}</span> <span class="comment">(* end of [None_vt] *)</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [fprint_option_vt]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* end of [option_vt.dats] *)</span>
</pre>
<pre class="patsyntax">
<span class="comment">(***********************************************************************)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(*                         Applied Type System                         *)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(***********************************************************************)</span>

<span class="comment">(*
** ATS/Postiats - Unleashing the Potential of Types!
** Copyright (C) 2010-2015 Hongwei Xi, ATS Trustful Software, Inc.
** All rights reserved
**
** ATS is free software;  you can  redistribute it and/or modify it under
** the terms of  the GNU GENERAL PUBLIC LICENSE (GPL) as published by the
** Free Software Foundation; either version 3, or (at  your  option)  any
** later version.
**
** ATS is distributed in the hope that it will be useful, but WITHOUT ANY
** WARRANTY; without  even  the  implied  warranty  of MERCHANTABILITY or
** FITNESS FOR A PARTICULAR PURPOSE.  See the  GNU General Public License
** for more details.
**
** You  should  have  received  a  copy of the GNU General Public License
** along  with  ATS;  see the  file COPYING.  If not, please write to the
** Free Software Foundation,  51 Franklin Street, Fifth Floor, Boston, MA
** 02110-1301, USA.
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* Author: Hongwei Xi *)</span>
<span class="comment">(* Authoremail: gmhwxiATgmailDOTcom *)</span>
<span class="comment">(* Start time: July, 2012 *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
** Source:
** $PATSHOME/prelude/DATS/CODEGEN/list.atxt
** Time of generation: Sun Oct 23 12:48:39 2016
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">staload</span> UN <span class="keyword">=</span> "prelude/SATS/unsafe.sats"

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
stream_sing<span class="keyword">(</span>x<span class="keyword">)</span> <span class="keyword">=</span>
  stream_cons<span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="keyword">(</span>x<span class="keyword">,</span> <span class="dynexp"><span class="keyword">$delay</span><span class="keyword">(</span>stream_nil<span class="keyword">)</span></span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
stream_is_nil<span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
<span class="keyword">case+</span> <span class="keyword">!</span>xs <span class="keyword">of</span>
<span class="keyword">|</span> stream_nil _ <span class="keyword">=&gt;</span> true <span class="keyword">|</span> stream_cons _ <span class="keyword">=&gt;</span> false
<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
stream_is_cons<span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span> not<span class="keyword">(</span>stream_is_nil&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>xs<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
stream_make_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span>
  <span class="dynexp"><span class="keyword">$delay</span><span class="keyword">(</span>stream_nil<span class="keyword">{</span>a<span class="keyword">}</span><span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span></span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
stream_make_sing<span class="keyword">(</span>x<span class="keyword">)</span> <span class="keyword">=</span>
  <span class="dynexp"><span class="keyword">$delay</span><span class="keyword">(</span>stream_cons<span class="keyword">{</span>a<span class="keyword">}</span><span class="keyword">(</span>x<span class="keyword">,</span> <span class="keyword">$delay</span><span class="keyword">(</span>stream_nil<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span></span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
stream2list <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> loop
<span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span>
<span class="keyword">,</span> res<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">ptr</span><span class="staexp">?</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">List0_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="keyword">in</span>
  <span class="keyword">case+</span> <span class="keyword">!</span>xs <span class="keyword">of</span>
  <span class="keyword">|</span> stream_cons
      <span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span>
      res := list_vt_cons<span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>0<span class="keyword">}</span></span><span class="keyword">(</span>x<span class="keyword">,</span> _<span class="keyword">)</span></span>
      <span class="dynexp"><span class="keyword">val+</span>list_vt_cons <span class="keyword">(</span>_<span class="keyword">,</span> res1<span class="keyword">)</span> <span class="keyword">=</span> res</span>
      <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span> <span class="keyword">=</span> loop <span class="keyword">(</span>xs<span class="keyword">,</span> res1<span class="keyword">)</span></span>
    <span class="keyword">in</span>
      <span class="keyword">fold@</span> <span class="keyword">(</span>res<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [stream_cons]</span>
  <span class="keyword">|</span> stream_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> res := list_vt_nil<span class="comment">(*void*)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [loop]</span>
<span class="keyword">var</span> res<span class="keyword">:</span> <span class="staexp">ptr</span> <span class="comment">// uninitialized</span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">$effmask_all</span> <span class="keyword">(</span>loop <span class="keyword">(</span>xs<span class="keyword">,</span> res<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  res
<span class="keyword">end</span></span> <span class="comment">// end of [stream2list]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
stream_length
  <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span> loop<span class="keyword">(</span>xs<span class="keyword">,</span> <span class="dynexp">0</span><span class="keyword">)</span> <span class="keyword">where</span>
<span class="keyword">{</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
loop
<span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> j<span class="keyword">:</span> <span class="staexp">intGte</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">laz</span><span class="keyword">&gt;</span> <span class="staexp">intGte</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
<span class="keyword">case+</span> <span class="keyword">!</span>xs <span class="keyword">of</span>
<span class="keyword">|</span> stream_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> j
<span class="keyword">|</span> stream_cons<span class="keyword">(</span>_<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span> loop<span class="keyword">(</span>xs<span class="keyword">,</span> j+<span class="dynexp">1</span><span class="keyword">)</span>
<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">}</span></span> <span class="comment">(* end of [stream_length] *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
stream_head_exn<span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
<span class="comment">//</span>
<span class="keyword">case+</span> <span class="keyword">!</span>xs <span class="keyword">of</span>
<span class="keyword">|</span> stream_cons
    <span class="keyword">(</span>x<span class="keyword">,</span> _<span class="keyword">)</span> <span class="keyword">=&gt;</span> x
  <span class="comment">// stream_cons</span>
<span class="keyword">|</span> stream_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="dynexp"><span class="keyword">$raise</span> StreamSubscriptExn<span class="keyword">(</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">)</span></span> <span class="comment">// end of [stream_head_exn]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
stream_tail_exn<span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
<span class="comment">//</span>
<span class="keyword">case+</span> <span class="keyword">!</span>xs <span class="keyword">of</span>
<span class="keyword">|</span> stream_cons
    <span class="keyword">(</span>_<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span> xs
  <span class="comment">// stream_cons</span>
<span class="keyword">|</span> stream_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="dynexp"><span class="keyword">$raise</span> StreamSubscriptExn<span class="keyword">(</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">)</span></span> <span class="comment">// end of [stream_tail_exn]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
stream_nth_exn
  <span class="keyword">(</span>xs<span class="keyword">,</span> n<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="keyword">in</span>
  <span class="keyword">case+</span> <span class="keyword">!</span>xs <span class="keyword">of</span>
  <span class="keyword">|</span> stream_cons
      <span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span>
    <span class="keyword">(</span>
      <span class="keyword">if</span> n <span class="keyword">&gt;</span> <span class="dynexp">0</span>
        <span class="keyword">then</span> stream_nth_exn&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>xs<span class="keyword">,</span> pred<span class="keyword">(</span>n<span class="keyword">)</span><span class="keyword">)</span>
        <span class="keyword">else</span> <span class="keyword">(</span>x<span class="keyword">)</span>
      <span class="comment">// end of [if]</span>
    <span class="keyword">)</span> <span class="comment">(* stream_cons *)</span>
  <span class="keyword">|</span> stream_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="dynexp"><span class="keyword">$raise</span> StreamSubscriptExn<span class="keyword">(</span><span class="keyword">)</span></span>
<span class="keyword">end</span></span> <span class="comment">// end of [stream_nth_exn]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
stream_nth_opt
  <span class="keyword">(</span>xs<span class="keyword">,</span> n<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">try</span>
Some_vt<span class="keyword">(</span>stream_nth_exn&lt;a<span class="keyword">&gt;</span><span class="keyword">(</span>xs<span class="keyword">,</span> n<span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">with</span> <span class="keyword">~</span>StreamSubscriptExn<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> None_vt<span class="keyword">(</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [stream_nth_opt]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
stream_get_at_exn<span class="keyword">(</span>xs<span class="keyword">,</span> n<span class="keyword">)</span> <span class="keyword">=</span> stream_nth_exn&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>xs<span class="keyword">,</span> n<span class="keyword">)</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
stream_takeLte
  <span class="keyword">(</span>xs<span class="keyword">,</span> n<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
auxmain
<span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span>
<span class="keyword">,</span> n0<span class="keyword">:</span> <span class="staexp">intGte</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="dynexp"><span class="keyword">$ldelay</span>
<span class="keyword">(</span>
<span class="keyword">if</span>
<span class="keyword">(</span>n0 <span class="keyword">&gt;</span> 0<span class="keyword">)</span>
<span class="keyword">then</span>
<span class="keyword">(</span>
<span class="keyword">case+</span> <span class="keyword">!</span>xs <span class="keyword">of</span>
<span class="keyword">|</span> stream_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span>
    stream_vt_nil<span class="keyword">(</span><span class="keyword">)</span>
  <span class="comment">// end of [stream_nil]</span>
<span class="keyword">|</span> stream_cons<span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span>
    stream_vt_cons<span class="keyword">(</span>x<span class="keyword">,</span> auxmain<span class="keyword">(</span>xs<span class="keyword">,</span> n0-1<span class="keyword">)</span><span class="keyword">)</span>
  <span class="comment">// end of [stream_cons]</span>
<span class="keyword">)</span>
<span class="keyword">else</span> stream_vt_nil<span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">)</span></span></span> <span class="comment">(* end of [auxmain] *)</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  auxmain<span class="keyword">(</span>xs<span class="keyword">,</span> n<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [stream_takeLte]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
stream_take_exn
  <span class="keyword">(</span>xs<span class="keyword">,</span> n<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
loop<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>nat<span class="keyword">}</span></span>
<span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span>
<span class="keyword">,</span> res<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">ptr</span><span class="staexp">?</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">list_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="staexp">-</span><span class="staexp">k</span><span class="keyword">)</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp"><span class="keyword">#[</span>k<span class="keyword">:</span>nat <span class="keyword">|</span> k &lt;= n<span class="keyword">]</span></span> <span class="staexp">int</span> <span class="staexp">k</span> <span class="keyword">=</span>
<span class="keyword">(</span>
<span class="comment">//</span>
<span class="keyword">if</span>
<span class="keyword">(</span>n <span class="keyword">&gt;</span> <span class="dynexp">0</span><span class="keyword">)</span>
<span class="keyword">then</span> <span class="keyword">(</span>
  <span class="keyword">case+</span> <span class="keyword">!</span>xs <span class="keyword">of</span>
  <span class="keyword">|</span> stream_cons
      <span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span> k <span class="keyword">where</span>
    <span class="keyword">{</span>
      <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span>
      res := list_vt_cons<span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>0<span class="keyword">}</span></span><span class="keyword">(</span>x<span class="keyword">,</span> _<span class="keyword">)</span></span>
      <span class="dynexp"><span class="keyword">val+</span>list_vt_cons <span class="keyword">(</span>_<span class="keyword">,</span> res1<span class="keyword">)</span> <span class="keyword">=</span> res</span>
      <span class="dynexp"><span class="keyword">val</span> k <span class="keyword">=</span> loop <span class="keyword">(</span>xs<span class="keyword">,</span> res1<span class="keyword">,</span> pred<span class="keyword">(</span>n<span class="keyword">)</span><span class="keyword">)</span></span>
      <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">fold@</span> <span class="keyword">(</span>res<span class="keyword">)</span></span>
    <span class="keyword">}</span> <span class="comment">(* end of [stream_cons] *)</span>
  <span class="keyword">|</span> stream_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span>
        res := list_vt_nil<span class="keyword">(</span><span class="keyword">)</span></span> <span class="keyword">in</span> n
      <span class="comment">// end of [val]</span>
    <span class="keyword">end</span> <span class="comment">// end of [stream_nil]</span>
<span class="keyword">)</span> <span class="keyword">else</span> <span class="keyword">(</span>
  <span class="keyword">let</span> <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> res := list_vt_nil<span class="keyword">(</span><span class="keyword">)</span></span> <span class="keyword">in</span> n <span class="keyword">end</span>
<span class="keyword">)</span> <span class="comment">(* end of [if] *)</span>
<span class="comment">//</span>
<span class="keyword">)</span></span> <span class="comment">(* end of [loop] *)</span>
<span class="comment">//</span>
<span class="keyword">var</span> res<span class="keyword">:</span> <span class="staexp">ptr</span> <span class="comment">// uninitialized</span>
<span class="dynexp"><span class="keyword">val</span> k <span class="keyword">=</span> <span class="keyword">$effmask_all</span> <span class="keyword">(</span>loop <span class="keyword">(</span>xs<span class="keyword">,</span> res<span class="keyword">,</span> n<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">$effmask_all</span> <span class="keyword">(</span>
<span class="keyword">if</span> k <span class="keyword">=</span> <span class="dynexp">0</span> <span class="keyword">then</span> res <span class="keyword">else</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> list_vt_free <span class="keyword">(</span>res<span class="keyword">)</span></span> <span class="keyword">in</span> <span class="dynexp"><span class="keyword">$raise</span> StreamSubscriptExn<span class="keyword">(</span><span class="keyword">)</span></span>
<span class="keyword">end</span> <span class="comment">// end of [if]</span>
<span class="keyword">)</span> <span class="comment">// end of [$effmask_all]</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [stream_take_exn]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
stream_drop_exn
  <span class="keyword">(</span>xs<span class="keyword">,</span> n<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
aux<span class="keyword">:</span>
<span class="staexp"><span class="keyword">$d2ctype</span>
<span class="keyword">(</span>
stream_drop_exn&lt;a<span class="keyword">&gt;</span>
<span class="keyword">)</span></span> <span class="keyword">=</span>
<span class="keyword">lam</span><span class="keyword">(</span>xs<span class="keyword">,</span> n<span class="keyword">)</span> <span class="keyword">=&gt;</span> 
<span class="keyword">(</span>
<span class="comment">//</span>
<span class="keyword">if</span> n <span class="keyword">&gt;</span> <span class="dynexp">0</span> <span class="keyword">then</span>
<span class="keyword">(</span>
  <span class="keyword">case+</span> <span class="keyword">!</span>xs <span class="keyword">of</span>
  <span class="keyword">|</span> stream_cons
      <span class="keyword">(</span>_<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span> aux<span class="keyword">(</span>xs<span class="keyword">,</span> pred<span class="keyword">(</span>n<span class="keyword">)</span><span class="keyword">)</span>
    <span class="comment">// stream_cons</span>
  <span class="keyword">|</span> stream_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="dynexp"><span class="keyword">$raise</span> StreamSubscriptExn<span class="keyword">(</span><span class="keyword">)</span></span>
<span class="keyword">)</span> <span class="keyword">else</span> <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="comment">// end of [if]</span>
<span class="comment">//</span>
<span class="keyword">)</span></span> <span class="comment">(* end of [aux] *)</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  aux<span class="keyword">(</span>xs<span class="keyword">,</span> n<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [stream_drop_exn]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
stream_drop_opt
  <span class="keyword">(</span>xs<span class="keyword">,</span> n<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="dynexp"><span class="keyword">fun</span>
aux<span class="keyword">:</span>
<span class="staexp"><span class="keyword">$d2ctype</span>
<span class="keyword">(</span>
stream_drop_opt&lt;a<span class="keyword">&gt;</span>
<span class="keyword">)</span></span> <span class="keyword">=</span>
<span class="keyword">lam</span><span class="keyword">(</span>xs<span class="keyword">,</span> n<span class="keyword">)</span> <span class="keyword">=&gt;</span>
<span class="keyword">(</span>
<span class="comment">//</span>
<span class="keyword">if</span> n <span class="keyword">&gt;</span> <span class="dynexp">0</span> <span class="keyword">then</span>
<span class="keyword">(</span>
  <span class="keyword">case+</span> <span class="keyword">!</span>xs <span class="keyword">of</span>
  <span class="keyword">|</span> stream_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> None_vt<span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">|</span> stream_cons<span class="keyword">(</span>_<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span> aux<span class="keyword">(</span>xs<span class="keyword">,</span> pred<span class="keyword">(</span>n<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">else</span> Some_vt<span class="keyword">(</span>xs<span class="keyword">)</span> <span class="comment">// end of [if]</span>
<span class="comment">//</span>
<span class="keyword">)</span></span> <span class="comment">(* end of [aux] *)</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  aux<span class="keyword">(</span>xs<span class="keyword">,</span> n<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [stream_drop_opt]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
stream_append
  <span class="keyword">(</span>xs<span class="keyword">,</span> ys<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> aux
<span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span>
<span class="keyword">,</span> ys<span class="keyword">:</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">stream_con</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span> <span class="keyword">=</span>
  <span class="keyword">case+</span> <span class="keyword">!</span>xs <span class="keyword">of</span>
  <span class="keyword">|</span> stream_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">!</span>ys
  <span class="keyword">|</span> stream_cons<span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span> stream_cons<span class="keyword">(</span>x<span class="keyword">,</span> <span class="dynexp"><span class="keyword">$delay</span><span class="keyword">(</span>aux<span class="keyword">(</span>xs<span class="keyword">,</span> ys<span class="keyword">)</span><span class="keyword">)</span></span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
<span class="comment">//</span>
  <span class="dynexp"><span class="keyword">$delay</span><span class="keyword">(</span>aux<span class="keyword">(</span>xs<span class="keyword">,</span> ys<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [stream_append]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
stream_concat
  <span class="keyword">(</span>xss<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> aux1
<span class="keyword">(</span>
  xss<span class="keyword">:</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">stream_con</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
  <span class="keyword">case+</span> <span class="keyword">!</span>xss <span class="keyword">of</span>
  <span class="keyword">|</span> stream_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> stream_nil<span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">|</span> stream_cons<span class="keyword">(</span>xs<span class="keyword">,</span> xss<span class="keyword">)</span> <span class="keyword">=&gt;</span> aux2<span class="keyword">(</span>xs<span class="keyword">,</span> xss<span class="keyword">)</span>
<span class="keyword">)</span>
<span class="keyword">and</span> aux2
<span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> xss<span class="keyword">:</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">stream_con</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span> <span class="keyword">=</span>
  <span class="keyword">case+</span> <span class="keyword">!</span>xs <span class="keyword">of</span>
  <span class="keyword">|</span> stream_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> aux1 <span class="keyword">(</span>xss<span class="keyword">)</span>
  <span class="keyword">|</span> stream_cons<span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span> stream_cons <span class="keyword">(</span>x<span class="keyword">,</span> <span class="dynexp"><span class="keyword">$delay</span><span class="keyword">(</span>aux2<span class="keyword">(</span>xs<span class="keyword">,</span> xss<span class="keyword">)</span><span class="keyword">)</span></span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  <span class="dynexp"><span class="keyword">$delay</span><span class="keyword">(</span>aux1<span class="keyword">(</span>xss<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="keyword">end</span></span> <span class="comment">// end of [stream_concat]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">local</span>

<span class="dynexp"><span class="keyword">fun</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>t0p<span class="keyword">}</span></span>
stream_filter_con
<span class="keyword">(</span>
xs<span class="keyword">:</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">stream_con</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">case+</span> <span class="keyword">!</span>xs <span class="keyword">of</span>
<span class="keyword">|</span> stream_cons
    <span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span>
  <span class="keyword">(</span>
    <span class="keyword">if</span> stream_filter$pred&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>x<span class="keyword">)</span>
      <span class="keyword">then</span> stream_cons<span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="keyword">(</span>x<span class="keyword">,</span> stream_filter&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>xs<span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">else</span> stream_filter_con&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>xs<span class="keyword">)</span>
    <span class="comment">// end of [if]</span>
  <span class="keyword">)</span> <span class="comment">// end of [stream_cons]</span>
<span class="keyword">|</span> stream_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> stream_nil<span class="keyword">(</span><span class="keyword">)</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [stream_filter_con]</span>

<span class="keyword">in</span> <span class="comment">(* in of [local] *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
stream_filter <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span>
  <span class="dynexp"><span class="keyword">$delay</span><span class="keyword">(</span>stream_filter_con&lt;a<span class="keyword">&gt;</span><span class="keyword">(</span>xs<span class="keyword">)</span><span class="keyword">)</span></span></span>
<span class="comment">// end of [stream_filter]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
stream_filter_fun
  <span class="keyword">(</span>xs<span class="keyword">,</span> p<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">a2</span><span class="keyword">}</span>
stream_filter$pred <span class="keyword">(</span>x<span class="keyword">)</span> <span class="keyword">=</span> p<span class="keyword">(</span>$UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="keyword">(</span>x<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  stream_filter <span class="keyword">(</span>xs<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [stream_filter_fun]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
stream_filter_cloref <span class="keyword">(</span>xs<span class="keyword">,</span> p<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">a2</span><span class="keyword">}</span>
stream_filter$pred <span class="keyword">(</span>x<span class="keyword">)</span> <span class="keyword">=</span> p<span class="keyword">(</span>$UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="keyword">(</span>x<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  stream_filter <span class="keyword">(</span>xs<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [stream_filter_cloref]</span>

<span class="keyword">end</span> <span class="comment">// end of [local]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">b</span><span class="keyword">}</span>
stream_map
  <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> aux
<span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp">stream</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">laz</span><span class="keyword">&gt;</span> <span class="staexp">stream</span> <span class="keyword">(</span><span class="staexp">b</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="dynexp"><span class="keyword">$delay</span>
<span class="keyword">(</span>
<span class="keyword">case+</span> <span class="keyword">!</span>xs <span class="keyword">of</span>
<span class="keyword">|</span> stream_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> stream_nil<span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">|</span> stream_cons<span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span>
    stream_cons<span class="keyword">{</span>b<span class="keyword">}</span><span class="keyword">(</span>stream_map$fopr&lt;a<span class="keyword">&gt;&lt;</span>b<span class="keyword">&gt;</span><span class="keyword">(</span>x<span class="keyword">)</span><span class="keyword">,</span> aux<span class="keyword">(</span>xs<span class="keyword">)</span><span class="keyword">)</span>
  <span class="comment">// end of [stream_cons]</span>
<span class="keyword">)</span> <span class="keyword">:</span> stream_con <span class="keyword">(</span>b<span class="keyword">)</span></span></span> <span class="comment">// end of [$delay]</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  aux <span class="keyword">(</span>xs<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [stream_map]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">b</span><span class="keyword">}</span>
stream_map_fun
  <span class="keyword">(</span>xs<span class="keyword">,</span> f<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a2</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">b2</span><span class="keyword">}</span>
stream_map$fopr <span class="keyword">(</span>x<span class="keyword">)</span> <span class="keyword">=</span> $UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>b2<span class="keyword">}</span></span><span class="keyword">(</span>f<span class="keyword">(</span>$UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="keyword">(</span>x<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  stream_map&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">b</span><span class="keyword">&gt;</span><span class="keyword">(</span>xs<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [stream_map_fun]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">b</span><span class="keyword">}</span>
stream_map_cloref
  <span class="keyword">(</span>xs<span class="keyword">,</span> f<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a2</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">b2</span><span class="keyword">}</span>
stream_map$fopr <span class="keyword">(</span>x<span class="keyword">)</span> <span class="keyword">=</span> $UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>b2<span class="keyword">}</span></span><span class="keyword">(</span>f<span class="keyword">(</span>$UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="keyword">(</span>x<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  stream_map&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">b</span><span class="keyword">&gt;</span><span class="keyword">(</span>xs<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [stream_map_cloref]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">b</span><span class="keyword">}</span>
stream_imap
  <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> aux
<span class="keyword">(</span>
  i<span class="keyword">:</span> <span class="staexp">intGte</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span><span class="keyword">,</span> xs<span class="keyword">:</span> <span class="staexp">stream</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">laz</span><span class="keyword">&gt;</span> <span class="staexp">stream</span> <span class="keyword">(</span><span class="staexp">b</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="dynexp"><span class="keyword">$delay</span>
<span class="keyword">(</span>
<span class="keyword">case+</span> <span class="keyword">!</span>xs <span class="keyword">of</span>
<span class="keyword">|</span> stream_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> stream_nil<span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">|</span> stream_cons
    <span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
    <span class="keyword">val</span> y <span class="keyword">=</span>
      stream_imap$fopr&lt;a<span class="keyword">&gt;&lt;</span>b<span class="keyword">&gt;</span><span class="keyword">(</span>i<span class="keyword">,</span> x<span class="keyword">)</span>
    <span class="comment">// end of [val]</span>
  <span class="keyword">in</span>
    stream_cons<span class="keyword">{</span>b<span class="keyword">}</span><span class="keyword">(</span>y<span class="keyword">,</span> aux<span class="keyword">(</span>succ<span class="keyword">(</span>i<span class="keyword">)</span><span class="keyword">,</span> xs<span class="keyword">)</span><span class="keyword">)</span>
  <span class="keyword">end</span> <span class="comment">// end of [stream_cons]</span>
<span class="keyword">)</span> <span class="keyword">:</span> stream_con <span class="keyword">(</span>b<span class="keyword">)</span></span></span> <span class="comment">// end of [$delay]</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  aux <span class="keyword">(</span><span class="dynexp">0</span><span class="keyword">,</span> xs<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [stream_imap]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">b</span><span class="keyword">}</span>
stream_imap_fun
  <span class="keyword">(</span>xs<span class="keyword">,</span> f<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a2</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">b2</span><span class="keyword">}</span>
stream_imap$fopr
  <span class="keyword">(</span>i<span class="keyword">,</span> x<span class="keyword">)</span> <span class="keyword">=</span> $UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>b2<span class="keyword">}</span></span><span class="keyword">(</span>f<span class="keyword">(</span>i<span class="keyword">,</span> $UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="keyword">(</span>x<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  stream_imap&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">b</span><span class="keyword">&gt;</span><span class="keyword">(</span>xs<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [stream_imap_fun]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">b</span><span class="keyword">}</span>
stream_imap_cloref
  <span class="keyword">(</span>xs<span class="keyword">,</span> f<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a2</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">b2</span><span class="keyword">}</span>
stream_imap$fopr
  <span class="keyword">(</span>i<span class="keyword">,</span> x<span class="keyword">)</span> <span class="keyword">=</span> $UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>b2<span class="keyword">}</span></span><span class="keyword">(</span>f<span class="keyword">(</span>i<span class="keyword">,</span> $UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="keyword">(</span>x<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  stream_imap&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">b</span><span class="keyword">&gt;</span><span class="keyword">(</span>xs<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [stream_imap_cloref]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">local</span>

<span class="neuexp"><span class="keyword">#define</span> :: stream_cons</span>

<span class="keyword">in</span> <span class="comment">(* in of [local] *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a1<span class="keyword">,</span>a2</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">b</span><span class="keyword">}</span>
stream_map2
<span class="keyword">(</span>
  xs1<span class="keyword">,</span> xs2
<span class="keyword">)</span> <span class="keyword">=</span> <span class="dynexp"><span class="keyword">$delay</span> <span class="keyword">(</span>
<span class="keyword">(</span>
<span class="keyword">case+</span> <span class="keyword">!</span>xs1 <span class="keyword">of</span>
<span class="keyword">|</span> x1 :: xs1 <span class="keyword">=&gt;</span>
  <span class="keyword">(</span>
  <span class="keyword">case+</span> <span class="keyword">!</span>xs2 <span class="keyword">of</span>
  <span class="keyword">|</span> x2 :: xs2 <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> y <span class="keyword">=</span>
        stream_map2$fopr&lt;a1<span class="keyword">,</span>a2<span class="keyword">&gt;&lt;</span>b<span class="keyword">&gt;</span><span class="keyword">(</span>x1<span class="keyword">,</span> x2<span class="keyword">)</span>
      <span class="comment">// end of [val]</span>
    <span class="keyword">in</span>
      stream_cons<span class="keyword">{</span>b<span class="keyword">}</span><span class="keyword">(</span>y<span class="keyword">,</span> stream_map2&lt;a1<span class="keyword">,</span>a2<span class="keyword">&gt;&lt;</span>b<span class="keyword">&gt;</span><span class="keyword">(</span>xs1<span class="keyword">,</span> xs2<span class="keyword">)</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [::]</span>
  <span class="keyword">|</span> stream_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> stream_nil<span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">)</span> <span class="comment">// end of [::]</span>
<span class="keyword">|</span> stream_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> stream_nil<span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> stream_con <span class="keyword">(</span>b<span class="keyword">)</span>
<span class="keyword">)</span></span></span> <span class="comment">// end of [stream_map2]</span>

<span class="keyword">end</span> <span class="comment">// end of [local]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a1<span class="keyword">,</span>a2</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">b</span><span class="keyword">}</span>
stream_map2_fun
  <span class="keyword">(</span>xs1<span class="keyword">,</span> xs2<span class="keyword">,</span> f<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a12<span class="keyword">,</span>a22</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">b2</span><span class="keyword">}</span>
stream_map2$fopr <span class="keyword">(</span>x1<span class="keyword">,</span> x2<span class="keyword">)</span> <span class="keyword">=</span>
  $UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>b2<span class="keyword">}</span></span><span class="keyword">(</span>f<span class="keyword">(</span>$UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>a1<span class="keyword">}</span></span><span class="keyword">(</span>x1<span class="keyword">)</span><span class="keyword">,</span> $UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>a2<span class="keyword">}</span></span><span class="keyword">(</span>x2<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  stream_map2&lt;<span class="staexp">a1</span><span class="keyword">,</span><span class="staexp">a2</span><span class="keyword">&gt;&lt;</span><span class="staexp">b</span><span class="keyword">&gt;</span><span class="keyword">(</span>xs1<span class="keyword">,</span> xs2<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [stream_map2_fun]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a1<span class="keyword">,</span>a2</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">b</span><span class="keyword">}</span>
stream_map2_cloref
  <span class="keyword">(</span>xs1<span class="keyword">,</span> xs2<span class="keyword">,</span> f<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a12<span class="keyword">,</span>a22</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">b2</span><span class="keyword">}</span>
stream_map2$fopr <span class="keyword">(</span>x1<span class="keyword">,</span> x2<span class="keyword">)</span> <span class="keyword">=</span>
  $UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>b2<span class="keyword">}</span></span><span class="keyword">(</span>f<span class="keyword">(</span>$UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>a1<span class="keyword">}</span></span><span class="keyword">(</span>x1<span class="keyword">)</span><span class="keyword">,</span> $UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>a2<span class="keyword">}</span></span><span class="keyword">(</span>x2<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  stream_map2&lt;<span class="staexp">a1</span><span class="keyword">,</span><span class="staexp">a2</span><span class="keyword">&gt;&lt;</span><span class="staexp">b</span><span class="keyword">&gt;</span><span class="keyword">(</span>xs1<span class="keyword">,</span> xs2<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [stream_map2_cloref]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">res</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">x</span><span class="keyword">}</span>
stream_scan
  <span class="keyword">(</span>xs<span class="keyword">,</span> ini<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> aux
<span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">,</span> ini<span class="keyword">:</span> <span class="staexp">res</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">laz</span><span class="keyword">&gt;</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">res</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="dynexp"><span class="keyword">$delay</span>
<span class="keyword">(</span>
<span class="keyword">case+</span> <span class="keyword">!</span>xs <span class="keyword">of</span>
<span class="keyword">|</span> stream_nil
    <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> stream_nil<span class="keyword">(</span><span class="keyword">)</span>
  <span class="comment">// end of [stream_nil]</span>
<span class="keyword">|</span> stream_cons
    <span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span>
  stream_cons<span class="keyword">{</span>res<span class="keyword">}</span>
    <span class="keyword">(</span>stream_scan$fopr&lt;res<span class="keyword">&gt;&lt;</span>x<span class="keyword">&gt;</span><span class="keyword">(</span>ini<span class="keyword">,</span> x<span class="keyword">)</span><span class="keyword">,</span> aux<span class="keyword">(</span>xs<span class="keyword">,</span> ini<span class="keyword">)</span><span class="keyword">)</span>
  <span class="comment">// end of [stream_cons]</span>
<span class="keyword">)</span></span></span> <span class="comment">// end of [$delay] // end of [aux]</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  aux <span class="keyword">(</span>xs<span class="keyword">,</span> ini<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [stream_scan]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">res</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">x</span><span class="keyword">}</span>
stream_scan_fun
  <span class="keyword">(</span>xs<span class="keyword">,</span> ini<span class="keyword">,</span> f<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">res2</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">x2</span><span class="keyword">}</span>
stream_scan$fopr
  <span class="keyword">(</span>ini<span class="keyword">,</span> x<span class="keyword">)</span> <span class="keyword">=</span>
  $UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>res2<span class="keyword">}</span></span><span class="keyword">(</span>f<span class="keyword">(</span>$UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>res<span class="keyword">}</span></span><span class="keyword">(</span>ini<span class="keyword">)</span><span class="keyword">,</span> $UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>x<span class="keyword">}</span></span><span class="keyword">(</span>x<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  stream_scan&lt;<span class="staexp">res</span><span class="keyword">&gt;&lt;</span><span class="staexp">x</span><span class="keyword">&gt;</span><span class="keyword">(</span>xs<span class="keyword">,</span> ini<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [stream_scan_fun]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">res</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">x</span><span class="keyword">}</span>
stream_scan_cloref
  <span class="keyword">(</span>xs<span class="keyword">,</span> ini<span class="keyword">,</span> f<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">res2</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">x2</span><span class="keyword">}</span>
stream_scan$fopr
  <span class="keyword">(</span>ini<span class="keyword">,</span> x<span class="keyword">)</span> <span class="keyword">=</span>
  $UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>res2<span class="keyword">}</span></span><span class="keyword">(</span>f<span class="keyword">(</span>$UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>res<span class="keyword">}</span></span><span class="keyword">(</span>ini<span class="keyword">)</span><span class="keyword">,</span> $UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>x<span class="keyword">}</span></span><span class="keyword">(</span>x<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  stream_scan&lt;<span class="staexp">res</span><span class="keyword">&gt;&lt;</span><span class="staexp">x</span><span class="keyword">&gt;</span><span class="keyword">(</span>xs<span class="keyword">,</span> ini<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [stream_scan_cloref]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">local</span>

<span class="neuexp"><span class="keyword">#define</span> :: stream_cons</span>

<span class="keyword">in</span> <span class="comment">(* in of [local] *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
stream_merge
  <span class="keyword">(</span>xs10<span class="keyword">,</span> xs20<span class="keyword">)</span> <span class="keyword">=</span> <span class="dynexp"><span class="keyword">$delay</span>
<span class="keyword">(</span>
<span class="keyword">(</span>
<span class="keyword">case+</span> <span class="keyword">!</span>xs10 <span class="keyword">of</span>
<span class="keyword">|</span> x1 :: xs1 <span class="keyword">=&gt;</span>
  <span class="keyword">(</span>
  <span class="keyword">case+</span> <span class="keyword">!</span>xs20 <span class="keyword">of</span>
  <span class="keyword">|</span> x2 :: xs2 <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> sgn <span class="keyword">=</span>
        stream_merge$cmp&lt;a<span class="keyword">&gt;</span><span class="keyword">(</span>x1<span class="keyword">,</span> x2<span class="keyword">)</span>
      <span class="comment">// end of [val]</span>
    <span class="keyword">in</span>
      <span class="keyword">if</span> sgn &lt;= 0 <span class="keyword">then</span>
        stream_cons<span class="keyword">{</span>a<span class="keyword">}</span><span class="keyword">(</span>x1<span class="keyword">,</span> stream_merge <span class="keyword">(</span>xs1<span class="keyword">,</span> xs20<span class="keyword">)</span><span class="keyword">)</span>
      <span class="keyword">else</span>
        stream_cons<span class="keyword">{</span>a<span class="keyword">}</span><span class="keyword">(</span>x2<span class="keyword">,</span> stream_merge <span class="keyword">(</span>xs10<span class="keyword">,</span> xs2<span class="keyword">)</span><span class="keyword">)</span>
      <span class="comment">// end of [if]</span>
    <span class="keyword">end</span> <span class="comment">// end of [::]</span>
  <span class="keyword">|</span> stream_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> stream_cons<span class="keyword">{</span>a<span class="keyword">}</span><span class="keyword">(</span>x1<span class="keyword">,</span> xs1<span class="keyword">)</span>
  <span class="keyword">)</span> <span class="comment">(* end of [::] *)</span>
<span class="keyword">|</span> stream_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">!</span>xs20
<span class="keyword">)</span> <span class="keyword">:</span> stream_con <span class="keyword">(</span>a<span class="keyword">)</span>
<span class="keyword">)</span></span></span> <span class="comment">// end of [stream_merge]</span>

<span class="keyword">end</span> <span class="comment">// end of [local]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
stream_merge_fun
  <span class="keyword">(</span>xs1<span class="keyword">,</span> xs2<span class="keyword">,</span> cmp<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">a2</span><span class="keyword">}</span>
stream_merge$cmp <span class="keyword">(</span>x1<span class="keyword">,</span> x2<span class="keyword">)</span> <span class="keyword">=</span>
  cmp <span class="keyword">(</span>$UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="keyword">(</span>x1<span class="keyword">)</span><span class="keyword">,</span> $UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="keyword">(</span>x2<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  stream_merge <span class="keyword">(</span>xs1<span class="keyword">,</span> xs2<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [stream_merge_fun]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
stream_merge_cloref
  <span class="keyword">(</span>xs1<span class="keyword">,</span> xs2<span class="keyword">,</span> cmp<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">a2</span><span class="keyword">}</span>
stream_merge$cmp <span class="keyword">(</span>x1<span class="keyword">,</span> x2<span class="keyword">)</span> <span class="keyword">=</span>
  cmp <span class="keyword">(</span>$UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="keyword">(</span>x1<span class="keyword">)</span><span class="keyword">,</span> $UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="keyword">(</span>x2<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  stream_merge <span class="keyword">(</span>xs1<span class="keyword">,</span> xs2<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [stream_merge_cloref]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
stream_merge$cmp
  <span class="keyword">(</span>x1<span class="keyword">,</span> x2<span class="keyword">)</span> <span class="keyword">=</span> gcompare_val_val&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>x1<span class="keyword">,</span> x2<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">local</span>

<span class="neuexp"><span class="keyword">#define</span> :: stream_cons</span>

<span class="keyword">in</span> <span class="comment">(* in of [local] *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
stream_mergeq
  <span class="keyword">(</span>xs10<span class="keyword">,</span> xs20<span class="keyword">)</span> <span class="keyword">=</span> <span class="dynexp"><span class="keyword">$delay</span>
<span class="keyword">(</span>
<span class="keyword">case+</span> <span class="keyword">!</span>xs10 <span class="keyword">of</span>
<span class="keyword">|</span> x1 :: xs1 <span class="keyword">=&gt;</span>
  <span class="keyword">(</span>
  <span class="keyword">case+</span> <span class="keyword">!</span>xs20 <span class="keyword">of</span>
  <span class="keyword">|</span> x2 :: xs2 <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> sgn <span class="keyword">=</span>
        stream_mergeq$cmp&lt;a<span class="keyword">&gt;</span><span class="keyword">(</span>x1<span class="keyword">,</span> x2<span class="keyword">)</span>
      <span class="comment">// end of [val]</span>
    <span class="keyword">in</span>
      <span class="keyword">if</span> sgn <span class="keyword">&lt;</span> 0 <span class="keyword">then</span>
        stream_cons<span class="keyword">{</span>a<span class="keyword">}</span><span class="keyword">(</span>x1<span class="keyword">,</span> stream_mergeq <span class="keyword">(</span>xs1<span class="keyword">,</span> xs20<span class="keyword">)</span><span class="keyword">)</span>
      <span class="keyword">else</span> <span class="keyword">if</span> sgn <span class="keyword">&gt;</span> 0 <span class="keyword">then</span>
        stream_cons<span class="keyword">{</span>a<span class="keyword">}</span><span class="keyword">(</span>x2<span class="keyword">,</span> stream_mergeq <span class="keyword">(</span>xs10<span class="keyword">,</span> xs2<span class="keyword">)</span><span class="keyword">)</span>
      <span class="keyword">else</span>
        stream_cons<span class="keyword">{</span>a<span class="keyword">}</span><span class="keyword">(</span>x1<span class="comment">(*=x2*)</span><span class="keyword">,</span> stream_mergeq <span class="keyword">(</span>xs1<span class="keyword">,</span> xs2<span class="keyword">)</span><span class="keyword">)</span>
      <span class="comment">// end of [if]</span>
    <span class="keyword">end</span> <span class="comment">// end of [::]</span>
  <span class="keyword">|</span> stream_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> stream_cons<span class="keyword">{</span>a<span class="keyword">}</span><span class="keyword">(</span>x1<span class="keyword">,</span> xs1<span class="keyword">)</span>
  <span class="keyword">)</span> <span class="comment">(* end of [::] *)</span>
<span class="keyword">|</span> stream_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">!</span>xs20
<span class="keyword">)</span></span></span> <span class="comment">// end of [stream_mergeq]</span>

<span class="keyword">end</span> <span class="comment">// end of [local]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
stream_mergeq_fun
  <span class="keyword">(</span>xs1<span class="keyword">,</span> xs2<span class="keyword">,</span> cmp<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">a2</span><span class="keyword">}</span>
stream_mergeq$cmp <span class="keyword">(</span>x1<span class="keyword">,</span> x2<span class="keyword">)</span> <span class="keyword">=</span>
  cmp <span class="keyword">(</span>$UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="keyword">(</span>x1<span class="keyword">)</span><span class="keyword">,</span> $UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="keyword">(</span>x2<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  stream_mergeq <span class="keyword">(</span>xs1<span class="keyword">,</span> xs2<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [stream_mergeq_fun]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
stream_mergeq_cloref
  <span class="keyword">(</span>xs1<span class="keyword">,</span> xs2<span class="keyword">,</span> cmp<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">a2</span><span class="keyword">}</span>
stream_mergeq$cmp <span class="keyword">(</span>x1<span class="keyword">,</span> x2<span class="keyword">)</span> <span class="keyword">=</span>
  cmp <span class="keyword">(</span>$UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="keyword">(</span>x1<span class="keyword">)</span><span class="keyword">,</span> $UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="keyword">(</span>x2<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  stream_mergeq <span class="keyword">(</span>xs1<span class="keyword">,</span> xs2<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [stream_mergeq_cloref]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
stream_mergeq$cmp
  <span class="keyword">(</span>x1<span class="keyword">,</span> x2<span class="keyword">)</span> <span class="keyword">=</span> gcompare_val_val&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>x1<span class="keyword">,</span> x2<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
stream_tabulate
  <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span> <span class="keyword">=</span>
  aux<span class="keyword">(</span><span class="dynexp">0</span><span class="keyword">)</span> <span class="keyword">where</span>
<span class="keyword">{</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
aux<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>nat<span class="keyword">}</span></span>
<span class="keyword">(</span>
  n<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="dynexp"><span class="keyword">$delay</span>
<span class="keyword">(</span>
stream_cons<span class="keyword">{</span>a<span class="keyword">}</span>
  <span class="keyword">(</span>stream_tabulate$fopr&lt;a<span class="keyword">&gt;</span><span class="keyword">(</span>n<span class="keyword">)</span><span class="keyword">,</span> aux<span class="keyword">(</span>n+1<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">)</span></span></span> <span class="comment">(* end of [aux] *)</span>
<span class="comment">//</span>
<span class="keyword">}</span></span> <span class="comment">(* end of [stream_tabulate] *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
stream_tabulate_fun
  <span class="keyword">(</span>fopr<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a2</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
stream_tabulate$fopr
  <span class="keyword">(</span>n<span class="keyword">)</span> <span class="keyword">=</span> $UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>a2<span class="keyword">}</span></span><span class="keyword">(</span>fopr<span class="keyword">(</span>n<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  stream_tabulate <span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [stream_tabulate_fun]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
stream_tabulate_cloref
  <span class="keyword">(</span>fopr<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a2</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
stream_tabulate$fopr
  <span class="keyword">(</span>n<span class="keyword">)</span> <span class="keyword">=</span> $UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>a2<span class="keyword">}</span></span><span class="keyword">(</span>fopr<span class="keyword">(</span>n<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  stream_tabulate <span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [stream_tabulate_cloref]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
stream_foreach
  <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">var</span> env<span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">in</span>
  stream_foreach_env&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">void</span><span class="keyword">&gt;</span><span class="keyword">(</span>xs<span class="keyword">,</span> env<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [stream_foreach]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">env</span><span class="keyword">}</span>
stream_foreach_env
  <span class="keyword">(</span>xs<span class="keyword">,</span> env<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> loop
<span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">env</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span>
<span class="keyword">(</span>
<span class="comment">//</span>
<span class="keyword">case+</span> <span class="keyword">!</span>xs <span class="keyword">of</span>
<span class="keyword">|</span> stream_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">|</span> stream_cons<span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
    <span class="dynexp"><span class="keyword">val</span> test <span class="keyword">=</span>
      stream_foreach$cont&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">env</span><span class="keyword">&gt;</span><span class="keyword">(</span>x<span class="keyword">,</span> env<span class="keyword">)</span></span>
    <span class="comment">// end of [val]</span>
  <span class="keyword">in</span>
    <span class="keyword">if</span> test
      <span class="keyword">then</span> <span class="keyword">let</span>
        <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span>
          stream_foreach$fwork&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">env</span><span class="keyword">&gt;</span><span class="keyword">(</span>x<span class="keyword">,</span> env<span class="keyword">)</span></span>
        <span class="comment">// end of [val]</span>
      <span class="keyword">in</span>
        loop <span class="keyword">(</span>xs<span class="keyword">,</span> env<span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [then]</span>
      <span class="keyword">else</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="comment">// end of [else]</span>
    <span class="comment">// end of [if]</span>
  <span class="keyword">end</span> <span class="comment">// end of [stream_cons]</span>
<span class="comment">//</span>
<span class="keyword">)</span></span> <span class="comment">(* end of [loop] *)</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  loop <span class="keyword">(</span>xs<span class="keyword">,</span> env<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">(* end of [stream_foreach_env] *)</span>

<span class="dynexp"><span class="keyword">implement</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span><span class="staexp">env</span><span class="keyword">)</span>
stream_foreach$cont&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">env</span><span class="keyword">&gt;</span><span class="keyword">(</span>x0<span class="keyword">,</span> env<span class="keyword">)</span> <span class="keyword">=</span> true</span><span class="comment">(*cont*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
stream_foreach_fun
  <span class="keyword">(</span>xs<span class="keyword">,</span> fwork<span class="keyword">)</span> <span class="keyword">=</span>
  loop<span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">where</span>
<span class="keyword">{</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
loop<span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span>
<span class="keyword">(</span>
  <span class="keyword">case+</span> <span class="keyword">!</span>xs <span class="keyword">of</span>
  <span class="keyword">|</span> stream_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">|</span> stream_cons<span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span>fwork<span class="keyword">(</span>x<span class="keyword">)</span><span class="keyword">;</span> loop<span class="keyword">(</span>xs<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">}</span></span> <span class="comment">(* end of [stream_foreach_fun] *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
stream_foreach_cloref
  <span class="keyword">(</span>xs<span class="keyword">,</span> fwork<span class="keyword">)</span> <span class="keyword">=</span>
  loop<span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">where</span>
<span class="keyword">{</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
loop<span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span>
<span class="keyword">(</span>
  <span class="keyword">case+</span> <span class="keyword">!</span>xs <span class="keyword">of</span>
  <span class="keyword">|</span> stream_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">|</span> stream_cons<span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span>fwork<span class="keyword">(</span>x<span class="keyword">)</span><span class="keyword">;</span> loop<span class="keyword">(</span>xs<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">}</span></span> <span class="comment">(* end of [stream_foreach_cloref] *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
fprint_stream
  <span class="keyword">(</span>out<span class="keyword">,</span> xs<span class="keyword">,</span> n<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="keyword">var</span> env<span class="keyword">:</span> <span class="staexp">int</span> <span class="keyword">=</span> <span class="dynexp">0</span>
<span class="keyword">typedef</span> <span class="staexp">tenv <span class="keyword">=</span> <span class="staexp">int</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
stream_foreach$cont&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">tenv</span><span class="keyword">&gt;</span>
  <span class="keyword">(</span>x<span class="keyword">,</span> env<span class="keyword">)</span> <span class="keyword">=</span>
  <span class="keyword">if</span> n <span class="keyword">&gt;</span> env <span class="keyword">then</span> true <span class="keyword">else</span> false</span>
<span class="dynexp"><span class="keyword">implement</span>
stream_foreach$fwork&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">tenv</span><span class="keyword">&gt;</span>
  <span class="keyword">(</span>x<span class="keyword">,</span> env<span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">{</span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span>
  <span class="keyword">if</span> env <span class="keyword">&gt;</span> <span class="dynexp">0</span>
    <span class="keyword">then</span> fprint_stream$sep&lt;<span class="keyword">&gt;</span><span class="keyword">(</span>out<span class="keyword">)</span></span>
  <span class="comment">// end of [if]</span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> env := env + <span class="dynexp">1</span></span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fprint_val&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>out<span class="keyword">,</span> x<span class="keyword">)</span></span>
<span class="keyword">}</span></span> <span class="comment">(* end of [stream_foreach$fwork] *)</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  stream_foreach_env&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">tenv</span><span class="keyword">&gt;</span><span class="keyword">(</span>xs<span class="keyword">,</span> env<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [fprint_stream]</span>

<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span>
fprint_stream$sep <span class="keyword">(</span>out<span class="keyword">)</span> <span class="keyword">=</span> fprint_string <span class="keyword">(</span>out<span class="keyword">,</span> <span class="dynstr">", "</span><span class="keyword">)</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* end of [stream.dats] *)</span>
</pre>
<pre class="patsyntax">
<span class="comment">(***********************************************************************)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(*                         Applied Type System                         *)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(***********************************************************************)</span>

<span class="comment">(*
** ATS/Postiats - Unleashing the Potential of Types!
** Copyright (C) 2010-2015 Hongwei Xi, ATS Trustful Software, Inc.
** All rights reserved
**
** ATS is free software;  you can  redistribute it and/or modify it under
** the terms of  the GNU GENERAL PUBLIC LICENSE (GPL) as published by the
** Free Software Foundation; either version 3, or (at  your  option)  any
** later version.
**
** ATS is distributed in the hope that it will be useful, but WITHOUT ANY
** WARRANTY; without  even  the  implied  warranty  of MERCHANTABILITY or
** FITNESS FOR A PARTICULAR PURPOSE.  See the  GNU General Public License
** for more details.
**
** You  should  have  received  a  copy of the GNU General Public License
** along  with  ATS;  see the  file COPYING.  If not, please write to the
** Free Software Foundation,  51 Franklin Street, Fifth Floor, Boston, MA
** 02110-1301, USA.
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* Author: Hongwei Xi *)</span>
<span class="comment">(* Authoremail: gmhwxiATgmailDOTcom *)</span>
<span class="comment">(* Start time: July, 2012 *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
** Source:
** $PATSHOME/prelude/DATS/CODEGEN/list.atxt
** Time of generation: Sun Oct 23 11:48:10 2016
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">staload</span> UN <span class="keyword">=</span> "prelude/SATS/unsafe.sats"

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
stream_vt_is_nil<span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
<span class="keyword">case+</span> <span class="keyword">!</span>xs <span class="keyword">of</span>
<span class="keyword">|</span> <span class="keyword">~</span>stream_vt_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> true
<span class="keyword">|</span> <span class="keyword">~</span>stream_vt_cons<span class="keyword">(</span>_<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">~</span>xs<span class="keyword">;</span> false<span class="keyword">)</span>
<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
stream_vt_is_cons<span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span>
  not<span class="keyword">(</span>stream_vt_is_nil&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>xs<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
stream_vt_make_nil
  <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="dynexp"><span class="keyword">$ldelay</span><span class="keyword">(</span>stream_vt_nil<span class="keyword">)</span></span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
stream_vt_make_cons<span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=</span>
<span class="dynexp"><span class="keyword">$ldelay</span><span class="keyword">(</span>
  stream_vt_cons<span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span><span class="keyword">,</span> <span class="keyword">$effmask_wrt</span><span class="keyword">(</span><span class="keyword">~</span>xs<span class="keyword">)</span>
<span class="keyword">)</span></span></span><span class="comment">(*$ldelay*)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
stream_vt_make_sing<span class="keyword">(</span>x<span class="keyword">)</span> <span class="keyword">=</span>
stream_vt_make_cons&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>x<span class="keyword">,</span> stream_vt_make_nil<span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
stream_vt_make_con<span class="keyword">(</span>xs_con<span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">$ldelay</span>
<span class="keyword">(</span>
  xs_con
<span class="keyword">,</span> <span class="keyword">$effmask_wrt</span><span class="keyword">(</span>stream_vt_con_free&lt;a<span class="keyword">&gt;</span><span class="keyword">(</span>xs_con<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">)</span></span> <span class="comment">(* end of [stream_vt_make_con] *)</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="comment">// HX-2014-04-07:</span>
<span class="comment">// This is a wild implementation!</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
stream_vt2t<span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
aux <span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">laz</span><span class="keyword">&gt;</span> <span class="staexp">stream</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> xs <span class="keyword">=</span> $UN<span class="keyword">.</span>castvwtp0<span class="staexp"><span class="keyword">{</span>ptr<span class="keyword">}</span></span><span class="keyword">(</span>xs<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">$delay</span>
<span class="keyword">(</span>
<span class="keyword">let</span>
  <span class="keyword">val</span> xs <span class="keyword">=</span>
    $UN<span class="keyword">.</span>castvwtp0<span class="keyword">{</span>stream_vt<span class="keyword">(</span>a<span class="keyword">)</span><span class="keyword">}</span><span class="keyword">(</span>xs<span class="keyword">)</span>
  <span class="keyword">val</span> xs_con <span class="keyword">=</span> <span class="keyword">!</span>xs
<span class="keyword">in</span>
  <span class="keyword">case+</span> xs_con <span class="keyword">of</span>
  <span class="keyword">|</span> <span class="keyword">~</span>stream_vt_nil
      <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> stream_nil<span class="comment">(*void*)</span>
    <span class="comment">// end of [stream_vt_nil]</span>
  <span class="keyword">|</span> <span class="keyword">@</span>stream_vt_cons
      <span class="keyword">(</span>x<span class="keyword">,</span> xs1<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> xs1_val <span class="keyword">=</span> xs1
      <span class="keyword">val</span> <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span>xs1 := aux <span class="keyword">(</span>xs1_val<span class="keyword">)</span><span class="keyword">)</span>
    <span class="keyword">in</span>
      $UN<span class="keyword">.</span>castvwtp0<span class="keyword">{</span>stream_con<span class="keyword">(</span>a<span class="keyword">)</span><span class="keyword">}</span><span class="keyword">(</span><span class="keyword">(</span><span class="keyword">view@</span>x<span class="keyword">,</span> <span class="keyword">view@</span>xs1 <span class="keyword">|</span> xs_con<span class="keyword">)</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [stream_cons]</span>
<span class="keyword">end</span>
<span class="keyword">)</span></span>
<span class="keyword">end</span></span> <span class="comment">// end of [aux]</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  aux <span class="keyword">(</span>xs<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [stream_vt2t]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">local</span>
<span class="comment">//</span>
<span class="comment">// HX-2012:</span>
<span class="comment">// casting stream_vt_cons to list_cons</span>
<span class="comment">//</span>
<span class="keyword">extern</span>
<span class="dynexp"><span class="keyword">castfn</span>
stream2list_vt_cons
  <span class="staexp"><span class="keyword">{</span>l0<span class="keyword">,</span>l1<span class="keyword">,</span>l2<span class="keyword">:</span>addr<span class="keyword">}</span></span>
<span class="keyword">(</span>
  <span class="staexp">stream_vt_cons_unfold</span> <span class="keyword">(</span><span class="staexp">l0</span><span class="keyword">,</span> <span class="staexp">l1</span><span class="keyword">,</span> <span class="staexp">l2</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">&gt;</span> <span class="staexp">list_vt_cons_unfold</span> <span class="keyword">(</span><span class="staexp">l0</span><span class="keyword">,</span> <span class="staexp">l1</span><span class="keyword">,</span> <span class="staexp">l2</span><span class="keyword">)</span></span>

<span class="keyword">in</span> <span class="comment">(* in-of-local *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
stream2list_vt<span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
loop <span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp">stream_vt</span> <span class="staexp">a</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">laz</span><span class="keyword">&gt;</span> <span class="staexp">List0_vt</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> xs_con <span class="keyword">=</span> <span class="keyword">!</span>xs</span>
<span class="keyword">in</span>
  <span class="keyword">case+</span> xs_con <span class="keyword">of</span>
  <span class="keyword">|</span> <span class="keyword">~</span>stream_vt_nil
      <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> list_vt_nil<span class="keyword">(</span><span class="keyword">)</span>
    <span class="comment">// end of [stream_vt_nil]</span>
  <span class="keyword">|</span> <span class="keyword">@</span>stream_vt_cons
      <span class="keyword">(</span>x<span class="keyword">,</span> xs1<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="dynexp"><span class="keyword">val</span> xs1_ <span class="keyword">=</span> xs1</span>
      <span class="dynexp"><span class="keyword">val</span> xs_con <span class="keyword">=</span>
        stream2list_vt_cons<span class="keyword">(</span>xs_con<span class="keyword">)</span></span>
      <span class="comment">// end of [val]</span>
      <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span>xs1 := loop<span class="keyword">(</span>xs1_<span class="keyword">)</span><span class="keyword">)</span></span>
    <span class="keyword">in</span>
      <span class="keyword">fold@</span> <span class="keyword">(</span>xs_con<span class="keyword">)</span><span class="keyword">;</span> xs_con
    <span class="keyword">end</span> <span class="comment">// end of [stream_vt_cons]</span>
<span class="keyword">end</span></span> <span class="comment">// end of [loop]</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  loop <span class="keyword">(</span>xs<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [stream2list_vt]</span>

<span class="keyword">end</span> <span class="comment">// end of [local]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
stream_vt_free<span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">~</span><span class="keyword">(</span>xs<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
stream_vt_con_free
  <span class="keyword">(</span>xs_con<span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
  <span class="keyword">case+</span> xs_con <span class="keyword">of</span>
  <span class="keyword">|</span> <span class="keyword">~</span>stream_vt_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">|</span> <span class="keyword">~</span>stream_vt_cons<span class="keyword">(</span>_<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">~</span>xs
<span class="keyword">)</span></span> <span class="comment">(* stream_vt_con_free *)</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
stream_vt_takeLte
  <span class="keyword">(</span>xs<span class="keyword">,</span> n<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
auxmain
<span class="keyword">(</span>
xs<span class="keyword">:</span>
<span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">intGte</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="dynexp"><span class="keyword">$ldelay</span><span class="keyword">(</span>
<span class="keyword">if</span>
<span class="keyword">(</span>n <span class="keyword">&gt;</span> 0<span class="keyword">)</span>
<span class="keyword">then</span> <span class="keyword">let</span>
  <span class="keyword">val</span> xs_con <span class="keyword">=</span> <span class="keyword">!</span>xs
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">case+</span> xs_con <span class="keyword">of</span>
<span class="keyword">|</span> <span class="keyword">~</span>stream_vt_nil
    <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> stream_vt_nil<span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">|</span> <span class="keyword">@</span>stream_vt_cons
    <span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
    <span class="keyword">val</span> <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span> <span class="keyword">=</span>
      xs := auxmain<span class="keyword">(</span>xs<span class="keyword">,</span> n-1<span class="keyword">)</span>
    <span class="comment">// end of [val]</span>
  <span class="keyword">in</span>
    <span class="keyword">fold@</span><span class="keyword">(</span>xs_con<span class="keyword">)</span><span class="keyword">;</span> xs_con
  <span class="keyword">end</span> <span class="comment">// end of [stream_vt_cons]</span>
<span class="comment">//</span>
<span class="keyword">end</span> <span class="comment">// end of [then]</span>
<span class="keyword">else</span> <span class="keyword">(</span><span class="keyword">~</span>xs<span class="keyword">;</span> stream_vt_nil<span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">,</span>
<span class="keyword">(</span><span class="keyword">~</span>xs<span class="keyword">)</span> <span class="comment">// for freeing the stream!</span>
<span class="keyword">)</span></span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  auxmain<span class="keyword">(</span>xs<span class="keyword">,</span> n<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [stream_vt_takeLte]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
implement
{a}(*tmp*)
stream_vt_dropLte
  (xs, n) = let
//
fun aux
  : $d2ctype(stream_vt_dropLte&lt;a&gt;) =
lam (xs, n) =&gt;
(
if
n &gt; 0
then (
case+ !xs of
| ~stream_vt_nil
    ((*void*)) =&gt; stream_vt_make_nil()
| ~stream_vt_cons(_, xs) =&gt; aux(xs, n-1)
) else (xs)
) (* end of [lam] *)
//
in
  aux (xs, n)
end // end of [stream_vt_dropLte]
*)</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
stream_vt_drop_exn
  <span class="keyword">(</span>xs<span class="keyword">,</span> n<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> aux
  <span class="keyword">:</span> <span class="staexp"><span class="keyword">$d2ctype</span><span class="keyword">(</span>stream_vt_drop_exn&lt;a<span class="keyword">&gt;</span><span class="keyword">)</span></span> <span class="keyword">=</span>
<span class="keyword">lam</span> <span class="keyword">(</span>xs<span class="keyword">,</span> n<span class="keyword">)</span> <span class="keyword">=&gt;</span>
<span class="keyword">(</span>
<span class="comment">//</span>
<span class="keyword">if</span>
n <span class="keyword">&gt;</span> <span class="dynexp">0</span>
<span class="keyword">then</span> <span class="keyword">(</span>
<span class="comment">//</span>
<span class="keyword">case+</span> <span class="keyword">!</span>xs <span class="keyword">of</span>
<span class="keyword">|</span> <span class="keyword">~</span>stream_vt_cons
    <span class="keyword">(</span>_<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span> aux<span class="keyword">(</span>xs<span class="keyword">,</span> n-<span class="dynexp">1</span><span class="keyword">)</span>
  <span class="comment">// end of [stream_vt_cons]</span>
<span class="keyword">|</span> <span class="keyword">~</span>stream_vt_nil
    <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="dynexp"><span class="keyword">$raise</span> StreamSubscriptExn<span class="keyword">(</span><span class="keyword">)</span></span>
  <span class="comment">// end of [stream_vt_nil]</span>
<span class="comment">//</span>
<span class="keyword">)</span> <span class="comment">(* end of [then] *)</span>
<span class="keyword">else</span> <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="comment">// end of [else]</span>
<span class="comment">//</span>
<span class="keyword">)</span></span> <span class="comment">(* end of [lam] *)</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  aux <span class="keyword">(</span>xs<span class="keyword">,</span> n<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [stream_vt_drop_exn]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
stream_vt_drop_opt
  <span class="keyword">(</span>xs<span class="keyword">,</span> n<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> aux
  <span class="keyword">:</span> <span class="staexp"><span class="keyword">$d2ctype</span><span class="keyword">(</span>stream_vt_drop_opt&lt;a<span class="keyword">&gt;</span><span class="keyword">)</span></span> <span class="keyword">=</span>
<span class="keyword">lam</span> <span class="keyword">(</span>xs<span class="keyword">,</span> n<span class="keyword">)</span> <span class="keyword">=&gt;</span>
<span class="keyword">(</span>
<span class="comment">//</span>
<span class="keyword">if</span>
n <span class="keyword">&gt;</span> <span class="dynexp">0</span>
<span class="keyword">then</span> <span class="keyword">(</span>
<span class="comment">//</span>
<span class="keyword">case+</span> <span class="keyword">!</span>xs <span class="keyword">of</span>
<span class="keyword">|</span> <span class="keyword">~</span>stream_vt_cons
    <span class="keyword">(</span>_<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span> aux<span class="keyword">(</span>xs<span class="keyword">,</span> n-<span class="dynexp">1</span><span class="keyword">)</span>
<span class="keyword">|</span> <span class="keyword">~</span>stream_vt_nil
    <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> None_vt<span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span>
<span class="comment">//</span>
<span class="keyword">)</span> <span class="comment">(* end of [then] *)</span>
<span class="keyword">else</span> Some_vt<span class="staexp"><span class="keyword">{</span>stream_vt<span class="keyword">(</span>a<span class="keyword">)</span><span class="keyword">}</span></span><span class="keyword">(</span>xs<span class="keyword">)</span> <span class="comment">// [else]</span>
<span class="comment">//</span>
<span class="keyword">)</span></span> <span class="comment">(* end of [lam] *)</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  aux <span class="keyword">(</span>xs<span class="keyword">,</span> n<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [stream_vt_drop_opt]</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
stream_vt_head_exn<span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
<span class="keyword">case+</span> <span class="keyword">!</span>xs <span class="keyword">of</span>
<span class="keyword">|</span> <span class="keyword">~</span>stream_vt_cons <span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span>
    <span class="keyword">let</span> <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> stream_vt_free<span class="keyword">(</span>xs<span class="keyword">)</span></span> <span class="keyword">in</span> x <span class="keyword">end</span>
<span class="keyword">|</span> <span class="keyword">~</span>stream_vt_nil <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="dynexp"><span class="keyword">$raise</span> StreamSubscriptExn<span class="keyword">(</span><span class="keyword">)</span></span>
<span class="keyword">)</span></span> <span class="comment">(* end of [stream_vt_head_exn] *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
stream_vt_tail_exn<span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
<span class="keyword">case+</span> <span class="keyword">!</span>xs <span class="keyword">of</span>
<span class="keyword">|</span> <span class="keyword">~</span>stream_vt_cons <span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span>xs<span class="keyword">)</span>
<span class="keyword">|</span> <span class="keyword">~</span>stream_vt_nil <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="dynexp"><span class="keyword">$raise</span> StreamSubscriptExn<span class="keyword">(</span><span class="keyword">)</span></span>
<span class="keyword">)</span></span> <span class="comment">(* end of [stream_vt_tail_exn] *)</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
stream_vt_uncons_exn<span class="keyword">(</span>xs0<span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
<span class="keyword">case+</span> <span class="keyword">!</span>xs0 <span class="keyword">of</span>
<span class="keyword">|</span> <span class="keyword">~</span>stream_vt_cons
    <span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span>xs0 := xs<span class="keyword">;</span> x<span class="keyword">)</span>
<span class="keyword">|</span> <span class="keyword">~</span>stream_vt_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
    <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span>
      xs0 := <span class="dynexp"><span class="keyword">$ldelay</span> <span class="keyword">(</span>stream_vt_nil<span class="keyword">)</span></span></span>
    <span class="comment">// end of [val]</span>
  <span class="keyword">in</span>
    <span class="dynexp"><span class="keyword">$raise</span> StreamSubscriptExn<span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span></span>
  <span class="keyword">end</span> <span class="comment">// end of [stream_vt_nil]</span>
<span class="keyword">)</span></span> <span class="comment">(* end of [stream_vt_uncons_exn] *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
stream_vt_uncons_opt<span class="keyword">(</span>xs0<span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
<span class="keyword">case+</span> <span class="keyword">!</span>xs0 <span class="keyword">of</span>
<span class="keyword">|</span> <span class="keyword">~</span>stream_vt_cons
    <span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span>
  <span class="keyword">(</span>
    xs0 := xs<span class="keyword">;</span> Some_vt<span class="keyword">(</span>x<span class="keyword">)</span>
  <span class="keyword">)</span>
<span class="keyword">|</span> <span class="keyword">~</span>stream_vt_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
    <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span>
      xs0 := <span class="dynexp"><span class="keyword">$ldelay</span><span class="keyword">(</span>stream_vt_nil<span class="keyword">)</span></span></span> <span class="keyword">in</span> None_vt<span class="keyword">(</span><span class="keyword">)</span>
    <span class="comment">// end of [val]</span>
  <span class="keyword">end</span> <span class="comment">// end of [stream_vt_nil]</span>
<span class="keyword">)</span></span> <span class="comment">(* end of [stream_vt_uncons_opt] *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
stream_vt_length<span class="keyword">(</span>xs0<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
loop
<span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">intGte</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">intGte</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
  <span class="keyword">case+</span> <span class="keyword">!</span>xs <span class="keyword">of</span>
  <span class="keyword">|</span> <span class="keyword">~</span>stream_vt_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> n
  <span class="keyword">|</span> <span class="keyword">~</span>stream_vt_cons<span class="keyword">(</span>_<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span> loop<span class="keyword">(</span>xs<span class="keyword">,</span> n+<span class="dynexp">1</span><span class="keyword">)</span>
<span class="keyword">)</span></span> <span class="comment">(* end of [loop] *)</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  <span class="keyword">$effmask_all</span><span class="keyword">(</span>loop<span class="keyword">(</span>xs0<span class="keyword">,</span> <span class="dynexp">0</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [stream_vt_length]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
stream_vt_nth_exn
  <span class="keyword">(</span>xs<span class="keyword">,</span> n<span class="keyword">)</span> <span class="keyword">=</span>
  loop<span class="keyword">(</span>xs<span class="keyword">,</span> n<span class="keyword">)</span> <span class="keyword">where</span>
<span class="keyword">{</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
loop<span class="keyword">:</span>
<span class="staexp"><span class="keyword">$d2ctype</span>
<span class="keyword">(</span>
  stream_vt_nth_exn&lt;a<span class="keyword">&gt;</span>
<span class="keyword">)</span></span> <span class="keyword">=</span> <span class="keyword">lam</span><span class="keyword">(</span>xs<span class="keyword">,</span> n<span class="keyword">)</span> <span class="keyword">=&gt;</span>
<span class="keyword">(</span>
  <span class="keyword">case+</span> <span class="keyword">!</span>xs <span class="keyword">of</span>
  <span class="keyword">|</span> <span class="keyword">~</span>stream_vt_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span>
      <span class="dynexp"><span class="keyword">$raise</span> StreamSubscriptExn<span class="keyword">(</span><span class="keyword">)</span></span>
  <span class="keyword">|</span> <span class="keyword">~</span>stream_vt_cons<span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span>
      <span class="keyword">if</span> n <span class="keyword">=</span> <span class="dynexp">0</span> <span class="keyword">then</span> <span class="keyword">(</span><span class="keyword">~</span>xs<span class="keyword">;</span> x<span class="keyword">)</span> <span class="keyword">else</span> loop<span class="keyword">(</span>xs<span class="keyword">,</span> pred<span class="keyword">(</span>n<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">)</span></span> <span class="comment">(* end of [loop] *)</span>
<span class="comment">//</span>
<span class="keyword">}</span></span> <span class="comment">(* end of [stream_vt_nth_exn] *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
stream_vt_nth_opt
  <span class="keyword">(</span>xs<span class="keyword">,</span> n<span class="keyword">)</span> <span class="keyword">=</span>
  loop<span class="keyword">(</span>xs<span class="keyword">,</span> n<span class="keyword">)</span> <span class="keyword">where</span>
<span class="keyword">{</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
loop<span class="keyword">:</span>
<span class="staexp"><span class="keyword">$d2ctype</span>
<span class="keyword">(</span>
  stream_vt_nth_opt&lt;a<span class="keyword">&gt;</span>
<span class="keyword">)</span></span> <span class="keyword">=</span> <span class="keyword">lam</span><span class="keyword">(</span>xs<span class="keyword">,</span> n<span class="keyword">)</span> <span class="keyword">=&gt;</span>
<span class="keyword">(</span>
  <span class="keyword">case+</span> <span class="keyword">!</span>xs <span class="keyword">of</span>
  <span class="keyword">|</span> <span class="keyword">~</span>stream_vt_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> None_vt<span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">|</span> <span class="keyword">~</span>stream_vt_cons<span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span>
      <span class="keyword">if</span> n <span class="keyword">=</span> <span class="dynexp">0</span> <span class="keyword">then</span> <span class="keyword">(</span><span class="keyword">~</span>xs<span class="keyword">;</span> Some_vt<span class="keyword">(</span>x<span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">else</span> loop<span class="keyword">(</span>xs<span class="keyword">,</span> pred<span class="keyword">(</span>n<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">)</span></span> <span class="comment">(* end of [loop] *)</span>
<span class="comment">//</span>
<span class="keyword">}</span></span> <span class="comment">(* end of [stream_vt_nth_opt] *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
stream_vt_append
  <span class="keyword">(</span>xs<span class="keyword">,</span> ys<span class="keyword">)</span> <span class="keyword">=</span>
  auxmain<span class="keyword">(</span>xs<span class="keyword">,</span> ys<span class="keyword">)</span> <span class="keyword">where</span>
<span class="keyword">{</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
auxmain<span class="keyword">:</span>
<span class="staexp"><span class="keyword">$d2ctype</span>
<span class="keyword">(</span>
stream_vt_append&lt;a<span class="keyword">&gt;</span>
<span class="keyword">)</span></span> <span class="keyword">=</span>
<span class="keyword">lam</span><span class="keyword">(</span>xs<span class="keyword">,</span> ys<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="dynexp"><span class="keyword">$ldelay</span><span class="keyword">(</span>
<span class="comment">//</span>
<span class="keyword">let</span>
<span class="comment">//</span>
<span class="keyword">val</span> xs_con <span class="keyword">=</span> <span class="keyword">!</span>xs
<span class="comment">//</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">case+</span> xs_con <span class="keyword">of</span>
<span class="keyword">|</span> <span class="keyword">~</span>stream_vt_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">!</span>ys
<span class="keyword">|</span> <span class="keyword">@</span>stream_vt_cons<span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
    <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span>
    <span class="keyword">(</span>
      xs := auxmain<span class="keyword">(</span>xs<span class="keyword">,</span> ys<span class="keyword">)</span>
    <span class="keyword">)</span> <span class="comment">(* end of [val] *)</span>
    <span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">fold@</span><span class="keyword">{</span>a<span class="keyword">}</span><span class="keyword">(</span>xs_con<span class="keyword">)</span> <span class="keyword">in</span> xs_con
  <span class="keyword">end</span> <span class="comment">// end of [stream_vt_cons]</span>
<span class="comment">//</span>
<span class="keyword">end</span> <span class="comment">// end-of-let</span>
<span class="keyword">,</span>
<span class="keyword">(</span>
  <span class="keyword">~</span><span class="keyword">(</span>xs<span class="keyword">)</span><span class="keyword">;</span> <span class="keyword">~</span><span class="keyword">(</span>ys<span class="keyword">)</span>
<span class="keyword">)</span> <span class="comment">// HX: for freeing the stream!</span>
<span class="comment">//</span>
<span class="keyword">)</span></span></span> <span class="comment">(* end of [auxmain] *)</span>
<span class="comment">//</span>
<span class="keyword">}</span></span> <span class="comment">(* end of [stream_vt_append] *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
stream_vt_concat
  <span class="keyword">(</span>xss<span class="keyword">)</span> <span class="keyword">=</span>
  auxmain<span class="keyword">(</span>xss<span class="keyword">)</span> <span class="keyword">where</span> <span class="keyword">{</span>
<span class="comment">//</span>
<span class="keyword">vtypedef</span>
<span class="staexp">stream1_vt <span class="keyword">=</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="keyword">vtypedef</span>
<span class="staexp">stream2_vt <span class="keyword">=</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">stream1_vt</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
auxmain
<span class="keyword">(</span>
  xss<span class="keyword">:</span> <span class="staexp">stream2_vt</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">stream1_vt</span> <span class="keyword">=</span> <span class="dynexp"><span class="keyword">$ldelay</span>
<span class="keyword">(</span>
<span class="keyword">(</span>
<span class="keyword">case+</span> <span class="keyword">!</span>xss <span class="keyword">of</span>
<span class="keyword">|</span> <span class="keyword">~</span>stream_vt_nil
    <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> stream_vt_nil<span class="keyword">(</span><span class="keyword">)</span>
  <span class="comment">// end of [stream_vt_nil]</span>
<span class="keyword">|</span> <span class="keyword">~</span>stream_vt_cons
    <span class="keyword">(</span>xs<span class="keyword">,</span> xss<span class="keyword">)</span> <span class="keyword">=&gt;</span>
    <span class="keyword">!</span><span class="keyword">(</span>stream_vt_append&lt;a<span class="keyword">&gt;</span><span class="keyword">(</span>xs<span class="keyword">,</span> auxmain<span class="keyword">(</span>xss<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span>
  <span class="comment">// end of [stream_vt_cons]</span>
<span class="keyword">)</span>
<span class="keyword">,</span>
<span class="keyword">(</span>
  <span class="keyword">~</span>xss
<span class="keyword">)</span> <span class="comment">(* HX: freeing the stream! *)</span>
<span class="keyword">)</span></span></span>
<span class="comment">//</span>
<span class="keyword">}</span></span> <span class="comment">(* end of [stream_vt_concat] *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
stream_vt_filter
  <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span> auxmain<span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">where</span>
<span class="keyword">{</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
auxmain
<span class="keyword">(</span>
xs<span class="keyword">:</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="dynexp"><span class="keyword">$ldelay</span>
<span class="keyword">(</span>
<span class="comment">//</span>
<span class="keyword">let</span>
  <span class="keyword">val</span> xs_con <span class="keyword">=</span> <span class="keyword">!</span>xs
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">case+</span> xs_con <span class="keyword">of</span>
<span class="keyword">|</span> <span class="keyword">~</span>stream_vt_nil
    <span class="keyword">(</span><span class="comment">(*_*)</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> stream_vt_nil<span class="keyword">(</span><span class="keyword">)</span>
  <span class="comment">// end of [stream_vt_nil]</span>
<span class="keyword">|</span> <span class="keyword">@</span>stream_vt_cons
    <span class="keyword">(</span>x<span class="keyword">,</span> xs1<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
    <span class="keyword">val</span> test <span class="keyword">=</span>
      stream_vt_filter$pred&lt;a<span class="keyword">&gt;</span><span class="keyword">(</span>x<span class="keyword">)</span>
    <span class="comment">// end of [val]</span>
  <span class="keyword">in</span>
    <span class="keyword">if</span> test
      <span class="keyword">then</span> <span class="keyword">let</span>
        <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span>
        xs1 := auxmain<span class="keyword">(</span>xs1<span class="keyword">)</span>
      <span class="keyword">in</span>
        <span class="keyword">fold@</span><span class="keyword">{</span>a<span class="keyword">}</span><span class="keyword">(</span>xs_con<span class="keyword">)</span><span class="keyword">;</span> xs_con
      <span class="keyword">end</span> <span class="comment">// end of [then]</span>
      <span class="keyword">else</span> <span class="keyword">let</span>
        <span class="keyword">val</span> xs1 <span class="keyword">=</span> xs1
      <span class="keyword">in</span>
        <span class="keyword">free@</span><span class="keyword">{</span>a<span class="keyword">}</span><span class="keyword">(</span>xs_con<span class="keyword">)</span><span class="keyword">;</span> <span class="keyword">!</span><span class="keyword">(</span>auxmain<span class="keyword">(</span>xs1<span class="keyword">)</span><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [else]</span>
    <span class="comment">// end of [if]</span>
  <span class="keyword">end</span> <span class="comment">// end of [stream_vt_cons]</span>
<span class="comment">//</span>
<span class="keyword">end</span> <span class="comment">// end of [let]</span>
<span class="comment">//</span>
<span class="keyword">,</span>
<span class="comment">//</span>
<span class="keyword">(</span>
  <span class="keyword">~</span>xs
<span class="keyword">)</span> <span class="comment">(* HX: for freeing the stream! *)</span>
<span class="comment">//</span>
<span class="keyword">)</span></span></span> <span class="comment">(* end of auxmain *)</span>
<span class="comment">//</span>
<span class="keyword">}</span></span> <span class="comment">(* end of [stream_vt_filter] *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
stream_vt_filter_fun
  <span class="keyword">(</span>xs<span class="keyword">,</span> pred<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">a2</span><span class="keyword">}</span>
stream_vt_filter$pred<span class="keyword">(</span>x<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> p <span class="keyword">=</span> <span class="dynexp"><span class="keyword">addr@</span></span><span class="keyword">(</span>x<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pf</span><span class="keyword">,</span> <span class="prfexp">fpf</span> <span class="keyword">|</span> p<span class="keyword">)</span> <span class="keyword">=</span> $UN<span class="keyword">.</span>ptr0_vtake<span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="keyword">(</span>p<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> test <span class="keyword">=</span> pred<span class="keyword">(</span><span class="keyword">!</span>p<span class="keyword">)</span></span>
<span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span> <span class="keyword">=</span> fpf <span class="keyword">(</span>pf<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  test
<span class="keyword">end</span></span> <span class="comment">// end of [stream_vt_filter$pred]</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  stream_vt_filter&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>xs<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [stream_vt_filter_fun]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
stream_vt_filter_cloptr
<span class="keyword">(</span>
  xs<span class="keyword">,</span> pred
<span class="keyword">)</span> <span class="keyword">=</span> auxmain<span class="keyword">(</span>xs<span class="keyword">,</span> pred<span class="keyword">)</span> <span class="keyword">where</span>
<span class="keyword">{</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
auxmain
<span class="keyword">(</span>
<span class="comment">//</span>
xs<span class="keyword">:</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> pred<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">&amp;</span><span class="staexp">a</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloptr</span><span class="keyword">&gt;</span> <span class="staexp">bool</span>
<span class="comment">//</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="dynexp"><span class="keyword">$ldelay</span>
<span class="keyword">(</span>
<span class="comment">//</span>
<span class="keyword">let</span>
  <span class="keyword">val</span> xs_con <span class="keyword">=</span> <span class="keyword">!</span>xs
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">case+</span> xs_con <span class="keyword">of</span>
<span class="keyword">|</span> <span class="keyword">~</span>stream_vt_nil
    <span class="keyword">(</span><span class="comment">(*_*)</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
    <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span>
    cloptr_free
      <span class="keyword">(</span>$UN<span class="keyword">.</span>castvwtp0<span class="keyword">{</span>cloptr0<span class="keyword">}</span><span class="keyword">(</span>pred<span class="keyword">)</span><span class="keyword">)</span>
    <span class="comment">// end of [val]</span>
  <span class="keyword">in</span>
    stream_vt_nil<span class="comment">(*void*)</span>
  <span class="keyword">end</span> <span class="comment">// end of [stream_vt_nil]</span>
<span class="keyword">|</span> <span class="keyword">@</span>stream_vt_cons
    <span class="keyword">(</span>x<span class="keyword">,</span> xs1<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
    <span class="keyword">val</span> test <span class="keyword">=</span> pred<span class="keyword">(</span>x<span class="keyword">)</span>
  <span class="keyword">in</span>
    <span class="keyword">if</span> test
      <span class="keyword">then</span> <span class="keyword">let</span>
        <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span>
        xs1 := auxmain<span class="keyword">(</span>xs1<span class="keyword">,</span> pred<span class="keyword">)</span>
      <span class="keyword">in</span>
        <span class="keyword">fold@</span><span class="keyword">{</span>a<span class="keyword">}</span><span class="keyword">(</span>xs_con<span class="keyword">)</span><span class="keyword">;</span> xs_con
      <span class="keyword">end</span> <span class="comment">// end of [then]</span>
      <span class="keyword">else</span> <span class="keyword">let</span>
        <span class="keyword">val</span> xs1 <span class="keyword">=</span> xs1
      <span class="keyword">in</span>
        <span class="keyword">free@</span><span class="keyword">{</span>a<span class="keyword">}</span><span class="keyword">(</span>xs_con<span class="keyword">)</span><span class="keyword">;</span> <span class="keyword">!</span><span class="keyword">(</span>auxmain<span class="keyword">(</span>xs1<span class="keyword">,</span> pred<span class="keyword">)</span><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [else]</span>
    <span class="comment">// end of [if]</span>
  <span class="keyword">end</span> <span class="comment">// end of [stream_vt_cons]</span>
<span class="comment">//</span>
<span class="keyword">end</span> <span class="comment">// end of [let]</span>
<span class="comment">//</span>
<span class="keyword">,</span>
<span class="comment">//</span>
<span class="keyword">(</span><span class="keyword">~</span>xs<span class="keyword">;</span> cloptr_free<span class="keyword">(</span>$UN<span class="keyword">.</span>castvwtp0<span class="keyword">{</span>cloptr0<span class="keyword">}</span><span class="keyword">(</span>pred<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="comment">//</span>
<span class="keyword">)</span></span></span> <span class="comment">(* end of auxmain *)</span>
<span class="comment">//</span>
<span class="keyword">}</span></span> <span class="comment">(* end of [stream_vt_filter_cloptr] *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
stream_vt_ifilter_cloptr
<span class="keyword">(</span>
  xs<span class="keyword">,</span> pred
<span class="keyword">)</span> <span class="keyword">=</span> auxmain<span class="keyword">(</span>xs<span class="keyword">,</span> <span class="dynexp">0</span><span class="keyword">,</span> pred<span class="keyword">)</span> <span class="keyword">where</span>
<span class="keyword">{</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
auxmain
<span class="keyword">(</span>
<span class="comment">//</span>
xs<span class="keyword">:</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span>
i0<span class="keyword">:</span> <span class="staexp">intGte</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span><span class="keyword">,</span> pred<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">intGte</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">&amp;</span><span class="staexp">a</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloptr</span><span class="keyword">&gt;</span> <span class="staexp">bool</span>
<span class="comment">//</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="dynexp"><span class="keyword">$ldelay</span>
<span class="keyword">(</span>
<span class="comment">//</span>
<span class="keyword">let</span>
  <span class="keyword">val</span> xs_con <span class="keyword">=</span> <span class="keyword">!</span>xs
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">case+</span> xs_con <span class="keyword">of</span>
<span class="keyword">|</span> <span class="keyword">~</span>stream_vt_nil
    <span class="keyword">(</span><span class="comment">(*_*)</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
    <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span>
    cloptr_free
      <span class="keyword">(</span>$UN<span class="keyword">.</span>castvwtp0<span class="keyword">{</span>cloptr0<span class="keyword">}</span><span class="keyword">(</span>pred<span class="keyword">)</span><span class="keyword">)</span>
    <span class="comment">// end of [val]</span>
  <span class="keyword">in</span>
    stream_vt_nil<span class="comment">(*void*)</span>
  <span class="keyword">end</span> <span class="comment">// end of [stream_vt_nil]</span>
<span class="keyword">|</span> <span class="keyword">@</span>stream_vt_cons
    <span class="keyword">(</span>x<span class="keyword">,</span> xs1<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
    <span class="keyword">val</span> test <span class="keyword">=</span> pred<span class="keyword">(</span>i0<span class="keyword">,</span> x<span class="keyword">)</span>
  <span class="keyword">in</span>
    <span class="keyword">if</span> test
      <span class="keyword">then</span> <span class="keyword">let</span>
        <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span>
        xs1 :=
        auxmain<span class="keyword">(</span>xs1<span class="keyword">,</span> i0+1<span class="keyword">,</span> pred<span class="keyword">)</span>
      <span class="keyword">in</span>
        <span class="keyword">fold@</span><span class="keyword">{</span>a<span class="keyword">}</span><span class="keyword">(</span>xs_con<span class="keyword">)</span><span class="keyword">;</span> xs_con
      <span class="keyword">end</span> <span class="comment">// end of [then]</span>
      <span class="keyword">else</span> <span class="keyword">let</span>
        <span class="keyword">val</span> xs1 <span class="keyword">=</span> xs1
      <span class="keyword">in</span>
        <span class="keyword">free@</span><span class="keyword">{</span>a<span class="keyword">}</span><span class="keyword">(</span>xs_con<span class="keyword">)</span><span class="keyword">;</span> <span class="keyword">!</span><span class="keyword">(</span>auxmain<span class="keyword">(</span>xs1<span class="keyword">,</span> i0+1<span class="keyword">,</span> pred<span class="keyword">)</span><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [else]</span>
    <span class="comment">// end of [if]</span>
  <span class="keyword">end</span> <span class="comment">// end of [stream_vt_cons]</span>
<span class="comment">//</span>
<span class="keyword">end</span> <span class="comment">// end of [let]</span>
<span class="comment">//</span>
<span class="keyword">,</span>
<span class="comment">//</span>
<span class="keyword">(</span><span class="keyword">~</span>xs<span class="keyword">;</span> cloptr_free<span class="keyword">(</span>$UN<span class="keyword">.</span>castvwtp0<span class="keyword">{</span>cloptr0<span class="keyword">}</span><span class="keyword">(</span>pred<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="comment">//</span>
<span class="keyword">)</span></span></span> <span class="comment">(* end of auxmain *)</span>
<span class="comment">//</span>
<span class="keyword">}</span></span> <span class="comment">(* end of [stream_vt_ifilter_cloptr] *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
stream_vt_filterlin
  <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span> auxmain<span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">where</span>
<span class="keyword">{</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
auxmain
<span class="keyword">(</span>
xs<span class="keyword">:</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="dynexp"><span class="keyword">$ldelay</span>
<span class="keyword">(</span>
<span class="comment">//</span>
<span class="keyword">let</span>
  <span class="keyword">val</span> xs_con <span class="keyword">=</span> <span class="keyword">!</span>xs
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">case+</span> xs_con <span class="keyword">of</span>
<span class="keyword">|</span> <span class="keyword">~</span>stream_vt_nil
    <span class="keyword">(</span><span class="comment">(*_*)</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> stream_vt_nil<span class="keyword">(</span><span class="keyword">)</span>
  <span class="comment">// end of [stream_vt_nil]</span>
<span class="keyword">|</span> <span class="keyword">@</span>stream_vt_cons
    <span class="keyword">(</span>x<span class="keyword">,</span> xs1<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
    <span class="keyword">val</span> test <span class="keyword">=</span>
      stream_vt_filterlin$pred&lt;a<span class="keyword">&gt;</span><span class="keyword">(</span>x<span class="keyword">)</span>
    <span class="comment">// end of [val]</span>
  <span class="keyword">in</span>
    <span class="keyword">if</span> test
      <span class="keyword">then</span> <span class="keyword">let</span>
        <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span>
        xs1 := auxmain<span class="keyword">(</span>xs1<span class="keyword">)</span>
      <span class="keyword">in</span>
        <span class="keyword">fold@</span><span class="keyword">{</span>a<span class="keyword">}</span><span class="keyword">(</span>xs_con<span class="keyword">)</span><span class="keyword">;</span> xs_con
      <span class="keyword">end</span> <span class="comment">// end of [then]</span>
      <span class="keyword">else</span> <span class="keyword">let</span>
        <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span>
          stream_vt_filterlin$clear&lt;a<span class="keyword">&gt;</span><span class="keyword">(</span>x<span class="keyword">)</span>
        <span class="comment">// end of [val]</span>
      <span class="keyword">in</span>
        <span class="keyword">let</span> <span class="keyword">val</span> xs1 <span class="keyword">=</span> xs1 <span class="keyword">in</span> <span class="keyword">free@</span><span class="keyword">{</span>a<span class="keyword">}</span><span class="keyword">(</span>xs_con<span class="keyword">)</span><span class="keyword">;</span> <span class="keyword">!</span><span class="keyword">(</span>auxmain<span class="keyword">(</span>xs1<span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">end</span>
      <span class="keyword">end</span> <span class="comment">// end of [else]</span>
    <span class="comment">// end of [if]</span>
  <span class="keyword">end</span> <span class="comment">// end of [stream_vt_cons]</span>
<span class="comment">//</span>
<span class="keyword">end</span> <span class="comment">// end of [let]</span>
<span class="comment">//</span>
<span class="keyword">,</span>
<span class="comment">//</span>
<span class="keyword">(</span>
  <span class="keyword">~</span>xs
<span class="keyword">)</span> <span class="comment">(* HX: for freeing the stream! *)</span>
<span class="comment">//</span>
<span class="keyword">)</span></span></span> <span class="comment">(* end of auxmain *)</span>
<span class="comment">//</span>
<span class="keyword">}</span></span> <span class="comment">(* end of [stream_vt_filterlin] *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">b</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
stream_vt_map<span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
auxmain <span class="keyword">(</span>
<span class="comment">//</span>
xs<span class="keyword">:</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span>
<span class="comment">//</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">b</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="dynexp"><span class="keyword">$ldelay</span>
<span class="keyword">(</span>
<span class="comment">//</span>
<span class="keyword">let</span>
  <span class="keyword">val</span> xs_con <span class="keyword">=</span> <span class="keyword">!</span>xs
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">case+</span>
xs_con
<span class="keyword">of</span> <span class="comment">// case+</span>
<span class="comment">//</span>
<span class="keyword">|</span> <span class="keyword">~</span>stream_vt_nil
    <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> stream_vt_nil<span class="keyword">(</span><span class="keyword">)</span>
  <span class="comment">// end of [stream_vt_nil]</span>
<span class="keyword">|</span> <span class="keyword">@</span>stream_vt_cons<span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
    <span class="keyword">val</span> y <span class="keyword">=</span>
    stream_vt_map$fopr&lt;a<span class="keyword">&gt;&lt;</span>b<span class="keyword">&gt;</span> <span class="keyword">(</span>x<span class="keyword">)</span>
    <span class="keyword">val</span> xs <span class="keyword">=</span> xs
    <span class="keyword">val</span> <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">free@</span> <span class="keyword">(</span>xs_con<span class="keyword">)</span>
  <span class="keyword">in</span>
    stream_vt_cons<span class="keyword">{</span>b<span class="keyword">}</span><span class="keyword">(</span>y<span class="keyword">,</span> auxmain<span class="keyword">(</span>xs<span class="keyword">)</span><span class="keyword">)</span>
  <span class="keyword">end</span> <span class="comment">(* end of [stream_vt_con] *)</span>
<span class="comment">//</span>
<span class="keyword">end</span> <span class="comment">// end of [let]</span>
<span class="comment">//</span>
<span class="keyword">,</span>
<span class="comment">//</span>
<span class="keyword">(</span>
  <span class="keyword">~</span>xs
<span class="keyword">)</span> <span class="comment">(* HX: for freeing the stream! *)</span>
<span class="comment">//</span>
<span class="keyword">)</span></span></span> <span class="comment">(* end of [auxmain] *)</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  auxmain<span class="keyword">(</span>xs<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [stream_vt_map]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">b</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
stream_vt_map_fun
  <span class="keyword">(</span>xs<span class="keyword">,</span> fopr<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a2</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">b2</span><span class="keyword">}</span>
stream_vt_map$fopr
  <span class="keyword">(</span>x<span class="keyword">)</span> <span class="keyword">=</span> res <span class="keyword">where</span>
<span class="keyword">{</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> __assert<span class="keyword">(</span>x<span class="keyword">)</span> <span class="keyword">where</span>
<span class="keyword">{</span>
  <span class="keyword">extern</span> <span class="prfexp"><span class="keyword">praxi</span> __assert<span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">a2</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">a2</span><span class="staexp">?!</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="keyword">}</span></span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span>
  <span class="prfexp">pf</span><span class="keyword">,</span> <span class="prfexp">fpf</span> <span class="keyword">|</span> p_x
<span class="keyword">)</span> <span class="keyword">=</span> $UN<span class="keyword">.</span>ptr0_vtake<span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="keyword">(</span><span class="dynexp"><span class="keyword">addr@</span></span>x<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> res <span class="keyword">=</span> $UN<span class="keyword">.</span>castvwtp0<span class="staexp"><span class="keyword">{</span>b2<span class="keyword">}</span></span><span class="keyword">(</span>fopr<span class="keyword">(</span><span class="keyword">!</span>p_x<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="prfexp"><span class="keyword">prval</span><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> $UN<span class="keyword">.</span>castview0<span class="staexp"><span class="keyword">{</span>void<span class="keyword">}</span></span><span class="keyword">(</span><span class="keyword">@(</span>fpf<span class="keyword">,</span> pf<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">}</span></span> <span class="comment">(* end of [stream_vt_map$fopr] *)</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  stream_vt_map&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">b</span><span class="keyword">&gt;</span> <span class="keyword">(</span>xs<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [stream_vt_map_fun]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">b</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
stream_vt_map_cloptr
  <span class="keyword">(</span>xs<span class="keyword">,</span> fopr<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
auxmain<span class="keyword">:</span>
<span class="staexp"><span class="keyword">$d2ctype</span><span class="keyword">(</span>stream_vt_map_cloptr&lt;a<span class="keyword">&gt;&lt;</span>b<span class="keyword">&gt;</span><span class="keyword">)</span></span> <span class="keyword">=</span>
<span class="keyword">lam</span><span class="keyword">(</span>xs<span class="keyword">,</span> fopr<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="dynexp"><span class="keyword">$ldelay</span>
<span class="keyword">(</span>
<span class="keyword">let</span>
  <span class="keyword">val</span> xs_con <span class="keyword">=</span> <span class="keyword">!</span>xs
<span class="keyword">in</span>
  <span class="keyword">case+</span> xs_con <span class="keyword">of</span>
  <span class="keyword">|</span> <span class="keyword">~</span>stream_vt_nil
      <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
    <span class="comment">//</span>
      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span>
      cloptr_free
      <span class="keyword">(</span>
        $UN<span class="keyword">.</span>castvwtp0<span class="keyword">{</span>cloptr0<span class="keyword">}</span><span class="keyword">(</span>fopr<span class="keyword">)</span>
      <span class="keyword">)</span>
    <span class="comment">//</span>
    <span class="keyword">in</span>
      stream_vt_nil<span class="keyword">(</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [stream_vt_nil]</span>
  <span class="keyword">|</span> <span class="keyword">@</span>stream_vt_cons
      <span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> y <span class="keyword">=</span> fopr<span class="keyword">(</span>x<span class="keyword">)</span>
      <span class="keyword">val</span> xs <span class="keyword">=</span> xs
      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">free@</span><span class="keyword">{</span>a?<span class="keyword">}</span><span class="keyword">(</span>xs_con<span class="keyword">)</span>
    <span class="keyword">in</span>
      stream_vt_cons<span class="keyword">(</span>y<span class="keyword">,</span> auxmain<span class="keyword">(</span>xs<span class="keyword">,</span> fopr<span class="keyword">)</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [stream_vt_cons]</span>
<span class="keyword">end</span> <span class="comment">// end of [let]</span>
<span class="keyword">,</span>
<span class="keyword">(</span><span class="keyword">~</span>xs<span class="keyword">;</span> cloptr_free<span class="keyword">(</span>$UN<span class="keyword">.</span>castvwtp0<span class="keyword">{</span>cloptr0<span class="keyword">}</span><span class="keyword">(</span>fopr<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">)</span></span></span> <span class="comment">(* end of [auxmain] *)</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  auxmain<span class="keyword">(</span>xs<span class="keyword">,</span> fopr<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [stream_vt_map_cloptr]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a1<span class="keyword">,</span>a2</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">b</span><span class="keyword">}</span>
stream_vt_map2
  <span class="keyword">(</span>xs1<span class="keyword">,</span> xs2<span class="keyword">)</span> <span class="keyword">=</span>
  auxmain<span class="keyword">(</span>xs1<span class="keyword">,</span> xs2<span class="keyword">)</span> <span class="keyword">where</span>
<span class="keyword">{</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
auxmain
<span class="keyword">(</span>
  xs1<span class="keyword">:</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">a1</span><span class="keyword">)</span>
<span class="keyword">,</span> xs2<span class="keyword">:</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">a2</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">b</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="dynexp"><span class="keyword">$ldelay</span>
<span class="keyword">(</span>
<span class="keyword">let</span>
  <span class="keyword">val</span> xs1_con <span class="keyword">=</span> <span class="keyword">!</span>xs1
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">case+</span> xs1_con <span class="keyword">of</span>
<span class="keyword">|</span> <span class="keyword">~</span>stream_vt_nil
    <span class="keyword">(</span><span class="comment">(*_*)</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">~</span><span class="keyword">(</span>xs2<span class="keyword">)</span><span class="keyword">;</span> stream_vt_nil<span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span>
  <span class="comment">// end of [stream_vt_nil]</span>
<span class="keyword">|</span> <span class="keyword">@</span>stream_vt_cons
    <span class="keyword">(</span>x1<span class="keyword">,</span> xs1<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
    <span class="keyword">val</span> xs2_con <span class="keyword">=</span> <span class="keyword">!</span>xs2
  <span class="keyword">in</span>
    <span class="keyword">case+</span> xs2_con <span class="keyword">of</span>
    <span class="keyword">|</span> <span class="keyword">~</span>stream_vt_nil
        <span class="keyword">(</span><span class="comment">(*_*)</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
        <span class="keyword">val</span> xs1 <span class="keyword">=</span> xs1
        <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">free@</span> <span class="keyword">(</span>xs1_con<span class="keyword">)</span>
      <span class="keyword">in</span>
        <span class="keyword">~</span><span class="keyword">(</span>xs1<span class="keyword">)</span><span class="keyword">;</span> stream_vt_nil <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [stream_vt_nil]</span>
    <span class="keyword">|</span> <span class="keyword">@</span>stream_vt_cons
        <span class="keyword">(</span>x2<span class="keyword">,</span> xs2<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
        <span class="keyword">val</span> y <span class="keyword">=</span>
        stream_vt_map2$fopr&lt;a1<span class="keyword">,</span>a2<span class="keyword">&gt;&lt;</span>b<span class="keyword">&gt;</span> <span class="keyword">(</span>x1<span class="keyword">,</span> x2<span class="keyword">)</span>
        <span class="keyword">val</span> xs1 <span class="keyword">=</span> xs1
        <span class="keyword">and</span> xs2 <span class="keyword">=</span> xs2
        <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">free@</span> <span class="keyword">(</span>xs1_con<span class="keyword">)</span>
        <span class="keyword">and</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">free@</span> <span class="keyword">(</span>xs2_con<span class="keyword">)</span>
      <span class="keyword">in</span>
        stream_vt_cons<span class="keyword">{</span>b<span class="keyword">}</span>
          <span class="keyword">(</span>y<span class="keyword">,</span> stream_vt_map2&lt;a1<span class="keyword">,</span>a2<span class="keyword">&gt;&lt;</span>b<span class="keyword">&gt;</span> <span class="keyword">(</span>xs1<span class="keyword">,</span> xs2<span class="keyword">)</span><span class="keyword">)</span>
        <span class="comment">// end of [stream_vt_cons]</span>
      <span class="keyword">end</span> <span class="comment">// end of [stream_vt_cons]</span>
  <span class="keyword">end</span> <span class="comment">// end of [stream_vt_cons]</span>
<span class="comment">//</span>
<span class="keyword">end</span> <span class="comment">// end of [let]</span>
<span class="keyword">,</span>
<span class="comment">//</span>
<span class="keyword">(</span>
  <span class="keyword">~</span><span class="keyword">(</span>xs1<span class="keyword">)</span><span class="keyword">;</span> <span class="keyword">~</span><span class="keyword">(</span>xs2<span class="keyword">)</span>
<span class="keyword">)</span> <span class="comment">(* HX: for freeing the stream! *)</span>
<span class="comment">//</span>
<span class="keyword">)</span></span></span> <span class="comment">(* $ldelay] *)</span> <span class="comment">// end of [auxmain]</span>
<span class="comment">//</span>
<span class="keyword">}</span></span> <span class="comment">(* end of [stream_vt_map2] *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a1<span class="keyword">,</span>a2</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">b</span><span class="keyword">}</span>
stream_vt_map2_fun
  <span class="keyword">(</span>xs1<span class="keyword">,</span> xs2<span class="keyword">,</span> fopr<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a12<span class="keyword">,</span>a22</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">b2</span><span class="keyword">}</span>
stream_vt_map2$fopr
  <span class="keyword">(</span>x1<span class="keyword">,</span> x2<span class="keyword">)</span> <span class="keyword">=</span> res <span class="keyword">where</span>
<span class="keyword">{</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span>
  <span class="prfexp">pf1</span><span class="keyword">,</span> <span class="prfexp">fpf1</span> <span class="keyword">|</span> p_x1
<span class="keyword">)</span> <span class="keyword">=</span> $UN<span class="keyword">.</span>ptr0_vtake<span class="staexp"><span class="keyword">{</span>a1<span class="keyword">}</span></span><span class="keyword">(</span><span class="dynexp"><span class="keyword">addr@</span></span>x1<span class="keyword">)</span>
<span class="keyword">and</span> <span class="keyword">(</span>
  <span class="prfexp">pf2</span><span class="keyword">,</span> <span class="prfexp">fpf2</span> <span class="keyword">|</span> p_x2
<span class="keyword">)</span> <span class="keyword">=</span> $UN<span class="keyword">.</span>ptr0_vtake<span class="staexp"><span class="keyword">{</span>a2<span class="keyword">}</span></span><span class="keyword">(</span><span class="dynexp"><span class="keyword">addr@</span></span>x2<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> res <span class="keyword">=</span>
  $UN<span class="keyword">.</span>castvwtp0<span class="staexp"><span class="keyword">{</span>b2<span class="keyword">}</span></span><span class="keyword">(</span>fopr<span class="keyword">(</span><span class="keyword">!</span>p_x1<span class="keyword">,</span> <span class="keyword">!</span>p_x2<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fpf1 <span class="keyword">(</span>pf1<span class="keyword">)</span> <span class="keyword">and</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fpf2 <span class="keyword">(</span>pf2<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">}</span></span> <span class="comment">(* end of [stream_vt_map2$fopr] *)</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  stream_vt_map2&lt;<span class="staexp">a1</span><span class="keyword">,</span><span class="staexp">a2</span><span class="keyword">&gt;&lt;</span><span class="staexp">b</span><span class="keyword">&gt;</span> <span class="keyword">(</span>xs1<span class="keyword">,</span> xs2<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [stream_vt_map2_fun]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
stream_vt_tabulate
<span class="keyword">(</span>
<span class="comment">// argumentless</span>
<span class="keyword">)</span> <span class="keyword">=</span> aux <span class="keyword">(</span><span class="dynexp">0</span><span class="keyword">)</span> <span class="keyword">where</span>
<span class="keyword">{</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> aux
<span class="keyword">(</span>
i <span class="keyword">:</span> <span class="staexp">intGte</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
  <span class="dynexp"><span class="keyword">$ldelay</span><span class="keyword">(</span>
    stream_vt_cons<span class="keyword">{</span>a<span class="keyword">}</span><span class="keyword">(</span>stream_vt_tabulate$fopr&lt;a<span class="keyword">&gt;</span><span class="keyword">(</span>i<span class="keyword">)</span><span class="keyword">,</span> aux<span class="keyword">(</span>i+1<span class="keyword">)</span><span class="keyword">)</span>
  <span class="keyword">)</span></span> <span class="comment">(* $ldelay *)</span>
<span class="keyword">)</span></span> <span class="comment">(* end of [aux] *)</span>
<span class="comment">//</span>
<span class="keyword">}</span></span> <span class="comment">(* end of [stream_vt_tabulate] *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
stream_vt_labelize<span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="keyword">vtypedef</span> <span class="staexp">ia <span class="keyword">=</span> <span class="keyword">@(</span><span class="staexp">intGte</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
auxmain
<span class="keyword">(</span>
  i<span class="keyword">:</span> <span class="staexp">intGte</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span><span class="keyword">,</span> xs<span class="keyword">:</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">ia</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="dynexp"><span class="keyword">$ldelay</span>
<span class="keyword">(</span>
<span class="keyword">(</span>
<span class="keyword">case+</span> <span class="keyword">!</span>xs <span class="keyword">of</span>
<span class="keyword">|</span> <span class="keyword">~</span>stream_vt_nil
    <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> stream_vt_nil<span class="keyword">(</span><span class="keyword">)</span>
  <span class="comment">// end of [stream_vt_nil]</span>
<span class="keyword">|</span> <span class="keyword">~</span>stream_vt_cons
    <span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span>
    stream_vt_cons<span class="keyword">(</span><span class="keyword">(</span>i<span class="keyword">,</span> x<span class="keyword">)</span><span class="keyword">,</span> auxmain<span class="keyword">(</span>i+1<span class="keyword">,</span> xs<span class="keyword">)</span><span class="keyword">)</span>
  <span class="comment">// end of [stream_vt_cons]</span>
<span class="keyword">)</span>
<span class="keyword">,</span>
<span class="keyword">(</span>
  <span class="keyword">~</span>xs
<span class="keyword">)</span> <span class="comment">// HX: for freeing the stream!</span>
<span class="keyword">)</span></span></span> <span class="comment">(* end of [auxmain] *)</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  auxmain<span class="keyword">(</span><span class="dynexp">0</span><span class="keyword">,</span> xs<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [stream_vt_labelize]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
stream_vt_foreach
  <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="keyword">var</span> env<span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  stream_vt_foreach_env&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">void</span><span class="keyword">&gt;</span> <span class="keyword">(</span>xs<span class="keyword">,</span> env<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [stream_vt_foreach]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">env</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
stream_vt_foreach_env
  <span class="keyword">(</span>xs<span class="keyword">,</span> env<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
loop
<span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span>
<span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">env</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">env</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">stream_vt_con</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> xs_con <span class="keyword">=</span> <span class="keyword">!</span>xs</span>
<span class="comment">//</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">case+</span> xs_con <span class="keyword">of</span>
<span class="keyword">|</span> <span class="keyword">@</span>stream_vt_cons
    <span class="keyword">(</span>x<span class="keyword">,</span> xs1<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
    <span class="dynexp"><span class="keyword">val</span> test <span class="keyword">=</span>
    stream_vt_foreach$cont&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>x<span class="keyword">,</span> env<span class="keyword">)</span></span>
  <span class="keyword">in</span>
    <span class="keyword">if</span> test
      <span class="keyword">then</span> <span class="keyword">let</span>
        <span class="dynexp"><span class="keyword">val</span> xs1 <span class="keyword">=</span> xs1</span>
        <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span> <span class="keyword">=</span>
        stream_vt_foreach$fwork&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>x<span class="keyword">,</span> env<span class="keyword">)</span></span>
        <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="comment">(*freed*)</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">free@</span><span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="keyword">(</span>xs_con<span class="keyword">)</span></span>
      <span class="keyword">in</span>
        loop<span class="keyword">(</span>xs1<span class="keyword">,</span> env<span class="keyword">)</span>
      <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">let</span>
        <span class="prfexp"><span class="keyword">prval</span><span class="keyword">(</span><span class="comment">(*folded*)</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">fold@</span><span class="keyword">(</span>xs_con<span class="keyword">)</span></span> <span class="keyword">in</span> xs_con
      <span class="keyword">end</span> <span class="comment">// end of [if]</span>
  <span class="keyword">end</span> <span class="comment">// end of [stream_vt_cons]</span>
<span class="keyword">|</span> <span class="keyword">~</span>stream_vt_nil<span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> stream_vt_nil<span class="keyword">(</span><span class="keyword">)</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [loop]</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  loop<span class="keyword">(</span>xs<span class="keyword">,</span> env<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [stream_vt_foreach_env]</span>

<span class="dynexp"><span class="keyword">implement</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span><span class="staexp">env</span><span class="keyword">)</span>
stream_vt_foreach$cont&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">env</span><span class="keyword">&gt;</span><span class="keyword">(</span>x0<span class="keyword">,</span> env<span class="keyword">)</span> <span class="keyword">=</span> true</span><span class="comment">(*cont*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
stream_vt_foreach_cloptr
  <span class="keyword">(</span>xs<span class="keyword">,</span> fwork<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
loop <span class="keyword">:</span>
<span class="staexp"><span class="keyword">$d2ctype</span>
<span class="keyword">(</span>
  stream_vt_foreach_cloptr&lt;a<span class="keyword">&gt;</span>
<span class="keyword">)</span></span> <span class="keyword">=</span>
<span class="keyword">lam</span><span class="keyword">(</span>xs<span class="keyword">,</span> fwork<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> xs_con <span class="keyword">=</span> <span class="keyword">!</span>xs</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">case+</span> xs_con <span class="keyword">of</span>
<span class="keyword">|</span> <span class="keyword">~</span>stream_vt_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span>
    cloptr_free
      <span class="keyword">(</span>$UN<span class="keyword">.</span>castvwtp0<span class="staexp"><span class="keyword">{</span>cloptr0<span class="keyword">}</span></span><span class="keyword">(</span>fwork<span class="keyword">)</span><span class="keyword">)</span>
    <span class="comment">// cloptr_free</span>
<span class="keyword">|</span> <span class="keyword">@</span>stream_vt_cons<span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span>
    <span class="keyword">let</span> <span class="dynexp"><span class="keyword">val</span> xs <span class="keyword">=</span> xs</span> <span class="keyword">in</span>
      fwork<span class="keyword">(</span>x<span class="keyword">)</span><span class="keyword">;</span> <span class="keyword">free@</span><span class="staexp"><span class="keyword">{</span>a?<span class="keyword">}</span></span><span class="keyword">(</span>xs_con<span class="keyword">)</span><span class="keyword">;</span> loop<span class="keyword">(</span>xs<span class="keyword">,</span> fwork<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [let]</span>
<span class="keyword">end</span></span> <span class="comment">// end of [let] // end of [lam]</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  loop<span class="keyword">(</span>xs<span class="keyword">,</span> fwork<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [stream_vt_foreach_cloptr]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
stream_vt_iforeach_cloptr
  <span class="keyword">(</span>xs<span class="keyword">,</span> fwork<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
loop <span class="keyword">(</span>
  i0<span class="keyword">:</span> <span class="staexp">intGte</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span>
<span class="keyword">,</span> xs<span class="keyword">:</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span>
<span class="keyword">,</span> fwork<span class="keyword">:</span> <span class="keyword">(</span><span class="staexp">intGte</span><span class="keyword">(</span><span class="staexp">0</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">&amp;</span><span class="staexp">a</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">a</span><span class="staexp">?!</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloptr1</span><span class="keyword">&gt;</span> <span class="staexp">void</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
  <span class="dynexp"><span class="keyword">val</span> xs_con <span class="keyword">=</span> <span class="keyword">!</span>xs</span>
<span class="comment">//</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">case+</span> xs_con <span class="keyword">of</span>
<span class="keyword">|</span> <span class="keyword">~</span>stream_vt_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span>
    cloptr_free
      <span class="keyword">(</span>$UN<span class="keyword">.</span>castvwtp0<span class="staexp"><span class="keyword">{</span>cloptr0<span class="keyword">}</span></span><span class="keyword">(</span>fwork<span class="keyword">)</span><span class="keyword">)</span>
    <span class="comment">// cloptr_free</span>
<span class="keyword">|</span> <span class="keyword">@</span>stream_vt_cons<span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span>
    <span class="keyword">let</span> <span class="dynexp"><span class="keyword">val</span> xs <span class="keyword">=</span> xs</span> <span class="keyword">in</span>
      fwork<span class="keyword">(</span>i0<span class="keyword">,</span> x<span class="keyword">)</span><span class="keyword">;</span> <span class="keyword">free@</span><span class="staexp"><span class="keyword">{</span>a?<span class="keyword">}</span></span><span class="keyword">(</span>xs_con<span class="keyword">)</span><span class="keyword">;</span> loop<span class="keyword">(</span>i0+<span class="dynexp">1</span><span class="keyword">,</span> xs<span class="keyword">,</span> fwork<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [let]</span>
<span class="keyword">end</span></span> <span class="comment">// end of [let] // end of [lam]</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  loop<span class="keyword">(</span><span class="dynexp">0</span><span class="comment">(*i0*)</span><span class="keyword">,</span> xs<span class="keyword">,</span> fwork<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [stream_vt_iforeach_cloptr]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">res</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span>
stream_vt_foldleft_cloptr
  <span class="keyword">(</span>xs<span class="keyword">,</span> init<span class="keyword">,</span> fopr<span class="keyword">)</span> <span class="keyword">=</span>
  loop<span class="keyword">(</span>xs<span class="keyword">,</span> init<span class="keyword">,</span> fopr<span class="keyword">)</span> <span class="keyword">where</span>
<span class="keyword">{</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
loop<span class="keyword">:</span>
<span class="staexp"><span class="keyword">$d2ctype</span>
<span class="keyword">(</span>stream_vt_foldleft_cloptr&lt;res<span class="keyword">&gt;&lt;</span>a<span class="keyword">&gt;</span><span class="keyword">)</span></span> <span class="keyword">=</span>
<span class="keyword">lam</span>
<span class="keyword">(</span>
xs<span class="keyword">,</span> res<span class="keyword">,</span> fopr
<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
  <span class="keyword">var</span> xs_con <span class="keyword">=</span> <span class="keyword">!</span>xs
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">case+</span>
xs_con
<span class="keyword">of</span> <span class="comment">// case+</span>
<span class="keyword">|</span> <span class="keyword">~</span>stream_vt_nil
    <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span>
  <span class="keyword">(</span>
    cloptr_free<span class="keyword">(</span>$UN<span class="keyword">.</span>castvwtp0<span class="keyword">(</span>fopr<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">;</span> res
  <span class="keyword">)</span> <span class="comment">(* end of [stream_vt_nil] *)</span>
<span class="keyword">|</span> <span class="keyword">@</span>stream_vt_cons
    <span class="keyword">(</span>x0<span class="keyword">,</span> xs1<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
    <span class="dynexp"><span class="keyword">val</span> res <span class="keyword">=</span> fopr<span class="keyword">(</span>res<span class="keyword">,</span> x0<span class="keyword">)</span></span>
    <span class="dynexp"><span class="keyword">val</span> xs1 <span class="keyword">=</span> xs1</span> <span class="keyword">in</span> <span class="keyword">free@</span><span class="keyword">(</span>xs_con<span class="keyword">)</span><span class="keyword">;</span> loop<span class="keyword">(</span>xs1<span class="keyword">,</span> res<span class="keyword">,</span> fopr<span class="keyword">)</span>
  <span class="keyword">end</span> <span class="comment">// end of [stream_vt_cons]</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [loop]</span>
<span class="comment">//</span>
<span class="keyword">}</span></span> <span class="comment">(* end of [stream_vt_foldleft_cloptr] *)</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">env</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span>
stream_vt_unfold
<span class="keyword">(</span>
  st0<span class="keyword">,</span> fopr
<span class="keyword">)</span> <span class="keyword">=</span> aux<span class="keyword">(</span>st0<span class="keyword">)</span> <span class="keyword">where</span>
<span class="keyword">{</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> aux
<span class="keyword">(</span>
  st<span class="keyword">:</span> <span class="staexp">env</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="dynexp"><span class="keyword">$ldelay</span>
<span class="keyword">(</span>
<span class="keyword">let</span>
  <span class="keyword">var</span> st <span class="keyword">=</span> st<span class="keyword">;</span>
  <span class="keyword">val</span> x0 <span class="keyword">=</span> fopr<span class="keyword">(</span>st<span class="keyword">)</span>
<span class="keyword">in</span>
  stream_vt_cons<span class="keyword">{</span>a<span class="keyword">}</span><span class="keyword">(</span>x0<span class="keyword">,</span> aux<span class="keyword">(</span>st<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [aux]</span>
<span class="keyword">)</span></span></span>
<span class="comment">//</span>
<span class="keyword">}</span></span> <span class="comment">(* end of [stream_vt_unfold] *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">env</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span>
stream_vt_unfold_opt
<span class="keyword">(</span>
  st0<span class="keyword">,</span> fopr
<span class="keyword">)</span> <span class="keyword">=</span> aux<span class="keyword">(</span>st0<span class="keyword">)</span> <span class="keyword">where</span>
<span class="keyword">{</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> aux
<span class="keyword">(</span>
  st<span class="keyword">:</span> <span class="staexp">env</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="dynexp"><span class="keyword">$ldelay</span>
<span class="keyword">(</span>
<span class="keyword">let</span>
  <span class="keyword">var</span> st <span class="keyword">=</span> st<span class="keyword">;</span>
  <span class="keyword">val</span> opt <span class="keyword">=</span> fopr<span class="keyword">(</span>st<span class="keyword">)</span>
<span class="keyword">in</span>
  <span class="keyword">case+</span> opt <span class="keyword">of</span>
  <span class="keyword">|</span> <span class="keyword">~</span>None_vt<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> stream_vt_nil<span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">|</span> <span class="keyword">~</span>Some_vt<span class="keyword">(</span>x0<span class="keyword">)</span> <span class="keyword">=&gt;</span> stream_vt_cons<span class="keyword">{</span>a<span class="keyword">}</span><span class="keyword">(</span>x0<span class="keyword">,</span> aux<span class="keyword">(</span>st<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [let]</span>
<span class="keyword">)</span></span></span>
<span class="comment">//</span>
<span class="keyword">}</span></span> <span class="comment">(* end of [stream_vt_unfold_opt] *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">x<span class="keyword">,</span>y</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
cross_stream_vt_list
  <span class="keyword">(</span>xs0<span class="keyword">,</span> ys0<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
auxmain
<span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="keyword">@(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">y</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="dynexp"><span class="keyword">$ldelay</span>
<span class="keyword">(</span>
<span class="keyword">(</span>
<span class="keyword">case+</span> <span class="keyword">!</span>xs <span class="keyword">of</span>
<span class="keyword">|</span> <span class="keyword">~</span>stream_vt_nil
    <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> stream_vt_nil<span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">|</span> <span class="keyword">~</span>stream_vt_cons
    <span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">!</span><span class="keyword">(</span>auxmain2<span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">,</span> ys0<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">)</span>
<span class="keyword">,</span>
<span class="keyword">(</span><span class="keyword">~</span>xs<span class="keyword">)</span> <span class="comment">// called when the stream is freed</span>
<span class="keyword">)</span></span> <span class="comment">(* end of [auxmain] *)</span>
<span class="comment">//</span>
<span class="keyword">and</span>
auxmain2
<span class="keyword">(</span>
  x0<span class="keyword">:</span> <span class="staexp">x</span>
<span class="keyword">,</span> xs<span class="keyword">:</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">,</span> ys<span class="keyword">:</span> <span class="staexp">List</span><span class="keyword">(</span><span class="staexp">y</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="keyword">@(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">y</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="dynexp"><span class="keyword">$ldelay</span>
<span class="keyword">(</span>
<span class="keyword">(</span>
<span class="keyword">case+</span> ys <span class="keyword">of</span>
<span class="keyword">|</span> list_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">!</span><span class="keyword">(</span>auxmain<span class="keyword">(</span>xs<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">|</span> list_cons<span class="keyword">(</span>y<span class="keyword">,</span> ys<span class="keyword">)</span> <span class="keyword">=&gt;</span>
    stream_vt_cons<span class="keyword">(</span><span class="keyword">(</span>x0<span class="keyword">,</span> y<span class="keyword">)</span><span class="keyword">,</span> auxmain2<span class="keyword">(</span>x0<span class="keyword">,</span> xs<span class="keyword">,</span> ys<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">)</span>
<span class="keyword">,</span>
<span class="keyword">~</span><span class="keyword">(</span>xs<span class="keyword">)</span> <span class="comment">// called when the stream is freed</span>
<span class="keyword">)</span></span></span> <span class="comment">(* end of [auxmain2] *)</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  auxmain<span class="keyword">(</span>xs0<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [cross_stream_vt_list]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">x<span class="keyword">,</span>y</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
cross_stream_vt_list_vt
  <span class="keyword">(</span>xs0<span class="keyword">,</span> ys0<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> ys0 <span class="keyword">=</span>
  $UN<span class="keyword">.</span>castvwtp0<span class="staexp"><span class="keyword">{</span>ptr<span class="keyword">}</span></span><span class="keyword">(</span>ys0<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
auxmain
<span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="keyword">@(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">y</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="dynexp"><span class="keyword">$ldelay</span>
<span class="keyword">(</span>
<span class="keyword">(</span>
<span class="keyword">case+</span> <span class="keyword">!</span>xs <span class="keyword">of</span>
<span class="keyword">|</span> <span class="keyword">~</span>stream_vt_nil
    <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> stream_vt_nil<span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">|</span> <span class="keyword">~</span>stream_vt_cons<span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span>
    <span class="keyword">!</span><span class="keyword">(</span>auxmain2<span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">,</span> $UN<span class="keyword">.</span>cast<span class="keyword">{</span>List<span class="keyword">(</span>y<span class="keyword">)</span><span class="keyword">}</span><span class="keyword">(</span>ys0<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">)</span>
<span class="keyword">,</span>
<span class="keyword">(</span><span class="keyword">~</span>xs<span class="keyword">;</span> list_vt_free&lt;y<span class="keyword">&gt;</span><span class="keyword">(</span>$UN<span class="keyword">.</span>castvwtp0<span class="keyword">{</span>List_vt<span class="keyword">(</span>y<span class="keyword">)</span><span class="keyword">}</span><span class="keyword">(</span>ys0<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">)</span></span> <span class="comment">(* end of [auxmain] *)</span>
<span class="comment">//</span>
<span class="keyword">and</span>
auxmain2
<span class="keyword">(</span>
  x0<span class="keyword">:</span> <span class="staexp">x</span>
<span class="keyword">,</span> xs<span class="keyword">:</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">x</span><span class="keyword">)</span><span class="keyword">,</span> ys<span class="keyword">:</span> <span class="staexp">List</span><span class="keyword">(</span><span class="staexp">y</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="keyword">@(</span><span class="staexp">x</span><span class="keyword">,</span> <span class="staexp">y</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="dynexp"><span class="keyword">$ldelay</span>
<span class="keyword">(</span>
<span class="keyword">(</span>
<span class="keyword">case+</span> ys <span class="keyword">of</span>
<span class="keyword">|</span> list_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">!</span><span class="keyword">(</span>auxmain<span class="keyword">(</span>xs<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">|</span> list_cons<span class="keyword">(</span>y<span class="keyword">,</span> ys<span class="keyword">)</span> <span class="keyword">=&gt;</span>
    stream_vt_cons<span class="keyword">(</span><span class="keyword">(</span>x0<span class="keyword">,</span> y<span class="keyword">)</span><span class="keyword">,</span> auxmain2<span class="keyword">(</span>x0<span class="keyword">,</span> xs<span class="keyword">,</span> ys<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">)</span>
<span class="keyword">,</span>
<span class="keyword">(</span><span class="keyword">~</span>xs<span class="keyword">;</span> list_vt_free&lt;y<span class="keyword">&gt;</span><span class="keyword">(</span>$UN<span class="keyword">.</span>castvwtp0<span class="keyword">{</span>List_vt<span class="keyword">(</span>y<span class="keyword">)</span><span class="keyword">}</span><span class="keyword">(</span>ys0<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">)</span></span></span> <span class="comment">(* end of [auxmain2] *)</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  auxmain<span class="keyword">(</span>xs0<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [cross_stream_vt_list_vt]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
stream_vt_fprint
  <span class="keyword">(</span>xs<span class="keyword">,</span> out<span class="keyword">,</span> n<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
loop1
<span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">int</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">(</span>
<span class="comment">//</span>
<span class="keyword">case+</span> <span class="keyword">!</span>xs <span class="keyword">of</span>
<span class="keyword">|</span> <span class="keyword">~</span>stream_vt_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">|</span> <span class="keyword">~</span>stream_vt_cons<span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span>
  <span class="keyword">(</span>
    <span class="keyword">(</span><span class="keyword">if</span> i <span class="keyword">&gt;</span> <span class="dynexp">0</span> <span class="keyword">then</span> stream_vt_fprint$sep&lt;<span class="keyword">&gt;</span><span class="keyword">(</span>out<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">;</span> fprint_val&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>out<span class="keyword">,</span> x<span class="keyword">)</span><span class="keyword">;</span> loop1<span class="keyword">(</span>xs<span class="keyword">,</span> i+<span class="dynexp">1</span><span class="keyword">)</span>
  <span class="keyword">)</span> <span class="comment">(* end of [stream_vt_cons] *)</span>
<span class="comment">//</span>
<span class="keyword">)</span></span> <span class="comment">(* end of [loop1] *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
loop2
<span class="keyword">(</span>
  xs<span class="keyword">:</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">int</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">(</span>
<span class="comment">//</span>
<span class="keyword">if</span> <span class="keyword">(</span>
i <span class="keyword">&lt;</span> n
<span class="keyword">)</span> <span class="keyword">then</span> <span class="keyword">(</span>
<span class="comment">//</span>
<span class="keyword">case+</span> <span class="keyword">!</span>xs <span class="keyword">of</span>
<span class="keyword">|</span> <span class="keyword">~</span>stream_vt_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">|</span> <span class="keyword">~</span>stream_vt_cons<span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span>
  <span class="keyword">(</span>
    <span class="keyword">(</span><span class="keyword">if</span> i <span class="keyword">&gt;</span> <span class="dynexp">0</span> <span class="keyword">then</span> stream_vt_fprint$sep&lt;<span class="keyword">&gt;</span><span class="keyword">(</span>out<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">;</span> fprint_val&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>out<span class="keyword">,</span> x<span class="keyword">)</span><span class="keyword">;</span> loop2<span class="keyword">(</span>xs<span class="keyword">,</span> i+<span class="dynexp">1</span><span class="keyword">)</span>
  <span class="keyword">)</span> <span class="comment">(* end of [stream_vt_cons] *)</span>
<span class="comment">//</span>
<span class="keyword">)</span> <span class="keyword">else</span> <span class="keyword">~</span><span class="keyword">(</span>xs<span class="keyword">)</span> <span class="comment">// end of [if]</span>
<span class="comment">//</span>
<span class="keyword">)</span></span>
<span class="comment">(* end of [loop2] *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span>
  stream_vt_fprint$beg<span class="keyword">(</span>out<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
  <span class="keyword">if</span> n <span class="keyword">&lt;</span> <span class="dynexp">0</span>
    <span class="keyword">then</span> loop1<span class="keyword">(</span>xs<span class="keyword">,</span> <span class="dynexp">0</span><span class="comment">(*i*)</span><span class="keyword">)</span> <span class="keyword">else</span> loop2<span class="keyword">(</span>xs<span class="keyword">,</span> <span class="dynexp">0</span><span class="comment">(*i*)</span><span class="keyword">)</span>
  <span class="comment">// end of [val]</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span></span> <span class="comment">// end of [val]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span>
  stream_vt_fprint$end<span class="keyword">(</span>out<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">in</span>
  <span class="comment">// nothing</span>
<span class="keyword">end</span></span></span> <span class="comment">// end of [stream_vt_fprint]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
stream_vt_fprint$beg<span class="keyword">(</span>out<span class="keyword">)</span> <span class="keyword">=</span> fprint_string<span class="keyword">(</span>out<span class="keyword">,</span> <span class="dynstr">"("</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
stream_vt_fprint$end<span class="keyword">(</span>out<span class="keyword">)</span> <span class="keyword">=</span> fprint_string<span class="keyword">(</span>out<span class="keyword">,</span> <span class="dynstr">")"</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
stream_vt_fprint$sep<span class="keyword">(</span>out<span class="keyword">)</span> <span class="keyword">=</span> fprint_string<span class="keyword">(</span>out<span class="keyword">,</span> <span class="dynstr">", "</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">local</span>
<span class="comment">//</span>
<span class="keyword">datavtype</span> <span class="staexp">streamer
  <span class="keyword">(</span>a<span class="keyword">:</span><span class="keyword">vt@ype+</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="dynexp">STREAMER <span class="keyword">of</span> <span class="keyword">(</span><span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span></span></span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">assume</span> streamer_vtype <span class="keyword">(</span>a<span class="keyword">:</span>vt0p<span class="keyword">)</span> <span class="keyword">=</span> streamer <span class="keyword">(</span>a<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span> <span class="comment">(* in-of-local *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
streamer_vt_make <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span> STREAMER <span class="keyword">(</span>xs<span class="keyword">)</span></span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
streamer_vt_free
  <span class="keyword">(</span>xser<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span> <span class="dynexp"><span class="keyword">val+</span><span class="keyword">~</span>STREAMER<span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span> xser</span> <span class="keyword">in</span> <span class="keyword">~</span>xs <span class="keyword">end</span></span>
<span class="comment">// end of [streamer_free]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
streamer_vt_eval_exn
  <span class="keyword">(</span>xser<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val+</span><span class="keyword">@</span>STREAMER<span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span> xser</span>
<span class="comment">//</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">case+</span> <span class="keyword">!</span>xs <span class="keyword">of</span>
<span class="keyword">|</span> <span class="keyword">~</span>stream_vt_cons
    <span class="keyword">(</span>x<span class="keyword">,</span> xs2<span class="keyword">)</span> <span class="keyword">=&gt;</span>
  <span class="keyword">(</span>
    xs := xs2<span class="keyword">;</span> <span class="keyword">fold@</span><span class="keyword">(</span>xser<span class="keyword">)</span><span class="keyword">;</span> x
  <span class="keyword">)</span> <span class="comment">(* end of [stream_vt_cons] *)</span>
<span class="keyword">|</span> <span class="keyword">~</span>stream_vt_nil
    <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
    <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span>
     __assert <span class="keyword">(</span><span class="dynexp"><span class="keyword">view@</span></span>xs<span class="keyword">)</span> <span class="keyword">where</span>
    <span class="keyword">{</span>
      <span class="keyword">extern</span>
      <span class="prfexp"><span class="keyword">praxi</span> __assert<span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span><span class="keyword">(</span><span class="staexp"><span class="keyword">!</span></span><span class="staexp">ptr</span><span class="staexp"><span class="keyword">@</span></span><span class="staexp">l</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">stream_vt</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="staexp"><span class="keyword">@</span></span><span class="staexp">l</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
    <span class="keyword">}</span></span> <span class="comment">(* end of [prval] *)</span>
    <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">fold@</span><span class="keyword">(</span>xser<span class="keyword">)</span></span>
  <span class="keyword">in</span>
    <span class="dynexp"><span class="keyword">$raise</span> StreamSubscriptExn<span class="keyword">(</span><span class="keyword">)</span></span>
  <span class="keyword">end</span> <span class="comment">(* end of [stream_vt_nil] *)</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [stream_eval_exn]</span>

<span class="keyword">end</span> <span class="comment">// end of [local]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* end of [stream_vt.dats] *)</span>
</pre>
<pre class="patsyntax">
<span class="comment">(***********************************************************************)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(*                         Applied Type System                         *)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(***********************************************************************)</span>

<span class="comment">(*
** ATS/Postiats - Unleashing the Potential of Types!
** Copyright (C) 2010-2015 Hongwei Xi, ATS Trustful Software, Inc.
** All rights reserved
**
** ATS is free software;  you can  redistribute it and/or modify it under
** the terms of  the GNU GENERAL PUBLIC LICENSE (GPL) as published by the
** Free Software Foundation; either version 3, or (at  your  option)  any
** later version.
**
** ATS is distributed in the hope that it will be useful, but WITHOUT ANY
** WARRANTY; without  even  the  implied  warranty  of MERCHANTABILITY or
** FITNESS FOR A PARTICULAR PURPOSE.  See the  GNU General Public License
** for more details.
**
** You  should  have  received  a  copy of the GNU General Public License
** along  with  ATS;  see the  file COPYING.  If not, please write to the
** Free Software Foundation,  51 Franklin Street, Fifth Floor, Boston, MA
** 02110-1301, USA.
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
** Source:
** $PATSHOME/prelude/DATS/CODEGEN/array.atxt
** Time of generation: Sun Oct  2 10:33:59 2016
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* Author: Hongwei Xi *)</span>
<span class="comment">(* Authoremail: hwxi AT cs DOT bu DOT edu *)</span>
<span class="comment">(* Start time: Feburary, 2012 *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">staload</span> UN <span class="keyword">=</span> "prelude/SATS/unsafe.sats"
<span class="keyword">staload</span> IT <span class="keyword">=</span> "prelude/SATS/giterator.sats"

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">macdef</span> castvwtp_trans <span class="keyword">=</span> $UN<span class="keyword">.</span>castvwtp0</span> <span class="comment">// former name</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
array_getref_at
  <span class="keyword">(</span>A<span class="keyword">,</span> i<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> p <span class="keyword">=</span>
  ptr0_add_guint&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="dynexp"><span class="keyword">addr@</span></span><span class="keyword">(</span>A<span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">)</span></span> <span class="keyword">in</span> $UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>cPtr1<span class="keyword">(</span>a<span class="keyword">)</span><span class="keyword">}</span></span><span class="keyword">(</span>p<span class="keyword">)</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [array_getref_at]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">tk</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
array_get_at_gint <span class="keyword">(</span>A<span class="keyword">,</span> i<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> p <span class="keyword">=</span> ptr0_add_gint&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="dynexp"><span class="keyword">addr@</span></span><span class="keyword">(</span>A<span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">)</span></span> <span class="keyword">in</span> $UN<span class="keyword">.</span>ptr0_get&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>p<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [array_get_at_gint]</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">tk</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
array_get_at_guint <span class="keyword">(</span>A<span class="keyword">,</span> i<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> p <span class="keyword">=</span> ptr0_add_guint&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="dynexp"><span class="keyword">addr@</span></span><span class="keyword">(</span>A<span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">)</span></span> <span class="keyword">in</span> $UN<span class="keyword">.</span>ptr0_get&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>p<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [array_get_at_guint]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">tk</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
array_set_at_gint <span class="keyword">(</span>A<span class="keyword">,</span> i<span class="keyword">,</span> x<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> p <span class="keyword">=</span> ptr0_add_gint&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="dynexp"><span class="keyword">addr@</span></span><span class="keyword">(</span>A<span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">)</span></span> <span class="keyword">in</span> $UN<span class="keyword">.</span>ptr0_set&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>p<span class="keyword">,</span> x<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [array_set_at_uint]</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">tk</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
array_set_at_guint <span class="keyword">(</span>A<span class="keyword">,</span> i<span class="keyword">,</span> x<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> p <span class="keyword">=</span> ptr0_add_guint&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="dynexp"><span class="keyword">addr@</span></span><span class="keyword">(</span>A<span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">)</span></span> <span class="keyword">in</span> $UN<span class="keyword">.</span>ptr0_set&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>p<span class="keyword">,</span> x<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [array_set_at_guint]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">tk</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
array_exch_at_gint <span class="keyword">(</span>A<span class="keyword">,</span> i<span class="keyword">,</span> x<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> p <span class="keyword">=</span> ptr0_add_gint&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="dynexp"><span class="keyword">addr@</span></span><span class="keyword">(</span>A<span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">)</span></span> <span class="keyword">in</span> $UN<span class="keyword">.</span>ptr0_exch&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>p<span class="keyword">,</span> x<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [array_exch_at_gint]</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">tk</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
array_exch_at_guint <span class="keyword">(</span>A<span class="keyword">,</span> i<span class="keyword">,</span> x<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> p <span class="keyword">=</span> ptr0_add_guint&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="dynexp"><span class="keyword">addr@</span></span><span class="keyword">(</span>A<span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">)</span></span> <span class="keyword">in</span> $UN<span class="keyword">.</span>ptr0_exch&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>p<span class="keyword">,</span> x<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [array_exch_at_guint]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
array_subreverse
  <span class="keyword">(</span>A<span class="keyword">,</span> i<span class="keyword">,</span> j<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
loop
<span class="keyword">(</span>
  p1<span class="keyword">:</span> <span class="staexp">ptr</span><span class="keyword">,</span> p2<span class="keyword">:</span> <span class="staexp">ptr</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span>
<span class="keyword">(</span>
<span class="keyword">if</span>
p1 <span class="keyword">&lt;</span> p2
<span class="keyword">then</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> x <span class="keyword">=</span> $UN<span class="keyword">.</span>ptr0_get&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>p1<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span>
  $UN<span class="keyword">.</span>ptr0_set&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>p1<span class="keyword">,</span> $UN<span class="keyword">.</span>ptr0_get&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>p2<span class="keyword">)</span><span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> $UN<span class="keyword">.</span>ptr0_set&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>p2<span class="keyword">,</span> x<span class="keyword">)</span></span>
<span class="keyword">in</span>
  loop <span class="keyword">(</span>ptr0_succ&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>p1<span class="keyword">)</span><span class="keyword">,</span> ptr0_pred&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>p2<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [then]</span>
<span class="keyword">else</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="comment">// end of [else]</span>
<span class="keyword">)</span></span> <span class="comment">(* end of [loop] *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> pA <span class="keyword">=</span> <span class="dynexp"><span class="keyword">addr@</span></span>A</span>
<span class="dynexp"><span class="keyword">val</span> pi <span class="keyword">=</span> ptr_add&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>pA<span class="keyword">,</span> i<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> pj <span class="keyword">=</span> ptr_add&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>pA<span class="keyword">,</span> j<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  <span class="keyword">$effmask_all</span><span class="keyword">(</span>loop <span class="keyword">(</span>pi<span class="keyword">,</span> ptr0_pred&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>pj<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [array_subreverse]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
array_interchange
  <span class="keyword">(</span>A<span class="keyword">,</span> i<span class="keyword">,</span> j<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="comment">(*
val () =
  println! ("array_interchange")
*)</span>
<span class="comment">//</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">if</span> i != j <span class="keyword">then</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> p0 <span class="keyword">=</span> <span class="dynexp"><span class="keyword">addr@</span></span><span class="keyword">(</span>A<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> pi <span class="keyword">=</span> ptr0_add_guint&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>p0<span class="keyword">,</span> i<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> pj <span class="keyword">=</span>
    g1ofg0_ptr<span class="keyword">(</span>ptr0_add_guint&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>p0<span class="keyword">,</span> j<span class="keyword">)</span><span class="keyword">)</span></span>
  <span class="comment">// end of [val]</span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pf</span><span class="keyword">,</span> <span class="prfexp">fpf</span> <span class="keyword">|</span> pj<span class="keyword">)</span> <span class="keyword">=</span> $UN<span class="keyword">.</span>ptr_vtake<span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="keyword">(</span>pj<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> $UN<span class="keyword">.</span>ptr0_exch&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>pi<span class="keyword">,</span> <span class="keyword">!</span>pj<span class="keyword">)</span></span>
  <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="comment">(*returned*)</span><span class="keyword">)</span> <span class="keyword">=</span> fpf<span class="keyword">(</span>pf<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">in</span>
  <span class="comment">// nothing</span>
<span class="keyword">end</span></span> <span class="keyword">else</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="comment">// end of [if]</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [array_interchange]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
array_subcirculate
  <span class="keyword">(</span>A<span class="keyword">,</span> i<span class="keyword">,</span> j<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="keyword">extern</span>
<span class="dynexp"><span class="keyword">fun</span>
memmove
<span class="keyword">(</span>
  dst<span class="keyword">:</span> <span class="staexp">ptr</span><span class="keyword">,</span> src<span class="keyword">:</span> <span class="staexp">ptr</span><span class="keyword">,</span> bsz<span class="keyword">:</span> <span class="staexp">size_t</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">ptr</span> <span class="keyword">=</span> "mac#atspre_array_memmove"</span>
<span class="comment">//</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">if</span> i <span class="keyword">&lt;</span> j <span class="keyword">then</span>
<span class="keyword">{</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> p0 <span class="keyword">=</span>
  ptr_add&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="dynexp"><span class="keyword">addr@</span></span><span class="keyword">(</span>A<span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> p1 <span class="keyword">=</span>
  ptr_add&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="dynexp"><span class="keyword">addr@</span></span><span class="keyword">(</span>A<span class="keyword">)</span><span class="keyword">,</span> j<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> A1 <span class="keyword">=</span> $UN<span class="keyword">.</span>ptr0_get&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>p1<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> _<span class="comment">(*ptr*)</span> <span class="keyword">=</span> memmove <span class="keyword">(</span>ptr_succ&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>p0<span class="keyword">)</span><span class="keyword">,</span> p0<span class="keyword">,</span> <span class="keyword">(</span>j-i<span class="keyword">)</span>*sizeof&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span> <span class="keyword">=</span> $UN<span class="keyword">.</span>ptr0_set&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>p0<span class="keyword">,</span> A1<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">}</span> <span class="keyword">else</span> <span class="keyword">if</span> i <span class="keyword">&gt;</span> j <span class="keyword">then</span>
<span class="keyword">{</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> p0 <span class="keyword">=</span>
  ptr_add&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="dynexp"><span class="keyword">addr@</span></span><span class="keyword">(</span>A<span class="keyword">)</span><span class="keyword">,</span> j<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> p1 <span class="keyword">=</span>
  ptr_add&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="dynexp"><span class="keyword">addr@</span></span><span class="keyword">(</span>A<span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> A0 <span class="keyword">=</span> $UN<span class="keyword">.</span>ptr0_get&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>p0<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> _<span class="comment">(*ptr*)</span> <span class="keyword">=</span> memmove <span class="keyword">(</span>p0<span class="keyword">,</span> ptr_succ&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>p0<span class="keyword">)</span><span class="keyword">,</span> <span class="keyword">(</span>i-j<span class="keyword">)</span>*sizeof&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span> <span class="keyword">=</span> $UN<span class="keyword">.</span>ptr0_set&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>p1<span class="keyword">,</span> A0<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">}</span> <span class="keyword">else</span> <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span> <span class="comment">// end of [if]</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [array_subcirculate]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
array_ptr_takeout
  <span class="staexp"><span class="keyword">{</span>l<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>n<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>i<span class="keyword">}</span></span><span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> p<span class="keyword">,</span> i<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="prfexp"><span class="keyword">prval</span><span class="keyword">(</span>pf<span class="keyword">,</span> fpf<span class="keyword">)</span> <span class="keyword">=</span>
    array_v_takeout<span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>l<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>n<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>i<span class="keyword">}</span></span><span class="keyword">(</span>pf<span class="keyword">)</span></span>
  <span class="comment">// end of [prval]</span>
<span class="keyword">in</span>
  <span class="keyword">(</span><span class="prfexp">pf</span><span class="keyword">,</span> <span class="prfexp">fpf</span> <span class="keyword">|</span> ptr1_add_guint&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>p<span class="keyword">,</span> i<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [array_ptr_takeout]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
array_ptr_alloc
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">}</span></span><span class="keyword">(</span>asz<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span>
<span class="keyword">[</span><span class="staexp">l<span class="keyword">:</span>addr</span><span class="keyword">]</span>
<span class="keyword">(</span>
  <span class="prfexp">pf</span><span class="keyword">,</span> <span class="prfexp">pfgc</span> <span class="keyword">|</span> p
<span class="keyword">)</span> <span class="keyword">=</span> malloc_gc <span class="keyword">(</span>asz * sizeof&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">)</span></span>
<span class="prfexp"><span class="keyword">prval</span> pf <span class="keyword">=</span>
__assert <span class="keyword">(</span>pf<span class="keyword">)</span> <span class="keyword">where</span>
<span class="keyword">{</span>
<span class="keyword">extern</span> <span class="prfexp"><span class="keyword">praxi</span> __assert
  <span class="keyword">(</span>pf<span class="keyword">:</span> <span class="staexp">b0ytes</span> <span class="keyword">(</span><span class="staexp">n</span><span class="staexp">*</span><span class="staexp">sizeof</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span> <span class="staexp"><span class="keyword">@</span></span> <span class="staexp">l</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">array_v</span> <span class="keyword">(</span><span class="staexp">a</span><span class="staexp">?</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="comment">// end of [__assert]</span>
<span class="keyword">}</span></span> <span class="comment">// end of [where] // end of [prval]</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  <span class="keyword">(</span><span class="prfexp">pf</span><span class="keyword">,</span> <span class="prfexp">pfgc</span> <span class="keyword">|</span> p<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [array_ptr_alloc]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
array_ptr_free
  <span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>l<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>n<span class="keyword">}</span></span>
  <span class="keyword">(</span><span class="prfexp">pf</span><span class="keyword">,</span> <span class="prfexp">pfgc</span> <span class="keyword">|</span> p<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span> pf <span class="keyword">=</span>
__assert <span class="keyword">(</span>pf<span class="keyword">)</span> <span class="keyword">where</span>
<span class="keyword">{</span>
<span class="comment">//</span>
<span class="keyword">extern</span> <span class="prfexp"><span class="keyword">praxi</span> __assert
  <span class="keyword">(</span>pf<span class="keyword">:</span> <span class="staexp">array_v</span> <span class="keyword">(</span><span class="staexp">a</span><span class="staexp">?</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">b0ytes</span> <span class="keyword">(</span><span class="staexp">n</span><span class="staexp">*</span><span class="staexp">sizeof</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span> <span class="staexp"><span class="keyword">@</span></span> <span class="staexp">l</span></span>
<span class="comment">// end of [__assert]</span>
<span class="keyword">}</span></span> <span class="comment">// end of [where] // end of [prval]</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  mfree_gc <span class="keyword">(</span><span class="prfexp">pf</span><span class="keyword">,</span> <span class="prfexp">pfgc</span> <span class="keyword">|</span> p<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [array_ptr_free]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span>
array_ptr_tabulate
  <span class="keyword">(</span>asz<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span>
<span class="keyword">(</span>
  <span class="prfexp">pf</span><span class="keyword">,</span> <span class="prfexp">pfgc</span> <span class="keyword">|</span> p
<span class="keyword">)</span> <span class="keyword">=</span> array_ptr_alloc&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>asz<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">local</span>
<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span>
array_initize$init
  <span class="keyword">(</span>i<span class="keyword">,</span> x<span class="keyword">)</span> <span class="keyword">=</span>
  <span class="keyword">(</span>x := array_tabulate$fopr&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>i<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="keyword">in</span> <span class="comment">(*in of [local]*)</span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> array_initize&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="keyword">!</span>p<span class="keyword">,</span> asz<span class="keyword">)</span></span>
<span class="keyword">end</span> <span class="comment">// end of [local]</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  <span class="keyword">@(</span><span class="prfexp">pf</span><span class="keyword">,</span> <span class="prfexp">pfgc</span> <span class="keyword">|</span> p<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [array_ptr_tabulate]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span>
fprint_array_int
  <span class="keyword">(</span>out<span class="keyword">,</span> A<span class="keyword">,</span> asz<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> lemma_array_param<span class="keyword">(</span>A<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  fprint_array_size <span class="keyword">(</span>out<span class="keyword">,</span> A<span class="keyword">,</span> i2sz<span class="keyword">(</span>asz<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [fprint_array_int]</span>

<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span>
fprint_array_size
  <span class="keyword">(</span>out<span class="keyword">,</span> A<span class="keyword">,</span> asz<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="keyword">typedef</span> <span class="staexp">tenv <span class="keyword">=</span> <span class="staexp">int</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
array_foreach$fwork&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">tenv</span><span class="keyword">&gt;</span>
  <span class="keyword">(</span>x<span class="keyword">,</span> env<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> n <span class="keyword">=</span> env</span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">if</span> n <span class="keyword">&gt;</span> <span class="dynexp">0</span> <span class="keyword">then</span> fprint_array$sep&lt;<span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> env := n + <span class="dynexp">1</span></span>
<span class="keyword">in</span>
  fprint_ref&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">,</span> x<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [array_foreach$fwork]</span>
<span class="comment">//</span>
<span class="keyword">var</span> env<span class="keyword">:</span> <span class="staexp">tenv</span> <span class="keyword">=</span> <span class="dynexp">0</span>
<span class="dynexp"><span class="keyword">val</span> _<span class="comment">(*n*)</span> <span class="keyword">=</span> array_foreach_env&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">tenv</span><span class="keyword">&gt;</span> <span class="keyword">(</span>A<span class="keyword">,</span> asz<span class="keyword">,</span> env<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">in</span>
  <span class="comment">// nothing</span>
<span class="keyword">end</span></span></span> <span class="comment">// end of [fprint_array_size]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span>
fprint_array$sep <span class="keyword">(</span>out<span class="keyword">)</span> <span class="keyword">=</span> fprint <span class="keyword">(</span>out<span class="keyword">,</span> <span class="dynstr">", "</span><span class="keyword">)</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span>
fprint_array_sep
  <span class="keyword">(</span>out<span class="keyword">,</span> A<span class="keyword">,</span> asz<span class="keyword">,</span> sep<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
fprint_array$sep&lt;<span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">)</span> <span class="keyword">=</span> fprint <span class="keyword">(</span>out<span class="keyword">,</span> sep<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  fprint_array&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">,</span> A<span class="keyword">,</span> asz<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [fprint_array_sep]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
array_copy
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">}</span></span> <span class="keyword">(</span>to<span class="keyword">,</span> from<span class="keyword">,</span> n<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> p_to <span class="keyword">=</span> <span class="dynexp"><span class="keyword">addr@</span></span><span class="keyword">(</span>to<span class="keyword">)</span> <span class="keyword">and</span> p_from <span class="keyword">=</span> <span class="dynexp"><span class="keyword">addr@</span></span><span class="keyword">(</span>from<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> _ <span class="keyword">=</span>
<span class="dynexp"><span class="keyword">$extfcall</span>
<span class="keyword">(</span>
  ptr<span class="keyword">,</span> "atspre_array_memcpy"<span class="keyword">,</span> p_to<span class="keyword">,</span> p_from<span class="keyword">,</span> n*sizeof&lt;a<span class="keyword">&gt;</span>
<span class="keyword">)</span></span></span> <span class="comment">(* end of [val] *)</span>
<span class="comment">//</span>
<span class="keyword">extern</span>
<span class="prfexp"><span class="keyword">praxi</span> __assert <span class="staexp"><span class="keyword">{</span>l1<span class="keyword">,</span>l2<span class="keyword">:</span>addr<span class="keyword">}</span></span>
<span class="keyword">(</span>
  pf1<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">array_v</span><span class="keyword">(</span><span class="staexp">a</span><span class="staexp">?</span><span class="keyword">,</span> <span class="staexp">l1</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">array_v</span><span class="keyword">(</span><span class="staexp">a</span>  <span class="keyword">,</span> <span class="staexp">l1</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">,</span> pf2<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">array_v</span><span class="keyword">(</span><span class="staexp">a</span> <span class="keyword">,</span> <span class="staexp">l2</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">array_v</span><span class="keyword">(</span><span class="staexp">a</span><span class="staexp">?!</span><span class="keyword">,</span> <span class="staexp">l2</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span></span> <span class="comment">// end of [__assert]</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> __assert<span class="keyword">(</span><span class="dynexp"><span class="keyword">view@</span></span><span class="keyword">(</span>to<span class="keyword">)</span><span class="keyword">,</span> <span class="dynexp"><span class="keyword">view@</span></span><span class="keyword">(</span>from<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">in</span>
  <span class="comment">// nothing</span>
<span class="keyword">end</span></span></span> <span class="comment">// end of [array_copy]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span>
array_copy_from_list
  <span class="keyword">(</span>A<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> lemma_list_param<span class="keyword">(</span>xs<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> loop
  <span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>nat<span class="keyword">}</span></span> <span class="keyword">.&lt;</span><span class="staexp">n</span><span class="keyword">&gt;.</span>
<span class="keyword">(</span>
  <span class="prfexp">pf<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">array_v</span> <span class="keyword">(</span><span class="staexp">a</span><span class="staexp">?</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">array_v</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="keyword">|</span> p0<span class="keyword">:</span> <span class="staexp">ptr</span> <span class="staexp">l</span><span class="keyword">,</span> xs<span class="keyword">:</span> <span class="staexp">list</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">(</span>
  <span class="keyword">case+</span> xs <span class="keyword">of</span>
  <span class="keyword">|</span> list_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span>pf := array_v_unnil_nil<span class="keyword">(</span>pf<span class="keyword">)</span><span class="keyword">)</span></span>
    <span class="dynexp"><span class="keyword">in</span>
      <span class="comment">// nothing</span>
    <span class="keyword">end</span></span> <span class="comment">// end of [list_nil]</span>
  <span class="keyword">|</span> list_cons<span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="prfexp"><span class="keyword">prval</span>
      <span class="keyword">(</span>pf1<span class="keyword">,</span> pf2<span class="keyword">)</span> <span class="keyword">=</span> array_v_uncons<span class="keyword">(</span>pf<span class="keyword">)</span></span>
      <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">!</span>p0 := x</span>
      <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> loop <span class="keyword">(</span><span class="prfexp">pf2</span> <span class="keyword">|</span> ptr1_succ&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>p0<span class="keyword">)</span><span class="keyword">,</span> xs<span class="keyword">)</span></span>
      <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span>pf := array_v_cons<span class="keyword">(</span>pf1<span class="keyword">,</span> pf2<span class="keyword">)</span><span class="keyword">)</span></span>
    <span class="dynexp"><span class="keyword">in</span>
      <span class="comment">// nothing</span>
    <span class="keyword">end</span></span> <span class="comment">// end of [list_cons]</span>
<span class="keyword">)</span></span> <span class="comment">(* end of [loop] *)</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  loop <span class="keyword">(</span><span class="prfexp"><span class="dynexp"><span class="keyword">view@</span></span><span class="keyword">(</span>A<span class="keyword">)</span></span> <span class="keyword">|</span> <span class="dynexp"><span class="keyword">addr@</span></span><span class="keyword">(</span>A<span class="keyword">)</span><span class="keyword">,</span> xs<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [array_copy_from_list]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span>
array_copy_from_list_vt
  <span class="keyword">(</span>A<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> lemma_list_vt_param<span class="keyword">(</span>xs<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> loop
  <span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>nat<span class="keyword">}</span></span> <span class="keyword">.&lt;</span><span class="staexp">n</span><span class="keyword">&gt;.</span>
<span class="keyword">(</span>
  <span class="prfexp">pf<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">array_v</span><span class="keyword">(</span><span class="staexp">a</span><span class="staexp">?</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span>
        <span class="staexp">&gt;&gt;</span> <span class="staexp">array_v</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="keyword">|</span> p0<span class="keyword">:</span> <span class="staexp">ptr</span> <span class="staexp">l</span><span class="keyword">,</span> xs<span class="keyword">:</span> <span class="staexp">list_vt</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">(</span>
  <span class="keyword">case+</span> xs <span class="keyword">of</span>
  <span class="keyword">|</span> <span class="keyword">~</span>list_vt_nil<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span>
        <span class="keyword">(</span>pf := array_v_unnil_nil<span class="keyword">(</span>pf<span class="keyword">)</span><span class="keyword">)</span></span>
      <span class="comment">// end of [prval]</span>
    <span class="dynexp"><span class="keyword">in</span>
      <span class="comment">// nothing</span>
    <span class="keyword">end</span></span> <span class="comment">// end of [list_vt_nil]</span>
  <span class="keyword">|</span> <span class="keyword">~</span>list_vt_cons<span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="prfexp"><span class="keyword">prval</span>
      <span class="keyword">(</span>pf1<span class="keyword">,</span> pf2<span class="keyword">)</span> <span class="keyword">=</span> array_v_uncons<span class="keyword">(</span>pf<span class="keyword">)</span></span>
      <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">!</span>p0 := x</span>
      <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span>
        loop<span class="keyword">(</span><span class="prfexp">pf2</span> <span class="keyword">|</span> ptr1_succ&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>p0<span class="keyword">)</span><span class="keyword">,</span> xs<span class="keyword">)</span></span>
      <span class="comment">// end of [val]</span>
      <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> pf := array_v_cons<span class="keyword">(</span>pf1<span class="keyword">,</span> pf2<span class="keyword">)</span></span>
    <span class="dynexp"><span class="keyword">in</span>
      <span class="comment">// nothing</span>
    <span class="keyword">end</span></span> <span class="comment">// end of [list_vt_cons]</span>
<span class="keyword">)</span></span> <span class="comment">(* end of [loop] *)</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  loop <span class="keyword">(</span><span class="prfexp"><span class="dynexp"><span class="keyword">view@</span></span><span class="keyword">(</span>A<span class="keyword">)</span></span> <span class="keyword">|</span> <span class="dynexp"><span class="keyword">addr@</span></span><span class="keyword">(</span>A<span class="keyword">)</span><span class="keyword">,</span> xs<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [array_copy_from_list_vt]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span>
array_copy_to_list_vt
  <span class="keyword">(</span>A<span class="keyword">,</span> n<span class="keyword">)</span> <span class="keyword">=</span> res <span class="keyword">where</span> <span class="keyword">{</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> lemma_array_param<span class="keyword">(</span>A<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
loop
<span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>nat<span class="keyword">}</span></span> <span class="keyword">.&lt;</span><span class="staexp">n</span><span class="keyword">&gt;.</span>
<span class="keyword">(</span>
  <span class="prfexp">pf<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">array_v</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">array_v</span> <span class="keyword">(</span><span class="staexp">a</span><span class="staexp">?!</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="keyword">|</span> p0<span class="keyword">:</span> <span class="staexp">ptr</span> <span class="staexp">l</span><span class="keyword">,</span> nz<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="staexp">n</span><span class="keyword">,</span> res<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">ptr</span><span class="staexp">?</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">list_vt</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">(</span>
<span class="comment">//</span>
<span class="keyword">if</span>
nz <span class="keyword">&gt;</span> <span class="dynexp">0</span>
<span class="keyword">then</span> <span class="keyword">let</span>
  <span class="prfexp"><span class="keyword">prval</span>
  <span class="keyword">(</span>pf1<span class="keyword">,</span> pf2<span class="keyword">)</span> <span class="keyword">=</span> array_v_uncons<span class="keyword">(</span>pf<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span>
    res := list_vt_cons<span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>0<span class="keyword">}</span></span><span class="keyword">(</span><span class="keyword">!</span>p0<span class="keyword">,</span> _<span class="keyword">)</span></span>
  <span class="comment">// end of [val]</span>
  <span class="dynexp"><span class="keyword">val+</span>list_vt_cons <span class="keyword">(</span>_<span class="keyword">,</span> res1<span class="keyword">)</span> <span class="keyword">=</span> res</span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> loop<span class="keyword">(</span><span class="prfexp">pf2</span> <span class="keyword">|</span> ptr1_succ&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>p0<span class="keyword">)</span><span class="keyword">,</span> pred<span class="keyword">(</span>nz<span class="keyword">)</span><span class="keyword">,</span> res1<span class="keyword">)</span></span>
  <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span>pf := array_v_cons<span class="keyword">(</span>pf1<span class="keyword">,</span> pf2<span class="keyword">)</span><span class="keyword">)</span></span>
  <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">fold@</span> <span class="keyword">(</span>res<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">in</span>
  <span class="comment">// nothing</span>
<span class="keyword">end</span></span> <span class="keyword">else</span> <span class="keyword">let</span>
  <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span>
    pf := array_v_unnil_nil<span class="keyword">(</span>pf<span class="keyword">)</span></span> <span class="keyword">in</span> res := list_vt_nil<span class="comment">(*void*)</span>
  <span class="comment">// end of [prval]</span>
<span class="keyword">end</span> <span class="comment">// end of [if]</span>
<span class="keyword">)</span></span> <span class="comment">(* end of [loop] *)</span>
<span class="comment">//</span>
<span class="keyword">var</span> res<span class="keyword">:</span> <span class="staexp">ptr</span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> loop <span class="keyword">(</span><span class="prfexp"><span class="dynexp"><span class="keyword">view@</span></span><span class="keyword">(</span>A<span class="keyword">)</span></span> <span class="keyword">|</span> <span class="dynexp"><span class="keyword">addr@</span></span><span class="keyword">(</span>A<span class="keyword">)</span><span class="keyword">,</span> n<span class="keyword">,</span> res<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">}</span></span> <span class="comment">// end of [array_copy_to_list_vt]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
array_foreach
  <span class="keyword">(</span>A<span class="keyword">,</span> asz<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">var</span> env<span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">in</span>
  array_foreach_env&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">void</span><span class="keyword">&gt;</span> <span class="keyword">(</span>A<span class="keyword">,</span> asz<span class="keyword">,</span> env<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [array_foreach]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">env</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
array_foreach_env
  <span class="staexp"><span class="keyword">{</span>n0<span class="keyword">}</span></span><span class="keyword">(</span>A<span class="keyword">,</span> asz<span class="keyword">,</span> env<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> lemma_array_param<span class="keyword">(</span>A<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
loop
<span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span>
<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>nat <span class="keyword">|</span> n &lt;= n0<span class="keyword">}</span></span> <span class="keyword">.&lt;</span><span class="staexp">n</span><span class="keyword">&gt;.</span>
<span class="keyword">(</span>
  <span class="prfexp">pf<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">array_v</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="keyword">|</span> p0<span class="keyword">:</span> <span class="staexp">ptr</span> <span class="staexp">l</span><span class="keyword">,</span> nz<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="staexp">n</span><span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">env</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">sizeLte</span><span class="keyword">(</span><span class="staexp">n0</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="comment">(*
val () =
println! ("array_foreach_env: loop")
*)</span>
<span class="comment">//</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">if</span>
<span class="keyword">(</span>nz <span class="keyword">&gt;</span> <span class="dynexp">0</span><span class="keyword">)</span>
<span class="keyword">then</span> <span class="keyword">let</span>
  <span class="prfexp"><span class="keyword">prval</span>
  <span class="keyword">(</span>
    pf1<span class="keyword">,</span> pf2
  <span class="keyword">)</span> <span class="keyword">=</span> array_v_uncons <span class="keyword">(</span>pf<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> cont <span class="keyword">=</span>
    array_foreach$cont&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">env</span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="keyword">!</span>p0<span class="keyword">,</span> env<span class="keyword">)</span></span>
  <span class="comment">// end of [val]</span>
<span class="keyword">in</span>
  <span class="keyword">if</span> cont <span class="keyword">then</span> <span class="keyword">let</span>
    <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span>
      array_foreach$fwork&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">env</span><span class="keyword">&gt;</span><span class="keyword">(</span><span class="keyword">!</span>p0<span class="keyword">,</span> env<span class="keyword">)</span></span>
    <span class="comment">// end of [val]</span>
    <span class="dynexp"><span class="keyword">val</span> res <span class="keyword">=</span>
      loop<span class="keyword">(</span><span class="prfexp">pf2</span> <span class="keyword">|</span> ptr1_succ&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>p0<span class="keyword">)</span><span class="keyword">,</span> pred<span class="keyword">(</span>nz<span class="keyword">)</span><span class="keyword">,</span> env<span class="keyword">)</span></span>
    <span class="comment">// end of [val]</span>
    <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span>pf := array_v_cons<span class="keyword">(</span>pf1<span class="keyword">,</span> pf2<span class="keyword">)</span><span class="keyword">)</span></span>
  <span class="keyword">in</span>
    res
  <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">let</span>
    <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> pf := array_v_cons<span class="keyword">(</span>pf1<span class="keyword">,</span> pf2<span class="keyword">)</span></span> <span class="keyword">in</span> <span class="keyword">(</span>nz<span class="keyword">)</span>
  <span class="keyword">end</span> <span class="comment">(* end of [if] *)</span>
<span class="keyword">end</span> <span class="keyword">else</span> nz<span class="comment">(*0*)</span> <span class="comment">// end of [if]</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [loop]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> p0 <span class="keyword">=</span> <span class="dynexp"><span class="keyword">addr@</span></span><span class="keyword">(</span>A<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> nz <span class="keyword">=</span> loop <span class="keyword">(</span><span class="prfexp"><span class="dynexp"><span class="keyword">view@</span></span><span class="keyword">(</span>A<span class="keyword">)</span></span> <span class="keyword">|</span> p0<span class="keyword">,</span> asz<span class="keyword">,</span> env<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  asz - nz
<span class="keyword">end</span></span> <span class="comment">// end of [array_foreach_env]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">env</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
array_foreach$cont <span class="keyword">(</span>x<span class="keyword">,</span> env<span class="keyword">)</span> <span class="keyword">=</span> true</span>
<span class="comment">//</span>
<span class="comment">(*
implement
{a}{env}(*tmp*)
array_foreach$fwork (x, env) = ((*void*))
*)</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
array_foreach_fun
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>fe<span class="keyword">}</span></span>
  <span class="keyword">(</span>A<span class="keyword">,</span> asz<span class="keyword">,</span> fwork<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="keyword">typedef</span>
<span class="staexp">tfun <span class="keyword">=</span>
  <span class="keyword">(</span><span class="staexp"><span class="keyword">!</span></span><span class="staexp">unit_v</span> <span class="keyword">|</span> <span class="staexp">&amp;</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">ptr</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp"><span class="keyword">fun</span></span><span class="keyword">,</span><span class="staexp">fe</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span>
<span class="comment">// end of [typedef]</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span> pfu <span class="keyword">=</span> unit_v <span class="keyword">(</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">var</span> env<span class="keyword">:</span> <span class="staexp">ptr</span> <span class="keyword">=</span> the_null_ptr
<span class="dynexp"><span class="keyword">val</span> fwork <span class="keyword">=</span> $UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>tfun<span class="keyword">}</span></span><span class="keyword">(</span>fwork<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span> <span class="keyword">=</span>
  array_foreach_funenv&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="prfexp">pfu</span> <span class="keyword">|</span> A<span class="keyword">,</span> asz<span class="keyword">,</span> fwork<span class="keyword">,</span> env<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="comment">(*freed*)</span><span class="keyword">)</span> <span class="keyword">=</span> unit_v_elim <span class="keyword">(</span>pfu<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">in</span>
  <span class="comment">// nothing</span>
<span class="keyword">end</span></span></span> <span class="comment">// end of [array_foreach_fun]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
array_foreach_cloref
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>fe<span class="keyword">}</span></span>
  <span class="keyword">(</span>A<span class="keyword">,</span> asz<span class="keyword">,</span> fwork<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
  <span class="keyword">viewdef</span> <span class="staexp">v <span class="keyword">=</span> <span class="staexp">unit_v</span></span>
  <span class="keyword">typedef</span> <span class="staexp">vt <span class="keyword">=</span> <span class="keyword">(</span><span class="staexp">&amp;</span><span class="staexp">a</span><span class="keyword">)</span> <span class="keyword">-&lt;</span><span class="staexp">cloref</span><span class="keyword">,</span><span class="staexp">fe</span><span class="keyword">&gt;</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
  <span class="dynexp"><span class="keyword">fun</span> app <span class="keyword">.&lt;&gt;.</span>
    <span class="keyword">(</span><span class="prfexp">pf<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">v</span></span> <span class="keyword">|</span> x<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">a</span><span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">vt</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="staexp">fe</span><span class="keyword">&gt;</span> <span class="staexp">void</span> <span class="keyword">=</span> env <span class="keyword">(</span>x<span class="keyword">)</span></span>
  <span class="comment">// end of [fun]</span>
  <span class="keyword">var</span> env <span class="keyword">=</span> fwork
  <span class="prfexp"><span class="keyword">prval</span> pfu <span class="keyword">=</span> unit_v <span class="keyword">(</span><span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span> <span class="keyword">=</span>
    array_foreach_funenv&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="staexp"><span class="keyword">{</span>v<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>vt<span class="keyword">}</span></span><span class="keyword">(</span><span class="prfexp">pfu</span> <span class="keyword">|</span> A<span class="keyword">,</span> asz<span class="keyword">,</span> app<span class="keyword">,</span> env<span class="keyword">)</span></span>
  <span class="comment">// end of [val]</span>
  <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="comment">(*freed*)</span><span class="keyword">)</span> <span class="keyword">=</span> unit_v_elim <span class="keyword">(</span>pfu<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">in</span>
  <span class="comment">// nothing</span>
<span class="keyword">end</span></span></span> <span class="comment">// end of [array_foreach_cloref]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
array_foreach_funenv
  <span class="staexp"><span class="keyword">{</span>v<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>vt<span class="keyword">}</span></span>
<span class="keyword">(</span>
  <span class="prfexp">pf</span> <span class="keyword">|</span> A<span class="keyword">,</span> asz<span class="keyword">,</span> f<span class="keyword">,</span> env
<span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
  array_foreach_funenv_tsz<span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>v<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>vt<span class="keyword">}</span></span><span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> A<span class="keyword">,</span> asz<span class="keyword">,</span> sizeof&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">,</span> f<span class="keyword">,</span> env<span class="keyword">)</span>
<span class="keyword">)</span></span> <span class="comment">(* end of [array_foreach_funenv] *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a1<span class="keyword">,</span>a2</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
array_foreach2
  <span class="keyword">(</span>A1<span class="keyword">,</span> A2<span class="keyword">,</span> asz<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">var</span> env<span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">in</span>
  array_foreach2_env&lt;<span class="staexp">a1</span><span class="keyword">,</span><span class="staexp">a2</span><span class="keyword">&gt;&lt;</span><span class="staexp">void</span><span class="keyword">&gt;</span> <span class="keyword">(</span>A1<span class="keyword">,</span> A2<span class="keyword">,</span> asz<span class="keyword">,</span> env<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [array_foreach2]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a1<span class="keyword">,</span>a2</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">env</span><span class="keyword">}</span>
array_foreach2_env
  <span class="staexp"><span class="keyword">{</span>n0<span class="keyword">}</span></span>
  <span class="keyword">(</span>A1<span class="keyword">,</span> A2<span class="keyword">,</span> asz<span class="keyword">,</span> env<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> lemma_array_param<span class="keyword">(</span>A1<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
loop
<span class="staexp"><span class="keyword">{</span>l1<span class="keyword">,</span>l2<span class="keyword">:</span>addr<span class="keyword">}</span></span>
<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>nat <span class="keyword">|</span> n &lt;= n0<span class="keyword">}</span></span> <span class="keyword">.&lt;</span><span class="staexp">n</span><span class="keyword">&gt;.</span>
<span class="keyword">(</span>
  <span class="prfexp">pf1<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">array_v</span><span class="keyword">(</span><span class="staexp">a1</span><span class="keyword">,</span> <span class="staexp">l1</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="keyword">,</span> <span class="prfexp">pf2<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">array_v</span><span class="keyword">(</span><span class="staexp">a2</span><span class="keyword">,</span> <span class="staexp">l2</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="keyword">|</span> p1<span class="keyword">:</span> <span class="staexp">ptr</span> <span class="staexp">l1</span><span class="keyword">,</span> p2<span class="keyword">:</span> <span class="staexp">ptr</span> <span class="staexp">l2</span><span class="keyword">,</span> nz<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="staexp">n</span><span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">env</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">sizeLte</span><span class="keyword">(</span><span class="staexp">n0</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="comment">(*
//
val () =
println! ("array_foreach2_env: loop")
//
*)</span>
<span class="comment">//</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">if</span>
<span class="keyword">(</span>nz <span class="keyword">&gt;</span> <span class="dynexp">0</span><span class="keyword">)</span>
<span class="keyword">then</span> <span class="keyword">let</span>
  <span class="prfexp"><span class="keyword">prval</span>
  <span class="keyword">(</span>pf11<span class="keyword">,</span> pf12<span class="keyword">)</span> <span class="keyword">=</span> array_v_uncons<span class="keyword">(</span>pf1<span class="keyword">)</span></span>
  <span class="prfexp"><span class="keyword">prval</span>
  <span class="keyword">(</span>pf21<span class="keyword">,</span> pf22<span class="keyword">)</span> <span class="keyword">=</span> array_v_uncons<span class="keyword">(</span>pf2<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> cont <span class="keyword">=</span>
    array_foreach2$cont&lt;<span class="staexp">a1</span><span class="keyword">,</span><span class="staexp">a2</span><span class="keyword">&gt;&lt;</span><span class="staexp">env</span><span class="keyword">&gt;</span><span class="keyword">(</span><span class="keyword">!</span>p1<span class="keyword">,</span> <span class="keyword">!</span>p2<span class="keyword">,</span> env<span class="keyword">)</span></span>
  <span class="comment">// end of [val]</span>
<span class="keyword">in</span>
  <span class="keyword">if</span> cont <span class="keyword">then</span> <span class="keyword">let</span>
    <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span>
      array_foreach2$fwork&lt;<span class="staexp">a1</span><span class="keyword">,</span><span class="staexp">a2</span><span class="keyword">&gt;&lt;</span><span class="staexp">env</span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="keyword">!</span>p1<span class="keyword">,</span> <span class="keyword">!</span>p2<span class="keyword">,</span> env<span class="keyword">)</span></span>
    <span class="dynexp"><span class="keyword">val</span> res <span class="keyword">=</span>
      loop <span class="keyword">(</span>
        <span class="prfexp">pf12</span><span class="keyword">,</span> <span class="prfexp">pf22</span>
      <span class="keyword">|</span> ptr1_succ&lt;<span class="staexp">a1</span><span class="keyword">&gt;</span><span class="keyword">(</span>p1<span class="keyword">)</span><span class="keyword">,</span> ptr1_succ&lt;<span class="staexp">a2</span><span class="keyword">&gt;</span><span class="keyword">(</span>p2<span class="keyword">)</span><span class="keyword">,</span> pred<span class="keyword">(</span>nz<span class="keyword">)</span><span class="keyword">,</span> env
      <span class="keyword">)</span></span> <span class="comment">(* loop *)</span>
    <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> pf1 := array_v_cons <span class="keyword">(</span>pf11<span class="keyword">,</span> pf12<span class="keyword">)</span></span>
    <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> pf2 := array_v_cons <span class="keyword">(</span>pf21<span class="keyword">,</span> pf22<span class="keyword">)</span></span>
  <span class="keyword">in</span>
    res
  <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">let</span>
    <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> pf1 := array_v_cons <span class="keyword">(</span>pf11<span class="keyword">,</span> pf12<span class="keyword">)</span></span>
    <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> pf2 := array_v_cons <span class="keyword">(</span>pf21<span class="keyword">,</span> pf22<span class="keyword">)</span></span> <span class="keyword">in</span> <span class="keyword">(</span>nz<span class="keyword">)</span>
  <span class="keyword">end</span> <span class="comment">(* end of [if] *)</span>
<span class="keyword">end</span> <span class="keyword">else</span> nz<span class="comment">(*0*)</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [loop]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> nz <span class="keyword">=</span> loop <span class="keyword">(</span><span class="prfexp"><span class="dynexp"><span class="keyword">view@</span></span><span class="keyword">(</span>A1<span class="keyword">)</span></span><span class="keyword">,</span> <span class="prfexp"><span class="dynexp"><span class="keyword">view@</span></span><span class="keyword">(</span>A2<span class="keyword">)</span></span> <span class="keyword">|</span> <span class="dynexp"><span class="keyword">addr@</span></span><span class="keyword">(</span>A1<span class="keyword">)</span><span class="keyword">,</span> <span class="dynexp"><span class="keyword">addr@</span></span><span class="keyword">(</span>A2<span class="keyword">)</span><span class="keyword">,</span> asz<span class="keyword">,</span> env<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  asz - nz
<span class="keyword">end</span></span> <span class="comment">// end of [array_foreach2_env]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a1<span class="keyword">,</span>a2</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">env</span><span class="keyword">}</span>
array_foreach2$cont <span class="keyword">(</span>x1<span class="keyword">,</span> x2<span class="keyword">,</span> env<span class="keyword">)</span> <span class="keyword">=</span> true</span>
<span class="comment">(*
implement
{a1,a2}{env}
array_foreach2$fwork (x1, x2, env) = ((*void*))
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
array_iforeach
  <span class="keyword">(</span>A<span class="keyword">,</span> asz<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">var</span> env<span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">in</span>
  array_iforeach_env&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">void</span><span class="keyword">&gt;</span> <span class="keyword">(</span>A<span class="keyword">,</span> asz<span class="keyword">,</span> env<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [array_iforeach]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">env</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
array_iforeach_env
  <span class="staexp"><span class="keyword">{</span>n0<span class="keyword">}</span></span> <span class="keyword">(</span>A<span class="keyword">,</span> asz<span class="keyword">,</span> env<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> lemma_array_param<span class="keyword">(</span>A<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
loop
<span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span>
<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>nat <span class="keyword">|</span> n &lt;= n0<span class="keyword">}</span></span> <span class="keyword">.&lt;</span><span class="staexp">n</span><span class="keyword">&gt;.</span>
<span class="keyword">(</span>
  <span class="prfexp">pf<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">array_v</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="keyword">|</span> p0<span class="keyword">:</span> <span class="staexp">ptr</span> <span class="staexp">l</span><span class="keyword">,</span> nz<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="staexp">n</span><span class="keyword">,</span> i0<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">env</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">sizeLte</span> <span class="keyword">(</span><span class="staexp">n0</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="comment">(*
val () =
println! ("array_iforeach_env: loop")
*)</span>
<span class="comment">//</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">if</span>
<span class="keyword">(</span>nz <span class="keyword">&gt;</span> <span class="dynexp">0</span><span class="keyword">)</span>
<span class="keyword">then</span> <span class="keyword">let</span>
  <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span>
    pf1<span class="keyword">,</span> pf2
  <span class="keyword">)</span> <span class="keyword">=</span> array_v_uncons <span class="keyword">(</span>pf<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> cont <span class="keyword">=</span>
    array_iforeach$cont&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">env</span><span class="keyword">&gt;</span><span class="keyword">(</span>i0<span class="keyword">,</span> <span class="keyword">!</span>p0<span class="keyword">,</span> env<span class="keyword">)</span></span>
  <span class="comment">// end of [val</span>
<span class="keyword">in</span>
  <span class="keyword">if</span> cont <span class="keyword">then</span> <span class="keyword">let</span>
    <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span>
      array_iforeach$fwork&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">env</span><span class="keyword">&gt;</span><span class="keyword">(</span>i0<span class="keyword">,</span> <span class="keyword">!</span>p0<span class="keyword">,</span> env<span class="keyword">)</span></span>
    <span class="dynexp"><span class="keyword">val</span> res <span class="keyword">=</span>
      loop <span class="keyword">(</span><span class="prfexp">pf2</span> <span class="keyword">|</span> ptr1_succ&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>p0<span class="keyword">)</span><span class="keyword">,</span> pred<span class="keyword">(</span>nz<span class="keyword">)</span><span class="keyword">,</span> succ<span class="keyword">(</span>i0<span class="keyword">)</span><span class="keyword">,</span> env<span class="keyword">)</span></span>
    <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> pf := array_v_cons<span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="keyword">(</span>pf1<span class="keyword">,</span> pf2<span class="keyword">)</span></span>
  <span class="keyword">in</span>
    res
  <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">let</span>
    <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> pf := array_v_cons <span class="keyword">(</span>pf1<span class="keyword">,</span> pf2<span class="keyword">)</span></span> <span class="keyword">in</span> <span class="keyword">(</span>nz<span class="keyword">)</span>
  <span class="keyword">end</span> <span class="comment">(* end of [if] *)</span>
<span class="keyword">end</span> <span class="comment">// end of [then]</span>
<span class="keyword">else</span> nz<span class="comment">(*0*)</span> <span class="comment">// end of [else]</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [loop]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> p0 <span class="keyword">=</span> <span class="dynexp"><span class="keyword">addr@</span></span><span class="keyword">(</span>A<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> nz <span class="keyword">=</span> loop<span class="keyword">(</span><span class="prfexp"><span class="dynexp"><span class="keyword">view@</span></span><span class="keyword">(</span>A<span class="keyword">)</span></span> <span class="keyword">|</span> p0<span class="keyword">,</span> asz<span class="keyword">,</span> g0int2uint<span class="keyword">(</span><span class="dynexp">0</span><span class="keyword">)</span><span class="keyword">,</span> env<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  asz - nz
<span class="keyword">end</span></span> <span class="comment">// end of [array_iforeach_env]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">env</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
array_iforeach$cont <span class="keyword">(</span>i<span class="keyword">,</span> x<span class="keyword">,</span> env<span class="keyword">)</span> <span class="keyword">=</span> true</span>
<span class="comment">(*
implement
{a}{env}(*tmp*)
array_iforeach$fwork (i, x, env) = ((*void*))
*)</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span>
array_rforeach
  <span class="keyword">(</span>A<span class="keyword">,</span> asz<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">var</span> env<span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">in</span>
  array_rforeach_env&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">void</span><span class="keyword">&gt;</span> <span class="keyword">(</span>A<span class="keyword">,</span> asz<span class="keyword">,</span> env<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [array_rforeach]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">env</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
array_rforeach_env
  <span class="staexp"><span class="keyword">{</span>n0<span class="keyword">}</span></span> <span class="keyword">(</span>A<span class="keyword">,</span> asz<span class="keyword">,</span> env<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> lemma_array_param<span class="keyword">(</span>A<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
loop
<span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span>
<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>nat <span class="keyword">|</span> n &lt;= n0<span class="keyword">}</span></span> <span class="keyword">.&lt;</span><span class="staexp">n</span><span class="keyword">&gt;.</span>
<span class="keyword">(</span>
  <span class="prfexp">pf<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">array_v</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="keyword">|</span> pz<span class="keyword">:</span> <span class="staexp">ptr</span> <span class="keyword">(</span><span class="staexp">l</span><span class="staexp">+</span><span class="staexp">n</span><span class="staexp">*</span><span class="staexp">sizeof</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> nz<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="staexp">n</span><span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">env</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">sizeLte</span> <span class="keyword">(</span><span class="staexp">n0</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="comment">(*
//
val () =
println! ("array_rforeach_env: loop")
//
*)</span>
<span class="comment">//</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">if</span>
<span class="keyword">(</span>nz <span class="keyword">&gt;</span> <span class="dynexp">0</span><span class="keyword">)</span>
<span class="keyword">then</span> <span class="keyword">let</span>
  <span class="prfexp"><span class="keyword">prval</span>
  <span class="keyword">(</span>
    pf1<span class="keyword">,</span> pf2
  <span class="keyword">)</span> <span class="keyword">=</span> array_v_unextend <span class="keyword">(</span>pf<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> p1 <span class="keyword">=</span> ptr1_pred&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>pz<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pf2</span> <span class="keyword">|</span> p1<span class="keyword">)</span> <span class="keyword">=</span> viewptr_match<span class="keyword">(</span><span class="prfexp">pf2</span> <span class="keyword">|</span> p1<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> cont <span class="keyword">=</span> array_rforeach$cont&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">env</span><span class="keyword">&gt;</span><span class="keyword">(</span><span class="keyword">!</span>p1<span class="keyword">,</span> env<span class="keyword">)</span></span>
<span class="keyword">in</span>
  <span class="keyword">if</span> cont <span class="keyword">then</span> <span class="keyword">let</span>
    <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span>
    array_rforeach$fwork&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">env</span><span class="keyword">&gt;</span><span class="keyword">(</span><span class="keyword">!</span>p1<span class="keyword">,</span> env<span class="keyword">)</span></span>
    <span class="dynexp"><span class="keyword">val</span> res <span class="keyword">=</span> loop<span class="keyword">(</span><span class="prfexp">pf1</span> <span class="keyword">|</span> p1<span class="keyword">,</span> pred<span class="keyword">(</span>nz<span class="keyword">)</span><span class="keyword">,</span> env<span class="keyword">)</span></span>
    <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> pf := array_v_extend <span class="keyword">(</span>pf1<span class="keyword">,</span> pf2<span class="keyword">)</span></span>
  <span class="keyword">in</span>
    res
  <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">let</span>
    <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> pf := array_v_extend<span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="keyword">(</span>pf1<span class="keyword">,</span> pf2<span class="keyword">)</span></span> <span class="keyword">in</span> nz
  <span class="keyword">end</span> <span class="comment">(* end of [if] *)</span>
<span class="keyword">end</span> <span class="keyword">else</span> nz<span class="comment">(*0*)</span> <span class="comment">// end of [if]</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [loop]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> pz <span class="keyword">=</span>
  ptr1_add_guint&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="dynexp"><span class="keyword">addr@</span></span><span class="keyword">(</span>A<span class="keyword">)</span><span class="keyword">,</span> asz<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> n0 <span class="keyword">=</span> loop <span class="keyword">(</span><span class="prfexp"><span class="dynexp"><span class="keyword">view@</span></span><span class="keyword">(</span>A<span class="keyword">)</span></span> <span class="keyword">|</span> pz<span class="keyword">,</span> asz<span class="keyword">,</span> env<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  asz - n0
<span class="keyword">end</span></span> <span class="comment">// end of [array_rforeach_env]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">env</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
array_rforeach$cont <span class="keyword">(</span>x<span class="keyword">,</span> env<span class="keyword">)</span> <span class="keyword">=</span> true</span>
<span class="comment">(*
implement
{a}{env}(*tmp*)
array_rforeach$fwork (x, env) = ((*void*))
*)</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
array_initize
  <span class="keyword">(</span>A<span class="keyword">,</span> asz<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="keyword">stadef</span> <span class="staexp">V <span class="keyword">=</span> <span class="staexp">array_v</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> loop
  <span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>nat<span class="keyword">}</span></span> <span class="keyword">.&lt;</span><span class="staexp">n</span><span class="keyword">&gt;.</span>
<span class="keyword">(</span>
  <span class="prfexp">pf<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">V</span> <span class="keyword">(</span><span class="staexp">a</span><span class="staexp">?</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">V</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="keyword">|</span> p0<span class="keyword">:</span> <span class="staexp">ptr</span> <span class="staexp">l</span><span class="keyword">,</span> nz<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="staexp">n</span><span class="keyword">,</span> i0<span class="keyword">:</span> <span class="staexp">size_t</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span>
<span class="keyword">(</span>
<span class="keyword">if</span>
<span class="keyword">(</span>nz <span class="keyword">&gt;</span> <span class="dynexp">0</span><span class="keyword">)</span>
<span class="keyword">then</span> <span class="keyword">let</span>
<span class="comment">//</span>
  <span class="prfexp"><span class="keyword">prval</span>
  <span class="keyword">(</span>pf1<span class="keyword">,</span> pf2<span class="keyword">)</span> <span class="keyword">=</span> array_v_uncons<span class="keyword">(</span>pf<span class="keyword">)</span></span>
<span class="comment">//</span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span>
    array_initize$init&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>i0<span class="keyword">,</span> <span class="keyword">!</span>p0<span class="keyword">)</span></span>
  <span class="comment">// end of [val]</span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span>
    loop<span class="keyword">(</span><span class="prfexp">pf2</span> <span class="keyword">|</span> ptr1_succ&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>p0<span class="keyword">)</span><span class="keyword">,</span> pred<span class="keyword">(</span>nz<span class="keyword">)</span><span class="keyword">,</span> succ<span class="keyword">(</span>i0<span class="keyword">)</span><span class="keyword">)</span></span>
  <span class="comment">// end of [val]</span>
<span class="comment">//</span>
  <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> pf := array_v_cons<span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="keyword">(</span>pf1<span class="keyword">,</span> pf2<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">in</span>
  <span class="comment">// nothing</span>
<span class="keyword">end</span></span> <span class="keyword">else</span> <span class="keyword">let</span>
  <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> pf := array_v_unnil_nil<span class="keyword">(</span>pf<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">in</span>
  <span class="comment">// nothing</span>
<span class="keyword">end</span></span> <span class="comment">// end of [if]</span>
<span class="keyword">)</span></span> <span class="comment">(* end of [loop] *)</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> lemma_g1uint_param<span class="keyword">(</span>asz<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  loop <span class="keyword">(</span><span class="prfexp"><span class="dynexp"><span class="keyword">view@</span></span> <span class="keyword">(</span>A<span class="keyword">)</span></span> <span class="keyword">|</span> <span class="dynexp"><span class="keyword">addr@</span></span><span class="keyword">(</span>A<span class="keyword">)</span><span class="keyword">,</span> asz<span class="keyword">,</span> g0int2uint<span class="keyword">(</span><span class="dynexp">0</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [array_initize]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span>
array_initize_elt
  <span class="keyword">(</span>A<span class="keyword">,</span> asz<span class="keyword">,</span> elt<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">a2</span><span class="keyword">}</span>
array_initize$init
  <span class="keyword">(</span>i<span class="keyword">,</span> xi<span class="keyword">)</span> <span class="keyword">=</span> xi := $UN<span class="keyword">.</span>castvwtp0<span class="staexp"><span class="keyword">{</span>a2<span class="keyword">}</span></span><span class="keyword">(</span>elt<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  <span class="keyword">$effmask_all</span> <span class="keyword">(</span>array_initize&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>A<span class="keyword">,</span> asz<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [array_initize_elt]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span>
array_initize_list
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">}</span></span> <span class="keyword">(</span>A<span class="keyword">,</span> asz<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="keyword">typedef</span> <span class="staexp">list0 <span class="keyword">=</span> <span class="staexp">listGte</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">0</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span> <span class="staexp">list1 <span class="keyword">=</span> <span class="staexp">listGte</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">1</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> loop
<span class="keyword">(</span>
  p0<span class="keyword">:</span> <span class="staexp">ptr</span><span class="keyword">,</span> p1<span class="keyword">:</span> <span class="staexp">ptr</span><span class="keyword">,</span> xs<span class="keyword">:</span> <span class="staexp">list0</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="comment">(*
//
val () =
println!
  ("array_initize_list: loop")
//
*)</span>
<span class="comment">//</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">if</span> <span class="keyword">(</span>
p0 <span class="keyword">&lt;</span> p1
<span class="keyword">)</span> <span class="keyword">then</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> xs <span class="keyword">=</span>
    $UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>list1<span class="keyword">}</span></span><span class="keyword">(</span>xs<span class="keyword">)</span></span>
  <span class="comment">// end of [val]</span>
  <span class="dynexp"><span class="keyword">val+</span>list_cons<span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=</span> xs</span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span>
    $UN<span class="keyword">.</span>ptr0_set&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>p0<span class="keyword">,</span> x<span class="keyword">)</span></span>
  <span class="comment">// end of [val]</span>
  <span class="dynexp"><span class="keyword">val</span> p0 <span class="keyword">=</span> ptr_succ&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>p0<span class="keyword">)</span></span>
<span class="keyword">in</span>
  loop <span class="keyword">(</span>p0<span class="keyword">,</span> p1<span class="keyword">,</span> xs<span class="keyword">)</span>
<span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="comment">// end of [if]</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [loop]</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> lemma_list_param<span class="keyword">(</span>xs<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> p0 <span class="keyword">=</span> <span class="dynexp"><span class="keyword">addr@</span></span><span class="keyword">(</span>A<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> p1 <span class="keyword">=</span> ptr_add&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>p0<span class="keyword">,</span> asz<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">$effmask_all</span><span class="keyword">(</span>loop <span class="keyword">(</span>p0<span class="keyword">,</span> p1<span class="keyword">,</span> xs<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span>
__assert<span class="keyword">(</span>A<span class="keyword">)</span> <span class="keyword">where</span>
<span class="keyword">{</span>
<span class="comment">//</span>
<span class="keyword">extern</span>
<span class="prfexp"><span class="keyword">praxi</span>
__assert <span class="keyword">(</span>A<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">array</span><span class="keyword">(</span><span class="staexp">a</span><span class="staexp">?</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">array</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="keyword">}</span></span> <span class="comment">(* end of [prval] *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">in</span>
  <span class="comment">// nothing</span>
<span class="keyword">end</span></span></span> <span class="comment">// end of [array_initize_list]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span>
array_initize_rlist
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">}</span></span> <span class="keyword">(</span>A<span class="keyword">,</span> asz<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="keyword">typedef</span> <span class="staexp">list0 <span class="keyword">=</span> <span class="staexp">listGte</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">0</span><span class="keyword">)</span></span>
<span class="keyword">typedef</span> <span class="staexp">list1 <span class="keyword">=</span> <span class="staexp">listGte</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">1</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> loop
<span class="keyword">(</span>
  pz<span class="keyword">:</span> <span class="staexp">ptr</span><span class="keyword">,</span> p0<span class="keyword">:</span> <span class="staexp">ptr</span><span class="keyword">,</span> xs<span class="keyword">:</span> <span class="staexp">list0</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="comment">(*
//
val () =
println!
  ("array_initize_rlist: loop")
//
*)</span>
<span class="comment">//</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">if</span> pz <span class="keyword">&gt;</span> p0 <span class="keyword">then</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> xs <span class="keyword">=</span>
    $UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>list1<span class="keyword">}</span></span><span class="keyword">(</span>xs<span class="keyword">)</span></span>
  <span class="comment">// end of [val]</span>
  <span class="dynexp"><span class="keyword">val+</span>list_cons<span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=</span> xs</span>
  <span class="dynexp"><span class="keyword">val</span> pz <span class="keyword">=</span> ptr_pred&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>pz<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> $UN<span class="keyword">.</span>ptr0_set&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>pz<span class="keyword">,</span> x<span class="keyword">)</span></span>
<span class="keyword">in</span>
  loop <span class="keyword">(</span>pz<span class="keyword">,</span> p0<span class="keyword">,</span> xs<span class="keyword">)</span>
<span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="comment">// end of [if]</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [loop]</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> lemma_list_param<span class="keyword">(</span>xs<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> p0 <span class="keyword">=</span> <span class="dynexp"><span class="keyword">addr@</span></span><span class="keyword">(</span>A<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> pz <span class="keyword">=</span> ptr_add&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>p0<span class="keyword">,</span> asz<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">$effmask_all</span><span class="keyword">(</span>loop<span class="keyword">(</span>pz<span class="keyword">,</span> p0<span class="keyword">,</span> xs<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span>
__assert<span class="keyword">(</span>A<span class="keyword">)</span> <span class="keyword">where</span>
<span class="keyword">{</span>
<span class="keyword">extern</span>
<span class="prfexp"><span class="keyword">praxi</span>
__assert <span class="keyword">(</span>A<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">array</span><span class="keyword">(</span><span class="staexp">a</span><span class="staexp">?</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">array</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="keyword">}</span></span> <span class="comment">(* end of [prval] *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">in</span>
  <span class="comment">// nothing</span>
<span class="keyword">end</span></span></span> <span class="comment">// end of [array_initize_rlist]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span>
array_initize_list_vt
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">}</span></span> <span class="keyword">(</span>A<span class="keyword">,</span> asz<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="keyword">vtypedef</span> <span class="staexp">list0 <span class="keyword">=</span> <span class="staexp">listGte_vt</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">0</span><span class="keyword">)</span></span>
<span class="keyword">vtypedef</span> <span class="staexp">list1 <span class="keyword">=</span> <span class="staexp">listGte_vt</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">1</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> loop
<span class="keyword">(</span>
  p0<span class="keyword">:</span> <span class="staexp">ptr</span><span class="keyword">,</span> p1<span class="keyword">:</span> <span class="staexp">ptr</span><span class="keyword">,</span> xs<span class="keyword">:</span> <span class="staexp">list0</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="comment">(*
val () =
println!
  ("array_initize_list_vt: loop")
*)</span>
<span class="comment">//</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">if</span> p0 <span class="keyword">&lt;</span> p1 <span class="keyword">then</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> xs <span class="keyword">=</span>
    $UN<span class="keyword">.</span>castvwtp0<span class="staexp"><span class="keyword">{</span>list1<span class="keyword">}</span></span><span class="keyword">(</span>xs<span class="keyword">)</span></span>
  <span class="comment">// end of [val]</span>
  <span class="dynexp"><span class="keyword">val+</span><span class="keyword">~</span>list_vt_cons <span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=</span> xs</span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> $UN<span class="keyword">.</span>ptr0_set&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>p0<span class="keyword">,</span> x<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> p0 <span class="keyword">=</span> ptr_succ&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>p0<span class="keyword">)</span></span>
<span class="keyword">in</span>
  loop <span class="keyword">(</span>p0<span class="keyword">,</span> p1<span class="keyword">,</span> xs<span class="keyword">)</span>
<span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">let</span>
  <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> $UN<span class="keyword">.</span>cast2void <span class="keyword">(</span>xs<span class="keyword">)</span></span> <span class="dynexp"><span class="keyword">in</span> <span class="comment">(*nothing*)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [if]</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [loop]</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> lemma_list_vt_param <span class="keyword">(</span>xs<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> p0 <span class="keyword">=</span> <span class="dynexp"><span class="keyword">addr@</span></span><span class="keyword">(</span>A<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> p1 <span class="keyword">=</span> ptr_add&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>p0<span class="keyword">,</span> asz<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">$effmask_all</span><span class="keyword">(</span>loop<span class="keyword">(</span>p0<span class="keyword">,</span> p1<span class="keyword">,</span> xs<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span>
__assert<span class="keyword">(</span>A<span class="keyword">)</span> <span class="keyword">where</span>
<span class="keyword">{</span>
<span class="comment">//</span>
<span class="keyword">extern</span>
<span class="prfexp"><span class="keyword">praxi</span>
__assert <span class="keyword">(</span>A<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">array</span><span class="keyword">(</span><span class="staexp">a</span><span class="staexp">?</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">array</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="keyword">}</span></span> <span class="comment">(* end of [prval] *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">in</span>
  <span class="comment">// nothing</span>
<span class="keyword">end</span></span></span> <span class="comment">// end of [array_initize_list_vt]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span>
array_initize_rlist_vt
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">}</span></span> <span class="keyword">(</span>A<span class="keyword">,</span> asz<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="keyword">vtypedef</span> <span class="staexp">list0 <span class="keyword">=</span> <span class="staexp">listGte_vt</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">0</span><span class="keyword">)</span></span>
<span class="keyword">vtypedef</span> <span class="staexp">list1 <span class="keyword">=</span> <span class="staexp">listGte_vt</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">1</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> loop
<span class="keyword">(</span>
  pz<span class="keyword">:</span> <span class="staexp">ptr</span><span class="keyword">,</span> p0<span class="keyword">:</span> <span class="staexp">ptr</span><span class="keyword">,</span> xs<span class="keyword">:</span> <span class="staexp">list0</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="comment">(*
val () =
println!
  ("array_initize_rlist_vt: loop")
*)</span>
<span class="comment">//</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">if</span> pz <span class="keyword">&gt;</span> p0 <span class="keyword">then</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> xs <span class="keyword">=</span>
    $UN<span class="keyword">.</span>castvwtp0<span class="staexp"><span class="keyword">{</span>list1<span class="keyword">}</span></span><span class="keyword">(</span>xs<span class="keyword">)</span></span>
  <span class="comment">// end of [val]</span>
  <span class="dynexp"><span class="keyword">val+</span><span class="keyword">~</span>list_vt_cons<span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=</span> xs</span>
  <span class="dynexp"><span class="keyword">val</span> pz <span class="keyword">=</span> ptr_pred&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>pz<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> $UN<span class="keyword">.</span>ptr0_set&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>pz<span class="keyword">,</span> x<span class="keyword">)</span></span>
<span class="keyword">in</span>
  loop <span class="keyword">(</span>pz<span class="keyword">,</span> p0<span class="keyword">,</span> xs<span class="keyword">)</span>
<span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">let</span>
  <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> $UN<span class="keyword">.</span>cast2void <span class="keyword">(</span>xs<span class="keyword">)</span></span> <span class="dynexp"><span class="keyword">in</span> <span class="comment">(*nothing*)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [if]</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [loop]</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> lemma_list_vt_param<span class="keyword">(</span>xs<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> p0 <span class="keyword">=</span> <span class="dynexp"><span class="keyword">addr@</span></span><span class="keyword">(</span>A<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> pz <span class="keyword">=</span> ptr_add&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>p0<span class="keyword">,</span> asz<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">$effmask_all</span><span class="keyword">(</span>loop<span class="keyword">(</span>pz<span class="keyword">,</span> p0<span class="keyword">,</span> xs<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span>
__assert<span class="keyword">(</span>A<span class="keyword">)</span> <span class="keyword">where</span>
<span class="keyword">{</span>
<span class="comment">//</span>
<span class="keyword">extern</span>
<span class="prfexp"><span class="keyword">praxi</span>
__assert <span class="keyword">(</span>A<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">array</span><span class="keyword">(</span><span class="staexp">a</span><span class="staexp">?</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">array</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="comment">//</span>
<span class="keyword">}</span></span> <span class="comment">(* end of [prval] *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">in</span>
  <span class="comment">// nothing</span>
<span class="keyword">end</span></span></span> <span class="comment">// end of [array_initize_rlist_vt]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span>
array_uninitize
  <span class="keyword">(</span>A<span class="keyword">,</span> asz<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> loop
  <span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>nat<span class="keyword">}</span></span> <span class="keyword">.&lt;</span><span class="staexp">n</span><span class="keyword">&gt;.</span>
<span class="keyword">(</span>
  <span class="prfexp">pf<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">array_v</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span>
        <span class="staexp">&gt;&gt;</span> <span class="staexp">array_v</span><span class="keyword">(</span><span class="staexp">a</span><span class="staexp">?</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span>
<span class="keyword">|</span> p0<span class="keyword">:</span> <span class="staexp">ptr</span> <span class="staexp">l</span><span class="keyword">,</span> nz<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="staexp">n</span><span class="keyword">,</span> i0<span class="keyword">:</span> <span class="staexp">size_t</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="comment">(*
val () =
println! ("array_uninitize: loop")
*)</span>
<span class="comment">//</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">if</span>
<span class="keyword">(</span>nz <span class="keyword">&gt;</span> <span class="dynexp">0</span><span class="keyword">)</span>
<span class="keyword">then</span> <span class="keyword">let</span>
<span class="comment">//</span>
  <span class="prfexp"><span class="keyword">prval</span>
  <span class="keyword">(</span>pf1<span class="keyword">,</span> pf2<span class="keyword">)</span> <span class="keyword">=</span> array_v_uncons<span class="keyword">(</span>pf<span class="keyword">)</span></span>
<span class="comment">//</span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span>
    array_uninitize$clear&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>i0<span class="keyword">,</span> <span class="keyword">!</span>p0<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span>
    loop <span class="keyword">(</span><span class="prfexp">pf2</span> <span class="keyword">|</span> ptr_succ&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>p0<span class="keyword">)</span><span class="keyword">,</span> pred<span class="keyword">(</span>nz<span class="keyword">)</span><span class="keyword">,</span> succ<span class="keyword">(</span>i0<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
  <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span>pf := array_v_cons<span class="keyword">(</span>pf1<span class="keyword">,</span> pf2<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">in</span>
  <span class="comment">// nothing</span>
<span class="keyword">end</span></span> <span class="keyword">else</span> <span class="keyword">let</span>
  <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> pf := array_v_unnil_nil<span class="staexp"><span class="keyword">{</span>a<span class="keyword">,</span>a?<span class="keyword">}</span></span><span class="keyword">(</span>pf<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">in</span>
  <span class="comment">// nothing</span>
<span class="keyword">end</span></span> <span class="comment">// end of [if]</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [loop]</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> lemma_array_param<span class="keyword">(</span>A<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span> pf <span class="keyword">=</span> <span class="dynexp"><span class="keyword">view@</span></span> <span class="keyword">(</span>A<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> loop <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> <span class="dynexp"><span class="keyword">addr@</span></span><span class="keyword">(</span>A<span class="keyword">)</span><span class="keyword">,</span> asz<span class="keyword">,</span> i2sz<span class="keyword">(</span><span class="dynexp">0</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="dynexp"><span class="keyword">view@</span></span> <span class="keyword">(</span>A<span class="keyword">)</span> := pf</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">in</span>
  <span class="comment">// nothing  </span>
<span class="keyword">end</span></span></span> <span class="comment">// end of [array_uninitize]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">b</span><span class="keyword">}</span>
array_mapto
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">}</span></span><span class="keyword">(</span>A<span class="keyword">,</span> B<span class="keyword">,</span> n<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> pa <span class="keyword">=</span> <span class="dynexp"><span class="keyword">addr@</span></span> <span class="keyword">(</span>A<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> pa2 <span class="keyword">=</span> ptr_add&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>pa<span class="keyword">,</span> n<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> pb <span class="keyword">=</span> <span class="dynexp"><span class="keyword">addr@</span></span> <span class="keyword">(</span>B<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> loop<span class="staexp"><span class="keyword">{</span>la<span class="keyword">,</span>lb<span class="keyword">:</span>addr<span class="keyword">}</span></span>
<span class="keyword">(</span>
  pa<span class="keyword">:</span> <span class="staexp">ptr</span> <span class="staexp">la</span><span class="keyword">,</span> pa2<span class="keyword">:</span> <span class="staexp">ptr</span><span class="keyword">,</span> pb<span class="keyword">:</span> <span class="staexp">ptr</span> <span class="staexp">lb</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span>
<span class="keyword">(</span>
<span class="keyword">if</span> pa <span class="keyword">&lt;</span> pa2 <span class="keyword">then</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pfa</span><span class="keyword">,</span> <span class="prfexp">fpfa</span> <span class="keyword">|</span> pa<span class="keyword">)</span> <span class="keyword">=</span> $UN<span class="keyword">.</span>ptr_vtake<span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="keyword">(</span>pa<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pfb</span><span class="keyword">,</span> <span class="prfexp">fpfb</span> <span class="keyword">|</span> pb<span class="keyword">)</span> <span class="keyword">=</span> $UN<span class="keyword">.</span>ptr_vtake<span class="staexp"><span class="keyword">{</span>b?<span class="keyword">}</span></span><span class="keyword">(</span>pb<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> array_mapto$fwork&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">b</span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="keyword">!</span>pa<span class="keyword">,</span> <span class="keyword">!</span>pb<span class="keyword">)</span></span>
  <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fpfa <span class="keyword">(</span>pfa<span class="keyword">)</span></span>
  <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fpfb <span class="keyword">(</span>$UN<span class="keyword">.</span>castview0<span class="staexp"><span class="keyword">{</span><span class="keyword">(</span>b?<span class="keyword">)</span><span class="keyword">@</span>lb<span class="keyword">}</span></span><span class="keyword">(</span>pfb<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="keyword">in</span>
  loop <span class="keyword">(</span>ptr_succ&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>pa<span class="keyword">)</span><span class="keyword">,</span> pa2<span class="keyword">,</span> ptr_succ&lt;<span class="staexp">b</span><span class="keyword">&gt;</span> <span class="keyword">(</span>pb<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">(* end of [if] *)</span>
<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> loop <span class="keyword">(</span>pa<span class="keyword">,</span> pa2<span class="keyword">,</span> pb<span class="keyword">)</span></span>
<span class="prfexp"><span class="keyword">prval</span> <span class="keyword">[</span><span class="staexp">lb<span class="keyword">:</span>addr</span><span class="keyword">]</span> EQADDR <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> ptr_get_index <span class="keyword">(</span>pb<span class="keyword">)</span></span>
<span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="dynexp"><span class="keyword">view@</span></span><span class="keyword">(</span>B<span class="keyword">)</span> := $UN<span class="keyword">.</span>castview0<span class="staexp"><span class="keyword">{</span>array_v <span class="keyword">(</span>b<span class="keyword">,</span> lb<span class="keyword">,</span> n<span class="keyword">)</span><span class="keyword">}</span></span><span class="keyword">(</span><span class="dynexp"><span class="keyword">view@</span></span><span class="keyword">(</span>B<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">in</span>
  <span class="comment">// nothing</span>
<span class="keyword">end</span></span></span> <span class="comment">(* end of [array_mapto] *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a<span class="keyword">,</span>b</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">c</span><span class="keyword">}</span>
array_map2to
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">}</span></span><span class="keyword">(</span>A<span class="keyword">,</span> B<span class="keyword">,</span> C<span class="keyword">,</span> n<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> pa <span class="keyword">=</span> <span class="dynexp"><span class="keyword">addr@</span></span> <span class="keyword">(</span>A<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> pa2 <span class="keyword">=</span> ptr_add&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>pa<span class="keyword">,</span> n<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> pb <span class="keyword">=</span> <span class="dynexp"><span class="keyword">addr@</span></span> <span class="keyword">(</span>B<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> pc <span class="keyword">=</span> <span class="dynexp"><span class="keyword">addr@</span></span> <span class="keyword">(</span>C<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> loop<span class="staexp"><span class="keyword">{</span>la<span class="keyword">,</span>lb<span class="keyword">,</span>lc<span class="keyword">:</span>addr<span class="keyword">}</span></span>
<span class="keyword">(</span>
  pa<span class="keyword">:</span> <span class="staexp">ptr</span> <span class="staexp">la</span><span class="keyword">,</span> pa2<span class="keyword">:</span> <span class="staexp">ptr</span><span class="keyword">,</span> pb<span class="keyword">:</span> <span class="staexp">ptr</span> <span class="staexp">lb</span><span class="keyword">,</span> pc<span class="keyword">:</span> <span class="staexp">ptr</span> <span class="staexp">lc</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span>
<span class="keyword">(</span>
<span class="keyword">if</span> pa <span class="keyword">&lt;</span> pa2 <span class="keyword">then</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pfa</span><span class="keyword">,</span> <span class="prfexp">fpfa</span> <span class="keyword">|</span> pa<span class="keyword">)</span> <span class="keyword">=</span> $UN<span class="keyword">.</span>ptr_vtake<span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="keyword">(</span>pa<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pfb</span><span class="keyword">,</span> <span class="prfexp">fpfb</span> <span class="keyword">|</span> pb<span class="keyword">)</span> <span class="keyword">=</span> $UN<span class="keyword">.</span>ptr_vtake<span class="staexp"><span class="keyword">{</span>b<span class="keyword">}</span></span><span class="keyword">(</span>pb<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pfc</span><span class="keyword">,</span> <span class="prfexp">fpfc</span> <span class="keyword">|</span> pc<span class="keyword">)</span> <span class="keyword">=</span> $UN<span class="keyword">.</span>ptr_vtake<span class="staexp"><span class="keyword">{</span>c?<span class="keyword">}</span></span><span class="keyword">(</span>pc<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> array_map2to$fwork&lt;<span class="staexp">a</span><span class="keyword">,</span><span class="staexp">b</span><span class="keyword">&gt;&lt;</span><span class="staexp">c</span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="keyword">!</span>pa<span class="keyword">,</span> <span class="keyword">!</span>pb<span class="keyword">,</span> <span class="keyword">!</span>pc<span class="keyword">)</span></span>
  <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fpfa <span class="keyword">(</span>pfa<span class="keyword">)</span></span>
  <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fpfb <span class="keyword">(</span>pfb<span class="keyword">)</span></span>
  <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fpfc <span class="keyword">(</span>$UN<span class="keyword">.</span>castview0<span class="staexp"><span class="keyword">{</span><span class="keyword">(</span>c?<span class="keyword">)</span><span class="keyword">@</span>lc<span class="keyword">}</span></span><span class="keyword">(</span>pfc<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="keyword">in</span>
  loop <span class="keyword">(</span>ptr_succ&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>pa<span class="keyword">)</span><span class="keyword">,</span> pa2<span class="keyword">,</span> ptr_succ&lt;<span class="staexp">b</span><span class="keyword">&gt;</span> <span class="keyword">(</span>pb<span class="keyword">)</span><span class="keyword">,</span> ptr_succ&lt;<span class="staexp">c</span><span class="keyword">&gt;</span> <span class="keyword">(</span>pc<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">(* end of [if] *)</span>
<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> loop <span class="keyword">(</span>pa<span class="keyword">,</span> pa2<span class="keyword">,</span> pb<span class="keyword">,</span> pc<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span> <span class="keyword">[</span><span class="staexp">lc<span class="keyword">:</span>addr</span><span class="keyword">]</span> EQADDR<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> ptr_get_index <span class="keyword">(</span>pc<span class="keyword">)</span></span>
<span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="dynexp"><span class="keyword">view@</span></span><span class="keyword">(</span>C<span class="keyword">)</span> := $UN<span class="keyword">.</span>castview0<span class="staexp"><span class="keyword">{</span>array_v <span class="keyword">(</span>c<span class="keyword">,</span> lc<span class="keyword">,</span> n<span class="keyword">)</span><span class="keyword">}</span></span><span class="keyword">(</span><span class="dynexp"><span class="keyword">view@</span></span><span class="keyword">(</span>C<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">in</span>
  <span class="comment">// nothing</span>
<span class="keyword">end</span></span></span> <span class="comment">(* end of [array_map2to] *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
implement
{a}(*tmp*)
array_bsearch
  (A, n) = $effmask_all let
//
val itr =
  $IT.giter_make_array(view@(A) | addr@(A), n)
// end of [val]
//
implement
$IT.giter_bsearch$ford&lt;a&gt;(x) = array_bsearch$ford&lt;a&gt; (x)
//
val () = $IT.giter_bsearch(itr, n)
//
val ofs = $IT.giter_get_fofs (itr)
//
val (pf | ()) = $IT.giter_free_array (itr)
//
prval((*returned*)) = view@ (A) := pf
//
in
  ofs
end // end of [array_bsearch]
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
array_permute
  <span class="keyword">(</span>A<span class="keyword">,</span> asz<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> lemma_array_param<span class="keyword">(</span>A<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
loop
<span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>nat<span class="keyword">}</span></span> <span class="keyword">.&lt;</span><span class="staexp">n</span><span class="keyword">&gt;.</span>
<span class="keyword">(</span>
  <span class="prfexp">pf<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">array_v</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span></span> <span class="keyword">|</span> p0<span class="keyword">:</span> <span class="staexp">ptr</span> <span class="staexp">l</span><span class="keyword">,</span> nz<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="staexp">n</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="comment">(*
val () =
  println! ("array_permute: loop")
*)</span>
<span class="comment">//</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">if</span>
<span class="keyword">(</span>nz &gt;= <span class="dynexp">2</span><span class="keyword">)</span>
<span class="keyword">then</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> i <span class="keyword">=</span> array_permute$randint&lt;<span class="keyword">&gt;</span><span class="keyword">(</span>nz<span class="keyword">)</span></span>
  <span class="prfexp"><span class="keyword">prval</span><span class="keyword">(</span>pf1<span class="keyword">,</span> pf2<span class="keyword">)</span> <span class="keyword">=</span> array_v_uncons<span class="keyword">(</span>pf<span class="keyword">)</span></span>
<span class="comment">//</span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span>
  <span class="keyword">if</span> i <span class="keyword">&gt;</span> <span class="dynexp">0</span> <span class="keyword">then</span>
  $UN<span class="keyword">.</span>ptr0_exch&lt;<span class="staexp">a</span><span class="keyword">&gt;</span>
    <span class="keyword">(</span>ptr0_add_guint&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>p0<span class="keyword">,</span> i<span class="keyword">)</span><span class="keyword">,</span> <span class="keyword">!</span>p0<span class="keyword">)</span></span>
  <span class="comment">// end of [if]</span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> loop <span class="keyword">(</span><span class="prfexp">pf2</span> <span class="keyword">|</span> ptr1_succ&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>p0<span class="keyword">)</span><span class="keyword">,</span> pred<span class="keyword">(</span>nz<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
  <span class="prfexp"><span class="keyword">prval</span><span class="keyword">(</span><span class="comment">(*returned*)</span><span class="keyword">)</span> <span class="keyword">=</span> pf := array_v_cons<span class="keyword">(</span>pf1<span class="keyword">,</span> pf2<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">in</span>
  <span class="comment">// nothing</span>
<span class="keyword">end</span></span> <span class="keyword">else</span> <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span> <span class="comment">// end of [if]</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [loop]</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  loop <span class="keyword">(</span><span class="prfexp"><span class="dynexp"><span class="keyword">view@</span></span> <span class="keyword">(</span>A<span class="keyword">)</span></span> <span class="keyword">|</span> <span class="dynexp"><span class="keyword">addr@</span></span> <span class="keyword">(</span>A<span class="keyword">)</span><span class="keyword">,</span> asz<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [array_permute]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="neuexp"><span class="keyword">#include</span> "./SHARE/array_bsearch.dats"</span>
<span class="neuexp"><span class="keyword">#include</span> "./SHARE/array_quicksort.dats"</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* end of [array.dats] *)</span>
</pre>
<pre class="patsyntax">
<span class="comment">(***********************************************************************)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(*                         Applied Type System                         *)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(***********************************************************************)</span>

<span class="comment">(*
** ATS/Postiats - Unleashing the Potential of Types!
** Copyright (C) 2010-2015 Hongwei Xi, ATS Trustful Software, Inc.
** All rights reserved
**
** ATS is free software;  you can  redistribute it and/or modify it under
** the terms of  the GNU GENERAL PUBLIC LICENSE (GPL) as published by the
** Free Software Foundation; either version 3, or (at  your  option)  any
** later version.
**
** ATS is distributed in the hope that it will be useful, but WITHOUT ANY
** WARRANTY; without  even  the  implied  warranty  of MERCHANTABILITY or
** FITNESS FOR A PARTICULAR PURPOSE.  See the  GNU General Public License
** for more details.
**
** You  should  have  received  a  copy of the GNU General Public License
** along  with  ATS;  see the  file COPYING.  If not, please write to the
** Free Software Foundation,  51 Franklin Street, Fifth Floor, Boston, MA
** 02110-1301, USA.
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
** Source:
** $PATSHOME/prelude/DATS/CODEGEN/array_prf.atxt
** Time of generation: Sun Oct  2 10:33:59 2016
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* Author: Hongwei Xi *)</span>
<span class="comment">(* Authoremail: hwxi AT cs DOT bu DOT edu *)</span>
<span class="comment">(* Start time: Feburary, 2012 *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="prfexp"><span class="keyword">primplmnt</span>
array_v_unnil_nil
  <span class="staexp"><span class="keyword">{</span>a1<span class="keyword">,</span>a2<span class="keyword">}</span></span><span class="keyword">(</span>pf<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span>
  array_v_unnil<span class="staexp"><span class="keyword">{</span>a1<span class="keyword">}</span></span><span class="keyword">(</span>pf<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  array_v_nil<span class="staexp"><span class="keyword">{</span>a2<span class="keyword">}</span></span><span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [array_v_unnil]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="prfexp"><span class="keyword">primplmnt</span>
array_v_sing
  <span class="keyword">(</span>pfat<span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
<span class="comment">//</span>
array_v_cons<span class="keyword">(</span>pfat<span class="keyword">,</span> array_v_nil<span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="comment">//</span>
<span class="keyword">)</span></span> <span class="comment">(* end of [array_v_sing] *)</span>

<span class="prfexp"><span class="keyword">primplmnt</span>
array_v_unsing
  <span class="keyword">(</span>pfarr<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span>
<span class="keyword">(</span>
  pf1at<span class="keyword">,</span> pf2arr
<span class="keyword">)</span> <span class="keyword">=</span> array_v_uncons <span class="keyword">(</span>pfarr<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> array_v_unnil <span class="keyword">(</span>pf2arr<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  pf1at
<span class="keyword">end</span></span> <span class="comment">// end of [array_v_unsing]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="prfexp"><span class="keyword">primplmnt</span>
array_v_split
  <span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="keyword">(</span>pf_arr<span class="keyword">)</span> <span class="keyword">=</span>
  split <span class="keyword">(</span>pf_arr<span class="keyword">)</span> <span class="keyword">where</span>
<span class="keyword">{</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prfun</span>
split
  <span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span> 
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">,</span>i<span class="keyword">:</span>nat <span class="keyword">|</span> i &lt;= n<span class="keyword">}</span></span> <span class="keyword">.&lt;</span><span class="staexp">i</span><span class="keyword">&gt;.</span>
<span class="keyword">(</span>
  pf_arr<span class="keyword">:</span> <span class="staexp">array_v</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="keyword">(</span>
  <span class="staexp">array_v</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">array_v</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">l</span><span class="staexp">+</span><span class="staexp">i</span><span class="staexp">*</span><span class="staexp">sizeof</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n</span><span class="staexp">-</span><span class="staexp">i</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span>
<span class="comment">//</span>
<span class="keyword">sif</span>
<span class="staexp">i</span> <span class="staexp"><span class="keyword">&gt;</span></span> <span class="staexp">0</span>
<span class="keyword">then</span> <span class="keyword">let</span>
  <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span>pf1elt<span class="keyword">,</span> pf2arr<span class="keyword">)</span> <span class="keyword">=</span> array_v_uncons<span class="keyword">(</span>pf_arr<span class="keyword">)</span></span>
  <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span>pf1arr_res<span class="keyword">,</span> pf2arr_res<span class="keyword">)</span> <span class="keyword">=</span> split<span class="staexp"><span class="keyword">{</span><span class="keyword">..</span><span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>n-1<span class="keyword">,</span>i-1<span class="keyword">}</span></span><span class="keyword">(</span>pf2arr<span class="keyword">)</span></span>
<span class="keyword">in</span>
  <span class="keyword">(</span>array_v_cons <span class="keyword">(</span>pf1elt<span class="keyword">,</span> pf1arr_res<span class="keyword">)</span><span class="keyword">,</span> pf2arr_res<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [then]</span>
<span class="keyword">else</span> <span class="keyword">let</span>
  <span class="prfexp"><span class="keyword">prval</span> EQINT <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span>
    eqint_make<span class="staexp"><span class="keyword">{</span>i<span class="keyword">,</span>0<span class="keyword">}</span></span><span class="keyword">(</span><span class="keyword">)</span></span> <span class="keyword">in</span> <span class="keyword">(</span>array_v_nil<span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>l<span class="keyword">}</span></span><span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span><span class="keyword">,</span> pf_arr<span class="keyword">)</span>
  <span class="comment">// end of [prval]</span>
<span class="keyword">end</span> <span class="comment">// end of [else]</span>
<span class="comment">//</span>
<span class="keyword">)</span></span> <span class="comment">(* end of [split] *)</span>
<span class="comment">//</span>
<span class="keyword">}</span></span> <span class="comment">(* end of [array_v_split] *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="prfexp"><span class="keyword">primplmnt</span>
array_v_split_at
  <span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>l<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>n<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>i<span class="keyword">}</span></span><span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> i<span class="keyword">)</span> <span class="keyword">=</span> array_v_split<span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>l<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>n<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>i<span class="keyword">}</span></span><span class="keyword">(</span>pf<span class="keyword">)</span></span>
<span class="comment">// end of [array_v_split_at]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="prfexp"><span class="keyword">primplmnt</span>
array_v_unsplit
  <span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="keyword">(</span>pf1arr<span class="keyword">,</span> pf2arr<span class="keyword">)</span> <span class="keyword">=</span>
  unsplit <span class="keyword">(</span>pf1arr<span class="keyword">,</span> pf2arr<span class="keyword">)</span> <span class="keyword">where</span>
<span class="keyword">{</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> lemma_array_v_param <span class="keyword">(</span>pf1arr<span class="keyword">)</span></span>
<span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> lemma_array_v_param <span class="keyword">(</span>pf2arr<span class="keyword">)</span></span> 
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prfun</span>
unsplit
  <span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span>
  <span class="staexp"><span class="keyword">{</span>n1<span class="keyword">,</span>n2<span class="keyword">:</span>nat<span class="keyword">}</span></span> <span class="keyword">.&lt;</span><span class="staexp">n1</span><span class="keyword">&gt;.</span>
<span class="keyword">(</span>
  pf1arr<span class="keyword">:</span> <span class="staexp">array_v</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">n1</span><span class="keyword">)</span>
<span class="keyword">,</span> pf2arr<span class="keyword">:</span> <span class="staexp">array_v</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">l</span><span class="staexp">+</span><span class="staexp">n1</span><span class="staexp">*</span><span class="staexp">sizeof</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">n2</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">array_v</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">n1</span><span class="staexp">+</span><span class="staexp">n2</span><span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
<span class="comment">//</span>
<span class="keyword">sif</span>
<span class="staexp">n1</span> <span class="staexp"><span class="keyword">&gt;</span></span> <span class="staexp">0</span>
<span class="keyword">then</span> <span class="keyword">let</span>
  <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">@(</span>
    pf11elt<span class="keyword">,</span> pf12arr
  <span class="keyword">)</span> <span class="keyword">=</span> array_v_uncons <span class="keyword">(</span>pf1arr<span class="keyword">)</span></span>
  <span class="prfexp"><span class="keyword">prval</span> pf_arr_res <span class="keyword">=</span> unsplit <span class="keyword">(</span>pf12arr<span class="keyword">,</span> pf2arr<span class="keyword">)</span></span>
<span class="keyword">in</span>
  array_v_cons <span class="keyword">(</span>pf11elt<span class="keyword">,</span> pf_arr_res<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [then]</span>
<span class="keyword">else</span> <span class="keyword">let</span>
  <span class="prfexp"><span class="keyword">prval</span>
  EQINT <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> eqint_make <span class="staexp"><span class="keyword">{</span>n1<span class="keyword">,</span>0<span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span></span>
  <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> array_v_unnil <span class="keyword">(</span>pf1arr<span class="keyword">)</span></span> <span class="keyword">in</span> pf2arr
<span class="keyword">end</span> <span class="comment">// end of [sif]</span>
<span class="comment">//</span>
<span class="keyword">)</span></span> <span class="comment">(* end of [unsplit] *)</span>
<span class="comment">//</span>
<span class="keyword">}</span></span> <span class="comment">(* end of [array_v_unsplit] *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="prfexp"><span class="keyword">primplmnt</span>
array_v_extend
  <span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="keyword">(</span>pf1arr<span class="keyword">,</span> pf2at<span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
<span class="comment">//</span>
array_v_unsplit
<span class="keyword">(</span>
  pf1arr<span class="keyword">,</span> array_v_sing<span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="keyword">(</span>pf2at<span class="keyword">)</span>
<span class="keyword">)</span> <span class="comment">// end of [array_v_unsplit]</span>
<span class="comment">//</span>
<span class="keyword">)</span></span> <span class="comment">(* end of [array_v_extend] *)</span>

<span class="prfexp"><span class="keyword">primplmnt</span>
array_v_unextend
  <span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>l<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>n<span class="keyword">}</span></span> <span class="keyword">(</span>pfarr<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span>pf1arr<span class="keyword">,</span> pf2arr<span class="keyword">)</span> <span class="keyword">=</span>
  array_v_split<span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>l<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>n<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>n-1<span class="keyword">}</span></span><span class="keyword">(</span>pfarr<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  <span class="keyword">(</span>pf1arr<span class="keyword">,</span> array_v_unsing<span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="keyword">(</span>pf2arr<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [array_v_unextend]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="prfexp"><span class="keyword">primplmnt</span>
array_v_takeout
  <span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>l<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>n<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>i<span class="keyword">}</span></span> <span class="keyword">(</span>pfarr<span class="keyword">)</span> <span class="keyword">=</span>
  takeout<span class="staexp"><span class="keyword">{</span><span class="keyword">..</span><span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>n<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>i<span class="keyword">}</span></span><span class="keyword">(</span>pfarr<span class="keyword">)</span> <span class="keyword">where</span>
<span class="keyword">{</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prfun</span>
takeout
  <span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  <span class="staexp"><span class="keyword">{</span>i<span class="keyword">:</span>nat <span class="keyword">|</span> i <span class="keyword">&lt;</span> n<span class="keyword">}</span></span> <span class="keyword">.&lt;</span><span class="staexp">i</span><span class="keyword">&gt;.</span>
<span class="keyword">(</span>
  pfarr<span class="keyword">:</span> <span class="staexp">array_v</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">vtakeout</span> <span class="keyword">(</span>
  <span class="staexp">array_v</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">a</span><span class="staexp"><span class="keyword">@</span></span><span class="staexp">l</span><span class="staexp">+</span><span class="staexp">i</span><span class="staexp">*</span><span class="staexp">sizeof</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">@(</span>pf1at<span class="keyword">,</span> pf2arr<span class="keyword">)</span> <span class="keyword">=</span> array_v_uncons<span class="keyword">(</span>pfarr<span class="keyword">)</span></span>
<span class="keyword">in</span>
  <span class="keyword">sif</span> <span class="staexp">i</span> <span class="staexp"><span class="keyword">&gt;</span></span> <span class="staexp">0</span> <span class="keyword">then</span> <span class="keyword">let</span>
    <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span>pfat<span class="keyword">,</span> fpf<span class="keyword">)</span> <span class="keyword">=</span> takeout<span class="staexp"><span class="keyword">{</span><span class="keyword">..</span><span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>n-1<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>i-1<span class="keyword">}</span></span><span class="keyword">(</span>pf2arr<span class="keyword">)</span></span>
  <span class="keyword">in</span>
    <span class="keyword">(</span>pfat<span class="keyword">,</span> <span class="keyword">llam</span> pfat <span class="keyword">=&lt;</span><span class="staexp">prf</span><span class="keyword">&gt;</span> array_v_cons<span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="keyword">(</span>pf1at<span class="keyword">,</span> fpf<span class="keyword">(</span>pfat<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span>
  <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">let</span>
    <span class="prfexp"><span class="keyword">prval</span> EQINT <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> eqint_make<span class="staexp"><span class="keyword">{</span>i<span class="keyword">,</span>0<span class="keyword">}</span></span><span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span></span>
  <span class="keyword">in</span>
    <span class="keyword">(</span>pf1at<span class="keyword">,</span> <span class="keyword">llam</span> pf1at <span class="keyword">=&lt;</span><span class="staexp">prf</span><span class="keyword">&gt;</span> array_v_cons<span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="keyword">(</span>pf1at<span class="keyword">,</span> pf2arr<span class="keyword">)</span><span class="keyword">)</span>
  <span class="keyword">end</span> <span class="comment">// end of [sif]</span>
<span class="keyword">end</span></span> <span class="comment">// end of takeout]</span>
<span class="comment">//</span>
<span class="keyword">}</span></span> <span class="comment">// end of [array_v_takeout]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* end of [array_prf.dats] *)</span>
</pre>
<pre class="patsyntax">
<span class="comment">(***********************************************************************)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(*                         Applied Type System                         *)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(***********************************************************************)</span>

<span class="comment">(*
** ATS/Postiats - Unleashing the Potential of Types!
** Copyright (C) 2010-2015 Hongwei Xi, ATS Trustful Software, Inc.
** All rights reserved
**
** ATS is free software;  you can  redistribute it and/or modify it under
** the terms of  the GNU GENERAL PUBLIC LICENSE (GPL) as published by the
** Free Software Foundation; either version 3, or (at  your  option)  any
** later version.
**
** ATS is distributed in the hope that it will be useful, but WITHOUT ANY
** WARRANTY; without  even  the  implied  warranty  of MERCHANTABILITY or
** FITNESS FOR A PARTICULAR PURPOSE.  See the  GNU General Public License
** for more details.
**
** You  should  have  received  a  copy of the GNU General Public License
** along  with  ATS;  see the  file COPYING.  If not, please write to the
** Free Software Foundation,  51 Franklin Street, Fifth Floor, Boston, MA
** 02110-1301, USA.
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
** Source:
** $PATSHOME/prelude/DATS/CODEGEN/arrayptr.atxt
** Time of generation: Sun Oct  2 10:33:59 2016
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* Author: Hongwei Xi *)</span>
<span class="comment">(* Authoremail: hwxi AT cs DOT bu DOT edu *)</span>
<span class="comment">(* Start time: May, 2012 *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">staload</span> UN <span class="keyword">=</span> "prelude/SATS/unsafe.sats"

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
arrayptr_make_elt
  <span class="keyword">(</span>asz<span class="keyword">,</span> elt<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span>
<span class="keyword">(</span>
  <span class="prfexp">pf</span><span class="keyword">,</span> <span class="prfexp">pfgc</span> <span class="keyword">|</span> p
<span class="keyword">)</span> <span class="keyword">=</span> array_ptr_alloc&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>asz<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> array_initize_elt&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="keyword">!</span>p<span class="keyword">,</span> asz<span class="keyword">,</span> elt<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  arrayptr_encode<span class="keyword">(</span><span class="prfexp">pf</span><span class="keyword">,</span> <span class="prfexp">pfgc</span> <span class="keyword">|</span> p<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [arrayptr_make_elt]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
arrayptr_make_intrange
  <span class="staexp"><span class="keyword">{</span>l<span class="keyword">,</span>r<span class="keyword">}</span></span> <span class="keyword">(</span>l<span class="keyword">,</span> r<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> asz <span class="keyword">=</span> g1int2uint <span class="keyword">(</span>r-l<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">[</span><span class="staexp">A<span class="keyword">:</span>addr</span><span class="keyword">]</span> A <span class="keyword">=</span>
  arrayptr_make_uninitized&lt;<span class="staexp">int</span><span class="keyword">&gt;</span> <span class="keyword">(</span>asz<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> loop
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>nat<span class="keyword">}</span></span> <span class="keyword">.&lt;</span><span class="staexp">n</span><span class="keyword">&gt;.</span> <span class="keyword">(</span>
  p<span class="keyword">:</span> <span class="staexp">ptr</span><span class="keyword">,</span> asz<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="staexp">n</span><span class="keyword">,</span> l<span class="keyword">:</span> <span class="staexp">int</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">wrt</span><span class="keyword">&gt;</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">if</span> asz <span class="keyword">&gt;</span> <span class="dynexp">0</span> <span class="keyword">then</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> $UN<span class="keyword">.</span>ptr0_set&lt;<span class="staexp">int</span><span class="keyword">&gt;</span> <span class="keyword">(</span>p<span class="keyword">,</span> l<span class="keyword">)</span></span>
<span class="keyword">in</span>
  loop <span class="keyword">(</span>ptr0_succ&lt;<span class="staexp">int</span><span class="keyword">&gt;</span> <span class="keyword">(</span>p<span class="keyword">)</span><span class="keyword">,</span> pred <span class="keyword">(</span>asz<span class="keyword">)</span><span class="keyword">,</span> l+<span class="dynexp">1</span><span class="keyword">)</span>
<span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="comment">// end of [if]</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [loop]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> loop <span class="keyword">(</span>ptrcast <span class="keyword">(</span>A<span class="keyword">)</span><span class="keyword">,</span> asz<span class="keyword">,</span> l<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  $UN<span class="keyword">.</span>castvwtp0<span class="staexp"><span class="keyword">{</span>arrayptr<span class="keyword">(</span>intBtw<span class="keyword">(</span>l<span class="keyword">,</span>r<span class="keyword">)</span><span class="keyword">,</span>A<span class="keyword">,</span>r-l<span class="keyword">)</span><span class="keyword">}</span></span><span class="keyword">(</span>A<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [arrayptr_make_intrange]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
arrayptr_make_list
  <span class="keyword">(</span>asz<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> lemma_list_param <span class="keyword">(</span>xs<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span>
  <span class="prfexp">pf</span><span class="keyword">,</span> <span class="prfexp">pfgc</span> <span class="keyword">|</span> p
<span class="keyword">)</span> <span class="keyword">=</span> array_ptr_alloc&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>i2sz<span class="keyword">(</span>asz<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> array_initize_list&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="keyword">!</span>p<span class="keyword">,</span> asz<span class="keyword">,</span> xs<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  arrayptr_encode<span class="keyword">(</span><span class="prfexp">pf</span><span class="keyword">,</span> <span class="prfexp">pfgc</span> <span class="keyword">|</span> p<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [arrayptr_make_list]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
arrayptr_make_rlist
  <span class="keyword">(</span>asz<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> lemma_list_param <span class="keyword">(</span>xs<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span>
  <span class="prfexp">pf</span><span class="keyword">,</span> <span class="prfexp">pfgc</span> <span class="keyword">|</span> p
<span class="keyword">)</span> <span class="keyword">=</span> array_ptr_alloc&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>i2sz<span class="keyword">(</span>asz<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> array_initize_rlist&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="keyword">!</span>p<span class="keyword">,</span> asz<span class="keyword">,</span> xs<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  arrayptr_encode<span class="keyword">(</span><span class="prfexp">pf</span><span class="keyword">,</span> <span class="prfexp">pfgc</span> <span class="keyword">|</span> p<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [arrayptr_make_rlist]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
arrayptr_make_subarray
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>st<span class="keyword">,</span>ln<span class="keyword">}</span></span><span class="keyword">(</span>A<span class="keyword">,</span> st<span class="keyword">,</span> ln<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> p1 <span class="keyword">=</span>
ptr_add&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>$UN<span class="keyword">.</span>cast2ptr<span class="keyword">(</span>A<span class="keyword">)</span><span class="keyword">,</span> st<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span>
  <span class="prfexp">pf1</span><span class="keyword">,</span> <span class="prfexp">fpf</span> <span class="keyword">|</span> p1
<span class="keyword">)</span> <span class="keyword">=</span> $UN<span class="keyword">.</span>ptr_vtake<span class="staexp"><span class="keyword">{</span>array<span class="keyword">(</span>a<span class="keyword">,</span>ln<span class="keyword">)</span><span class="keyword">}</span></span><span class="keyword">(</span>p1<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> A2 <span class="keyword">=</span>
arrayptr_make_uninitized&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>ln<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> p2 <span class="keyword">=</span> ptrcast <span class="keyword">(</span>A2<span class="keyword">)</span></span>
<span class="prfexp"><span class="keyword">prval</span> pf2 <span class="keyword">=</span> arrayptr_takeout <span class="keyword">(</span>A2<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> array_copy&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="keyword">!</span>p2<span class="keyword">,</span> <span class="keyword">!</span>p1<span class="keyword">,</span> ln<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fpf <span class="keyword">(</span>pf1<span class="keyword">)</span></span>
<span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> arrayptr_addback <span class="keyword">(</span><span class="prfexp">pf2</span> <span class="keyword">|</span> A2<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  A2
<span class="keyword">end</span></span> <span class="comment">// end of [arrayptr_make_subarray]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
arrayptr_make_list_vt
  <span class="keyword">(</span>asz<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> lemma_list_vt_param <span class="keyword">(</span>xs<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span>
 <span class="prfexp">pf</span><span class="keyword">,</span> <span class="prfexp">pfgc</span> <span class="keyword">|</span> p
<span class="keyword">)</span> <span class="keyword">=</span> array_ptr_alloc&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>i2sz<span class="keyword">(</span>asz<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> array_initize_list_vt&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="keyword">!</span>p<span class="keyword">,</span> asz<span class="keyword">,</span> xs<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  arrayptr_encode<span class="keyword">(</span><span class="prfexp">pf</span><span class="keyword">,</span> <span class="prfexp">pfgc</span> <span class="keyword">|</span> p<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [arrayptr_make_list_vt]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
arrayptr_make_rlist_vt
  <span class="keyword">(</span>asz<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> lemma_list_vt_param <span class="keyword">(</span>xs<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span>
 <span class="prfexp">pf</span><span class="keyword">,</span> <span class="prfexp">pfgc</span> <span class="keyword">|</span> p
<span class="keyword">)</span> <span class="keyword">=</span> array_ptr_alloc&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>i2sz<span class="keyword">(</span>asz<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> array_initize_rlist_vt&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="keyword">!</span>p<span class="keyword">,</span> asz<span class="keyword">,</span> xs<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  arrayptr_encode<span class="keyword">(</span><span class="prfexp">pf</span><span class="keyword">,</span> <span class="prfexp">pfgc</span> <span class="keyword">|</span> p<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [arrayptr_make_rlist_vt]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
arrayptr_make_uninitized
  <span class="keyword">(</span>asz<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="keyword">in</span>
  arrayptr_encode2<span class="keyword">(</span>array_ptr_alloc&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>asz<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [arrayptr_uninitize]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
arrayptr_imake_list
  <span class="keyword">(</span>A<span class="keyword">,</span> asz<span class="keyword">)</span> <span class="keyword">=</span> res <span class="keyword">where</span>
<span class="keyword">{</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> p <span class="keyword">=</span> ptrcast<span class="keyword">(</span>A<span class="keyword">)</span></span>
<span class="prfexp"><span class="keyword">prval</span> pf <span class="keyword">=</span> arrayptr_takeout <span class="keyword">(</span>A<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> res <span class="keyword">=</span> list_make_array <span class="keyword">(</span><span class="keyword">!</span>p<span class="keyword">,</span> asz<span class="keyword">)</span></span>
<span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> arrayptr_addback <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> A<span class="keyword">)</span></span>
<span class="keyword">}</span></span> <span class="comment">// end of [arrayptr_imake_list]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
implement
arrayptr_free = ATS_MFREE // HX: in arrayptr.cats
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
fprint_arrayptr
  <span class="keyword">(</span>out<span class="keyword">,</span> A<span class="keyword">,</span> n<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">where</span>
<span class="keyword">{</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> p <span class="keyword">=</span> ptrcast<span class="keyword">(</span>A<span class="keyword">)</span></span>
<span class="prfexp"><span class="keyword">prval</span> pf <span class="keyword">=</span> arrayptr_takeout <span class="keyword">(</span>A<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fprint_array&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">,</span> <span class="keyword">!</span>p<span class="keyword">,</span> n<span class="keyword">)</span></span>
<span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> arrayptr_addback <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> A<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">}</span></span> <span class="comment">// end of [fprint_arrayptr]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
fprint_arrayptr_sep
  <span class="keyword">(</span>out<span class="keyword">,</span> A<span class="keyword">,</span> n<span class="keyword">,</span> sep<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">where</span>
<span class="keyword">{</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> p <span class="keyword">=</span> ptrcast <span class="keyword">(</span>A<span class="keyword">)</span></span>
<span class="prfexp"><span class="keyword">prval</span> pf <span class="keyword">=</span> arrayptr_takeout <span class="keyword">(</span>A<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fprint_array_sep&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">,</span> <span class="keyword">!</span>p<span class="keyword">,</span> n<span class="keyword">,</span> sep<span class="keyword">)</span></span>
<span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> arrayptr_addback <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> A<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">}</span></span> <span class="comment">// end of [fprint_arrayptr_sep]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">tk</span><span class="keyword">}</span>
arrayptr_get_at_gint
  <span class="keyword">(</span>A<span class="keyword">,</span> i<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> p <span class="keyword">=</span> ptrcast <span class="keyword">(</span>A<span class="keyword">)</span></span> <span class="keyword">in</span>
  $UN<span class="keyword">.</span>ptr0_get&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>ptr1_add_gint&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">tk</span><span class="keyword">&gt;</span> <span class="keyword">(</span>p<span class="keyword">,</span> i<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [arrayptr_get_at_gint]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">tk</span><span class="keyword">}</span>
arrayptr_get_at_guint
  <span class="keyword">(</span>A<span class="keyword">,</span> i<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> p <span class="keyword">=</span> ptrcast <span class="keyword">(</span>A<span class="keyword">)</span></span> <span class="keyword">in</span>
  $UN<span class="keyword">.</span>ptr0_get&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>ptr1_add_guint&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">tk</span><span class="keyword">&gt;</span> <span class="keyword">(</span>p<span class="keyword">,</span> i<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [arrayptr_get_at_guint]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">tk</span><span class="keyword">}</span>
arrayptr_set_at_gint
  <span class="keyword">(</span>A<span class="keyword">,</span> i<span class="keyword">,</span> x<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> p <span class="keyword">=</span> ptrcast <span class="keyword">(</span>A<span class="keyword">)</span></span> <span class="keyword">in</span>
  $UN<span class="keyword">.</span>ptr0_set&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>ptr1_add_gint&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">tk</span><span class="keyword">&gt;</span> <span class="keyword">(</span>p<span class="keyword">,</span> i<span class="keyword">)</span><span class="keyword">,</span> x<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [arrayptr_set_at_gint]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">tk</span><span class="keyword">}</span>
arrayptr_set_at_guint
  <span class="keyword">(</span>A<span class="keyword">,</span> i<span class="keyword">,</span> x<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> p <span class="keyword">=</span> ptrcast <span class="keyword">(</span>A<span class="keyword">)</span></span> <span class="keyword">in</span>
  $UN<span class="keyword">.</span>ptr0_set&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>ptr1_add_guint&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">tk</span><span class="keyword">&gt;</span> <span class="keyword">(</span>p<span class="keyword">,</span> i<span class="keyword">)</span><span class="keyword">,</span> x<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [arrayptr_set_at_guint]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
arrayptr_interchange
  <span class="keyword">(</span>A<span class="keyword">,</span> i<span class="keyword">,</span> j<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
  <span class="dynexp"><span class="keyword">val</span> p <span class="keyword">=</span> ptrcast <span class="keyword">(</span>A<span class="keyword">)</span></span>
  <span class="prfexp"><span class="keyword">prval</span> pfarr <span class="keyword">=</span> arrayptr_takeout <span class="keyword">(</span>A<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> array_interchange <span class="keyword">(</span><span class="keyword">!</span>p<span class="keyword">,</span> i<span class="keyword">,</span> j<span class="keyword">)</span></span>
  <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> arrayptr_addback <span class="keyword">(</span><span class="prfexp">pfarr</span> <span class="keyword">|</span> A<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">in</span>
  <span class="comment">// noting</span>
<span class="keyword">end</span></span></span> <span class="comment">// end of [arrayptr_interchange]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
arrayptr_foreach
  <span class="keyword">(</span>A<span class="keyword">,</span> asz<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">var</span> env<span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">in</span>
  arrayptr_foreach_env&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">void</span><span class="keyword">&gt;</span> <span class="keyword">(</span>A<span class="keyword">,</span> asz<span class="keyword">,</span> env<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [arrayptr_foreach]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">env</span><span class="keyword">}</span>
arrayptr_foreach_env
  <span class="keyword">(</span>A<span class="keyword">,</span> asz<span class="keyword">,</span> env<span class="keyword">)</span> <span class="keyword">=</span> res <span class="keyword">where</span> <span class="keyword">{</span>
  <span class="dynexp"><span class="keyword">val</span> p <span class="keyword">=</span> ptrcast <span class="keyword">(</span>A<span class="keyword">)</span></span>
  <span class="prfexp"><span class="keyword">prval</span> pfarr <span class="keyword">=</span> arrayptr_takeout <span class="keyword">(</span>A<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> res <span class="keyword">=</span> array_foreach_env&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">env</span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="keyword">!</span>p<span class="keyword">,</span> asz<span class="keyword">,</span> env<span class="keyword">)</span></span>
  <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> arrayptr_addback <span class="keyword">(</span><span class="prfexp">pfarr</span> <span class="keyword">|</span> A<span class="keyword">)</span></span>
<span class="keyword">}</span></span> <span class="comment">// end of [arrayptr_foreach_env]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
arrayptr_foreach_fun
  <span class="keyword">(</span>A<span class="keyword">,</span> asz<span class="keyword">,</span> f<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> p <span class="keyword">=</span> ptrcast <span class="keyword">(</span>A<span class="keyword">)</span></span>
  <span class="prfexp"><span class="keyword">prval</span> pfarr <span class="keyword">=</span> arrayptr_takeout <span class="keyword">(</span>A<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> array_foreach_fun&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="keyword">!</span>p<span class="keyword">,</span> asz<span class="keyword">,</span> f<span class="keyword">)</span></span>
  <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> arrayptr_addback <span class="keyword">(</span><span class="prfexp">pfarr</span> <span class="keyword">|</span> A<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">in</span>
  <span class="comment">// nothing</span>
<span class="keyword">end</span></span></span> <span class="comment">// end of [arrayptr_foreach_fun]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
arrayptr_foreach_funenv
  <span class="keyword">(</span><span class="prfexp">pfv</span> <span class="keyword">|</span> A<span class="keyword">,</span> asz<span class="keyword">,</span> f<span class="keyword">,</span> env<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> p <span class="keyword">=</span> ptrcast <span class="keyword">(</span>A<span class="keyword">)</span></span>
<span class="prfexp"><span class="keyword">prval</span> pfarr <span class="keyword">=</span> arrayptr_takeout <span class="keyword">(</span>A<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span>
  array_foreach_funenv&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="prfexp">pfv</span> <span class="keyword">|</span> <span class="keyword">!</span>p<span class="keyword">,</span> asz<span class="keyword">,</span> f<span class="keyword">,</span> env<span class="keyword">)</span></span>
<span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> arrayptr_addback <span class="keyword">(</span><span class="prfexp">pfarr</span> <span class="keyword">|</span> A<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">in</span>
  <span class="comment">// nothing</span>
<span class="keyword">end</span></span></span> <span class="comment">// end of [arrayptr_foreach_funenv]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
arrayptr_iforeach
  <span class="keyword">(</span>A<span class="keyword">,</span> asz<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">var</span> env<span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">in</span>
  arrayptr_iforeach_env&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">void</span><span class="keyword">&gt;</span> <span class="keyword">(</span>A<span class="keyword">,</span> asz<span class="keyword">,</span> env<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [arrayptr_iforeach]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">env</span><span class="keyword">}</span>
arrayptr_iforeach_env
  <span class="keyword">(</span>A<span class="keyword">,</span> asz<span class="keyword">,</span> env<span class="keyword">)</span> <span class="keyword">=</span> res <span class="keyword">where</span> <span class="keyword">{</span>
  <span class="dynexp"><span class="keyword">val</span> p <span class="keyword">=</span> ptrcast <span class="keyword">(</span>A<span class="keyword">)</span></span>
  <span class="prfexp"><span class="keyword">prval</span> pfarr <span class="keyword">=</span> arrayptr_takeout <span class="keyword">(</span>A<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> res <span class="keyword">=</span> array_iforeach_env&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">env</span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="keyword">!</span>p<span class="keyword">,</span> asz<span class="keyword">,</span> env<span class="keyword">)</span></span>
  <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> arrayptr_addback <span class="keyword">(</span><span class="prfexp">pfarr</span> <span class="keyword">|</span> A<span class="keyword">)</span></span>
<span class="keyword">}</span></span> <span class="comment">// end of [arrayptr_iforeach_env]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
arrayptr_rforeach
  <span class="keyword">(</span>A<span class="keyword">,</span> asz<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">var</span> env<span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">in</span>
  arrayptr_rforeach_env&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">void</span><span class="keyword">&gt;</span> <span class="keyword">(</span>A<span class="keyword">,</span> asz<span class="keyword">,</span> env<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [arrayptr_rforeach]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">env</span><span class="keyword">}</span>
arrayptr_rforeach_env
  <span class="keyword">(</span>A<span class="keyword">,</span> asz<span class="keyword">,</span> env<span class="keyword">)</span> <span class="keyword">=</span> res <span class="keyword">where</span> <span class="keyword">{</span>
  <span class="dynexp"><span class="keyword">val</span> p <span class="keyword">=</span> ptrcast <span class="keyword">(</span>A<span class="keyword">)</span></span>
  <span class="prfexp"><span class="keyword">prval</span> pfarr <span class="keyword">=</span> arrayptr_takeout <span class="keyword">(</span>A<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> res <span class="keyword">=</span> array_rforeach_env&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">env</span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="keyword">!</span>p<span class="keyword">,</span> asz<span class="keyword">,</span> env<span class="keyword">)</span></span>
  <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> arrayptr_addback <span class="keyword">(</span><span class="prfexp">pfarr</span> <span class="keyword">|</span> A<span class="keyword">)</span></span>
<span class="keyword">}</span></span> <span class="comment">// end of [arrayptr_rforeach_env]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
arrayptr_initize
  <span class="keyword">(</span>A<span class="keyword">,</span> asz<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">where</span> <span class="keyword">{</span>
  <span class="dynexp"><span class="keyword">val</span> p <span class="keyword">=</span> ptrcast <span class="keyword">(</span>A<span class="keyword">)</span></span>
  <span class="prfexp"><span class="keyword">prval</span> pfarr <span class="keyword">=</span> arrayptr_takeout <span class="keyword">(</span>A<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> array_initize&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="keyword">!</span>p<span class="keyword">,</span> asz<span class="keyword">)</span></span>
  <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> arrayptr_addback <span class="keyword">(</span><span class="prfexp">pfarr</span> <span class="keyword">|</span> A<span class="keyword">)</span></span>
<span class="keyword">}</span></span> <span class="comment">// end of [arrayptr_initize]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
arrayptr_uninitize
  <span class="keyword">(</span>A<span class="keyword">,</span> asz<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">where</span> <span class="keyword">{</span>
  <span class="dynexp"><span class="keyword">val</span> p <span class="keyword">=</span> ptrcast <span class="keyword">(</span>A<span class="keyword">)</span></span>
  <span class="prfexp"><span class="keyword">prval</span> pfarr <span class="keyword">=</span> arrayptr_takeout <span class="keyword">(</span>A<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> array_uninitize&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="keyword">!</span>p<span class="keyword">,</span> asz<span class="keyword">)</span></span>
  <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> arrayptr_addback <span class="keyword">(</span><span class="prfexp">pfarr</span> <span class="keyword">|</span> A<span class="keyword">)</span></span>
<span class="keyword">}</span></span> <span class="comment">// end of [arrayptr_uninitize]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
arrayptr_freelin
  <span class="keyword">(</span>A<span class="keyword">,</span> asz<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> arrayptr_uninitize&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>A<span class="keyword">,</span> asz<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  arrayptr_free<span class="staexp"><span class="keyword">{</span>a?<span class="keyword">}</span></span><span class="keyword">(</span>A<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [arrayptr_freelin]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
arrayptr_tabulate
  <span class="keyword">(</span>asz<span class="keyword">)</span> <span class="keyword">=</span> arrayptr_encode2<span class="keyword">(</span>array_ptr_tabulate&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>asz<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">// end of [arrayptr_tabulate]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
arrayptr_tabulate_cloref
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">}</span></span> <span class="keyword">(</span>asz<span class="keyword">,</span> f<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span><span class="keyword">(</span><span class="staexp">a2</span><span class="keyword">)</span>
array_tabulate$fopr&lt;<span class="staexp">a2</span><span class="keyword">&gt;</span> <span class="keyword">(</span>i<span class="keyword">)</span> <span class="keyword">=</span> $UN<span class="keyword">.</span>castvwtp0<span class="staexp"><span class="keyword">{</span>a2<span class="keyword">}</span></span><span class="keyword">(</span>f<span class="keyword">(</span>$UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>sizeLt<span class="keyword">(</span>n<span class="keyword">)</span><span class="keyword">}</span></span><span class="keyword">(</span>i<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  arrayptr_tabulate&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>asz<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [arrayptr_tabulate_cloref]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
arrayptr_quicksort
  <span class="keyword">(</span>A<span class="keyword">,</span> asz<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">where</span>
<span class="keyword">{</span>
  <span class="dynexp"><span class="keyword">val</span> p <span class="keyword">=</span> ptrcast <span class="keyword">(</span>A<span class="keyword">)</span></span>
  <span class="prfexp"><span class="keyword">prval</span> pfarr <span class="keyword">=</span> arrayptr_takeout <span class="keyword">(</span>A<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> array_quicksort&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="keyword">!</span>p<span class="keyword">,</span> asz<span class="keyword">)</span></span>
  <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> arrayptr_addback <span class="keyword">(</span><span class="prfexp">pfarr</span> <span class="keyword">|</span> A<span class="keyword">)</span></span>
<span class="keyword">}</span></span> <span class="comment">(* end of [arrayptr_quicksort] *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* end of [arrayptr.dats] *)</span>
</pre>
<pre class="patsyntax">
<span class="comment">(***********************************************************************)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(*                         Applied Type System                         *)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(***********************************************************************)</span>

<span class="comment">(*
** ATS/Postiats - Unleashing the Potential of Types!
** Copyright (C) 2010-2015 Hongwei Xi, ATS Trustful Software, Inc.
** All rights reserved
**
** ATS is free software;  you can  redistribute it and/or modify it under
** the terms of  the GNU GENERAL PUBLIC LICENSE (GPL) as published by the
** Free Software Foundation; either version 3, or (at  your  option)  any
** later version.
**
** ATS is distributed in the hope that it will be useful, but WITHOUT ANY
** WARRANTY; without  even  the  implied  warranty  of MERCHANTABILITY or
** FITNESS FOR A PARTICULAR PURPOSE.  See the  GNU General Public License
** for more details.
**
** You  should  have  received  a  copy of the GNU General Public License
** along  with  ATS;  see the  file COPYING.  If not, please write to the
** Free Software Foundation,  51 Franklin Street, Fifth Floor, Boston, MA
** 02110-1301, USA.
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
** Source:
** $PATSHOME/prelude/DATS/CODEGEN/arrayref.atxt
** Time of generation: Sun Oct  2 10:33:59 2016
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* Author: Hongwei Xi *)</span>
<span class="comment">(* Authoremail: hwxi AT cs DOT bu DOT edu *)</span>
<span class="comment">(* Start time: May, 2012 *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">staload</span> UN <span class="keyword">=</span> "prelude/SATS/unsafe.sats"

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
arrayref_make_elt <span class="keyword">(</span>asz<span class="keyword">,</span> x<span class="keyword">)</span> <span class="keyword">=</span>
  arrayptr_refize<span class="keyword">(</span>arrayptr_make_elt&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>asz<span class="keyword">,</span> x<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">// end of [arrayref_make_elt]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
arrayref_make_intrange <span class="keyword">(</span>l<span class="keyword">,</span> r<span class="keyword">)</span> <span class="keyword">=</span>
  arrayptr_refize<span class="staexp"><span class="keyword">{</span>int<span class="keyword">}</span></span><span class="keyword">(</span>arrayptr_make_intrange <span class="keyword">(</span>l<span class="keyword">,</span> r<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">// end of [arrayref_make_intrange]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
arrayref_make_list <span class="keyword">(</span>asz<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=</span>
  arrayptr_refize<span class="keyword">(</span>arrayptr_make_list&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>asz<span class="keyword">,</span> xs<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">// end of [arrayref_make_list]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
arrayref_make_rlist <span class="keyword">(</span>asz<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=</span>
  arrayptr_refize<span class="keyword">(</span>arrayptr_make_rlist&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>asz<span class="keyword">,</span> xs<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">// end of [arrayref_make_rlist]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
arrayref_head<span class="keyword">(</span>A<span class="keyword">)</span> <span class="keyword">=</span> $UN<span class="keyword">.</span>ptr0_get&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>arrayref2ptr<span class="keyword">(</span>A<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
arrayref_tail<span class="staexp"><span class="keyword">{</span>n<span class="keyword">}</span></span><span class="keyword">(</span>A<span class="keyword">)</span> <span class="keyword">=</span>
  $UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>arrayref<span class="keyword">(</span>a<span class="keyword">,</span>n-1<span class="keyword">)</span><span class="keyword">}</span></span><span class="keyword">(</span>ptr_succ&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>arrayref2ptr<span class="keyword">(</span>A<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">tk</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
arrayref_get_at_gint
  <span class="keyword">(</span>A<span class="keyword">,</span> i<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">vbox pf</span> <span class="keyword">|</span> p<span class="keyword">)</span> <span class="keyword">=</span>
  arrayref_get_viewptr <span class="keyword">(</span>A<span class="keyword">)</span></span> <span class="keyword">in</span> array_get_at_gint <span class="keyword">(</span><span class="keyword">!</span>p<span class="keyword">,</span> i<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [arrayref_get_at_gint]</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">tk</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
arrayref_get_at_guint
  <span class="keyword">(</span>A<span class="keyword">,</span> i<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">vbox pf</span> <span class="keyword">|</span> p<span class="keyword">)</span> <span class="keyword">=</span>
  arrayref_get_viewptr <span class="keyword">(</span>A<span class="keyword">)</span></span> <span class="keyword">in</span> array_get_at_guint <span class="keyword">(</span><span class="keyword">!</span>p<span class="keyword">,</span> i<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [arrayref_get_at_guint]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">tk</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
arrayref_set_at_gint
  <span class="keyword">(</span>A<span class="keyword">,</span> i<span class="keyword">,</span> x<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">vbox pf</span> <span class="keyword">|</span> p<span class="keyword">)</span> <span class="keyword">=</span>
  arrayref_get_viewptr <span class="keyword">(</span>A<span class="keyword">)</span></span> <span class="keyword">in</span> array_set_at_gint <span class="keyword">(</span><span class="keyword">!</span>p<span class="keyword">,</span> i<span class="keyword">,</span> x<span class="keyword">)</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [arrayref_set_at_gint]</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">tk</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
arrayref_set_at_guint
  <span class="keyword">(</span>A<span class="keyword">,</span> i<span class="keyword">,</span> x<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">vbox pf</span> <span class="keyword">|</span> p<span class="keyword">)</span> <span class="keyword">=</span>
  arrayref_get_viewptr <span class="keyword">(</span>A<span class="keyword">)</span></span> <span class="keyword">in</span> array_set_at_guint <span class="keyword">(</span><span class="keyword">!</span>p<span class="keyword">,</span> i<span class="keyword">,</span> x<span class="keyword">)</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [arrayref_set_at_guint]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">tk</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
arrayref_exch_at_gint
  <span class="keyword">(</span>A<span class="keyword">,</span> i<span class="keyword">,</span> x<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">vbox pf</span> <span class="keyword">|</span> p<span class="keyword">)</span> <span class="keyword">=</span>
  arrayref_get_viewptr <span class="keyword">(</span>A<span class="keyword">)</span></span> <span class="keyword">in</span> array_exch_at_gint <span class="keyword">(</span><span class="keyword">!</span>p<span class="keyword">,</span> i<span class="keyword">,</span> x<span class="keyword">)</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [arrayref_exch_at_gint]</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">tk</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
arrayref_exch_at_guint
  <span class="keyword">(</span>A<span class="keyword">,</span> i<span class="keyword">,</span> x<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">vbox pf</span> <span class="keyword">|</span> p<span class="keyword">)</span> <span class="keyword">=</span>
  arrayref_get_viewptr <span class="keyword">(</span>A<span class="keyword">)</span></span> <span class="keyword">in</span> array_exch_at_guint <span class="keyword">(</span><span class="keyword">!</span>p<span class="keyword">,</span> i<span class="keyword">,</span> x<span class="keyword">)</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [arrayref_exch_at_guint]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
arrayref_interchange
  <span class="keyword">(</span>A<span class="keyword">,</span> i<span class="keyword">,</span> j<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">vbox pf</span> <span class="keyword">|</span> p<span class="keyword">)</span> <span class="keyword">=</span>
  arrayref_get_viewptr <span class="keyword">(</span>A<span class="keyword">)</span></span> <span class="keyword">in</span> array_interchange&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="keyword">!</span>p<span class="keyword">,</span> i<span class="keyword">,</span> j<span class="keyword">)</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [arrayref_interchange]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
arrayref_subcirculate
  <span class="keyword">(</span>A<span class="keyword">,</span> i<span class="keyword">,</span> j<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">vbox pf</span> <span class="keyword">|</span> p<span class="keyword">)</span> <span class="keyword">=</span>
  arrayref_get_viewptr <span class="keyword">(</span>A<span class="keyword">)</span></span> <span class="keyword">in</span> array_subcirculate&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="keyword">!</span>p<span class="keyword">,</span> i<span class="keyword">,</span> j<span class="keyword">)</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [arrayref_subcirculate]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
fprint_arrayref
  <span class="keyword">(</span>out<span class="keyword">,</span> A<span class="keyword">,</span> n<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">vbox pf</span> <span class="keyword">|</span> p<span class="keyword">)</span> <span class="keyword">=</span> arrayref_get_viewptr <span class="keyword">(</span>A<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  <span class="keyword">$effmask_ref</span> <span class="keyword">(</span>fprint_array&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">,</span> <span class="keyword">!</span>p<span class="keyword">,</span> n<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [fprint_arrayref]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
fprint_arrayref_sep
  <span class="keyword">(</span>out<span class="keyword">,</span> A<span class="keyword">,</span> n<span class="keyword">,</span> sep<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">vbox pf</span> <span class="keyword">|</span> p<span class="keyword">)</span> <span class="keyword">=</span> arrayref_get_viewptr <span class="keyword">(</span>A<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  <span class="keyword">$effmask_ref</span> <span class="keyword">(</span>fprint_array_sep&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">,</span> <span class="keyword">!</span>p<span class="keyword">,</span> n<span class="keyword">,</span> sep<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [fprint_arrayref_sep]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
arrayref_copy
  <span class="staexp"><span class="keyword">{</span>n<span class="keyword">}</span></span> <span class="keyword">(</span>A<span class="keyword">,</span> n<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pf</span><span class="keyword">,</span> <span class="prfexp">fpf</span> <span class="keyword">|</span> p<span class="keyword">)</span> <span class="keyword">=</span>
  $UN<span class="keyword">.</span>ptr0_vtake<span class="staexp"><span class="keyword">{</span>array<span class="keyword">(</span>a<span class="keyword">,</span>n<span class="keyword">)</span><span class="keyword">}</span></span><span class="keyword">(</span>ptrcast<span class="keyword">(</span>A<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pf2</span><span class="keyword">,</span> <span class="prfexp">pf2gc</span> <span class="keyword">|</span> p2<span class="keyword">)</span> <span class="keyword">=</span> array_ptr_alloc&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>n<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span> <span class="keyword">=</span> array_copy&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="keyword">!</span>p2<span class="keyword">,</span> <span class="keyword">!</span>p<span class="keyword">,</span> n<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span> <span class="keyword">=</span> fpf <span class="keyword">(</span>pf<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  $UN<span class="keyword">.</span>castvwtp0<span class="staexp"><span class="keyword">{</span>arrayptr<span class="keyword">(</span>a<span class="keyword">,</span>n<span class="keyword">)</span><span class="keyword">}</span></span><span class="keyword">(</span><span class="keyword">(</span><span class="prfexp">pf2</span><span class="keyword">,</span> <span class="prfexp">pf2gc</span> <span class="keyword">|</span> p2<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [arrayref_copy]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
arrayref_tabulate
  <span class="keyword">(</span>asz<span class="keyword">)</span> <span class="keyword">=</span> arrayptr_refize <span class="keyword">(</span>arrayptr_tabulate&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>asz<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">// end of [arrayref_tabulate]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
arrayref_tabulate_cloref
  <span class="keyword">(</span>asz<span class="keyword">,</span> f<span class="keyword">)</span> <span class="keyword">=</span> arrayptr_refize <span class="keyword">(</span>arrayptr_tabulate_cloref&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>asz<span class="keyword">,</span> f<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">// end of [arrayref_tabulate_cloref]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
arrayref_foreach
  <span class="keyword">(</span>A<span class="keyword">,</span> asz<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">var</span> env<span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">in</span> arrayref_foreach_env&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">void</span><span class="keyword">&gt;</span> <span class="keyword">(</span>A<span class="keyword">,</span> asz<span class="keyword">,</span> env<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [arrayref_foreach]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">env</span><span class="keyword">}</span>
arrayref_foreach_env
  <span class="keyword">(</span>A<span class="keyword">,</span> asz<span class="keyword">,</span> env<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">vbox pf</span> <span class="keyword">|</span> p<span class="keyword">)</span> <span class="keyword">=</span> arrayref_get_viewptr <span class="keyword">(</span>A<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  <span class="keyword">$effmask_ref</span> <span class="keyword">(</span>array_foreach_env&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">env</span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="keyword">!</span>p<span class="keyword">,</span> asz<span class="keyword">,</span> env<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [arrayref_foreach_env]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
arrayref_iforeach
  <span class="keyword">(</span>A<span class="keyword">,</span> asz<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">var</span> env<span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">in</span>
  arrayref_iforeach_env&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">void</span><span class="keyword">&gt;</span> <span class="keyword">(</span>A<span class="keyword">,</span> asz<span class="keyword">,</span> env<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [arrayref_iforeach]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">env</span><span class="keyword">}</span>
arrayref_iforeach_env
  <span class="keyword">(</span>A<span class="keyword">,</span> asz<span class="keyword">,</span> env<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">vbox pf</span> <span class="keyword">|</span> p<span class="keyword">)</span> <span class="keyword">=</span> arrayref_get_viewptr <span class="keyword">(</span>A<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  <span class="keyword">$effmask_ref</span> <span class="keyword">(</span>array_iforeach_env&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">env</span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="keyword">!</span>p<span class="keyword">,</span> asz<span class="keyword">,</span> env<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [arrayref_iforeach_env]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
arrayref_rforeach
  <span class="keyword">(</span>A<span class="keyword">,</span> asz<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">var</span> env<span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">in</span>
  arrayref_rforeach_env&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">void</span><span class="keyword">&gt;</span> <span class="keyword">(</span>A<span class="keyword">,</span> asz<span class="keyword">,</span> env<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [arrayref_rforeach]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">env</span><span class="keyword">}</span>
arrayref_rforeach_env
  <span class="keyword">(</span>A<span class="keyword">,</span> asz<span class="keyword">,</span> env<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">vbox pf</span> <span class="keyword">|</span> p<span class="keyword">)</span> <span class="keyword">=</span> arrayref_get_viewptr <span class="keyword">(</span>A<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  <span class="keyword">$effmask_ref</span> <span class="keyword">(</span>array_rforeach_env&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">env</span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="keyword">!</span>p<span class="keyword">,</span> asz<span class="keyword">,</span> env<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [arrayref_rforeach_env]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
arrayref_quicksort
  <span class="keyword">(</span>A<span class="keyword">,</span> asz<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">vbox pf</span> <span class="keyword">|</span> p<span class="keyword">)</span> <span class="keyword">=</span> arrayref_get_viewptr <span class="keyword">(</span>A<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  <span class="keyword">$effmask_ref</span> <span class="keyword">(</span>array_quicksort&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="keyword">!</span>p<span class="keyword">,</span> asz<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [arrayref_quicksort]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">local</span>

<span class="keyword">datatype</span>
<span class="staexp">arrszref
<span class="keyword">(</span>
  a<span class="keyword">:</span><span class="keyword">viewt@ype</span>
<span class="keyword">)</span> <span class="keyword">=</span>
  <span class="dynexp"><span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
  ARRSZREF <span class="keyword">of</span> <span class="keyword">(</span><span class="staexp">arrayref</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">size_t</span> <span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">)</span></span></span>
<span class="comment">// end of [arrszref]</span>

<span class="staexp"><span class="keyword">assume</span>
arrszref_vt0ype_type <span class="keyword">=</span> arrszref</span>

<span class="keyword">in</span> <span class="comment">(* in of [local] *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
arrszref_make_arrpsz
  <span class="keyword">(</span>psz<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="keyword">var</span> asz<span class="keyword">:</span> <span class="staexp">size_t</span>
<span class="dynexp"><span class="keyword">val</span> A <span class="keyword">=</span> arrpsz_get_ptrsize <span class="keyword">(</span>psz<span class="keyword">,</span> asz<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> A <span class="keyword">=</span> arrayptr_refize <span class="keyword">(</span>A<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  ARRSZREF<span class="keyword">(</span>A<span class="keyword">,</span> asz<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [arrszref_make_arrpsz]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
arrszref_make_arrayref
  <span class="keyword">(</span>A<span class="keyword">,</span> asz<span class="keyword">)</span> <span class="keyword">=</span> ARRSZREF<span class="keyword">(</span>A<span class="keyword">,</span> asz<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
arrszref_get_ref
  <span class="keyword">(</span>ASZ<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val+</span>
ARRSZREF<span class="keyword">(</span>A<span class="keyword">,</span> _<span class="keyword">)</span> <span class="keyword">=</span> ASZ</span> <span class="keyword">in</span> $UN<span class="keyword">.</span>cast2Ptr1<span class="keyword">(</span>A<span class="keyword">)</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [arrszref_get_size]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
arrszref_get_size
  <span class="keyword">(</span>ASZ<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val+</span>ARRSZREF<span class="keyword">(</span>_<span class="keyword">,</span> n<span class="keyword">)</span> <span class="keyword">=</span> ASZ</span> <span class="keyword">in</span> <span class="keyword">(</span>n<span class="keyword">)</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [arrszref_get_size]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
arrszref_get_refsize
  <span class="keyword">(</span>ASZ<span class="keyword">,</span> nref<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val+</span>ARRSZREF<span class="keyword">(</span>A<span class="keyword">,</span> n<span class="keyword">)</span> <span class="keyword">=</span> ASZ</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> lemma_arrayref_param <span class="keyword">(</span>A<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  nref := n<span class="keyword">;</span> A<span class="comment">(*arrayref*)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [arrszref_get_refsize]</span>

<span class="keyword">end</span> <span class="comment">// end of [local]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
arrszref_make_elt
  <span class="keyword">(</span>n<span class="keyword">,</span> x<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> n <span class="keyword">=</span> g1ofg0_uint <span class="keyword">(</span>n<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> A <span class="keyword">=</span> arrayref_make_elt&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>n<span class="keyword">,</span> x<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  arrszref_make_arrayref <span class="keyword">(</span>A<span class="keyword">,</span> n<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [arrszref_make_elt]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
arrszref_make_list
  <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> n <span class="keyword">=</span> list_length&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>xs<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> A <span class="keyword">=</span> arrayref_make_list <span class="keyword">(</span>n<span class="keyword">,</span> xs<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> lemma_list_param <span class="keyword">(</span>xs<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  arrszref_make_arrayref <span class="keyword">(</span>A<span class="keyword">,</span> i2sz<span class="keyword">(</span>n<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [arrszref_make_list]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
arrszref_make_rlist
  <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> lemma_list_param <span class="keyword">(</span>xs<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> n <span class="keyword">=</span> list_length&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>xs<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> A <span class="keyword">=</span> arrayref_make_rlist <span class="keyword">(</span>n<span class="keyword">,</span> xs<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  arrszref_make_arrayref <span class="keyword">(</span>A<span class="keyword">,</span> i2sz<span class="keyword">(</span>n<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [arrszref_make_rlist]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
arrszref_get_at_size
  <span class="keyword">(</span>ASZ<span class="keyword">,</span> i<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">$effmask_wrt</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="keyword">var</span> n<span class="keyword">:</span> <span class="staexp">size_t</span>
<span class="dynexp"><span class="keyword">val</span> A <span class="keyword">=</span> arrszref_get_refsize <span class="keyword">(</span>ASZ<span class="keyword">,</span> n<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> i <span class="keyword">=</span> g1ofg0_uint <span class="keyword">(</span>i<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">if</span> n <span class="keyword">&gt;</span> i
<span class="keyword">then</span> arrayref_get_at_guint <span class="keyword">(</span>A<span class="keyword">,</span> i<span class="keyword">)</span>
<span class="keyword">else</span> <span class="dynexp"><span class="keyword">$raise</span> ArraySubscriptExn<span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [arrszref_get_at_size]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">tk</span><span class="keyword">}</span>
arrszref_get_at_gint
  <span class="keyword">(</span>ASZ<span class="keyword">,</span> i<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">if</span> <span class="keyword">(</span>
i &gt;= <span class="dynexp">0</span>
<span class="keyword">)</span> <span class="keyword">then</span> <span class="keyword">(</span>
  arrszref_get_at_size <span class="keyword">(</span>ASZ<span class="keyword">,</span> g0i2u<span class="keyword">(</span>i<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">else</span> <span class="keyword">(</span>
  <span class="dynexp"><span class="keyword">$raise</span> ArraySubscriptExn<span class="keyword">(</span><span class="comment">(* i &lt; 0 *)</span><span class="keyword">)</span></span>
<span class="keyword">)</span> <span class="comment">// end of [if]</span>
<span class="keyword">end</span></span> <span class="comment">// end of [arrszref_get_at_gint]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">tk</span><span class="keyword">}</span>
arrszref_get_at_guint
  <span class="keyword">(</span>ASZ<span class="keyword">,</span> i<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="keyword">in</span>
  arrszref_get_at_size <span class="keyword">(</span>ASZ<span class="keyword">,</span> g0u2u<span class="keyword">(</span>i<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [arrszref_get_at_guint]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
arrszref_set_at_size
  <span class="keyword">(</span>ASZ<span class="keyword">,</span> i<span class="keyword">,</span> x<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">$effmask_wrt</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="keyword">var</span> n<span class="keyword">:</span> <span class="staexp">size_t</span>
<span class="dynexp"><span class="keyword">val</span> A <span class="keyword">=</span> arrszref_get_refsize <span class="keyword">(</span>ASZ<span class="keyword">,</span> n<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> i <span class="keyword">=</span> g1ofg0_uint <span class="keyword">(</span>i<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">if</span> n <span class="keyword">&gt;</span> i
<span class="keyword">then</span> arrayref_set_at_guint <span class="keyword">(</span>A<span class="keyword">,</span> i<span class="keyword">,</span> x<span class="keyword">)</span>
<span class="keyword">else</span> <span class="dynexp"><span class="keyword">$raise</span> ArraySubscriptExn<span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [arrszref_set_at_size]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">tk</span><span class="keyword">}</span>
arrszref_set_at_gint
  <span class="keyword">(</span>ASZ<span class="keyword">,</span> i<span class="keyword">,</span> x<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">if</span> <span class="keyword">(</span>
i &gt;= <span class="dynexp">0</span>
<span class="keyword">)</span> <span class="keyword">then</span> <span class="keyword">(</span>
  arrszref_set_at_size <span class="keyword">(</span>ASZ<span class="keyword">,</span> g0i2u<span class="keyword">(</span>i<span class="keyword">)</span><span class="keyword">,</span> x<span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">else</span> <span class="dynexp"><span class="keyword">$raise</span> ArraySubscriptExn<span class="keyword">(</span><span class="comment">(*i &lt; 0*)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [arrszref_set_at_gint]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">tk</span><span class="keyword">}</span>
arrszref_set_at_guint
  <span class="keyword">(</span>ASZ<span class="keyword">,</span> i<span class="keyword">,</span> x<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="keyword">in</span>
  arrszref_set_at_size <span class="keyword">(</span>ASZ<span class="keyword">,</span> g0u2u<span class="keyword">(</span>i<span class="keyword">)</span><span class="keyword">,</span> x<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [arrszref_set_at_guint]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
arrszref_exch_at_size
  <span class="keyword">(</span>ASZ<span class="keyword">,</span> i<span class="keyword">,</span> x<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">$effmask_wrt</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="keyword">var</span> n<span class="keyword">:</span> <span class="staexp">size_t</span>
<span class="dynexp"><span class="keyword">val</span> A <span class="keyword">=</span> arrszref_get_refsize <span class="keyword">(</span>ASZ<span class="keyword">,</span> n<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> i <span class="keyword">=</span> g1ofg0_uint <span class="keyword">(</span>i<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">if</span> n <span class="keyword">&gt;</span> i
<span class="keyword">then</span> arrayref_exch_at_guint <span class="keyword">(</span>A<span class="keyword">,</span> i<span class="keyword">,</span> x<span class="keyword">)</span>
<span class="keyword">else</span> <span class="dynexp"><span class="keyword">$raise</span> ArraySubscriptExn<span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span></span>
<span class="comment">// end of [if]</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [arrszref_exch_at_size]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">tk</span><span class="keyword">}</span>
arrszref_exch_at_gint
  <span class="keyword">(</span>ASZ<span class="keyword">,</span> i<span class="keyword">,</span> x<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">if</span> <span class="keyword">(</span>
i &gt;= <span class="dynexp">0</span>
<span class="keyword">)</span> <span class="keyword">then</span> <span class="keyword">(</span>
  arrszref_exch_at_size <span class="keyword">(</span>ASZ<span class="keyword">,</span> g0i2u<span class="keyword">(</span>i<span class="keyword">)</span><span class="keyword">,</span> x<span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">else</span> <span class="dynexp"><span class="keyword">$raise</span> ArraySubscriptExn<span class="keyword">(</span><span class="comment">(*i &lt; 0*)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [arrszref_exch_at_gint]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">tk</span><span class="keyword">}</span>
arrszref_exch_at_guint
  <span class="keyword">(</span>ASZ<span class="keyword">,</span> i<span class="keyword">,</span> x<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="keyword">in</span>
  arrszref_exch_at_size <span class="keyword">(</span>ASZ<span class="keyword">,</span> g0u2u<span class="keyword">(</span>i<span class="keyword">)</span><span class="keyword">,</span> x<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [arrszref_exch_at_guint]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
arrszref_interchange
<span class="keyword">(</span>
  ASZ<span class="keyword">,</span> i<span class="keyword">,</span> j
<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">$effmask_wrt</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="keyword">var</span> n<span class="keyword">:</span> <span class="staexp">size_t</span>
<span class="dynexp"><span class="keyword">val</span> A <span class="keyword">=</span> arrszref_get_refsize <span class="keyword">(</span>ASZ<span class="keyword">,</span> n<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> i <span class="keyword">=</span> g1ofg0_uint <span class="keyword">(</span>i<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> j <span class="keyword">=</span> g1ofg0_uint <span class="keyword">(</span>j<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">if</span> n <span class="keyword">&gt;</span> i
<span class="keyword">then</span> <span class="keyword">(</span>
  <span class="keyword">if</span> n <span class="keyword">&gt;</span> j
  <span class="keyword">then</span> arrayref_interchange <span class="keyword">(</span>A<span class="keyword">,</span> i<span class="keyword">,</span> j<span class="keyword">)</span>
  <span class="keyword">else</span> <span class="dynexp"><span class="keyword">$raise</span> ArraySubscriptExn<span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span></span>
<span class="keyword">)</span> <span class="keyword">else</span> <span class="dynexp"><span class="keyword">$raise</span> ArraySubscriptExn<span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [arrszref_interchange]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
arrszref_subcirculate
<span class="keyword">(</span>
  ASZ<span class="keyword">,</span> i<span class="keyword">,</span> j
<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">$effmask_wrt</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="keyword">var</span> n<span class="keyword">:</span> <span class="staexp">size_t</span>
<span class="dynexp"><span class="keyword">val</span> A <span class="keyword">=</span> arrszref_get_refsize <span class="keyword">(</span>ASZ<span class="keyword">,</span> n<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> i <span class="keyword">=</span> g1ofg0_uint <span class="keyword">(</span>i<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> j <span class="keyword">=</span> g1ofg0_uint <span class="keyword">(</span>j<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">if</span> n <span class="keyword">&gt;</span> i
<span class="keyword">then</span> <span class="keyword">(</span>
  <span class="keyword">if</span> n <span class="keyword">&gt;</span> j
  <span class="keyword">then</span> arrayref_subcirculate <span class="keyword">(</span>A<span class="keyword">,</span> i<span class="keyword">,</span> j<span class="keyword">)</span>
  <span class="keyword">else</span> <span class="dynexp"><span class="keyword">$raise</span> ArraySubscriptExn<span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span></span>
<span class="keyword">)</span> <span class="keyword">else</span> <span class="dynexp"><span class="keyword">$raise</span> ArraySubscriptExn<span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [arrszref_subcirculate]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
fprint_arrszref
  <span class="keyword">(</span>out<span class="keyword">,</span> ASZ<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="keyword">var</span> asz<span class="keyword">:</span> <span class="staexp">size_t</span>
<span class="dynexp"><span class="keyword">val</span> A <span class="keyword">=</span> arrszref_get_refsize <span class="keyword">(</span>ASZ<span class="keyword">,</span> asz<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  fprint_arrayref <span class="keyword">(</span>out<span class="keyword">,</span> A<span class="keyword">,</span> asz<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [fprint_arrszref]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
fprint_arrszref_sep
  <span class="keyword">(</span>out<span class="keyword">,</span> ASZ<span class="keyword">,</span> sep<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="keyword">var</span> asz<span class="keyword">:</span> <span class="staexp">size_t</span>
<span class="dynexp"><span class="keyword">val</span> A <span class="keyword">=</span> arrszref_get_refsize <span class="keyword">(</span>ASZ<span class="keyword">,</span> asz<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  fprint_arrayref_sep <span class="keyword">(</span>out<span class="keyword">,</span> A<span class="keyword">,</span> asz<span class="keyword">,</span> sep<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [fprint_arrszref_sep]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
arrszref_tabulate <span class="keyword">(</span>asz<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> asz <span class="keyword">=</span> g1ofg0_uint <span class="keyword">(</span>asz<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> A <span class="keyword">=</span> arrayref_tabulate&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>asz<span class="keyword">)</span></span> <span class="keyword">in</span> arrszref_make_arrayref<span class="keyword">(</span>A<span class="keyword">,</span> asz<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [arrszref_tabulate]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
arrszref_tabulate_cloref <span class="keyword">(</span>asz<span class="keyword">,</span> f<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> A <span class="keyword">=</span> arrayref_tabulate_cloref&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>asz<span class="keyword">,</span> f<span class="keyword">)</span></span> <span class="keyword">in</span> arrszref_make_arrayref<span class="keyword">(</span>A<span class="keyword">,</span> asz<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [arrszref_tabulate_cloref]</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* end of [arrayref.dats] *)</span>
</pre>
<pre class="patsyntax">
<span class="comment">(***********************************************************************)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(*                         Applied Type System                         *)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(***********************************************************************)</span>

<span class="comment">(*
** ATS/Postiats - Unleashing the Potential of Types!
** Copyright (C) 2010-2015 Hongwei Xi, ATS Trustful Software, Inc.
** All rights reserved
**
** ATS is free software;  you can  redistribute it and/or modify it under
** the terms of  the GNU GENERAL PUBLIC LICENSE (GPL) as published by the
** Free Software Foundation; either version 3, or (at  your  option)  any
** later version.
**
** ATS is distributed in the hope that it will be useful, but WITHOUT ANY
** WARRANTY; without  even  the  implied  warranty  of MERCHANTABILITY or
** FITNESS FOR A PARTICULAR PURPOSE.  See the  GNU General Public License
** for more details.
**
** You  should  have  received  a  copy of the GNU General Public License
** along  with  ATS;  see the  file COPYING.  If not, please write to the
** Free Software Foundation,  51 Franklin Street, Fifth Floor, Boston, MA
** 02110-1301, USA.
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
** Source:
** $PATSHOME/prelude/DATS/CODEGEN/matrix.atxt
** Time of generation: Sun Oct  2 10:34:00 2016
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* Author: Hongwei Xi *)</span>
<span class="comment">(* Authoremail: hwxi AT cs DOT bu DOT edu *)</span>
<span class="comment">(* Start time: Feburary, 2012 *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">staload</span> UN <span class="keyword">=</span> "prelude/SATS/unsafe.sats"

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span>
matrix_getref_at_int
  <span class="keyword">(</span>M<span class="keyword">,</span> i<span class="keyword">,</span> n<span class="keyword">,</span> j<span class="keyword">)</span> <span class="keyword">=</span>
  $UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>cPtr1<span class="keyword">(</span>a<span class="keyword">)</span><span class="keyword">}</span></span><span class="keyword">(</span>ptr_add&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="dynexp"><span class="keyword">addr@</span></span><span class="keyword">(</span>M<span class="keyword">)</span><span class="keyword">,</span> i*n+j<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">// end of [matrix_getref_at_int]</span>

<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span>
matrix_getref_at_size
  <span class="keyword">(</span>M<span class="keyword">,</span> i<span class="keyword">,</span> n<span class="keyword">,</span> j<span class="keyword">)</span> <span class="keyword">=</span>
  $UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>cPtr1<span class="keyword">(</span>a<span class="keyword">)</span><span class="keyword">}</span></span><span class="keyword">(</span>ptr_add&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="dynexp"><span class="keyword">addr@</span></span><span class="keyword">(</span>M<span class="keyword">)</span><span class="keyword">,</span> i*n+j<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">// end of [matrix_getref_at_size]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span>
matrix_get_at_int
  <span class="keyword">(</span>M<span class="keyword">,</span> i<span class="keyword">,</span> n<span class="keyword">,</span> j<span class="keyword">)</span> <span class="keyword">=</span> $UN<span class="keyword">.</span>cptr_get <span class="keyword">(</span>matrix_getref_at_int <span class="keyword">(</span>M<span class="keyword">,</span> i<span class="keyword">,</span> n<span class="keyword">,</span> j<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">// end of [matrix_get_at_int]</span>

<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span>
matrix_set_at_int
  <span class="keyword">(</span>M<span class="keyword">,</span> i<span class="keyword">,</span> n<span class="keyword">,</span> j<span class="keyword">,</span> x<span class="keyword">)</span> <span class="keyword">=</span> $UN<span class="keyword">.</span>cptr_set <span class="keyword">(</span>matrix_getref_at_int <span class="keyword">(</span>M<span class="keyword">,</span> i<span class="keyword">,</span> n<span class="keyword">,</span> j<span class="keyword">)</span><span class="keyword">,</span> x<span class="keyword">)</span></span>
<span class="comment">// end of [matrix_set_at_int]</span>

<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span>
matrix_exch_at_int
  <span class="keyword">(</span>M<span class="keyword">,</span> i<span class="keyword">,</span> n<span class="keyword">,</span> j<span class="keyword">,</span> x<span class="keyword">)</span> <span class="keyword">=</span> $UN<span class="keyword">.</span>cptr_exch <span class="keyword">(</span>matrix_getref_at_int <span class="keyword">(</span>M<span class="keyword">,</span> i<span class="keyword">,</span> n<span class="keyword">,</span> j<span class="keyword">)</span><span class="keyword">,</span> x<span class="keyword">)</span></span>
<span class="comment">// end of [matrix_exch_at_int]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span>
matrix_get_at_size
  <span class="keyword">(</span>M<span class="keyword">,</span> i<span class="keyword">,</span> n<span class="keyword">,</span> j<span class="keyword">)</span> <span class="keyword">=</span> $UN<span class="keyword">.</span>cptr_get <span class="keyword">(</span>matrix_getref_at_size <span class="keyword">(</span>M<span class="keyword">,</span> i<span class="keyword">,</span> n<span class="keyword">,</span> j<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">// end of [matrix_get_at_size]</span>

<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span>
matrix_set_at_size
  <span class="keyword">(</span>M<span class="keyword">,</span> i<span class="keyword">,</span> n<span class="keyword">,</span> j<span class="keyword">,</span> x<span class="keyword">)</span> <span class="keyword">=</span> $UN<span class="keyword">.</span>cptr_set <span class="keyword">(</span>matrix_getref_at_size <span class="keyword">(</span>M<span class="keyword">,</span> i<span class="keyword">,</span> n<span class="keyword">,</span> j<span class="keyword">)</span><span class="keyword">,</span> x<span class="keyword">)</span></span>
<span class="comment">// end of [matrix_set_at_size]</span>

<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span>
matrix_exch_at_size
  <span class="keyword">(</span>M<span class="keyword">,</span> i<span class="keyword">,</span> n<span class="keyword">,</span> j<span class="keyword">,</span> x<span class="keyword">)</span> <span class="keyword">=</span> $UN<span class="keyword">.</span>cptr_exch <span class="keyword">(</span>matrix_getref_at_size <span class="keyword">(</span>M<span class="keyword">,</span> i<span class="keyword">,</span> n<span class="keyword">,</span> j<span class="keyword">)</span><span class="keyword">,</span> x<span class="keyword">)</span></span>
<span class="comment">// end of [matrix_exch_at_size]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span>
matrix_ptr_alloc
  <span class="keyword">(</span>row<span class="keyword">,</span> col<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span>
<span class="keyword">(</span>
  <span class="prfexp">pfarr</span><span class="keyword">,</span> <span class="prfexp">pfgc</span> <span class="keyword">|</span> p
<span class="keyword">)</span> <span class="keyword">=</span> array_ptr_alloc&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>row*col<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span> pfmat <span class="keyword">=</span> array2matrix_v<span class="keyword">(</span>pfarr<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  <span class="keyword">@(</span><span class="prfexp">pfmat</span><span class="keyword">,</span> <span class="prfexp">pfgc</span> <span class="keyword">|</span> p<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [matrix_ptr_alloc]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span>
matrix_ptr_free
  <span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="keyword">(</span><span class="prfexp">pfmat</span><span class="keyword">,</span> <span class="prfexp">pfgc</span> <span class="keyword">|</span> p<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span>
pfarr <span class="keyword">=</span> matrix2array_v<span class="staexp"><span class="keyword">{</span>a?<span class="keyword">}</span></span><span class="keyword">(</span>pfmat<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  array_ptr_free <span class="keyword">(</span><span class="prfexp">pfarr</span><span class="keyword">,</span> <span class="prfexp">pfgc</span> <span class="keyword">|</span> p<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [matrix_ptr_free]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span>
matrix_ptr_tabulate
  <span class="keyword">(</span>row<span class="keyword">,</span> col<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pf</span><span class="keyword">,</span> <span class="prfexp">pfgc</span> <span class="keyword">|</span> p<span class="keyword">)</span> <span class="keyword">=</span> matrix_ptr_alloc&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>row<span class="keyword">,</span> col<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
matrix_initize$init&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>i<span class="keyword">,</span> j<span class="keyword">,</span> x<span class="keyword">)</span> <span class="keyword">=</span> x := matrix_tabulate$fopr&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>i<span class="keyword">,</span> j<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> matrix_initize&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="keyword">!</span>p<span class="keyword">,</span> row<span class="keyword">,</span> col<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  <span class="keyword">@(</span><span class="prfexp">pf</span><span class="keyword">,</span> <span class="prfexp">pfgc</span> <span class="keyword">|</span> p<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [matrix_ptr_tabulate]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span>
fprint_matrix$sep1 <span class="keyword">(</span>out<span class="keyword">)</span> <span class="keyword">=</span> fprint <span class="keyword">(</span>out<span class="keyword">,</span> <span class="dynstr">", "</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span>
fprint_matrix$sep2 <span class="keyword">(</span>out<span class="keyword">)</span> <span class="keyword">=</span> fprint <span class="keyword">(</span>out<span class="keyword">,</span> <span class="dynstr">"; "</span><span class="keyword">)</span></span>

<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span>
fprint_matrix_int
  <span class="keyword">(</span>out<span class="keyword">,</span> M<span class="keyword">,</span> m<span class="keyword">,</span> n<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> lemma_matrix_param <span class="keyword">(</span>M<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  fprint_matrix_size <span class="keyword">(</span>out<span class="keyword">,</span> M<span class="keyword">,</span> i2sz<span class="keyword">(</span>m<span class="keyword">)</span><span class="keyword">,</span> i2sz<span class="keyword">(</span>n<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [fprint_matrix_int]</span>

<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span>
fprint_matrix_size
  <span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">}</span></span> <span class="keyword">(</span>out<span class="keyword">,</span> M<span class="keyword">,</span> m<span class="keyword">,</span> n<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
fprint_array$sep&lt;<span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">)</span> <span class="keyword">=</span> fprint_matrix$sep1 <span class="keyword">(</span>out<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span> loop <span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span>
<span class="keyword">(</span>
  out<span class="keyword">:</span> <span class="staexp">FILEref</span><span class="keyword">,</span> p0<span class="keyword">:</span> <span class="staexp">ptr</span> <span class="staexp">l</span><span class="keyword">,</span> m<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="staexp">m</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="staexp">n</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">size_t</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">if</span> i <span class="keyword">&lt;</span> m <span class="keyword">then</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span>
  <span class="keyword">(</span>
    <span class="keyword">if</span> i <span class="keyword">&gt;</span> <span class="dynexp">0</span> <span class="keyword">then</span> fprint_matrix$sep2 <span class="keyword">(</span>out<span class="keyword">)</span>
  <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span></span> <span class="comment">// end of [val]</span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span>
    <span class="prfexp">pf</span><span class="keyword">,</span> <span class="prfexp">fpf</span> <span class="keyword">|</span> p0
  <span class="keyword">)</span> <span class="keyword">=</span> $UN<span class="keyword">.</span>ptr_vtake<span class="staexp"><span class="keyword">{</span>array<span class="keyword">(</span>a<span class="keyword">,</span>n<span class="keyword">)</span><span class="keyword">}</span></span><span class="keyword">(</span>p0<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fprint_array <span class="keyword">(</span>out<span class="keyword">,</span> <span class="keyword">!</span>p0<span class="keyword">,</span> n<span class="keyword">)</span></span>
  <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fpf <span class="keyword">(</span>pf<span class="keyword">)</span></span>
<span class="keyword">in</span>
  loop <span class="keyword">(</span>out<span class="keyword">,</span> ptr_add&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>p0<span class="keyword">,</span> n<span class="keyword">)</span><span class="keyword">,</span> m<span class="keyword">,</span> n<span class="keyword">,</span> succ<span class="keyword">(</span>i<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="comment">// end of [if]</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [loop]</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  loop <span class="keyword">(</span>out<span class="keyword">,</span> <span class="dynexp"><span class="keyword">addr@</span></span> <span class="keyword">(</span>M<span class="keyword">)</span><span class="keyword">,</span> m<span class="keyword">,</span> n<span class="keyword">,</span> i2sz<span class="keyword">(</span><span class="dynexp">0</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [fprint_matrix_size]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span>
fprint_matrix_sep
<span class="keyword">(</span>
  out<span class="keyword">,</span> M<span class="keyword">,</span> m<span class="keyword">,</span> n<span class="keyword">,</span> sep1<span class="keyword">,</span> sep2
<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
fprint_matrix$sep1&lt;<span class="keyword">&gt;</span>
  <span class="keyword">(</span>out<span class="keyword">)</span> <span class="keyword">=</span> fprint <span class="keyword">(</span>out<span class="keyword">,</span> sep1<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">implement</span>
fprint_matrix$sep2&lt;<span class="keyword">&gt;</span>
  <span class="keyword">(</span>out<span class="keyword">)</span> <span class="keyword">=</span> fprint <span class="keyword">(</span>out<span class="keyword">,</span> sep2<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  fprint_matrix_size <span class="keyword">(</span>out<span class="keyword">,</span> M<span class="keyword">,</span> m<span class="keyword">,</span> n<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [fprint_matrix_sep]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
matrix_foreach$rowsep<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span>
matrix_foreach
  <span class="keyword">(</span>A<span class="keyword">,</span> m<span class="keyword">,</span> n<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="keyword">var</span> env<span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">)</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  matrix_foreach_env&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">void</span><span class="keyword">&gt;</span> <span class="keyword">(</span>A<span class="keyword">,</span> m<span class="keyword">,</span> n<span class="keyword">,</span> env<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [matrix_foreach]</span>
<span class="comment">//</span>
<span class="comment">(*
implement
{a}{env}
matrix_foreach_env
  (A, m, n, env) = let
//
implement
array_foreach$cont&lt;a&gt;&lt;env&gt;
  (x, env) = true
implement
array_foreach$fwork&lt;a&gt;&lt;env&gt;
  (x, env) =
  matrix_foreach$fwork&lt;a&gt;&lt;env&gt; (x, env)
//
val p = addr@(A)
prval pf = matrix2array_v{a}(view@(A))
//
val _(*mn*) = array_foreach_env&lt;a&gt; (!p, m*n, env)
prval ((*void*)) = view@(A) := array2matrix_v{a}(pf)
//
in
  // nothing
end // end of [matrix_foreach_env]
*)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">env</span><span class="keyword">}</span>
matrix_foreach_env
  <span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">}</span></span><span class="keyword">(</span>M<span class="keyword">,</span> m<span class="keyword">,</span> n<span class="keyword">,</span> env<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> lemma_matrix_param<span class="keyword">(</span>M<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fnx</span>
loop1
<span class="keyword">(</span>
  p<span class="keyword">:</span> <span class="staexp">ptr</span>
<span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">sizeLte</span><span class="keyword">(</span><span class="staexp">m</span><span class="keyword">)</span><span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">env</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">(</span>
<span class="comment">//</span>
<span class="keyword">if</span>
i <span class="keyword">&lt;</span> m
<span class="keyword">then</span> loop2<span class="keyword">(</span>p<span class="keyword">,</span> i<span class="keyword">,</span> i2sz<span class="keyword">(</span><span class="dynexp">0</span><span class="keyword">)</span><span class="keyword">,</span> env<span class="keyword">)</span> <span class="keyword">where</span>
<span class="keyword">{</span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span>
    <span class="keyword">if</span> i <span class="keyword">&gt;</span> <span class="dynexp">0</span> <span class="keyword">then</span> matrix_foreach$rowsep<span class="keyword">(</span><span class="keyword">)</span></span>
  <span class="comment">// end of [val]</span>
<span class="keyword">}</span>
<span class="comment">//</span>
<span class="keyword">)</span> <span class="comment">(* end of [loop1] *)</span>
<span class="comment">//</span>
<span class="keyword">and</span>
loop2
<span class="keyword">(</span>
  p<span class="keyword">:</span> <span class="staexp">ptr</span>
<span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">sizeLt</span><span class="keyword">(</span><span class="staexp">m</span><span class="keyword">)</span><span class="keyword">,</span> j<span class="keyword">:</span> <span class="staexp">sizeLte</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span><span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">env</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">(</span>
<span class="comment">//</span>
<span class="keyword">if</span>
j <span class="keyword">&lt;</span> n
<span class="keyword">then</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span>
<span class="keyword">(</span><span class="prfexp">pf</span><span class="keyword">,</span> <span class="prfexp">fpf</span> <span class="keyword">|</span> p<span class="keyword">)</span> <span class="keyword">=</span>
$UN<span class="keyword">.</span>ptr_vtake<span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="keyword">(</span>p<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span> <span class="keyword">=</span>
  matrix_foreach$fwork&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">env</span><span class="keyword">&gt;</span><span class="keyword">(</span><span class="keyword">!</span>p<span class="keyword">,</span> env<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span> <span class="keyword">=</span> fpf<span class="keyword">(</span>pf<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  loop2<span class="keyword">(</span>ptr_succ&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>p<span class="keyword">)</span><span class="keyword">,</span> i<span class="keyword">,</span> succ<span class="keyword">(</span>j<span class="keyword">)</span><span class="keyword">,</span> env<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [then]</span>
<span class="keyword">else</span> loop1<span class="keyword">(</span>p<span class="keyword">,</span> succ<span class="keyword">(</span>i<span class="keyword">)</span><span class="keyword">,</span> env<span class="keyword">)</span> <span class="comment">// end of [else]</span>
<span class="comment">//</span>
<span class="keyword">)</span></span> <span class="comment">(* end of [loop2] *)</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  loop1<span class="keyword">(</span><span class="dynexp"><span class="keyword">addr@</span></span>M<span class="keyword">,</span> i2sz<span class="keyword">(</span><span class="dynexp">0</span><span class="keyword">)</span><span class="keyword">,</span> env<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [matrix_foreach_env]</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span>
matrix_foreachrow
  <span class="keyword">(</span>A<span class="keyword">,</span> m<span class="keyword">,</span> n<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="keyword">var</span> env<span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">)</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  matrix_foreachrow_env&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">void</span><span class="keyword">&gt;</span> <span class="keyword">(</span>A<span class="keyword">,</span> m<span class="keyword">,</span> n<span class="keyword">,</span> env<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [matrix_foreachrow]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">env</span><span class="keyword">}</span>
matrix_foreachrow_env
  <span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">}</span></span><span class="keyword">(</span>M<span class="keyword">,</span> m<span class="keyword">,</span> n<span class="keyword">,</span> env<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> lemma_matrix_param<span class="keyword">(</span>M<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
loop
<span class="keyword">(</span>
  p<span class="keyword">:</span> <span class="staexp">ptr</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">sizeLte</span><span class="keyword">(</span><span class="staexp">m</span><span class="keyword">)</span><span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">env</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">_</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">(</span>
<span class="comment">//</span>
<span class="keyword">if</span>
i <span class="keyword">&lt;</span> m
<span class="keyword">then</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span>
<span class="keyword">(</span><span class="prfexp">pf</span><span class="keyword">,</span> <span class="prfexp">fpf</span> <span class="keyword">|</span> p<span class="keyword">)</span> <span class="keyword">=</span>
$UN<span class="keyword">.</span>ptr_vtake<span class="staexp"><span class="keyword">{</span><span class="keyword">@[</span>a<span class="keyword">]</span><span class="keyword">[</span>n<span class="keyword">]</span><span class="keyword">}</span></span><span class="keyword">(</span>p<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span>
  matrix_foreachrow$fwork&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">env</span><span class="keyword">&gt;</span><span class="keyword">(</span><span class="keyword">!</span>p<span class="keyword">,</span> n<span class="keyword">,</span> env<span class="keyword">)</span></span>
<span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span> <span class="keyword">=</span> fpf<span class="keyword">(</span>pf<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  loop<span class="keyword">(</span>ptr_add&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>p<span class="keyword">,</span> n<span class="keyword">)</span><span class="keyword">,</span> succ<span class="keyword">(</span>i<span class="keyword">)</span><span class="keyword">,</span> env<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [then]</span>
<span class="keyword">else</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="comment">// end of [else]</span>
<span class="comment">//</span>
<span class="keyword">)</span></span> <span class="comment">(* end of [loop] *)</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  loop<span class="keyword">(</span><span class="dynexp"><span class="keyword">addr@</span></span>M<span class="keyword">,</span> i2sz<span class="keyword">(</span><span class="dynexp">0</span><span class="keyword">)</span><span class="keyword">,</span> env<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [matrix_foreachrow_env]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span>
matrix_initize
  <span class="keyword">(</span>M<span class="keyword">,</span> m<span class="keyword">,</span> n<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="neuexp"><span class="keyword">infixl</span> <span class="keyword">(</span>/<span class="keyword">)</span> %</span>
<span class="neuexp"><span class="keyword">#define</span> % g0uint_mod</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
array_initize$init&lt;<span class="staexp">a</span><span class="keyword">&gt;</span>
  <span class="keyword">(</span>ij<span class="keyword">,</span> x<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="keyword">in</span>
  matrix_initize$init&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>ij/n<span class="keyword">,</span> ij%n<span class="keyword">,</span> x<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [array_initize$init]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> p <span class="keyword">=</span> <span class="dynexp"><span class="keyword">addr@</span></span><span class="keyword">(</span>M<span class="keyword">)</span></span>
<span class="prfexp"><span class="keyword">prval</span> pf <span class="keyword">=</span> matrix2array_v<span class="staexp"><span class="keyword">{</span>a?<span class="keyword">}</span></span><span class="keyword">(</span><span class="dynexp"><span class="keyword">view@</span></span><span class="keyword">(</span>M<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> array_initize&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="keyword">!</span>p<span class="keyword">,</span> m * n<span class="keyword">)</span></span>
<span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="dynexp"><span class="keyword">view@</span></span><span class="keyword">(</span>M<span class="keyword">)</span> := array2matrix_v<span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="keyword">(</span>pf<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">in</span>
  <span class="comment">// nothing</span>
<span class="keyword">end</span></span></span> <span class="comment">// end of [matrix_initize]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span>
matrix_uninitize
  <span class="keyword">(</span>M<span class="keyword">,</span> m<span class="keyword">,</span> n<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="neuexp"><span class="keyword">infixl</span> <span class="keyword">(</span>/<span class="keyword">)</span> %</span>
<span class="neuexp"><span class="keyword">#define</span> % g0uint_mod</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
array_uninitize$clear&lt;<span class="staexp">a</span><span class="keyword">&gt;</span>
  <span class="keyword">(</span>ij<span class="keyword">,</span> x<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="keyword">in</span>
  matrix_uninitize$clear&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>ij/n<span class="keyword">,</span> ij%n<span class="keyword">,</span> x<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [array_uninitize$clear]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> p <span class="keyword">=</span> <span class="dynexp"><span class="keyword">addr@</span></span><span class="keyword">(</span>M<span class="keyword">)</span></span>
<span class="prfexp"><span class="keyword">prval</span> pf <span class="keyword">=</span> matrix2array_v<span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="keyword">(</span><span class="dynexp"><span class="keyword">view@</span></span><span class="keyword">(</span>M<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> array_uninitize&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="keyword">!</span>p<span class="keyword">,</span> m * n<span class="keyword">)</span></span>
<span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="dynexp"><span class="keyword">view@</span></span><span class="keyword">(</span>M<span class="keyword">)</span> := array2matrix_v<span class="staexp"><span class="keyword">{</span>a?<span class="keyword">}</span></span><span class="keyword">(</span>pf<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">in</span>
  <span class="comment">// nothing</span>
<span class="keyword">end</span></span></span> <span class="comment">// end of [matrix_uninitize]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">b</span><span class="keyword">}</span>
matrix_mapto
  <span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">}</span></span> <span class="keyword">(</span>A<span class="keyword">,</span> B<span class="keyword">,</span> m<span class="keyword">,</span> n<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> pA <span class="keyword">=</span> <span class="dynexp"><span class="keyword">addr@</span></span><span class="keyword">(</span>A<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> pB <span class="keyword">=</span> <span class="dynexp"><span class="keyword">addr@</span></span><span class="keyword">(</span>B<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span> pfA <span class="keyword">=</span> matrix2array_v<span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="keyword">(</span><span class="dynexp"><span class="keyword">view@</span></span><span class="keyword">(</span>A<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="prfexp"><span class="keyword">prval</span> pfB <span class="keyword">=</span> matrix2array_v<span class="staexp"><span class="keyword">{</span>b?<span class="keyword">}</span></span><span class="keyword">(</span><span class="dynexp"><span class="keyword">view@</span></span><span class="keyword">(</span>B<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">local</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
array_mapto$fwork&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">b</span><span class="keyword">&gt;</span>
  <span class="keyword">(</span>x<span class="keyword">,</span> y<span class="keyword">)</span> <span class="keyword">=</span> matrix_mapto$fwork&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">b</span><span class="keyword">&gt;</span> <span class="keyword">(</span>x<span class="keyword">,</span> y<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span> <span class="comment">(* in of [local] *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span> <span class="keyword">=</span> array_mapto&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">b</span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="keyword">!</span>pA<span class="keyword">,</span> <span class="keyword">!</span>pB<span class="keyword">,</span> m*n<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">end</span> <span class="comment">// end of [local]</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="dynexp"><span class="keyword">view@</span></span><span class="keyword">(</span>A<span class="keyword">)</span> := array2matrix_v <span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span><span class="keyword">..</span><span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">}</span></span> <span class="keyword">(</span>pfA<span class="keyword">)</span></span>
<span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="dynexp"><span class="keyword">view@</span></span><span class="keyword">(</span>B<span class="keyword">)</span> := array2matrix_v <span class="staexp"><span class="keyword">{</span>b<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span><span class="keyword">..</span><span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">}</span></span> <span class="keyword">(</span>pfB<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">in</span>
  <span class="comment">// nothing</span>
<span class="keyword">end</span></span></span> <span class="comment">(* end of [matrix_mapto] *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a<span class="keyword">,</span>b</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">c</span><span class="keyword">}</span>
matrix_map2to
  <span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">}</span></span> <span class="keyword">(</span>A<span class="keyword">,</span> B<span class="keyword">,</span> C<span class="keyword">,</span> m<span class="keyword">,</span> n<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> pA <span class="keyword">=</span> <span class="dynexp"><span class="keyword">addr@</span></span><span class="keyword">(</span>A<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> pB <span class="keyword">=</span> <span class="dynexp"><span class="keyword">addr@</span></span><span class="keyword">(</span>B<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> pC <span class="keyword">=</span> <span class="dynexp"><span class="keyword">addr@</span></span><span class="keyword">(</span>C<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span> pfA <span class="keyword">=</span> matrix2array_v<span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="keyword">(</span><span class="dynexp"><span class="keyword">view@</span></span><span class="keyword">(</span>A<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="prfexp"><span class="keyword">prval</span> pfB <span class="keyword">=</span> matrix2array_v<span class="staexp"><span class="keyword">{</span>b<span class="keyword">}</span></span><span class="keyword">(</span><span class="dynexp"><span class="keyword">view@</span></span><span class="keyword">(</span>B<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="prfexp"><span class="keyword">prval</span> pfC <span class="keyword">=</span> matrix2array_v<span class="staexp"><span class="keyword">{</span>c?<span class="keyword">}</span></span><span class="keyword">(</span><span class="dynexp"><span class="keyword">view@</span></span><span class="keyword">(</span>C<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">local</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
array_map2to$fwork&lt;<span class="staexp">a</span><span class="keyword">,</span><span class="staexp">b</span><span class="keyword">&gt;&lt;</span><span class="staexp">c</span><span class="keyword">&gt;</span>
  <span class="keyword">(</span>x<span class="keyword">,</span> y<span class="keyword">,</span> z<span class="keyword">)</span> <span class="keyword">=</span> matrix_map2to$fwork&lt;<span class="staexp">a</span><span class="keyword">,</span><span class="staexp">b</span><span class="keyword">&gt;&lt;</span><span class="staexp">c</span><span class="keyword">&gt;</span> <span class="keyword">(</span>x<span class="keyword">,</span> y<span class="keyword">,</span> z<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span> <span class="comment">(* in of [local] *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span> <span class="keyword">=</span> array_map2to&lt;<span class="staexp">a</span><span class="keyword">,</span><span class="staexp">b</span><span class="keyword">&gt;&lt;</span><span class="staexp">c</span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="keyword">!</span>pA<span class="keyword">,</span> <span class="keyword">!</span>pB<span class="keyword">,</span> <span class="keyword">!</span>pC<span class="keyword">,</span> m*n<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">end</span> <span class="comment">// end of [local]</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="dynexp"><span class="keyword">view@</span></span><span class="keyword">(</span>A<span class="keyword">)</span> := array2matrix_v <span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span><span class="keyword">..</span><span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">}</span></span> <span class="keyword">(</span>pfA<span class="keyword">)</span></span>
<span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="dynexp"><span class="keyword">view@</span></span><span class="keyword">(</span>B<span class="keyword">)</span> := array2matrix_v <span class="staexp"><span class="keyword">{</span>b<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span><span class="keyword">..</span><span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">}</span></span> <span class="keyword">(</span>pfB<span class="keyword">)</span></span>
<span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="dynexp"><span class="keyword">view@</span></span><span class="keyword">(</span>C<span class="keyword">)</span> := array2matrix_v <span class="staexp"><span class="keyword">{</span>c<span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span><span class="keyword">..</span><span class="keyword">}</span></span><span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">}</span></span> <span class="keyword">(</span>pfC<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">in</span>
  <span class="comment">// nothing</span>
<span class="keyword">end</span></span></span> <span class="comment">(* end of [matrix_map2to] *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* end of [matrix.dats] *)</span>
</pre>
<pre class="patsyntax">
<span class="comment">(***********************************************************************)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(*                         Applied Type System                         *)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(***********************************************************************)</span>

<span class="comment">(*
** ATS/Postiats - Unleashing the Potential of Types!
** Copyright (C) 2010-2015 Hongwei Xi, ATS Trustful Software, Inc.
** All rights reserved
**
** ATS is free software;  you can  redistribute it and/or modify it under
** the terms of  the GNU GENERAL PUBLIC LICENSE (GPL) as published by the
** Free Software Foundation; either version 3, or (at  your  option)  any
** later version.
**
** ATS is distributed in the hope that it will be useful, but WITHOUT ANY
** WARRANTY; without  even  the  implied  warranty  of MERCHANTABILITY or
** FITNESS FOR A PARTICULAR PURPOSE.  See the  GNU General Public License
** for more details.
**
** You  should  have  received  a  copy of the GNU General Public License
** along  with  ATS;  see the  file COPYING.  If not, please write to the
** Free Software Foundation,  51 Franklin Street, Fifth Floor, Boston, MA
** 02110-1301, USA.
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
** Source:
** $PATSHOME/prelude/DATS/CODEGEN/matrixptr.atxt
** Time of generation: Sun Oct  2 10:34:00 2016
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* Author: Hongwei Xi *)</span>
<span class="comment">(* Authoremail: hwxi AT cs DOT bu DOT edu *)</span>
<span class="comment">(* Start time: Feburary, 2012 *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">staload</span> UN <span class="keyword">=</span> "prelude/SATS/unsafe.sats"

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span>
arrayptr2matrixptr_int<span class="keyword">(</span>A<span class="keyword">,</span> m<span class="keyword">,</span> n<span class="keyword">)</span> <span class="keyword">=</span> $UN<span class="keyword">.</span>castvwtp0<span class="keyword">(</span>A<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span>
arrayptr2matrixptr_size<span class="keyword">(</span>A<span class="keyword">,</span> m<span class="keyword">,</span> n<span class="keyword">)</span> <span class="keyword">=</span> $UN<span class="keyword">.</span>castvwtp0<span class="keyword">(</span>A<span class="keyword">)</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span>
matrixptr_make_elt
  <span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span> n<span class="keyword">}</span></span> <span class="keyword">(</span>m<span class="keyword">,</span> n<span class="keyword">,</span> x0<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> mn <span class="keyword">=</span> $UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>Size<span class="keyword">}</span></span><span class="keyword">(</span>m * n<span class="keyword">)</span></span>
<span class="keyword">in</span>
  $UN<span class="keyword">.</span>castvwtp0<span class="staexp"><span class="keyword">{</span>matrixptr<span class="keyword">(</span>a<span class="keyword">,</span>m<span class="keyword">,</span>n<span class="keyword">)</span><span class="keyword">}</span></span><span class="keyword">(</span>arrayptr_make_elt&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>mn<span class="keyword">,</span> x0<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [matrixptr_make_elt]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span>
matrixptr_get_at_int
  <span class="keyword">(</span>M<span class="keyword">,</span> i<span class="keyword">,</span> n<span class="keyword">,</span> j<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> ij <span class="keyword">=</span> $UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>Size<span class="keyword">}</span></span><span class="keyword">(</span>i * n + j<span class="keyword">)</span></span>
<span class="keyword">in</span>
  $UN<span class="keyword">.</span>ptr0_get&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>ptr_add&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>ptrcast<span class="keyword">(</span>M<span class="keyword">)</span><span class="keyword">,</span> ij<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [matrixptr_get_at_int]</span>

<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span>
matrixptr_get_at_size
  <span class="keyword">(</span>M<span class="keyword">,</span> i<span class="keyword">,</span> n<span class="keyword">,</span> j<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> ij <span class="keyword">=</span> $UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>Size<span class="keyword">}</span></span><span class="keyword">(</span>i * n + j<span class="keyword">)</span></span>
<span class="keyword">in</span>
  $UN<span class="keyword">.</span>ptr0_get&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>ptr_add&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>ptrcast<span class="keyword">(</span>M<span class="keyword">)</span><span class="keyword">,</span> ij<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [matrixptr_get_at_size]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span>
matrixptr_set_at_int
  <span class="keyword">(</span>M<span class="keyword">,</span> i<span class="keyword">,</span> n<span class="keyword">,</span> j<span class="keyword">,</span> x<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> ij <span class="keyword">=</span> $UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>Size<span class="keyword">}</span></span><span class="keyword">(</span>i * n + j<span class="keyword">)</span></span>
<span class="keyword">in</span>
  $UN<span class="keyword">.</span>ptr0_set&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>ptr_add&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>ptrcast<span class="keyword">(</span>M<span class="keyword">)</span><span class="keyword">,</span> ij<span class="keyword">)</span><span class="keyword">,</span> x<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [matrixptr_set_at_int]</span>

<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span>
matrixptr_set_at_size
  <span class="keyword">(</span>M<span class="keyword">,</span> i<span class="keyword">,</span> n<span class="keyword">,</span> j<span class="keyword">,</span> x<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> ij <span class="keyword">=</span> $UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>Size<span class="keyword">}</span></span><span class="keyword">(</span>i * n + j<span class="keyword">)</span></span>
<span class="keyword">in</span>
  $UN<span class="keyword">.</span>ptr0_set&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>ptr_add&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>ptrcast<span class="keyword">(</span>M<span class="keyword">)</span><span class="keyword">,</span> ij<span class="keyword">)</span><span class="keyword">,</span> x<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [matrixptr_set_at_size]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span>
matrixptr_exch_at_int
  <span class="keyword">(</span>M<span class="keyword">,</span> i<span class="keyword">,</span> n<span class="keyword">,</span> j<span class="keyword">,</span> x<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> ij <span class="keyword">=</span> $UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>Size<span class="keyword">}</span></span><span class="keyword">(</span>i * n + j<span class="keyword">)</span></span>
<span class="keyword">in</span>
  $UN<span class="keyword">.</span>ptr0_exch&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>ptr_add&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>ptrcast<span class="keyword">(</span>M<span class="keyword">)</span><span class="keyword">,</span> ij<span class="keyword">)</span><span class="keyword">,</span> x<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [matrixptr_exch_at_int]</span>

<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span>
matrixptr_exch_at_size
  <span class="keyword">(</span>M<span class="keyword">,</span> i<span class="keyword">,</span> n<span class="keyword">,</span> j<span class="keyword">,</span> x<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> ij <span class="keyword">=</span> $UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>Size<span class="keyword">}</span></span><span class="keyword">(</span>i * n + j<span class="keyword">)</span></span>
<span class="keyword">in</span>
  $UN<span class="keyword">.</span>ptr0_exch&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>ptr_add&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>ptrcast<span class="keyword">(</span>M<span class="keyword">)</span><span class="keyword">,</span> ij<span class="keyword">)</span><span class="keyword">,</span> x<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [matrixptr_exch_at_size]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span>
fprint_matrixptr
  <span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">}</span></span> <span class="keyword">(</span>out<span class="keyword">,</span> M<span class="keyword">,</span> m<span class="keyword">,</span> n<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> p0 <span class="keyword">=</span> ptrcast <span class="keyword">(</span>M<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span>
  <span class="prfexp">pf</span><span class="keyword">,</span> <span class="prfexp">fpf</span> <span class="keyword">|</span> p0
<span class="keyword">)</span> <span class="keyword">=</span> $UN<span class="keyword">.</span>ptr_vtake <span class="staexp"><span class="keyword">{</span>matrix<span class="keyword">(</span>a<span class="keyword">,</span>m<span class="keyword">,</span>n<span class="keyword">)</span><span class="keyword">}</span></span> <span class="keyword">(</span>p0<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fprint_matrix&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">,</span> <span class="keyword">!</span>p0<span class="keyword">,</span> m<span class="keyword">,</span> n<span class="keyword">)</span></span>
<span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fpf <span class="keyword">(</span>pf<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">in</span>
  <span class="comment">// nothing</span>
<span class="keyword">end</span></span></span> <span class="comment">// end of [fprint_matrixptr]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span>
fprint_matrixptr_sep
<span class="keyword">(</span>
  out<span class="keyword">,</span> M<span class="keyword">,</span> m<span class="keyword">,</span> n<span class="keyword">,</span> sep1<span class="keyword">,</span> sep2
<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
fprint_matrix$sep1&lt;<span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">)</span> <span class="keyword">=</span> fprint_string <span class="keyword">(</span>out<span class="keyword">,</span> sep1<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">implement</span>
fprint_matrix$sep2&lt;<span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">)</span> <span class="keyword">=</span> fprint_string <span class="keyword">(</span>out<span class="keyword">,</span> sep2<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  fprint_matrixptr&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">,</span> M<span class="keyword">,</span> m<span class="keyword">,</span> n<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [fprint_matrixptr_sep]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
implement matrixptr_free = ATS_MFREE
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span>
matrixptr_foreach
  <span class="keyword">(</span>M<span class="keyword">,</span> m<span class="keyword">,</span> n<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">var</span> env<span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">in</span>
  matrixptr_foreach_env&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">void</span><span class="keyword">&gt;</span> <span class="keyword">(</span>M<span class="keyword">,</span> m<span class="keyword">,</span> n<span class="keyword">,</span> env<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [matrixptr_foreach]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">env</span><span class="keyword">}</span>
matrixptr_foreach_env
  <span class="keyword">(</span>M<span class="keyword">,</span> m<span class="keyword">,</span> n<span class="keyword">,</span> env<span class="keyword">)</span> <span class="keyword">=</span> res <span class="keyword">where</span>
<span class="keyword">{</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> p <span class="keyword">=</span> ptrcast<span class="keyword">(</span>M<span class="keyword">)</span></span>
<span class="prfexp"><span class="keyword">prval</span> pfarr <span class="keyword">=</span> matrixptr_takeout<span class="keyword">(</span>M<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> res <span class="keyword">=</span> matrix_foreach_env&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">env</span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="keyword">!</span>p<span class="keyword">,</span> m<span class="keyword">,</span> n<span class="keyword">,</span> env<span class="keyword">)</span></span>
<span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> matrixptr_addback<span class="keyword">(</span><span class="prfexp">pfarr</span> <span class="keyword">|</span> M<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">}</span></span> <span class="comment">(* end of [matrixptr_foreach_env] *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
matrixptr_initize
  <span class="keyword">(</span>M<span class="keyword">,</span> m<span class="keyword">,</span> n<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">where</span>
<span class="keyword">{</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> p <span class="keyword">=</span> ptrcast<span class="keyword">(</span>M<span class="keyword">)</span></span>
<span class="prfexp"><span class="keyword">prval</span> pfarr <span class="keyword">=</span> matrixptr_takeout<span class="keyword">(</span>M<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> matrix_initize&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span><span class="keyword">!</span>p<span class="keyword">,</span> m<span class="keyword">,</span> n<span class="keyword">)</span></span>
<span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> matrixptr_addback<span class="keyword">(</span><span class="prfexp">pfarr</span> <span class="keyword">|</span> M<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">}</span></span> <span class="comment">(* end of [matrixptr_initize] *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
matrixptr_uninitize
  <span class="keyword">(</span>M<span class="keyword">,</span> m<span class="keyword">,</span> n<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">where</span>
<span class="keyword">{</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> p <span class="keyword">=</span> ptrcast<span class="keyword">(</span>M<span class="keyword">)</span></span>
<span class="prfexp"><span class="keyword">prval</span> pfarr <span class="keyword">=</span> matrixptr_takeout<span class="keyword">(</span>M<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> matrix_uninitize&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span><span class="keyword">!</span>p<span class="keyword">,</span> m<span class="keyword">,</span> n<span class="keyword">)</span></span>
<span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> matrixptr_addback<span class="keyword">(</span><span class="prfexp">pfarr</span> <span class="keyword">|</span> M<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">}</span></span> <span class="comment">(* end of [matrixptr_uninitize] *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
matrixptr_freelin
  <span class="keyword">(</span>M<span class="keyword">,</span> m<span class="keyword">,</span> n<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span>
matrixptr_uninitize&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>M<span class="keyword">,</span> m<span class="keyword">,</span> n<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  matrixptr_free<span class="staexp"><span class="keyword">{</span>a?<span class="keyword">}</span></span><span class="keyword">(</span>M<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [matrixptr_freelin]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span>
matrixptr_tabulate
  <span class="keyword">(</span>nrow<span class="keyword">,</span> ncol<span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
  matrixptr_encode2<span class="keyword">(</span>matrix_ptr_tabulate&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>nrow<span class="keyword">,</span> ncol<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">)</span></span> <span class="comment">(* end of [matrixptr_tabulate] *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span>
matrixptr_tabulate_cloref
  <span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">}</span></span> <span class="keyword">(</span>nrow<span class="keyword">,</span> ncol<span class="keyword">,</span> f<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span><span class="keyword">(</span><span class="staexp">a2</span><span class="keyword">)</span>
matrix_tabulate$fopr&lt;<span class="staexp">a2</span><span class="keyword">&gt;</span> <span class="keyword">(</span>i<span class="keyword">,</span> j<span class="keyword">)</span> <span class="keyword">=</span>
  $UN<span class="keyword">.</span>castvwtp0<span class="staexp"><span class="keyword">{</span>a2<span class="keyword">}</span></span><span class="keyword">(</span>f<span class="keyword">(</span>$UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>sizeLt<span class="keyword">(</span>m<span class="keyword">)</span><span class="keyword">}</span></span><span class="keyword">(</span>i<span class="keyword">)</span><span class="keyword">,</span> $UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>sizeLt<span class="keyword">(</span>n<span class="keyword">)</span><span class="keyword">}</span></span><span class="keyword">(</span>j<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  matrixptr_tabulate&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>nrow<span class="keyword">,</span> ncol<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [matrixptr_tabulate_cloref]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* end of [matrixptr.dats] *)</span>
</pre>
<pre class="patsyntax">
<span class="comment">(***********************************************************************)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(*                         Applied Type System                         *)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(***********************************************************************)</span>

<span class="comment">(*
** ATS/Postiats - Unleashing the Potential of Types!
** Copyright (C) 2010-2015 Hongwei Xi, ATS Trustful Software, Inc.
** All rights reserved
**
** ATS is free software;  you can  redistribute it and/or modify it under
** the terms of  the GNU GENERAL PUBLIC LICENSE (GPL) as published by the
** Free Software Foundation; either version 3, or (at  your  option)  any
** later version.
**
** ATS is distributed in the hope that it will be useful, but WITHOUT ANY
** WARRANTY; without  even  the  implied  warranty  of MERCHANTABILITY or
** FITNESS FOR A PARTICULAR PURPOSE.  See the  GNU General Public License
** for more details.
**
** You  should  have  received  a  copy of the GNU General Public License
** along  with  ATS;  see the  file COPYING.  If not, please write to the
** Free Software Foundation,  51 Franklin Street, Fifth Floor, Boston, MA
** 02110-1301, USA.
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
** Source:
** $PATSHOME/prelude/DATS/CODEGEN/matrixref.atxt
** Time of generation: Sun Oct  2 10:34:00 2016
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* Author: Hongwei Xi *)</span>
<span class="comment">(* Authoremail: hwxi AT cs DOT bu DOT edu *)</span>
<span class="comment">(* Start time: Feburary, 2012 *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">staload</span> UN <span class="keyword">=</span> "prelude/SATS/unsafe.sats"

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span>
matrixref_make_elt
  <span class="keyword">(</span>nrow<span class="keyword">,</span> ncol<span class="keyword">,</span> x<span class="keyword">)</span> <span class="keyword">=</span>
  matrixptr_refize<span class="keyword">(</span>matrixptr_make_elt&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>nrow<span class="keyword">,</span> ncol<span class="keyword">,</span> x<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">// end of [matrixref_make_elt]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span>
matrixref_get_at_size
  <span class="keyword">(</span>A<span class="keyword">,</span> i<span class="keyword">,</span> n<span class="keyword">,</span> j<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span>
<span class="keyword">(</span>
<span class="prfexp">vbox pf</span> <span class="keyword">|</span> p
<span class="keyword">)</span> <span class="keyword">=</span> matrixref_get_viewptr <span class="keyword">(</span>A<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  matrix_get_at_size <span class="keyword">(</span><span class="keyword">!</span>p<span class="keyword">,</span> i<span class="keyword">,</span> n<span class="keyword">,</span> j<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [matrixref_get_at_size]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
matrixref_get_at_int
  <span class="keyword">(</span>M<span class="keyword">,</span> i<span class="keyword">,</span> n<span class="keyword">,</span> j<span class="keyword">)</span> <span class="keyword">=</span>
  matrixref_get_at_size <span class="keyword">(</span>M<span class="keyword">,</span> i2sz<span class="keyword">(</span>i<span class="keyword">)</span><span class="keyword">,</span> i2sz<span class="keyword">(</span>n<span class="keyword">)</span><span class="keyword">,</span> i2sz<span class="keyword">(</span>j<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span>
matrixref_set_at_size
  <span class="keyword">(</span>A<span class="keyword">,</span> i<span class="keyword">,</span> n<span class="keyword">,</span> j<span class="keyword">,</span> x<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span>
<span class="keyword">(</span>
<span class="prfexp">vbox pf</span> <span class="keyword">|</span> p
<span class="keyword">)</span> <span class="keyword">=</span> matrixref_get_viewptr <span class="keyword">(</span>A<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  matrix_set_at_size <span class="keyword">(</span><span class="keyword">!</span>p<span class="keyword">,</span> i<span class="keyword">,</span> n<span class="keyword">,</span> j<span class="keyword">,</span> x<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [matrixref_set_at_size]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
matrixref_set_at_int
  <span class="keyword">(</span>M<span class="keyword">,</span> i<span class="keyword">,</span> n<span class="keyword">,</span> j<span class="keyword">,</span> x<span class="keyword">)</span> <span class="keyword">=</span>
  matrixref_set_at_size <span class="keyword">(</span>M<span class="keyword">,</span> i2sz<span class="keyword">(</span>i<span class="keyword">)</span><span class="keyword">,</span> i2sz<span class="keyword">(</span>n<span class="keyword">)</span><span class="keyword">,</span> i2sz<span class="keyword">(</span>j<span class="keyword">)</span><span class="keyword">,</span> x<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span>
fprint_matrixref
  <span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">}</span></span>
<span class="keyword">(</span>
  out<span class="keyword">,</span> M<span class="keyword">,</span> nrow<span class="keyword">,</span> ncol
<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">{</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> M <span class="keyword">=</span>
$UN<span class="keyword">.</span>castvwtp1<span class="staexp"><span class="keyword">{</span>matrixptr<span class="keyword">(</span>a<span class="keyword">,</span> m<span class="keyword">,</span> n<span class="keyword">)</span><span class="keyword">}</span></span><span class="keyword">(</span>M<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fprint_matrixptr&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">,</span> M<span class="keyword">,</span> nrow<span class="keyword">,</span> ncol<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span> <span class="keyword">=</span> $UN<span class="keyword">.</span>cast2void <span class="keyword">(</span>M<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">}</span></span> <span class="comment">(* end of [fprint_matrixref] *)</span>

<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span>
fprint_matrixref_sep
  <span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">}</span></span>
<span class="keyword">(</span>
  out<span class="keyword">,</span> M<span class="keyword">,</span> nrow<span class="keyword">,</span> ncol<span class="keyword">,</span> sep1<span class="keyword">,</span> sep2
<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">{</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> M <span class="keyword">=</span>
$UN<span class="keyword">.</span>castvwtp1<span class="staexp"><span class="keyword">{</span>matrixptr<span class="keyword">(</span>a<span class="keyword">,</span> m<span class="keyword">,</span> n<span class="keyword">)</span><span class="keyword">}</span></span><span class="keyword">(</span>M<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span>
fprint_matrixptr_sep&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">,</span> M<span class="keyword">,</span> nrow<span class="keyword">,</span> ncol<span class="keyword">,</span> sep1<span class="keyword">,</span> sep2<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span> <span class="keyword">=</span> $UN<span class="keyword">.</span>cast2void <span class="keyword">(</span>M<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">}</span></span> <span class="comment">(* end of [fprint_matrixref_sep] *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
matrixref_copy
  <span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">}</span></span> <span class="keyword">(</span>M<span class="keyword">,</span> m<span class="keyword">,</span> n<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> A <span class="keyword">=</span> $UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>arrayref<span class="keyword">(</span>a<span class="keyword">,</span>m*n<span class="keyword">)</span><span class="keyword">}</span></span><span class="keyword">(</span>M<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  $UN<span class="keyword">.</span>castvwtp0<span class="staexp"><span class="keyword">{</span>matrixptr<span class="keyword">(</span>a<span class="keyword">,</span>m<span class="keyword">,</span>n<span class="keyword">)</span><span class="keyword">}</span></span><span class="keyword">(</span>arrayref_copy&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>A<span class="keyword">,</span> m*n<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [matrixref_copy]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span>
matrixref_tabulate
  <span class="keyword">(</span>nrow<span class="keyword">,</span> ncol<span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
  matrixptr_refize <span class="keyword">(</span>matrixptr_tabulate&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>nrow<span class="keyword">,</span> ncol<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">)</span></span> <span class="comment">(* end of [matrixref_tabulate] *)</span>

<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span>
matrixref_tabulate_cloref
  <span class="keyword">(</span>nrow<span class="keyword">,</span> ncol<span class="keyword">,</span> f<span class="keyword">)</span> <span class="keyword">=</span>
  matrixptr_refize <span class="keyword">(</span>matrixptr_tabulate_cloref&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>nrow<span class="keyword">,</span> ncol<span class="keyword">,</span> f<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">// end of [matrixref_tabulate_cloref]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span>
matrixref_foreach
  <span class="keyword">(</span>A<span class="keyword">,</span> m<span class="keyword">,</span> n<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="keyword">var</span> env<span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">)</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  matrixref_foreach_env&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">void</span><span class="keyword">&gt;</span> <span class="keyword">(</span>A<span class="keyword">,</span> m<span class="keyword">,</span> n<span class="keyword">,</span> env<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [matrixref_foreach]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">env</span><span class="keyword">}</span>
matrixref_foreach_env
  <span class="keyword">(</span>A<span class="keyword">,</span> m<span class="keyword">,</span> n<span class="keyword">,</span> env<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">vbox pf</span> <span class="keyword">|</span> p<span class="keyword">)</span> <span class="keyword">=</span> matrixref_get_viewptr <span class="keyword">(</span>A<span class="keyword">)</span></span>
<span class="keyword">in</span>
  <span class="keyword">$effmask_ref</span> <span class="keyword">(</span>matrix_foreach_env&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">env</span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="keyword">!</span>p<span class="keyword">,</span> m<span class="keyword">,</span> n<span class="keyword">,</span> env<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [matrixref_foreach_env]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
matrixref_foreach_cloref
  <span class="keyword">(</span>A<span class="keyword">,</span> m<span class="keyword">,</span> n<span class="keyword">,</span> fwork<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a2</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">env</span><span class="keyword">}</span>
matrix_foreach$fwork
  <span class="keyword">(</span>x<span class="keyword">,</span> env<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pf</span><span class="keyword">,</span> <span class="prfexp">fpf</span> <span class="keyword">|</span> p<span class="keyword">)</span> <span class="keyword">=</span> $UN<span class="keyword">.</span>ptr_vtake<span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="keyword">(</span><span class="dynexp"><span class="keyword">addr@</span></span>x<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span> <span class="keyword">=</span> fwork<span class="keyword">(</span><span class="keyword">!</span>p<span class="keyword">)</span></span>
  <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span> <span class="keyword">=</span> fpf<span class="keyword">(</span>pf<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">in</span>
  <span class="comment">// nothing</span>
<span class="keyword">end</span></span></span> <span class="comment">// end of [matrix_foreach$work]</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  matrixref_foreach&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>A<span class="keyword">,</span> m<span class="keyword">,</span> n<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [matrixref_foreach_cloref]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">local</span>
<span class="comment">//</span>
<span class="keyword">datatype</span>
<span class="staexp">mtrxszref
<span class="keyword">(</span>
  a<span class="keyword">:</span><span class="keyword">viewt@ype</span>
<span class="keyword">)</span> <span class="keyword">=</span>
<span class="dynexp"><span class="staexp"><span class="keyword">{</span>m<span class="keyword">,</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
MTRXSZREF <span class="keyword">of</span>
<span class="keyword">(</span>
  <span class="staexp">matrixref</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">m</span><span class="keyword">,</span> <span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">,</span> <span class="staexp">size_t</span><span class="keyword">(</span><span class="staexp">m</span><span class="keyword">)</span><span class="keyword">,</span> <span class="staexp">size_t</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">)</span></span></span> <span class="comment">// end of [mtrxszref]</span>
<span class="comment">//</span>
<span class="staexp"><span class="keyword">assume</span> mtrxszref_vt0ype_type <span class="keyword">=</span> mtrxszref</span>
<span class="comment">//</span>
<span class="keyword">in</span> <span class="comment">(* in of [local] *)</span>

<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span>
mtrxszref_make_matrixref
  <span class="keyword">(</span>M<span class="keyword">,</span> nrow<span class="keyword">,</span> ncol<span class="keyword">)</span> <span class="keyword">=</span> MTRXSZREF <span class="keyword">(</span>M<span class="keyword">,</span> nrow<span class="keyword">,</span> ncol<span class="keyword">)</span></span>
<span class="comment">// end of [mtrxszref_make_matrixref]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span>
mtrxszref_get_ref <span class="keyword">(</span>MSZ<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val+</span>MTRXSZREF <span class="keyword">(</span>M<span class="keyword">,</span> nrow<span class="keyword">,</span> ncol<span class="keyword">)</span> <span class="keyword">=</span> MSZ</span> <span class="keyword">in</span> $UN<span class="keyword">.</span>cast2Ptr1<span class="keyword">(</span>M<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [mtrxszref_get_ref]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span>
mtrxszref_get_nrow <span class="keyword">(</span>MSZ<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val+</span>MTRXSZREF <span class="keyword">(</span>M<span class="keyword">,</span> nrow<span class="keyword">,</span> ncol<span class="keyword">)</span> <span class="keyword">=</span> MSZ</span> <span class="keyword">in</span> nrow
<span class="keyword">end</span></span> <span class="comment">// end of [mtrxszref_get_nrow]</span>

<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span>
mtrxszref_get_ncol <span class="keyword">(</span>MSZ<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val+</span>MTRXSZREF <span class="keyword">(</span>M<span class="keyword">,</span> nrow<span class="keyword">,</span> ncol<span class="keyword">)</span> <span class="keyword">=</span> MSZ</span> <span class="keyword">in</span> ncol
<span class="keyword">end</span></span> <span class="comment">// end of [mtrxszref_get_ncol]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span>
mtrxszref_get_refsize
   <span class="keyword">(</span>MSZ<span class="keyword">,</span> nrow_r<span class="keyword">,</span> ncol_r<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val+</span>MTRXSZREF <span class="keyword">(</span>M<span class="keyword">,</span> nrow<span class="keyword">,</span> ncol<span class="keyword">)</span> <span class="keyword">=</span> MSZ</span>
<span class="comment">//</span>
<span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span> <span class="keyword">=</span> lemma_matrixref_param <span class="keyword">(</span>M<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  nrow_r := nrow<span class="keyword">;</span> ncol_r := ncol<span class="keyword">;</span> M<span class="comment">(*matrixref*)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [mtrxszref_get_nrow]</span>

<span class="keyword">end</span> <span class="comment">// end of [local]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span>
mtrxszref_make_elt
  <span class="keyword">(</span>nrow<span class="keyword">,</span> ncol<span class="keyword">,</span> x<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> nrow <span class="keyword">=</span> g1ofg0_uint <span class="keyword">(</span>nrow<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> ncol <span class="keyword">=</span> g1ofg0_uint <span class="keyword">(</span>ncol<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> M <span class="keyword">=</span>
  matrixref_make_elt&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>nrow<span class="keyword">,</span> ncol<span class="keyword">,</span> x<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  mtrxszref_make_matrixref <span class="keyword">(</span>M<span class="keyword">,</span> nrow<span class="keyword">,</span> ncol<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [mtrxszref_make_elt]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span>
mtrxszref_get_at_int
  <span class="keyword">(</span>MSZ<span class="keyword">,</span> i<span class="keyword">,</span> j<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> i <span class="keyword">=</span> g1ofg0_int<span class="keyword">(</span>i<span class="keyword">)</span>
<span class="keyword">and</span> j <span class="keyword">=</span> g1ofg0_int<span class="keyword">(</span>j<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">if</span>
i &gt;= <span class="dynexp">0</span>
<span class="keyword">then</span> <span class="keyword">(</span>
<span class="comment">//</span>
<span class="keyword">if</span>
j &gt;= <span class="dynexp">0</span>
<span class="keyword">then</span> <span class="keyword">(</span>
  mtrxszref_get_at_size<span class="keyword">(</span>MSZ<span class="keyword">,</span>i2sz<span class="keyword">(</span>i<span class="keyword">)</span><span class="keyword">,</span>i2sz<span class="keyword">(</span>j<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">else</span> <span class="dynexp"><span class="keyword">$raise</span> MatrixSubscriptExn<span class="keyword">(</span><span class="comment">(* j &lt; 0 *)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">)</span> <span class="keyword">else</span> <span class="dynexp"><span class="keyword">$raise</span> MatrixSubscriptExn<span class="keyword">(</span><span class="comment">(* i &lt; 0 *)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [mtrxszref_get_at_gint]</span>

<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span>
mtrxszref_get_at_size
  <span class="keyword">(</span>MSZ<span class="keyword">,</span> i<span class="keyword">,</span> j<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="keyword">var</span> nrow<span class="keyword">:</span> <span class="staexp">size_t</span>
<span class="keyword">and</span> ncol<span class="keyword">:</span> <span class="staexp">size_t</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> M <span class="keyword">=</span>
<span class="keyword">$effmask_wrt</span> <span class="keyword">(</span>
  mtrxszref_get_refsize <span class="keyword">(</span>MSZ<span class="keyword">,</span> nrow<span class="keyword">,</span> ncol<span class="keyword">)</span>
<span class="keyword">)</span></span> <span class="comment">(* end of [val] *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> i <span class="keyword">=</span> g1ofg0_uint<span class="keyword">(</span>i<span class="keyword">)</span>
<span class="keyword">and</span> j <span class="keyword">=</span> g1ofg0_uint<span class="keyword">(</span>j<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">if</span>
nrow <span class="keyword">&gt;</span> i
<span class="keyword">then</span> <span class="keyword">(</span>
<span class="comment">//</span>
<span class="keyword">if</span>
ncol <span class="keyword">&gt;</span> j
<span class="keyword">then</span> <span class="keyword">(</span>
  matrixref_get_at_size <span class="keyword">(</span>M<span class="keyword">,</span> i<span class="keyword">,</span> ncol<span class="keyword">,</span> j<span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">else</span> <span class="dynexp"><span class="keyword">$raise</span> MatrixSubscriptExn<span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">)</span> <span class="keyword">else</span> <span class="dynexp"><span class="keyword">$raise</span> MatrixSubscriptExn<span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [mtrxszref_get_at_size]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span>
mtrxszref_set_at_int
  <span class="keyword">(</span>MSZ<span class="keyword">,</span> i<span class="keyword">,</span> j<span class="keyword">,</span> x<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> i <span class="keyword">=</span> g1ofg0_int<span class="keyword">(</span>i<span class="keyword">)</span>
<span class="keyword">and</span> j <span class="keyword">=</span> g1ofg0_int<span class="keyword">(</span>j<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">if</span>
i &gt;= <span class="dynexp">0</span>
<span class="keyword">then</span> <span class="keyword">(</span>
<span class="comment">//</span>
<span class="keyword">if</span>
j &gt;= <span class="dynexp">0</span>
<span class="keyword">then</span> <span class="keyword">(</span>
  mtrxszref_set_at_size<span class="keyword">(</span>MSZ<span class="keyword">,</span>i2sz<span class="keyword">(</span>i<span class="keyword">)</span><span class="keyword">,</span>i2sz<span class="keyword">(</span>j<span class="keyword">)</span><span class="keyword">,</span>x<span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">else</span> <span class="dynexp"><span class="keyword">$raise</span> MatrixSubscriptExn<span class="keyword">(</span> <span class="comment">(* j &lt; 0 *)</span> <span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">)</span> <span class="keyword">else</span> <span class="dynexp"><span class="keyword">$raise</span> MatrixSubscriptExn<span class="keyword">(</span> <span class="comment">(* i &lt; 0 *)</span> <span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [mtrxszref_set_at_int]</span>

<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span>
mtrxszref_set_at_size
  <span class="keyword">(</span>MSZ<span class="keyword">,</span> i<span class="keyword">,</span> j<span class="keyword">,</span> x<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="keyword">var</span> nrow<span class="keyword">:</span> <span class="staexp">size_t</span>
<span class="keyword">and</span> ncol<span class="keyword">:</span> <span class="staexp">size_t</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> M <span class="keyword">=</span>
<span class="keyword">(</span>
  mtrxszref_get_refsize <span class="keyword">(</span>MSZ<span class="keyword">,</span> nrow<span class="keyword">,</span> ncol<span class="keyword">)</span>
<span class="keyword">)</span></span> <span class="comment">(* end of [val] *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> i <span class="keyword">=</span> g1ofg0_uint <span class="keyword">(</span>i<span class="keyword">)</span>
<span class="keyword">and</span> j <span class="keyword">=</span> g1ofg0_uint <span class="keyword">(</span>j<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">if</span>
nrow <span class="keyword">&gt;</span> i
<span class="keyword">then</span> <span class="keyword">(</span>
<span class="comment">//</span>
<span class="keyword">if</span>
ncol <span class="keyword">&gt;</span> j
<span class="keyword">then</span> <span class="keyword">(</span>
  matrixref_set_at_size<span class="keyword">(</span>M<span class="keyword">,</span> i<span class="keyword">,</span> ncol<span class="keyword">,</span> j<span class="keyword">,</span> x<span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">else</span> <span class="dynexp"><span class="keyword">$raise</span> MatrixSubscriptExn<span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">)</span> <span class="keyword">else</span> <span class="dynexp"><span class="keyword">$raise</span> MatrixSubscriptExn<span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [mtrxszref_set_at_size]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span>
fprint_mtrxszref
  <span class="keyword">(</span>out<span class="keyword">,</span> MSZ<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="keyword">var</span> nrow<span class="keyword">:</span> <span class="staexp">size_t</span>
<span class="keyword">and</span> ncol<span class="keyword">:</span> <span class="staexp">size_t</span>
<span class="dynexp"><span class="keyword">val</span> A <span class="keyword">=</span>
  mtrxszref_get_refsize <span class="keyword">(</span>MSZ<span class="keyword">,</span> nrow<span class="keyword">,</span> ncol<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  fprint_matrixref&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">,</span> A<span class="keyword">,</span> nrow<span class="keyword">,</span> ncol<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [fprint_mtrxszref]</span>

<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span>
fprint_mtrxszref_sep
  <span class="keyword">(</span>out<span class="keyword">,</span> MSZ<span class="keyword">,</span> sep1<span class="keyword">,</span> sep2<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="keyword">var</span> nrow<span class="keyword">:</span> <span class="staexp">size_t</span>
<span class="keyword">and</span> ncol<span class="keyword">:</span> <span class="staexp">size_t</span>
<span class="dynexp"><span class="keyword">val</span> A <span class="keyword">=</span>
  mtrxszref_get_refsize <span class="keyword">(</span>MSZ<span class="keyword">,</span> nrow<span class="keyword">,</span> ncol<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  fprint_matrixref_sep&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">,</span> A<span class="keyword">,</span> nrow<span class="keyword">,</span> ncol<span class="keyword">,</span> sep1<span class="keyword">,</span> sep2<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [fprint_mtrxszref_sep]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span>
mtrxszref_foreach
  <span class="keyword">(</span>A<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="keyword">var</span> env<span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">)</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  mtrxszref_foreach_env&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">void</span><span class="keyword">&gt;</span> <span class="keyword">(</span>A<span class="keyword">,</span> env<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [mtrxszref_foreach]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">env</span><span class="keyword">}</span>
mtrxszref_foreach_env
  <span class="keyword">(</span>MSZ<span class="keyword">,</span> env<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="keyword">var</span> nrow<span class="keyword">:</span> <span class="staexp">size_t</span> <span class="keyword">and</span> ncol<span class="keyword">:</span> <span class="staexp">size_t</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> MAT <span class="keyword">=</span> mtrxszref_get_refsize<span class="keyword">(</span>MSZ<span class="keyword">,</span> nrow<span class="keyword">,</span> ncol<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  matrixref_foreach_env&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">env</span><span class="keyword">&gt;</span> <span class="keyword">(</span>MAT<span class="keyword">,</span> nrow<span class="keyword">,</span> ncol<span class="keyword">,</span> env<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [mtrxszref_foreach_env]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
mtrxszref_foreach_cloref
  <span class="keyword">(</span>MSZ<span class="keyword">,</span> fwork<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a2</span><span class="keyword">}</span><span class="keyword">{</span><span class="staexp">env</span><span class="keyword">}</span>
matrix_foreach$fwork
  <span class="keyword">(</span>x<span class="keyword">,</span> env<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pf</span><span class="keyword">,</span> <span class="prfexp">fpf</span> <span class="keyword">|</span> p<span class="keyword">)</span> <span class="keyword">=</span> $UN<span class="keyword">.</span>ptr_vtake<span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="keyword">(</span><span class="dynexp"><span class="keyword">addr@</span></span>x<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span> <span class="keyword">=</span> fwork<span class="keyword">(</span><span class="keyword">!</span>p<span class="keyword">)</span></span>
  <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span> <span class="keyword">=</span> fpf<span class="keyword">(</span>pf<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">in</span>
  <span class="comment">// nothing</span>
<span class="keyword">end</span></span></span> <span class="comment">// end of [matrix_foreach$work]</span>
<span class="comment">//</span>
<span class="keyword">in</span>
  mtrxszref_foreach<span class="keyword">(</span>MSZ<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [mtrxszref_foreach_cloref]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span>
mtrxszref_tabulate
  <span class="keyword">(</span>nrow<span class="keyword">,</span> ncol<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> nrow <span class="keyword">=</span> g1ofg0_uint <span class="keyword">(</span>nrow<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> ncol <span class="keyword">=</span> g1ofg0_uint <span class="keyword">(</span>ncol<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> M <span class="keyword">=</span>
  matrixref_tabulate&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>nrow<span class="keyword">,</span> ncol<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span> 
  mtrxszref_make_matrixref <span class="keyword">(</span>M<span class="keyword">,</span> nrow<span class="keyword">,</span> ncol<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [mtrxszref_tabulate]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span>
mtrxszref_tabulate_cloref
<span class="keyword">(</span>
  nrow<span class="keyword">,</span> ncol<span class="keyword">,</span> fclo
<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> M <span class="keyword">=</span>
matrixref_tabulate_cloref&lt;<span class="staexp">a</span><span class="keyword">&gt;</span>
<span class="keyword">(</span>
  nrow<span class="keyword">,</span> ncol<span class="keyword">,</span> fclo
<span class="keyword">)</span></span> <span class="comment">(* end of [val] *)</span>
<span class="comment">//</span>
<span class="keyword">in</span>
<span class="comment">//</span>
mtrxszref_make_matrixref <span class="keyword">(</span>M<span class="keyword">,</span> nrow<span class="keyword">,</span> ncol<span class="keyword">)</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [mtrxszref_tabulate_cloref]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* end of [matrixref.dats] *)</span>
</pre>
<pre class="patsyntax">
<span class="comment">(***********************************************************************)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(*                         Applied Type System                         *)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(***********************************************************************)</span>

<span class="comment">(*
** ATS/Postiats - Unleashing the Potential of Types!
** Copyright (C) 2010-2015 Hongwei Xi, ATS Trustful Software, Inc.
** All rights reserved
**
** ATS is free software;  you can  redistribute it and/or modify it under
** the terms of  the GNU GENERAL PUBLIC LICENSE (GPL) as published by the
** Free Software Foundation; either version 3, or (at  your  option)  any
** later version.
**
** ATS is distributed in the hope that it will be useful, but WITHOUT ANY
** WARRANTY; without  even  the  implied  warranty  of MERCHANTABILITY or
** FITNESS FOR A PARTICULAR PURPOSE.  See the  GNU General Public License
** for more details.
**
** You  should  have  received  a  copy of the GNU General Public License
** along  with  ATS;  see the  file COPYING.  If not, please write to the
** Free Software Foundation,  51 Franklin Street, Fifth Floor, Boston, MA
** 02110-1301, USA.
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
** Source:
** $PATSHOME/prelude/DATS/CODEGEN/gprint.atxt
** Time of generation: Sun Oct  2 10:34:00 2016
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* Author: Hongwei Xi *)</span>
<span class="comment">(* Authoremail: hwxi AT cs DOT bu DOT edu *)</span>
<span class="comment">(* Start time: August, 2012 *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
gprint$out <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> stdout_ref</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
gprint_newline <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> out <span class="keyword">=</span> gprint$out <span class="keyword">(</span><span class="keyword">)</span></span> <span class="keyword">in</span> fprint_newline <span class="keyword">(</span>out<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [gprint_newline]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
gprint_val <span class="keyword">(</span>x<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> out <span class="keyword">=</span> gprint$out <span class="keyword">(</span><span class="keyword">)</span></span> <span class="keyword">in</span> fprint_val&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">,</span> x<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [gprint_val]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
gprint_ref <span class="keyword">(</span>x<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> out <span class="keyword">=</span> gprint$out <span class="keyword">(</span><span class="keyword">)</span></span> <span class="keyword">in</span> fprint_ref&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>out<span class="keyword">,</span> x<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [gprint_ref]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
gprint_int <span class="keyword">(</span>x<span class="keyword">)</span> <span class="keyword">=</span>
  fprint_val&lt;<span class="staexp">int</span><span class="keyword">&gt;</span> <span class="keyword">(</span>gprint$out<span class="keyword">(</span><span class="keyword">)</span><span class="keyword">,</span> x<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
gprint_bool <span class="keyword">(</span>x<span class="keyword">)</span> <span class="keyword">=</span>
  fprint_val&lt;<span class="staexp">bool</span><span class="keyword">&gt;</span> <span class="keyword">(</span>gprint$out<span class="keyword">(</span><span class="keyword">)</span><span class="keyword">,</span> x<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
gprint_char <span class="keyword">(</span>x<span class="keyword">)</span> <span class="keyword">=</span>
  fprint_val&lt;<span class="staexp">char</span><span class="keyword">&gt;</span> <span class="keyword">(</span>gprint$out<span class="keyword">(</span><span class="keyword">)</span><span class="keyword">,</span> x<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
gprint_float <span class="keyword">(</span>x<span class="keyword">)</span> <span class="keyword">=</span>
  fprint_val&lt;<span class="staexp">float</span><span class="keyword">&gt;</span> <span class="keyword">(</span>gprint$out<span class="keyword">(</span><span class="keyword">)</span><span class="keyword">,</span> x<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
gprint_double <span class="keyword">(</span>x<span class="keyword">)</span> <span class="keyword">=</span>
  fprint_val&lt;<span class="staexp">double</span><span class="keyword">&gt;</span> <span class="keyword">(</span>gprint$out<span class="keyword">(</span><span class="keyword">)</span><span class="keyword">,</span> x<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
gprint_string <span class="keyword">(</span>x<span class="keyword">)</span> <span class="keyword">=</span>
  fprint_val&lt;<span class="staexp">string</span><span class="keyword">&gt;</span> <span class="keyword">(</span>gprint$out<span class="keyword">(</span><span class="keyword">)</span><span class="keyword">,</span> x<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span> gprint_val&lt;<span class="staexp">int</span><span class="keyword">&gt;</span> <span class="keyword">(</span>x<span class="keyword">)</span> <span class="keyword">=</span> gprint_int <span class="keyword">(</span>x<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">implement</span> gprint_val&lt;<span class="staexp">char</span><span class="keyword">&gt;</span> <span class="keyword">(</span>x<span class="keyword">)</span> <span class="keyword">=</span> gprint_char <span class="keyword">(</span>x<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">implement</span> gprint_val&lt;<span class="staexp">float</span><span class="keyword">&gt;</span> <span class="keyword">(</span>x<span class="keyword">)</span> <span class="keyword">=</span> gprint_float <span class="keyword">(</span>x<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">implement</span> gprint_val&lt;<span class="staexp">double</span><span class="keyword">&gt;</span> <span class="keyword">(</span>x<span class="keyword">)</span> <span class="keyword">=</span> gprint_double <span class="keyword">(</span>x<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">implement</span> gprint_val&lt;<span class="staexp">string</span><span class="keyword">&gt;</span> <span class="keyword">(</span>x<span class="keyword">)</span> <span class="keyword">=</span> gprint_string <span class="keyword">(</span>x<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span>
gprint_list$beg <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> gprint_string <span class="dynstr">"("</span></span>
<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span>
gprint_list$end <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> gprint_string <span class="dynstr">")"</span></span>
<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span>
gprint_list$sep <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> gprint_string <span class="dynstr">", "</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
gprint_list
  <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="keyword">typedef</span> <span class="staexp">tenv <span class="keyword">=</span> <span class="staexp">int</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
list_foreach$fwork&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">tenv</span><span class="keyword">&gt;</span>
  <span class="keyword">(</span>x<span class="keyword">,</span> env<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span>
    <span class="keyword">if</span> env <span class="keyword">&gt;</span> <span class="dynexp">0</span> <span class="keyword">then</span> gprint_list$sep <span class="keyword">(</span><span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> env := succ <span class="keyword">(</span>env<span class="keyword">)</span></span>
<span class="keyword">in</span>
  gprint_val <span class="keyword">(</span>x<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [list_foreach$fwork]</span>
<span class="comment">//</span>
<span class="keyword">var</span> env<span class="keyword">:</span> <span class="staexp">tenv</span> <span class="keyword">=</span> <span class="dynexp">0</span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> gprint_list$beg <span class="keyword">(</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> list_foreach_env&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">tenv</span><span class="keyword">&gt;</span> <span class="keyword">(</span>xs<span class="keyword">,</span> env<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> gprint_list$end <span class="keyword">(</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">in</span>
  <span class="comment">// nothing</span>
<span class="keyword">end</span></span></span> <span class="comment">// end of [gprint_list]</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="comment">(*tmp*)</span>
gprint_val&lt;<span class="staexp">List</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">&gt;</span> <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span> gprint_list&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>xs<span class="keyword">)</span></span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span>
gprint_listlist$beg1 <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> gprint_string <span class="dynstr">"("</span></span>
<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span>
gprint_listlist$end1 <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> gprint_string <span class="dynstr">")"</span></span>
<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span>
gprint_listlist$sep1 <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> gprint_string <span class="dynstr">", "</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span>
gprint_listlist$beg2 <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> gprint_string <span class="dynstr">"("</span></span>
<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span>
gprint_listlist$end2 <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> gprint_string <span class="dynstr">")"</span></span>
<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span>
gprint_listlist$sep2 <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> gprint_string <span class="dynstr">", "</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
gprint_listlist
  <span class="keyword">(</span>xss<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="keyword">typedef</span> <span class="staexp">xs <span class="keyword">=</span> <span class="staexp">List</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
gprint_val&lt;<span class="staexp">xs</span><span class="keyword">&gt;</span> <span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span> gprint_list$beg&lt;<span class="keyword">&gt;</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> gprint_listlist$beg2 <span class="keyword">(</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">implement</span> gprint_list$end&lt;<span class="keyword">&gt;</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> gprint_listlist$end2 <span class="keyword">(</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">implement</span> gprint_list$sep&lt;<span class="keyword">&gt;</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> gprint_listlist$sep2 <span class="keyword">(</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  gprint_list&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>xs<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [gprint_val]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span> gprint_list$beg&lt;<span class="keyword">&gt;</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> gprint_listlist$beg1 <span class="keyword">(</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">implement</span> gprint_list$end&lt;<span class="keyword">&gt;</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> gprint_listlist$end1 <span class="keyword">(</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">implement</span> gprint_list$sep&lt;<span class="keyword">&gt;</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> gprint_listlist$sep1 <span class="keyword">(</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  gprint_list&lt;<span class="staexp">xs</span><span class="keyword">&gt;</span> <span class="keyword">(</span>xss<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [gprint_listlist]</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span>
gprint_array$beg <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> gprint_string <span class="dynstr">"("</span></span>
<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span>
gprint_array$end <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> gprint_string <span class="dynstr">")"</span></span>
<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span>
gprint_array$sep <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> gprint_string <span class="dynstr">", "</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
gprint_array
  <span class="keyword">(</span>A<span class="keyword">,</span> n<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="keyword">typedef</span> <span class="staexp">tenv <span class="keyword">=</span> <span class="staexp">size_t</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">(</span><span class="staexp">env</span><span class="keyword">)</span><span class="comment">(*tmp*)</span>
array_iforeach$fwork&lt;<span class="staexp">a</span><span class="keyword">&gt;&lt;</span><span class="staexp">env</span><span class="keyword">&gt;</span>
  <span class="keyword">(</span>i<span class="keyword">,</span> x<span class="keyword">,</span> env<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">if</span> i <span class="keyword">&gt;</span> <span class="dynexp">0</span> <span class="keyword">then</span> gprint_array$sep <span class="keyword">(</span><span class="keyword">)</span></span>
<span class="keyword">in</span>
  gprint_ref&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>x<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [array_iforeach$fwork]</span>
<span class="comment">//</span>
<span class="keyword">var</span> env<span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">)</span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> gprint_array$beg <span class="keyword">(</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> _<span class="comment">(*n*)</span> <span class="keyword">=</span> array_iforeach&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>A<span class="keyword">,</span> n<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> gprint_array$end <span class="keyword">(</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">in</span>
  <span class="comment">// nothing</span>
<span class="keyword">end</span></span></span> <span class="comment">// end of [gprint_array]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
gprint_arrayptr
  <span class="keyword">(</span>A<span class="keyword">,</span> n<span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">{</span>
  <span class="dynexp"><span class="keyword">val</span> p <span class="keyword">=</span> ptrcast <span class="keyword">(</span>A<span class="keyword">)</span></span>
  <span class="prfexp"><span class="keyword">prval</span> pf <span class="keyword">=</span> arrayptr_takeout <span class="keyword">(</span>A<span class="keyword">)</span></span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> gprint_array&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="keyword">!</span>p<span class="keyword">,</span> n<span class="keyword">)</span></span>
  <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> arrayptr_addback <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> A<span class="keyword">)</span></span>
<span class="keyword">}</span></span> <span class="comment">(* end of [gprint_arrayptr] *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
gprint_arrayref
  <span class="keyword">(</span>A<span class="keyword">,</span> n<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">vbox pf</span> <span class="keyword">|</span> p<span class="keyword">)</span> <span class="keyword">=</span>
  arrayref_get_viewptr <span class="keyword">(</span>A<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  <span class="keyword">$effmask_ref</span> <span class="keyword">(</span>gprint_array&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="keyword">!</span>p<span class="keyword">,</span> n<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [gprint_arrayref]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
gprint_arrszref
  <span class="keyword">(</span>ASZ<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">where</span> <span class="keyword">{</span>
<span class="comment">//</span>
<span class="keyword">var</span> n<span class="keyword">:</span> <span class="staexp">size_t</span>
<span class="dynexp"><span class="keyword">val</span> A <span class="keyword">=</span>
  arrszref_get_refsize&lt;<span class="keyword">&gt;</span> <span class="keyword">(</span>ASZ<span class="keyword">,</span> n<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> gprint_arrayref&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>A<span class="keyword">,</span> n<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">}</span></span> <span class="comment">(* end of [gprint_arrszref] *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* end of [gprint.dats] *)</span>
</pre>
<pre class="patsyntax">
<span class="comment">(***********************************************************************)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(*                         Applied Type System                         *)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(***********************************************************************)</span>

<span class="comment">(*
** ATS/Postiats - Unleashing the Potential of Types!
** Copyright (C) 2010-2015 Hongwei Xi, ATS Trustful Software, Inc.
** All rights reserved
**
** ATS is free software;  you can  redistribute it and/or modify it under
** the terms of  the GNU GENERAL PUBLIC LICENSE (GPL) as published by the
** Free Software Foundation; either version 3, or (at  your  option)  any
** later version.
**
** ATS is distributed in the hope that it will be useful, but WITHOUT ANY
** WARRANTY; without  even  the  implied  warranty  of MERCHANTABILITY or
** FITNESS FOR A PARTICULAR PURPOSE.  See the  GNU General Public License
** for more details.
**
** You  should  have  received  a  copy of the GNU General Public License
** along  with  ATS;  see the  file COPYING.  If not, please write to the
** Free Software Foundation,  51 Franklin Street, Fifth Floor, Boston, MA
** 02110-1301, USA.
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
** Source:
** $PATSHOME/prelude/DATS/CODEGEN/tostring.atxt
** Time of generation: Tue Oct 25 00:23:04 2016
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* Author: Hongwei Xi *)</span>
<span class="comment">(* Authoremail: hwxiATgmailDOTcom *)</span>
<span class="comment">(* Start time: April, 2015 *)</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="keyword">staload</span>
UN <span class="keyword">=</span> "prelude/SATS/unsafe.sats"
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
tostring_int<span class="keyword">(</span>i<span class="keyword">)</span> <span class="keyword">=</span> 
<span class="keyword">$effmask_wrt</span>
<span class="keyword">(</span>
  strptr2string<span class="keyword">(</span>tostrptr_int<span class="keyword">(</span>i<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
tostrptr_int<span class="keyword">(</span>i<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="neuexp"><span class="keyword">#define</span> BSZ 32</span>
<span class="comment">//</span>
<span class="keyword">typedef</span>
<span class="staexp">cstring <span class="keyword">=</span> <span class="staexp"><span class="keyword">$extype</span>"atstype_string"</span></span>
<span class="comment">//</span>
<span class="keyword">var</span> buf <span class="keyword">=</span> <span class="dynexp"><span class="keyword">@[</span>byte<span class="keyword">]</span><span class="keyword">[</span>BSZ<span class="keyword">]</span><span class="keyword">(</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> bufp <span class="keyword">=</span> $UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>cstring<span class="keyword">}</span></span><span class="keyword">(</span><span class="dynexp"><span class="keyword">addr@</span></span>buf<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> _<span class="comment">(*int*)</span> <span class="keyword">=</span>
  <span class="dynexp"><span class="keyword">$extfcall</span><span class="keyword">(</span>ssize_t<span class="keyword">,</span> "snprintf"<span class="keyword">,</span> bufp<span class="keyword">,</span> BSZ<span class="keyword">,</span> "%i"<span class="keyword">,</span> i<span class="keyword">)</span></span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
<span class="comment">//</span>
$UN<span class="keyword">.</span>castvwtp0<span class="staexp"><span class="keyword">{</span>Strptr1<span class="keyword">}</span></span><span class="keyword">(</span>string0_copy<span class="keyword">(</span>$UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>string<span class="keyword">}</span></span><span class="keyword">(</span>bufp<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [tostrptr_int]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
tostring_val&lt;<span class="staexp">int</span><span class="keyword">&gt;</span> <span class="keyword">=</span> tostring_int</span>
<span class="dynexp"><span class="keyword">implement</span>
tostrptr_val&lt;<span class="staexp">int</span><span class="keyword">&gt;</span> <span class="keyword">=</span> tostrptr_int</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
tostrptr_val&lt;<span class="staexp">lint</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0int2string_lint</span>
<span class="dynexp"><span class="keyword">implement</span>
tostrptr_val&lt;<span class="staexp">llint</span><span class="keyword">&gt;</span> <span class="keyword">=</span> g0int2string_llint</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
tostring_uint<span class="keyword">(</span>u<span class="keyword">)</span> <span class="keyword">=</span> 
<span class="keyword">$effmask_wrt</span>
<span class="keyword">(</span>
  strptr2string<span class="keyword">(</span>tostrptr_uint<span class="keyword">(</span>u<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
tostrptr_uint<span class="keyword">(</span>u<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="neuexp"><span class="keyword">#define</span> BSZ 32</span>
<span class="comment">//</span>
<span class="keyword">typedef</span>
<span class="staexp">cstring <span class="keyword">=</span> <span class="staexp"><span class="keyword">$extype</span>"atstype_string"</span></span>
<span class="comment">//</span>
<span class="keyword">var</span> buf <span class="keyword">=</span> <span class="dynexp"><span class="keyword">@[</span>byte<span class="keyword">]</span><span class="keyword">[</span>BSZ<span class="keyword">]</span><span class="keyword">(</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> bufp <span class="keyword">=</span> $UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>cstring<span class="keyword">}</span></span><span class="keyword">(</span><span class="dynexp"><span class="keyword">addr@</span></span>buf<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> _<span class="comment">(*int*)</span> <span class="keyword">=</span>
  <span class="dynexp"><span class="keyword">$extfcall</span><span class="keyword">(</span>ssize_t<span class="keyword">,</span> "snprintf"<span class="keyword">,</span> bufp<span class="keyword">,</span> BSZ<span class="keyword">,</span> "%u"<span class="keyword">,</span> u<span class="keyword">)</span></span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
<span class="comment">//</span>
$UN<span class="keyword">.</span>castvwtp0<span class="staexp"><span class="keyword">{</span>Strptr1<span class="keyword">}</span></span><span class="keyword">(</span>string0_copy<span class="keyword">(</span>$UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>string<span class="keyword">}</span></span><span class="keyword">(</span>bufp<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [tostrptr_uint]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
tostring_val&lt;<span class="staexp">uint</span><span class="keyword">&gt;</span> <span class="keyword">=</span> tostring_uint</span>
<span class="dynexp"><span class="keyword">implement</span>
tostrptr_val&lt;<span class="staexp">uint</span><span class="keyword">&gt;</span> <span class="keyword">=</span> tostrptr_uint</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
tostring_bool<span class="keyword">(</span>b<span class="keyword">)</span> <span class="keyword">=</span> bool2string<span class="keyword">(</span>b<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
tostrptr_bool<span class="keyword">(</span>b<span class="keyword">)</span> <span class="keyword">=</span> string0_copy<span class="keyword">(</span>bool2string<span class="keyword">(</span>b<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
tostring_val&lt;<span class="staexp">bool</span><span class="keyword">&gt;</span> <span class="keyword">=</span> tostring_bool</span>
<span class="dynexp"><span class="keyword">implement</span>
tostrptr_val&lt;<span class="staexp">bool</span><span class="keyword">&gt;</span> <span class="keyword">=</span> tostrptr_bool</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
tostring_char<span class="keyword">(</span>c<span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">$effmask_wrt</span>
<span class="keyword">(</span>
  strptr2string<span class="keyword">(</span>char2strptr<span class="keyword">(</span>c<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
tostrptr_char<span class="keyword">(</span>c<span class="keyword">)</span> <span class="keyword">=</span> char2strptr<span class="keyword">(</span>c<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
tostring_val&lt;<span class="staexp">char</span><span class="keyword">&gt;</span> <span class="keyword">=</span> tostring_char</span>
<span class="dynexp"><span class="keyword">implement</span>
tostrptr_val&lt;<span class="staexp">char</span><span class="keyword">&gt;</span> <span class="keyword">=</span> tostrptr_char</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
tostring_double<span class="keyword">(</span>i<span class="keyword">)</span> <span class="keyword">=</span> 
<span class="keyword">$effmask_wrt</span>
<span class="keyword">(</span>
  strptr2string<span class="keyword">(</span>tostrptr_double<span class="keyword">(</span>i<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span><span class="comment">(*tmp*)</span>
tostrptr_double<span class="keyword">(</span>x<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="neuexp"><span class="keyword">#define</span> BSZ 32</span>
<span class="comment">//</span>
<span class="keyword">typedef</span>
<span class="staexp">cstring <span class="keyword">=</span> <span class="staexp"><span class="keyword">$extype</span>"atstype_string"</span></span>
<span class="comment">//</span>
<span class="keyword">var</span> buf <span class="keyword">=</span> <span class="dynexp"><span class="keyword">@[</span>byte<span class="keyword">]</span><span class="keyword">[</span>BSZ<span class="keyword">]</span><span class="keyword">(</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> bufp <span class="keyword">=</span> $UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>cstring<span class="keyword">}</span></span><span class="keyword">(</span><span class="dynexp"><span class="keyword">addr@</span></span>buf<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> _<span class="comment">(*int*)</span> <span class="keyword">=</span>
  <span class="dynexp"><span class="keyword">$extfcall</span><span class="keyword">(</span>ssize_t<span class="keyword">,</span> "snprintf"<span class="keyword">,</span> bufp<span class="keyword">,</span> BSZ<span class="keyword">,</span> "%.6f"<span class="keyword">,</span> x<span class="keyword">)</span></span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
<span class="comment">//</span>
$UN<span class="keyword">.</span>castvwtp0<span class="staexp"><span class="keyword">{</span>Strptr1<span class="keyword">}</span></span><span class="keyword">(</span>string0_copy<span class="keyword">(</span>$UN<span class="keyword">.</span>cast<span class="staexp"><span class="keyword">{</span>string<span class="keyword">}</span></span><span class="keyword">(</span>bufp<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [tostrptr_double]</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span>
tostring_val&lt;<span class="staexp">double</span><span class="keyword">&gt;</span> <span class="keyword">=</span> tostring_double</span>
<span class="dynexp"><span class="keyword">implement</span>
tostrptr_val&lt;<span class="staexp">double</span><span class="keyword">&gt;</span> <span class="keyword">=</span> tostrptr_double</span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
tostrptr_list<span class="keyword">(</span>xs<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
loop
<span class="keyword">(</span>
  i<span class="keyword">:</span> <span class="staexp">int</span>
<span class="keyword">,</span> xs<span class="keyword">:</span> <span class="staexp">List</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span>
<span class="keyword">,</span> res<span class="keyword">:</span> <span class="staexp">List0_vt</span><span class="keyword">(</span><span class="staexp">Strptr1</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">List0_vt</span><span class="keyword">(</span><span class="staexp">Strptr1</span><span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
<span class="keyword">case+</span> xs <span class="keyword">of</span>
<span class="keyword">|</span> list_nil
    <span class="keyword">(</span><span class="comment">(*void*)</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> res
<span class="keyword">|</span> list_cons
    <span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
    <span class="dynexp"><span class="keyword">val</span> res1 <span class="keyword">=</span> 
    <span class="keyword">(</span>
      <span class="keyword">if</span> i <span class="keyword">&gt;</span> <span class="dynexp">0</span>
        <span class="keyword">then</span> <span class="keyword">let</span>
          <span class="dynexp"><span class="keyword">val</span> sep <span class="keyword">=</span>
            tostrptr_list$sep&lt;<span class="keyword">&gt;</span> <span class="keyword">(</span><span class="keyword">)</span></span>
          <span class="comment">// end of [val]</span>
          <span class="dynexp"><span class="keyword">val</span> sep <span class="keyword">=</span> string0_copy <span class="keyword">(</span>sep<span class="keyword">)</span></span>
        <span class="keyword">in</span>
          list_vt_cons <span class="keyword">(</span>sep<span class="keyword">,</span> res<span class="keyword">)</span>
        <span class="keyword">end</span> <span class="comment">// end of [then]</span>
        <span class="keyword">else</span> res <span class="comment">// end of [else]</span>
    <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">List0_vt</span><span class="keyword">(</span><span class="staexp">Strptr1</span><span class="keyword">)</span></span>
    <span class="dynexp"><span class="keyword">val</span> xrep <span class="keyword">=</span> tostrptr_val&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>x<span class="keyword">)</span></span>
    <span class="dynexp"><span class="keyword">val</span> res2 <span class="keyword">=</span> list_vt_cons <span class="keyword">(</span>xrep<span class="keyword">,</span> res1<span class="keyword">)</span></span>
  <span class="keyword">in</span>
    loop <span class="keyword">(</span>i+<span class="dynexp">1</span><span class="keyword">,</span> xs<span class="keyword">,</span> res2<span class="keyword">)</span>
  <span class="keyword">end</span> <span class="comment">// end of [list_cons]</span>
<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> res <span class="keyword">=</span> list_vt_nil <span class="keyword">(</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> _beg <span class="keyword">=</span>
  tostrptr_list$beg&lt;<span class="keyword">&gt;</span> <span class="keyword">(</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> _beg <span class="keyword">=</span> string0_copy<span class="keyword">(</span>_beg<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> res <span class="keyword">=</span> list_vt_cons <span class="keyword">(</span>_beg<span class="keyword">,</span> res<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> res <span class="keyword">=</span> loop <span class="keyword">(</span><span class="dynexp">0</span><span class="keyword">,</span> xs<span class="keyword">,</span> res<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> _end <span class="keyword">=</span>
  tostrptr_list$end&lt;<span class="keyword">&gt;</span> <span class="keyword">(</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> _end <span class="keyword">=</span> string0_copy<span class="keyword">(</span>_end<span class="keyword">)</span></span>      
<span class="dynexp"><span class="keyword">val</span> res <span class="keyword">=</span> list_vt_cons <span class="keyword">(</span>_end<span class="keyword">,</span> res<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> res <span class="keyword">=</span> list_vt_reverse&lt;<span class="staexp">Strptr1</span><span class="keyword">&gt;</span> <span class="keyword">(</span>res<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
<span class="comment">//</span>
$UN<span class="keyword">.</span>castvwtp0<span class="staexp"><span class="keyword">{</span>Strptr1<span class="keyword">}</span></span><span class="keyword">(</span>strptrlst_concat<span class="keyword">(</span>res<span class="keyword">)</span><span class="keyword">)</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [tostrptr_list]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span> tostrptr_list$beg<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="dynstr">""</span></span>
<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span> tostrptr_list$end<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="dynstr">""</span></span>
<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span> tostrptr_list$sep<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="dynstr">""</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span>
tostrptr_val&lt;<span class="staexp">List</span><span class="keyword">(</span><span class="staexp">a</span><span class="keyword">)</span><span class="keyword">&gt;</span>
  <span class="keyword">(</span>xs0<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">$effmask_all</span> <span class="keyword">(</span>tostrptr_list&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>xs0<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
tostrptr_array
  <span class="keyword">(</span>A<span class="keyword">,</span> n<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">fun</span>
loop<span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>int<span class="keyword">}</span></span>
<span class="keyword">(</span>
  i<span class="keyword">:</span> <span class="staexp">int</span>
<span class="keyword">,</span> p<span class="keyword">:</span> <span class="staexp">ptr</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">size_t</span><span class="keyword">(</span><span class="staexp">n</span><span class="keyword">)</span>
<span class="keyword">,</span> res<span class="keyword">:</span> <span class="staexp">List0_vt</span><span class="keyword">(</span><span class="staexp">Strptr1</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">List0_vt</span><span class="keyword">(</span><span class="staexp">Strptr1</span><span class="keyword">)</span> <span class="keyword">=</span>
<span class="keyword">(</span>
<span class="keyword">if</span>
<span class="keyword">(</span>n <span class="keyword">&gt;</span> <span class="dynexp">0</span><span class="keyword">)</span>
<span class="keyword">then</span> <span class="keyword">let</span>
<span class="comment">//</span>
  <span class="dynexp"><span class="keyword">val</span> res1 <span class="keyword">=</span> 
  <span class="keyword">(</span>
    <span class="keyword">if</span> i <span class="keyword">&gt;</span> <span class="dynexp">0</span>
      <span class="keyword">then</span> <span class="keyword">let</span>
        <span class="dynexp"><span class="keyword">val</span> sep <span class="keyword">=</span>
          tostrptr_array$sep&lt;<span class="keyword">&gt;</span> <span class="keyword">(</span><span class="keyword">)</span></span>
        <span class="comment">// end of [val]</span>
        <span class="dynexp"><span class="keyword">val</span> sep <span class="keyword">=</span> string0_copy <span class="keyword">(</span>sep<span class="keyword">)</span></span>
      <span class="keyword">in</span>
        list_vt_cons <span class="keyword">(</span>sep<span class="keyword">,</span> res<span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [then]</span>
      <span class="keyword">else</span> res <span class="comment">// end of [else]</span>
  <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">List0_vt</span><span class="keyword">(</span><span class="staexp">Strptr1</span><span class="keyword">)</span></span>
<span class="comment">//</span>
  <span class="dynexp"><span class="keyword">val</span>
  <span class="keyword">(</span><span class="prfexp">pf</span><span class="keyword">,</span> <span class="prfexp">fpf</span> <span class="keyword">|</span> p<span class="keyword">)</span> <span class="keyword">=</span>
    $UN<span class="keyword">.</span>ptr_vtake<span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span><span class="keyword">(</span>p<span class="keyword">)</span></span>
  <span class="comment">// end of [val]</span>
  <span class="dynexp"><span class="keyword">val</span> xrep <span class="keyword">=</span> tostrptr_ref&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="keyword">!</span>p<span class="keyword">)</span></span>
  <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="comment">(*returned*)</span><span class="keyword">)</span> <span class="keyword">=</span> fpf <span class="keyword">(</span>pf<span class="keyword">)</span></span>
<span class="comment">//</span>
  <span class="dynexp"><span class="keyword">val</span> res2 <span class="keyword">=</span> list_vt_cons <span class="keyword">(</span>xrep<span class="keyword">,</span> res1<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  loop <span class="keyword">(</span>i+<span class="dynexp">1</span><span class="keyword">,</span> ptr_succ&lt;<span class="staexp">a</span><span class="keyword">&gt;</span><span class="keyword">(</span>p<span class="keyword">)</span><span class="keyword">,</span> pred<span class="keyword">(</span>n<span class="keyword">)</span><span class="keyword">,</span> res2<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [then]</span>
<span class="keyword">else</span> res <span class="comment">// end of [else]</span>
<span class="comment">//</span>
<span class="keyword">)</span></span> <span class="comment">(* end of [loop] *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> res <span class="keyword">=</span> list_vt_nil <span class="keyword">(</span><span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> _beg <span class="keyword">=</span>
  tostrptr_array$beg&lt;<span class="keyword">&gt;</span> <span class="keyword">(</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> _beg <span class="keyword">=</span> string0_copy<span class="keyword">(</span>_beg<span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> res <span class="keyword">=</span> list_vt_cons <span class="keyword">(</span>_beg<span class="keyword">,</span> res<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> res <span class="keyword">=</span> loop <span class="keyword">(</span><span class="dynexp">0</span><span class="keyword">,</span> <span class="dynexp"><span class="keyword">addr@</span></span>A<span class="keyword">,</span> n<span class="keyword">,</span> res<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> _end <span class="keyword">=</span>
  tostrptr_array$end&lt;<span class="keyword">&gt;</span> <span class="keyword">(</span><span class="keyword">)</span></span>
<span class="dynexp"><span class="keyword">val</span> _end <span class="keyword">=</span> string0_copy<span class="keyword">(</span>_end<span class="keyword">)</span></span>      
<span class="dynexp"><span class="keyword">val</span> res <span class="keyword">=</span> list_vt_cons <span class="keyword">(</span>_end<span class="keyword">,</span> res<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> res <span class="keyword">=</span> list_vt_reverse&lt;<span class="staexp">Strptr1</span><span class="keyword">&gt;</span> <span class="keyword">(</span>res<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
<span class="comment">//</span>
$UN<span class="keyword">.</span>castvwtp0<span class="staexp"><span class="keyword">{</span>Strptr1<span class="keyword">}</span></span><span class="keyword">(</span>strptrlst_concat<span class="keyword">(</span>res<span class="keyword">)</span><span class="keyword">)</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [tostrptr_array]</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span> tostrptr_array$beg<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="dynstr">""</span></span>
<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span> tostrptr_array$end<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="dynstr">""</span></span>
<span class="dynexp"><span class="keyword">implement</span><span class="keyword">{</span><span class="staexp"><span class="keyword">}</span></span> tostrptr_array$sep<span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="dynstr">""</span></span>
<span class="comment">//</span>
<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
tostrptr_arrayref
  <span class="keyword">(</span>A<span class="keyword">,</span> n<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">vbox pf</span> <span class="keyword">|</span> p<span class="keyword">)</span> <span class="keyword">=</span>
  arrayref_get_viewptr<span class="keyword">(</span>A<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">$effmask_ref</span><span class="keyword">(</span>tostrptr_array&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="keyword">!</span>p<span class="keyword">,</span> n<span class="keyword">)</span><span class="keyword">)</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [tostrptr_arrayref]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="dynexp"><span class="keyword">implement</span>
<span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span><span class="comment">(*tmp*)</span>
tostrptr_arrszref
  <span class="keyword">(</span>ASZ<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//</span>
<span class="keyword">var</span> n<span class="keyword">:</span> <span class="staexp">size_t</span>
<span class="dynexp"><span class="keyword">val</span> A <span class="keyword">=</span> arrszref_get_refsize <span class="keyword">(</span>ASZ<span class="keyword">,</span> n<span class="keyword">)</span></span>
<span class="comment">//</span>
<span class="keyword">in</span>
  tostrptr_arrayref&lt;<span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>A<span class="keyword">,</span> n<span class="keyword">)</span>
<span class="keyword">end</span></span> <span class="comment">// end of [tostrptr_arrszref]</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* end of [tostring.dats] *)</span>
</pre>
<!--php-->

</body>
</html>
